if (sheetVersion < 13001014) { throw "This script was made for a newer version of the sheet (v13.1.14). Please use the latest version and try again.\nYou can get the latest version at www.flapkan.com."; };
var iFileName = "all_WotC_published.js";
RequiredSheetVersion("13.1.14");
// pub_20140715_LMoP.js
// This file adds the magic items from the Lost Mines of Phandelver adventure from the D&D 5e starter set to MPMB's Character Record Sheet

// Define the source
SourceList["LMoP"] = {
	name : "Lost Mines of Phandelver [items]",
	abbreviation : "LMoP",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://www.dndbeyond.com/sources/lmop",
	date : "2014/07/15"
};

// Magic Items
MagicItemsList["dragonguard"] = {
	name : "Dragonguard",
	source : [["LMoP", 48], ["PaBTSO", 72]],
	type : "armor (breastplate)",
	rarity : "rare",
	magicItemTable : "G",
	description : "This +1 breastplate has a gold dragon motif worked into its design. It grants its wearer advantage on saving throws against the breath weapons of creatures that have the dragon type.",
	descriptionFull : "This +1 breastplate has a gold dragon motif worked into its design. Created for a human hero of Neverwinter named Tergon, it grants its wearer advantage on saving throws against the breath weapons of creatures that have the dragon type.",
	weight : 20,
	armorOptions : [{
		regExpSearch : /dragonguard/i,
		name : "Dragonguard",
		source : [["LMoP", 48], ["PaBTSO", 72]],
		type : "medium",
		ac : "14+1",
		weight : 20,
		selectNow : true
	}],
	savetxt : { adv_vs : ["breath weapons of dragons"] }
}
MagicItemsList["hew"] = {
	name : "Hew",
	source : [["LMoP", 33], ["PaBTSO", 54]],
	type : "weapon (battleaxe)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : 'Dwarvish runes on the head of this rusty battleaxe read "Hew". It adds a +1 bonus to attack and damage rolls made with it and deals maximum damage against plant creatures or objects made of wood. While carrying it, I feel uneasy when I travel through a forest, as its creator was a dwarf smith who feuded with dryads.',
	descriptionFull : 'This rusty old battleaxe of dwarven manufacture has has runes in Dwarvish on the axe head which read "Hew". Hew is a +1 battleaxe deals maximum damage when the wielder hits a plant creature or an object made of wood. The axe\'s creator was a dwarf smith who feuded with the dryads of a forest where he used it for protection while he cut firewood. Whoever carries the axe feels uneasy whenever he or she travels through a forest.',
	weight : 4,
	weaponOptions : [{
		baseWeapon : "battleaxe",
		regExpSearch : /\bhew\b/i,
		name : '"Hew"',
		source : [["LMoP", 33], ["PaBTSO", 54]],
		description : "Versatile (1d10); Max damage against plant creatures and wooden objects",
		modifiers : [1, 1],
		selectNow : true
	}]
}
MagicItemsList["lightbringer"] = {
	name : "Lightbringer",
	source : [["LMoP", 48], ["PaBTSO", 54]],
	type : "weapon (mace)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "This mace adds a +1 bonus to attack and damage rolls made with it. It is made for a cleric of the god of dawn, with its head of shaped like a sunburst and made of solid brass. I can command it to glow as bright as a torch. While glowing, the mace deals an extra 1d6 radiant damage to undead creatures.",
	descriptionFull : "This +1 mace was made for a cleric of Lathander, the god of dawn. The head of the mace is shaped like a sunburst and is made of solid brass. Named Lightbringer, this weapon glows as bright as a torch when its wielder commands. While glowing, the mace deals an extra 1d6 radiant damage to undead creatures.",
	weight : 4,
	weaponOptions : [{
		baseWeapon : "mace",
		regExpSearch : /lightbringer/i,
		name : "Lightbringer",
		source : [["LMoP", 48], ["PaBTSO", 54]],
		description : "Command to glow as torch and deal +1d6 radiant damage to undead",
		modifiers : [1, 1],
		selectNow : true
	}]
}
MagicItemsList["spider staff"] = { // changed to the new version introduced in Phandelver and Below: The Shattered Obelisk with the prerequisite
	name : "Spider Staff",
	source : [["LMoP", 53], ["PaBTSO", 220]],
	type : "staff",
	rarity : "rare",
	magicItemTable : "G",
	description : "Attacks with this black adamantine quarterstaff topped with a spider deal +1d6 poison damage on a hit. It has 10 charges and regains 1d6+4 expended charges at dawn. If I use its last charge, roll a d20. On a 1, it is destroyed. I can use its charges to cast Spider Climb (1 charge) or Web (2 charges, spell save DC 15).",
	descriptionFull : "The top of this black, adamantine staff is shaped like a spider. The staff weighs 6 pounds. You must be attuned to the staff to gain its benefits and cast its spells. The staff can be wielded as a quarterstaff. It deals 1d6 extra poison damage on a hit when used to make a weapon attack.\n   The staff has 10 charges, which are used to fuel the spells within it. With the staff in hand, you can use your action to cast one of the following spells from the staff if the spell is on your class's spell list: Spider Climb (1 charge) or Web (2 charges, spell save DC 15). No components are required.\n   The staff regains 1d6+4 expended charges each day at dusk. If you expend the staff's last charge, roll a d20. On a 1, the staff crumbles to dust and is destroyed.",
	attunement : true,
	prerequisite : "Requires attunement by a bard, sorcerer, warlock, or wizard",
	prereqeval : function(v) { return classes.known.bard || classes.known.sorcerer || classes.known.warlock || classes.known.wizard ? true : false; },
	weight : 6, // kept to the original weight
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	weaponOptions : [{
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*spider)(?=.*staff).*$/i,
		name : "Spider Staff",
		source : [["LMoP", 53], ["PaBTSO", 220]],
		description : "Versatile (1d8); +1d6 poison damage",
		selectNow : true
	}],
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["spider climb"],
		selection : ["spider climb"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["web"],
		selection : ["web"],
		firstCol : 2
	}]
}
MagicItemsList["staff of defense"] = { // changed to the new version introduced in Phandelver and Below: The Shattered Obelisk with the prerequisite
	name : "Staff of Defense",
	source : [["LMoP", 53]],
	type : "staff",
	rarity : "rare",
	magicItemTable : "G",
	description : "This slender, hollow staff is made of glass yet is as strong as oak. While holding it, I gain a +1 bonus to AC. It has 10 charges and regains 1d6+4 expended charges at dawn. If I use its last charge, roll a d20. On a 1, it is destroyed. I can use its charges to cast Mage Armor (1 charge) or Shield (2 charges) as an action.",
	descriptionFull : "This slender, hollow staff is made of glass yet is as strong as oak. It weighs 3 pounds. You must be attuned to the staff to gain its benefits and cast its spells.\n   While holding the staff, you have a +1 bonus to your Armor Class.\n   The staff has 10 charges, which are used to fuel the spells within it. With the staff in hand, you can use your action to cast one of the following spells from the staff if the spell is on your class's spell list: Mage Armor (1 charge) or Shield (2 charges). No components are required.\n   The staff regains 1d6+4 expended charges each day at dawn. If you expend the staff's last charge, roll a d20. On a 1, the staff shatters and is destroyed.",
	attunement : true,
	prerequisite : "Requires attunement by a bard, sorcerer, warlock, or wizard",
	prereqeval : function(v) { return classes.known.bard || classes.known.sorcerer || classes.known.warlock || classes.known.wizard ? true : false; },
	weight : 3,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	weaponsAdd : { options : ["Staff of Defense"] },
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["mage armor"],
		selection : ["mage armor"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["shield"],
		selection : ["shield"],
		firstCol : 2
	}],
	spellChanges : {
		"shield" : {
			time : "1 a",
			changes : "Cast as an action."
		}
	},
	extraAC : [{name : "Staff of Defense", mod : 1, magic : true, text : "I gain a +1 bonus to AC while holding the Staff of Defense."}],
}

// pub_20140818_PHB.js
// This file adds all material from the Player's Handbook to MPMB's Character Record Sheet

// Define the source
SourceList.P={
	name : "Player's Handbook",
	abbreviation : "PHB",
	abbreviationSpellsheet : "P",
	group : "Core Sources",
	url : "https://dnd.wizards.com/products/rpg_playershandbook",
	date : "2014/08/19"
};

// (sub)Races that are not in the SRD
RaceList["mountain dwarf"] = {
	regExpSearch : /^((?=.*(hylar|daewar))|((?=.*\b(dwarfs?|dwarves|dwarfish|dwarvish|dwarven)\b)(?=.*\b(mountain|shield)\b))).*$/i,
	name : "Mountain dwarf",
	sortname : "Dwarf, Mountain",
	source : [["P", 20]],
	plural : "Mountain dwarves",
	size : 3,
	speed : {
		walk : { spd : 25, enc : 25 }
	},
	languageProfs : ["Common", "Dwarvish"],
	vision : [["Darkvision", 60]],
	savetxt : { adv_vs : ["poison"] },
	dmgres : ["Poison"],
	weaponProfs : [false, false, ["battleaxe", "handaxe", "warhammer", "light hammer"]],
	armorProfs : [true, true, false, false],
	toolProfs : [["Smith, brewer, or mason tools", 1]],
	age : " are considered young until they are 50 and live about 350 years",
	height : " stand between 4 and 5 feet tall (4' + 2d4\")",
	weight : " weigh around 150 lb (130 + 2d4 \xD7 2d6 lb)",
	heightMetric : " stand between 1,2 and 1,5 metres tall (120 + 5d4 cm)",
	weightMetric : " weigh around 75 kg (60 + 5d4 \xD7 4d6 / 10 kg)",
	scores : [2, 0, 2, 0, 0, 0],
	trait : "Mountain Dwarf (+2 Strength, +2 Constitution)\n\nStonecunning:\n   Whenever I make an Intelligence (History) check related to the origin of stonework, I am considered proficient in the History skill and add double my proficiency bonus to the check, instead of my normal proficiency bonus."
};
RaceList["dark elf"] = {
	regExpSearch : /^(?!.*half)((?=.*drow)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(dark|underdarks?|deep|depths?)\b))).*$/i,
	name : "Drow",
	sortname : "Elf, Dark (Drow)",
	source : [["P", 24]],
	plural : "Drow",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 120], ["Sunlight Sensitivity", 0]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	weaponProfs : [false, false, ["rapier", "shortsword", "hand crossbow"]],
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to 5 1/2 feet tall (4'5\" + 2d6\")",
	weight : " weigh around 100 lb (75 + 2d6 \xD7 1d6 lb)",
	heightMetric : " range from under 1,5 to 1,7 metres tall (135 + 5d6 cm)",
	weightMetric : " weigh around 45 kg (35 + 5d6 \xD7 2d6 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	trait : "Drow (+2 Dexterity, +1 Charisma)\nTrance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).\nSunlight Sensitivity: Disadvantage on attack rolls and Wisdom (Perception) checks that rely on sight when I or what I am trying to attack/perceive is in direct sunlight.\nDrow Magic: 1st level: Dancing Lights cantrip; 3rd level: Faerie Fire; 5th level: Darkness. Both spells can be used once per long rest. Charisma is my spellcasting ability for these.", // errata to specify once per day is long rest
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Drow Magic (level 1)",
		spells : ["dancing lights"],
		selection : ["dancing lights"],
		firstCol : "atwill"
	},
	features : {
		"faerie fire" : {
			name : "Drow Magic (level 3)",
			limfeaname : "Faerie Fire",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Drow Magic (level 3)",
				spells : ["faerie fire"],
				selection : ["faerie fire"],
				firstCol : "oncelr"
			}
		},
		"darkness" : {
			name : "Drow Magic (level 5)",
			limfeaname : "Darkness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Drow Magic (level 5)",
				spells : ["darkness"],
				selection : ["darkness"],
				firstCol : "oncelr"
			}
		}
	}
};
RaceList["wood elf"] = {
	regExpSearch : /^(?!.*half)((?=.*(grugach|kagonesti|silhana))|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(woodlands?|woods?|forests?|wilds?|green)\b))).*$/i,
	name : "Wood elf",
	sortname : "Elf, Wood",
	source : [["P", 24]],
	plural : "Wood elves",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	weaponProfs : [false, false, ["longsword", "shortsword", "longbow", "shortbow"]],
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d10\")",
	weight : " weigh around 125 lb (100 + 2d10 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (140 + 5d10 cm)",
	weightMetric : " weigh around 60 kg (45 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Wood Elf (+2 Dexterity, +1 Wisdom)\nTrance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. While meditating, I can dream after a fashion; such dreams are actually mental exercises that have become reflexive through years of practice. After resting in this way, I gain the same benefit that a human does from 8 hours of sleep, thus needing only 4 hours for a long rest.\nMask of the Wild: I can attempt to hide even when I am only lightly obscured by foliage, heavy rain, falling snow, mist, and other natural phenomena."
};
RaceList["forest gnome"] = {
	regExpSearch : /^((?=.*\bgnomes?\b)(?=.*\b(woods?|forests?|wilds?|green)\b)).*$/i,
	name : "Forest gnome",
	sortname : "Gnome, Forest",
	source : [["P", 37]],
	plural : "Forest gnomes",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Gnomish"],
	vision : [["Darkvision", 60]],
	savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. magic"] },
	age : " start adult life around age 40 and can live 350 to almost 500 years",
	height : " are 3 to 4 feet tall (2'11\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " are 90 to 120 cm tall (2'11\" + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 1, 0, 2, 0, 0],
	trait : "Forest Gnome (+1 Dexterity, +2 Intelligence)" + (typePF ? "\n" : " ") + "\nNatural Illusionist:\n   I know the Minor Illusion cantrip. Intelligence is my spellcasting ability for it.\n\nSpeak with Small Beasts:\n   Through sounds and gestures, I can communicate simple ideas with Small or smaller beasts.",
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "Natural Illusionist",
		spells : ["minor illusion"],
		selection : ["minor illusion"],
		firstCol : "atwill"
	}
};
RaceList["stout halfling"] = {
	regExpSearch : /^(?=.*\b(halflings?|hobbits?)\b)(?=.*stout).*$/i,
	name : "Stout halfling",
	sortname : "Halfling, Stout",
	source : [["P", 28]],
	plural : "Stout halflings",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened", "poison"] },
	dmgres : ["Poison"],
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 1, 0, 0, 0],
	trait : "Stout Halfling (+2 Dexterity, +1 Constitution)\n\nLucky: When I roll a 1 on an attack roll, ability check, or saving throw, I can reroll the die and must use the new roll.\n\nHalfling Nimbleness: I can move through the space of any creature that is of a size larger than me."
};

// Add racial variants that are not part of the SRD
AddRacialVariant("human", "variant", {
	regExpSearch : /variant/i,
	source : [["P", 31]],
	skillstxt : "Choose any one skill",
	scorestxt : "+1 to two different ability scores of my choice",
	scores : [0, 0, 0, 0, 0, 0],
	trait : "Human (+1 to two different ability scores of my choice)\n\nSkills: I gain proficiency in one skill of my choice.\n\nFeat: I gain one feat of my choice.",
	eval : function() { AddString('Feat Note 1', 'Human bonus feat', '; '); },
	removeeval : function() { RemoveString('Feat Note 1', 'Human bonus feat'); }
});

// Add the subclasses that are not in the SRD
AddSubClass("barbarian", "totem warrior", {
	regExpSearch : /^(?=.*totem)(?=.*(warrior|fighter|marauder|barbarian|viking|(norse|tribes?|clans?)(wo)?m(a|e)n)).*$/i,
	subname : "Path of the Totem Warrior",
	fullname : "Totem Warrior",
	source : [["P", 50]],
	features : {
		"subclassfeature3" : {
			name : "Spirit Seeker",
			source : [["P", 50]],
			minlevel : 3,
			description : "\n   " + "I can cast Beast Sense and Speak with Animals as rituals (PHB 217 \u0026 277)",
			spellcastingBonus : {
				name : "Spirit Seeker",
				spells : ["beast sense", "speak with animals"],
				selection : ["beast sense", "speak with animals"],
				firstCol : "(R)",
				times : 2
			},
			spellChanges : {
				"beast sense" : {
					time : "10 min",
					changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
				},
				"speak with animals" : {
					time : "10 min",
					changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
				}
			}
		},
		"subclassfeature3.1" : {
			name : "Totem Spirit",
			source : [["P", 50]],
			minlevel : 3,
			description : "\n   " + 'Choose Bear, Eagle, Elk, Wolf, or Tiger Spirit using the "Choose Feature" button above',
			choices : ["Bear", "Eagle", "Wolf"],
			"bear" : {
				name : "Bear Spirit",
				description : "\n   " + "While raging, I have resistance to all damage types except psychic",
				dmgres : [["All -Psychic", "All -Psychic (rage)"]],
				eval : function() {
					processResistance(false, 'Barbarian: Rage', ClassList.barbarian.features.rage.dmgres);
				},
				removeeval : function() {
					processResistance(true, 'Barbarian: Rage', ClassList.barbarian.features.rage.dmgres);
				}
			},
			"eagle" : {
				name : "Eagle Spirit",
				description : "\n   " + "While raging without heavy armor, others have disadv. on opportunity attacks vs. me" + "\n   " + "I can use the Dash action as a bonus action",
				action : ["bonus action", " (Dash)"]
			},
			"wolf" : {
				name : "Wolf Spirit",
				description : "\n   " + "While raging, friends have advantage on melee attacks vs. hostiles within 5 ft of me"
			}
		},
		"subclassfeature6" : {
			name : "Aspect of the Beast",
			source : [["P", 50]],
			minlevel : 6,
			description : "\n   " + 'Choose Bear, Eagle, Elk, Wolf, or Tiger Aspect using the "Choose Feature" button above',
			choices : ["Bear", "Eagle", "Wolf"],
			"bear" : {
				name : "Aspect of the Bear",
				description : "\n   " + "Advantage on Strength checks to push/pull/lift/break; Carrying capacity is doubled",
				carryingCapacity : 2
			},
			"eagle" : {
				name : "Aspect of the Eagle",
				description : "\n   " + "I can see up to 1 mile away perfectly; No disadvantage on Perception from dim light"
			},
			"wolf" : {
				name : "Aspect of the Wolf",
				description : "\n   " + "I can track while traveling at a fast pace; I can move stealthily at a normal pace"
			}
		},
		"subclassfeature10" : {
			name : "Spirit Walker",
			source : [["P", 50]],
			minlevel : 10,
			description : "\n   " + "I can cast Commune with Nature as a ritual",
			spellcastingBonus : {
				name : "Spirit Walker",
				spells : ["commune with nature"],
				selection : ["commune with nature"],
				firstCol : "(R)"
			},
			spellChanges : {
				"commune with nature" : {
					time : "11 min",
					changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
				}
			}
		},
		"subclassfeature14" : {
			name : "Totemic Attunement",
			source : [["P", 50]],
			minlevel : 14,
			description : "\n   " + 'Choose Bear, Eagle, Elk, Wolf, or Tiger Attunement using the "Choose Feature" button',
			choices : ["Bear", "Eagle", "Wolf"],
			"bear" : {
				name : "Bear Attunement",
				description : "\n   " + "While raging, any creature that sees me within 5 ft has disadv. on attacks vs. others" + "\n   " + "Enemies that can't perceive me or be frightened are immune"
			},
			"eagle" : {
				name : "Eagle Attunement",
				description : "\n   " + "While raging, I can fly at my current speed, but I can only stay aloft during my turn"
			},
			"wolf" : {
				name : "Wolf Attunement",
				description : "\n   " + "If my melee attack hits while raging, I can knock prone as a bonus action (up to Large)",
				action : ["bonus action", " (raging: knock prone)"]
			}
		}
	}
});
AddSubClass("bard", "college of valor", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*valor).*$/i,
	subname : "College of Valor",
	source : [["P", 55]],
	attacks : [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : [["P", 55]],
			minlevel : 3,
			description : "\n   " + "I gain proficiency with medium armor, shields, and martial weapons",
			armorProfs : [false, true, false, true],
			weaponProfs : [false, true]
		},
		"subclassfeature3.1" : {
			name : "Combat Inspiration",
			source : [["P", 55]],
			minlevel : 3,
			description : "\n   " + "My Bardic Inspiration can also be used to add the die to a weapon damage roll" + "\n   " + "Alternatively, it can be used as a reaction to add the die to AC against one attack"
		},
		"subclassfeature14" : {
			name : "Battle Magic",
			source : [["P", 55]],
			minlevel : 14,
			description : "\n   " + "As a bonus action when I use my action to cast a bard spell, I can make a weapon attack",
			action : ["bonus action", " (with Bard spell)"]
		}
	}
});
AddSubClass("cleric", "knowledge domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(knowledge|wisdom|learning)).*$/i,
	subname : "Knowledge Domain",
	source : [["P", 59]],
	spellcastingExtra : ["command", "identify", "augury", "suggestion", "nondetection", "speak with dead", "arcane eye", "confusion", "legend lore", "scrying"],
	features : {
		"subclassfeature1" : {
			name : "Blessings of Knowledge",
			source : [["P", 59]],
			minlevel : 1,
			description : "\n   " + "I learn two languages and gain proficiency and expertise with two skills" + "\n   " + "I can choose from the following: Arcana, History, Nature, or Religion",
			skillstxt : "Choose two from Arcana, History, Nature, and Religion. You also gain expertise with these skills",
			languageProfs : [2]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Knowledge of Ages",
			source : [["P", 59]],
			minlevel : 2,
			description : "\n   " + "As an action, I gain proficiency with a chosen skill or tool for 10 minutes",
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Channel Divinity: Read Thoughts",
			source : [["P", 59]],
			minlevel : 6,
			description : "\n   " + "As an action, one creature within 60 ft I can see must make a Wisdom save" + "\n   " + "If it fails, I can read its surface thoughts for 1 min, as long as it's within 60 ft of me" + "\n   " + "As an action, I can end this and cast Suggestion on it (it fails its save automatically)" + "\n   " + "If it succeeded on its save, I can't use this feature again on it until I finish a long rest",
			action : ["action", ""]
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : [["P", 60]],
			minlevel : 8,
			description : desc("I add my Wisdom modifier to the damage I deal with my cleric cantrips"),
			calcChanges : GenericClassFeatures["potent spellcasting"].calcChanges
		},
		"subclassfeature17" : {
			name : "Visions of the Past",
			source : [["P", 60]],
			minlevel : 17,
			description : desc([
				"I can see recent events of an object or area by concentrating and praying for 1 min",
				"I can meditate this way for up to a number of minutes equal to my Wisdom score",
				"\u2022 Object Reading (after meditating for 1 minute per owner):",
				"   If an owner owned it in the last Wis score in days, I learn how that owner got/lost it",
				"   I also learn the most recent significant event involving the object and the owner",
				"\u2022 Area Reading (my immediate surroundings, up to a 50-foot cube):",
				"   Going back my Wisdom score in days, per minute I meditate, I learn about one event",
				"   This starts with the most recent event; It can be significant or just important to me"
			]),
			usages : 1,
			recovery : "short rest"
		}
	}
});
AddSubClass("cleric", "light domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*\b(light|sun|shining)\b).*$/i,
	subname : "Light Domain",
	source : [["P", 61]],
	spellcastingExtra : ["burning hands", "faerie fire", "flaming sphere", "scorching ray", "daylight", "fireball", "guardian of faith", "wall of fire", "flame strike", "scrying"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Cantrip",
			source : [["P", 61]],
			minlevel : 1,
			description : "\n   " + "I learn the Light cantrip if I didn't already know it",
			spellcastingBonus : {
				name : "Bonus Cantrip (Light)",
				spells : ["light"],
				selection : ["light"]
			}
		},
		"subclassfeature1.1" : {
			name : "Warding Flare",
			source : [["P", 61]],
			minlevel : 1,
			description : desc([
				"When a creature within 30 ft attacks me and I can see it, I can interpose divine light",
				"As a reaction, I impose disadv. on the attacker's attack roll (unless it can't be blinded)"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["reaction", ""]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Radiance of the Dawn",
			source : [["P", 61]],
			minlevel : 2,
			description : "\n   " + "As an action, in 30 ft, magical darkness is dispelled and hostiles must make a Con save" + "\n   " + "Each takes radiant damage, saves for half, and negates with total cover",
			additional : ["", "2d10 + 2 damage", "2d10 + 3 damage", "2d10 + 4 damage", "2d10 + 5 damage", "2d10 + 6 damage", "2d10 + 7 damage", "2d10 + 8 damage", "2d10 + 9 damage", "2d10 + 10 dmg", "2d10 + 11 dmg", "2d10 + 12 dmg", "2d10 + 13 dmg", "2d10 + 14 dmg", "2d10 + 15 dmg", "2d10 + 16 dmg", "2d10 + 17 dmg", "2d10 + 18 dmg", "2d10 + 19 dmg", "2d10 + 20 dmg"],
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Improved Flare",
			source : [["P", 61]],
			minlevel : 6,
			description : "\n   " + "I can also use my Warding Flare if another is attacked by a creature within 30 ft of me"
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : [["P", 61]],
			minlevel : 8,
			description : desc("I add my Wisdom modifier to the damage I deal with my cleric cantrips"),
			calcChanges : GenericClassFeatures["potent spellcasting"].calcChanges
		},
		"subclassfeature17" : {
			name : "Corona of Light",
			source : [["P", 61]],
			minlevel : 17,
			description : "\n   " + "As an action, I have an aura of 60 ft sunlight and 30 ft dim light for 1 min" + "\n   " + "Enemies in the sunlight have disadv. on saves vs. spells that deal fire or radiant damage",
			action : ["action", " (start/stop)"]
		}
	}
});
AddSubClass("cleric", "nature domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*\b(nature|natural|animal|element(s|al)?)\b).*$/i,
	subname : "Nature Domain",
	source : [["P", 62]],
	spellcastingExtra : ["animal friendship", "speak with animals", "barkskin", "spike growth", "plant growth", "wind wall", "dominate beast", "grasping vine", "insect plague", "tree stride"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : [["P", 62]],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with heavy armor",
			armorProfs : [false, false, true, false]
		},
		"subclassfeature1.1" : {
			name : "Acolyte of Nature",
			source : [["P", 62]],
			minlevel : 1,
			description : "\n   " + "I learn a druid cantrip and proficiency with a skill: Animal Handling, Nature, Survival",
			skillstxt : "Choose one from Animal Handling, Nature, or Survival",
			spellcastingBonus : {
				name : "Acolyte of Nature",
				"class" : "druid",
				level : [0, 0]
			}
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Charm Animals and Plants",
			source : [["P", 62]],
			minlevel : 2,
			description : "\n   " + "As an action, all beasts and plants within 30 ft that I can see must make a Wis save" + "\n   " + "If failed, each is charmed and friendly to allies and me for 1 min or until damaged",
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Dampen Elements",
			source : [["P", 62]],
			minlevel : 6,
			description : "\n   " + "As a reaction, if an ally in 30 ft or I takes acid/cold/fire/lightning/thunder damage," + "\n   " + "I can grant resistance against that instance of damage",
			action : ["reaction", ""]
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : [["P", 62]],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				return n < 8 ? "" : "+" + (n < 14 ? 1 : 2) + "d8 cold/fire/lightning damage (choice)";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && v.isWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 cold/fire/lightning damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra cold, fire, or lightning damage (my choice)."
				]
			}
		},
		"subclassfeature17" : {
			name : "Master of Nature",
			source : [["P", 62]],
			minlevel : 17,
			description : "\n   " + "As a bonus action, I can command creatures that are charmed by my Channel Divinity",
			action : ["bonus action", ""]
		}
	}
});
AddSubClass("cleric", "tempest domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*\b(tempest|destruction|storm)\b).*$/i,
	subname : "Tempest Domain",
	source : [["P", 62]],
	spellcastingExtra : ["fog cloud", "thunderwave", "gust of wind", "shatter", "call lightning", "sleet storm", "control water", "ice storm", "destructive wave", "insect plague"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : [["P", 62]],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with martial weapons and heavy armor",
			armorProfs : [false, false, true, false],
			weaponProfs : [false, true]
		},
		"subclassfeature1.1" : {
			name : "Wrath of the Storm",
			source : [["P", 62]],
			minlevel : 1,
			description : "\n   " + "As a reaction, when a creature I can see within 5 ft hits me, I can thunderously rebuke" + "\n   " + "It takes 2d8 lightning or thunder damage (my choice) that a Dex save can halve",
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["reaction", ""]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Destructive Wrath",
			source : [["P", 62]],
			minlevel : 2,
			description : "\n   " + "Instead of rolling, I can do maximum damage when I do lightning or thunder damage"
		},
		"subclassfeature6" : {
			name : "Thunderbolt Strike",
			source : [["P", 62]],
			minlevel : 6,
			description : "\n   " + "When I deal lightning damage to a Large or smaller foe, I can push it up to 10 ft away"
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : [["P", 62]],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 thunder damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && v.isWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 thunder damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra thunder damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Stormborn",
			source : [["P", 62]],
			minlevel : 17,
			description : "\n   " + "Whenever I'm not underground or indoors, I have a fly speed equal to my current speed",
			speed : { fly : { spd : "walk", enc : "walk" } }
		}
	}
});
AddSubClass("cleric", "trickery domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(trickery|trickster|illusion)).*$/i,
	subname : "Trickery Domain",
	source : [["P", 63]],
	spellcastingExtra : ["charm person", "disguise self", "mirror image", "pass without trace", "blink", "dispel magic", "dimension door", "polymorph", "dominate person", "modify memory"],
	features : {
		"subclassfeature1" : {
			name : "Blessing of the Trickster",
			source : [["P", 63]],
			minlevel : 1,
			description : "\n   " + "As an action, a willing creature I touch (not me) has adv. on Dex (Stealth) checks" + "\n   " + "This lasts for 1 hour or until I use it again",
			action : ["action", ""]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Invoke Duplicity",
			source : [["P", 63]],
			minlevel : 2,
			description : desc([
				"As an action, I create illusory duplicates of myself within 30 ft of me for 1 min (conc)",
				"As a bonus action, I can move them 30 ft to space(s) I can see within 120 ft of me",
				"I can cast spells as though I was in an duplicate's space, using my own senses",
				"I have advantage on attacks if the target is within 5 ft of a duplicate and me"
			]),
			additional : levels.map(function (n) { return n < 2 ? "" : (n < 17 ? 1 : 2) + " illusory duplicate" + (n < 17 ? "" : "s"); }),
			action : [["action", ""], ["bonus action", "Move Duplicate(s)"]]
		},
		"subclassfeature6" : {
			name : "Channel Divinity: Cloak of Shadows",
			source : [["P", 63]],
			minlevel : 6,
			description : "\n   " + "As an action, I become invisible until the end of my next turn or I attack/cast a spell",
			action : ["action", ""]
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : [["P", 63]],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) { return n < 8 ? "" : "+" + (n < 14 ? 1 : 2) + "d8 poison damage"; }),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && v.isWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 poison damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra poison damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Improved Duplicity",
			source : [["P", 63]],
			minlevel : 17,
			description : desc([
				"When I use Invoke Duplicity, I make four illusory duplicates instead of one",
				"I can move any number of the illusory duplicates as part of the same bonus action"
			])
		}
	}
});
AddSubClass("cleric", "war domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*\b(war|fighting|conflict)\b).*$/i,
	subname : "War Domain",
	source : [["P", 63]],
	spellcastingExtra : ["divine favor", "shield of faith", "magic weapon", "spiritual weapon", "crusader's mantle", "spirit guardians", "freedom of movement", "stoneskin", "flame strike", "hold monster"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : [["P", 63]],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with martial weapons and heavy armor",
			armorProfs : [false, false, true, false],
			weaponProfs : [false, true]
		},
		"subclassfeature1.1" : {
			name : "War Priest",
			source : [["P", 63]],
			minlevel : 1,
			description : "\n   " + "When I use the Attack action, I can make a weapon attack as a bonus action",
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["bonus action", " (with Attack action)"]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Guided Strike",
			source : [["P", 63]],
			minlevel : 2,
			description : "\n   " + "When I make an attack roll, I can add a +10 bonus to the roll after seeing the d20 roll"
		},
		"subclassfeature6" : {
			name : "Channel Divinity: War God's Blessing",
			source : [["P", 63]],
			minlevel : 6,
			description : desc([
				"As a reaction, when a creature within 30 ft makes an attack roll, I can bless its attack",
				"The creature then adds a +10 bonus to the roll; I can do this after seeing the d20 roll"
			]),
			action : ["reaction", ""]
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : [["P", 63]],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 damage of the weapon's type";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && v.isWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Avatar of Battle",
			source : [["P", 63]],
			minlevel : 17,
			description : "\n   " + "I have resistance to bludgeoning/piercing/slashing damage from nonmagical weapons",
			dmgres : [["Bludgeoning", "Bludg. (nonmagical)"], ["Piercing", "Pierc. (nonmagical)"], ["Slashing", "Slash. (nonmagical)"]]
		}
	}
});
AddSubClass("druid", "circle of the moon", {
	regExpSearch : /^(?=.*(druid|shaman))((?=.*\bmoon\b)|((?=.*\bmany\b)(?=.*\bforms?\b))).*$/i,
	subname : "Circle of the Moon",
	source : [["P", 69]],
	features : {
		"subclassfeature2" : {
			name : "Circle Forms",
			source : [["P", 69]],
			minlevel : 2,
			description : "\n   " + "I am able to transform into more dangerous animal forms when using Wild Shape"
		},
		"subclassfeature2.wild shape" : {
			name : "Wild Shape",
			source : [["P", 66]],
			minlevel : 2,
			description : desc([
				"As a bonus action, I assume the shape of a beast I have seen before with these rules:",
				" \u2022 I gain all its game statistics except Intelligence, Wisdom, or Charisma",
				" \u2022 I get its skill/saving throw prof. while keeping my own, using whichever is higher",
				" \u2022 I assume the beast's HP and HD; I get mine back when I revert back",
				" \u2022 I can't cast spells in beast form, but transforming doesn't break concentration",
				" \u2022 I retain features from class, race, etc., but I don't retain special senses",
				" \u2022 I can choose whether equipment falls to the ground, merges, or stays worn",
				" \u2022 I revert if out of time or unconscious; if KOd by damage, excess damage carries over"
			]),
			usages : [0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, "\u221E\xD7 per "],
			recovery : "short rest",
			additional : levels.map(function (n) {
				if (n < 2) return "";
				var cr = Math.max(1, Math.floor(n/3));
				var hr = Math.floor(n/2);
				var restr = n < 4 ? ", no fly/swim" : n < 8 ? ", no fly" : "";
				return "CR " + cr + restr + "; " + hr + (restr.length ? " h" : " hours");
			}),
			action : ["bonus action", " (start/stop)"],
			eval : function() {
				processActions(false, "Druid: Wild Shape", ClassList.druid.features["subclassfeature2.wild shape"].action, "Wild Shape");
			}
		},
		"subclassfeature2.1" : {
			name : "Combat Wild Shape",
			source : [["P", 69]],
			minlevel : 2,
			description : "\n   " + "As a bonus action while in Wild Shape, I can expend spell slots to heal myself" + "\n   " + "I regain 1d8 HP per expended spell slot level; I can use Wild Shape as a bonus action",
			action : ["bonus action", " (heal)"],
			removeeval : function() {
				processActions(true, "Druid: Wild Shape", ClassList.druid.features["subclassfeature2.wild shape"].action, "Wild Shape");
			}
		},
		"subclassfeature6" : {
			name : "Primal Strike",
			source : [["P", 69]],
			minlevel : 6,
			description : "\n   " + "My attacks count as magical while in Wild Shape"
		},
		"subclassfeature10" : {
			name : "Elemental Wild Shape",
			source : [["P", 69]],
			minlevel : 10,
			description : "\n   " + "I can transform into an air/earth/fire/water elemental by expending 2 Wild Shape uses"
		},
		"subclassfeature14" : {
			name : "Thousand Forms",
			source : [["P", 69]],
			minlevel : 14,
			description : "\n   " + "I can cast Alter Self at will without using a spell slot",
			spellcastingBonus : {
				name : "Thousand Forms",
				spells : ["alter self"],
				selection : ["alter self"],
				firstCol : "atwill"
			}
		}
	}
});
AddSubClass("fighter", "battle master", {
	regExpSearch : /^(?=.*(war|fighter|battle|martial))(?=.*master).*$/i,
	subname : "Battle Master",
	fullname : "Battle Master",
	source : [["P", 73]],
	abilitySave : 1,
	abilitySaveAlt : 2,
	features : {
		"subclassfeature3" : {
			name : "Combat Superiority",
			source : [["P", 73]],
			minlevel : 3,
			description : "\n   " + "I gain a number of superiority dice that I can use to fuel special Maneuvers" + "\n   " + "I regain all superiority dice after a short rest",
			additional : ["", "", "d8", "d8", "d8", "d8", "d8", "d8", "d8", "d10", "d10", "d10", "d10", "d10", "d10", "d10", "d10", "d12", "d12", "d12"],
			usages : [0, 0, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6],
			recovery : "short rest"
		},
		"subclassfeature3.1" : {
			name : "Maneuvers",
			source : [["P", 73]],
			minlevel : 3,
			description : "\n   " + 'Use the "Choose Feature" button above to add a Maneuver to the third page' + "\n   " + "I can use a Maneuver by expending a superiority die (only one Maneuver per attack)",
			additional : levels.map(function (n) {
				return n < 3 ? "" : (n < 7 ? 3 : n < 10 ? 5 : n < 15 ? 7 : 9) + " known";
			}),
			extraname : "Maneuver",
			extrachoices : ["Commander's Strike", "Disarming Attack", "Distracting Strike", "Evasive Footwork", "Feinting Attack", "Goading Attack", "Lunging Attack", "Maneuvering Attack", "Menacing Attack", "Parry", "Precision Attack", "Pushing Attack", "Rally", "Riposte", "Sweeping Attack", "Trip Attack"],
			extraTimes : levels.map(function (n) {
				return n < 3 ? 0 : n < 7 ? 3 : n < 10 ? 5 : n < 15 ? 7 : 9;
			}),
			"commander's strike" : {
				name : "Commander's Strike",
				source : [["P", 74]],
				description : "\n   " + "I forgo one attack of my Attack action to use a bonus action to direct an ally I see/hear" + "\n   " + "The ally can use a reaction to make an attack, adding the superiority die to damage",
				action : ["bonus action", " (with Attack action)"]
			},
			"disarming attack" : {
				name : "Disarming Attack",
				source : [["P", 74]],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "Target makes a Strength save or drops a held object of my choice to its feet"
			},
			"distracting strike" : {
				name : "Distracting Strike",
				source : [["P", 74]],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "The next attack of an ally before my next turn has adv. against the creature"
			},
			"evasive footwork" : {
				name : "Evasive Footwork",
				source : [["P", 74]],
				description : "\n   " + "Use when moving; I add the superiority die to my AC until I stop moving"
			},
			"feinting attack" : {
				name : "Feinting Attack",
				source : [["P", 74]],
				description : "\n   " + "As a bonus action, I can feint to gain adv. on my next attack this turn vs. a target in 5 ft" + "\n   " + "If the attack hits, I add the superiority die to my attack's damage",
				action : ["bonus action", ""]
			},
			"goading attack" : {
				name : "Goading Attack",
				source : [["P", 74]],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "Target makes a Wis save or has disadv. vs. other targets until the end of my next turn"
			},
			"lunging attack" : {
				name : "Lunging Attack",
				source : [["P", 74]],
				description : "\n   " + "I can spend a superiority die to increase the reach of a melee weapon attack by 5 ft" + "\n   " + "If the attack hits, I add the superiority die to my attack's damage"
			},
			"maneuvering attack" : {
				name : "Maneuvering Attack",
				source : [["P", 74]],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "Ally can use reaction to move half speed without opportunity attack from the target"

			},
			"menacing attack" : {
				name : "Menacing Attack",
				source : [["P", 74]],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "Target makes a Wisdom save or is frightened of me until the end of my next turn"
			},
			"parry" : {
				name : "Parry",
				source : [["P", 74]],
				description : "\n   " + "When damaged in melee, I can use a reaction to reduce it by superiority die + Dex mod",
				action : ["reaction", " (when damaged in melee)"]
			},
			"precision attack" : {
				name : "Precision Attack",
				source : [["P", 74]],
				description : "\n   " + "I add the superiority die to my attack roll, either before or after rolling"
			},
			"pushing attack" : {
				name : "Pushing Attack",
				source : [["P", 74]],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to the attack's damage" + "\n   " + "If target is Large or smaller, it must make a Strength save or be pushed up to 15 ft away"
			},
			"rally" : {
				name : "Rally",
				source : [["P", 74]],
				description : "\n   " + "Ally that can see/hear me gets temporary HP equal to superiority die + Charisma mod",
				action : ["bonus action", ""]
			},
			"riposte" : {
				name : "Riposte",
				source : [["P", 74]],
				description : "\n   " + "When missed in melee, I can use my reaction to make one melee attack vs. the attacker" + "\n   " + "If the attack hits, I add the superiority die to my attack's damage",
				action : ["reaction", " (after missed in melee)"]
			},
			"sweeping attack" : {
				name : "Sweeping Attack",
				source : [["P", 74]],
				description : "\n   " + "Use after hitting a creature and a second creature is within 5 ft of the first" + "\n   " + "If the original attack roll hits this second creature, it takes the superiority die in damage"
			},
			"trip attack" : {
				name : "Trip Attack",
				source : [["P", 74]],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to the attack's damage" + "\n   " + "If target is Large or smaller, it must make a Strength save or be knocked prone"
			}
		},
		"subclassfeature3.2" : {
			name : "Student of War",
			source : [["P", 73]],
			minlevel : 3,
			description : "\n   " + "I have proficiency with one artisan's tool set of my choice",
			toolProfs : [["Artisan's tools", 1]]
		},
		"subclassfeature7" : {
			name : "Know Your Enemy",
			source : [["P", 73]],
			minlevel : 7,
			description : "\n   " + "If I spend 1 min studying someone, the DM will tell me info about him/her"
		},
		"subclassfeature10" : {
			name : "Improved Combat Superiority",
			source : [["P", 74]],
			minlevel : 10,
			description : "\n   " + "My superiority dice turn into d10s at 10th level and into d12s at 18th level"
		},
		"subclassfeature15" : {
			name : "Relentless",
			source : [["P", 74]],
			minlevel : 15,
			description : "\n   " + "I regain one superiority die if I have no more remaining when I roll initiative"
		}
	}
});
AddSubClass("fighter", "eldritch knight", {
	regExpSearch : /^(?!.*(exalted|sacred|holy|divine|nature|natural|purple.*dragon|green|arcane archer))(?=.*(knight|fighter|warrior|militant|warlord|phalanx|gladiator|trooper))(?=.*\b(eldritch|arcane|magic|mage|witch)\b).*$/i,
	subname : "Eldritch Knight",
	fullname : "Eldritch Knight",
	source : [["P", 75]],
	abilitySave : 4,
	spellcastingFactor : 3,
	spellcastingList : {
		"class" : "wizard",
		school : ["Evoc", "Abjur"],
		level : [0, 4]
	},
	spellcastingKnown : {
		cantrips : [0, 0, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
		spells : [0, 0, 2, 3, 3, 3, 4, 4, 4, 5, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9]
	},
	features : {
		"action surge" : {
			name : "Action Surge",
			source : [["P", 72]],
			minlevel : 2,
			description : "\n   " + "I can take one additional action on my turn on top of my normally allowed actions",
			usages : [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2],
			recovery : "short rest",
			additional : ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "30 ft teleport", "30 ft teleport", "30 ft teleport", "30 ft teleport", "30 ft teleport", "30 ft teleport"]
		},
		"subclassfeature3" : {
			name : "Spellcasting",
			source : [["P", 75]],
			minlevel : 3,
			description : "\n   " + "I can cast known wizard cantrips/spells, using Intelligence as my spellcasting ability",
			additional : ["", "", "2 cantrips \u0026 3 spells known", "2 cantrips \u0026 4 spells known", "2 cantrips \u0026 4 spells known", "2 cantrips \u0026 4 spells known", "2 cantrips \u0026 5 spells known", "2 cantrips \u0026 6 spells known", "2 cantrips \u0026 6 spells known", "3 cantrips \u0026 7 spells known", "3 cantrips \u0026 8 spells known", "3 cantrips \u0026 8 spells known", "3 cantrips \u0026 9 spells known", "3 cantrips \u0026 10 spells known", "3 cantrips \u0026 10 spells known", "3 cantrips \u0026 11 spells known", "3 cantrips \u0026 11 spells known", "3 cantrips \u0026 11 spells known", "3 cantrips \u0026 12 spells known", "3 cantrips \u0026 13 spells known"],
			spellcastingBonus : { // the spells gained at level 3, 8, 14, 20
				name : "From any school",
				"class" : "wizard",
				times : [0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4],
				level : [1, 4]
			}
		},
		"subclassfeature3.1" : {
			name : "Weapon Bond",
			source : [["P", 75]],
			minlevel : 3,
			description : "\n   " + "I can bond with up to two weapons by spending a short rest with each" + "\n   " + "I can't be disarmed of a bonded weapon and I can summon one as a bonus action",
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "War Magic",
			source : [["P", 75]],
			minlevel : 7,
			description : "\n   " + "When I use my action to cast a cantrip, I can make a weapon attack as a bonus action",
			action : ["bonus action", ""]
		},
		"subclassfeature10" : {
			name : "Eldritch Strike",
			source : [["P", 75]],
			minlevel : 10,
			description : "\n   " + "A creature hit by my weapon attack has disadv. on the save vs. the next spell I cast" + "\n   " + "This lasts until the end of my next turn"
		},
		"subclassfeature15" : {
			name : "Arcane Charge",
			source : [["P", 75]],
			minlevel : 15,
			description : "\n   " + "When I use Action Surge, I can also teleport up to 30 ft to an empty space I can see" + "\n   " + "I can do so before or after the extra action"
		},
		"subclassfeature18" : {
			name : "Improved War Magic",
			source : [["P", 75]],
			minlevel : 18,
			description : "\n   " + "When I use my action to cast a spell, I can make a weapon attack as a bonus action",
			action : ["bonus action", ""]
		}
	}
});
AddSubClass("monk", "way of the four elements", {
	regExpSearch : /^(?=.*\b(four|4)\b)((?=.*elements?)|((?=.*earth)|(?=.*(wind|air))|(?=.*fire)|(?=.*water)))((?=.*(monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of the Four Elements",
	source : [["P", 80]],
	features : {
		"subclassfeature3" : {
			name : "Disciple of the Elements",
			source : [["P", 80]],
			minlevel : 3,
			description : "\n   " + "I know Elemental Attunement and additional Elemental Disciplines, depending on level" + "\n   " + 'Use the "Choose Feature" button above to add Elemental Disciplines to the third page' + "\n   " + "From 5th level onward, I can use additional ki points to increase their spell slot level" + "\n   " + "I can trade known Elemental Disciplines for others when I gain new ones",
			additional : levels.map(function (n) {
				return n < 3 ? "" : ((n < 6 ? 2 : n < 11 ? 3 : n < 17 ? 4 : 5) + " known; ") + (n < 5 ? 2 : n < 9 ? 3 : n < 13 ? 4 : n < 17 ? 5 : 6) + " max ki";
			}),
			extraname : "Elemental Discipline",
			extrachoices : ["Breath of Winter (prereq: level 17 monk)", "Clench of the North Wind (prereq: level 6 monk)", "Elemental Attunement", "Eternal Mountain Defense (prereq: level 17 monk)", "Fangs of the Fire Snake", "Fist of Four Thunders", "Fist of Unbroken Air", "Flames of the Phoenix (prereq: level 11 monk)", "Gong of the Summit (prereq: level 6 monk)", "Mist Stance (prereq: level 11 monk)", "Ride the Wind (prereq: level 11 monk)", "River of Hungry Flame (prereq: level 17 monk)", "Rush of the Gale Spirits", "Shape the Flowing River", "Sweeping Cinder Strike", "Water Whip", "Wave of Rolling Earth (prereq: level 17 monk)"],
			extraTimes : levels.map(function (n) {
				return n < 3 ? 0 : n < 6 ? 2 : n < 11 ? 3 : n < 17 ? 4 : 5;
			}),
			autoSelectExtrachoices : [{ extrachoice : "elemental attunement" }],
			"elemental attunement" : {
				name : "Elemental Attunement",
				source : [["P", 81]],
				description : "\n   " + "As an action, I can briefly control elemental forces within 30 ft of me" + "\n   " + "I can make a harmless sensory effect, light/snuff light, chill/warm 1 lb for 1 hour," + "\n   " + "or I cause earth/fire/water/mist in a 1 ft cube to shape itself into a form for 1 minute",
				action : ["action", ""]
			},
			"breath of winter (prereq: level 17 monk)" : {
				name : "Breath of Winter",
				source : [["P", 81]],
				description : " [6 ki points]" + "\n   " + "As an action, I can cast Cone of Cold without material components",
				spellcastingBonus : {
					name : "Breath of Winter",
					spells : ["cone of cold"],
					selection : ["cone of cold"],
					firstCol : 6
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 17; },
				spellChanges : {
					"cone of cold" : {
						components : "V,S",
						compMaterial : "",
						allowUpCasting : false,
						changes : "With the Breath of Winter discipline, I can cast Cone of Cold without a material component."
					}
				}
			},
			"clench of the north wind (prereq: level 6 monk)" : {
				name : "Clench of the North Wind",
				source : [["P", 81]],
				description : " [3 ki points]" + "\n   " + "As an action, I can cast Hold Person without material components",
				spellcastingBonus : {
					name : "Clench of the North Wind",
					spells : ["hold person"],
					selection : ["hold person"],
					firstCol : 3
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 6; },
				spellChanges : {
					"hold person" : {
						components : "V,S",
						compMaterial : "",
						allowUpCasting : false,
						changes : "With the Clench of the North Wind discipline, I can cast Hold Person without a material component."
					}
				}
			},
			"eternal mountain defense (prereq: level 17 monk)" : { // errata from level 11 to level 17
				name : "Eternal Mountain Defense",
				source : [["P", 81]],
				description : " [5 ki points]" + "\n   " + "As an action, I can cast Stoneskin on myself without material components",
				spellcastingBonus : {
					name : "Eternal Mountain Defense",
					spells : ["stoneskin"],
					selection : ["stoneskin"],
					firstCol : 5
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 17; },
				spellChanges : {
					"stoneskin" : {
						range : "Self",
						components : "V,S",
						compMaterial : "",
						description : "I gain resistance to nonmagical Bludgeoning, Piercing, and Slashing damage",
						changes : "With the Eternal Mountain Defense discipline, I can cast Stoneskin without a material component but only on myself."
					}
				}
			},
			"fangs of the fire snake" : {
				name : "Fangs of the Fire Snake",
				source : [["P", 81]],
				description : " [1 ki point]" + "\n   " + "With Attack action, my unarmed strikes +10 ft reach and deal fire damage this turn" + "\n   " + "Also, I can spent an additional 1 ki point to cause an attack to deal +1d10 fire damage",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (v.baseWeaponName == "unarmed strike" && (/^(?=.*fire)(?=.*snake).*$/i).test(v.WeaponTextName)) {
								fields.Description += (fields.Description ? '; ' : '') + 'After hit, spend 1 ki point for +1d10 fire damage';
								fields.Range = 'Melee (15 ft reach)';
								fields.Damage_Type = 'fire';
							};
						},
						"If I include the words 'Fire Snake' in the name of an unarmed strike, it gets +10 ft reach, does fire damage, and gains the option to deal +1d10 fire damage by spending 1 additional ki point."
					]
				}
			},
			"fist of four thunders" : {
				name : "Fist of Four Thunders",
				source : [["P", 81]],
				description : " [2 ki points]" + "\n   " + "As an action, I can cast Thunderwave",
				spellcastingBonus : {
					name : "Fist of Four Thunders",
					spells : ["thunderwave"],
					selection : ["thunderwave"],
					firstCol : 2
				},
				spellFirstColTitle : "Ki",
				spellChanges : {
					"thunderwave" : {
						allowUpCasting : false,
						changes : "With the Fist of Four Thunders discipline, I can cast Thunderwave."
					}
				}
			},
			"fist of unbroken air" : {
				name : "Fist of Unbroken Air",
				source : [["P", 81]],
				description : " [2 ki points; +1d10/extra ki point]" + "\n   " + "As an action, target within 30 ft takes 3d10 bludgeoning damage (spend ki for more)" + "\n   " + "It is also pushed up to 20 ft away from me and knocked prone" + "\n   " + "It can make a Strength save to halve damage and avoid being pushed and knocked prone",
				action : ["action", ""]
			},
			"flames of the phoenix (prereq: level 11 monk)" : {
				name : "Flames of the Phoenix",
				source : [["P", 81]],
				description : " [4 ki points]" + "\n   " + "As an action, I can cast Fireball without material components",
				spellcastingBonus : {
					name : "Flames of the Phoenix",
					spells : ["fireball"],
					selection : ["fireball"],
					firstCol : 4
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 11; },
				spellChanges : {
					"fireball" : {
						components : "V,S",
						compMaterial : "",
						allowUpCasting : false,
						changes : "With the Flames of the Phoenix discipline, I can cast Fireball without a material component."
					}
				}
			},
			"gong of the summit (prereq: level 6 monk)" : {
				name : "Gong of the Summit",
				source : [["P", 81]],
				description : " [3 ki points]" + "\n   " + "As an action, I can cast Shatter without material components",
				spellcastingBonus : {
					name : "Gong of the Summit",
					spells : ["shatter"],
					selection : ["shatter"],
					firstCol : 3
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 6; },
				spellChanges : {
					"shatter" : {
						components : "V,S",
						compMaterial : "",
						allowUpCasting : false,
						changes : "With the Gong of the Summit discipline, I can cast Shatter without a material component."
					}
				}
			},
			"mist stance (prereq: level 11 monk)" : {
				name : "Mist Stance",
				source : [["P", 81]],
				description : " [4 ki points]" + "\n   " + "As an action, I can cast Gaseous Form on myself without material components",
				spellcastingBonus : {
					name : "Mist Stance",
					spells : ["gaseous form"],
					selection : ["gaseous form"],
					firstCol : 4
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 11; },
				spellChanges : {
					"gaseous form" : {
						range : "Self",
						components : "V,S",
						compMaterial : "",
						description : "I turn into a misty cloud with fly 10 ft, resist. to nonmagical dmg, adv. on Str/Dex/saves",
						changes : "With the Mist Stance discipline, I can cast Gaseous Form without a material component, but only on myself."
					}
				}
			},
			"ride the wind (prereq: level 11 monk)" : {
				name : "Ride the Wind",
				source : [["P", 81]],
				description : " [4 ki points]" + "\n   " + "As an action, I can cast Fly on myself without material components",
				spellcastingBonus : {
					name : "Ride the Wind",
					spells : ["fly"],
					selection : ["fly"],
					firstCol : 4
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 11; },
				spellChanges : {
					"fly" : {
						range : "Self",
						components : "V,S",
						compMaterial : "",
						description : "I gain 60 ft flying speed",
						changes : "With the Ride the Wind discipline, I can cast Fly without a material component but only on myself."
					}
				}
			},
			"river of hungry flame (prereq: level 17 monk)" : {
				name : "River of Hungry Flame",
				source : [["P", 81]],
				description : " [5 ki points]" + "\n   " + "As an action, I can cast Wall of Fire without material components",
				spellcastingBonus : {
					name : "River of Hungry Flame",
					spells : ["wall of fire"],
					selection : ["wall of fire"],
					firstCol : 5
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 17; },
				spellChanges : {
					"wall of fire" : {
						components : "V,S",
						compMaterial : "",
						allowUpCasting : false,
						changes : "With the River of Hungry Flame discipline, I can cast Wall of Fire without a material component."
					}
				}
			},
			"rush of the gale spirits" : {
				name : "Rush of the Gale Spirits",
				source : [["P", 81]],
				description : " [2 ki points]" + "\n   " + "As an action, I can cast Gust of Wind without material components",
				spellcastingBonus : {
					name : "Rush of the Gale Spirits",
					spells : ["gust of wind"],
					selection : ["gust of wind"],
					firstCol : 2
				},
				spellFirstColTitle : "Ki",
				spellChanges : {
					"gust of wind" : {
						components : "V,S",
						compMaterial : "",
						changes : "With the Rush of the Gale Spirits discipline, I can cast Gust of Wind without a material component."
					}
				}
			},
			"shape the flowing river" : {
				name : "Shape the Flowing River",
				source : [["P", 81]],
				description : " [1 ki point]" + "\n   " + "As an action, I can affect ice/water up to a 30-foot cube within 120 ft" + "\n   " + "I can switch it between water/ice states and reshape ice up to half its largest dimension",
				action : ["action", ""]
			},
			"sweeping cinder strike" : {
				name : "Sweeping Cinder Strike",
				source : [["P", 81]],
				description : " [2 ki points]" + "\n   " + "As an action, I can cast Burning Hands",
				spellcastingBonus : {
					name : "Sweeping Cinder Strike",
					spells : ["burning hands"],
					selection : ["burning hands"],
					firstCol : 2
				},
				spellFirstColTitle : "Ki",
				spellChanges : {
					"burning hands" : {
						components : "V,S",
						compMaterial : "",
						allowUpCasting : false,
						changes : "With the Sweeping Cinder Strike discipline, I can cast Burning Hands."
					}
				}
			},
			"water whip" : {
				name : "Water Whip",
				source : [["P", 81]],
				description : " [2 ki points; +1d10/extra ki point]" + "\n   " + "As an action, a creature within 30 ft takes 3d10 bludgeoning damage (spend ki for more)" + "\n   " + "It is also knocked prone or pulled up to 25 ft closer to me (my choice)" + "\n   " + "It can make a Dexterity save to halve damage and avoid being pulled or knocked prone",
				action : ["action", ""]
			},
			"wave of rolling earth (prereq: level 17 monk)" : {
				name : "Wave of Rolling Earth",
				source : [["P", 81]],
				description : " [6 ki points]" + "\n   " + "As an action, I can cast Wall of Stone without material components",
				spellcastingBonus : {
					name : "Wave of Rolling Earth",
					spells : ["wall of stone"],
					selection : ["wall of stone"],
					firstCol : 6
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 17; },
				spellChanges : {
					"wall of stone" : {
						components : "V,S",
						compMaterial : "",
						changes : "With the Wave of Rolling Earth discipline, I can cast Wall of Stone without a material component."
					}
				}
			}
		}
	}
});
AddSubClass("monk", "way of shadow", {
	regExpSearch : /^(?=.*shadow)((?=.*(monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of Shadow",
	source : [["P", 80]],
	features : {
		"subclassfeature3" : {
			name : "Shadow Arts",
			source : [["P", 80]],
			minlevel : 3,
			description : "\n   " + "I know the Minor Illusion cantrip and can cast certain spells by using ki (see page 3)",
			spellcastingBonus : {
				name : "Shadow Arts",
				spells : ["minor illusion"],
				selection : ["minor illusion"],
				firstCol : "atwill"
			},
			spellFirstColTitle : "Ki",
			"shadow spells" : {
				name : "Shadow Spells",
				extraname : "Shadow Arts",
				source : [["P", 80]],
				description : " [2 ki points]" + "\n   " + "As an action, I can cast Darkness, Darkvision, Pass Without Trace, or Silence" + "\n   " + "I don't require spell slots or material components to cast these spells like this, just ki points",
				action : ["action", ""],
				spellcastingBonus : {
					name : "Shadow Arts",
					spells : ["darkness", "darkvision", "pass without trace", "silence"],
					selection : ["darkness", "darkvision", "pass without trace", "silence"],
					firstCol : 2,
					times : 4
				}
			},
			autoSelectExtrachoices : [{ extrachoice : "shadow spells" }],
			spellChanges : {
				"darkness" : {
					components : "V",
					compMaterial : "",
					changes : "Spell cast with my Shadow Arts don't require material components."
				},
				"darkvision" : {
					components : "V,S",
					compMaterial : "",
					changes : "Spell cast with my Shadow Arts don't require material components."
				},
				"pass without trace" : {
					components : "V,S",
					compMaterial : "",
					changes : "Spell cast with my Shadow Arts don't require material components."
				}
			}
		},
		"subclassfeature6" : {
			name : "Shadow Step",
			source : [["P", 80]],
			minlevel : 6,
			description : "\n   " + "As a bonus action, I can teleport from and into dim light or darkness within 60 ft" + "\n   " + "After I do this, I have adv. on the next melee attack I make before the end of my turn",
			action : ["bonus action", ""]
		},
		"subclassfeature11" : {
			name : "Cloak of Shadows",
			source : [["P", 80]],
			minlevel : 11,
			description : "\n   " + "As an action, I can become invisible in dim light or darkness until I attack/cast",
			action : ["action", ""]
		},
		"subclassfeature17" : {
			name : "Opportunist",
			source : [["P", 80]],
			minlevel : 17,
			description : "\n   " + "As a reaction, if a creature in 5 ft is hit by another, I can make a melee attack vs. it",
			action : ["reaction", ""]
		}
	}
});
AddSubClass("paladin", "oath of the ancients", {
	regExpSearch : /^(((?=.*(ancient|nature|natural|green|fey|horned))((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper)))))|((?=.*(green|fey|horned))(?=.*(knight|fighter|warrior|warlord|trooper)))).*$/i,
	subname : "Oath of the Ancients",
	source : [["P", 87]],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Nature's Wrath",
			source : [["P", 87]],
			minlevel : 3,
			description : "\n   " + "As an action, a creature I can see within 10 ft must make a Str/Dex save (its choice)" + "\n   " + "If it fails this save, it is restrained until it succeeds on a save at the end of its turn",
			action : ["action", ""],
			spellcastingExtra : ["ensnaring strike", "speak with animals", "moonbeam", "misty step", "plant growth", "protection from energy", "ice storm", "stoneskin", "commune with nature", "tree stride"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Turn the Faithless",
			source : [["P", 87]],
			minlevel : 3,
			description : "\n   " + "As an action, all fey/fiends within 30 ft that can hear me must make a Wisdom save" + "\n   " + "If one fails, it is turned for 1 minute or until it takes damage and must show true form" + "\n   " + "Turned: move away, never within 30 ft of me, no reactions or actions other than Dash" + "\n   " + "Turned: may Dodge instead of Dash when nowhere to move and unable to escape bonds",
			action : ["action", ""]
		},
		"subclassfeature7" : {
			name : "Aura of Warding",
			source : [["P", 87]],
			minlevel : 7,
			description : "\n   " + "Allies within range and I have resistance to damage from spells",
			additional : ["", "", "", "", "", "", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "30-foot aura", "30-foot aura", "30-foot aura"],
			dmgres : ["Spells"]
		},
		"subclassfeature15" : {
			name : "Undying Sentinel",
			source : [["P", 87]],
			minlevel : 15,
			description : "\n   " + "If dropped to 0 hit points and not killed outright, I can choose to stay at 1 hit point" + "\n   " + "Additionally, I suffer no drawbacks of old age and can't be aged magically",
			recovery : "long rest",
			usages : 1
		},
		"subclassfeature20" : {
			name : "Elder Champion",
			source : [["P", 87]],
			minlevel : 20,
			description : desc([
				"As an action, I assume the form of a force of nature for 1 minute and gain benefits:",
				" \u2022 At the start of each of my turns, I regain 10 hit points",
				" \u2022 I can cast paladin spells with a casting time of 1 action as a bonus action instead",
				" \u2022 Enemies within 10 ft have disadv. on saves vs. my paladin spells and channel divinity"
			]),
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("paladin", "oath of vengeance", {
	regExpSearch : /^(((?=.*(vengeance|wrath|justice))((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper)))))|((?=.*dark)(?=.*knight))|(?=.*avenger)).*$/i,
	subname : "Oath of Vengeance",
	source : [["P", 88]],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Abjure Enemy",
			source : [["P", 88]],
			minlevel : 3,
			description : "\n   " + "As an action, one creature within 60 ft that I can see me must make a Wisdom save" + "\n   " + "If failed, it is frightened and its speed is 0 despite bonuses; if success, its speed is halved" + "\n   " + "This lasts for 1 minute or until it takes damage; Undead/fiends have disadv. on save",
			action : ["action", ""],
			spellcastingExtra : ["bane", "hunter's mark", "hold person", "misty step", "haste", "protection from energy", "banishment", "dimension door", "hold monster", "scrying"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Vow of Enmity",
			source : [["P", 88]],
			minlevel : 3,
			description : "\n   " + "As a bonus action, I utter a vow against a creature I can see within 10 ft" + "\n   " + "I get adv. on attacks against it for 1 minute or until it drops to 0 HP or falls unconscious",
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Relentless Avenger",
			source : [["P", 88]],
			minlevel : 7,
			description : "\n   " + "After I hit with an opportunity attack, I can move 1/2 my speed in the same reaction" + "\n   " + "This movement doesn't provoke opportunity attacks"
		},
		"subclassfeature15" : {
			name : "Soul of Vengeance",
			source : [["P", 88]],
			minlevel : 15,
			description : "\n   " + "When an enemy I have an active Vow of Enmity against makes an attack, I can react" + "\n   " + "As a reaction, I can make a melee weapon attack against it if it is within range",
			action : ["reaction", " (with Vow of Enmity)"]
		},
		"subclassfeature20" : {
			name : "Avenging Angel",
			source : [["P", 88]],
			minlevel : 20,
			description : desc([
				"As an action, I gain a flying speed of 60 ft and a 30 ft aura of menace for 1 hour",
				"When a creature first enters or starts its turn in the aura, it must make a Wis save",
				"If failed, for 1 min or until it takes damage, it is frightened and attacks vs. it have adv."
			]),
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("ranger", "beast master", {
	regExpSearch : /^(?=.*(animal|beast))((?=.*(master|ranger|strider))|((?=.*(nature|natural|green))(?=.*(knight|fighter|warrior|warlord|trooper)))).*$/i,
	subname : "Beast Master",
	fullname : "Beast Master",
	source : [["P", 93]],
	features : {
		"subclassfeature3" : {
			name : "Ranger's Companion",
			source : [["P", 93]],
			minlevel : 3,
			description : desc([
				"It adds my proficiency bonus to AC, attacks, damage, and save/skill proficiencies",
				"Its hit point maximum equals four times my ranger level if higher than its normal HP",
				"It takes a turn on my initiative; It takes the Dodge action unless I command it otherwise",
				"As an action, I can have it take the Attack, Dash, Disengage, or Help action on its turn",
				"I can still use Extra Attack while commanding it to Attack; No action to order to move"
			]),
			additional : "Medium or smaller beast, CR \u00BC or less",
			creaturesAdd : [["Ranger's Companion", false, function(AddRemove, prefix) {
				if (!AddRemove) return;
				var cObj = MakeCompMenu_CompOptions(prefix, "justCompanions");
				if (!cObj.companion || !cObj.companion.length) {
					var selectedRace = "Wolf";
				} else {
					var compOptions = cObj.companion.map(function(n) { return n[0] });
					var selectedRace = AskUserOptions("Select Ranger's Companion", "Select which beast you would like to have as your ranger's companion.\nThis can be any beast that is no larger than Medium and that has a challenge rating of 1/4 or lower.\nYou can change the beast at any time using the \"Companion Options\" button at the top of the Companion page.", compOptions, "radio", true);
				}
				ApplyCompRace(selectedRace, prefix, "companion");
			}]]
		},
		"subclassfeature7" : {
			name : "Exceptional Training",
			source : [["P", 93]],
			minlevel : 7,
			description : desc([
				"My beast's attacks count as magical for overcoming resistances and immunities",
				"As a bonus action, I can command it to take the Dash/Disengage/Help action on its turn"
			])
		},
		"subclassfeature11" : {
			name : "Bestial Fury",
			source : [["P", 93]],
			minlevel : 11,
			description : "\n   " + "When I command my beast to use the Attack action, it can attack twice on its turn"
		},
		"subclassfeature15" : {
			name : "Share Spells",
			source : [["P", 93]],
			minlevel : 15,
			description : "\n   " + "When I cast a spell on myself, I can have it also affect my beast if it is within 30 ft"
		}
	}
});
AddSubClass("rogue", "arcane trickster", {
	regExpSearch : /^(?=.*(trickster|rogue|miscreant))(?=.*\b(eldritch|arcane|magic|mage|witch)\b).*$/i,
	subname : "Arcane Trickster",
	fullname : "Arcane Trickster",
	source : [["P", 98]],
	abilitySave : 4,
	spellcastingFactor : 3,
	spellcastingList : {
		"class" : "wizard",
		school : ["Ench", "Illus"],
		level : [0, 4]
	},
	spellcastingKnown : {
		cantrips : [0, 0, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
		spells : [0, 0, 2, 3, 3, 3, 4, 4, 4, 5, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9]
	},
	features : {
		"subclassfeature3" : {
			name : "Spellcasting",
			source : [["P", 98]],
			minlevel : 3,
			description : "\n   " + "I can cast known wizard cantrips/spells, using Intelligence as my spellcasting ability",
			additional : ["", "", "3 cantrips \u0026 3 spells known", "3 cantrips \u0026 4 spells known", "3 cantrips \u0026 4 spells known", "3 cantrips \u0026 4 spells known", "3 cantrips \u0026 5 spells known", "3 cantrips \u0026 6 spells known", "3 cantrips \u0026 6 spells known", "4 cantrips \u0026 7 spells known", "4 cantrips \u0026 8 spells known", "4 cantrips \u0026 8 spells known", "4 cantrips \u0026 9 spells known", "4 cantrips \u0026 10 spells known", "4 cantrips \u0026 10 spells known", "4 cantrips \u0026 11 spells known", "4 cantrips \u0026 11 spells known", "4 cantrips \u0026 11 spells known", "4 cantrips \u0026 12 spells known", "4 cantrips \u0026 13 spells known"],
			spellcastingBonus : [{
				name : "Mage Hand cantrip", // the Mage Hand cantrip gained at level 1
				spells : ["mage hand"],
				selection : ["mage hand"]
			}, {
				name : "From any school", // the spells gained at level 3, 8, 14, 20
				"class" : "wizard",
				times : [0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4],
				level : [1, 4]
			}]
		},
		"subclassfeature3.1" : {
			name : "Mage Hand Legerdemain",
			source : [["P", 98]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can direct my Mage Hand",
				"With a Dex (Sleight of Hand) vs. Wis (Perception) checks, I can do so discreetly",
				"I can make it invisible and perform the following tasks:",
				" \u2022 Stow/retrieve an object the hand is holding in a container worn/carried by another",
				" \u2022 Use thieves' tools to pick locks and disarm traps at range"
			]),
			action : ["bonus action", ""],
			spellChanges : {
				"mage hand" : {
					description : "Invisible hand, carries 10 lb; 1 bns to control, use thieves' tools, or stow/retrieve obj; only 1 instance",
					changes : "My Mage Hand Legerdemain class feature expands my use of the Mage Hand cantrip and makes the spectral hand invisible."
				}
			}
		},
		"subclassfeature9" : {
			name : "Magical Ambush",
			source : [["P", 98]],
			minlevel : 9,
			description : "\n   " + "When I cast a spell while hidden, the target(s) have disadvantage against that spell"
		},
		"subclassfeature13" : {
			name : "Versatile Trickster",
			source : [["P", 98]],
			minlevel : 13,
			description : "\n   " + "As a bonus action, gain adv. on attacks this turn on creature within 5 ft of Mage Hand",
			action : ["bonus action", ""]
		},
		"subclassfeature17" : {
			name : "Spell Thief",
			source : [["P", 98]],
			minlevel : 17,
			description : "\n   " + "As a reaction, after a spell is cast at me, I can try to negate and steal it" + "\n   " + "The caster makes a save against my spell DC with his/her spellcasting ability" + "\n   " + "On failure, the caster forgets how to cast that spell for eight hours" + "\n   " + "If I have a spell slot of a high enough level for it, I learn how to cast it during this time",
			action : ["reaction", ""],
			recovery : "long rest",
			usages : 1
		}
	}
});
AddSubClass("rogue", "assassin", {
	regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*assassin).*$/i,
	subname : "Assassin",
	fullname : "Assassin",
	source : [["P", 97]],
	abilitySave : 2,
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : [["P", 97]],
			minlevel : 3,
			description : "\n   " + "I am proficient with disguise kits and poisoner's kits",
			toolProfs : ["Disguise kit", "Poisoner's kit"]
		},
		"subclassfeature3.1" : {
			name : "Assassinate",
			source : [["P", 97]],
			minlevel : 3,
			description : "\n   " + "I have adv. on attack rolls against creatures that have not taken a turn in combat yet" + "\n   " + "Any hit I score against a creature that is surprised is a critical hit"
		},
		"subclassfeature9" : {
			name : "Infiltration Expertise",
			source : [["P", 97]],
			minlevel : 9,
			description : "\n   " + "I can create false identities in 7 days for 25 gp"
		},
		"subclassfeature13" : {
			name : "Imposter",
			source : [["P", 97]],
			minlevel : 13,
			description : "\n   " + "After 3 hours of studying a person, I can mimic speech, writing, and behavior" + "\n   " + "I have advantage on Charisma (Deception) checks to maintain this ruse"
		},
		"subclassfeature17" : {
			name : "Death Strike",
			source : [["P", 97]],
			minlevel : 17,
			description : "\n   " + "When I hit a surprised creature, it must make a Con save or take double damage",
			additional : "Save DC: 8 + Dex mod + Proficiency bonus"
		}
	}
});
AddSubClass("sorcerer", "wild magic", {
	regExpSearch : /^(?=.*(mage|magus|sorcerer|witch))(?=.*(wild|chaos|chaotic|limbo)).*$/i,
	subname : "Wild Magic",
	fullname : "Wild Mage",
	source : [["P", 103]],
	features : {
		"subclassfeature1" : {
			name : "Wild Magic Surge",
			source : [["P", 103]],
			minlevel : 1,
			description : desc([
				"Wild Magic Surges can happen 5% of the time that I cast a sorcerer spell",
				"This doesn't happen with cantrips and I only take this chance if the DM tells me to",
				"Metamagic can't affect spells cast because of the surge, but they require no concentration",
				"See the \"Notes\" page for the table"
			]),
			toNotesPage : [{
				name : "Wild Magic Surge Table",
				source : [["P", 104]],
				popupName : "Wild Mage's Wild Magic Surge Table, part 1",
				additional : "results 01-50",
				note : [
					"My spellcasting can unleash surges of untamed magic. Immediately after I cast a sorcerer spell of 1st level or higher, the DM can have me roll a d20. If I roll a 1, a Wild Magic Surge happens. Roll on the table below to create a random magical effect. A surge can happen only once per turn.",
					"If a Wild Magic effect is a spell, it's too wild to be affected by Metamagic. If it normally requires concentration, it doesn't require concentration in this case; the spell lasts for its full duration.",
					"d100  Effect",
					"01-02 Roll on this table at the start of each of your turns for the next minute, ignoring this result on subsequent rolls.",
					"03-04 For the next minute, you can see any invisible creature if you have line of sight to it.",
					"05-06 A modron chosen and controlled by the DM appears in an unoccupied space within 5 ft of you, then disappears 1 minute later.",
					"07-08 You cast fireball as a 3rd-level spell centered on yourself.",
					"09-10 You cast magic missile as a 5th-level spell.",
					"11-12 Roll a d10. Your height changes by a number of inches equal to the roll. If the roll is odd, you shrink. If the roll is even, you grow.",
					"13-14 You cast confusion centered on yourself.",
					"15-16 For the next minute, you regain 5 hit points at the start of each of your turns.",
					"17-18 You grow a long beard made of feathers that remains until you sneeze, at which point the feathers explode out from your face.",
					"19-20 You cast grease centered on yourself.",
					"21-22 Creatures have disadvantage on saving throws against the next spell you cast in the next minute that involves a saving throw.",
					"23-24 Your skin turns a vibrant shade of blue. A remove curse spell can end this effect.",
					"25-26 An eye appears on your forehead for the next minute.",
					"27-28 For the next minute, all your spells with a casting time feet of 1 action have a casting time of 1 bonus action.",
					"29-30 You teleport up to 60 ft to an unoccupied space of your choice that you can see.",
					"31-32 You are transported to the Astral Plane until the end of your next turn, after which time you return to the space you previously occupied or the nearest unoccupied space if that space is occupied.",
					"33-34 Maximize the damage of the next damaging spell you cast within the next minute.",
					"35-36 Roll a d10. Your age changes by a number of years equal to the roll. If the roll is odd, you get younger (minimum 1 year old). If the roll is even, you get older.",
					"37-38 1d6 flumphs controlled by the DM appear in unoccupied spaces within 60 ft of you and are frightened of you. They vanish after 1 minute.",
					"39-40 You regain 2d10 hit points.",
					"41-42 You turn into a potted plant until the start of your next turn. While a plant, you are incapacitated and have vulnerability to all damage. If you drop to 0 hit points, your pot breaks, and your form reverts.",
					"43-44 For the next minute, you can teleport up to 20 ft as a bonus action on each of your turns.",
					"45-46 You cast levitate on yourself.",
					"47-48 A unicorn controlled by the DM appears in a space within 5 ft of you, then disappears 1 minute later.",
					"49-50 You can't speak for the next minute. Whenever you try, pink bubbles float out of your mouth."
				]
			}, {
				name : "Wild Magic Surge Table",
				source : [["P", 104]],
				popupName : "Wild Mage's Wild Magic Surge Table, part 2",
				additional : "results 51-100",
				note : [
					"d100  Effect",
					"51-52 A spectral shield hovers near you for the next minute, granting you a +2 bonus to AC and immunity to magic missile.",
					"53-54 You are immune to being intoxicated by alcohol for the next 5d6 days.",
					"55-56 Your hair falls out but grows back within 24 hours.",
					"57-58 For the next minute, any flammable object you touch that isn't being worn or carried by another creature bursts into flame.",
					"59-60 You regain your lowest-level expended spell slot.",
					"61-62 For the next minute, you must shout when you speak.",
					"63-64 You cast fog cloud centered on yourself.",
					"65-66 Up to three creatures you choose within 30 ft of you take 4d10 lightning damage.",
					"67-68 You are frightened by the nearest creature until the end of your next turn.",
					"69-70 Each creature within 30 ft of you becomes invisible for the next minute. The invisibility ends on a creature when it attacks or casts a spell.",
					"71-72 You gain resistance to all damage for the next minute.",
					"73-74 A random creature within 60 ft of you becomes poisoned for 1d4 hours.",
					"75-76 You glow with bright light in a 30-ft radius for the next minute. Any creature that ends its turn within 5 ft of you is blinded until the end of its next turn.",
					"79-80 Illusory butterflies and flower petals flutter in the air within 10 ft of you for the next minute.",
					"77-78 You cast polymorph on yourself. If you fail the saving throw, you turn into a sheep for the spell's duration.",
					"81-82 You can take one additional action immediately.",
					"83-84 Each creature within 30 ft of you takes 1d10 necrotic damage. You regain hit points equal to the sum of the necrotic damage dealt.",
					"85-86 You cast mirror image.",
					"87-88 You cast fly on a random creature within 60 ft of you.",
					"89-90 You become invisible for the next minute. During that time, other creatures can't hear you. The invisibility ends if you attack or cast a spell.",
					"91-92 If you die within the next minute, you immediately come back to life as if by the reincarnate spell.",
					"93-94 Your size increases by one size category for the next minute.",
					"95-96 You and all creatures within 30 ft of you gain vulnerability to piercing damage for the next minute.",
					"97-98 You are surrounded by faint, ethereal music for the next minute.",
					"99-100 You regain all expended sorcery points."
				]
			}]
		},
		"subclassfeature1.1" : {
			name : "Tides of Chaos",
			source : [["P", 103]],
			minlevel : 1,
			description : "\n   " + "I can gain advantage on either one attack roll, ability check, or saving throw" + "\n   " + "After I cast a 1st-level or higher sorcerer spell, the DM can impose a Wild Magic Surge" + "\n   " + "After I roll on the Wild Magic Surge table, I regain my use of Tides of Chaos",
			recovery : "long rest",
			usages : 1
		},
		"subclassfeature6" : {
			name : "Bend Luck",
			source : [["P", 103]],
			minlevel : 6,
			description : "\n   " + "As a reaction, I can add/subtract 1d4 from another's attack roll, ability check, or save",
			action : ["reaction", " (2 sorcery points)"],
			additional : "2 sorcery points"
		},
		"subclassfeature14" : {
			name : "Controlled Chaos",
			source : [["P", 103]],
			minlevel : 14,
			description : "\n   " + "Whenever I roll on the Wild Magic Surge table, I can roll twice and use either result"
		},
		"subclassfeature18" : {
			name : "Spell Bombardment",
			source : [["P", 103]],
			minlevel : 18,
			description : "\n   " + "Once per turn, when I roll spell damage, I can take one damage die that rolled max" + "\n   " + "I can then roll this die again and add it to the spell's damage"
		}
	}
});
AddSubClass("warlock", "the archfey", {
	regExpSearch : /^(?=.*fey)(?=.*warlock).*$/i,
	subname : "the Archfey",
	source : [["P", 109]],
	spellcastingExtra : ["faerie fire", "sleep", "calm emotions", "phantasmal force", "blink", "plant growth", "dominate beast", "greater invisibility", "dominate person", "seeming"],
	features : {
		"subclassfeature1" : {
			name : "Fey Presence",
			source : [["P", 109]],
			minlevel : 1,
			description : "\n   " + "As an action, all creatures in a 10-ft cube around me must make a Wisdom save" + "\n   " + "If failed, they're all charmed or frightened (my choice) until the end of my next turn",
			recovery : "short rest",
			usages : 1,
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Misty Escape",
			source : [["P", 109]],
			minlevel : 6,
			description : "\n   " + "As a reaction, when I take damage, I can turn invisible and teleport up to 60 ft" + "\n   " + "I stay invisible until the start of my next turn or until I attack or cast a spell",
			action : ["reaction", " (taking damage)"],
			recovery : "short rest",
			usages : 1
		},
		"subclassfeature10" : {
			name : "Beguiling Defenses",
			source : [["P", 109]],
			minlevel : 10,
			description : "\n   " + "As a reaction, when a creature tries to charm me, I can turn the charm back on it" + "\n   " + "It must make a Wis save or be charmed by me for 1 minute or until taking damage" + "\n   " + "I am immune to being charmed",
			action : ["reaction", " (when charmed)"],
			savetxt : { immune : ["charmed"] }
		},
		"subclassfeature14" : {
			name : "Dark Delirium",
			source : [["P", 109]],
			minlevel : 14,
			description : "\n   " + "As an action, a creature within 60 ft must make a Wis save or be charmed/frightened" + "\n   " + "This lasts for 1 minute or until my concentration is broken or it takes damage" + "\n   " + "During this time, it can't see or hear anything but the illusion, me, and itself",
			recovery : "short rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("warlock", "the great old one", {
	regExpSearch : /^(((?=.*(tharizdun|cthulhu))(?=.*warlock))|((?=.*(great|dread))(?=.*(ancient|old))(?=.*\b(one|entity)\b))).*$/i,
	subname : "the Great Old One",
	source : [["P", 110]],
	spellcastingExtra : ["dissonant whispers", "tasha's hideous laughter", "detect thoughts", "phantasmal force", "clairvoyance", "sending", "dominate beast", "evard's black tentacles", "dominate person", "telekinesis"],
	features : {
		"subclassfeature1" : {
			name : "Awakened Mind",
			source : [["P", 110]],
			minlevel : 1,
			description : "\n   " + "I can telepathically speak to creatures I can see within 30 ft if they know a language" // 'to' not 'with', so one-way
		},
		"subclassfeature6" : {
			name : "Entropic Ward",
			source : [["P", 110]],
			minlevel : 6,
			description : "\n   " + "As a reaction, when I'm attacked, I can impose disadvantage to that attack roll" + "\n   " + "If it misses me, I have adv. on my next attack vs. the attacker during my next turn",
			action : ["reaction", " (when attacked)"],
			recovery : "short rest",
			usages : 1
		},
		"subclassfeature10" : {
			name : "Thought Shield",
			source : [["P", 110]],
			minlevel : 10,
			description : "\n   " + "No one can read my mind unless I allow it; I have resistance to psychic damage" + "\n   " + "When I take psychic damage, the dealer of the psychic damage takes the same amount",
			dmgres : ["Psychic"]
		},
		"subclassfeature14" : {
			name : "Create Thrall",
			source : [["P", 110]],
			minlevel : 14,
			description : "\n   " + "As an action, I can charm an incapacitated humanoid by touch" + "\n   " + "While it is charmed, I can communicate with it telepathically if it is on the same plane" + "\n   " + "This lasts until the charm is removed (can be by Remove Curse) or I use this again",
			action : ["action", ""]
		}
	}
});
AddSubClass("wizard", "abjuration", {
	regExpSearch : /(abjuration|abjurer)/i,
	subname : "School of Abjuration",
	fullname : "Abjurer",
	source : [["P", 115]],
	features : {
		"subclassfeature2" : {
			name : "Abjuration Savant",
			source : [["P", 115]],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy abjuration spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Arcane Ward",
			source : [["P", 115]],
			minlevel : 2,
			description : "\n   " + "Whenever I cast an 1st-level or higher abjuration spell, I make/heal a ward" + "\n   " + "I make it at max HP; When I cast again, it heals two HP per spell level" + "\n   " + "It stays active at 0 HP and doesn't go away until my next long rest" + "\n   " + "If I take damage, the ward takes the damage instead, but excess damage carries over",
			additional : levels.map( function(n) {
				return n < 2 ? "" : "Ward max HP: " + (n * 2) + "+Int mod";
			}),
			usages : 1,
			recovery : "long rest"
		},
		"subclassfeature6" : {
			name : "Projected Ward",
			source : [["P", 115]],
			minlevel : 6,
			description : "\n   " + "As a reaction, my Arcane Ward can absorb damage done to a creature within 30 ft",
			action : ["reaction", ""]
		},
		"subclassfeature10" : {
			name : "Improved Abjuration",
			source : [["P", 115]],
			minlevel : 10,
			description : "\n   " + "When I cast an abjuration spell requiring an ability check, I add my proficiency bonus",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellKey === "dispel magic" || spellKey === "counterspell") {
							var profB = Number(How("Proficiency Bonus"));
							var checkStr = "(" + AbilityScores.names.join("|") + "|spell(casting)?( ability )?) check";
							var checkRx = RegExp(checkStr + " \\(([+-]?\\d+)\\)", "i");
							var theBonus = profB;
							if (checkRx.test(spellObj.description)) {
								var theMatch = spellObj.description.match(checkRx);
								theBonus += Number(theMatch[2]);
								if (tDoc.getField("Remarkable Athlete").isBoxChecked(0) === 1 && theMatch[1].test(/Str|Dex|Con/i)) {
									theBonus -= Math.ceil(profB/2);
								} else if (tDoc.getField("Jack of All Trades").isBoxChecked(0) === 1) {
									theBonus -= Math.floor(profB/2);
								}
							} else {
								var theMatch = spellObj.description.match(RegExp(checkStr, "i"));
							}
							spellObj.description = spellObj.description.replace(theMatch[0], theMatch[1] + " check (" + (theBonus >= 0 ? "+" : "") + theBonus + ")");
							return true;
						};
					},
					"I add my proficiency bonus to ability checks required by abjuration spells. This is shown on the spell sheet by a lowered DC or higher bonus on the check."
				]
			}
		},
		"subclassfeature14" : {
			name : "Spell Resistance",
			source : [["P", 116]],
			minlevel : 14,
			description : "\n   " + "I have adv. on spell saves and resistance to damaging spells",
			dmgres : ["Spells"],
			savetxt : { adv_vs : ["spells"] }
		}
	}
});
AddSubClass("wizard", "conjuration", {
	regExpSearch : /(conjuration|conjurer)/i,
	subname : "School of Conjuration",
	fullname : "Conjurer",
	source : [["P", 116]],
	features : {
		"subclassfeature2" : {
			name : "Conjuration Savant",
			source : [["P", 116]],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy conjuration spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Minor Conjuration",
			source : [["P", 116]],
			minlevel : 2,
			description : "\n   " + "As an action, I can conjure an object up to 3 ft on each side and no more than 10 lbs" + "\n   " + "It must be of a form of a nonmagical object I have seen and is created within 10 ft" + "\n   " + "The object disappears after 1 hour, if it takes or deals damage, or when I use this again",
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Benign Transposition",
			source : [["P", 116]],
			minlevel : 6,
			description : "\n   " + "As an action, I can teleport to a place within 30 ft that I can see" + "\n   " + "Instead, I can swap places with a willing Small/Medium creature in 30 ft that I can see" + "\n   " + "I can do this again after a long rest or casting a 1st-level or higher conjuration spell",
			usages : 1,
			recovery : "long rest",
			action : ["action", ""]
		},
		"subclassfeature10" : {
			name : "Focused Conjuration",
			source : [["P", 116]],
			minlevel : 10,
			description : "\n   " + "While I am concentrating on a conjuration spell, it can't be broken by taking damage"
		},
		"subclassfeature14" : {
			name : "Durable Summons",
			source : [["P", 116]],
			minlevel : 14,
			description : "\n   " + "Any creature I summon or create with a conjuration spell has 30 temporary hit points",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellKey.indexOf("conjure") !== -1 && !(/barrage|volley|knowbot/i).test(spellKey)) {
							spellObj.description = spellObj.description.replace(/verbal commands/i, "command").replace(/^summon /i, '') + "; +30 temp hp";
							return true;
						} else if ((/find (greater )?(steed|familiar)/i).test(spellKey)) {
							spellObj.description = spellObj.description.replace(/Gain the services of a ([^;]+)/i, "A $1 (+30 temp hp)");
							return true;
						}
					},
					"Any creature I summon or create with a conjuration spell gains 30 temporary hit points."
				]
			}
		}
	}
});
AddSubClass("wizard", "divination", {
	regExpSearch : /(divination|diviner|divinator)/i,
	subname : "School of Divination",
	fullname : "Diviner",
	source : [["P", 116]],
	features : {
		"subclassfeature2" : {
			name : "Divination Savant",
			source : [["P", 116]],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy divination spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Portent",
			source : [["P", 116]],
			minlevel : 2,
			description : "\n   " + "After a long rest, I roll dice and keep the results to be used before my next rest" + "\n   " + "A result can replace an attack/save/ability check made by me or a creature I can see" + "\n   " + "I choose to switch them before the dice to be replaced are rolled; Max once per turn",
			additional : levels.map( function(n) {
				return n < 2 ? "" : (n < 14 ? 2 : 3) + "d20 after a long rest";
			})
		},
		"subclassfeature6" : {
			name : "Expert Divination",
			source : [["P", 116]],
			minlevel : 6,
			description : "\n   " + "When I cast a divination spell, I recover a spell slot of a lower level than the one I cast",
			additional : "Spell slot < 6th-level"
		},
		"subclassfeature10" : {
			name : "The Third Eye",
			source : [["P", 116]],
			minlevel : 10,
			description : "\n   " + "As an action, I gain one of the following until my next short or long rest:" + "\n   " + "Darkvision 60ft, see the Ethereal Plane 60ft, read any language, or see invisibility 10ft",
			recovery : "short rest",
			usages : 1,
			action : ["action", ""]
		},
		"subclassfeature14" : {
			name : "Greater Portent",
			source : [["P", 117]],
			minlevel : 14,
			description : "\n   " + "I can roll 3d20 instead of 2d20 when using my Portent feature"
		}
	}
});
AddSubClass("wizard", "enchantment", {
	regExpSearch : /(enchantment|enchanter)/i,
	subname : "School of Enchantment",
	fullname : "Enchanter",
	source : [["P", 117]],
	features : {
		"subclassfeature2" : {
			name : "Enchantment Savant",
			source : [["P", 117]],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy enchantment spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Hypnotic Gaze",
			source : [["P", 117]],
			minlevel : 2,
			description : "\n   " + "As an action, a seen enemy within 5 ft must make a Wis save or be charmed" + "\n   " + "This doesn't work if it can't see/hear me; It's also incapacitated and reduced to 0 speed" + "\n   " + "This lasts until the end of my next turn, but I can use an action to extend the duration" + "\n   " + "It also ends if it takes damage, can't see or hear me, or is more than 5 ft from me" + "\n   " + "On success or once it ends, I can't use this on it again until after a long rest",
			action : ["action", ""],
			usages : 1,
			recovery : "long rest"
		},
		"subclassfeature6" : {
			name : "Instinctive Charm",
			source : [["P", 117]],
			minlevel : 6,
			description : "\n   " + "As a reaction, when someone I can see in 30 ft attacks me, it must make a Wis save" + "\n   " + "If failed, it must instead attack the closest creature within range (not me or self)" + "\n   " + "On a success, the target is immune to this until after my long rest; This is a charm effect",
			action : ["reaction", " (when attacked)"]
		},
		"subclassfeature10" : {
			name : "Split Enchantment",
			source : [["P", 117]],
			minlevel : 10,
			description : "\n   " + "When I cast an enchantment spell with only one target, I can target a second in range" + "\n   " + "This does not apply to cantrips",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellObj.psionic || !spellObj.level || spellObj.school !== "Ench") return;
						var startDescr = spellObj.description;
						switch(spellKey) {
							case "animal messenger" :
								spellObj.description = spellObj.description.replace("Tiny beast delivers", "2 tiny beasts deliver single");
								break;
							case "antipathy/sympathy" :
								spellObj.description = spellObj.description.replace("Creature,", "2 crea, 1");
								break;
							case "heroism" :
							case "command" :
								spellObj.description = spellObj.description.replace(/, halt| as spell lasts/i, "");
							default :
								spellObj.description = spellObj.description.replace("1+1/SL", "2 or 1+1/SL").replace(/1 (crea(ture)?|beast|humanoid)/i, "2 $1s").replace(/creas\b/gi, "crea");
						}
						return startDescr !== spellObj.description;
					},
					"My enchantment, single-target 1st-level or higher spells can affect two targets instead of only one."
				]
			}
		},
		"subclassfeature14" : {
			name : "Alter Memories",
			source : [["P", 117]],
			minlevel : 14,
			description : "\n   " + "When I cast an enchantment spell that charms, I can have one target be unaware of it" + "\n   " + "Also, once before that spell ends, I can have that target forget time while affected" + "\n   " + "It must make an Intelligence save or lose up to 1 + Charisma modifier hours of memory"
		}
	}
});
AddSubClass("wizard", "illusion", {
	regExpSearch : /(illusion|illusionist|illusionary)/i,
	subname : "School of Illusion",
	fullname : "Illusionist",
	source : [["P", 118]],
	features : {
		"subclassfeature2" : {
			name : "Illusion Savant",
			source : [["P", 118]],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy illusion spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Improved Minor Illusion",
			source : [["P", 118]],
			minlevel : 2,
			description : "\n   " + "I gain the knowledge of the Minor Illusion cantrip (or another if I already knew it)" + "\n   " + "When I cast it, I can create both a sound and an image with a single casting",
			spellcastingBonus : {
				name : "Minor Illusion cantrip",
				spells : ["minor illusion"],
				selection : ["minor illusion"]
			},
			spellChanges : {
				"minor illusion" : {
					description : "5-ft cube illusion includes visible and audible; Int(Investigation) check vs. Spell DC; see book",
					changes : "My Improved Minor Illusion class feature allows me to make both a sound and an image with a single casting."
				}
			}
		},
		"subclassfeature6" : {
			name : "Malleable Illusion",
			source : [["P", 118]],
			minlevel : 6,
			description : "\n   " + "After I cast an illusion spell that lasts 1 min or longer, I can use an action to change it",
			action : ["action", ""]
		},
		"subclassfeature10" : {
			name : "Illusory Self",
			source : [["P", 118]],
			minlevel : 10,
			description : "\n   " + "As a reaction, when I'm attacked, I can impose an illusion that makes the attack miss",
			action : ["reaction", ""],
			recovery : "short rest",
			usages : 1
		},
		"subclassfeature14" : {
			name : "Illusory Reality",
			source : [["P", 118]],
			minlevel : 14,
			description : "\n   " + "As a bonus action, after I cast a 1st-level or higher illusion spell, I can make it real" + "\n   " + "One inanimate, nonmagical object that is part of the illusion becomes real for 1 minute" + "\n   " + "The object can't be something that directly harms someone",
			action : ["bonus action", ""]
		}
	}
});
AddSubClass("wizard", "necromancy", {
	regExpSearch : /necromancy|necromancer|necromantic/i,
	subname : "School of Necromancy",
	fullname : "Necromancer",
	source : [["P", 118]],
	features : {
		"subclassfeature2" : {
			name : "Necromancy Savant",
			source : [["P", 118]],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy necromancy spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Grim Harvest",
			source : [["P", 118]],
			minlevel : 2,
			description : "\n   " + "Once per turn, when I kill something with a 1st-level or higher spell, I regain hit points" + "\n   " + "The number of hit points regained is 2\xD7 the spell's level (or 3\xD7 with necromancy spells)" + "\n   " + "This doesn't occur for constructs/undead"
		},
		"subclassfeature6" : {
			name : "Undead Thralls",
			source : [["P", 119]],
			minlevel : 6,
			description : "\n   " + "I add Animate Dead to my spellbook and can have an additional target when casting it" + "\n   " + "Undead created by my necromancy spells have the following benefits:" + "\n   " + "They add my proficiency bonus to damage and my wizard level to their HP maximums",
			spellcastingBonus : {
				name : "Undead Thralls",
				spells : ["animate dead"],
				selection : ["animate dead"]
			},
			spellChanges : {
				"animate dead" : {
					description : "Turn corpses into 2+2/SL Skeletons or Zombies; control for 24h; bns a command within 60 ft",
					changes : "My Undead Thralls class feature allows me to animate one more corpse than normal with Animate Dead."
				}
			}
		},
		"subclassfeature10" : {
			name : "Inured to Undead",
			source : [["P", 119]],
			minlevel : 10,
			description : "\n   " + "I have resistance to necrotic damage and my hit point maximum can't be reduced",
			dmgres : ["Necrotic"]
		},
		"subclassfeature14" : {
			name : "Command Undead",
			source : [["P", 11]],
			minlevel : 14,
			description : "\n   " + "As an action, an undead within 60 ft that I can see must make a Charisma save" + "\n   " + "If its Int is > 7, it has adv. on the save; If its Int is > 11, it repeats the save every hour" + "\n   " + "If failed, it becomes friendly to me and obeys my commands until I use this on another" + "\n   " + "On success, it becomes permanently immune to my further attempts",
			action : ["action", ""]
		}
	}
});
AddSubClass("wizard", "transmutation", {
	regExpSearch : /(transmutation|transmuter)/i,
	subname : "School of Transmutation",
	fullname : "Transmuter",
	source : [["P", 119]],
	features : {
		"subclassfeature2" : {
			name : "Transmutation Savant",
			source : [["P", 119]],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy transmutation spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Minor Alchemy",
			source : [["P", 119]],
			minlevel : 2,
			description : "\n   " + "I can transform an object of wood/stone/iron/copper/silver into another of those" + "\n   " + "For each 10 min I spend, I can transform up to 1 cubic foot of the material" + "\n   " + "It reverts back when I lose concentration or after 1 hour"
		},
		"subclassfeature6" : {
			name : "Transmuter's Stone",
			source : [["P", 119]],
			minlevel : 6,
			description : desc([
				"In 8 hours, I can create a transmuter's stone that gives its wielder one of the following:",
				" \u2022 Darkvision 60 ft",
				" \u2022 10 ft increase to speed while unencumbered",
				" \u2022 Proficiency in Constitution saving throws",
				" \u2022 Resistance to either acid, cold, fire, lightning, or thunder damage",
				"The benefit is chosen at creation; I can have only one active stone at a time",
				"I can change the benefit when I cast a 1st-level or higher transmutation spell with it"
			])
		},
		"subclassfeature10" : {
			name : "Shapechanger",
			source : [["P", 119]],
			minlevel : 10,
			description : "\n   " + "I add Polymorph to my spellbook; I can cast it on myself without using a spell slot" + "\n   " + "When I do that, I can only transform into a beast with a challenge rating of 1 or lower",
			recovery : "short rest",
			usages : 1,
			spellcastingBonus : [{
				name : "Add to spellbook",
				spells : ["polymorph"],
				selection : ["polymorph"]
			}, {
				name : "1/SR no spell slot",
				spells : ["polymorph"],
				selection : ["polymorph"],
				firstCol : "oncesr"
			}],
			spellChanges : {
				"polymorph" : {
					name : "Polymorph (special)",
					range : "Self",
					description : "I transformed into a beast of my choice with a CR 1 or lower; see book",
					changes : "Using my Shapechanger class feature, I can cast Polymorph once per short rest without using a spell slot, but when I do so I can only cast it on myself and transform into a beast."
				}
			}
		},
		"subclassfeature14" : {
			name : "Master Transmuter",
			source : [["P", 119]],
			minlevel : 14,
			description : "\n   " + "As an action, I can destroy my transmuter's stone and do one of the four following:" + "\n    " + "1) Major Transformation" + "\n      " + "In 10 minutes, I transmute one nonmagical object up to 5 cubic foot into another" + "\n      " + "This new, nonmagical object must be of similar size and mass and equal or less value" + "\n    " + "2) Panacea" + "\n      " + "One touched has all curses, diseases, and poisons removed and is healed to max HP" + "\n    " + "3) Restore Life" + "\n      " + "I cast Raise Dead without using spell slots or needing to have it in my spellbook" + "\n    " + "4) Restore Youth" + "\n      " + "A touched creature's apparent age is reduced by 3d10 years (to a minimum of 13)",
			action : ["action", ""]
		}
	}
});

// Add the backgrounds that are not in the SRD
BackgroundList["charlatan"] = {
	regExpSearch : /charlatan/i,
	name : "Charlatan",
	source : [["P", 128], ["ALbackground", 0]],
	skills : ["Deception", "Sleight of Hand"],
	gold : 15,
	equipleft : [
		["Disguise kit", "", 3],
		["Tools for chosen con", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "False Identity",
	trait : [
		"I fall in and out of love easily, and am always pursuing someone.",
		"I have a joke for every occasion, especially occasions where humor is inappropriate.",
		"Flattery is my preferred trick for getting what I want.",
		"I'm a born gambler who can't resist taking a risk for a potential payoff.",
		"I lie about almost everything, even when there's no good reason to.",
		"Sarcasm and insults are my weapons of choice.",
		"I keep multiple holy symbols on me and invoke whatever deity might come in useful at any given moment.",
		"I pocket anything I see that might have some value."
	],
	ideal : [
		["Independence",
			"Independence: I am a free spirit \u2015 no one tells me what to do. (Chaotic)"
		],
		["Fairness",
			"Fairness: I never target people who can't afford to lose a few coins. (Lawful)"
		],
		["Charity",
			"Charity: I distribute the money I acquire to the people who really need it. (Good)"
		],
		["Creativity",
			"Creativity: I never run the same con twice. (Chaotic)"
		],
		["Friendship",
			"Friendship: Material goods come and go. Bonds of friendship last forever. (Good)"
		],
		["Aspiration",
			"Aspiration: I'm determined to make something of myself. (Any)"
		]
	],
	bond : [
		"I fleeced the wrong person and must work to ensure that this individual never crosses paths with me or those I care about.",
		"I owe everything to my mentor \u2015 a horrible person who's probably rotting in jail somewhere.",
		"Somewhere out there, I have a child who doesn't know me. I'm making the world better for him or her.",
		"I come from a noble family, and one day I'll reclaim my lands and title from those who stole them from me.",
		"A powerful person killed someone I love. Someday soon, I'll have my revenge.",
		"I swindled and ruined a person who didn't deserve it. I seek to atone for my misdeeds but might never be able to forgive myself."
	],
	flaw : [
		"I can't resist a pretty face.",
		"I'm always in debt. I spend my ill-gotten gains on decadent luxuries faster than I bring them in.",
		"I'm convinced that no one could ever fool me the way I fool others.",
		"I'm too greedy for my own good. I can't resist taking a risk if there's money involved.",
		"I can't resist swindling people who are more powerful than me.",
		"I hate to admit it and will hate myself for it, but I'll run and preserve my own hide if the going gets tough."
	],
	extra : [
		"Select a Favorite Scheme",
		"Cheat at games of chance",
		"Shave coins, forge documents",
		"User/manipulator",
		"Change identity",
		"Sleight-of-hand cons",
		"Sell junk as expensive necessities"
	],
	toolProfs : ["Disguise kit", "Forgery kit"],
	lifestyle : "comfortable"
};
BackgroundList["criminal"] = {
	regExpSearch : /criminal/i,
	name : "Criminal",
	source : [["P", 129], ["ALbackground", 0]],
	skills : ["Deception", "Stealth"],
	gold : 15,
	equipright : [
		["Dark, common clothes with hood", "", 3],
		["Crowbar", "", 5],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Criminal Contact",
	trait : [
		"I always have a plan for what to do when things go wrong.",
		"I am always calm, no matter the situation. I never raise my voice or let my emotions control me.",
		"The first thing I do in a new place is note the locations of everything valuable \u2015 or where such things could be hidden.",
		"I would rather make a new friend than a new enemy.",
		"I am incredibly slow to trust. Those who seem the fairest often have the most to hide.",
		"I don't pay attention to the risks in a situation. Never tell me the odds.",
		"The best way to get me to do something is to tell me I can't do it.",
		"I blow up at the slightest insult."
	],
	ideal : [
		["Honor",
			"Honor: I don't steal from others in the trade. (Lawful)"
		],
		["Freedom",
			"Freedom: Chains are meant to be broken, as are those who would forge them. (Chaotic)"
		],
		["Charity",
			"Charity: I steal from the wealthy so that I can help people in need. (Good)"
		],
		["Greed",
			"Greed: I will do whatever it takes to become wealthy. (Evil)"
		],
		["People",
			"People: I'm loyal to my friends, not to any ideals, and everyone else can take a trip down the Styx for all I care. (Neutral)"
		],
		["Redemption",
			"Redemption: There's a spark of good in everyone. (Good)"
		]
	],
	bond : [
		"I'm trying to pay off an old debt I owe to a generous benefactor.",
		"My ill-gotten gains go to support my family.",
		"Something important was taken from me, and I aim to steal it back.",
		"I will become the greatest thief that ever lived.",
		"I'm guilty of a terrible crime. I hope I can redeem myself for it.",
		"Someone I loved died because of a mistake I made. That will never happen again."
	],
	flaw : [
		"When I see something valuable, I can't think about anything but how to steal it.",
		"When faced with a choice between money and my friends, I usually choose the money.",
		"If there's a plan, I'll forget it. If I don't forget it, I'll ignore it.",
		"I have a \"tell\" that reveals when I'm lying.",
		"I turn tail and run when things look bad.",
		"An innocent person is in prison for a crime that I committed. I'm okay with that."
	],
	extra : [
		"Select a Criminal Specialty",
		"Blackmailer",
		"Burglar",
		"Enforcer",
		"Fence",
		"Highway robber",
		"Hired killer",
		"Pickpocket",
		"Smuggler",
		"Spy"
	],
	toolProfs : [["Gaming set", 1], ["Thieves' tools", "Dex"]],
	lifestyle : "poor"
};
BackgroundList["entertainer"] = {
	regExpSearch : /(entertainer|actor|dancer|fire.?eater|jester|juggler|instrumentalist|poet|singer|storyteller|tumbler)/i,
	name : "Entertainer",
	source : [["P", 130], ["ALbackground", 0]],
	skills : ["Acrobatics", "Performance"],
	gold : 15,
	equipright : [
		["Costume", "", 4],
		["Favor of an admirer", "", ""],
		["Belt pouch (with coins)", "", 1],
		["Musical instrument of my choice", "", ""]
	],
	feature : "By Popular Demand",
	trait : [
		"I know a story relevant to almost every situation.",
		"Whenever I come to a new place, I collect local rumors and spread gossip.",
		"I'm a hopeless romantic, always searching for that 'special someone'.",
		"Nobody stays angry at me or around me for long, since I can defuse any amount of tension.",
		"I love a good insult, even one directed at me.",
		"I get bitter if I'm not the center of attention.",
		"I'll settle for nothing less than perfection.",
		"I change my mood or my mind as quickly as I change key in a song."
	],
	ideal : [
		["Beauty",
			"Beauty: When I perform, I make the world better than it was. (Good)"
		],
		["Tradition",
			"Tradition: The stories, legends, and songs of the past must never be forgotten, for they teach us who we are. (Lawful)"
		],
		["Creativity",
			"Creativity: The world is in need of new ideas and bold action. (Chaotic)"
		],
		["Greed",
			"Greed: I'm only in it for the money and fame. [Evil]"
		],
		["People",
			"People: I like seeing the smiles on people's faces when I perform. That's all that matters. (Neutral)"
		],
		["Honesty",
			"Honesty: Art should reflect the soul; it should come from within and reveal who we really are. (Any)"
		]
	],
	bond : [
		"My instrument is my most treasured possession, and it reminds me of someone I love.",
		"Someone stole my precious instrument, and someday I'll get it back.",
		"I want to be famous, whatever it takes.",
		"I idolize a hero of the old tales and measure my deeds against that person's.",
		"I will do anything to prove myself superior to my hated rival.",
		"I would do anything for the other members of my old troupe."
	],
	flaw : [
		"I'll do anything to win fame and renown.",
		"I'm a sucker for a pretty face.",
		"A scandal prevents me from ever going home again. That kind of trouble seems to follow me around.",
		"I once satirized a noble who still wants my head. It was a mistake that I will likely repeat.",
		"I have trouble keeping my true feelings hidden. My sharp tongue lands me in trouble.",
		"Despite my best efforts, I am unreliable to my friends."
	],
	extra : [
		"Select an Entertainer Routine",
		"Actor",
		"Dancer",
		"Fire-eater",
		"Jester",
		"Juggler",
		"Instrumentalist",
		"Poet",
		"Singer",
		"Storyteller",
		"Tumbler"
	],
	toolProfs : ["Disguise kit", ["Musical instrument", 1]],
	lifestyle : "modest"
};
BackgroundList["folk hero"] = {
	regExpSearch : /^(?=.*folk)(?=.*hero).*$/i,
	name : "Folk Hero",
	source : [["P", 131], ["ALbackground", 0]],
	skills : ["Animal Handling", "Survival"],
	gold : 10,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Shovel", "", 5],
		["Iron pot", "", 10]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Rustic Hospitality",
	trait : [
		"I judge people by their actions, not their words.",
		"If someone is in trouble, I'm always ready to lend help.",
		"When I set my mind to something, I follow through no matter what gets in my way.",
		"I have a strong sense of fair play and always try to find the most equitable solution to arguments.",
		"I'm confident in my own abilities and do what I can to instill confidence in others.",
		"Thinking is for other people. I prefer action.",
		"I misuse long words in an attempt to sound smarter.",
		"I get bored easily. When am I going to get on with my destiny?"
	],
	ideal : [
		["Respect",
			"Respect: People deserve to be treated with dignity and respect. (Good)"
		],
		["Fairness",
			"Fairness: No one should get preferential treatment before the law, and no one is above the law. (Lawful)"
		],
		["Freedom",
			"Freedom: Tyrants must not be allowed to oppress the people. (Chaotic)"
		],
		["Might",
			"Might: If I become strong, I can take what I want\u2015 what I deserve. (Evil)"
		],
		["Sincerity",
			"Sincerity: There's no good in pretending to be something I'm not. (Neutral)"
		],
		["Destiny",
			"Destiny: Nothing and no one can steer me away from my higher calling. (Any)"
		]
	],
	bond : [
		"I have a family, but I have no idea where they are. One day, I hope to see them again.",
		"I worked the land, I love the land, and I will protect the land.",
		"A proud noble once gave me a horrible beating, and I will take my revenge on any bully I encounter.",
		"My tools are symbols of my past life, and I carry them so that I will never forget my roots.",
		"I protect those who cannot protect themselves.",
		"I wish my childhood sweetheart had come with me to pursue my destiny."
	],
	flaw : [
		"The tyrant who rules my land will stop at nothing to see me killed.",
		"I'm convinced of the significance of my destiny, and blind to my shortcomings and the risk of failure.",
		"The people who knew me when I was young know my shameful secret, so I can never go home again.",
		"I have a weakness for the vices of the city, especially hard drink.",
		"Secretly, I believe that things would be better if I were a tyrant lording over the land.",
		"I have trouble trusting in my allies."
	],
	extra : [
		"Select a Defining Event",
		"I stood up to a tyrant's agents",
		"I saved people during a natural disaster",
		"I stood alone against a terrible monster",
		"I stole from a corrupt merchant for the poor",
		"I led a militia to fight off an invading army",
		"I stole weapons from a tyrant to arm the people",
		"I trained peasantry to fight a tyrant with farm tools",
		"A decree was rescinded after I led a protest against it",
		"A magical creature gave me a blessing or insight",
		"I rose to leadership in a lord's army"
	],
	toolProfs : [["Artisan's tools", 1], "Vehicles (land)"],
	lifestyle : "modest"
};
BackgroundList["guild artisan"] = {
	regExpSearch : /^(?=.*guild)(?=.*artisan).*$/i,
	name : "Guild Artisan",
	source : [["P", 132], ["ALbackground", 0]],
	skills : ["Insight", "Persuasion"],
	gold : 15,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Letter of introduction from guild", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Guild Membership",
	trait : [
		"I believe that anything worth doing is worth doing right. I can't help it\u2015 I'm a perfectionist.",
		"I'm a snob who looks down on those who can't appreciate fine art.",
		"I always want to know how things work and what makes people tick.",
		"I'm full of witty aphorisms and have a proverb for every occasion.",
		"I'm rude to people who lack my commitment to hard work and fair play.",
		"I like to talk at length about my profession.",
		"I don't part with my money easily and will haggle tirelessly to get the best deal possible.",
		"I'm well known for my work, and I want to make sure everyone appreciates it. I'm always taken aback when people haven't heard of me."
	],
	ideal : [
		["Community",
			"Community: It is the duty of all civilized people to strengthen the bonds of community and the security of civilization. (Lawful)"
		],
		["Generosity",
			"Generosity: My talents were given to me so that I could use them to benefit the world. (Good)"
		],
		["Freedom",
			"Freedom: Everyone should be free to pursue his or her own livelihood. (Chaotic)"
		],
		["Greed",
			"Greed: I'm only in it for the money. (Evil)"
		],
		["People",
			"People: I'm committed to the people I care about, not to ideals. (Neutral)"
		],
		["Aspiration",
			"Aspiration: I work hard to be the best there is at my craft. (Any)"
		]
	],
	bond : [
		"The workshop where I learned my trade is the most important place in the world to me.",
		"I created a great work for someone, and then found them unworthy to receive it. I'm still looking for someone worthy.",
		"I owe my guild a great debt for forging me into the person I am today.",
		"I pursue wealth to secure someone's love.",
		"One day I will return to my guild and prove that I am the greatest artisan of them all.",
		"I will get revenge on the evil forces that destroyed my place of business and ruined my livelihood."
	],
	flaw : [
		"I'll do anything to get my hands on something rare or priceless.",
		"I'm quick to assume that someone is trying to cheat me.",
		"No one must ever learn that I once stole money from guild coffers.",
		"I'm never satisfied with what I have\u2015 I always want more.",
		"I would kill to acquire a noble title.",
		"I'm horribly jealous of anyone who can outshine my handiwork. Everywhere I go, I'm surrounded by rivals."
	],
	extra : [
		"Select a Guild Business",
		"Alchemists and apothecaries",
		"Armorers, locksmiths, and finesmiths",
		"Brewers, distillers, and vintners",
		"Calligraphers, scribes, and scriveners",
		"Carpenters, roofers, and plasterers",
		"Cartographers, surveyors, and chart-makers",
		"Cobblers and shoemakers",
		"Cooks and bakers",
		"Glassblowers and glaziers",
		"Jewelers and gemcutters",
		"Leatherworkers, skinners, and tanners",
		"Masons and stonecutters",
		"Painters, limners, and sign-makers",
		"Potters and tile-makers",
		"Shipwrights and sailmakers",
		"Smiths and metal-forgers",
		"Tinkers, pewterers, and casters",
		"Wagon-makers and wheelwrights",
		"Weavers and dyers",
		"Woodcarvers, coopers, and bowyers"
	],
	toolProfs : [["Artisan's tools", 1]],
	languageProfs : [1],
	lifestyle : "comfortable"
};
BackgroundList["hermit"] = {
	regExpSearch : /hermit/i,
	name : "Hermit",
	source : [["P", 134], ["ALbackground", 0]],
	skills : ["Medicine", "Religion"],
	gold : 5,
	equipleft : [
		["Winter blanket", "", 3],
		["Herbalism kit", "", 3]
	],
	equipright : [
		["Common clothes", "", 3],
		["Scroll case with notes", "", 1]
	],
	feature : "Discovery",
	trait : [
		"I've been isolated for so long that I rarely speak, preferring gestures and the occasional grunt.",
		"I am utterly serene, even in the face of disaster.",
		"The leader of my community had something wise to say on every topic, and I am eager to share that wisdom.",
		"I feel tremendous empathy for all who suffer.",
		"I'm oblivious to etiquette and social expectations.",
		"I connect everything that happens to me to a grand, cosmic plan.",
		"I often get lost in my own thoughts and contemplation, becoming oblivious to my surroundings.",
		"I am working on a grand philosophical theory and love sharing my ideas."
	],
	ideal : [
		["Greater Good",
			"Greater Good: My gifts are meant to be shared with all, not used for my own benefit. (Good)"
		],
		["Logic",
			"Logic: Emotions must not cloud our sense of what is right and true, or our logical thinking. (Lawful)"
		],
		["Free Thinking",
			"Free Thinking: Inquiry and curiosity are the pillars of progress. (Chaotic)"
		],
		["Power",
			"Power: Solitude and contemplation are paths toward mystical or magical power. (Evil)"
		],
		["Live and Let Live",
			"Live and Let Live: Meddling in the affairs of others only causes trouble. (Neutral)"
		],
		["Self-Knowledge",
			"Self-Knowledge: If you know yourself, there's nothing left to know. (Any)"
		]
	],
	bond : [
		"Nothing is more important than the other members of my hermitage, order, or association.",
		"I entered seclusion to hide from the ones who might still be hunting me. I must someday confront them.",
		"I'm still seeking the enlightenment I pursued in my seclusion, and it still eludes me.",
		"I entered seclusion because I loved someone I could not have.",
		"Should my discovery come to light, it could bring ruin to the world.",
		"My isolation gave me great insight into a great evil that only I can destroy."
	],
	flaw : [
		"Now that I've returned to the world, I enjoy its delights a little too much.",
		"I harbor dark, bloodthirsty thoughts that my isolation and meditation failed to quell.",
		"I am dogmatic in my thoughts and philosophy.",
		"I let my need to win arguments overshadow friendships and harmony.",
		"I'd risk too much to uncover a lost bit of knowledge.",
		"I like keeping secrets and won't share them with anyone."
	],
	extra : [
		"Select a Life of Seclusion",
		"Searching for spiritual enlightenment",
		"Living in accordance with a religious order",
		"Exiled for a crime I didn't commit",
		"Retreated from society after a life-altering event",
		"Worked on my art, literature, music, or manifesto",
		"Commune with nature, far from civilization",
		"Caretaker of an ancient ruin or relic",
		"Pilgrim in search of a thing of spiritual significance"
	],
	toolProfs : ["Herbalism kit"],
	languageProfs : [1],
	lifestyle : "poor"
};
BackgroundList["noble"] = {
	regExpSearch : /^(?!.*(waterdhavian|waterdeep|knight))(?=.*noble).*$/i,
	name : "Noble",
	source : [["P", 135], ["ALbackground", 0]],
	skills : ["History", "Persuasion"],
	gold : 25,
	equipleft : [
		["Scroll of pedigree", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Purse (with coins)", "", 1]
	],
	feature : "Position of Privilege",
	trait : [
		"My eloquent flattery makes everyone I talk to feel like the most wonderful and important person in the world.",
		"The common folk love me for my kindness and generosity.",
		"No one could doubt by looking at my regal bearing that I am a cut above the unwashed masses.",
		"I take great pains to always look my best and follow the latest fashions.",
		"I don't like to get my hands dirty, and I won't be caught dead in unsuitable accommodations.",
		"Despite my noble birth, I do not place myself above other folk. We all have the same blood.",
		"My favor, once lost, is lost forever.",
		"If you do me an injury, I will crush you, ruin your name, and salt your fields."
	],
	ideal : [
		["Respect",
			"Respect: Respect is due to me because of my position, but all people regardless of station deserve to be treated with dignity. (Good)"
		],
		["Responsibility",
			"Responsibility: It is my duty to respect the authority of those above me, just as those below me must respect mine. (Lawful)"
		],
		["Independence",
			"Independence: I must prove that I can handle myself without the coddling of my family. (Chaotic)"
		],
		["Power",
			"Power: If I can attain more power, no one will tell me what to do. (Evil)"
		],
		["Family",
			"Family: Blood runs thicker than water. (Any)"
		],
		["Noble Obligation",
			"Noble Obligation: It is my duty to protect and care for the people beneath me. (Good)"
		]
	],
	bond : [
		"I will face any challenge to win the approval of my family.",
		"My house's alliance with another noble family must be sustained at all costs.",
		"Nothing is more important than the other members of my family.",
		"I am in love with the heir of a family that my family despises.",
		"My loyalty to my sovereign is unwavering.",
		"The common folk must see me as a hero of the people."
	],
	flaw : [
		"I secretly believe that everyone is beneath me.",
		"I hide a truly scandalous secret that could ruin my family forever.",
		"I too often hear veiled insults and threats in every word addressed to me, and I'm quick to anger.",
		"I have an insatiable desire for carnal pleasures.",
		"In fact, the world does revolve around me.",
		"By my words and actions, I often bring shame to my family."
	],
	toolProfs : [["Gaming set", 1]],
	languageProfs : [1],
	lifestyle : "wealthy"
};
BackgroundList["outlander"] = {
	regExpSearch : /^(?!.*urban)(?=.*(outlander|forester|trapper|homesteader|guide|exile|outcast|bounty.?hunter|tribal nomad|hunter-gatherer|tribal.?marauder)).*$/i,
	name : "Outlander",
	source : [["P", 136], ["ALbackground", 0]],
	skills : ["Athletics", "Survival"],
	gold : 10,
	equipright : [
		["Traveler's clothes", "", 4],
		["Staff", "", 4],
		["Hunting trap", "", 25],
		["Trophy from animal", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Wanderer",
	trait : [
		"I'm driven by a wanderlust that led me away from home.",
		"I watch over my friends as if they were a litter of newborn pups.",
		"I once ran twenty-five miles without stopping to warn to my clan of an approaching orc horde. I'd do it again if I had to.",
		"I have a lesson for every situation, drawn from observing nature.",
		"I place no stock in wealthy or well-mannered folk. Money and manners won't save you from a hungry owlbear.",
		"I'm always picking things up, absently fiddling with them, and sometimes accidentally breaking them.",
		"I feel far more comfortable around animals than people.",
		"I was, in fact, raised by wolves."
	],
	ideal : [
		["Change",
			"Change: Life is like the seasons, in constant change, and we must change with it. (Chaotic)"
		],
		["Greater Good",
			"Greater Good: It is each person's responsibility to make the most happiness for the whole tribe. (Good)"
		],
		["Honor",
			"Honor: If I dishonor myself, I dishonor my whole clan. (Lawful)"
		],
		["Might",
			"Might: The strongest are meant to rule. (Evil)"
		],
		["Nature",
			"Nature: The natural world is more important than all the constructs of civilization. (Neutral)"
		],
		["Glory",
			"Glory: I must earn glory in battle, for myself and my clan. (Any)"
		]
	],
	bond : [
		"My family, clan, or tribe is the most important thing in my life, even when they are far from me.",
		"An injury to the unspoiled wilderness of my home is an injury to me.",
		"I will bring terrible wrath down on the evildoers who destroyed my homeland.",
		"I am the last of my tribe, and it is up to me to ensure their names enter legend.",
		"I suffer awful visions of a coming disaster and will do anything to prevent it.",
		"It is my duty to provide children to sustain my tribe."
	],
	flaw : [
		"I am too enamored of ale, wine, and other intoxicants.",
		"There's no room for caution in a life lived to the fullest.",
		"I remember every insult I've received and nurse a silent resentment toward anyone who's ever wronged me.",
		"I am slow to trust members of other races, tribes, and societies.",
		"Violence is my answer to almost any challenge.",
		"Don't expect me to save those who can't save themselves. It is nature's way that the strong thrive and the weak perish."
	],
	extra : ["Select an Origin",
		"Forester",
		"Trapper",
		"Homesteader",
		"Guide",
		"Exile or outcast",
		"Bounty hunter",
		"Pilgrim",
		"Tribal nomad",
		"Hunter-gatherer",
		"Tribal marauder"
	],
	toolProfs : [["Musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "poor"
};
BackgroundList["sage"] = {
	regExpSearch : /(sage|alchemist|astronomer|academic|librarian|professor|researcher|apprentice|scribe)/i,
	name : "Sage",
	source : [["P", 137], ["ALbackground", 0]],
	skills : ["Arcana", "History"],
	gold : 10,
	equipleft : [
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""],
		["Small knife", "", 0.5],
		["Letter from dead colleague", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Researcher",
	trait : [
		"I use polysyllabic words that convey the impression of great erudition.",
		"I've read every book in the world's greatest libraries\u2015 or I like to boast that I have.",
		"I'm used to helping out those who aren't as smart as I am, and I patiently explain anything and everything to others.",
		"There's nothing I like more than a good mystery.",
		"I'm willing to listen to every side of an argument before I make my own judgment.",
		"I . . . speak . . . slowly . . . when talking . . . to idiots, . . . which . . . almost. . . everyone . . . is . . . compared . . . to me.",
		"I am horribly, horribly awkward in social situations.",
		"I'm convinced that people are always trying to steal my secrets."
	],
	ideal : [
		["Knowledge",
			"Knowledge: The path to power and self-improvement is through knowledge. (Neutral)"
		],
		["Beauty",
			"Beauty: What is beautiful points us beyond itself toward what is true. (Good)"
		],
		["Logic",
			"Logic: Emotions must not cloud our logical thinking. (Lawful)"
		],
		["No Limits",
			"No Limits: Nothing should fetter the infinite possibility inherent in all existence. (Chaotic)"
		],
		["Power",
			"Power: Knowledge is the path to power and domination. (Evil)"
		],
		["Self-Improvement",
			"Self-Improvement: The goal of a life of study is the betterment of oneself. (Any)"
		]
	],
	bond : [
		"It is my duty to protect my students.",
		"I have an ancient text that holds terrible secrets that must not fall into the wrong hands.",
		"I work to preserve a library, university, scriptorium, or monastery.",
		"My life's work is a series of tomes related to a specific field of lore.",
		"I've been searching my whole life for the answer to a certain question.",
		"I sold my soul for knowledge. I hope to do great deeds and win it back."
	],
	flaw : [
		"I am easily distracted by the promise of information.",
		"Most people scream and run when they see a demon. I stop and take notes on its anatomy.",
		"Unlocking an ancient mystery is worth the price of a civilization.",
		"I overlook obvious solutions in favor of complicated ones.",
		"I speak without really thinking through my words, invariably insulting others.",
		"I can't keep a secret to save my life, or anyone else's."
	],
	extra : ["Select a Specialty",
		"Alchemist",
		"Astronomer",
		"Discredited academic",
		"Librarian",
		"Professor",
		"Researcher",
		"Wizard's apprentice",
		"Scribe"
	],
	languageProfs : [2],
	lifestyle : "modest"
};
BackgroundList["sailor"] = {
	regExpSearch : /sailor/i,
	name : "Sailor",
	source : [["P", 139], ["ALbackground", 0]],
	skills : ["Athletics", "Perception"],
	gold : 10,
	equipleft : [
		["Silk rope, feet of", 50, 0.1]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belaying pin (club)", "", 2],
		["Lucky charm", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Ship's Passage",
	trait : [
		"My friends know they can rely on me, no matter what.",
		"I work hard so that I can play hard when the work is done.",
		"I enjoy sailing into new ports and making new friends over a flagon of ale.",
		"I stretch the truth for the sake of a good story.",
		"To me, a tavern brawl is a nice way to get to know a new city.",
		"I never pass up a friendly wager.",
		"My language is as foul as an otyugh nest.",
		"I like a job well done, especially if I can convince someone else to do it."
	],
	ideal : [
		["Respect",
			"Respect: The thing that keeps a ship together is mutual respect between captain and crew. (Good)"
		],
		["Fairness",
			"Fairness: We all do the work, so we all share in the rewards. (Lawful)"
		],
		["Freedom",
			"Freedom: The sea is freedom\u2015 the freedom to go anywhere and do anything. (Chaotic)"
		],
		["Mastery",
			"Mastery: I'm a predator, and the other ships on the sea are my prey. (Evil)"
		],
		["People",
			"People: I'm committed to my crewmates, not to ideals. (Neutral)"
		],
		["Aspiration",
			"Aspiration: Someday I'll own my own ship and chart my own destiny. (Any)"
		]
	],
	bond : [
		"I'm loyal to my captain first, everything else second.",
		"The ship is most important\u2015 crewmates and captains come and go.",
		"I'll always remember my first ship.",
		"In a harbor town, I have a paramour whose eyes nearly stole me from the sea.",
		"I was cheated out of my fair share of the profits, and I want to get my due.",
		"Ruthless pirates murdered my captain and crewmates, plundered our ship, and left me to die. Vengeance will be mine."
	],
	flaw : [
		"I follow orders, even if I think they're wrong.",
		"I'll say anything to avoid having to do extra work.",
		"Once someone questions my courage, I never back down no matter how dangerous the situation.",
		"Once I start drinking, it's hard for me to stop.",
		"I can't help but pocket loose coins and other trinkets I come across.",
		"My pride will probably lead to my destruction."
	],
	toolProfs : ["Navigator's tools", "Vehicles (water)"],
	lifestyle : "modest",
};
BackgroundList["soldier"] = {
	regExpSearch : /^(?!.*mercenary)(?=.*soldier).*$/i,
	name : "Soldier",
	source : [["P", 140], ["ALbackground", 0]],
	skills : ["Athletics", "Intimidation"],
	gold : 10,
	equipright : [
		["Common clothes", "", 3],
		["Insignia of rank", "", ""],
		["Trophy from fallen enemy", "", ""],
		["Bone dice or playing cards", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Military Rank",
	trait : [
		"I'm always respectful and polite.",
		"I'm haunted by memories of war. I can't get the violent images out of my mind.",
		"I'm slow to make new friends, because I've lost too many old ones.",
		"I'm full of inspiring and cautionary tales from my military experience with some relevance to almost every type of combat situation.",
		"I can stare down an owlbear without flinching.",
		"I enjoy my strength and like to break things.",
		"I have a rough sense of humor.",
		"I approach problems head-on. A simple, direct course is the best path to a solution."
	],
	ideal : [
		["Greater Good",
			"Greater Good: Our fate is to give our lives in the defense of others. (Good)"
		],
		["Responsibility",
			"Responsibility: I do what I have to and follow just authority. (Lawful)"
		],
		["Independence",
			"Independence: When people obey orders blindly, they affirm a kind of tyranny. (Chaotic)"
		],
		["Might",
			"Might: In life as in war, the mightier force prevails. (Evil)"
		],
		["Live and Let Live",
			"Live and Let Live: Ideals aren't worth killing over or going to war for. (Neutral)"
		],
		["Nation",
			"Nation: My city, state, or people are the only things that matter. (Any)"
		]
	],
	bond : [
		"I would still give my life for the people I have served with.",
		"Someone saved my life on the battlefield. Even now, I would never leave a friend behind.",
		"My honor is my life.",
		"I'll never forget the crushing defeat my company endured or the foes who inflicted it.",
		"Those who fight with me are those worth laying down my life for.",
		"I fight for those who cannot fight for themselves."
	],
	flaw : [
		"The atrocious enemy we faced in battle still leaves me trembling with fear.",
		"I have little respect for those who are not a tested warrior.",
		"A disastrous mistake I made in battle cost many lives\u2015 I will do anything to keep that mistake a secret.",
		"My hatred of my foes is blind and unreasoning. ",
		"I uphold the law, even if the law causes suffering.",
		"I'd rather eat my weapon than admit when I'm wrong."
	],
	extra : ["Select a Specialty",
		"Officer",
		"Scout",
		"Infantry",
		"Cavalry",
		"Healer",
		"Quartermaster",
		"Standard-bearer",
		"Support staff"
	],
	toolProfs : [["Gaming set", 1], "Vehicles (land)"],
	lifestyle : "modest"
};
BackgroundList["urchin"] = {
	regExpSearch : /urchin/i,
	name : "Urchin",
	source : [["P", 141], ["ALbackground", 0]],
	skills : ["Sleight of Hand", "Stealth"],
	gold : 10,
	equipleft : [
		["Map of the city", "", ""],
		["Small knife", "", 0.5]
	],
	equipright : [
		["Common clothes", "", 3],
		["Token from my parents", "", ""],
		["Pet mouse", "", 0.1],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "City Secrets",
	trait : [
		"I keep scraps of food and trinkets hidden away in my pockets.",
		"I ask questions all the time.",
		"I like to squeeze into compact places where nobody can harm me.",
		"I sleep with my back to solid surface, with all that I own embraced tightly in my arms.",
		"I have bad manners and eat like a pig.",
		"I expect that anybody who's nice to me is hiding malicious intent.",
		"I eschew bathing.",
		"I say, without reserve, what other people are implying or masking."
	],
	ideal : [
		["Respect",
			"Respect: Everybody, no matter their riches, deserves respect. (Good)"
		],
		["Community",
			"Community: We have to take look out for each other, because nobody else will do it for us. (Lawful)"
		],
		["Change",
			"Change: The low rise up, and the high and mighty come down. Change is natural. (Chaotic)"
		],
		["Retribution",
			"Retribution: The rich need to be shown how it is to live and die in the poor quarters. (Evil)"
		],
		["People",
			"People: I help those who help me\u2015 that is what lets us stay alive. (Neutral)"
		],
		["Aspiration",
			"Aspiration: I'm going to prove that I'm worthy of a better life. (Any)"
		]
	],
	bond : [
		"My town or city is my home, and I'll battle those that threaten it.",
		"I'm the benefactor of an orphanage so others may be kept from enduring what I was forced to endure.",
		"I owe my life to another urchin who taught me the ways of living in the gutters.",
		"I owe a debt I can never repay to the person who showed me sympathy.",
		"I got away from my life of poverty by robbing an influential person, and I'm wanted for it.",
		"No one else should have to suffer the difficulties I've been through."
	],
	flaw : [
		"I will run away from a fight if I'm outnumbered.",
		"A gold piece already has a lot of value to me, and I'll do just about anything for more of it.",
		"I will never completely trust another. I only trust myself.",
		"I would rather use an unfair advantage than fight honorably.",
		"It's not theft if I have more use for it than someone else.",
		"People who are incapable of taking care of themselves get what they deserve."
	],
	toolProfs : ["Disguise kit", ["Thieves' tools", "Dex"]],
	lifestyle : "modest"
};

// Add the background variants
AddBackgroundVariant("entertainer", "gladiator", {
	regExpSearch : /gladiator/i,
	name : "Gladiator",
	source : [["P", 131], ["ALbackground", 0]],
	equipright : [
		["Costume", "", 4],
		["Favor of an admirer", "", ""],
		["Belt pouch (with coins)", "", 1],
		["Inexpensive, unusual weapon", "", ""]
	],
	feature : "Are You Entertained?",
	extra : ""
});
AddBackgroundVariant("guild artisan", "guild merchant", {
	regExpSearch : /^(?=.*guild)(?=.*merchant).*$/i,
	name : "Guild Merchant",
	source : [["P", 133], ["ALbackground", 0]],
	equipleft : [
		["Letter of introduction from guild", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1],
		["Cart", "", ""],
		["Mule", "", ""]
	],
	extra : [
		"Select a Guild Business",
		"Traders",
		"Caravan masters",
		"Shopkeepers"
	],
	toolProfs : ["Navigator's tools (or language)"]
});
AddBackgroundVariant("noble", "knight", {
	regExpSearch : /^(?!.*order)(?=.*knight).*$/i,
	name : "Knight",
	source : [["P", 136], ["ALbackground", 0]],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Purse (with coins)", "", 1],
		["Banner or token from devoted love", "", ""]
	],
	feature : "Retainers"
});
AddBackgroundVariant("sailor", "pirate", {
	regExpSearch : /pirate/i,
	name : "Pirate",
	source : [["P", 139], ["ALbackground", 0]],
	feature : "Bad Reputation"
});

// Add the backgrounds features that are not in the SRD
BackgroundFeatureList["are you entertained?"] = {
	description : "I can always find a place to perform (arena/pit fight), where I receive free lodging and food of a modest or comfortable standard, as long as I perform each night. In addition, my performance makes me something of a local figure. When strangers recognize me in a town where I have performed, they typically take a liking to me.",
	source : [["P", 131], ["ALbackground", 0]]
};
BackgroundFeatureList["bad reputation"] = {
	description : "No matter where I go, people are afraid of me due to my reputation. When I am in a civilized settlement, I can get away with minor criminal offenses, such as refusing to pay for food at a tavern or breaking down doors at a local shop, since most people will not report my activity to the authorities.",
	source : [["P", 139], ["ALbackground", 0]]
};
BackgroundFeatureList["by popular demand"] = {
	description : "I can always find a place to perform (inn/tavern/circus/etc.), where I receive free lodging and food of a modest or comfortable standard, as long as I perform each night. In addition, my performance makes me something of a local figure. When strangers recognize me in a town where I have performed, they typically take a liking to me.",
	source : [["P", 130], ["ALbackground", 0]]
};
BackgroundFeatureList["city secrets"] = {
	description : "I know the secret patterns and flow to cities and can find passages through the urban sprawl that others would miss. When I am not in combat, I (and companions I lead) can travel between any two locations in the city twice as fast as my speed would normally allow.",
	source : [["P", 141], ["ALbackground", 0]]
};
BackgroundFeatureList["criminal contact"] = {
	description : "I have a reliable and trustworthy contact who acts as my liaison to a network of other criminals. I know how to get messages to and from my contact, even over great distances; specifically, I know the local messengers, corrupt caravan masters, and seedy sailors who can deliver my messages.",
	source : [["P", 129], ["ALbackground", 0]]
};
BackgroundFeatureList["discovery"] = {
	description : "The quiet seclusion of my extended hermitage gave me access to a unique and powerful discovery. The exact nature of this revelation depends on the nature of my seclusion. It might be a great truth, a hidden site, a long forgotten fact, or unearthed some relic of the past that could rewrite history.",
	source : [["P", 134], ["ALbackground", 0]]
};
BackgroundFeatureList["false identity"] = {
	description : "I have created a second identity that includes documentation, established acquaintances, and disguises that allow me to assume that persona. Additionally, I can forge documents, including official papers and personal letters, as long as I have seen an example of the kind of document or the handwriting I am trying to copy.",
	source : [["P", 128], ["ALbackground", 0]]
};
BackgroundFeatureList["guild membership"] = {
	description : "5 gp membership fees per month: The guild offers lodging if possible. In case of being accused of a crime, the guild will support me if a good case can be made for my innocence or the crime is justifiable. I can also gain access to powerful political figures through the guild, as long as I'm in good standing and the guild is paid enough.",
	source : [["P", 133], ["ALbackground", 0]]
};
BackgroundFeatureList["military rank"] = {
	description : "I have a military rank from my career as a soldier. Soldiers loyal to my former military organization still recognize my authority and influence. I can invoke my rank to influence soldiers and temporarily requisition simple equipment or horses. I can usually gain access to friendly military encampments and fortresses where my rank is recognized.",
	source : [["P", 140], ["ALbackground", 0]],
};
BackgroundFeatureList["position of privilege"] = {
	description : "I am welcome in high society, and people assume I have the right to be wherever I am. The common folk make every effort to accommodate me and avoid my displeasure, and other people of high birth treat me as a member of the same social sphere. I can secure an audience with a local noble if I need to.",
	source : [["P", 135], ["ALbackground", 0]]
};
BackgroundFeatureList["researcher"] = {
	description : "When I attempt to learn or recall a piece of lore, if I do not know that information, I often know where and from whom I can obtain it. Usually, this information comes from a library, scriptorium, university, or a sage or other learned person or creature. Unearthing the deepest secrets of the multiverse can require an adventure or even a whole campaign.",
	source : [["P", 138], ["ALbackground", 0]]
};
BackgroundFeatureList["retainers"] = {
	description : "I have the service of three retainers loyal to my family, one of whom is another noble and my squire. My other retainers are commoners who can perform mundane tasks for me, but they do not fight for me, will not follow me into obviously dangerous areas (such as dungeons), and will leave if they are frequently endangered or abused.",
	source : [["P", 136], ["ALbackground", 0]]
};
BackgroundFeatureList["rustic hospitality"] = {
	description : "Since I come from the ranks of the common folk, I fit in among them with ease. I can find a place to hide, rest, or recuperate among other commoners, unless I have shown myself to be a danger to them. They will shield me from the law or anyone else searching for me, though they will not risk their lives for me.",
	source : [["P", 131], ["ALbackground", 0]]
};
BackgroundFeatureList["ship's passage"] = {
	description : "When I need to, I can secure free passage on a sailing ship for myself and my companions. I might sail on the ship I served on, or another ship I have good relations with. Because I'm calling in a favor, I can't be certain of a schedule or route that will meet my every need. My companions and I are expected to assist the crew during the voyage.",
	source : [["P", 139], ["ALbackground", 0]]
};
BackgroundFeatureList["wanderer"] = {
	description : "I have an excellent memory for maps and geography, and I can always recall the general layout of terrain, settlements, and other features around me. In addition, I can find food and fresh water for myself and up to five other people each day, provided that the land offers berries, small game, water, and so forth.",
	source : [["P", 136], ["ALbackground", 0]]
};

// Add the feats that are not in the SRD
FeatsList["actor"] = {
	name : "Actor",
	source : [["P", 165]],
	descriptionFull : "Skilled at mimicry and dramatics, you gain the following benefits:\n \u2022 Increase your Charisma score by 1, to a maximum of 20.\n \u2022 You have advantage on Charisma (Deception) and Charisma (Performance) checks when trying to pass yourself off as a different person.\n \u2022 You can mimic the speech of another person or the sounds made by other creatures. You must have heard the person speaking, or heard the creature make the sound, for at least 1 minute. A successful Wisdom (Insight) check contested by your Charisma (Deception) check allows a listener to determine that the effect is faked.",
	description : "Advantage on Charisma (Deception) and (Performance) if trying to pass as another. I can mimic a person's speech or other creature's sounds if I've heard it for at least 1 minute. Wisdom (Insight) vs. Charisma (Deception) to determine the sound is faked. [+1 Charisma]",
	scores : [0, 0, 0, 0, 0, 1]
};
FeatsList["alert"] = {
	name : "Alert",
	source : [["P", 165]],
	descriptionFull : "Always on the lookout for danger, you gain the following benefits:\n \u2022 You gain a +5 bonus to initiative.\n \u2022 You can't be surprised while you are conscious.\n \u2022 Other creatures don't gain advantage on attack rolls against you as a result of being unseen by you.",
	description : "I can't be surprised while I'm conscious. I have a +5 bonus on initiative rolls. Other creatures don't gain advantage on attack rolls against me as a result of being hidden from me.",
	addMod : { type : "skill", field : "Init", mod : 5, text : "I have a +5 bonus on initiative rolls." }
};
FeatsList["athlete"] = {
	name : "Athlete",
	source : [["P", 165]],
	descriptionFull : "You have undergone extensive physical training to gain the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 When you are prone, standing up uses only 5 feet of your movement.\n \u2022 Climbing doesn't cost you extra movement.\n \u2022 You can make a running long jump or a running high jump after moving only 5 feet on foot, rather than 10 feet.",
	description : "Standing up from prone uses only 5 ft of movement. Climbing doesn't cost me extra movement. I can make a running long jump or a running high jump after moving only 5 feet on foot, rather than 10 feet. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity"
};
FeatsList["charger"] = {
	name : "Charger",
	source : [["P", 165]],
	descriptionFull : "When you use your action to Dash, you can use a bonus action to make one melee weapon attack or to shove a creature.\n   If you move at least 10 feet in a straight line immediately before taking this bonus action, you either gain a +5 bonus to the attack's damage roll (if you chose to make a melee attack and hit) or push the target up to 10 feet away from you (if you chose to shove and you succeed).",
	description : "As a bonus action after taking the Dash action, I can make one melee weapon attack or shove a creature. If I move at least 10 ft in a straight line before this bonus action, I add +5 damage to the attack or increase the distance up to 10 ft for the shove.",
	action : [["bonus action", " (after Dash action)"]]
};
FeatsList["crossbow expert"] = {
	name : "Crossbow Expert",
	source : [["P", 165]],
	descriptionFull : "Thanks to extensive practice with the crossbow, you gain the following benefits:\n \u2022 You ignore the loading quality of crossbows with which you are proficient.\n \u2022 Being within 5 feet of a hostile creature doesn't impose disadvantage on your ranged attack rolls.\n \u2022 When you use the Attack action and attack with a one-handed weapon, you can use a bonus action to attack with a hand crossbow you are holding.",
	description : "I ignore the loading quality of crossbows I'm proficient with. I don't suffer disadv. on ranged attack rolls for being within 5 ft of a hostile. When I attack with a one-handed weapon in my Attack action, I can use a bonus action to attack with a hand crossbow I'm holding.",
	action : ["bonus action", " (with Attack action)"],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if ((/crossbow/i).test(v.baseWeaponName) && fields.Proficiency) {
					fields.Description = fields.Description.replace(/(,? ?loading|loading,? ?)/i, '');
				};
			},
			"I ignore the loading quality of crossbows I'm proficient with."
		]
	}
};
FeatsList["defensive duelist"] = {
	name : "Defensive Duelist",
	source : [["P", 165]],
	descriptionFull : "When you are wielding a finesse weapon with which you are proficient and another creature hits you with a melee attack, you can use your reaction to add your proficiency bonus to your AC for that attack, potentially causing the attack to miss you.",
	description : "When wielding a finesse weapon with which I am proficient and another creature hits me with a melee attack, I can use my reaction to add my proficiency bonus to my AC for that attack, potentially causing the attack to miss me.",
	prerequisite : "Dexterity 13 or higher",
	prereqeval : function(v) { return What('Dex') >= 13; },
	action : ["reaction", " (when hit in melee)"]
};
FeatsList["dual wielder"] = {
	name : "Dual Wielder",
	source : [["P", 165]],
	descriptionFull : "You master fighting with two weapons, gaining the following benefits:\n \u2022 You gain a +1 bonus to AC while you are wielding a separate melee weapon in each hand.\n \u2022 You can use two-weapon fighting even when the one-handed melee weapons you are wielding aren't light.\n \u2022 You can draw or stow two one-handed weapons when you would normally be able to draw or stow only one.",
	description : "I can use two-weapon fighting even when the one-handed melee weapons I'm wielding aren't light. I can draw or stow two one-handed weapons when I would normally be able to draw or stow only one. +1 AC while wielding separate melee weapons in each hand.",
	extraAC : {
		mod : 1,
		text : "I gain a +1 bonus to AC when holding a melee weapon in each hand.",
		stopeval : function (v) { return v.usingShield && !(/animated/i).test(What("AC Shield Bonus Description")); }
	}
};
FeatsList["dungeon delver"] = {
	name : "Dungeon Delver",
	source : [["P", 166]],
	descriptionFull : "Alert to the hidden traps and secret doors found in many dungeons, you gain the following benefits:\n \u2022 You have advantage on Wisdom (Perception) and Intelligence (Investigation) checks made to detect the presence of secret doors.\n \u2022 You have advantage on saving throws made to avoid or resist traps.\n \u2022 You have resistance to the damage dealt by traps.\n \u2022 Traveling at a fast pace doesn't impose the normal -5 penalty on your passive Wisdom (Perception) score.",
	description : "I have adv. on Wis (Perception) and Int (Investigation) checks made to detect the presence of secret doors. I have resistance to damage dealt by traps and advantage on saves to avoid or resist traps. Travelling at a fast pace doesn't impose -5 on my passive Perception.",
	dmgres : ["Traps"],
	savetxt : { adv_vs : ["traps"] },
	vision : [["Adv. on Perception and Investigation for secret doors", 0], ["No -5 for travelling at fast pace", 0]]
};
FeatsList["durable"] = {
	name : "Durable",
	source : [["P", 166]],
	descriptionFull : "Hardy and resilient, you gain the following benefits:\n \u2022 Increase your Constitution score by 1, to a maximum of 20.\n \u2022 When you roll a Hit Die to regain hit points, the minimum number of hit points you regain from the roll equals twice your Constitution modifier (minimum of 2).",
	description : "When I roll a hit die to regain hit points, the minimum number of hit points I regain from the roll equals twice my Constitution modifier (minimum of 2). [+1 Constitution]",
	scores : [0, 0, 1, 0, 0, 0]
};
FeatsList["elemental adept"] = {
	name : "Elemental Adept",
	source : [["P", 166]],
	descriptionFull : "When you gain this feat, choose one of the following damage types: acid, cold, fire, lightning, or thunder.\n   Spells you cast ignore resistance to damage of the chosen type. In addition, when you roll damage for a spell you cast that deals damage of that type, you can treat any 1 on a damage die as a 2.\n\nYou can select this feat multiple times. Each time you do so, you must choose a different damage type.",
	description : "Choose one of the damage types: acid, cold, fire, lightning, or thunder. Spells I cast ignore resistance to damage from this damage type. For any spell I cast that deals this damage type, I can treat any 1 on a damage die as a 2.",
	prerequisite : "The ability to cast at least one spell",
	prereqeval : function(v) { return v.isSpellcaster; },
	allowDuplicates : true,
	choices : ["acid", "cold", "fire", "lightning", "thunder"],
	"acid" : {
		description : "Spells I cast ignore resistance to acid damage. For any spell I cast that deals acid damage, I can treat any 1 on a damage die as a 2."
	},
	"cold" : {
		description : "Spells I cast ignore resistance to cold damage. For any spell I cast that deals cold damage, I can treat any 1 on a damage die as a 2."
	},
	"fire" : {
		description : "Spells I cast ignore resistance to fire damage. For any spell I cast that deals fire damage, I can treat any 1 on a damage die as a 2."
	},
	"lightning" : {
		description : "Spells I cast ignore resistance to lightning damage. For any spell I cast that deals lightning damage, I can treat any 1 on a damage die as a 2."
	},
	"thunder" : {
		description : "Spells I cast ignore resistance to thunder damage. For any spell I cast that deals thunder damage, I can treat any 1 on a damage die as a 2."
	}
};
FeatsList["great weapon master"] = {
	name : "Great Weapon Master",
	source : [["P", 167]],
	descriptionFull : "You've learned to put the weight of a weapon to your advantage, letting its momentum empower your strikes. You gain the following benefits:\n \u2022 On your turn, when you score a critical hit with a melee weapon or reduce a creature to 0 hit points with one, you can make one melee weapon attack as a bonus action.\n \u2022 Before you make a melee attack with a heavy weapon that you are proficient with, you can choose to take a -5 penalty to the attack roll. If the attack hits, you add +10 to the attack's damage.",
	description : "If I score a critical hit or reduce a creature to 0 hit points with a melee weapon in my turn, I can make one melee weapon attack as a bonus action. With a heavy melee weapon, I can choose to take a -5 penalty on the attack roll for +10 on the attack's damage.",
	action : ["bonus action", " (after crit or take-down)"],
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if (v.isMeleeWeapon && (/heavy/i).test(fields.Description) && (/\bgwm\b|power.{0,3}attack|great.{0,3}weapon.{0,3}master/i).test(v.WeaponText)) {
					output.extraDmg += 10;
					output.extraHit -= 5;
				};
			},
			"If I include the words 'Power Attack', 'Great Weapon Master', or just 'GWM' in a heavy melee weapon's name or description, the calculation will put a -5 penalty on the attack's To Hit and +10 on its Damage."
		]
	}
};
FeatsList["healer"] = {
	name : "Healer",
	source : [["P", 167]],
	descriptionFull : "You are an able physician, allowing you to mend wounds quickly and get your allies back in the fight. You gain the following benefits:\n \u2022 When you use a healer's kit to stabilize a dying creature, that creature also regains 1 hit point.\n \u2022 As an action, you can spend one use of a healer's kit to tend to a creature and restore 1d6+4 hit points to it, plus additional hit points equal to the creature's maximum number of Hit Dice. The creature can't regain hit points from this feat again until it finishes a short or long rest.",
	description : "Using a healer's kit to stabilize someone gives them 1 hit point as well. As an action, I can spend one use of a healer's kit to restore 1d6 + 4 + (creature's HD) hit points. After that, the creature can't gain hit points from this feat again until it finishes a short rest.",
	action : ["action", " (1d6+4+HD with healing kit)"]
};
FeatsList["heavily armored"] = {
	name : "Heavily Armored",
	source : [["P", 167]],
	descriptionFull : "You have trained to master the use of heavy armor, gaining the following benefits:\n \u2022 Increase your Strength score by 1, to a maximum of 20.\n \u2022 You gain proficiency with heavy armor.",
	description : "I gain proficiency with heavy armor. [+1 Strength]",
	prerequisite : "Proficiency with medium armor",
	prereqeval : function(v) { return v.mediumArmorProf; },
	scores : [1, 0, 0, 0, 0, 0],
	armorProfs : [false, false, true, false]
};
FeatsList["heavy armor master"] = {
	name : "Heavy Armor Master",
	source : [["P", 167]],
	descriptionFull : "You can use your armor to deflect strikes that would kill others. You gain the following benefits:\n \u2022 While you are wearing heavy armor, bludgeoning, piercing, and slashing damage that you take from nonmagical weapons is reduced by 3.",
	description : "While wearing heavy armor, bludgeoning, piercing, and slashing damage taken from nonmagical weapons is reduced by 3. [+1 Strength]",
	prerequisite : "Proficiency with heavy armor",
	prereqeval : function(v) { return v.heavyArmorProf; },
	scores : [1, 0, 0, 0, 0, 0]
};
FeatsList["inspiring leader"] = {
	name : "Inspiring Leader",
	source : [["P", 167]],
	descriptionFull : "You can spend 10 minutes inspiring your companions, shoring up their resolve to fight. When you do so, choose up to six friendly creatures (which can include yourself) within 30 feet of you who can see or hear you and who can understand you. Each creature can gain temporary hit points equal to your level + your Charisma modifier. A creature can't gain temporary hit points from this feat again until it has finished a short or long rest.",
	calculate : "event.value = 'I can spend 10 minutes inspiring up to 6 friendly creatures within 30 feet who can see or hear and can understand me. Each gains lvl (' + What('Character Level') + ') + Cha mod (' + What('Cha Mod') + \") temporary hit points. One can't gain temporary hit points from this feat again until after a short rest.\";",
	prerequisite : "Charisma 13 or higher",
	prereqeval : function(v) { return What('Cha') >= 13; }
};
FeatsList["keen mind"] = {
	name : "Keen Mind",
	source : [["P", 167]],
	descriptionFull : "You have a mind that can track time, direction, and detail with uncanny precision. You gain the following benefits:\n \u2022 Increase your Intelligence score by 1, to a maximum of 20.\n \u2022 You always know which way is north.\n \u2022 You always know the number of hours left before the next sunrise or sunset.\n \u2022 You can accurately recall anything you have seen or heard within the past month.",
	description : "I always know which way is north and the number of hours left before the next sunrise or sunset. I can accurately recall anything I have seen or heard within the past month. [+1 Intelligence]",
	scores : [0, 0, 0, 1, 0, 0]
};
FeatsList["lightly armored"] = {
	name : "Lightly Armored",
	source : [["P", 167]],
	descriptionFull : "You have trained to master the use of light armor, gaining the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 You gain proficiency with light armor.",
	description : "I gain proficiency with light armor. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity",
	armorProfs : [true, false, false, false]
};
FeatsList["linguist"] = {
	name : "Linguist",
	source : [["P", 167]],
	descriptionFull : "You have studied languages and codes, gaining the following benefits:\n \u2022 Increase your Intelligence score by 1, to a maximum of 20.\n \u2022 You learn three languages of your choice.\n \u2022 You can ably create written ciphers. Others can't decipher a code you create unless you teach them, they succeed on an Intelligence check (DC equal to your Intelligence score + your proficiency bonus), or they use magic to decipher it.",
	calculate : "event.value = \"I can ably create written ciphers that others can't decipher unless I teach them, they succeed on an Intelligence check DC \" + (Number(What('Int')) + Number(How('Proficiency Bonus'))) + ' (Intelligence score + proficiency bonus), or they use magic to decipher it. I learn three languages of my choice. [+1 Intelligence]';",
	scores : [0, 0, 0, 1, 0, 0],
	languageProfs : [3]
};
FeatsList["lucky"] = {
	name : "Lucky",
	source : [["P", 167]],
	descriptionFull : "You have inexplicable luck that seems to kick in at just the right moment.\n   You have 3 luck points. Whenever you make an attack roll, an ability check, or a saving throw, you can spend one luck point to roll an additional d20. You can choose to spend one of your luck points after you roll the die, but before the outcome is determined. You choose which of the d20s is used for the attack roll, ability check, or saving throw.\n   You can also spend one luck point when an attack roll is made against you. Roll a d20, and then choose whether the attack uses the attacker's roll or yours. If more than one creature spends a luck point to influence the outcome of a roll, the points cancel each other out; no additional dice are rolled.\n   You regain your expended luck points when you finish a long rest.",
	description : "Use one of three luck points to roll an extra d20 for attacking, being attacked, an ability check, or a saving throw before the outcome is determined. If more than one creature uses luck, no extra dice are rolled. I regain expended luck points when I finish a long rest.",
	usages : 3,
	recovery : "long rest",
	additional : "attack/check/save"
};
FeatsList["mage slayer"] = {
	name : "Mage Slayer",
	source : [["P", 168]],
	descriptionFull : "You have practiced techniques useful in melee combat against spellcasters, gaining the following benefits:\n \u2022 When a creature within 5 feet of you casts a spell, you can use your reaction to make a melee weapon attack against that creature.\n \u2022 When you damage a creature that is concentrating on a spell, that creature has disadvantage on the saving throw it makes to maintain its concentration.\n \u2022 You have advantage on saving throws against spells cast by creatures within 5 feet of you.",
	description : "As a reaction, I can make a melee weapon attack on a creature within 5 ft of me that casts a spell. Concentration checks from damage from me are made with disadvantage. I have advantage on saving throws against spells cast by creatures within 5 feet of me.",
	savetxt : { adv_vs : ["spells cast within 5 ft"] },
	action : ["reaction", "Melee weapon attack (if spell cast in 5 ft)"]
};
FeatsList["magic initiate"] = {
	name : "Magic Initiate",
	source : [["P", 168]],
	descriptionFull : "Choose a class: bard, cleric, druid, sorcerer, warlock, or wizard. You learn two cantrips of your choice from that class's spell list.\n   In addition, choose one 1st-level spell to learn from that same list. Using this feat, you can cast the spell once at its lowest level, and you must finish a long rest before you can cast it in this way again.\n   Your spellcasting ability for these spells depends on the class you chose: Charisma for bard, sorcerer, or warlock; Wisdom for cleric or druid: or Intelligence for wizard.",
	description : "Select a spellcasting class using the square button on this feat line. I learn two cantrips and one 1st-level spell of my choice from that class' spell list. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot.",
	choices : ["Bard", "Cleric", "Druid", "Sorcerer", "Warlock", "Wizard"],
	"bard" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the bard's spell list. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot. If I'm a bard, I can also cast the 1st-level spell by expending a spell slot as normal. Charisma is my spellcasting ability for these spells.",
		spellcastingBonus : [{
			name : "Bard cantrip",
			spellcastingAbility : 6,
			'class' : 'bard',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Bard 1st-level spell",
			'class' : 'bard',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"cleric" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the cleric's spell list. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot. If I'm a cleric, I can also cast the 1st-level spell by expending a spell slot as normal. Wisdom is my spellcasting ability for these spells.",
		spellcastingBonus : [{
			name : "Cleric cantrip",
			spellcastingAbility : 5,
			'class' : 'cleric',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Cleric 1st-level spell",
			'class' : 'cleric',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"druid" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the druid's spell list. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot. If I'm a druid, I can also cast the 1st-level spell by expending a spell slot as normal. Wisdom is my spellcasting ability for these spells.",
		spellcastingBonus : [{
			name : "Druid cantrip",
			spellcastingAbility : 5,
			'class' : 'druid',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Druid 1st-level spell",
			'class' : 'druid',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"sorcerer" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the sorcerer's spell list. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot. If I'm a sorcerer, I can also cast the 1st-level spell by expending a spell slot as normal. Charisma is my spellcasting ability for these spells.",
		spellcastingBonus : [{
			name : "Sorcerer cantrip",
			spellcastingAbility : 6,
			'class' : 'sorcerer',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Sorcerer 1st-level spell",
			'class' : 'sorcerer',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"warlock" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the warlock's spell list. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot. If I'm a warlock, I can also cast the 1st-level spell by expending a spell slot as normal. Charisma is my spellcasting ability for these spells.",
		spellcastingBonus : [{
			name : "Warlock cantrip",
			spellcastingAbility : 6,
			'class' : 'warlock',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Warlock 1st-level spell",
			'class' : 'warlock',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"wizard" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the wizard's spell list. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot. If I'm a wizard, I can also cast the 1st-level spell by expending a spell slot as normal. Intelligence is my spellcasting ability for these spells.",
		spellcastingBonus : [{
			name : "Wizard cantrip",
			spellcastingAbility : 4,
			'class' : 'wizard',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Wizard 1st-level spell",
			'class' : 'wizard',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	}
};
FeatsList["martial adept"] = {
	name : "Martial Adept",
	source : [["P", 168]],
	descriptionFull : "You have martial training that allows you to perform special combat maneuvers. You gain the following benefits:\n \u2022 You learn two maneuvers of your choice from among those available to the Battle Master archetype in the fighter class. If a maneuver you use requires your target to make a saving throw to resist the maneuver's effects, the saving throw DC equals 8 + your proficiency bonus + your Strength or Dexterity modifier (your choice).\n \u2022 You gain one superiority die, which is a d6 (this die is added to any superiority dice you have from another source). This die is used to fuel your maneuvers. A superiority die is expended when you use it. You regain your expended superiority dice when you finish a short or long rest.",
	description : "",
	calculate : "event.value = 'I learn two maneuvers of my choice from those available to the Battle Master (2nd page \"Choose Feature\" button). The saving throw DC for this is ' + (8 + Number(How('Proficiency Bonus')) + Math.max(Number(What('Str Mod')), Number(What('Dex Mod')))) + ' (8 + proficiency bonus + Str/Dex mod). I gain one superiority die (d6), which I regain when I finish a short rest.';",
	bonusClassExtrachoices : [{
		"class" : "fighter",
		"subclass" : "fighter-battle master",
		"feature" : "subclassfeature3.1",
		"bonus" : 2
	}],
	extraLimitedFeatures : [{
		name : "Combat Superiority",
		usages : 1,
		additional : 'd6',
		recovery : "short rest",
		addToExisting : true
	}]
};
FeatsList["medium armor master"] = {
	name : "Medium Armor Master",
	source : [["P", 168]],
	descriptionFull : "You have practiced moving in medium armor to gain the following benefits:\n \u2022 Wearing medium armor doesn't impose disadvantage on your Dexterity (Stealth) checks.\n \u2022 When you wear medium armor, you can add 3, rather than 2, to your AC if you have a Dexterity of 16 or higher.",
	description : "Wearing medium armor doesn't impose disadvantage on my Dexterity (Stealth) checks. When I wear medium armor, I can add up to 3, rather than 2, to my AC if my Dexterity is 16 or higher.",
	prerequisite : "Proficiency with medium armor",
	prereqeval : function(v) { return v.mediumArmorProf; },
	eval : function () {
		Value('Medium Armor Max Mod', 3);
		ApplyArmor(What("AC Armor Description"));
	},
	removeeval : function () {
		tDoc.resetForm(['Medium Armor Max Mod']);
		ApplyArmor(What("AC Armor Description"));
	}
};
FeatsList["mobile"] = {
	name : "Mobile",
	source : [["P", 168]],
	descriptionFull : "You are exceptionally speedy and agile. You gain the following benefits:\n \u2022 Your speed increases by 10 feet.\n \u2022 When you use the Dash action, difficult terrain doesn't cost you extra movement on that turn.\n \u2022 When you make a melee attack against a creature, you don't provoke opportunity attacks from that creature for the rest of the turn, whether you hit or not.",
	description : "When I use the Dash action, difficult terrain doesn't cost me extra movement that turn. When I make a melee attack against a creature, I don't provoke opportunity attacks from that creature for the rest of the turn, whether I hit or not. [+10 ft speed]",
	speed : { allModes : "+10" }
};
FeatsList["moderately armored"] = {
	name : "Moderately Armored",
	source : [["P", 168]],
	descriptionFull : "You have trained to master the use of medium armor and shields, gaining the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 You gain proficiency with medium armor and shields.",
	description : "I gain proficiency with medium armor and shields. [+1 Strength or Dexterity]",
	prerequisite : "Proficiency with light armor",
	prereqeval : function(v) { return v.lightArmorProf; },
	scorestxt : "+1 Strength or Dexterity",
	armorProfs : [false, true, false, true]
};
FeatsList["mounted combatant"] = {
	name : "Mounted Combatant",
	source : [["P", 168]],
	descriptionFull : "You are a dangerous foe to face while mounted. While you are mounted and aren't incapacitated, you gain the following benefits:\n \u2022 You have advantage on melee attack rolls against any unmounted creature that is smaller than your mount.\n \u2022 You can force an attack targeted at your mount to target you instead.\n \u2022 If your mount is subjected to an effect that allows it to make a Dexterity saving throw to take only half damage, it instead takes no damage if it succeeds on the saving throw, and only half damage if it fails.",
	description : "I have advantage on melee attack rolls against unmounted creatures smaller than my mount. I can force attacks targeting my mount to target me instead. When a Dex save would halve damage, my mount takes no damage on success and half damage on failure."
};
FeatsList["observant"] = {
	name : "Observant",
	source : [["P", 168]],
	descriptionFull : "Quick to notice details of your environment, you gain the following benefits:\n \u2022 Increase your Intelligence or Wisdom score by 1, to a maximum of 20.\n \u2022 If you can see a creature's mouth while it is speaking a language you understand, you can interpret what it's saying by reading its lips.\n \u2022 You have a +5 bonus to your passive Wisdom (Perception) and passive Intelligence (Investigation) scores.",
	description : "If I can see a creature's mouth while it is speaking a language I understand, I can interpret what it's saying by reading its lips. I have a +5 bonus to passive Wisdom (Perception) and passive Intelligence (Investigation) scores. [+1 Intelligence or Wisdom]",
	scorestxt : "+1 Intelligence or Wisdom",
	addMod : { type : "skill", field : "passive perception", mod : 5, text : "I have a +5 bonus to passive Wisdom (Perception)." }
};
FeatsList["polearm master"] = {
	name : "Polearm Master",
	source : [["P", 168]],
	descriptionFull : "You can keep your enemies at bay with reach weapons. You gain the following benefits:\n \u2022 When you take the Attack action and attack with only a glaive, halberd, quarterstaff, or spear, you can use a bonus action to make a melee attack with the opposite end of the weapon; this attack uses the same ability modifier as the primary attack. The weapon's damage die for this attack is a d4, and the attack deals bludgeoning damage.\n \u2022 While you are wielding a glaive, halberd, pike, quarterstaff, or spear, other creatures provoke an opportunity attack from you when they enter your reach.",
	description : "As a bonus action when I do the Attack action with a glaive/" + (typePF ? " " : "") + "halberd/quarterstaff/spear, I can make a 1d4 bludgeoning attack with its butt end." + (typePF ? "\n" : " ") + "While wielding a glaive/halberd/" + (typePF ? "" : " ") + "pike/quarterstaff/spear, I get an opportunity attack when a creature enters my reach.",
	weaponOptions : [{
		regExpSearch : /^(?=.*(polearm|(glaive|guandao|bisento|naginata)|(halberd|\bji\b|kamayari)|(quarterstaff|\bstaff\b|\bbo\b)|(spear|qiang|\byaris?\b)))(?=.*butt)(?=.*end).*$/i,
		name : "Polearm Butt End",
		source : [["P", 168]],
		ability : 1,
		type : "polearm butt end",
		damage : [1, 4, "bludgeoning"],
		range : "Melee",
		description : "As bonus action after Attack action with only a glaive, halberd, spear, or quarterstaff",
		abilitytodamage : true,
		selectNow : true
	}],
	action : ['bonus action', 'Butt End Attack (after attack with polearm)'],
	weaponProfs : [false, false, ["polearm butt end"]]
};
FeatsList["resilient"] = {
	name : "Resilient",
	source : [["P", 168]],
	descriptionFull : "Choose one ability score. You gain the following benefits:\n \u2022 Increase the chosen ability score by 1, to a maximum of 20.\n \u2022 You gain proficiency in saving throws using the chosen ability.",
	description : "Select an ability score using the square button on this feat line. I gain proficiency with the saving throw of that ability score and a +1 added to it.",
	choices : ["Strength", "Dexterity", "Constitution", "Intelligence", "Wisdom", "Charisma"],
	"strength" : {
		description : "I gain proficiency with Strength saving throws. [+1 Strength]",
		scores : [1, 0, 0, 0, 0, 0],
		saves : ["Str"]
	},
	"dexterity" : {
		description : "I gain proficiency with Dexterity saving throws. [+1 Dexterity]",
		scores : [0, 1, 0, 0, 0, 0],
		saves : ["Dex"]
	},
	"constitution" : {
		description : "I gain proficiency with Constitution saving throws. [+1 Constitution]",
		scores : [0, 0, 1, 0, 0, 0],
		saves : ["Con"]
	},
	"intelligence" : {
		description : "I gain proficiency with Intelligence saving throws. [+1 Intelligence]",
		scores : [0, 0, 0, 1, 0, 0],
		saves : ["Int"]
	},
	"wisdom" : {
		description : "I gain proficiency with Wisdom saving throws. [+1 Wisdom]",
		scores : [0, 0, 0, 0, 1, 0],
		saves : ["Wis"]
	},
	"charisma" : {
		description : "I gain proficiency with Charisma saving throws. [+1 Charisma]",
		scores : [0, 0, 0, 0, 0, 1],
		saves : ["Cha"]
	}
};
FeatsList["ritual caster"] = {
	name : "Ritual Caster",
	source : [["P", 169]],
	descriptionFull : "You have learned a number of spells that you can cast as rituals. These spells are written in a ritual book, which you must have in hand while casting one of them.\n   When you choose this feat, you acquire a ritual book holding two 1st-level spells of your choice. Choose one of the following classes: bard, cleric, druid, sorcerer, warlock, or wizard. You must choose your spells from that class's spell list, and the spells you choose must have the ritual tag. The class you choose also determines your spellcasting ability for these spells: Charisma for bard, sorcerer, or warlock; Wisdom for cleric or druid; or Intelligence for wizard.\n   If you come across a spell in written form, such as a magical spell scroll or a wizard's spellbook, you might be able to add it to your ritual book. The spell must be on the spell list for the class you chose, the spell's level can be no higher than half your level (rounded up), and it must have the ritual tag. The process of copying the spell into your ritual book takes 2 hours per level of the spell, and costs 50 gp per level. The cost represents material components you expend as you experiment with the spell to master it, as well as the fine inks you need to record it.",
	description : "Select a spellcasting class using the square button on this feat line. I gain a book with two 1st-level ritual spells from that class' spell list. I can transcribe more ritual spells into this book and cast them as rituals only.",
	prerequisite : "Intelligence or Wisdom 13 or higher",
	prereqeval : function(v) { return What('Int') >= 13 || What('Wis') >= 13; },
	commoneval : function(chc, spellAbility) {
		if (!chc) return;
		CurrentSpells['ritual caster ' + chc] = {
			name : 'Ritual Book [' + chc.capitalize() + ']',
			ability : spellAbility,
			list : {"class" : chc, ritual : true},
			known : {spells : 'book'},
			refType : "feat"
		};
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	commonremoveeval : function(chc) {
		if (!chc) return;
		delete CurrentSpells['ritual caster ' + chc];
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.ritualCasterFeatChange && spName.indexOf("ritual caster ") !== -1) {
					spellObj.ritualCasterFeatChange = true;
					spellObj.firstCol = "(R)";
					if (!(/.*(\d+ ?h\b|special|see b).*/i).test(spellObj.time)) {
						var numMinutes = Number(spellObj.time.replace(/(\d+) ?min.*/, "$1"));
						if (isNaN(numMinutes)) numMinutes = 0;
						spellObj.time = (numMinutes + 10) + " min";
					}
					return true;
				};
			},
			"By the Ritual Caster feat, I can cast ritual spells from my Ritual Book. Casting a spell as a ritual means adding 10 minutes to its casting time."
		]
	},
	choices : ["Bard", "Cleric", "Druid", "Sorcerer", "Warlock", "Wizard"],
	"bard" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual bard spells.\nI can copy ritual bard spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Charisma is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 6); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"cleric" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual cleric spells.\nI can copy ritual cleric spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Wisdom is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 5); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"druid" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual druid spells.\nI can copy ritual druid spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Wisdom is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 5); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"sorcerer" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual sorcerer spells.\nI can copy ritual sorcerer spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Charisma is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 6); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"warlock" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual warlock spells.\nI can copy ritual warlock spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Charisma is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 6); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"wizard" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual wizard spells.\nI can copy ritual wizard spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Intelligence is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 4); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	}
};
FeatsList["savage attacker"] = {
	name : "Savage Attacker",
	source : [["P", 169]],
	descriptionFull : "Once per turn when you roll damage for a melee weapon attack, you can reroll the weapon's damage dice and use either total.",
	description : "Once per turn, when I roll damage for a melee weapon attack, I can reroll the weapon's damage dice and use either total."
};
FeatsList["sentinel"] = {
	name : "Sentinel",
	source : [["P", 169]],
	descriptionFull : "You have mastered techniques to take advantage of every drop in any enemy's guard, gaining the following benefits:\n \u2022 When you hit a creature with an opportunity attack, the creature's speed becomes 0 for the rest of the turn.\n \u2022 Creatures provoke opportunity attacks from you even if they take the Disengage action before leaving your reach.\n \u2022 When a creature within 5 feet of you makes an attack against a target other than you (and that target doesn't have this feat), you can use your reaction to make a melee weapon attack against the attacking creature.",
	description : "Creatures I hit with opportunity attacks have 0 speed for this turn. The Disengage action doesn't work on me. When a creature within 5 ft makes an attack against a target other than me, I can use my reaction to make a melee weapon attack against the attacker.",
	action : ["reaction", " (after attack on ally)"]
};
FeatsList["sharpshooter"] = {
	name : "Sharpshooter",
	source : [["P", 170]],
	descriptionFull : "You have mastered ranged weapons and can make shots that others find impossible. You gain the following benefits:\n \u2022 Attacking at long range doesn't impose disadvantage on your ranged weapon attack rolls.\n \u2022 Your ranged weapon attacks ignore half cover and three-quarters cover.\n \u2022 Before you make an attack with a ranged weapon that you are proficient with, you can choose to take a -5 penalty to the attack roll. If the attack hits, you add +10 to the attack's damage.",
	description : "My ranged weapon attacks don't have disadvantage on long range and ignore half cover and three-quarters cover. With a ranged weapon that I am proficient with, I can choose to take a -5 penalty on the attack roll for +10 on the attack's damage.",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.isRangedWeapon || v.isThrownWeapon) {
					fields.Description += (fields.Description ? '; ' : '') + "No disadv. at long range; Ignore \u00BD and \u00BE cover";
				};
			},
			"My ranged weapon attacks suffer no disadvantage for long range and ignore half cover and three-quarters cover. This includes thrown weapons.\n \u2022 If I include the words 'Power Attack', 'Sharpshooter', or 'Sharpshot' in the name or description of a ranged weapon that I'm proficient with, the calculation will put a -5 penalty on the attack's To Hit and a +10 bonus to its Damage. This does not work with thrown weapons."
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isRangedWeapon && fields.Proficiency && /power.{0,3}attack|sharp.{0,3}shoo?t/i.test(v.WeaponText)) {
					output.extraDmg += 10;
					output.extraHit -= 5;
				};
			}, ''
		]
	}
};
FeatsList["shield master"] = {
	name : "Shield Master",
	source : [["P", 170]],
	descriptionFull : "You use shields not just for protection but also for offense. You gain the following benefits while you are wielding a shield:\n \u2022 If you take the Attack action on your turn, you can use a bonus action to try to shove a creature within 5 feet of you with your shield.\n \u2022 If you aren't incapacitated, you can add your shield's AC bonus to any Dexterity saving throw you make against a spell or other harmful effect that targets only you.\n \u2022 If you are subjected to an effect that allows you to make a Dexterity saving throw to take only half damage, you can use your reaction to take no damage if you succeed on the saving throw, interposing your shield between yourself and the source of the effect.",
	description : "As a bonus action, when I use the Attack action, I can shove someone within 5 ft with my shield. I add my shield's AC bonus to Dex saves vs. effects targeting only me. As a reaction, if I succeed on a Dex save for half damage, I can interpose my shield to avoid the damage.",
	action : [['bonus action', 'Shove with shield (with Attack action)'], ['reaction', 'Interpose shield (if Dex save half dmg)']]
};
FeatsList["skilled"] = {
	name : "Skilled",
	source : [["P", 170]],
	descriptionFull : "You gain proficiency in any combination of three skills or tools of your choice.",
	description : "I gain proficiency with any combination of three skills or tools of my choice.",
	skillstxt : "Choose three skills or tools"
};
FeatsList["skulker"] = {
	name : "Skulker",
	source : [["P", 170]],
	descriptionFull : "You are expert at slinking through shadows. You gain the following benefits:\n \u2022 You can try to hide when you are lightly obscured from the creature from which you are hiding.\n \u2022 When you are hidden from a creature and miss it with a ranged weapon attack, making the attack doesn't reveal your position.\n \u2022 Dim light doesn't impose disadvantage on your Wisdom (Perception) checks relying on sight.",
	description : "I can try to hide when I am lightly obscured. My position is not revealed when I am hidden from a creature and miss it with a ranged weapon attack. Dim light doesn't impose disadvantage on my Wisdom (Perception) checks relying on sight.",
	prerequisite : "Dexterity 13 or higher",
	prereqeval : function(v) { return What('Dex') >= 13; },
	vision : [["No disadv. on Perception in dim light", 0]]
};
FeatsList["spell sniper"] = {
	name : "Spell Sniper",
	source : [["P", 170]],
	descriptionFull : "You have learned techniques to enhance your attacks with certain kinds of spells, gaining the following benefits:\n \u2022 When you cast a spell that requires you to make an attack roll, the spell's range is doubled.\n \u2022 Your ranged spell attacks ignore half cover and three-quarters cover.\n \u2022 You learn one cantrip that requires an attack roll. Choose the cantrip from the bard, cleric, druid, sorcerer, warlock, or wizard spell list. Your spellcasting ability for this cantrip depends on the spell list you chose from: Charisma for bard, sorcerer, or warlock; Wisdom for cleric or druid; or Intelligence for wizard.",
	description : "Select a spellcasting class using the square button on this feat line. I learn one cantrip requiring an attack roll from the spell list of the chosen class. Any spell I cast requiring an attack roll has its range doubled and ignores half and 3/4 cover.",
	prerequisite : "The ability to cast at least one spell",
	prereqeval : function(v) { return v.isSpellcaster; },
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.spellSniper && !v.isDC && v.isSpell && (/\d+ ?(f.{0,2}t|m)/i).test(fields.Range)) {
					v.spellSniper = true;
					var rangeNmbr = fields.Range.match(/\d+([.,]\d+)?/g);
					var notNmbrs = fields.Range.split(RegExp(rangeNmbr.join('|')));
					fields.Range = '';
					rangeNmbr.forEach(function (dR, idx) {
						fields.Range += (notNmbrs[idx] ? notNmbrs[idx] : '') + (parseFloat(dR.toString().replace(',', '.') * 2));
					});
					if (notNmbrs.length > rangeNmbr.length) {
						fields.Range += notNmbrs[notNmbrs.length - 1];
					};
					if (!v.rangeM) {
						v.rangeM = 2;
					} else {
						v.rangeM *= 2;
					}
				};
			},
			"My spells and cantrips that require an attack roll have their range doubled.",
			700
		],
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if ( !spellObj.spellSniper && !spellObj.psionic && (/spell attack/i).test(spellObj.description + spellObj.descriptionFull) && (/^(?!.*(S:|rad|touch|self|cone|cube)).*\d+([.,]\d+)?[\- ]?(f.{0,2}t|m).*$/i).test(spellObj.range) ) {
					spellObj.spellSniper = true;
					var rangeNmbr = spellObj.range.match(/\d+([.,]\d+)?/g);
					var notNmbrs = spellObj.range.split(RegExp(rangeNmbr.join('|')));
					spellObj.range = '';
					rangeNmbr.forEach(function (dR, idx) {
						spellObj.range += (notNmbrs[idx] ? notNmbrs[idx] : '') + (parseFloat(dR.toString().replace(',', '.') * 2));
					});
					if (notNmbrs.length > rangeNmbr.length) {
						spellObj.range += notNmbrs[notNmbrs.length - 1];
					};
					if (!spellObj.rangeM) {
						spellObj.rangeM = 2;
					} else {
						spellObj.rangeM *= 2;
					}
					return true;
				};
			},
			"My spells and cantrips that require an attack roll have their range doubled.",
			700
		]
	},
	choices : ["Bard", "Cleric", "Druid", "Sorcerer", "Warlock", "Wizard"],
	"bard" : {
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one bard cantrip that requires an attack roll. Charisma is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 6,
			'class' : 'bard',
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	},
	"cleric" : {
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one cleric cantrip that requires an attack roll. Wisdom is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 5,
			'class' : 'cleric',
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	},
	"druid" : {
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one druid cantrip that requires an attack roll. Wisdom is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 5,
			'class' : 'druid',
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	},
	"sorcerer" : {
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one sorcerer cantrip that requires an attack roll. Charisma is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 6,
			'class' : 'sorcerer',
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	},
	"warlock" : {
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one warlock cantrip that requires an attack roll. Charisma is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 6,
			'class' : 'warlock',
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	},
	"wizard" : {
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one wizard cantrip that requires an attack roll. Intelligence is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 4,
			'class' : 'wizard',
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	}
};
FeatsList["tavern brawler"] = {
	name : "Tavern Brawler",
	source : [["P", 170]],
	descriptionFull : "Accustomed to rough-and-tumble fighting using whatever weapons happen to be at hand, you gain the following benefits:\n \u2022 Increase your Strength or Constitution score by 1, to a maximum of 20.\n \u2022 You are proficient with improvised weapons.\n \u2022 Your unarmed strike uses a d4 for damage.\n \u2022 When you hit a creature with an unarmed strike or an improvised weapon on your turn, you can use a bonus action to attempt to grapple the target.",
	description : "I am proficient with improvised weapons. My unarmed strike does 1d4 damage. When I hit a creature with an unarmed strike or improvised weapon on my turn, I can attempt to grapple the target as a bonus action. [+1 Strength or Constitution]",
	scorestxt : "+1 Strength or Constitution",
	action : ['bonus action', 'Grapple (on hit with unarmed/improv.)'],
	weaponProfs : [false, false, ["Improvised weapons"]],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == "unarmed strike" || (/improvised/i).test(v.WeaponName + v.baseWeaponName) || (/improvised weapon/i).test(v.theWea.type)) {
					fields.Proficiency = true;
					if (v.isMeleeWeapon) fields.Description += (fields.Description ? '; ' : '') + 'After hit, can attempt to grapple as a bonus action';
				};
				if (v.baseWeaponName == "unarmed strike" && fields.Damage_Die == 1) {
					fields.Damage_Die = '1d4';
				};
			},
			"My unarmed strikes deal 1d4 damage instead of 1.\n \u2022 After hitting a creature with an unarmed strike or improvised weapon in melee, I can attempt to start a grapple as a bonus action."
		]
	}
};
FeatsList["tough"] = {
	name : "Tough",
	source : [["P", 170]],
	descriptionFull : "Your hit point maximum increases by an amount equal to twice your level when you gain this feat. Whenever you gain a level thereafter, your hit point maximum increases by an additional 2 hit points.",
	description : "My hit point maximum increases by an amount equal to twice my character level.",
	calcChanges : {
		hp : function (totalHD) {
			return [totalHD * 2, '\n + ' + totalHD + ' \xD7 2 from the Tough feat (' + (totalHD * 2) + ')', true];
		}
	}
};
FeatsList["war caster"] = {
	name : "War Caster",
	source : [["P", 170]],
	prerequisite : "The ability to cast at least one spell",
	prereqeval : function(v) { return v.isSpellcaster; },
	descriptionFull : "You have practiced casting spells in the midst of combat, learning techniques that grant you the following benefits:\n \u2022 You have advantage on Constitution saving throws that you make to maintain your concentration on a spell when you take damage.\n \u2022 You can perform the somatic components of spells even when you have weapons or a shield in one or both hands.\n \u2022 When a hostile creature's movement provokes an opportunity attack from you, you can use your reaction to cast a spell at the creature, rather than making an opportunity attack. The spell must have a casting time of 1 action and must target only that creature.",
	description : "Advantage on Con saves to maintain concentration on spells when damaged. Perform somatic components even when holding weapons or shield in one or both hands. Cast spell of 1 action casting time that targets only one creature instead of an opportunity attack.",
	action : ["reaction", " - Opportunity Spell"],
	savetxt : { text : "Adv. on Con (Concentration) saves when damaged" }
};
FeatsList["weapon master"] = {
	name : "Weapon Master",
	source : [["P", 170]],
	descriptionFull : "You have practiced extensively with a variety of weapons, gaining the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 You gain proficiency with four simple or martial weapons of your choice.",
	description : "I gain proficiency with four simple or martial weapons of my choice.\n[+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity"
};

// Add attack entry that is not in the SRD
WeaponsList["thorn whip"] = {
	regExpSearch : /^(?=.*thorn)(?=.*whip).*$/i,
	name : "Thorn Whip",
	source : [["P", 282]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 6, "piercing"],
	range : "Melee, 30 ft",
	description : "Melee spell attack, pull target up to 10 ft closer",
	abilitytodamage : false
};

// Add spells that are not in the SRD
SpellsList["arcane gate"] = {
	name : "Arcane Gate",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["P", 214]],
	level : 6,
	school : "Conj",
	time : "1 a",
	range : "500 ft",
	components : "V,S",
	duration : "Conc, 10 min",
	description : "Two portals, up to 500 ft apart, teleport any to other side; portals are filled with opaque mist",
	descriptionFull : "You create linked teleportation portals that remain open for the duration. Choose two points on the ground that you can see, one point within 10 feet of you and one point within 500 feet of you. A circular portal, 10 feet in diameter, opens over each point. If the portal would open in the space occupied by a creature, the spell fails, and the casting is lost." + "\n   " + "The portals are two-dimensional glowing rings filled with mist, hovering inches from the ground and perpendicular to it at the points you choose. A ring is visible only from one side (your choice), which is the side that functions as a portal." + "\n   " + "Any creature or object entering the portal exits from the other portal as if the two were adjacent to each other, passing through a portal from the non-portal side has no effect. The mist that fills each portal is opaque and blocks vision through it. On your turn, you can rotate the rings as a bonus action so that the active side faces in a different direction."
};
SpellsList["armor of agathys"] = {
	name : "Armor of Agathys",
	classes : ["warlock"],
	source : [["P", 215]],
	level : 1,
	school : "Abjur",
	time : "1 a",
	range : "Self",
	components : "V,S,M",
	compMaterial : "A cup of water",
	duration : "1 h",
	description : "5+5/SL temp HP; as long as temp HP last any crea that hits in melee takes 5+5/SL Cold dmg",
	descriptionFull : "A protective magical force surrounds you, manifesting as a spectral frost that covers you and your gear. You gain 5 temporary hit points for the duration. If a creature hits you with a melee attack while you have these hit points, the creature takes 5 cold damage." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, both the temporary hit points and the cold damage increase by 5 for each slot level above 1st."
};
SpellsList["arms of hadar"] = {
	name : "Arms of Hadar",
	classes : ["warlock"],
	source : [["P", 215]],
	level : 1,
	school : "Conj",
	time : "1 a",
	range : "S:10-ft rad",
	components : "V,S",
	duration : "Instantaneous",
	save : "Str",
	description : "2d6+1d6/SL Necrotic dmg; save halves; on failed save no reactions until next turn",
	descriptionFull : "You invoke the power of Hadar, the Dark Hunger. Tendrils of dark energy erupt from you and batter all creatures within 10 feet of you. Each creature in that area must make a Strength saving throw. On a failed save, a target takes 2d6 necrotic damage and can't take reactions until its next turn. On a successful save, the creature takes half damage, but suffers no other effect." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
};
SpellsList["aura of life"] = {
	name : "Aura of Life",
	classes : ["paladin"],
	source : [["P", 216]],
	level : 4,
	school : "Abjur",
	time : "1 a",
	range : "S:30-ft rad",
	components : "V",
	duration : "Conc, 10 min",
	description : "Me + any crea while in area Necrotic dmg resist.; at turn start, 0 HP living in area heal 1 HP",
	descriptionFull : "Life-preserving energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. Each non-hostile creature in the aura (including you) has resistance to necrotic damage, and its hit point maximum can't be reduced. In addition, a non-hostile, living creature regains 1 hit point when it starts its turn in the aura with 0 hit points."
};
SpellsList["aura of purity"] = {
	name : "Aura of Purity",
	classes : ["paladin"],
	source : [["P", 216]],
	level : 4,
	school : "Abjur",
	time : "1 a",
	range : "S:30-ft rad",
	components : "V",
	duration : "Conc, 10 min",
	description : "Me + any crea while in area Poison dmg resist., immune to disease, adv. on saves vs. conditions",
	descriptionFull : "Purifying energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. Each non-hostile creature in the aura (including you) can't become diseased, has resistance to poison damage, and has advantage on saving throws against effects that cause any of the following conditions - blinded, charmed, deafened, frightened, paralyzed, poisoned, and stunned."
};
SpellsList["aura of vitality"] = {
	name : "Aura of Vitality",
	classes : ["paladin"],
	source : [["P", 216]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "S:30-ft rad",
	components : "V",
	duration : "Conc, 1 min",
	description : "As a bonus action for the duration, I can heal 2d6 HP to 1 creature in range (can be me)",
	descriptionFull : "Healing energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. You can use a bonus action to cause one creature in the aura (including you) to regain 2d6 hit points."
};
SpellsList["banishing smite"] = {
	name : "Banishing Smite",
	classes : ["paladin"],
	source : [["P", 216]],
	level : 5,
	school : "Abjur",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	description : "Next weapon hit +5d10 Force dmg; if this brings target HP<50, I banish it until spell ends",
	descriptionFull : "The next time you hit a creature with a weapon attack before this spell ends, your weapon crackles with force, and the attack deals an extra 5d10 force damage to the target. Additionally, if this attack reduces the target to 50 hit points of fewer, you banish it. If the target is native to a different plane of existence than the one you're on, the target disappears, returning to its home plane. If the target is native to the plane you're on, the creature vanishes into a harmless demiplane. While there, the target is incapacitated. It remains there until the spell ends, at which point the tart reappears in the space it left or in the nearest unoccupied space if that space is occupied."
};
SpellsList["beast sense"] = {
	name : "Beast Sense",
	classes : ["druid", "ranger"],
	source : [["P", 217]],
	ritual : true,
	level : 2,
	school : "Div",
	time : "1 a",
	range : "Touch",
	components : "S",
	duration : "Conc, 1 h",
	description : "Use 1 willing beast's senses; I'm blinded and deafened while doing so",
	descriptionFull : "You touch a willing beast. For the duration of the spell, you can use your action to see through the beast's eyes and hear what it hears, and continue to do so until you use your action to return to your normal senses."
};
SpellsList["blade ward"] = {
	name : "Blade Ward",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["P", 218]],
	level : 0,
	school : "Abjur",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "1 rnd",
	description : "Until the end of my next turn, Bludgeoning, Piercing, and Slashing dmg resist. vs. weapons",
	descriptionFull : "You extend your hand and trace a sigil of warding in the air. Until the end of your next turn, you have resistance against bludgeoning, piercing, and slashing damage dealt by weapon attacks."
};
SpellsList["blinding smite"] = {
	name : "Blinding Smite",
	classes : ["paladin"],
	source : [["P", 219]],
	level : 3,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Con",
	description : "Next melee weapon hit +3d8 Radiant dmg; save or blinded; extra save at end of every turn",
	descriptionFull : "The next time you hit a creature with a melee weapon attack during this spell's duration, you weapon flares with a bright light, and the attack deals an extra 3d8 radiant damage to the target. Additionally, the target must succeed on a Constitution saving throw or be blinded until the spell ends." + "\n   " + "A creature blinded by this spell makes another Constitution saving throw at the end of each of its turns. On a successful save, it is no longer blinded."
};
SpellsList["chromatic orb"] = {
	name : "Chromatic Orb",
	classes : ["sorcerer", "wizard"],
	source : [["P", 221]],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A diamond worth at least 50 gp",
	duration : "Instantaneous",
	description : "Spell attack for 3d8+1d8/SL Acid, Cold, Fire, Lightning, Poison or Thunder dmg (50gp)",
	descriptionFull : "You hurl a 4-inch-diameter sphere of energy at a creature that you can see within range. You choose acid, cold, fire, lightning, poison, or thunder for the type of orb you create, and then make a ranged spell attack against the target. If the attack hits, the creature takes 3d8 damage of the type you chose." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st.",
	dynamicDamageBonus : {
		multipleDmgTypes : {
			dmgTypes : ["acid", "cold", "fire", "lightning", "poison", "thunder"],
			inDescriptionAs :"Acid, Cold, Fire, Lightning, Poison or Thunder"
		}
	}
};
SpellsList["circle of power"] = {
	name : "Circle of Power",
	classes : ["paladin"],
	source : [["P", 221]],
	level : 5,
	school : "Abjur",
	time : "1 a",
	range : "S:30-ft rad",
	components : "V",
	duration : "Conc, 10 min",
	description : "Any crea while in area adv. on saves vs. magical effects; if save would half dmg it takes no dmg",
	descriptionFull : "Divine energy radiates from you, distorting and diffusing magical energy within 30 feet of you. Until the spell ends, the sphere moves with you, centered on you. For the duration, each friendly creature in the area (including you) has advantage on saving throws against spells and other magical effects. Additionally, when an affected creature succeeds on a saving throw made against a spell or magical effect that allows it to make a saving throw to take only half damage, it instead takes no damage if it succeeds on the saving throw."
};
SpellsList["cloud of daggers"] = {
	name : "Cloud of Daggers",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["P", 222]],
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A sliver of glass",
	duration : "Conc, 1 min",
	description : "5-ft cube 4d4+2d4/SL Slashing dmg to all that enter or start turn in area",
	descriptionFull : "You fill the air with spinning daggers in a cube 5 feet on each side, centered on a point you choose within range. A creature takes 4d4 slashing damage when it enters the spell's area for the first time on a turn or starts its turn there." + AtHigherLevels + "when you cast this spell using a spell slot of 3rd level or higher, the damage increases by 2d4 for each slot level above 2nd."
};
SpellsList["compelled duel"] = {
	name : "Compelled Duel",
	classes : ["paladin"],
	source : [["P", 224]],
	level : 1,
	school : "Ench",
	time : "1 bns",
	range : "30 ft",
	components : "V",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "1 crea save or dis. on attacks vs. not-me and save if moving more than 30 ft away",
	descriptionFull : "You attempt to compel a creature into a duel. One creature that you can see within range must make a Wisdom saving throw. On a failed save, the creature is drawn to you, compelled by your divine demand. For the duration, it has disadvantage on attack rolls against creatures other than you, and must make a Wisdom saving throw each time it attempts to move to a space that is more than 30 feet away from you, if it succeeds on this saving throw, this spell doesn't restrict the target's movement for that turn." + "\n   " + "The spell ends if you attack any other creature, if you cast a spell that targets a hostile creature other than the target, if a creature friendly to you damages the target or casts a harmful spell on it, or if you end your turn more than 30 feet away from the target."
};
SpellsList["conjure barrage"] = {
	name : "Conjure Barrage",
	classes : ["ranger"],
	source : [["P", 225]],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "S:60" + (typePF ? "-" : "") + "ft cone",
	components : "V,S,M",
	compMaterial : "One piece of ammunition or a thrown weapon",
	duration : "Instantaneous",
	save : "Dex",
	description : "Throw weapon or ammo; copies rain down for 3d8 dmg; dmg type as weapon; save halves",
	descriptionFull : "You throw a nonmagical weapon or fire a piece of nonmagical ammunition into the air to create a cone of identical weapons that shoot forward and then disappear. Each creature in a 60-foot cone must succeed on a Dexterity saving throw. A creature takes 3d8 damage on a failed save, or half as much damage on a successful one. The damage type is the same as that of the weapon or ammunition used as a component."
};
SpellsList["conjure volley"] = {
	name : "Conjure Volley",
	classes : ["ranger"],
	source : [["P", 226]],
	level : 5,
	school : "Conj",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "One piece of ammunition or one thrown weapon",
	duration : "Instantaneous",
	save : "Dex",
	description : "Turn ammo/thrown wea into volley; 40-ft rad 20-ft high 8d8 dmg; dmg type as weapon; save halves",
	descriptionFull : "You fire a piece of nonmagical ammunition from a ranged weapon or throw a nonmagical weapon into the air and choose a point within range. Hundreds of duplicates of the ammunition or weapon fall in a volley from above and then disappear. Each creature in a 40-foot-radius. 20-foot-high cylinder centered on that point must make a Dexterity saving throw. A creature takes 8d8 damage on a failed save, or half as much damage on a successful one. The damage type is the same as that of the ammunition or weapon."
};
SpellsList["cordon of arrows"] = {
	name : "Cordon of Arrows",
	classes : ["ranger"],
	source : [["P", 228]],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "5 ft",
	components : "V,S,M",
	compMaterial : "Four or more arrows or bolts",
	duration : "8 h",
	save : "Dex",
	description : "4+2/SL arrows/bolts attack first crea in 30 ft one at a time for 1d6 Piercing dmg; save halves",
	descriptionFull : "You plant four pieces of nonmagical ammunition - arrows or crossbow bolts - in the ground within range and lay magic upon them to protect an area. Until the spell ends, whenever a creature other than you comes within 30 feet of the ammunition for the first time on a turn or ends its turn there, one piece of ammunition flies up to strike it. The creature must succeed on a Dexterity saving throw or take 1d6 piercing damage. The piece of ammunition is then destroyed. The spell ends when no ammunition remains." + "\n   " + "When you cast this spell, you can designate any creatures you choose, and the spell ignores them." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the amount of ammunition that can be affected increases by two for each slot level above 2nd."
};
SpellsList["crown of madness"] = {
	name : "Crown of Madness",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["P", 229]],
	level : 2,
	school : "Ench",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "1 humanoid save or charmed and must melee attack against crea chosen by me; extra save/rnd",
	descriptionFull : "One humanoid of your choice that you can see within range must succeed on a Wisdom saving throw or become charmed by you for the duration. While the target is charmed in this way, a twisted crown of jagged iron appears on its head, and a madness glows in its eyes." + "\n   " + "The charmed target must use its action before moving on each of its turns to make a melee attack against a creature other than itself that you mentally choose. The target can act normally on its turn if you choose no creature or if none are within its reach." + "\n   " + "On your subsequent turns, you must use your action to maintain control over the target, or the spell ends. Also, the target can make a Wisdom saving throw at the end of each of its turns. On a success, the spell ends."
};
SpellsList["crusader's mantle"] = {
	name : "Crusader's Mantle",
	classes : ["paladin"],
	source : [["P", 230]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "S:30-ft rad",
	components : "V",
	duration : "Conc, 1 min",
	description : "Me and allies in range deal extra 1d4 Radiant dmg with weapon attacks",
	descriptionFull : "Holy power radiates from you in an aura with a 30-foot radius, awakening boldness in friendly creatures. Until the spell ends, the aura moves with you, centered on you. While in the aura, each non-hostile creature in the aura (including you) deals an extra 1d4 radiant damage when it hits with a weapon attack."
};
SpellsList["destructive wave"] = {
	name : "Destructive Wave",
	classes : ["paladin"],
	source : [["P", 231]],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "S:30-ft rad",
	components : "V",
	duration : "Instantaneous",
	save : "Con",
	description : "Any crea 5d6 Thunder dmg \u0026 5d6 Radiant or Necrotic dmg \u0026 knocked prone; save halves, not prone",
	descriptionShorter : "Any crea 5d6 Thunder dmg \u0026 5d6 Radiant or Necrotic dmg \u0026 prone; save half, not prone",
	descriptionFull : "You strike the ground, creating a burst of divine energy that ripples outward from you. Each creature you choose within 30 feet of you must succeed on a Constitution saving throw or take 5d6 thunder damage, as well as 5d6 radiant or necrotic damage (your choice), and be knocked prone. A creature that succeeds on its saving throw takes half as much damage and isn't knocked prone.",
	dynamicDamageBonus : {
		allDmgTypesSingleMoment : true,
		multipleDmgTypes : {
			dmgTypes : ["radiant", "necrotic"],
			inDescriptionAs : "Radiant or Necrotic"
		}
	}
};
SpellsList["dissonant whispers"] = {
	name : "Dissonant Whispers",
	classes : ["bard"],
	source : [["P", 234]],
	level : 1,
	school : "Ench",
	time : "1 a",
	range : "60 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Wis",
	description : "1 crea 3d6+1d6/SL Psychic dmg and flee; save halves and no fleeing; deaf crea are immune",
	descriptionFull : "You whisper a discordant melody that only one creature of your choice within range can hear, wracking it with terrible pain. The target must make a Wisdom saving throw. On a failed save, it takes 3d6 psychic damage and must immediately use its reaction, if available, to move as far as its speed allows away from you. The creature doesn't move into obviously dangerous ground, such as a fire or a pit. On a successful save, the target takes half as much damage and doesn't have to move away. A deafened creature automatically succeeds on the save." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
};
SpellsList["elemental weapon"] = {
	name : "Elemental Weapon",
	classes : ["artificer", "paladin"],
	source : [["P", 237]],
	level : 3,
	school : "Trans",
	time : "1 a",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "+1 magical weapon; +1d4 Acid, Cold, Fire, Lightning, or Thunder dmg; SL5: +2/+2d4, SL7: +3/+3d4",
	descriptionShorter : "+1 wea; +1d4 Acid/Cold/Fire/Lightning/Thunder dmg; SL5: +2/+2d4, SL7: +3/+3d4",
	descriptionFull : "A nonmagical weapon you touch becomes a magic weapon. Choose one of the following damage types - acid, cold, fire, lightning, or thunder. For the duration, the weapon has a +1 bonus to attack rolls and deals an extra 1d4 damage of the chosen type when it hits." + AtHigherLevels + "When you cast this spell using a spell slot of 5th or 6th level, the bonus to attack rolls increases to +2 and the extra damage increases to 2d4. When you use a spell slot of 7th level or higher, the bonus increases to +3 and the extra damage increases to 3d4.",
	dynamicDamageBonus : {
		multipleDmgTypes : {
			dmgTypes : ["acid", "cold", "fire", "lightning", "thunder"],
			inDescriptionAs : "Acid, Cold, Fire, Lightning, or Thunder|Acid/Cold/Fire/Lightning/Thunder"
		}
	}
};
SpellsList["ensnaring strike"] = {
	name : "Ensnaring Strike",
	classes : ["ranger"],
	source : [["P", 237]],
	level : 1,
	school : "Conj",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Str",
	description : "Next crea hit save (Large adv.) or restrained, 1d6+1d6/SL Piercing dmg/rnd; Str check to escape",
	descriptionShorter : "Next crea hit save (Large adv.) or restrained, 1d6+1d6/SL Piercing dmg/rnd; Str chk escape",
	descriptionFull : "The next time you hit a creature with a weapon attack before this spell ends, a writhing mass of thorny vines appears at the point of impact, and the target must succeed on a Strength saving throw or be restrained by the magical vines until the spell ends. A Large or larger creature has advantage on this saving throw. If the target succeeds on the save, the vines shrivel away." + "\n   " + "While restrained by this spell, the target takes 1d6 piercing damage at the start of each of its turns. A creature restrained by the vines or one that can touch the creature can use its action to make a Strength check against your spell save DC. On a success, the target is freed." + AtHigherLevels + "If you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
};
SpellsList["feign death"] = {
	name : "Feign Death",
	classes : ["bard", "cleric", "druid", "wizard"],
	source : [["P", 240]],
	ritual : true,
	level : 3,
	school : "Necro",
	time : "1 a",
	range : "Touch",
	components : "V,S,M",
	compMaterial : "A pinch of graveyard dirt",
	duration : "1 h (D)",
	description : "Willing creature appears dead; it is blinded, incapacitated, has dmg resist. all but Psychic, and speed 0",
	descriptionFull : "You touch a willing creature and put it into a cataleptic state that is indistinguishable from death." + "\n   " + "For the spell's duration, or until you use an action to touch the target and dismiss the spell, the target appears dead to all outward inspection and to spells used to determine the target's status. The target is blinded and incapacitated, and its speed drops to 0. The target has resistance to all damage except psychic damage. If the target is diseased or poisoned when you cast the spell, or becomes diseased or poisoned while under the spell's effect, the disease and poison have no effect until the spell ends."
};
SpellsList["friends"] = {
	name : "Friends",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["P", 244]],
	level : 0,
	school : "Ench",
	time : "1 a",
	range : "Self",
	components : "S,M",
	compMaterial : "A small amount of makeup applied to the face as this spell is cast",
	duration : "Conc, 1 min",
	description : "Adv. on Cha checks vs. 1 crea currently not hostile; when spell ends, crea knows and becomes hostile",
	descriptionFull : "For the duration, you have advantage on all Charisma checks directed at one creature of your choice that isn't hostile toward you. When the spell ends, the creature realizes that you used magic to influence its mood and becomes hostile toward you. A creature prone to violence might attack you. Another creature might seek retribution in other ways (at the DM's discretion), depending on the nature of your interaction with it."
};
SpellsList["grasping vine"] = {
	name : "Grasping Vine",
	classes : ["druid", "ranger"],
	source : [["P", 246]],
	level : 4,
	school : "Conj",
	time : "1 bns",
	range : "30 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "Conjure vine with 30 ft reach; bns a to direct to 1 crea save or pulled 20 ft to vine",
	descriptionFull : "You conjure a vine that sprouts from the ground in an unoccupied space of your choice that you can see within range. When you cast this spell, you can direct the vine to lash out at a creature within 30 feet of it that you can see. That creature must succeed on a Dexterity saving throw or be pulled 20 feet directly toward the vine." + "\n   " + "Until the spell ends, you can direct the vine to lash out at the same creature or another one as a bonus action on each of your turns."
};
SpellsList["hail of thorns"] = {
	name : "Hail of Thorns",
	classes : ["ranger"],
	source : [["P", 249]],
	level : 1,
	school : "Conj",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "Next ranged weapon hit, all within 5 ft of target 1d10+1d10/SL Piercing dmg; save halves",
	descriptionFull : "The next time you hit a creature with a ranged weapon attack before the spell ends, this spell creates a rain of thorns that sprouts from your ranged weapon or ammunition. In addition to the normal effect of the attack, the target of the attack and each creature within 5 feet of it must make a Dexterity saving throw. A creature takes 1d10 piercing damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "If you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d10 for each slot level above 1st (to a maximum of 6d10).",
	dynamicDamageBonus : { multipleDmgMoments : false }
};
SpellsList["hex"] = {
	name : "Hex",
	classes : ["warlock"],
	source : [["P", 251]],
	level : 1,
	school : "Ench",
	time : "1 bns",
	range : "90 ft",
	components : "V,S,M",
	compMaterial : "The petrified eye of a newt",
	duration : "Conc, 1 h",
	description : "1 crea +1d6 Necrotic dmg from my atks; dis. on chosen ability checks; SL3: conc, 8h; SL5: conc, 24h",
	descriptionShorter : "1 crea +1d6 Necrotic dmg from my atks; dis. chosen abi chks; SL3: conc, 8h; SL5: conc, 24h",
	descriptionFull : "You place a curse on a creature that you can see within range. Until the spell ends, you deal an extra 1d6 necrotic damage to the target whenever you hit it with an attack. Also, choose one ability when you cast the spell. The target has disadvantage on ability checks made with the chosen ability." + "\n   " + "If the target drops to 0 hit points before this spell ends, you can use a bonus action on a subsequent turn of yours to curse a new creature." + "\n   " + "A remove curse cast on the target ends this spell early." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd or 4th level, you can maintain your concentration on the spell for up to 8 hours. When you use a spell slot of 5th level or higher, you can maintain your concentration on the spell for up to 24 hours."
};
SpellsList["hunger of hadar"] = {
	name : "Hunger of Hadar",
	classes : ["warlock"],
	source : [["P", 251]],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "A pickled octopus tentacle",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "20-ft rad all: blind while in, start turn in 2d6 Cold dmg, end turn in save or 2d6 Acid dmg",
	descriptionFull : "You open a gateway to the dark between the stars, a region infested with unknown horrors. A 20-foot-radius sphere of blackness and bitter cold appears, centered on a point with range and lasting for the duration. This void is filled with a cacophony of soft whispers and slurping noises that can be heard up to 30 feet away. No light, magical or otherwise, can illuminate the area, and creatures fully within the area are blinded." + "\n   " + "The void creates a warp in the fabric of space, and the area is difficult terrain. Any creature that starts its turn in the area takes 2d6 cold damage. Any creature that ends its turn in the area must succeed on a Dexterity saving throw or take 2d6 acid damage as milky, otherworldly tentacles rub against it."
};
SpellsList["lightning arrow"] = {
	name : "Lightning Arrow",
	classes : ["ranger"],
	source : [["P", 255]],
	level : 3,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "Next rngd wea atk +4d8+1d8/SL Lightn. dmg, miss half; 10 ft all 2d8+1d8/SL Lightn. dmg, save half",
	descriptionShorter : "Next atk +4d8+1d8/SL Lightn. dmg, miss h" + (typePF ? "a" : "") + "lf; 10 ft all 2d8+1d8/SL Lightn. dmg, save half",
	descriptionFull : "The next time you make a ranged weapon attack during the spell's duration, the weapon's ammunition, or the weapon itself if it's a thrown weapon, transforms into a bolt of lightning. Make the attack roll as normal. The target takes 4d8 lightning damage on a hit, or half as much damage on a miss, instead of the weapon's normal damage." + "\n   " + "Whether you hit or miss, each creature within 10 feet of the target must make a Dexterity saving throw. Each of these creatures takes 2d8 lightning damage on a failed save, or half as much damage on a successful one." + "\n   " + "The piece of ammunition or weapon then returns to its normal form." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage for both effects of the spell increases by 1d8 for each slot level above 3rd.",
	dynamicDamageBonus : {
		multipleDmgMoments : false,
		skipDmgGroupIfNotMultiple : /(atk .*?lightn\. dmg.*?)/i
	}
};
SpellsList["phantasmal force"] = {
	name : "Phantasmal Force",
	classes : ["bard", "sorcerer", "wizard"],
	source : [["P", 264]],
	level : 2,
	school : "Illus",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A bit of fleece",
	duration : "Conc, 1 min",
	save : "Int",
	description : "1 crea save or sees 10 ft cube illusion that does 1d6 Psychic dmg/rnd; Int(Investigation) vs. spell DC",
	descriptionShorter : "1 crea save or sees 10 ft cube illusion that does 1d6 Psychic dmg/rnd; Investigation vs. DC",
	descriptionFull : "You craft an illusion that takes root in the mind of a creature that you can see within range. The target must make an Intelligence saving throw. On a failed save, you create a phantasmal object, creature, or other visible phenomenon of your choice that is no larger than a 10-foot cube and that is perceivable only to the target for the duration. This spell has no effect on undead or constructs." + "\n   " + "The phantasm includes sound, temperature, and other stimuli, also evident only to the creature." + "\n   " + "The target can use its action to examine the phantasm with an Intelligence (Investigation) check against your spell save DC. If the check succeeds, the target realizes that the phantasm is an illusion, and the spell ends." + "\n   " + "While a target is affected by the spell, the target treats the phantasm as if it were real. The target rationalizes any illogical outcomes from interacting with the phantasm. For example, a target attempting to walk across a phantasmal bridge that spans a chasm falls once it steps onto the bridge. If the target survives the fall, it still believes that the bridge exists and comes up with some other explanation for its fall - it was pushed, it slipped, or a strong wind might have knocked it off." + "\n   " + "An affected target is so convinced of the phantasm's reality that it can even take damage from the illusion. A phantasm created to appear as a creature can attack the target. Similarly, a phantasm created to appear as fire, a pool of acid, or lava can burn the target. Each round on your turn, the phantasm can deal 1d6 psychic damage to the target if it is in the phantasm's area or within 5 feet of the phantasm, provided that the illusion is of a creature or hazard that could logically deal damage, such as by attacking. The target perceives the damage as a type appropriate to the illusion."
};
SpellsList["power word heal"] = {
	name : "Power Word Heal",
	classes : ["bard"],
	source : [["P", 266]],
	level : 9,
	school : "Evoc",
	time : "1 a",
	range : "Touch",
	components : "V,S",
	duration : "Instantaneous",
	description : "1 crea heals all HP and stops being charmed, frightened, paralyzed, stunned; it can use rea to stand up",
	descriptionShorter : "1 crea heals all HP, not charmed, frightened, paralyzed, stunned; rea to stand up",
	descriptionFull : "A wave of healing energy washes over the creature you touch. The target regains all its hit points. If the creature is charmed, frightened, paralyzed, or stunned, the condition ends. If the creature is prone, it can use its reaction to stand up. This spell has no effect on undead or constructs."
};
SpellsList["ray of sickness"] = {
	name : "Ray of Sickness",
	classes : ["sorcerer", "wizard"],
	source : [["P", 271]],
	level : 1,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "Spell attack for 2d8+1d8/SL Poison dmg; save or also poisoned until end of my next turn",
	descriptionFull : "A ray of sickening greenish energy lashes out toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 poison damage and must make a Constitution saving throw. On a failed save, it is also poisoned until the end of your next turn." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st."
};
SpellsList["searing smite"] = {
	name : "Searing Smite",
	classes : ["paladin"],
	source : [["P", 274]],
	level : 1,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Con",
	description : "Next melee weapon hit +1d6+1d6/SL Fire dmg and target ignites: start of turn save to end or 1d6 dmg",
	descriptionShorter : "Next melee wea hit +1d6+1d6/SL Fire dmg \u0026 ignites: start of turn save to end or 1d6 dmg",
	descriptionFull : "The next time you hit a creature with a melee weapon attack during the spell's duration, your weapon flares with white-hot intensity, and the attack deals an extra 1d6 fire damage to the target and causes the target to ignite in flames. At the start of each of its turns until the spell ends, the target must make a Constitution saving throw. On a failed save, it takes 1d6 fire damage. On a successful save, the spell ends. If the target or a creature within 5 feet of it uses an action to put out the flames, or if some other effect douses the flames (such as the target being submerged in water), the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the initial extra damage dealt by the attack increases by 1d6 for each slot above the 1st.",
	dynamicDamageBonus : {
		extraDmgGroupsSameType : /(end or )((?:\+?\d+d?\d*)+)/i
	}
};
SpellsList["staggering smite"] = {
	name : "Staggering Smite",
	classes : ["paladin"],
	source : [["P", 278]],
	level : 4,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "Next melee weapon hit +4d6 Psychic dmg and save or dis. on atks/chks, no rea, until end next turn",
	descriptionFull : "The next time you hit a creature with a melee weapon attack during this spell's duration, your weapon pierces both body and mind, and the attack deals an extra 4d6 psychic damage to the target. The target must make a Wisdom saving throw. On a failed save, it has disadvantage on attack rolls and ability checks, and can't take reactions, until the end of its next turn."
};
SpellsList["swift quiver"] = {
	name : "Swift Quiver",
	classes : ["ranger"],
	source : [["P", 279]],
	level : 5,
	school : "Trans",
	time : "1 bns",
	range : "Touch",
	components : "V,S,M",
	compMaterial : "A quiver containing at least one piece of ammunition",
	duration : "Conc, 1 min",
	description : "Quiver gives nonmagical ammo; bns a to make 2 atks with weapon that uses ammo from that quiver",
	descriptionFull : "You transmute your quiver so it produces an endless supply of nonmagical ammunition, which seems to leap into your hand when you reach for it." + "\n   " + "On each of your turns until the spell ends, you can use a bonus action to make two attacks with a weapon that uses ammunition from the quiver. Each time you make such a ranged attack, your quiver magically replaces the piece of ammunition you used with a similar piece of nonmagical ammunition. Any pieces of ammunition created by this spell disintegrate when the spell ends. If the quiver leaves your possession, the spell ends."
};
SpellsList["telepathy"] = {
	name : "Telepathy",
	classes : ["wizard"],
	source : [["P", 281]],
	level : 8,
	school : "Evoc",
	time : "1 a",
	range : "Unlimited",
	components : "V,S,M",
	compMaterial : "A pair of linked silver rings",
	duration : "24 h",
	description : "1 willing crea Int>0 and I telepathic link; share words, sensory information if on same plane",
	descriptionFull : "You create a telepathic link between yourself and a willing creature with which you are familiar. The creature can be anywhere on the same plane of existence as you. The spell ends if you or the target are no longer on the same plane." + "\n   " + "Until the spell ends, you and the target can instantaneously share words, images, sounds, and other sensory messages with one another through the link, and the target recognizes you as the creature it is communicating with. The spell enables a creature with an Intelligence score of at least 1 to understand the meaning of your words and take in the scope of any sensory messages you send to it."
};
SpellsList["thorn whip"] = {
	name : "Thorn Whip",
	classes : ["artificer", "druid"],
	source : [["P", 282]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "The stem of a plant with thorns",
	duration : "Instantaneous",
	description : "Melee spell atk for 1d6 Piercing dmg and pull crea up to 10 ft towards me; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "Melee spell attack for `CD`d6 Piercing dmg and pull crea up to 10 ft towards me",
	descriptionFull : "You create a long, vine-like whip covered in thorns that lashes out at your command toward a creature in range. Make a melee spell attack against the target. If the attack hits, the creature takes 1d6 piercing damage, and if the creature is Large or smaller, you pull the creature up to 10 feet closer to you." + "\n   " + "This spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["thunderous smite"] = {
	name : "Thunderous Smite",
	classes : ["paladin"],
	source : [["P", 282]],
	level : 1,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Str",
	description : "Next melee weapon hit +2d6 Thunder dmg and save or 10 ft push and prone; audible in 300 ft",
	descriptionFull : "The first time you hit with a melee weapon attack during this spell's duration, your weapon rings with thunder that is audible within 300 feet of you, and the attack deals an extra 2d6 thunder damage to the target. Additionally, if the target is a creature, it must succeed on a Strength saving throw or be pushed 10 feet away from you and knocked prone."
};
SpellsList["tsunami"] = {
	name : "Tsunami",
	classes : ["druid"],
	source : [["P", 284]],
	level : 8,
	school : "Conj",
	time : "1 min",
	range : "Sight",
	components : "V,S",
	duration : "Conc, 6 rnds",
	save : "Str",
	description : "300\xD750\xD7300ft (l\xD7w\xD7h) wall of water moves away at 50 ft/rnd; 6d10 Bludg. dmg; save halves; see B",
	descriptionShorter : "300\xD750\xD7300ft (l\xD7w\xD7h) wave moves away at 50 ft/rnd; 6d10 Bludg. dmg; save half; see B",
	descriptionMetric : "90\xD715\xD790m (l\xD7w\xD7h) wall of water moves away at 15 m/rnd; 6d10 Bludg. dmg; save halves; see B",
	descriptionShorterMetric : "90\xD715\xD790m (l\xD7w\xD7h) wave moves away at 15 m/rnd; 6d10 Bludg. dmg; save half; see B",
	descriptionFull : "A wall of water springs into existence at a point you choose within range. You can make the wall up to 300 feet long, 300 feet high, and 50 feet thick. The wall lasts for the duration." + "\n   " + "When the wall appears, each creature within its area must make a Strength saving throw. On a failed save, a creature takes 6d10 bludgeoning damage, or half as much damage on a successful save." + "\n   " + "At the start of each of your turns after the wall appears, the wall, along with any creatures in it, moves 50 feet away from you. Any Huge or smaller creature inside the wall or whose space the wall enters when it moves must succeed on a Strength saving throw or take 5d10 bludgeoning damage. A creature can take this damage only once per round. At the end of the turn, the wall's height is reduced by 50 feet, and the damage creatures take from the spell on subsequent rounds is reduced by 1d10. When the wall reaches 0 feet in height, the spell ends." + "\n   " + "A creature caught in the wall can move by swimming. Because of the force of the wave, though, the creature must make a successful Strength (Athletics) check against your spell save DC in order to move at all. If it fails the check, it can't move. A creature that moves out of the area falls to the ground."
};
SpellsList["witch bolt"] = {
	name : "Witch Bolt",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["P", 289]],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "A twig from a tree that has been struck by lightning",
	duration : "Conc, 1 min",
	description : "Rngd spell atk 1d12+1d12/SL Lightn. dmg; 1 a 1d12 Lightn. dmg; ends if out of range or I do other a",
	descriptionShorter : "Rngd atk 1d12+1d12/SL Lightn. dmg; 1 a 1d12 Lightn. dmg; end: out of range/do other a",
	descriptionFull : "A beam of crackling, blue energy lances out toward a creature within range, forming a sustained arc of lightning between you and the target. Make a ranged spell attack against that creature. On a hit, the target takes 1d12 lightning damage, and on each of your turns for the duration, you can use your action to deal 1d12 lightning damage to the target automatically. The spell ends if you use your action to do anything else. The spell also ends if the target is ever outside the spell's range or if it has total cover from you." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the initial damage increases by 1d12 for each slot level above 1st.",
	dynamicDamageBonus : {
		multipleDmgMoments : false,
		extraDmgGroupsSameType : /(1 a )(.*?)( Lightn. dmg)/i
	}
};
SpellsList["wrathful smite"] = {
	name : "Wrathful Smite",
	classes : ["paladin"],
	source : [["P", 289]],
	level : 1,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "Next melee weapon hit +1d6 Psychic dmg and save or frightened; it can take 1 a for extra save",
	descriptionFull : "The next time you hit with a melee weapon attack during this spell's duration, your attack deals an extra 1d6 psychic damage. Additionally, if the target is a creature, it must make a Wisdom saving throw or be frightened of you until the spell ends. As an action, the creature can make a Wisdom check against your spell save DC to steel its resolve and end this spell."
};

// pub_20140819_HotDQ+20141104_RoT.js
// This file adds the background features and magic items from the Hoard of the Dragon Queen and Rise of Tiamat adventure books to MPMB's Character Record Sheet

// Define the source
SourceList.HotDQ={
	name : "Hoard of the Dragon Queen [background features, items]",
	abbreviation : "HotDQ",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://wpn.wizards.com/en/products/tyranny-of-dragons",
	date : "2014/08/19"
};
SourceList.RoT = {
	name : "Rise of Tiamat [items]",
	abbreviation : "RoT",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://wpn.wizards.com/en/products/tyranny-of-dragons",
	date : "2014/11/04"
};

// Background features
BackgroundFeatureList["cult of the dragon infiltrator"] = {
	description : "I have infiltrated the ranks of the Cult of the Dragon. Having spied on the organization for quite some time, I am familiar with its inner workings and customs. I have a second identity as an initiate of the cult, enough of a facade to blend in as a simple grunt or servant.",
	source : [["HotDQ", 87], ["ALbackground", 0]]
};
BackgroundFeatureList["dragon scholar"] = {
	description : "I have studied dragons and their lore for many years. I can automatically identify locations built or used by dragons, and I can identify dragon eggs and scales by sight. If I fail an Intelligence check to recall lore relating to dragons, I know someone or some book that I can consult for the answer unless the DM rules that the lore is unknown.",
	source : [["HotDQ", 87], ["ALbackground", 0]]
};

// Magic Items
// The magic cauldron on page 79 is omitted as its only magic is that it functions as the material component for the Augury spell. Not something an adventurer is likely to use, with it being 50 lb.
MagicItemsList["dragongleam"] = {
	name : "Dragongleam",
	source : [["HotDQ", 69]],
	type : "weapon (spear)",
	rarity : "rare",
	magicItemTable : "F",
	description : "This rusty spear is engraved with draconic runes on its crossguard which read \"Tiamat's Eyes Shine\". The spear has 10 charges. As an action while holding it, I can say this command and expend 1 charge to cast Daylight. The spear loses its magic once all charges are expended.",
	descriptionFull : "This rusty spear is engraved with draconic runes on its crossguard which read \"Tiamat's Eyes Shine\". The spear has 10 charges. While holding it, you can say the command and expend 1 charge as an action to cast the Daylight spell. The spear loses this property if it has no charges left.",
	weight : 3,
	usages : 10,
	recovery : "Never",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["daylight"],
		selection : ["daylight"],
		firstCol : 1
	},
	spellChanges : {
		"daylight" : {
			component : "V,M\u0192"
		}
	},
	weaponOptions : [{
		baseWeapon : "spear",
		regExpSearch : /dragongleam/i,
		name : "Dragongleam",
		source : [["HotDQ", 69]],
		selectNow : true
	}]
}
MagicItemsList["tankard of plenty"] = {
	name : "Tankard of Plenty",
	source : [["HotDQ", 74]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "A",
	description : 'This golden stein is decorated with dancing dwarves and grain patterns. Speaking the command word "Illefarn" while grasping the handle fills the tankard with three pints of rich dwarven ale. This power can be used up to three times per day.',
	descriptionFull : 'This golden stein is decorated with dancing dwarves and grain patterns. Speaking the command word ("Illefarn") while grasping the handle fills the tankard with three pints of rich dwarven ale. This power can be used up to three times per day.',
	usages : 3,
	recovery : "Day"
}
var HotDQ_tempDragonMaskNoteTxt = [
	desc([
		toUni("Damage Absorption") + ". You have resistance against DTYPE damage. If you already have resistance to DTYPE damage from another source, you instead have immunity to DTYPE damage. If you already have immunity to DTYPE damage from another source, whenever you are subjected to DTYPE damage, you take none of that damage and regain a number of hit points equal to half the damage dealt of that type.",
		toUni("Draconic Majesty") + ". While you are wearing no armor, you can add your Charisma bonus to your Armor Class.",
		toUni("Dragon Breath") + ". If you have a breath weapon that requires rest to recharge, it gains a recharge of 6.",
		toUni("Dragon Sight") + ". You gain darkvision out to 60 feet, or to an additional 60 feet if you already have that sense. Once per day, you can gain blindsight out to 30 feet for 5 minutes.",
		toUni("Dragon Tongue") + ". You can speak and understand Draconic. You also have advantage on any Charisma check you make against DCOLOUR dragons.",
		toUni("Legendary Resistance (1/Day)") + ". If you fail a saving throw, you can choose to succeed instead."
	]), [
		" It reshapes to fit my face and head when I attuned to it. While I'm wearing a dragon mask and attuned to it, it grants me the following benefits.",
		"\u2022 Damage Absorption. I have resistance against DTYPE damage. If I already have resistance to DTYPE damage from another source, I instead gain immunity to DTYPE damage. If I already have immunity to DTYPE damage from another source, whenever I am subjected to DTYPE damage, I take none of that damage and instead regain a number of hit points equal to half the DTYPE damage dealt.",
		"\u2022 Draconic Majesty. While I am wearing no armor, I can add my Charisma bonus to my Armor Class.",
		"\u2022 Dragon Breath. If I have a breath weapon that requires rest to recharge, it gains a recharge of 6.",
		"\u2022 Dragon Sight. I gain darkvision out to 60 ft, or to an additional 60 ft if I already have that sense. Once per day, I can gain blindsight out to 30 ft for 5 minutes.",
		"\u2022 Dragon Tongue. I can speak and understand Draconic. I also have advantage on any Charisma check I make against DCOLOUR dragons.",
		"\u2022 Legendary Resistance. Once per day when I fail a saving throw, I can choose to succeed instead."
	].join("\n   ")
];
MagicItemsList["dragon mask"] = {
	name : "Dragon Mask",
	source : [["HotDQ", 94]],
	type : "wondrous item",
	rarity : "legendary",
	storyItemAL : true,
	description : "This mask reshapes to fit my head. It grants me the ability to absorb associated damage type, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. a dragon type, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, see Notes page.",
	descriptionFull : "Each dragon mask is a legendary wondrous item that reshapes to fit the face and head of a wearer attuned to it. While you are wearing any dragon mask and attuned to it, you gain the following benefits." + HotDQ_tempDragonMaskNoteTxt[0].replace(/You have resistance against DTYPE damage.*?\n/, "You have resistance against the mask's damage type. If you already have resistance to that damage type from another source, you instead have immunity to that damage type. If you already have immunity to that damage type from another source, whenever you are subjected to damage of that type, you take none of that damage and regain a number of hit points equal to half the damage dealt of that type.\n").replace("DCOLOUR dragons", "dragons that share the mask's color"),
	attunement : true,
	languageProfs : ["Draconic"],
	vision : [["Darkvision", "fixed 60"], ["Darkvision", "+60"]],
	usages : 1,
	recovery : "Day",
	additional : "Legendary Resistance",
	extraLimitedFeatures : [{
		name : "Dragon Mask (Blindsight 30 ft, 5 min)",
		usages : 1,
		recovery : "Day"
	}],
	extraAC : [{
		mod : "Cha",
		magic : true,
		text : "I add my Charisma modifier to AC while I'm not wearing armor.",
		stopeval : function (v) { return v.wearingArmor; }
	}],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.dbBreathWeapon || (/^(?=.*breath)(?=.*weapon).*$/i).test(v.theWea.name)) {
					fields.Description = fields.Description.replace(/(Us(e|able)( only)? )?once per (short|long) rest/i, 'Recharge 6');
				};
			}
		]
	},
	incrementDamageRes : function (dType, dRes) {
		SetProf(
			"savetxt",
			CurrentProfs.resistance[dRes] && CurrentProfs.resistance[dRes].src.length > 1,
			{ immune : [dRes] },
			!dType ? "Mask of the Dragon Queen (magic item)" : dType + " Dragon Mask (magic item)"
		);
	},
	choices : ["Black", "Blue", "Green", "Red", "White", "Mask of the Dragon Queen"],
	choicesNotInMenu : true,
	"black" : {
		name : "Black Dragon Mask",
		description : "This mask reshapes to fit my head. It grants me the ability to absorb acid damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. black dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This horned mask of glossy ebony has horns and a skull-like mien. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb acid damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against black dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and water breathing. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This horned mask of glossy ebony has horns and a skull-like mien. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + HotDQ_tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "acid").replace("DCOLOUR", "black") + "\n   " + toUni("Water Breathing") + ". You can breathe underwater.",
		dmgres : ["Acid"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("Black", "acid"); },
		toNotesPage : [{
			name : "Features",
			note : "\n   This horned mask of glossy ebony has horns and a skull-like mien." + HotDQ_tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "acid").replace("DCOLOUR", "black") + "\n   Water Breathing. I can breathe underwater."
		}]
	},
	/*
		Although the adventure book only includes the Black Dragon Mask,
		this code also includes the Blue, Green, Red, and White Dragon Masks.
		The rules for these are found in the Rise of Tiamat Online Supplement,
		here: https://media.wizards.com/2014/downloads/dnd/RiseTiamatSupplementv0.2_Printer.pdf
	*/
	"blue" : {
		name : "Blue Dragon Mask",
		source : [["HotDQ", 0], ["RoTOS", 4]],
		description : "This mask reshapes to fit my head. It grants me the ability to absorb lightning damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. Cha checks vs. blue dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This mask of glossy azure has spikes around its edges and a ridged horn in its center. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb lightning damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against blue dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and Lingering Shock. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This mask of glossy azure has spikes around its edges and a ridged horn in its center. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + HotDQ_tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "lightning").replace("DCOLOUR", "blue") + "\n   " + toUni("Lingering Shock") + ". If you deal lightning damage to a creature, it can't take reactions until its next turn.",
		dmgres : ["Lightning"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("Blue", "lightning"); },
		toNotesPage : [{
			name : "Features",
			note : "\n   This mask of glossy azure has spikes around its edges and a ridged horn in its center." + HotDQ_tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "lightning").replace("DCOLOUR", "blue") + "\n   Lingering Shock. If I deal lightning damage to a creature, it can't take reactions until its next turn."
		}]
	},
	"green" : {
		name : "Green Dragon Mask",
		source : [["HotDQ", 0], ["RoTOS", 4]],
		description : "This mask reshapes to fit my head. It grants me the ability to absorb poison damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. green dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This mottled green mask is surmounted by a frilled crest and has spikes along its jaw. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb poison damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against green dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and water breathing. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This mottled green mask is surmounted by a frilled crest and has leathery spiked plates along its jaw. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + HotDQ_tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "poison").replace("DCOLOUR", "green") + "\n   " + toUni("Water Breathing") + ". You can breathe underwater.",
		dmgres : ["Poison"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("Green", "poison"); },
		toNotesPage : [{
			name : "Features",
			note : "\n   This mottled green mask is surmounted by a frilled crest and has leathery spiked plates along its jaw." + HotDQ_tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "poison").replace("DCOLOUR", "green") + "\n   Water Breathing. I can breathe underwater."
		}]
	},
	"red" : {
		name : "Red Dragon Mask",
		source : [["HotDQ", 0], ["RoTOS", 4]],
		description : "This mask reshapes to fit my head. It grants me the ability to absorb fire damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. red dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This mask of glossy crimson has swept-back horns and spiked cheek ridges. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb fire damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against red dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and Dragon Fire. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This mask of glossy crimson has swept-back horns and spiked cheek ridges. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + HotDQ_tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "fire").replace("DCOLOUR", "red") + "\n   " + toUni("Dragon Fire") + ". If you deal fire damage to a creature or flammable object, it starts burning. At the start of each of its turns, a creature burning in this way takes 1d6 fire damage. A creature that can reach the burning target can use an action to extinguish the fire.",
		dmgres : ["Fire"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("red", "fire"); },
		toNotesPage : [{
			name : "Features",
			note : "\n   This mask of glossy crimson has swept-back horns and spiked cheek ridges." + HotDQ_tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "fire").replace("DCOLOUR", "red") + "\n   Dragon Fire. If I deal fire damage to a creature or flammable object, it starts burning. At the start of each of its turns, a creature burning in this way takes 1d6 fire damage. A creature that can reach the burning target can use an action to extinguish the fire."
		}]
	},
	"white" : {
		name : "White Dragon Mask",
		source : [["HotDQ", 0], ["RoTOS", 4]],
		description : "This mask reshapes to fit my head. It grants me the ability to absorb cold damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. white dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This gleaming mask is white with highlights of pale blue and is topped by a spined crest. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb cold damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against white dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and Winter's Fury. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This gleaming mask is white with highlights of pale blue and is topped by a spined crest. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + HotDQ_tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "cold").replace("DCOLOUR", "white") + "\n   " + toUni("Winter's Fury") + ". While your current hit points are equal to or less than half your hit point maximum, you deal an extra 1d8 cold damage with your melee attacks.",
		dmgres : ["Cold"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("white", "cold"); },
		toNotesPage : [{
			name : "Features",
			note : "\n   This gleaming mask is white with highlights of pale blue and is topped by a spined crest." + HotDQ_tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "cold").replace("DCOLOUR", "white") + "\n   Winter's Fury. While my current hit points are equal to or less than half my hit point maximum, I deal an extra 1d8 cold damage with my melee attacks."
		}]
	},
	"mask of the dragon queen" : {
		name : "Mask of the Dragon Queen",
		source : [["RoT", 94]],
		description : "This mask reshapes to fit my head. It allows to absorb acid, cold, fire, lightning, and poison damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (5/day), adv. on Cha checks vs. dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This mask gives me a draconic visage and covers my face, neck, and shoulders. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb acid, cold, fire, lightning, and poison damage, depending on how resistant I'm already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against dragons, lets me add my Charisma modifier to AC while not wearing armor, and more. 5 times per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "When two or more of the dragon masks are assembled they magically transform into the Mask of the Dragon Queen. Each mask shrinks to become the modeled head of a chromatic dragon, appearing to roar its devotion to Tiamat where all the masks brought together are arranged crown-like on the wearer's head. Below the five masks, a new mask shapes itself, granting the wearer a draconic visage that covers the face, neck, and shoulders. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + HotDQ_tempDragonMaskNoteTxt[0].replace(/You have resistance against DTYPE damage.*?\n/, "You have resistance against acid, cold, fire, lightning, and poison damage. If you already have resistance to a damage type from another source, you instead have immunity to that damage type. If you already have immunity to a damage type from another source, whenever you are subjected to that damage type, you take none of that damage and regain a number of hit points equal to half the damage dealt of that type.\n").replace("DCOLOUR ", "").replace(toUni("(1/Day)"), toUni("(5/Day)")) + "\n\n   It can have the properties of any one of the colored masks, but only can have one active at a time. These are the following:\n   " + toUni("Water Breathing (black and green)") + ". You can breathe underwater.\n   " + toUni("Lingering Shock (blue)") + ". If you deal lightning damage to a creature, it can't take reactions until its next turn.\n   " + toUni("Dragon Fire (red)") + ". If you deal fire damage to a creature or flammable object, it starts burning. At the start of each of its turns, a creature burning in this way takes 1d6 fire damage. A creature that can reach the burning target can use an action to extinguish the fire.\n   " + toUni("Winter's Fury (white)") + ". While your current hit points are equal to or less than half your hit point maximum, you deal an extra 1d8 cold damage with your melee attacks.",
		dmgres : ["Acid", "Cold", "Fire", "Lightning", "Poison"],
		changeeval : function () {
			MagicItemsList["dragon mask"].incrementDamageRes("", "acid");
			MagicItemsList["dragon mask"].incrementDamageRes("", "cold");
			MagicItemsList["dragon mask"].incrementDamageRes("", "fire");
			MagicItemsList["dragon mask"].incrementDamageRes("", "lightning");
			MagicItemsList["dragon mask"].incrementDamageRes("", "poison");
		},
		toNotesPage : [{
			name : "Features",
			note : "\n   When two or more of the dragon masks are assembled they magically transform into the Mask of the Dragon Queen. Each mask shrinks to become the modeled head of a chromatic dragon, appearing to roar its devotion to Tiamat where all the masks brought together are arranged crown-like on the wearer's head. Below the five masks, a new mask shapes itself, granting the wearer a draconic visage that covers the face, neck, and shoulders." +
			HotDQ_tempDragonMaskNoteTxt[1].replace(/Damage Absorption.*?\n/, "Damage Absorption. I have resistance to acid, cold, fire, lightning, and poison damage. If I already have resistance to a damage type from another source, I instead have immunity to that damage type. If I already have immunity to a damage type from another source, whenever I am subjected to that damage type, I take none of that damage and regain a number of hit points equal to half the damage dealt of that type.\n").replace("DCOLOUR ", "").replace("Once per day when", "Five times per day when") +
			"\n   \u2022 Special Properties. I can access the properties of any one of the colored masks, but only can have one active at a time. These are the following:"+
			"\n      \u25E6 Water Breathing (black and green). I can breathe underwater."+
			"\n      \u25E6 Lingering Shock (blue). If I deal lightning damage to a creature, it can't take reactions until its next turn."+
			"\n      \u25E6 Dragon Fire (red). If I deal fire damage to a creature or flammable object, it starts burning. At the start of each of its turns, a creature burning in this way takes 1d6 fire damage. A creature that can reach the burning target can use an action to extinguish the fire."+
			"\n      \u25E6 Winter's Fury (white). While my current hit points are equal to or less than half my hit point maximum, I deal an extra 1d8 cold damage with my melee attacks."
		}],
		usages : 5,
		recovery : "Day",
		additional : "Legendary Resistance"
	}
}
MagicItemsList["hazirawn"] = {
	name : "Hazirawn",
	source : [["HotDQ", 94]],
	type : "weapon (greatsword)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This sentient, neutral evil, greatsword functions depend on whether you are attuned to it or not.",
	descriptionFull : "A sentient (neutral evil) greatsword, Hazirawn is capable of speech in Common and Netherese. Even if you aren't attuned to the sword, you gain a +1 bonus on attack and damage rolls made with this weapon and you deal an extra 1d6 necrotic damage when you hit with the weapon.\n   " + toUni("Increased Potency") + ". While you are attuned to this weapon, its bonus on attack and damage rolls increases to +2, and a hit deals an extra 2d6 necrotic damage (instead of 1d6).\n   " + toUni("Spells") + ". Hazirawn has 4 charges to cast spells. As long as the sword is attuned to you and you are holding it in your hand, you can cast Detect Magic (1 charge), Detect Evil and Good (1 charge), or Detect Thoughts (2 charges). Each night at midnight, Hazirawn regains 1d4 expended charges.\n   " + toUni("Wounding") + ". While you are attuned to the weapon, any creature that you hit with Hazirawn can't regain hit points for 1 minute. The target can make a DC 15 Constitution saving throw at the end of each of its turns, ending this effect early on a success.",
	weight : 6,
	choices : ["not attuned", "attuned"],
	"not attuned" : {
		name : "Hazirawn\u200A",
		description : "A sentient (neutral evil) greatsword, Hazirawn is capable of speech in Common and Netherese. While I'm not attuned to the sword, I gain a +1 bonus on attack and damage rolls made with it. It also deals an extra 1d6 necrotic damage on attacks made with the sword.",
		weaponOptions : [{
			baseWeapon : "greatsword",
			regExpSearch : /hazirawn/i,
			name : "Hazirawn",
			source : [["HotDQ", 94]],
			description : "Heavy, two-handed; +1d6 necrotic damage",
			modifiers : [1, 1],
			selectNow : true
		}]
	},
	"attuned" : {
		name : "Hazirawn\u200A\u200A",
		attunement : true,
		description : "This sentient, neutral evil, greatsword adds +2 to damage and to hit rolls, deals +2d6 necrotic damage, and those hit with it can't regain HP for 1 min, but can make a DC 15 Con save at the end of each turn to stop this effect. It has 4 charges to cast spells, regaining 1d4 at midnight. It speaks Common and Netherese.",
		extraLimitedFeatures : [{
			name : "Hazirawn (regains 1d4)",
			usages : 4,
			recovery : "Midnight"
		}],
		weaponOptions : [{
			baseWeapon : "greatsword",
			regExpSearch : /hazirawn/i,
			name : "Hazirawn",
			source : [["HotDQ", 94]],
			description : "Heavy, two-handed; +2d6 necrotic damage; Wounding (can't regain HP for 1 min, DC 15 Con save to stop)",
			modifiers : [2, 2],
			selectNow : true
		}],
		spellcastingBonus : [{
			name : "1 charge",
			spells : ["detect evil and good", "detect magic"],
			selection : ["detect evil and good", "detect magic"],
			firstCol : 1,
			times : 2
		}, {
			name : "2 charges",
			spells : ["detect thoughts"],
			selection : ["detect thoughts"],
			firstCol : 2
		}],
		fixedDC : 15, // assumed from the fact that its Wounding property has DC 15
		spellFirstColTitle : "Ch"
	}
}
MagicItemsList["insignia of claws"] = {
	name : "Insignia of Claws",
	source : [["HotDQ", 94]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "The jewels in the insignia flare with purple light when I enter combat, empowering my fists. While wearing the insignia, I gain a +1 bonus to the attack rolls and the damage rolls of my unarmed strikes and natural weapons. Such attacks are considered to be magical.",
	descriptionFull : "The jewels in the insignia of the Cult of the Dragon flare with purple light when you enter combat, empowering your natural fists or natural weapons.\n   While wearing the insignia you gain a +1 bonus to the attack rolls and the damage rolls you make with unarmed strikes and natural weapons. Such attacks are considered to be magical.",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == "unarmed strike" && !(/counts as( a)? magical/i).test(fields.Description)) {
					fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
				};
			},
			"My unarmed strikes gain a +1 bonus to their attack and damage rolls, and count as magical."
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.baseWeaponName == "unarmed strike") {
					output.magic += 1;
				}
			}, ''
		]
	}
}
MagicItemsList["wand of winter"] = {
	name : "Wand of Winter",
	source : [["HotDQ", 94]],
	type : "wand",
	rarity : "rare",
	attunement : true,
	magicItemTable : "G",
	description : "This wand looks and feels like an icicle and has 7 charges, regaining 1d6+1 expended charges at dawn. If I use its last charge, roll a d20. On a 20, it melts away. I can use its charges to cast spells with DC 15/+5 to hit: Ray of Frost (0 charges: 1d8, 1 charge: 2d8), Sleet Storm (3 charges), or Ice Storm (4 charges).",
	descriptionFull : "This wand looks and feels like an icicle. You must be attuned to the wand to use it.\n   The wand has 7 charges, which are used to fuel the spells within it. With the wand in hand, you can use your action to cast one of the following spells from the wand, even if you are incapable of casting spells: Ray of Frost (no charges, or 1 charge to cast at 5th level; +5 to hit with ranged spell attack), Sleet Storm (3 charges; spell save DC 15), or Ice Storm (4 charges; spell save DC 15). No components are required. The wand regains 1d6+1 expended charges each day at dawn. If you expend the wand's last charge, roll a d20. On a 20, the wand melts away, forever destroyed.",
	weight : 1,
	usages : 7,
	recovery : "dawn",
	additional : "regains 1d6+1",
	fixedDC : 15,
	fixedSpAttack : 5,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["ray of frost"],
		selection : ["ray of frost"],
		firstCol : 1
	}, {
		name : "0 charges (at will)",
		spells : ["ray of frost"],
		selection : ["ray of frost"],
		firstCol : "atwill"
	}, {
		name : "3 charges",
		spells : ["sleet storm"],
		selection : ["sleet storm"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["ice storm"],
		selection : ["ice storm"],
		firstCol : 4
	}],
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName, isDuplicate) {
				if (spellKey == "ray of frost" && spName == "wand of winter") {
					if (isDuplicate) {
						spellObj.firstCol = "1";
						spellObj.description = "Spell attack for 2d8 Cold dmg and -10 ft speed until start of my next turn";
					} else {
						spellObj.description = "Spell attack for 1d8 Cold dmg and -10 ft speed until start of my next turn";
					}
					return true;
				};
			},
			""
		]
	}
}
MagicItemsList["dragontooth dagger"] = {
	name : "Dragontooth Dagger",
	source : [["RoT", 94]],
	type : "weapon (dagger)",
	rarity : "rare",
	magicItemTable : "H",
	description : "This dagger is fashioned from the tooth of a dragon. Its handle is its leather wrapped root and there is no crossguard. It adds a +1 bonus to attack and damage rolls made with it and deals +1d6 acid damage on a hit. Against the enemies of the Cult of the Dragon this increases to a +2 bonus and +2d6 acid damage.",
	descriptionFull : "A dagger fashioned from the tooth of a dragon. While the blade is obviously a fang or predator's tooth, the handle is leather wrapped around the root of the tooth, and there is no crossguard.\n   You gain a +1 bonus to attack and damage rolls made with this weapon. On a hit with this weapon, the target takes an extra 1d6 acid damage.\n   " + toUni("Draconic Potency") + ". Against enemies of the Cult of the Dragon, the dagger's bonus to attack and damage rolls increases to 2, and the extra acid damage increases to 2d6.",
	weight : 1,
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*dragontooth)(?=.*dagger).*$/i,
		name : "Dragontooth Dagger",
		source : [["RoT", 94]],
		description : "Finesse, light, thrown; +1d6 acid damage; Vs. Cult of the Dragon enemies: +2 magic \u0026 +2d6 acid damage",
		modifiers : [1, 1],
		selectNow : true
	}]
}

// Beast
// Sled dog is just a wolf under a different name, it has been added to the SRD code as a `nameAlt`

// pub_20140930_MM.js
// This file adds all the player-material from the Monster Manual to MPMB's Character Record Sheet

// Define the source
SourceList.M={
	name : "Monster Manual",
	abbreviation : "MM",
	group : "Core Sources",
	url : "https://dnd.wizards.com/products/monster-manual",
	date : "2014/09/30"
};

// Dinosaurs not in the SRD
CreatureList["allosaurus"] = {
	name : "Allosaurus",
	source : [["M", 79]],
	size : 2, //Large
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 51,
	hd : [6, 10], //[#, die]
	speed : "60 ft",
	scores : [19, 13, 17, 2, 12, 5], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 5
	},
	senses : "",
	passivePerception : 15,
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Claw",
		ability : 1,
		damage : [1, 8, "slashing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "If used after moving 30 ft straight in the same round, see Pounce trait"
	}, {
		name : "Bite",
		ability : 1,
		damage : [2, 10, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "Can be used in combination with claw while pouncing (see Pounce trait)"
	}],
	traits : [{
		name : "Pounce",
		description : "If the allosaurus moves at least 30 ft straight toward a creature and then hits it with a claw attack on the same turn, that target must succeed on a DC 13 Strength saving throw or be knocked prone. If the target is prone, the allosaurus can make one bite attack against it as a bonus action."
	}]
};
CreatureList["ankylosaurus"] = {
	name : "Ankylosaurus",
	source : [["M", 79]],
	size : 1, //Huge
	type : "Beast",
	alignment : "Unaligned",
	ac : 15,
	hp : 68,
	hd : [8, 12], //[#, die]
	speed : "30 ft",
	scores : [19, 11, 15, 2, 12, 5], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 11,
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Tail",
		ability : 1,
		damage : [4, 6, "bludgeoning"], //[#, die, type] "" for die is allowed
		range : "Melee (10 ft)",
		description : "Target must succeed on a DC 14 Strength saving throw or be knocked prone",
		modifiers : [1, ""]
	}]
};
CreatureList["pteranodon"] = {
	name : "Pteranodon",
	source : [["M", 79]],
	size : 3, //Medium
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 13,
	hd : [3, 8], //[#, die]
	speed : "10 ft, fly 60 ft",
	scores : [12, 15, 10, 2, 9, 5], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 1
	},
	senses : "",
	passivePerception : 11,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Flyby",
		description : "The pteranodon doesn't provoke opportunity attacks when it flies out of an enemy's reach."
	}]
};

// Special familiars not in the SRD
CreatureList["faerie dragon"] = { // With contributions by Patrick O.
	name : "Faerie Dragon",
	nameAlt : ["Dragon, Faerie"],
	source : [["M", 133]],
	size : 5, //Tiny
	type : "Dragon",
	alignment : "Chaotic Good",
	ac : 15,
	hp : 14,
	hd : [4, 4],
	speed : "10 ft, fly 60 ft",
	scores : [3, 20, 13, 14, 12, 16], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"arcana" : 4,
		"perception" : 3,
		"stealth" : 7
	},
	senses : "Darkvision 60 ft",
	passivePerception : 13,
	languages : "Draconic, Sylvan",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, "", "piercing"],
		range : "Melee (5 ft)",
		description : "",
		abilitytodamage : false
	}, {
		name : "Euphoria Breath (Recharge 5-6)",
		ability : 3,
		damage : ["Wis save", "", "Euphoria"],
		range : "5 ft",
		description : "For 1 min, target rolls d6 at turn start: 1-4 move random (no actions), 5-6 save again (no actions/move)",
		dc : true,
		abilitytodamage : false,
		tooltip : "The dragon exhales a puff of euphoria gas at one creature within 5 feet of it. The target must succeed on a DC 11 Wisdom saving throw, or for 1 minute, the target can't take reactions and must roll a d6 at the start of each of its turns to determine its behavior during the turn: 1-4 - the target takes no action or bonus action and uses all its movment to move in a random direction. 5-6 - the target doesn't move, and the only thing it can do on its turn is make a DC 11 Wisdom saving throw, ending the effect on itself on a success."
	}],
	traits : [{
		name : "Superior Invisibility",
		description : "As a bonus action, the dragon can magically turn invisible until its concentration ends (as with a spell). Anything it wears or carries is invisible with it."
	}, {
		name : "Limited Telepathy",
		description : "Using telepathy, the dragon can magically communicate with any other faerie dragon within 60 feet of it."
	}, {
		name : "Magic Resistance",
		description : "The dragon has advantage on saves against spells and magical effects."
	}, {
		name : "Euphoria Breath (Recharge 5-6)",
		description : "Exhale a puff of euphoria gas at a creature within 5 ft. It must succeed on a DC 11 Wisdom save, or for 1 minute, it can't take reactions and must roll a d6 at the start of each of its turns:\n 1-4 - No action or bonus action, using all movment to move in a random direction.\n 5-6 - The target does nothing except attempt another save to try end the effect on itself."
	}],
	features : [{
		name : "Innate Spellcasting",
		description : "Cast spells using Charisma (save DC 13), requiring no material components. The spells it knows depends on its age (and stack):\n Red: 1/day - Dancing Lights, Mage Hand, Minor Illusion\n Orange (6-10 years): 1/day - Color Spray\n Yellow (11-20 years): 1/day - Mirror Image\n Green (21-30 years): 1/day - Suggestion\n Blue (31-40 years): 1/day - Major Image\n Indigo (41-50 years): 1/day - Hallucinatory Terrain\n Violet (51+ years): 1/day - Polymorph"
	}]
};
CreatureList["crawling claw"] = {
	name : "Crawling Claw",
	source : [["M", 44]],
	size : 5, //Tiny
	type : "Undead",
	companion : "familiar_not_al",
	alignment : "Neutral Evil",
	ac : 12,
	hp : 2,
	hd : [1, 4], //[#, die]
	speed : "20 ft, climb 20 ft",
	scores : [13, 14, 11, 5, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "Blindsight 30 ft (blind beyond this radius)",
	damage_immunities : "poison",
	condition_immunities : "charmed, exhaustion, poisoned",
	passivePerception : 10,
	languages : "understands Common but can't speak",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Claw",
		ability : 1,
		damage : [1, 4, "bludgeoning"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "Does bludgeoning or slashing damage (claw's choice)"
	}],
	traits : [{
		name : "Turn Immunity",
		description : "The claw is immune to effects that turn undead."
	}]
};
CreatureList["peryton"] = {
	name : "Peryton",
	source : [["M", 251]],
	size : 3, //Medium
	type : "Monstrosity",
	companion : "steed",
	alignment : "Chaotic Evil",
	ac : 13,
	hp : 33,
	hd : [6, 8], //[#, die]
	speed : "20 ft, fly 60 ft",
	scores : [16, 12, 13, 9, 12, 10], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 5
	},
	senses : "Adv. on Wis (Perception) checks using sight/smell",
	passivePerception : 16,
	languages : "understands Common and Elvish, but can't speak",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Gore",
		ability : 1,
		damage : [1, 8, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "One gore and one talons attack as an Attack action; +2d8 after 30 ft dive straight down"
	}, {
		name : "Talons",
		ability : 1,
		damage : [2, 4, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "One talons and one gore attack as an Attack action; +2d8 after 30 ft dive straight down"
	}],
	actions : [{
		name : "Multiattack",
		description : "The peryton makes one gore attack and one talon attack."
	}],
	traits : [{
		name : "Dive Attack",
		description : "If the peryton is flying and dives at least 30 ft. straight toward a target and then hits it with a melee weapon attack, the attack deals an extra 9 (2d8) damage to the target."
	}, {
		name : "Flyby",
		description : "The peryton doesn't provoke an opportunity attack when it flies out of an enemy's reach."
	}, {
		name : "Keen Sight and Smell",
		description : "The peryton has advantage on Wisdom (Perception) checks that rely on sight or smell."
	}]
};

// Blights and spores
CreatureList["needle blight"] = {
	name : "Needle Blight",
	nameAlt : ["Blight, Needle"],
	source : [["M", 32]],
	size : 3, //Medium
	type : "Plant",
	alignment : "Neutral Evil",
	ac : 12,
	hp : 11,
	hd : [2, 8], //[#, die]
	speed : "30 ft",
	scores : [12, 12, 13, 4, 8, 3], //[Str, Dex, Con, Int, Wis, Cha]
	condition_immunities : "blinded, deafened",
	senses : "Blindsight 60 ft (blind beyond this radius).",
	passivePerception : 9,
	languages : "understands Common but can't speak",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Claws",
		ability : 2,
		damage : [2, 4, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : ""
	}, {
		name : "Needles",
		ability : 2,
		damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "30/60 ft",
		description : ""
	}]
};
CreatureList["twig blight"] = {
	name : "Twig Blight",
	nameAlt : ["Blight, Twig"],
	source : [["M", 32]],
	size : 4, //Small
	type : "Plant",
	alignment : "Neutral Evil",
	ac : 13,
	hp : 4,
	hd : [1, 6], //[#, die]
	speed : "20 ft",
	scores : [6, 13, 12, 4, 8, 3], //[Str, Dex, Con, Int, Wis, Cha]
	damage_vulnerabilities : "fire",
	condition_immunities : "blinded, deafened",
	senses : "Blindsight 60 ft (blind beyond this radius).",
	passivePerception : 9,
	languages : "understands Common but can't speak",
	challengeRating : "1/8",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Claws",
		ability : 2,
		damage : [1, 4, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "False Appearance",
		description : "While the blight remains motionless, it is indistinguishable from a dead shrub."
	}]
};
CreatureList["vine blight"] = {
	name : "Vine Blight",
	nameAlt : ["Blight, Vine"],
	source : [["M", 32]],
	size : 3, //Medium
	type : "Plant",
	alignment : "Neutral Evil",
	ac : 12,
	hp : 26,
	hd : [4, 8], //[#, die]
	speed : "10 ft",
	scores : [15, 8, 14, 5, 10, 3], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 1
	},
	condition_immunities : "blinded, deafened",
	senses : "Blindsight 60 ft (blind beyond this radius).",
	passivePerception : 9,
	languages : "Common",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Constrict",
		ability : 1,
		damage : [2, 6, "bludgeoning"], //[#, die, type] "" for die is allowed
		range : "Melee (10 ft)",
		description : "Large or smaller target is grappled and restrained (escape DC 12); Can't use constrict again until grapple ends"
	}],
	traits : [{
		name : "False Appearance",
		description : "While the blight remains motionless, it is indistinguishable from a tangle of vines."
	}],
	actions : [{
		name : "Entangling Plants (Recharge 5-6)",
		description : "As an action, grasping roots and vines sprout in a 15-ft radius centered on the blight, withering away after 1 minute. For the duration, that area is difficult terrain for nonplant creatures. In addition, each creature of the blight's choice in that area when the plants appear must succeed on a DC 12 Strength saving throw or become restrained. A creature can use its action to make a DC 12 Strength check, freeing it self or another entangled creature within reach on a success."
	}],
	wildshapeString : "Blindsight 60 ft (blind beyond)| Immune to blinded, deafened| Entangling Plants (Recharge 5-6): As an action, 15-ft radius is difficult terrain for nonplant creatures, for 1 minute. Chosen creatures in it must make a DC 12 Str save or become restrained. A creature can use its action to make a DC 12 Str check to free itself or another within reach| False Appearance: While motionless, it's indistinguishable from a tangle of vines."
};
CreatureList["gas spore"] = {
	name : "Gas Spore",
	source : [["M", 138]],
	size : 2, //Large
	type : "Plant",
	alignment : "Unaligned",
	ac : 5,
	hp : 1,
	hd : [1, 10], //[#, die]
	speed : "fly 10 ft (hover)",
	scores : [5, 1, 3, 1, 1, 1], //[Str, Dex, Con, Int, Wis, Cha]
	condition_immunities : "blinded, deafened, frightened",
	senses : "Blindsight 30 ft (blind beyond this radius).",
	passivePerception : 5,
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Touch",
		ability : 1,
		damage : [1, "", "poison"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "DC 10 Con save or infected with Death Burst disease, see traits",
		modifiers : [1, ""],
		abilitytodamage : false
	}],
	traits : [{
		name : "Death Burst",
		description : "The gas spore explodes when it drops to 0 hit points. Each creature within 20 feet of it must succeed on a DC 15 Constitution saving throw or take 10 (3d6) poison damage and become infected with a disease on a failed save. Creatures immune to the poisoned condition are immune to this disease.\n   Spores invade an infected creature's system, killing the creature in a number of hours equal to 1d12+the creature's Constitution score, unless the disease is removed. In half that time, the creature becomes poisoned for the rest of the duration. After the creature dies, it sprouts 2d4 Tiny gas spores that grow to full size in 7 days."
	}, {
		name : "Eerie Resemblance",
		description : "The gas spore resembles a beholder. A creature that can see the gas spore can discern its true nature with a successful DC 15 Intelligence (Nature) check."
	}],
	wildshapeString : "Blindsight 30 ft (blind beyond)| Immune to: blinded, deafened, frightened| Distinguishable form a beholder only with a DC 15 Int (Nature) check| When at 0 HP, explodes: all within 20 ft DC 15 Con save or 3d6 poison damage and infected with disease| The disease kills a creature in 1d12+it's Con score of hours. In half that, it becomes poisoned for the remainder. When dies, sprouts 2d4 Tiny gas spores that grow to full size in 7 days."
};

// Even though the shield guardian is in the SRD, the description for its control amulet is only found in the Monster Manual
MagicItemsList["shield guardian amulet"] = {
	name : "Shield Guardian Amulet",
	source : [["M", 271], ["RotF", 149]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	notLegalAL : true,
	prerequisite : "Requires attunement by a humanoid",
	prereqeval : function(v) { return !CurrentRace.known || !RaceList[CurrentRace.known] || !/creature type/i.test(RaceList[CurrentRace.known].trait); },
	description : "A shield guardian is magically linked to this amulet. It has AC 10, 10 HP, and immunity to poison and psychic damage. I know the distance and direction of the guardian while I'm wearing the amulet and I'm on the same plane as it. While within 10 ft of it, I can use the amulet to reactivate it with a DC 20 Arcana check.",
	descriptionFull : "The amulet is a 4-inch-wide disk composed of silver-framed wood, with a rune carved into its face. A detect magic spell reveals a magical aura of enchantment around the amulet."+
	"\n   Every shield guardian has an amulet magically linked to it. A shield guardian can have only one corresponding amulet, and if that amulet is destroyed, the shield guardian is incapacitated until a replacement amulet is created."+
	"\n   A shield guardian's amulet is subject to direct attack if it isn't being worn or carried. It has AC 10, 10 hit points, and immunity to poison and psychic damage. Crafting an amulet requires 1 week and costs 1,000 gp in components."+
	"\n   A shield guardian's solitary focus is to protect the amulet's wearer. The amulet's wearer can command the guardian to attack its enemies or to guard the wielder against attack. If an attack threatens to injure the wearer, the construct can magically absorb the blow into its own body, even at a distance."+
	"\n   A humanoid that attunes to this amulet knows the distance and direction of the shield guardian, provided the amulet and the guardian are on the same plane of existence. As an action, the amulet's attuned wearer can try to reactivate the shield guardian, doing so with a successful DC 20 Intelligence (Arcana) check. Reactivation can only be attempted while the amulet and guardian are within 10 feet of each other.",
	creaturesAdd : [["Shield Guardian"]]
};


// Player characters as Lycanthropes race - even though they are in the SRD, the rules for applying their abilities to player characters are not (added in v13.1.13)
/*
Gains:
 - speed in non-humanoid form
 - damage immunities
 - traits
 - actions that don't involve equipment

 P.S. multiattack is a weird one, going with the interpretation here: https://rpg.stackexchange.com/questions/70694
*/
var MM_lycanthrope = {
	createDefaultTraits : function(sLycanName, sLycanPlural) {
		// the traits of a human
		var obj = {
			name : "Human " + sLycanName,
			plural : "Human " + sLycanPlural,
			languageProfs : ["Common", 1],
			age : " reach adulthood in their late teens and live less than 100 years",
			height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
			weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
			heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
			weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
			scorestxt : "+1 to all ability scores",
			scores : [1, 1, 1, 1, 1, 1, 1]
		}
		return obj;
	},
	createMessage : function(sLycanName, aOtherGains) {
		var aGained = [
			"Its speed in nonhumanoid form.",
			"Natural attacks in nonhumanoid form (e.g. bite/claw).",
			"Damage immunity to bludgeoning, piercing, and slashing from nonmagical attacks that aren't silvered.",
			"Shapechanger trait."
		].concat(aOtherGains);
		return "The lycanthrope races are template races. All features and traits of the base race are retained and all the " + sLycanName + "'s features are added to it."+
		"\nIf you choose not to use a previous race as the base race or you selected a " + sLycanName + " at character creation, a human (non-variant) will be used as the base race."+
		"\nThe " + sLycanName + "'s features added to the base race are:"+
		desc(aGained, "\n   \u2022 ")+
		"\n\nThe possible alignment change and moon-related limitations of lycanthrope are not mentioned in this race. Discuss with your DM how they want to handle lycanthrope."
	}
}
RaceList["lycanthrope-werebear"] = {
	regExpSearch : /were.?bear|^(?=.*lycanthrope)(?=.*bear).*$/i,
	name : "Werebear",
	source : [["M", 208]],
	plural : "Werebears",
	size : 3,
	speed : { walk : { spd : 30, enc : 20 } },
	trait : "Human Werebear (+1 to all ability scores; min 19 Str)" + desc([
		"Shapechanger: As an action, I can polymorph into a Large bear-hybrid, into a Large bear, or back. In those forms, I gain 40 ft walking speed, 30 ft climb speed, +1 AC, and a bite and claw attack. My stats don't otherwise change when transformed, but my equipment doesn't change and I revert back when I die. Humanoids hit by my bite must save or be cursed with werebear lycanthrope.",
		"Keen Smell: I have adv. on Wis (Perception) checks using smell."
	], "\n \u2022 "),
	features : {
		lycanthrope_features : {
			name : "Lycanthrope",
			source : [["M", 208]],
			minlevel : 1,
			toNotesPage : [{
				name : "Lycanthrope",
				note : [
					"My Strength score increases to 19 unless it was already higher",
					"As an action, I can polymorph into a Large bear-hybrid, into a Large bear, or back",
					"In my bear and hybrid forms, I gain 40 ft walking speed, 30 ft climb speed, and +1 AC",
					"In these forms I also gain a bite and claw attack, but can't use bite as part of a multiattack",
					"My stats don't otherwise change, my equipment doesn't transform and I revert back if I die",
					"Humanoids hit by my bite must make a Con save or be cursed with werebear lycanthrope",
					"The DC to avoid this curse is 8 + my Proficiency bonus + my Constitution modifier"
				],
				page3notes : true
			}, {
				name : "Multiattack",
				note : [
					"As an action, I can make two attacks, none of which can be with my werebear bite"
				],
				page3notes : true
			}],
			action : [
				["action", "Shapechange (bear/hybrid/back)"],
				["action", "Multiattack (2 attacks, no bite)"]
			],
			scoresOverride : [19, 0, 0, 0, 0, 0],
			savetxt : { immune : ["bludgeoning, piercing, and slashing damage unless from magic/silver"] },
			weaponOptions : [{
				name : "Werebear Bite",
				regExpSearch : /^(?=.*(werebear|lycanthrope))(?=.*bite).*$/i,
				source : [["M", 208]],
				ability : 1,
				type : "Natural",
				damage : [2, 10, "piercing"],
				range : "Melee",
				description : "Bear and Hybrid form only; Humanoids Con save or cursed",
				abilitytodamage : true,
				selectNow : true
			}, {
				name : "Werebear Claw",
				regExpSearch : /^(?=.*(werebear|lycanthrope))(?=.*\bclaws?\b).*$/i,
				source : [["M", 208]],
				ability : 1,
				type : "Natural",
				damage : [2, 8, "slashing"],
				range : "Melee",
				description : "Bear and Hybrid form only",
				abilitytodamage : true,
				selectNow : true
			}],
			extraAC : [{
				name : "+1 in bear/hybrid form",
				mod : 0,
				text : "I gain a +1 bonus to AC while I'm in my bear or bear-hybrid form. This bonus is not added by default, it has to be added/removed manually when changing form."
			}]
		},
		lycanthrope_keen_senses : {
			name : "Keen Smell",
			source : [["M", 208]],
			minlevel : 1,
			toNotesPage : [{
				name : "Keen Smell",
				note : [
					"I have advantage on Wisdom (Perception) checks that rely on smell"
				],
				page3notes : true
			}],
			vision : [["Keen Smell", 0]]
		}
	},
	useFromPreviousRace : {
		updateName : "prefix", // e.g. "Drow Werebear"
		message : MM_lycanthrope.createMessage("werebear", [
			"Strength increase to 19 unless it was already higher.",
			"Keen Smell trait."
		]),
		defaultTraits : MM_lycanthrope.createDefaultTraits("Werebear", "Werebears"),
		gainTraits : ["everything"]
	}
};
RaceList["lycanthrope-wereboar"] = {
	regExpSearch : /were.?boar|^(?=.*lycanthrope)(?=.*boar).*$/i,
	name : "Wereboar",
	source : [["M", 209]],
	plural : "Wereboars",
	size : 3,
	speed : { walk : { spd : 30, enc : 20 } },
	trait : "Human Wereboar (+1 to all ability scores; min 17 Str)" + desc([
		"Shapechanger: As an action, I can polymorph into a boar-" + (typePF ? "" : "humanoid ") + "hybrid, into a boar, or back. In those forms, I gain 40 ft walking speed, +1 AC, and a tusks attack. My stats don't otherwise change when transformed, but my equipment doesn't change and I revert back when I die. Humanoids hit by my tusks must save or be cursed" + (typePF ? "." : " with lycanthrope."),
		"Relentless: If I'm reduced to 0 HP by 14 damage or less, I can instead drop to 1 HP.",
		"Charge: If I move 15 ft straight before a tusks hit, +2d6 damage and Str save or prone."
	], "\n \u2022 "),
	features : {
		lycanthrope_features : {
			name : "Lycanthrope",
			source : [["M", 209]],
			minlevel : 1,
			toNotesPage : [{
				name : "Lycanthrope",
				note : [
					"My Strength score increases to 17 unless it was already higher",
					"As an action, I can polymorph into a boar-humanoid hybrid, into a boar, or back",
					"In my boar and hybrid forms, I gain 40 ft walking speed, a tusks attack, and +1 AC",
					"I also gain a bite and claw attack; As an action, I can make two claw attacks (multiattack)",
					"My stats don't otherwise change, my equipment doesn't transform and I revert back if I die",
					"Humanoids hit by my bite must make a Con save or be cursed with wereboar lycanthrope",
					"The DC to avoid this curse is 8 + my Proficiency bonus + my Constitution modifier"
				],
				page3notes : true
			}, {
				name : "Multiattack",
				note : [
					"As an action, I can make two attacks, only one of which can be with my wereboar tusks"
				],
				page3notes : true,
				additional : "in humanoid or hybrid form only"
			}],
			action : [
				["action", "Shapechange (boar/hybrid/back)"],
				["action", "Multiattack (2 attacks, max 1 tusks)"]
			],
			scoresOverride : [17, 0, 0, 0, 0, 0],
			savetxt : { immune : ["bludgeoning, piercing, and slashing damage unless from magic/silver"] },
			weaponOptions : [{
				name : "Wereboar Tusks",
				regExpSearch : /^(?=.*(wereboar|lycanthrope))(?=.*tusks).*$/i,
				source : [["M", 209]],
				ability : 1,
				type : "Natural",
				damage : [2, 6, "slashing"],
				range : "Melee",
				description : "Boar/hybrid form only; Humanoids Con save or cursed; Charge for +2d6 damage",
				abilitytodamage : true,
				selectNow : true
			}],
			extraAC : [{
				name : "+1 in boar/hybrid form",
				mod : 0,
				text : "I gain a +1 bonus to AC while I'm in my boar or boar-hybrid form. This bonus is not added by default, it has to be added/removed manually when changing form."
			}]
		},
		wereboar_relentless : {
			name : "Relentless",
			source : [["M", 209]],
			minlevel : 1,
			toNotesPage : [{
				name : "Relentless",
				note : [
					"If I'm reduced to 0 HP by an affect dealing 14 damage or less, I can instead drop to 1 HP"
				],
				page3notes : true,
				additional : "in boar or hybrid form only"
			}],
			usages : 1,
			recovery : "short rest"
		},
		wereboar_charge : {
			name : "Charge",
			source : [["M", 209]],
			minlevel : 1,
			toNotesPage : [{
				name : "Charge",
				note : [
					"If, in one turn, I move straight for 15 ft and then hit with my tusks, I deal +2d6 damage",
					"Those hit like this must make a Str save or be knocked prone (DC 8 + Prof B. + Str mod)"
				],
				page3notes : true,
				additional : "in boar or hybrid form only"
			}]
		}
	},
	useFromPreviousRace : {
		updateName : "prefix", // e.g. "High Elf Wereboar"
		message : MM_lycanthrope.createMessage("wereboar", [
			"Strength increase to 17 unless it was already higher.",
			"Relentless and Charge traits."
		]),
		defaultTraits : MM_lycanthrope.createDefaultTraits("Wereboar", "Wereboars"),
		gainTraits : ["everything"]
	},
	abilitySave : 1 // for charge trait
};
RaceList["lycanthrope-wererat"] = {
	regExpSearch : /were.?rat|^(?=.*lycanthrope)(?=.*rat).*$/i,
	name : "Wererat",
	source : [["M", 209]],
	plural : "Wererats",
	size : 3,
	speed : { walk : { spd : 30, enc : 20 } },
	trait : "Human Wererat (+1 to all ability scores; min 15 Dex)" + desc([
		"Shapechanger: As an action, I can transform into a rat-humanoid hybrid, into a giant rat, or back. In those forms, I gain a bite attack, which can use Strength or Dexterity. In my giant rat form, I also become small and gain Darkvision 60 ft My stats don't otherwise change when transformed, but my equipment doesn't change and I revert back when I die. Humanoids hit by my bite must save or be cursed with wererat lycanthrope.",
		"Keen Smell: I have adv. on Wis (Perception) checks using smell."
	], "\n \u2022 "),
	features : {
		lycanthrope_features : {
			name : "Lycanthrope",
			source : [["M", 209]],
			minlevel : 1,
			toNotesPage : [{
				name : "Lycanthrope",
				note : [
					"My Dexterity score increases to 15 unless it was already higher",
					"As an action, I can transform into a rat-humanoid hybrid, into a giant rat (Small), or back",
					"In my rat and hybrid forms, I gain a bite attack that can use either Strength or Dexterity",
					"In my giant rat form, I also become small and gain Darkvision 60 ft",
					"My stats don't otherwise change, my equipment doesn't transform and I revert back if I die",
					"Humanoids hit by my bite must make a Con save or be cursed with wererat lycanthrope",
					"The DC to avoid this curse is 8 + my Proficiency bonus + my Constitution modifier"
				],
				page3notes : true
			}, {
				name : "Multiattack",
				note : [
					"As an action, I can make two attacks, only one of which can be with my wererat bite"
				],
				page3notes : true,
				additional : "in humanoid or hybrid form only"
			}],
			action : [
				["action", "Shapechange (giant rat/hybrid/back)"],
				["action", "Multiattack (2 attacks, max 1 bite)"]
			],
			scoresOverride : [0, 15, 0, 0, 0, 0],
			savetxt : { immune : ["bludgeoning, piercing, and slashing damage unless from magic/silver"] },
			weaponOptions : [{
				name : "Wererat Bite",
				regExpSearch : /^(?=.*(wererat|lycanthrope))(?=.*bite).*$/i,
				source : [["M", 209]],
				ability : 2,
				type : "Natural",
				damage : [1, 4, "piercing"],
				range : "Melee",
				description : "Rat and Hybrid form only; Humanoids Con save or cursed",
				abilitytodamage : true,
				isWereratBite : true, // for calcChanges.atkAdd
				selectNow : true
			}],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.theWea.isWereratBite) fields.Mod = v.StrDex;
					},
					'I can use Strength or Dexterity for my Wererat Bite, whichever is higher.'
				]
			}
		},
		lycanthrope_keen_senses : {
			name : "Keen Smell",
			source : [["M", 209]],
			minlevel : 1,
			toNotesPage : [{
				name : "Keen Smell",
				note : [
					"I have advantage on Wisdom (Perception) checks that rely on smell"
				],
				page3notes : true
			}],
			vision : [["Keen Smell", 0]]
		}
	},
	useFromPreviousRace : {
		updateName : "prefix", // e.g. "Lizardfolk Wererat"
		message : MM_lycanthrope.createMessage("wererat", [
			"Dexterity increase to 15 unless it was already higher.",
			"Keen Smell trait."
		]),
		defaultTraits : MM_lycanthrope.createDefaultTraits("Wererat", "Wererats"),
		gainTraits : ["everything"]
	}
};
RaceList["lycanthrope-weretiger"] = {
	regExpSearch : /were.?tiger|^(?=.*lycanthrope)(?=.*tiger).*$/i,
	name : "Weretiger",
	source : [["M", 210]],
	plural : "Weretigers",
	size : 3,
	speed : { walk : { spd : 30, enc : 20 } },
	trait : "Human Weretiger (+1 to all ability scores; min 15 Str)" + desc([
		"Shapechanger: As an action, I can polymorph into a tiger-humanoid hybrid, into a Large tiger, or back. In those forms, I gain 40 ft walking speed, a bite attack, and a claw attack. My stats don't otherwise change when transformed, but my equipment doesn't transform and I revert back when I die. Humanoids hit by my bite must save or be cursed with weretiger lycanthrope."+
		(typePF ? "\n \u2022 Pounce: " : " ") + "I can pounce in my tiger and hybrid form, see notes.",
		"Keen Hearing and Smell: I have adv. on Wis (Perception) checks using hearing or smell."
	], "\n \u2022 "),
	features : {
		lycanthrope_features : {
			name : "Lycanthrope",
			source : [["M", 210]],
			minlevel : 1,
			toNotesPage : [{
				name : "Lycanthrope",
				note : [
					"My Strength score increases to 17 unless it was already higher; I gain 60 ft darkvision",
					"As an action, I can polymorph into a tiger-humanoid hybrid, into a Large tiger, or back",
					"In my tiger and hybrid forms, I gain 40 ft walking speed, a bite attack, and a claw attack",
					"My stats don't otherwise change, my equipment doesn't transform and I revert back if I die",
					"Humanoids hit by my bite must make a Con save or be cursed with weretiger lycanthrope",
					"The DC to avoid this curse is 8 + my Proficiency bonus + my Constitution modifier"
				],
				page3notes : true
			}, {
				name : "Multiattack",
				note : [
					"As an action, I can make two attacks, none of which can be with my weretiger bite"
				],
				page3notes : true,
				additional : "in humanoid or hybrid form only"
			}],
			action : [
				["action", "Shapechange (tiger/hybrid/back)"],
				["action", "Multiattack (2 attacks, no bite)"]
			],
			scoresOverride : [17, 0, 0, 0, 0, 0],
			savetxt : { immune : ["bludgeoning, piercing, and slashing damage unless from magic/silver"] },
			weaponOptions : [{
				name : "Weretiger Bite",
				regExpSearch : /^(?=.*(weretiger|lycanthrope))(?=.*bite).*$/i,
				source : [["M", 210]],
				ability : 1,
				type : "Natural",
				damage : [1, 10, "piercing"],
				range : "Melee",
				description : "Tiger and Hybrid form only; Humanoids Con save or cursed",
				abilitytodamage : true,
				selectNow : true
			}, {
				name : "Weretiger Claw",
				regExpSearch : /^(?=.*(weretiger|lycanthrope))(?=.*\bclaws?\b).*$/i,
				source : [["M", 210]],
				ability : 1,
				type : "Natural",
				damage : [1, 8, "slashing"],
				range : "Melee",
				description : "Tiger and Hybrid form only; Can be use to pounce",
				abilitytodamage : true,
				selectNow : true
			}],
			vision : [["Darkvision", 60]]
		},
		lycanthrope_keen_senses : {
			name : "Keen Hearing and Smell",
			source : [["M", 210]],
			minlevel : 1,
			toNotesPage : [{
				name : "Keen Hearing and Smell",
				note : [
					"I have advantage on Wisdom (Perception) checks that rely on hearing or smell"
				],
				page3notes : true
			}],
			vision : [["Keen Hearing and Smell", 0]]
		},
		weretiger_pounce : {
			name : "Pounce",
			source : [["M", 210]],
			minlevel : 1,
			toNotesPage : [{
				name : "Pounce",
				note : [
					"If, in one turn, I move straight for 15 ft and then hit with my claw, I can pounce a target",
					"The creature must make a Str save or be knocked prone (DC 8 + Prof Bonus + Str mod)",
					"If I knocked someone prone, I can then make a bite attack against them as a bonus action"
				],
				page3notes : true,
				additional : "in tiger or hybrid form only"
			}],
			action : [["bonus action", "Bite after successful Pounce"]]
		}
	},
	useFromPreviousRace : {
		updateName : "prefix", // e.g. "Mountain Dwarf Weretiger"
		message : MM_lycanthrope.createMessage("weretiger", [
			"Strength increase to 17 unless it was already higher.",
			"Keen Hearing and Smell trait."
		]),
		defaultTraits : MM_lycanthrope.createDefaultTraits("Weretiger", "Weretigers"),
		gainTraits : ["everything"]
	},
	abilitySave : 1 // for pounce trait
};
RaceList["lycanthrope-werewolf"] = {
	regExpSearch : /were.?wol(f|ve)|^(?=.*lycanthrope)(?=.*wol(f|ve)).*$/i,
	name : "Werewolf",
	source : [["M", 211]],
	plural : "Werewolves",
	size : 3,
	speed : { walk : { spd : 30, enc : 20 } },
	trait : "Human Werewolf (+1 to all ability scores; min 15 Str)" + desc([
		"Shapechanger: As an action, I can polymorph into a wolf-humanoid hybrid, into a wolf, or back. In those forms, I gain 40 ft walking speed, a bite attack, and +1 AC. In my hybrid form, I also gain a claws attack. My stats don't otherwise change when transformed, but my equipment doesn't transform and I revert back when I die. Humanoids hit by my bite must save or be cursed with werewolf lycanthrope.",
		"Keen Hearing and Smell: I have adv. on Wis (Perception) checks using hearing or smell."
	], "\n \u2022 "),
	features : {
		lycanthrope_features : {
			name : "Lycanthrope",
			source : [["M", 211]],
			minlevel : 1,
			toNotesPage : [{
				name : "Lycanthrope",
				note : [
					"My Strength score increases to 15 unless it was already higher",
					"As an action, I can polymorph into a wolf-humanoid hybrid, into a wolf, or back",
					"In my wolf and hybrid forms, I gain 40 ft walking speed, a bite attack, and +1 AC",
					"In my hybrid form, I also gain a claws attack",
					"My stats don't otherwise change, my equipment doesn't transform and I revert back if I die",
					"Humanoids hit by my bite must make a Con save or be cursed with werewolf lycanthrope",
					"The DC to avoid this curse is 8 + my Proficiency bonus + my Constitution modifier"
				],
				page3notes : true
			}, {
				name : "Multiattack",
				note : [
					"As an action, I can make two attacks, only one of which can be with my werewolf bite"
				],
				page3notes : true,
				additional : "in humanoid or hybrid form only"
			}],
			action : [
				["action", "Shapechange (wolf/hybrid/back)"],
				["action", "Multiattack (2 attacks, max 1 bite)"]
			],
			scoresOverride : [15, 0, 0, 0, 0, 0],
			savetxt : { immune : ["bludgeoning, piercing, and slashing damage unless from magic/silver"] },
			weaponOptions : [{
				name : "Werewolf Bite",
				regExpSearch : /^(?=.*(werewolf|lycanthrope))(?=.*bite).*$/i,
				source : [["M", 211]],
				ability : 1,
				type : "Natural",
				damage : [1, 8, "piercing"],
				range : "Melee",
				description : "Wolf and Hybrid form only; Humanoids Con save or cursed",
				abilitytodamage : true,
				selectNow : true
			}, {
				name : "Wolf-hybrid Claws",
				regExpSearch : /^(?=.*wolf)(?=.*hybrid)(?=.*\bclaws?\b).*$/i,
				source : [["M", 211]],
				ability : 1,
				type : "Natural",
				damage : [2, 4, "slashing"],
				range : "Melee",
				description : "Hybrid form only",
				abilitytodamage : true,
				selectNow : true
			}],
			extraAC : [{
				name : "+1 in wolf/hybrid form",
				mod : 0,
				text : "I gain a +1 bonus to AC while I'm in my wolf or wolf-hybrid form. This bonus is not added by default, it has to be added/removed manually when changing form."
			}]
		},
		lycanthrope_keen_senses : {
			name : "Keen Hearing and Smell",
			source : [["M", 211]],
			minlevel : 1,
			toNotesPage : [{
				name : "Keen Hearing and Smell",
				note : [
					"I have advantage on Wisdom (Perception) checks that rely on hearing or smell"
				],
				page3notes : true
			}],
			vision : [["Keen Hearing and Smell", 0]]
		}
	},
	useFromPreviousRace : {
		updateName : "prefix", // e.g. "Rock Gnome Werewolf"
		message : MM_lycanthrope.createMessage("werewolf", [
			"Strength increase to 15 unless it was already higher.",
			"Keen Hearing and Smell trait."
		]),
		defaultTraits : MM_lycanthrope.createDefaultTraits("Werewolf", "Werewolves"),
		gainTraits : ["everything"]
	}
};

// pub_20141209_DMG.js
// This file adds all the player-material from the Dungeon Master's Guide to MPMB's Character Record Sheet

// Define the source
SourceList.D={
	name : "Dungeon Master's Guide",
	abbreviation : "DMG",
	group : "Core Sources",
	url : "https://dnd.wizards.com/products/dungeon-masters-guide",
	date : "2014/12/09"
};

// Races
RaceList["aasimar"] = {
	regExpSearch : /^(?!.*(fallen|protector|scourge))((?=.*aasimar)|((?=.*planetouched)(?=.*(celestial|angel)))).*$/i,
	name : "Aasimar",
	source : [["D", 286]],
	plural : "Aasimar",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Celestial"],
	vision : [["Darkvision", 60]],
	dmgres : ["Necrotic", "Radiant"],
	age : " reach adulthood in their late teens and live around 160 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 0, 1, 2],
	trait : "Aasimar (+1 Wisdom, +2 Charisma)\n\nCelestial Legacy:\n   I know the Light cantrip.\n   Once I reach 3rd level, I can cast the Lesser Restoration spell once per long rest.\n   Once I reach 5th level, I can cast the Daylight spell once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Celestial Legacy (level 1)",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"lesser restoration" : {
			name : "Celestial Legacy (level 3)",
			limfeaname : "Lesser Restoration",
			usages : 1,
			minlevel : 3,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Celestial Legacy (level 3)",
				spells : ["lesser restoration"],
				selection : ["lesser restoration"],
				firstCol : 'oncelr'
			}
		},
		"daylight" : {
			name : "Celestial Legacy (level 5)",
			limfeaname : "Daylight",
			usages : 1,
			minlevel : 5,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Celestial Legacy (level 5)",
				spells : ["daylight"],
				selection : ["daylight"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["eladrin"] = {
	regExpSearch : /^(?!.*half)((?=.*eladrin)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(feys?|feywild)\b))).*$/i,
	name : "Eladrin",
	sortname : "Elf, Fey (Eladrin)",
	source : [["D", 286]],
	plural : "Eladrin",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	weaponProfs : [false, false, ["longsword", "shortsword", "longbow", "shortbow"]],
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d12\")",
	weight : " weigh around 115 lb (90 + 2d12 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (140 + 5d12 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d12 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 1, 0, 0],
	trait : "Eladrin (+2 Dexterity, +1 Intelligence)\nTrance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. While meditating, I can dream after a fashion; such dreams are actually mental exercises that have become reflexive through years of practice. After resting in this way, I gain the same benefit that a human does from 8 hours of sleep, thus needing only 4 hours for a long rest.\nFey Step: I can cast the Misty Step spell once using this trait. I regain the ability to do so when I finish a short rest.",
	spellcastingAbility : 4,
	features : {
		"fey step" : {
			name : "Fey Step",
			limfeaname : "Misty Step",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			spellcastingBonus : {
				name : "Fey Step",
				spells : ["misty step"],
				selection : ["misty step"],
				firstCol : 'oncesr'
			}
		}
	}
};

// Subclasses
AddSubClass("cleric", "death domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(death|dead|dying)).*$/i,
	subname : "Death Domain",
	source : [["D", 96]],
	spellcastingExtra : ["false life", "ray of sickness", "blindness/deafness", "ray of enfeeblement", "animate dead", "vampiric touch", "blight", "death ward", "antilife shell", "cloudkill"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : [["D", 96]],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with martial weapons",
			weaponProfs : [false, true]
		},
		"subclassfeature1.1" : {
			name : "Reaper",
			source : [["D", 96]],
			minlevel : 1,
			description : "\n   " + "I learn one necromancy cantrip of my choice from any spell list" + "\n   " + "My necromancy, single-target cantrips can affect two targets within 5 ft of each other",
			spellcastingBonus : {
				name : "Reaper",
				"class" : "any",
				school : ["Necro"],
				level : [0, 0]
			},
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellObj.school == "Necro" && spellObj.level === 0) {
							var startDescr = spellObj.description;
							switch (spellKey) {
								case "chill touch" :
									spellObj.description = spellObj.description.replace("Spell attack", "2 crea in 5 ft spell atk").replace("Necrotic", "Necro.").replace("at CL 5, 11, and 17", "CL 5/11/17");
									break;
								case "spare the dying" :
									spellObj.description = spellObj.description.replace("1 living creature", "1 living creature (or 2 within 5 ft of each other)");
									break;
								case "toll the dead" :
								default :
									spellObj.description = spellObj.description.replace(/1 crea(ture)?/i, "2 crea in 5 ft").replace("disadvantage", "disadv.").replace("save halves", "save half");
							}
							return startDescr !== spellObj.description;
						};
					},
					"My necromancy, single-target cantrips can affect two targets within 5 ft of each other."
				]
			}
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Touch of Death",
			source : [["D", 97]],
			minlevel : 2,
			description : "\n   " + "When I hit a creature with a melee attack, I can deal extra necrotic damage",
			additional : ["", "+9 damage", "+11 damage", "+13 damage", "+15 damage", "+17 damage", "+19 damage", "+21 damage", "+23 damage", "+25 damage", "+27 damage", "+29 damage", "+31 damage", "+33 damage", "+35 damage", "+37 damage", "+39 damage", "+41 damage", "+43 damage", "+45 damage"]
		},
		"subclassfeature6" : {
			name : "Inescapable Destruction",
			source : [["D", 97]],
			minlevel : 6,
			description : "\n   " + "When I deal necrotic damage with spells or Channel Divinity, I ignore resistance to it"
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : [["D", 97]],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 necrotic damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && v.isWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 necrotic damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra necrotic damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Improved Reaper",
			source : [["D", 97]],
			minlevel : 17,
			description : "\n   " + "If I cast a 5th-level or lower necromancy spell that has one target, I can target two" + "\n   " + "They need to be within 5 ft of each other; I have to provide material comp. for both",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellObj.school == "Necro" && spellObj.level && spellObj.level < 6) {
							var startDescr = spellObj.description;
							switch (spellKey) {
								case "blindness/deafness" :
									// only 2 target if not cast at higher SL
									spellObj.description = "2 crea in 5 ft or " + spellObj.description;
									break;
								case "contagion" :
								case "inflict wounds" :
								case "ray of enfeeblement" :
									spellObj.description = spellObj.description.replace(/(Melee )?spell attack/i, "2 " + "$1".toLowerCase() + "spell atk in 5 ft").replace("spell ends", "ends");
									break;
								case "cause fear" :
									spellObj.description = "2 crea in 5 ft or 1+1/SL crea max 30 ft apart (no constr/undead), save or frightened; save end of turn";
									break;
								case "feign death" :
									spellObj.description = "2 willing crea in 5 ft appear dead; Are blinded, incapacitated, dmg resist. all but Psychic, speed 0";
									break;
								case "gentle repose" :
									spellObj.description = spellObj.description.replace("1 corpse protected from", "2 corpses in 5 ft suffer no");
									break;
								case "raise dead" :
								case "revivify" :
									spellObj.description = spellObj.description.replace("a creature's body that has", "body of 2 crea in 5 ft that").replace("cons.)", "cons. \xD72)");
									spellObj.compMaterial += " (once for each target)";
									break;
								case "speak with dead" :
									spellObj.description = spellObj.description.replace("1 corpse with mouth answers 5 questions", "2 corpses in 5 ft answer 5 questions each");
									break;
								case "enervation" :
									spellObj.description = spellObj.description.replace("action", "1 a").replace("see book", "see B");
								case "bestow curse" :
								case "blight" :
								case "cause fear-uass" :
								case "life transference" :
								case "negative energy flood" :
								default :
									spellObj.description = spellObj.description.replace(/1 crea(ture)?/i, "2 crea in 5 ft").replace("disadvantage", "disadv.").replace("save halves", "save half");
							}
							return startDescr !== spellObj.description;
						};
					},
					"My necromancy, single-target 5th-level or lower spells can affect two targets within 5 ft of each other if both are within range of the spell. The spells still require material components for each target separately."
				]
			}
		}
	}
});
AddSubClass("paladin", "oathbreaker", {
	regExpSearch : /^((?=.*blackguard)|((?=.*(oath.*breaker|breaker.*oath))((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper)))))).*$/i,
	subname : "Oathbreaker",
	source : [["D", 97]],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Control Undead",
			source : [["D", 97]],
			minlevel : 3,
			description : "\n   " + "As an action, one undead (CR < paladin level) I can see in 30 ft must make a Wis save" + "\n   " + "If failed, it must obey my commands for 24 hours or until I use this on another",
			action : ["action", ""],
			spellcastingExtra : ["hellish rebuke", "inflict wounds", "crown of madness", "darkness", "animate dead", "bestow curse", "blight", "confusion", "contagion", "dominate person"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Dreadful Aspect",
			source : [["D", 97]],
			minlevel : 3,
			description : "\n   " + "As an action, anyone I choose within 30 ft that can see me must make a Wisdom save" + "\n   " + "If failed, it is frightened for 1 min or until it succeeds a save at the end of its turns" + "\n   " + "It can't save at the end of its turn if it's still within 30 ft of me",
			action : ["action", ""]
		},
		"subclassfeature7" : {
			name : "Aura of Hate",
			source : [["D", 97]],
			minlevel : 7,
			description : "\n   " + "Fiends/undead within range and I add my Cha mod as bonus on melee weapon damage" + "\n   " + "Multiple Auras of Hate don't stack; only the strongest applies",
			additional : ["", "", "", "", "", "", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "30-foot aura", "30-foot aura", "30-foot aura"],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.isMeleeWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Cha mod added to damage';
						}
					},
					"I add my Charisma modifier to my melee weapon damage."
				],
				atkCalc : [
					function (fields, v, output) {
						if (v.isMeleeWeapon) {
							output.extraDmg += Number(What("Cha Mod"));
						};
					}
				]
			}
		},
		"subclassfeature15" : {
			name : "Supernatural Resistance",
			source : [["D", 97]],
			minlevel : 15,
			description : "\n   " + "I have resistance to bludgeoning/piercing/slashing damage from nonmagical weapons",
			dmgres : [["Bludgeoning", "Bludg. (nonmagical)"], ["Piercing", "Pierc. (nonmagical)"], ["Slashing", "Slash. (nonmagical)"]]
		},
		"subclassfeature20" : {
			name : "Dread Lord",
			source : [["D", 97]],
			minlevel : 20,
			description : "\n   " + "As an action, I gain a 30-ft aura of gloom that reduces bright light to dim for 1 min" + "\n   " + "If frightened of me, foes starting their turn in the aura take 4d10 psychic damage" + "\n   " + "Attacks vs. my allies and me inside the aura have disadvantage if attackers need sight" + "\n   " + "As a bonus action, I can make a melee spell attack vs. a target inside the aura" + "\n   " + "If this attack hits, it does 3d10 + Charisma modifier necrotic damage",
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});

// Firearms [weapons and ammunition] (includes contributions by grungydan)
WeaponsList["pistol"] = {
	regExpSearch : /^(?=.*pistol)(?!.*automatic).*$/i,
	name : "Pistol",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [1, 10, "piercing"],
	range : "30/90 ft",
	weight : 3,
	description : "Ammunition, loading",
	abilitytodamage : true,
	ammo : "renaissance bullet",
	defaultExcluded : true
};
WeaponsList["musket"] = {
	regExpSearch : /musket/i,
	name : "Musket",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [1, 12, "piercing"],
	range : "40/120 ft",
	weight : 10,
	description : "Ammunition, loading, two-handed",
	abilitytodamage : true,
	ammo : "renaissance bullet",
	defaultExcluded : true
};
WeaponsList["pistol automatic"] = {
	regExpSearch : /^(?!.*rifle)(?=.*pistol)(?=.*automatic).*$/i,
	name : "Pistol, automatic",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 6, "piercing"],
	range : "50/150 ft",
	weight : 3,
	description : "Ammunition, reload (15 shots)",
	abilitytodamage : true,
	ammo : "modern bullet",
	defaultExcluded : true
};
WeaponsList["revolver"] = {
	regExpSearch : /revolver/i,
	name : "Revolver",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 8, "piercing"],
	range : "40/120 ft",
	weight : 3,
	description : "Ammunition, reload (6 shots)",
	abilitytodamage : true,
	ammo : "modern bullet",
	defaultExcluded : true
};
WeaponsList["rifle hunting"] = {
	regExpSearch : /^(?!=laser|antimatter)(?=.*hunting)(?=.*rifle).*$/i,
	name : "Hunting Rifle",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 10, "piercing"],
	range : "80/240 ft",
	weight : 8,
	description : "Ammunition, reload (5 shots), two-handed",
	abilitytodamage : true,
	ammo : "modern bullet",
	defaultExcluded : true
};
WeaponsList["rifle automatic"] = {
	regExpSearch : /^(?!=.*laser|antimatter)(?=.*automatic)(?=.*rifle).*$/i,
	name : "Automatic Rifle",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 8, "piercing"],
	range : "80/240 ft",
	weight : 8,
	description : "Ammunition, burst fire, reload (30 shots), two-handed",
	abilitytodamage : true,
	ammo : "modern bullet",
	defaultExcluded : true
};
WeaponsList["shotgun"] = {
	regExpSearch : /shotgun/i,
	name : "Shotgun",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 8, "piercing"],
	range : "30/90 ft",
	weight : 7,
	description : "Ammunition, reload (2 shots), two-handed",
	abilitytodamage : true,
	ammo : "modern bullet",
	defaultExcluded : true
};
WeaponsList["laser pistol"] = {
	regExpSearch : /^(?=.*laser)(?=.*pistol).*$/i,
	name : "Laser Pistol",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [3, 6, "radiant"],
	range : "40/120 ft",
	weight : 2,
	description : "Ammunition, reload (50 shots), two-handed",
	abilitytodamage : true,
	ammo : "energy cell",
	defaultExcluded : true
};
WeaponsList["antimatter rifle"] = {
	regExpSearch : /^(?!.*laser)(?=.*antimatter)(?=.*rifle).*$/i,
	name : "Antimatter Rifle",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [6, 8, "necrotic"],
	range : "120/360 ft",
	weight : 10,
	description : "Ammunition, reload (2 shots), two-handed",
	abilitytodamage : true,
	ammo : "energy cell",
	defaultExcluded : true
};
WeaponsList["laser rifle"] = {
	regExpSearch : /^(?!.*antimatter)(?=.*laser)(?=.*rifle).*$/i,
	name : "Laser Rifle",
	source : [["D", 268]],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [3, 8, "radiant"],
	range : "100/300 ft",
	weight : 7,
	description : "Ammunition, reload (30 shots), two-handed",
	abilitytodamage : true,
	ammo : "energy cell",
	defaultExcluded : true
};
AmmoList["renaissance bullet"] = {
	name : "Bullets, Renaissance",
	source : [["D", 268]],
	weight : 0.2,
	icon : "Bullets",
	checks : [".Bullet"],
	display : 50,
	invName : "Bullets, renaissance",
	alternatives : [/^(?=.*bullet)(?=.*renaissance).*$/i],
	defaultExcluded : true
};
AmmoList["modern bullet"] = {
	name : "Bullets, Modern",
	source : [["D", 268]],
	weight : 0.1,
	icon : "Bullets",
	checks : [".Bullet"],
	display : 50,
	invName : "Bullets, modern",
	alternatives : [/^(?=.*bullet)(?=.*modern).*$/i],
	defaultExcluded : true
};
AmmoList["energy cell"] = {
	name : "Energy Cell",
	source : [["D", 268]],
	weight : 0,
	icon : "Bullets",
	checks : [".Bullet"],
	display : 50,
	invName : "Energy Cell",
	defaultExcluded : true
};

// Magic Items not found in the SRD
MagicItemsList["alchemy jug"] = {
	name : "Alchemy Jug",
	source : [["D", 150]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "As an action, command the jug to produce liquid; or an action to uncorked it and pour 2 gal/min. After producing, it only makes the same up to its max, until next dawn. Oil (1 qt), acid (8 fl oz), basic poison (1/2 fl oz), beer (4 gal), honey/wine (1 gal), fresh water (8 gal), mayonnaise/vinegar (2 gal), salt water (12 gal).",
	descriptionLong : "A heavy ceramic jug. As an action, the jug can be commanded to hold a chosen liquid. With another action, I can uncork the jug and pour the liquid out at 2 gallons per minute. Once commanded to produce a liquid, it can't produce a different one or more than the maximum of one, until the next dawn.\rLiquids (with maximum): acid (8 fl. oz.), basic poison (1/2 fl. oz.), beer (4 gallons), honey (1 gallon), mayonnaise (2 gallons), oil (1 quart), vinegar (2 gallons), fresh water (8 gallons), salt water (12 gallons), wine (1 gallon).",
	descriptionFull : "This ceramic jug appears to be able to hold a gallon of liquid and weighs 12 pounds whether full or empty. Sloshing sounds can be heard from within the jug when it is shaken, even if the jug is empty."+
	"\n   You can use an action and name one liquid from the table below to cause the jug to produce the chosen liquid. Afterward, you can uncork the jug as an action and pour that liquid out, up to 2 gallons per minute. The maximum amount of liquid the jug can produce depends on the liquid you named."+
	"\n   Once the jug starts producing a liquid, it can't produce a different one, or more of one that has reached its maximum, until the next dawn.\n\n"+
	toUni("Max        \tLiquid\t\tMax        \tLiquid")+
	"\n8 ounces  \tAcid\t\t1 quart   \tOil"+
	"\n1/2 ounce\tBasic poison\t2 gallons  \tVinegar"+
	"\n4 gallons  \tBeer\t\t8 gallons  \tWater, fresh"+
	"\n1 gallon    \tHoney\t\t12 gallons\tWater, salt"+
	"\n2 gallons \tMayonnaise\t1 gallon    \tWine",
	weight : 12
}
MagicItemsList["cap of water breathing"] = {
	name : "Cap of Water Breathing",
	source : [["D", 157]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "While wearing this cap underwater, I can speak its command word as an action to create a bubble of air around my head. It allows me to breathe normally underwater. This bubble stays with me until I speak the command word again, the cap is removed, or I am no longer underwater.",
	descriptionFull : "While wearing this cap underwater, you can speak its command word as an action to create a bubble of air around your head. It allows you to breathe normally underwater. This bubble stays with you until you speak the command word again, the cap is removed, or you are no longer underwater.",
	action : [["action", ""]]
}
MagicItemsList["cloak of invisibility"] = {
	name : "Cloak of Invisibility",
	source : [["D", 158]],
	type : "wondrous item",
	rarity : "legendary",
	magicItemTable : "I",
	description : "As an action, I can pull the hood of this cloak down or up over my head, making myself invisible (down) or visible again (up). While invisible, anything I carry or wear is invisible as well. It functions for 2 hours, usable in increments of 1 minute. It regains 1 hour of duration for every 12 hours not being used.",
	descriptionFull : "While wearing this cloak, you can pull its hood over your head to cause yourself to become invisible. While you are invisible, anything you are carrying or wearing is invisible with you. You become visible when you cease wearing the hood. Pulling the hood up or down requires an action.\n   Deduct the time you are invisible, in increments of 1 minute, from the cloak's maximum duration of 2 hours. After 2 hours of use, the cloak ceases to function. For every uninterrupted period of 12 hours the cloak goes unused, it regains 1 hour of duration.",
	attunement : true,
	action : [["action", " (hood up/down)"]],
	usages : "120 min",
	recovery : "Special",
	additional : "regain 1h/12h"
}
MagicItemsList["driftglobe"] = {
	name : "Driftglobe",
	source : [["D", 166]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : ["A", "B"],
	description : "By speaking its command word while within 60 ft, this glass sphere casts Light or Daylight on itself. Daylight only works once per dawn. While lit up, I can use an action to speak another command word to make it hover 5 ft off the ground and follow me at a distance of 60 ft. It stops hovering when grasped.",
	descriptionFull : "This small sphere of thick glass weighs 1 pound. If you are within 60 feet of it, you can speak its command word and cause it to emanate the Light or Daylight spell. Once used, the Daylight effect can't be used again until the next dawn.\n   You can speak another command word as an action to make the illuminated globe rise into the air and float no more than 5 feet off the ground. The globe hovers in this way until you or another creature grasps it. If you move more than 60 feet from the hovering globe, it follows you until it is within 60 feet of you. It takes the shortest route to do so. If prevented from moving, the globe sinks gently to the ground and becomes inactive, and its light winks out.",
	weight : 1,
	action : [["action", " (hover)"]],
	usages : 1,
	recovery : "dawn",
	additional : "Daylight",
	spellcastingBonus : [{
		name : "On globe",
		spells : ["light"],
		selection : ["light"],
		firstCol : "atwill"
	}, {
		name : "On globe",
		spells : ["daylight"],
		selection : ["daylight"],
		firstCol : "oncelr"
	}],
	spellChanges : {
		"light" : {
			range : "Globe",
			description : "Driftglobe sheds bright light in a 20-ft radius and dim light in an additional 20-ft radius",
			changes : "The spell can only affect the globe."
		},
		"daylight" : {
			range : "Globe",
			description : "Driftglobe shed 60-ft rad bright light + 60-ft dim light; only magical darkness of SL 4+ works in it",
			changes : "The spell can only affect the globe."
		}
	}
}
MagicItemsList["efreeti chain"] = {
	name : "Efreeti Chain",
	source : [["D", 167]],
	type : "armor (chain mail)",
	rarity : "legendary",
	magicItemTable : "I",
	description : "While wearing this armor, I gain a +3 bonus to AC, I am immune to fire damage, and I can understand and speak Primordial. In addition, I can stand on and walk across molten rock as if it were solid ground.",
	descriptionFull : "While wearing this armor, you gain a +3 bonus to AC, you are immune to fire damage, and you can understand and speak Primordial. In addition, you can stand on and walk across molten rock as if it were solid ground.",
	attunement : true,
	weight : 55,
	languageProfs : ["Primordial"],
	savetxt : { immune : ["fire"] },
	armorOptions : [{
		regExpSearch : /^(?=.*efreeti)(?=.*chain).*$/i,
		name : "Efreeti Chain",
		source : [["D", 167]],
		type : "heavy",
		ac : "16+3",
		stealthdis : true,
		weight : 55,
		strReq : 13,
		selectNow : true
	}]
}
MagicItemsList["elixir of health"] = {
	name : "Elixir of Health",
	source : [["D", 168]],
	type : "potion",
	rarity : "rare",
	magicItemTable : "C",
	description : "Once as an action, I can drink this potion or administer it to another to cure any disease, and removing the blinded, deafened, paralyzed, and poisoned conditions. The potion's clear red liquid has tiny bubbles of light in it.",
	descriptionFull : "When you drink this potion, it cures any disease afflicting you, and it removes the blinded, deafened, paralyzed, and poisoned conditions. The clear red liquid has tiny bubbles of light in it.",
	weight : 0.5
}
MagicItemsList["gloves of thievery"] = {
	name : "Gloves of Thievery",
	source : [["D", 172]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "These gloves are invisible while worn. While wearing them, I gain a +5 bonus to Dexterity (Sleight of Hand) checks and Dexterity checks made to pick locks.",
	descriptionFull : "These gloves are invisible while worn. While wearing them, you gain a +5 bonus to Dexterity (Sleight of Hand) checks and Dexterity checks made to pick locks.",
	addMod : [{ type: "skill", field : "Sleight of Hand", mod : 5, text : "I gain a +5 bonus to Dexterity (Sleight of Hand) checks while wearing Gloves of Thievery." }]
}
MagicItemsList["instrument of the bards"] = {
	name : "Instrument of the Bards",
	source : [["D", 176]],
	type : "wondrous item (instrument)",
	description : "If I play this exquisite, magical instruments while casting a spell that has a somatic or material component and charms on a failed save, it imposes disadvantage on that save. I can also use it to cast a set of spells, each once per dawn, using my spellcasting ability and spell save DC.",
	descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.",
	attunement : true,
	weight : 3, // Magic of Faerûn (2001) page 161
	prerequisite : "Requires attunement by a bard",
	prereqeval : function(v) { return classes.known.bard ? true : false; },
	choices : ["Anstruth Harp (very rare)", "Canaith Mandolin (rare)", "Cli Lyre (rare)", "Doss Lute (uncommon)", "Fochlucan Bandore (uncommon)", "Mac-Fuirmidh Cittern (uncommon)", "Ollamh Harp (legendary)"],
	"anstruth harp (very rare)" : {
		name : "Anstruth Harp [Instrument of the Bards]",
		sortname : "Instrument of the Bards, Anstruth Harp",
		rarity : "very rare",
		magicItemTable : "H",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Anstruth harp can be used to cast Control Weather, Cure Wounds (5th level), and Wall of Thorns.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "control weather", "cure wounds", "wall of thorns"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "control weather", "cure wounds", "wall of thorns"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		},
		spellChanges : {
			"cure wounds" : {
				description : "1 living creature heals 5d8+spellcasting ability modifier HP",
				changes : "When using the Anstruth Harp to cast Cure Wounds, it is cast at 5th-level."
			},
			"control weather" : {
				time : "1 a",
				changes : "Casting time is only an action."
			}
		}
	},
	"canaith mandolin (rare)" : {
		name : "Canaith Mandolin [Instrument of the Bards]",
		sortname : "Instrument of the Bards, Canaith Mandolin",
		rarity : "rare",
		magicItemTable : "G",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Canaith mandolin can be used to cast Cure Wounds (3rd level), Dispel Magic, and Protection from Energy (lightning only).",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "cure wounds", "dispel magic", "protection from energy"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "cure wounds", "dispel magic", "protection from energy"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		},
		spellChanges : {
			"cure wounds" : {
				description : "1 living creature heals 3d8+spellcasting ability modifier HP",
				changes : "When using the Canaith Mandolin to cast Cure Wounds, it is cast at 3rd-level."
			},
			"protection from energy" : {
				description : "1 creature gains resistance to Lightning damage for the duration",
				changes : "When using the Canaith Mandolin to cast Protection from Energy, it can only grant resistance to lightning damage."
			}
		}
	},
	"cli lyre (rare)" : {
		name : "Cli Lyre [Instrument of the Bards]",
		sortname : "Instrument of the Bards, Cli Lyre",
		rarity : "rare",
		magicItemTable : "G",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Cli lyre can be used to cast Stone Shape, Wall of Fire, and Wind Wall.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "stone shape", "wall of fire", "wind wall"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "stone shape", "wall of fire", "wind wall"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		}
	},
	"doss lute (uncommon)" : {
		name : "Doss Lute [Instrument of the Bards]",
		sortname : "Instrument of the Bards, Doss Lute",
		rarity : "uncommon",
		magicItemTable : "F",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Doss lute can be used to cast Animal Friendship, Protection from Energy (fire only), and Protection from Poison.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "animal friendship", "protection from energy", "protection from poison"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "animal friendship", "protection from energy", "protection from poison"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		},
		spellChanges : {
			"protection from energy" : {
				description : "1 creature gains resistance to Fire damage for the duration",
				changes : "When using the Doss Lute to cast Protection from Energy, it can only grant resistance to fire damage."
			}
		}
	},
	"fochlucan bandore (uncommon)" : {
		name : "Fochlucan Bandore [Instrument of the Bards]",
		sortname : "Instrument of the Bards, Fochlucan Bandore",
		rarity : "uncommon",
		magicItemTable : "F",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Fochlucan bandore can be used to cast Entangle, Faerie Fire, Shillelagh, and Speak with Animals.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "entangle", "faerie fire", "shillelagh", "speak with animals"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "entangle", "faerie fire", "shillelagh", "speak with animals"],
			firstCol : "oncelr",
			times : 8,
			spellcastingAbility : "class"
		}
	},
	"mac-fuirmidh cittern (uncommon)" : {
		name : "Mac-Fuirmidh Cittern [Instrument of the Bards]",
		sortname : "Instrument of the Bards, Mac-Fuirmidh Cittern",
		rarity : "uncommon",
		magicItemTable : "F",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Mac-Fuirmidh cittern can be used to cast Barkskin, Cure Wounds, and Fog Cloud.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "barkskin", "cure wounds", "fog cloud"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "barkskin", "cure wounds", "fog cloud"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		}
	},
	"ollamh harp (legendary)" : {
		name : "Ollamh Harp [Instrument of the Bards]",
		sortname : "Instrument of the Bards, Ollamh Harp",
		rarity : "legendary",
		magicItemTable : "I",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Ollamh harp can be used to cast Confusion, Control Weather, and Fire Storm.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "confusion", "control weather", "fire storm"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "confusion", "control weather", "fire storm"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		},
		spellChanges : {
			"control weather" : {
				time : "1 a",
				changes : "Casting time is only an action."
			}
		}
	}
}
MagicItemsList["mariner's armor"] = {
	name : "Mariner's Armor",
	nameTest : "Mariner's",
	source : [["D", 188]],
	type : "armor (light, medium, or heavy)",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "While wearing this armor, I have a swimming speed equal to my walking speed. In addition, whenever I start my turn underwater with 0 hit points, the armor causes me to rise 60 ft toward the surface. The armor is decorated with fish and shell motifs.",
	descriptionFull : "While wearing this armor, you have a swimming speed equal to your walking speed. In addition, whenever you start your turn underwater with 0 hit points, the armor causes you to rise 60 feet toward the surface. The armor is decorated with fish and shell motifs.",
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		descriptionChange : ["prefix", "armor"]
	},
	speed : { swim : { spd : "walk", enc : "walk" } }
}
MagicItemsList["potion of fire breath"] = {
	name : "Potion of Fire Breath",
	source : [["D", 187]],
	type : "potion",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "Once as an action, I can drink this potion or administer it to another to, for 1 hour, use a bonus action to do 4d6 fire damage at a target within 30 ft, Dex save DC 13 halves. This can be done 3 times. This potion's orange liquid flickers, and smoke fills the top of the container and wafts out whenever it is opened.",
	descriptionFull : "After drinking this potion, you can use a bonus action to exhale fire at a target within 30 feet of you. The target must make a DC 13 Dexterity saving throw, taking 4d6 fire damage on a failed save, or half as much damage on a successful one. The effect ends after you exhale the fire three times or when 1 hour has passed. This potion's orange liquid flickers, and smoke fills the top of the container and wafts out whenever it is opened.",
	weight : 0.5
}
MagicItemsList["potion of invulnerability"] = {
	name : "Potion of Invulnerability",
	source : [["D", 188]],
	type : "potion",
	rarity : "rare",
	magicItemTable : "C",
	description : "Once as an action, I can drink this potion or administer it to another to have resistance to all damage for 1 minute. The potion's syrupy liquid looks like liquefied iron.",
	descriptionFull : "For 1 minute after you drink this potion, you have resistance to all damage. The potion's syrupy liquid looks like liquefied iron.",
	weight : 0.5
}
MagicItemsList["potion of longevity"] = {
	name : "Potion of Longevity",
	source : [["D", 188]],
	type : "potion",
	rarity : "very rare",
	magicItemTable : "D",
	description : "Once as an action, I can drink this potion or administer it to another to reduce the consumer's physical age is by 1d6+6 years, to a minimum of 13 years. Subsequent consumptions of this type of potion have a 10% cumulative chance to instead age the consumer by 1d6+6 years.",
	descriptionLong : "Once as an action, I can drink this potion or administer it to another to reduce the consumer's physical age is by 1d6+6 years, to a minimum of 13 years. Subsequent consumptions of this type of potion have a 10% cumulative chance to instead age the consumer by 1d6+6 years. Suspended in this amber liquid are a scorpion's tail, an adder's fang, a dead spider, and a tiny heart that, against all reason, is still beating. These ingredients vanish when the potion is opened.",
	descriptionFull : "When you drink this potion, your physical age is reduced by 1d6+6 years, to a minimum of 13 years. Each time you subsequently drink a potion of longevity, there is 10 percent cumulative chance that you instead age by 1d6+6 years. Suspended in this amber liquid are a scorpion's tail, an adder's fang, a dead spider, and a tiny heart that, against all reason, is still beating. These ingredients vanish when the potion is opened.",
	weight : 0.5
}
MagicItemsList["potion of vitality"] = {
	name : "Potion of Vitality",
	source : [["D", 188]],
	type : "potion",
	rarity : "very rare",
	magicItemTable : "D",
	description : "Once as an action, I can drink this potion or administer it to another to remove any exhaustion, disease, and poison affecting the consumer. For the next 24 hours, the consumer regains the maximum number of HP for any HD used. The potion's crimson liquid regularly pulses with dull light, calling to mind a heartbeat.",
	descriptionFull : "When you drink this potion, it removes any exhaustion you are suffering and cures any disease or poison affecting you. For the next 24 hours, you regain the maximum number of hit points for any Hit Die you spend. The potion's crimson liquid regularly pulses with dull light, calling to mind a heartbeat.",
	weight : 0.5
}
MagicItemsList["rod of resurrection"] = {
	name : "Rod of Resurrection",
	source : [["D", 197]],
	type : "rod",
	rarity : "legendary",
	magicItemTable : "I",
	description : "This rod has 5 charges and regains 1 expended charge daily at dawn. While I hold it, I can use an action to expend 1 charge and cast Heal from it, or expend 5 charges and cast Resurrection from it. If the rod is reduced to 0 charges, roll a d20. On a 1, the rod disappears in a burst of radiance.",
	descriptionFull : "The rod has 5 charges. While you hold it, you can use an action to cast one of the following spells from it: Heal (expends 1 charge) or Resurrection (expends 5 charges).\n   The rod regains 1 expended charge daily at dawn. If the rod is reduced to 0 charges, roll a d20. On a 1, the rod disappears in a burst of radiance.",
	attunement : true,
	weight : 2,
	prerequisite : "Requires attunement by a cleric, druid, or paladin",
	prereqeval : function(v) { return classes.known.cleric || classes.known.druid || classes.known.paladin ? true : false; },
	usages : 5,
	recovery : "dawn",
	additional : "regains 1",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["heal"],
		selection : ["heal"],
		firstCol : 1
	}, {
		name : "5 charges",
		spells : ["resurrection"],
		selection : ["resurrection"],
		firstCol : 5
	}],
	spellChanges : {
		"resurrection" : {
			time : "1 a",
			changes : "Casting time is only 1 action instead of 1 hour."
		}
	}
}
MagicItemsList["rod of the pact keeper, +1, +2, or +3"] = {
	name : "Rod of the Pact Keeper, +1, +2, or +3",
	source : [["D", 197]],
	type : "rod",
	description : "While holding this rod, I gain a bonus to spell attack rolls and to the saving throw DCs of my warlock spells, determined by the rod's rarity: uncommon (+1), rare (+2), or very rare (+3). As an action once per long rest, I can regain one warlock spell slot while holding the rod.",
	descriptionFull : "While holding this rod, you gain a bonus to spell attack rolls and to the saving throw DCs of your warlock spells. The bonus is determined by the rod's rarity: uncommon (+1), rare (+2), or very rare (+3).\n   In addition, you can regain one warlock spell slot as an action while holding the rod. You can't use this property again until you finish a long rest.",
	attunement : true,
	weight : 2,
	prerequisite : "Requires attunement by a warlock",
	prereqeval : function(v) { return classes.known.warlock; },
	usages : 1,
	recovery : "long rest",
	limfeaname : "Rod of the Pact Keeper (warlock spell slot)",
	action : [["action", ""]],
	allowDuplicates : true,
	choices : ["+1 Rod (uncommon)", "+2 Rod (rare)", "+3 Rod (very rare)"],
	"+1 rod (uncommon)" : {
		name : "Rod of the Pact Keeper +1",
		rarity : "uncommon",
		magicItemTable : "F",
		description : "While holding this rod, I gain a +1 bonus to spell attack rolls and to the saving throw DCs of my warlock spells. As an action once per long rest, I can regain one warlock spell slot while holding the rod.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('warlock') !== -1) return 1;
				},
				"While holding the Rod of the Pact Keeper, I gain a +1 bonus to spell attack rolls and to the saving throw DCs of my warlock spells."
			]
		}
	},
	"+2 rod (rare)" : {
		name : "Rod of the Pact Keeper +2",
		rarity : "rare",
		magicItemTable : "G",
		description : "While holding this rod, I gain a +2 bonus to spell attack rolls and to the saving throw DCs of my warlock spells. As an action once per long rest, I can regain one warlock spell slot while holding the rod.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('warlock') !== -1) return 2;
				},
				"While holding the Rod of the Pact Keeper, I gain a +2 bonus to spell attack rolls and to the saving throw DCs of my warlock spells."
			]
		}
	},
	"+3 rod (very rare)" : {
		name : "Rod of the Pact Keeper +3",
		rarity : "very rare",
		magicItemTable : "H",
		description : "While holding this rod, I gain a +3 bonus to spell attack rolls and to the saving throw DCs of my warlock spells. As an action once per long rest, I can regain one warlock spell slot while holding the rod.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('warlock') !== -1) return 3;
				},
				"While holding the Rod of the Pact Keeper, I gain a +3 bonus to spell attack rolls and to the saving throw DCs of my warlock spells."
			]
		}
	}
}
MagicItemsList["saddle of the cavalier"] = {
	name : "Saddle of the Cavalier",
	source : [["D", 199]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "While in this saddle on a mount, I can't be dismounted against my will if I am conscious, and attack rolls against the mount have disadvantage.",
	descriptionFull : "While in this saddle on a mount, you can't be dismounted against your will if you're conscious, and attack rolls against the mount have disadvantage.",
	weight : 25
}
MagicItemsList["scroll of protection"] = {
	name : "Scroll of Protection",
	source : [["D", 199]],
	type : "scroll",
	rarity : "rare",
	magicItemTable : "C",
	description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 min that moves with me and stops a creature type from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected.",
	descriptionFull : "Each scroll of protection works against a specific type of creature chosen by the DM or determined randomly by rolling on the following table.\n\n" + [
		toUni("d100\tCreature Type\td100\tCreature Type"),
		"01-10\tAberrations\t41-50\tFey",
		"11-20\tBeasts\t\t51-75\tFiends",
		"21-30\tCelestials   \t76-80\tPlants",
		"31-40\tElementals\t81-00\tUndead",
	].join("\n") + "\nUsing an action to read the scroll encloses you in an invisible barrier that extends from you to form a 5-foot-radius, 10-foot-high cylinder. For 5 minutes, this barrier prevents creatures of the specified type from entering or affecting anything within the cylinder.\n   The cylinder moves with you and remains centered on you. However, if you move in such a way that an aberration would be inside the cylinder, the effect ends.\n   A creature can attempt to overcome the barrier by using an action to make a DC 15 Charisma check. On a success, the creature ceases to be affected by the barrier.",
	choices : ["Aberrations", "Beasts", "Celestials", "Elementals", "Fey", "Fiends", "Plants", "Undead"],
	"aberrations" : {
		name : "Scroll of Protection from Aberrations",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 min that moves with me and stops aberrations from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected. If I move so the barrier includes an aberration, it ends."
	},
	"beasts" : {
		name : "Scroll of Protection from Beasts",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops beasts from entering or affecting anything within. As an action, a creature can make a DC 15 Charisma check to stop being affected. If I move so the barrier includes a beast, it ends."
	},
	"celestials" : {
		name : "Scroll of Protection from Celestials",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 min that moves with me and stops celestials from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected. If I move so the barrier includes a celestial, it ends."
	},
	"elementals" : {
		name : "Scroll of Protection from Elementals",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 min that moves with me and stops elementals from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected. If I move so the barrier includes an elemental, it ends."
	},
	"fey" : {
		name : "Scroll of Protection from Fey",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops fey from entering or affecting anything within. As an action, a creature can make a DC 15 Charisma check to stop being affected. If I move so the barrier includes a fey, it ends."
	},
	"fiends" : {
		name : "Scroll of Protection from Fiends",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops fiends from entering or affecting anything within. As an action, a creature can make a DC 15 Charisma check to stop being affected. If I move so the barrier includes a fiend, it ends."
	},
	"plants" : {
		name : "Scroll of Protection from Plants",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops plants from entering or affecting anything within. As an action, a creature can make a DC 15 Charisma check to stop being affected. If I move so the barrier includes a plant, it ends."
	},
	"undead" : {
		name : "Scroll of Protection from Undead",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops undead from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected. If I move so the barrier includes a undead, it ends."
	}
}
MagicItemsList["sending stones"] = {
	name : "Sending Stones",
	source : [["D", 199]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "While I touch one of this pair of stones, I can use an action to cast Sending, targeting the bearer of the other stone. If no creature has the other stone, the spell won't cast. Once it is cast, neither stone can be used again until the next dawn. Sending allows each bearer to communicate up to 25 words.",
	descriptionFull : "Sending stones come in pairs, with each smooth stone carved to match the other so the pairing is easily recognized. While you touch one stone, you can use an action to cast the Sending spell from it. The target is the bearer of the other stone. If no creature bears the other stone, you know that fact as soon as you use the stone and don't cast the spell.\n   Once Sending is cast through the stones, they can't be used again until the next dawn. If one of the stones in a pair is destroyed, the other one becomes nonmagical.",
	spellcastingBonus : {
		name : "To other stone bearer only",
		spells : ["sending"],
		selection : ["sending"],
		firstCol : "oncelr"
	},
	usages : 1, 
	recovery : "dawn",
	spellChanges : {
		"sending" : {
			description : "Send a 25 word message to the bearer of the other Sending Stone, who can respond with 25 words",
			changes : "Using one stone of a pair of Sending Stones, the spell can only target the bearer of the other stone of the pair."
		}
	}
}
MagicItemsList["sentinel shield"] = {
	name : "Sentinel Shield",
	source : [["D", 199]],
	type : "shield",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "While holding this shield, I have advantage on initiative rolls and Wisdom (Perception) checks. The shield is emblazoned with a symbol of an eye.",
	descriptionFull : "While holding this shield, you have advantage on initiative rolls and Wisdom (Perception) checks. The shield is emblazoned with a symbol of an eye.",
	weight : 6,
	shieldAdd : "Sentinel Shield",
	advantages : [["Initiative", true], ["Perception", true]],
	vision : [["Adv. on Perception checks", 0]]
}
MagicItemsList["staff of the adder"] = {
	name : "Staff of the Adder",
	source : [["D", 203]],
	type : "staff",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "As a bonus action, I can speak this staff's command word to animate its snake head for 1 minute or make it inanimate again. While animated, I can use it in melee (1d6 piercing + DC 15 Con save or 3d6 poison), but it can be attacked and has AC 15 and 20 HP (full every time). If it reaches 0 HP, the staff is destroyed.",
	descriptionFull : "You can use a bonus action to speak this staff's command word and make the head of the staff become that of an animate poisonous snake for 1 minute. By using another bonus action to speak the command word again, you return the staff to its normal inanimate form.\n   You can make a melee attack using the snake head, which has a reach of 5 feet. Your proficiency bonus applies to the attack roll. On a hit, the target takes 1d6 piercing damage and must succeed on a DC 15 Constitution saving throw or take 3d6 poison damage.\n   The snake head can be attacked while it is animate. It has an Armor Class of 15 and 20 hit points. If the head drops to 0 hit points, the staff is destroyed. As long as it's not destroyed, the staff regains all lost hit points when it reverts to its inanimate form.",
	attunement : true,
	weight : 4,
	prerequisite : "Requires attunement by a cleric, druid, or warlock",
	prereqeval : function(v) { return classes.known.cleric || classes.known.druid || classes.known.warlock ? true : false; },
	action : [["bonus action", " (animate/end)"]],
	weaponOptions : [{
		regExpSearch : /^(?=.*snake)(?=.*head)(?=.*staff)(?=.*adder).*$/i,
		name : "Animated Snake Head from Staff of the Adder",
		source : [["D", 203]],
		list : "melee",
		ability : 1,
		type : "Natural",
		damage : [1, 6, "piercing"],
		range : "Melee",
		weight : 4,
		description : "DC 15 Constitution save or 3d6 poison damage",
		abilitytodamage : false,
		selectNow : true
	}]
}
MagicItemsList["sword of answering"] = {
	name : "Sword of Answering",
	source : [["D", 206]],
	type : "weapon (longsword)",
	rarity : "legendary",
	magicItemTable : "I",
	description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a gem set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target.",
	descriptionFull : 'In the world of Greyhawk, only nine of these blades are known to exist. Each is patterned after the legendary sword Fragarach, which is variously translated as "Final Word." Each of the nine swords has its own name and alignment, and each bears a different gem in its pommel.\n   You gain a +3 bonus to attack and damage rolls made with this sword. In addition, while you hold the sword, you can use your reaction to make one melee attack with it against any creature in your reach that deals damage to you. You have advantage on the attack roll, and any damage dealt with this special attack ignores any damage immunity or resistance the target has.\n\n' + [
		toUni("Name\t\tAlignment\tGem"),
		"Answerer    \tChaotic good\tEmerald",
		"Back Talker\tChaotic evil\tJet",
		"Concluder    \tLawful neutral\tAmethyst",
		"Last Quip    \tChaotic neutral\tTourmaline",
		"Rebutter\t\tNeutral good\tTopaz",
		"Replier\t\tNeutral\t\tPeridot",
		"Retorter\t\tLawful good\tAquamarine",
		"Scather\t\tLawful evil\tGarnet",
		"Squelcher    \tNeutral evil\tSpinel"
	].join("\n"),
	attunement : true,
	weight : 3,
	action : [["reaction", ""]],
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /^(?=.*sword)(?=.*answering).*$/i,
		name : "Sword of Answering",
		source : [["D", 206]],
		modifiers : [3, 3],
		selectNow : true
	}],
	choices : ["Answerer (chaotic good)", "Back Talker (chaotic evil)", "Concluder (lawful neutral)", "Last Quip (chaotic neutral)", "Rebutter (neutral good)", "Replier (neutral)", "Retorter (lawful good)", "Scather (lawful evil)", "Squelcher (neutral evil)"],
	"answerer (chaotic good)" : {
		name : "Sword of Answering [Answerer]",
		prerequisite : "Requires attunement by a creature with the chaotic good alignment",
		prereqeval : function(v) { return (/^(?=.*chaotic)(?=.*good).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has an emerald set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"back talker (chaotic evil)" : {
		name : "Sword of Answering [Back Talker]",
		prerequisite : "Requires attunement by a creature with the chaotic evil alignment",
		prereqeval : function(v) { return (/^(?=.*chaotic)(?=.*evil).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has jet set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"concluder (lawful neutral)" : {
		name : "Sword of Answering [Concluder]",
		prerequisite : "Requires attunement by a creature with the lawful neutral alignment",
		prereqeval : function(v) { return (/^(?=.*lawful)(?=.*neutral).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has an amethyst set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"last quip (chaotic neutral)" : {
		name : "Sword of Answering [Last Quip]",
		prerequisite : "Requires attunement by a creature with the chaotic neutral alignment",
		prereqeval : function(v) { return (/^(?=.*chaotic)(?=.*neutral).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a tourmaline set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"rebutter (neutral good)" : {
		name : "Sword of Answering [Rebutter]",
		prerequisite : "Requires attunement by a creature with the neutral good alignment",
		prereqeval : function(v) { return (/^(?=.*neutral)(?=.*good).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a topaz set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"replier (neutral)" : {
		name : "Sword of Answering [Replier]",
		prerequisite : "Requires attunement by a creature with the neutral alignment",
		prereqeval : function(v) { return (/^(?=.*neutral)(?!.*(chaotic|lawful|evil|good)).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a peridot set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"retorter (lawful good)" : {
		name : "Sword of Answering [Retorter]",
		prerequisite : "Requires attunement by a creature with the lawful good alignment",
		prereqeval : function(v) { return (/^(?=.*lawful)(?=.*good).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has an aquamarine set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"scather (lawful evil)" : {
		name : "Sword of Answering [Scather]",
		prerequisite : "Requires attunement by a creature with the lawful evil alignment",
		prereqeval : function(v) { return (/^(?=.*lawful)(?=.*evil).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a garnet set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"squelcher (neutral evil)" : {
		name : "Sword of Answering [Squelcher]",
		prerequisite : "Requires attunement by a creature with the neutral evil alignment",
		prereqeval : function(v) { return (/^(?=.*neutral)(?=.*evil).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a spinel set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	}
}
MagicItemsList["sword of vengeance"] = {
	name : "Sword of Vengeance",
	nameTest : "of Vengeance",
	source : [["D", 206]],
	type : "weapon (any sword)",
	rarity : "uncommon",
	magicItemTable : "F",
	attunement : true,
	description : "This sword gives +1 to hit and damage and is cursed. I can't part with this sword and have disadv. on attacks with other weapons. If I take damage in combat, I must make a DC 15 Wis save or I will attack the attacker until it drops to 0 HP or I can't attack it in melee anymore.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic weapon.\n   " + toUni("Curse") + ". This sword is cursed and possessed by a vengeful spirit. Becoming attuned to it extends the curse to you. As long as you remain cursed, you are unwilling to part with the sword, keeping it on your person at all times. While attuned to this weapon, you have disadvantage on attack rolls made with weapons other than this one.\n   In addition, while the sword is on your person, you must succeed on a DC 15 Wisdom saving throw whenever you take damage in combat. On a failed save you must attack the creature that damaged you until you drop to 0 hit points or it does, or until you can't reach the creature to make a melee attack against it.\n   You can break the curse in the usual ways. Alternatively, casting banishment on the sword forces the vengeful spirit to leave it. The sword then becomes a +1 weapon with no other properties.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/of vengeance/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Cursed';
				}
			},
			'If I include the words "of Vengeance" in the name of a sword, it will be treated as the magic weapon Sword of Vengeance. It has +1 to hit and damage, but also bears a curse.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/of vengeance/i).test(v.WeaponTextName)) {
					output.magic = v.thisWeapon[1] + 1;
				}
			}, ''
		]
	}
}
MagicItemsList["tentacle rod"] = {
	name : "Tentacle Rod",
	source : [["D", 208]],
	type : "rod",
	rarity : "rare",
	magicItemTable : "G",
	description : "As an action, all 3 tentacles of this rod attack with 15 ft reach, +9 to hit, dealing 1d6 bludgeoning damage. If a target is hit by all 3 it must make a DC 15 Con save or have half speed, disadv. on Dex saves, no reactions, and do action or bonus action, not both, for 1 min. It can repeat the save at the end of each of its turns.",
	descriptionLong : "As an action while holding the rod, I can direct each of its three tentacles to attack a creature I can see within 15 ft. Each tentacle makes a melee attack roll, +9 to hit, dealing 1d6 bludgeoning damage. If a target is hit by all three tentacles, it must make a DC 15 Constitution saving throw. On a failure, the creature's speed is halved, it has disadvantage on Dexterity saving throws, and it can't use reactions for 1 minute. Moreover, on each of its turns, it can take either an action or a bonus action, but not both. At the end of each of its turns, it can repeat the saving throw, ending the effect on itself on a success.",
	descriptionFull : "Made by the drow, this rod is a magic weapon that ends in three rubbery tentacles. While holding the rod, you can use an action to direct each tentacle to attack a creature you can see within 15 feet of you. Each tentacle makes a melee attack roll with a +9 bonus. On a hit, the tentacle deals 1d6 bludgeoning damage. If you hit a target with all three tentacles, it must make a DC 15 Constitution saving throw. On a failure, the creature's speed is halved, it has disadvantage on Dexterity saving throws, and it can't use reactions for 1 minute. Moreover, on each of its turns, it can take either an action or a bonus action, but not both. At the end of each of its turns, it can repeat the saving throw, ending the effect on itself on a success.",
	attunement : true,
	weight : 2,
	action : [["action", ""]],
	weaponOptions : [{
		regExpSearch : /^(?=.*tentacle)(?=.*rod).*$/i,
		name : "Tentacle Rod",
		source : [["D", 208]],
		ability : 0,
		type : "Magic Item",
		damage : [1, 6, "bludgeoning"],
		range : "Melee (15 ft)",
		description : "Action to use, 3 attacks; If all 3 hit same target, it DC 15 Con save, see magic item",
		abilitytodamage : false,
		modifiers : [9, ""],
		weight : 2,
		selectNow : true
	}]
}
MagicItemsList["tome of the stilled tongue"] = {
	name : "Tome of the Stilled Tongue",
	source : [["D", 208]],
	type : "wondrous item",
	rarity : "legendary",
	magicItemTable : "I",
	description : "I can use this thick leather-bound tome as a spellbook and an arcane focus. Once per dawn while holding it, I can use a bonus action to cast a spell I have written in it, without expending a spell slot or using any verbal or somatic components. Removing the tongue on the cover erases all spells within.",
	descriptionLong : "The first few pages of this thick leather-bound tome are filled with indecipherable scrawls. The remaining pages are blank and pristine. I can use it as a spellbook and an arcane focus. Once per dawn while holding it, I can use a bonus action to cast a spell I have written in the tome, without expending a spell slot or using any verbal or somatic components. While attuned to the book, I can remove the tongue from the book's cover, permanently erasing all spells within. Vecna watches the user or this tome and sometimes has cryptic messages appear in it at midnight and fade away after they are read.",
	descriptionFull : "This thick leather-bound volume has a desiccated tongue pinned to the front cover. Five of these tomes exist, and it's unknown which one is the original. The grisly cover decoration on the first tome of the stilled tongue once belonged to a treacherous former servant of the lich-god Vecna, keeper of secrets. The tongues pinned to the covers of the four copies came from other spellcasters who crossed Vecna. The first few pages of each tome are filled with indecipherable scrawls. The remaining pages are blank and pristine.\n   If you can attune to this item, you can use it as a spellbook and an arcane focus. In addition, while holding the tome, you can use a bonus action to cast a spell you have written in this tome, without expending a spell slot or using any verbal or somatic components. Once used, this property of the tome can't be used again until the next dawn.\n   While attuned to the book, you can remove the tongue from the book's cover. If you do so, all spells written in the book are permanently erased.\n   Vecna watches anyone using this tome. He can also write cryptic messages in the book. These messages appear at midnight and fade away after they are read.",
	attunement : true,
	weight : 5,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	action : [["bonus action", ""]],
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["weapon of warning"] = {
	name : "Weapon of Warning",
	nameTest : "of Warning",
	source : [["D", 213]],
	type : "weapon (any)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "While this magic weapon is on my person, I have advantage on initiative rolls. In addition, both me and my allies within 30 ft of me can't be surprised and the weapon magically awakens us when combat starts, except those incapacitated by something other than nonmagical sleep.",
	descriptionFull : "This magic weapon warns you of danger. While the weapon is on your person, you have advantage on initiative rolls. In addition, you and any of your companions within 30 feet of you can't be surprised, except when incapacitated by something other than nonmagical sleep. The weapon magically awakens you and your companions within range if any of you are sleeping naturally when combat begins.",
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "weapon"]
	},
	advantages : [["Initiative", true]],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && !v.isSpell && (/warning/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
				}
			},
			'If I include the word "Warning" in the name of a weapon, it will be treated as the magic weapon Weapon of Warning.'
		]
	},
	savetxt : { immune : ["surprised"] }
}

// Sentient Items
var DMG_blackrazorFullDescription = [
	"Hidden in the dungeon of White Plume Mountain, Blackrazor shines like a piece of night sky filled with stars. Its black scabbard is decorated with pieces of cut obsidian.",
	"You gain a +3 bonus to attack and damage rolls made with this magic weapon. It has the following additional properties.",
	">>Devour Soul<<. Whenever you use it to reduce a creature to 0 hit points, the sword slays the creature devours its soul, unless it is a construct or an undead. A creature whose soul has been devoured by Blackrazor can be restored to life only by a Wish spell.",
	"When it devours a soul, Blackrazor grants you temporary hit points equal to the slain creature's hit point maximum. These hit points fade after 24 hours. As long as these temporary hit points last and you keep Blackrazor in hand, you have advantage on attack rolls, saving throws, and ability checks.",
	"If you hit an undead with this weapon, you take 1d10 necrotic damage and the target regains 1d10 hit points. If this necrotic damage reduces you to 0 hit points, Blackrazor devours your soul.",
	">>Soul Hunter<<. While you hold the weapon, you are aware of the presence of Tiny or larger creatures within 60 feet of you that aren't constructs or undead. You also can't be charmed or frightened.",
	"Blackrazor can cast the Haste spell on you once per day. It decides when to cast the spell and maintains concentration on it so that you don't have to.",
	">>Sentience<<. Blackrazor is a sentient chaotic neutral weapon with an Intelligence of 17, a Wisdom of 10, and a Charisma of 19. It has hearing and darkvision out to a range of 120 feet.",
	"The weapon can speak, read, and understand Common, and can communicate with its wielder telepathically. Its voice is deep and echoing. While you are attuned to it, Blackrazor also understands every language you know.",
	">>Personality<<. Blackrazor speaks with an imperious tone, as though accustomed to being obeyed.",
	"The sword's purpose is to consume souls. It doesn't care whose souls it eats, including the wielder's. The sword believes that all matter and energy sprang from a void of negative energy and will one day return to it. Blackrazor is meant to hurry that process along.",
	"Despite its nihilism, Blackrazor feels a strange kinship to Wave and Whelm, two other weapons locked away under White Plume Mountain. It wants the three weapons to be united again and wielded together in combat, even though it violently disagrees with Whelm and finds Wave tedious.",
	"Blackrazor's hunger for souls must be regularly fed. If the sword goes three days or more without consuming a soul, a conflict between it and its wielder occurs at the next sunset."
];
MagicItemsList["blackrazor"] = {
	name : "Blackrazor",
	source : [["D", 216]],
	type : "weapon (greatsword)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This sentient greatsword adds +3 to hit and damage and makes me immune to being charmed or frightened. Once per day it can cast Haste on me as it sees fit. If I use it to bring a creature to 0 HP, it devours the creature's soul, granting me temporary HP equal to the creature's max HP for 24 hours. See Notes page.",
	descriptionFull : DMG_blackrazorFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	prerequisite : "Requires attunement by a creature of non-lawful alignment",
	prereqeval : function(v) { return !(/lawful/i).test(What("Alignment")); },
	action : [["bonus action", ""]],
	weight : 6,
	weaponOptions : [{
		baseWeapon : "greatsword",
		regExpSearch : /blackrazor/i,
		name : "Blackrazor",
		source : [["D", 216]],
		description : "Heavy, two-handed; Devours soul; Heals undead",
		modifiers : [3, 3],
		selectNow : true
	}],
	toNotesPage : [{
		name : "Features",
		note : desc(DMG_blackrazorFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(of|on|reduces|grants) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	savetxt : { immune : ["charmed", "frightened"] },
	usages : 1,
	recovery : "day",
	additional : "Haste",
	spellcastingBonus : [{
		name : "Once per day",
		spells : ["haste"],
		selection : ["haste"],
		firstCol : "oncelr"
	}],
	spellChanges : {
		"haste" : {
			range : "Self",
			duration : "1 min",
			description : "I get +2 AC, speed doubled, adv. on Dex saves, extra action (1 attack, dash, disengage, hide)",
			changes : "Blackrazor casts the spell on me, so I don't need to concentrate on it."
		}
	}
}
var DMG_waveFullDescription = [
	"Held in the dungeon of White Plume Mountain, this trident is an exquisite weapon engraved with images of waves, shells, and sea creatures. Although you must worship a god of the sea to attune to this weapon, Wave happily accepts new converts.",
	"You gain a +3 bonus to attack and damage rolls made with this magic weapon. If you score a critical hit with it, the target takes extra necrotic damage equal to half its hit point maximum.",
	"The weapon also functions as a trident of fish command and a weapon of warning. It can confer the benefit of a cap of water breathing while you hold it, and you can use it as a cube of force by choosing the effect, instead of pressing cube sides to select it.",
	">>Sentience<<. Wave is a sentient weapon of neutral alignment, with an Intelligence of 14, a Wisdom of 10, and a Charisma of 18. It has hearing and darkvision out to a range of 120 feet.",
	"The weapon communicates telepathically with its wielder and can speak, read, and understand Aquan. It can also speak with aquatic animals as if using a Speak with Animals spell, using telepathy to involve its wielder in the conversation.",
	">>Personality<<. When it grows restless, Wave has a habit of humming tunes that vary from sea chanteys to sacred hymns of the sea gods.",
	"Wave zealously desires to convert mortals to the worship of one or more sea gods, or else to consign the faithless to death. Conflict arises if the wielder fails to further the weapon's objectives in the world. The trident has a nostalgic attachment to the place where it was forged, a desolate island called Thunderforge. A sea god imprisoned a family of storm giants there, and the giants forged Wave in an act of devotion to\u2014or rebellion against\u2014that god.",
	"Wave harbors a secret doubt about its own nature and purpose. For all its devotion to the sea gods, Wave fears that it was intended to bring about a particular sea god's demise. This destiny is something Wave might not be able to avert."
];
if (MagicItemsList["trident of fish command"] && MagicItemsList["weapon of warning"] && MagicItemsList["cap of water breathing"] && MagicItemsList["cube of force"]) {
	MagicItemsList["wave"] = {
		name : "Wave",
		source : [["D", 218]],
		type : "weapon (trident)",
		rarity : "legendary",
		notLegalAL : true,
		description : "This sentient trident adds +3 to hit and damage and if I score a critical hit with it, the target takes extra necrotic damage equal to half its max HP. It also functions as a trident of fish command, a weapon of warning, cap of water breathing while I hold it, and I can use it as a cube of force. See Notes page.",
		descriptionFull : DMG_waveFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
		attunement : true,
		prerequisite : "Requires attunement by a creature that worships a god of the sea",
		prereqeval : function(v) { return (/deep sashelas|sekolah|ulutiu|umberlee|valkur|poseidon|neptune|aegir|nehalennia|njord/i).test(What("Faith/Deity")); },
		weight : 4,
		weaponOptions : [{
			baseWeapon : "trident",
			regExpSearch : /wave/i,
			name : "Wave",
			source : [["D", 218]],
			description : "Thrown, versatile (1d8); On crit: necrotic damage equal to half target max HP",
			modifiers : [3, 3],
			selectNow : true
		}],
		toNotesPage : [{
			name : "Features",
			note : desc(DMG_waveFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/you/ig, "I") + "\n\n" + sentientItemConflictTxt
		}, {
			name : "Contained Items",
			note : [
				"\n\n\u2022 Trident of Fish Command (SRD 247, DMG 209)\n   " + MagicItemsList["trident of fish command"].description,
				"\u2022 Weapon of Warning (DMG 213)\n   " + MagicItemsList["weapon of warning"].description,
				"\u2022 Cap of Water Breathing (DMG 157)\n   " + MagicItemsList["cap of water breathing"].description,
				"\u2022 Cube of Force (SRD 215, DMG 159)" + desc(MagicItemsList["cube of force"].toNotesPage[0].note)
			].join("\n\n")
		}],
		// cube of force & cap of water breathing
		action : [["action", " (Cap of Water Breathing)"], ["action", " (Cube of Force)"]],
		extraLimitedFeatures : [{
			name : "Wave [Cube of Force] (regains 1d20)",
			usages : 36,
			recovery : "dawn"
		}, {
		// trident of fish command
			name : "Wave [Fish Command] (regains 1d3)",
			usages : 3,
			recovery : "dawn"
		}],
		fixedDC : 15,
		spellFirstColTitle : "Ch",
		spellcastingBonus : {
			name : "1 charge",
			spells : ["dominate beast"],
			selection : ["dominate beast"],
			firstCol : 1
		},
		spellChanges : {
			"dominate beast" : {
				description : "1 beast with swim speed save or charmed, follows telepathic commands, 1 a for complete control",
				changes : "Can only affect beasts with innate swim speed."
			}
		},
		// weapon of warning
		advantages : [["Initiative", true]]
	}
}
var DMG_whelmFullDescription = [
	"Whelm is a powerful warhammer forged by dwarves and lost in the dungeon of White Plume Mountain.",
	"You gain a +3 bonus to attack and damage rolls made with this magic weapon. At dawn the day after you first make an attack roll with Whelm, you develop a fear of being outdoors that persists as long as you remain attuned to the weapon. This causes you to have disadvantage on attack rolls, saving throws, and ability checks while you can see the daytime sky.",
	">>Thrown Weapon<<. Whelm has the thrown property, with a normal range of 20 feet and a long range of 60 feet. When you hit with a ranged weapon attack using it, the target takes an extra 1d8 bludgeoning damage, or an extra 2d8 bludgeoning damage if the target is a giant. Each time you throw the weapon, it flies back to your hand after the attack. If you don't have a hand free, the weapon lands at your feet.",
	">>Shock Wave<<. You can use an action to strike the ground with Whelm and send a shock wave out from the point of impact. Each creature of your choice on the ground within 60 feet of that point must succeed on a DC 15 Constitution saving throw or become stunned for 1 minute. A creature can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success. Once used, this property can't be used again until the next dawn.",
	">>Supernatural Awareness<<. While you are holding the weapon, it alerts you to the location of any secret or concealed doors within 30 feet of you. In addition, you can use an action to cast Detect Evil and Good or Locate Object from the weapon. Once you cast either spell, you can't cast it from the weapon again until the next dawn.",
	">>Sentience<<. Whelm is a sentient lawful neutral weapon with an Intelligence of 15, a Wisdom of 12, and a Charisma of 15. It has hearing and darkvision out to a range of 120 feet.",
	"The weapon communicates telepathically with its wielder and can speak, read, and understand Dwarvish. Giant, and Goblin. It shouts battle cries in Dwarvish when used in combat.",
	">>Personality<<. Whelm's purpose is to slaughter giants and goblinoids. It also seeks to protect dwarves against all enemies. Conflict arises if the wielder fails to destroy goblins and giants or to protect dwarves. Whelm has ties to the dwarf clan that created it, variously called the Dankil or the Mightyhammer clan. It longs to be returned to that clan. It would do anything to protect those dwarves from harm. The hammer also carries a secret shame. Centuries ago, a dwarf named Ctenmiir wielded it valiantly for a time. But Ctenmiir was turned into a vampire. His will was strong enough that he bent Whelm to his evil purposes, even killing members of his own clan."
];
MagicItemsList["whelm"] = {
	name : "Whelm",
	source : [["D", 218]],
	type : "weapon (warhammer)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This sentient warhammer adds +3 to hit and damage, has the thrown property, deals extra damage when thrown, and returns to my hand when thrown. I can use it to create a shock wave. It makes me afraid of the outdoors, so while I can see the daytime sky, I have disadv. on attacks, saves, and checks. See Notes page.",
	descriptionFull : DMG_whelmFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	prerequisite : "Requires attunement by a dwarf",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dwarf') !== -1; },
	weight : 2,
	weaponOptions : [{
		baseWeapon : "warhammer",
		regExpSearch : /whelm/i,
		name : "Whelm",
		source : [["D", 218]],
		range : "Melee, 20/60 ft",
		description : "Versatile (1d10), thrown, returning; +1d8 damage when thrown (+2d8 vs. giants)",
		modifiers : [3, 3],
		selectNow : true
	}],
	toNotesPage : [{
		name : "Features",
		note : desc(DMG_whelmFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(of|on|causes|alerts) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	action : [["action", " (Shock Wave)"]],
	extraLimitedFeatures : [{
		name : "Whelm [Shock Wave]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Whelm [Detect Evil and Good]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Whelm [Locate Object]",
		usages : 1,
		recovery : "dawn"
	}],
	vision : [["Know location of secret doors", 30]],
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["detect evil and good", "locate object"],
		selection : ["detect evil and good", "locate object"],
		firstCol : "oncelr"
	}
}

// pub_20150407_PotA.js
// This file adds the magic items from the Princes of the Apocalypse adventure to MPMB's Character Record Sheet

// Define the source
SourceList["PotA"] = {
	name : "Princes of the Apocalypse [items]",
	abbreviation : "PotA",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/princes-apocalypse",
	date : "2015/04/07"
};

// Magic Items
MagicItemsList["balloon pack"] = {
	name : "Balloon Pack",
	source : [["PotA", 222]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "As an action, I can deploy the balloon to gain the effects of Levitate for 10 minutes. As a reaction, I can deploy the balloon to gain the effects of Feather Fall. After either effect ends, I descend slowly for 60 ft as it deflates. Once used in either way, the backpack is useless until recharged in an air node for 1 hour.",
	descriptionFull : "This backpack contains the spirit of an air elemental and a compact leather balloon. While you're wearing the backpack, you can deploy the balloon as an action and gain the effect of the Levitate spell for 10 minutes, targeting yourself and requiring no concentration. Alternatively, you can use a reaction to deploy the balloon when you're falling and gain the effect of the Feather Fall spell for yourself.\n   When either spell ends, the balloon slowly deflates as the elemental spirit escapes and returns to the Elemental Plane of Air. As the balloon deflates, you descend gently toward the ground for up to 60 feet. If you are still in the air at the end of this distance, you fall if you have no other means of staying aloft.\n   After the spirit departs, the backpack's property is unusable unless the backpack is recharged for 1 hour in an elemental air node, which binds another spirit to the backpack.",
	weight : 5, // as backpack
	usages : 1,
	recovery : "Air Node",
	additional : "recharge: 1 h in air node",
	action : [["action", " (Levitate)"], ["reaction", " (Feather Fall)"]],
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["feather fall", "levitate"],
		selection : ["feather fall", "levitate"],
		firstCol : 1,
		times : 2
	},
	spellChanges : {
		"feather fall" : {
			range : "Self",
			description : "I descent only 60 ft/rnd for duration or until landed, taking no falling damage",
			changes : "Using the Balloon Pack, I can only target myself."
		},
		"levitate" : {
			range : "Self",
			duration : "10 min",
			save : "",
			description : "I rise vertically, up to 20 ft; move up/down 20 ft instead of normal move",
			changes : "Using the Balloon Pack, I can only target myself, but the spell requires no concentration."
		}
	}
}
MagicItemsList["bottled breath"] = {
	name : "Bottled Breath",
	source : [["PotA", 222]],
	type : "potion",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "Once as an action, I can inhale this breath of elemental air or administer it to another. The target then either exhale it or hold it in. If exhaled immediately, it produces the effects of Gust of Wind. Holding it in removes the need to breathe for 1 hour, though this benefit can end early, by speaking for example.",
	descriptionFull : "This bottle contains a breath of elemental air. When you inhale it, you either exhale it or hold it.\n   If you exhale the breath, you gain the effect of the Gust of Wind spell. If you hold the breath, you don't need to breathe for 1 hour, though you can end this benefit early (for example, to speak). Ending it early doesn't give you the benefit of exhaling the breath.",
	weight : 0.5
}
MagicItemsList["claws of the umber hulk"] = {
	name : "Claws of the Umber Hulk",
	source : [["PotA", 222]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "F",
	description : "These brown iron gauntlets, shaped like umber hulk claws, cover my hands up to my elbows. While wearing both, I can tunnel 1 ft per round through solid rock and have a burrowing speed of 20 ft, but can't manipulate items or use somatic spell components. I can use them as melee weapons, dealing 1d8 slashing damage.",
	descriptionFull : "These heavy gauntlets of brown iron are forged in the shape of an umber hulk's claws, and they fit the wearer's hands and forearms all the way up to the elbow. While wearing both claws, you gain a burrowing speed of 20 feet, and you can tunnel through solid rock at a rate of 1 foot per round.\n   You can use a claw as a melee weapon while wearing it. You have proficiency with it, and it deals 1d8 slashing damage on a hit (your Strength modifier applies to the attack and damage rolls, as normal).\n   While wearing the claws, you can't manipulate objects or cast spells with somatic components.",
	weight : 1,
	attunement : true,
	speed : { burrow : { spd : "fixed20", enc : "fixed10" } },
	weaponOptions : [{
		regExpSearch : /^(?=.*claws)(?=.*umber)(?=.*hulk).*$/i,
		name : "Claws of the Umber Hulk",
		source : [["PotA", 222]],
		ability : 1,
		type : "Natural",
		damage : [1, 8, "slashing"],
		range : "Melee",
		description : "",
		abilitytodamage : true,
		selectNow : true
	}]
}
var PotA_tempDevastationOrbNoteTxt = [
	"A devastation orb is an elemental bomb that can be created at the site of an elemental node by performing a ritual with an elemental weapon. The type of orb created depends on the node used. For example, an air node creates a devastation orb of air. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed.\n   A devastation orb measures 12 inches in diameter, weighs 10 pounds, and has a solid outer shell. The orb detonates 1d100 hours after its creation, releasing the elemental energy it contains. The orb gives no outward sign of how much time remains before it will detonate. Spells such as Identify and Divination can be used to ascertain when the orb will explode. An orb has AC 10, 15 hit points, and immunity to poison and psychic damage. Reducing it to 0 hit points causes it to explode instantly.\n   A special container can be crafted to contain a devastation orb and prevent it from detonating. The container must be inscribed with symbols of the orb's opposing element. For example, a case inscribed with earth symbols can be used to contain a devastation orb of air and keep it from detonating. While in the container, the orb thrums. If it is removed from the container after the time when it was supposed to detonate, it explodes 1d6 rounds later, unless it is returned to the container.\n   Regardless of the type of orb, its effect is contained within a sphere with a 1 mile radius. The orb is the sphere's point of origin. The orb is destroyed after one use.",
	desc([
		"This elemental bomb can be created at the site of an elemental node of tELEMENT by performing a ritual with an elemental weapon. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed.",
		"A devastation orb measures 12 inches in diameter, weighs 10 pounds, and has a solid outer shell. The orb detonates 1d100 hours after its creation, releasing the elemental energy it contains. The orb gives no outward sign of how much time remains before it will detonate. Spells such as Identify and Divination can be used to ascertain when the orb will explode. An orb has AC 10, 15 hit points, and immunity to poison and psychic damage. Reducing it to 0 hit points causes it to explode instantly.",
		"A special container inscribed with symbols of oELEMENT can be crafted to contain a devastation orb of tELEMENT and prevent it from detonating. While in the container, the orb thrums. If it is removed from the container after the time when it was supposed to detonate, it explodes 1d6 rounds later, unless it is returned to the container."
	])
];
MagicItemsList["devastation orb"] = {
	name : "Devastation Orb",
	source : [["PotA", 222]],
	type : "wondrous item",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates an effect in a 1-mile radius around it.",
	descriptionFull : PotA_tempDevastationOrbNoteTxt[0],
	weight : 10,
	allowDuplicates : true,
	choices : ["Air", "Earth", "Fire", "Water"],
	choicesNotInMenu : true,
	"air" : {
		name : "Devastation Orb of Air",
		description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates a powerful windstorm in 1 mile around it for 1 hour. Everything exposed to the wind is damage by it. See Notes page.",
		descriptionFull : PotA_tempDevastationOrbNoteTxt[0] + "\n   " + toUni("Air Orb") + ". When this orb detonates, it creates a powerful windstorm that lasts for 1 hour. Whenever a creature ends its turn exposed to the wind, the creature must succeed on a DC 18 Constitution saving throw or take 1d4 bludgeoning damage, as the wind and debris batter it. The wind is strong enough to uproot weak trees and destroy light structures after at least 10 minutes of exposure. Otherwise, the rules for strong wind apply, as detailed in chapter 5 of the Dungeon Master's Guide.",
		toNotesPage : [{
			name : "Features",
			note : PotA_tempDevastationOrbNoteTxt[1].replace(/tELEMENT/g, "air").replace(/oElement/g, "earth") + "\n  When this orb detonates, it creates a powerful windstorm within a sphere with a 1 mile radius that lasts for 1 hour. Whenever a creature ends its turn exposed to the wind, the creature must succeed on a DC 18 Constitution saving throw or take 1d4 bludgeoning damage, as the wind and debris batter it. The wind is strong enough to uproot weak trees and destroy light structures after at least 10 minutes of exposure. Otherwise, the rules for strong wind apply. A strong wind imposes disadvantage on ranged weapon attack rolls and Wisdom (Perception) checks that rely on hearing. A strong wind also extinguishes open flames, disperses fog, and makes flying by nonmagical means nearly impossible. A flying creature in a strong wind must land at the end of its turn or fall. A strong wind in a desert can create a sandstorm that imposes disadvantage on Wisdom (Perception) checks that rely on sight."
		}]
	},
	"earth" : {
		name : "Devastation Orb of Earth",
		description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates the effect of an Earthquake spell in 1 mile around it for 1 minute. See Notes page.",
		descriptionFull : PotA_tempDevastationOrbNoteTxt[0] + "\n   " + toUni("Earth Orb") + ". When this orb detonates, it subjects the area to the effects of the Earthquake spell for 1 minute (spell save DC 18). For the purpose of the spell's effects, the spell is cast on the turn that the orb explodes.",
		toNotesPage : [{
			name : "Features",
			note : PotA_tempDevastationOrbNoteTxt[1].replace(/tELEMENT/g, "earth").replace(/oElement/g, "air") + desc([
				"When this orb detonates, it subjects the area to the effects of the Earthquake spell for 1 minute (spell save DC 18). For the purpose of the spell's effects, the spell is cast on the turn that the orb explodes.",
				"The Earthquake spell creates a seismic disturbance that shakes creatures and structures in contact with the ground in that area. The ground in the area becomes difficult terrain. Each creature on the ground that is concentrating must make a Constitution saving throw. On a failed save, the creature's concentration is broken.",
				"At the end of each turn this goes on, each creature on the ground in the area must make a Dexterity saving throw. On a failed save, the creature is knocked prone.",
				"This spell can have additional effects depending on the terrain in the area, as determined by the DM.",
				"\u2022 Fissures. Fissures open throughout the spell's area at the start of the turn after the orb detonates. A total of 1d6 such fissures open in locations chosen by the DM. Each is 1d10 \xD7 10 ft deep, 10 ft wide, and extends from one edge of the area to the opposite side. A creature standing on a spot where a fissure opens must succeed on a Dexterity saving throw or fall in. A creature that successfully saves moves with the fissure's edge as it opens. A fissure that opens beneath a structure causes it to automatically collapse (see below).",
				"\u2022 Structures. The tremor deals 50 bludgeoning damage to any structure in contact with the ground in the area when the orb detonates and at the start of each of turns for the duration. If a structure drops to 0 hit points, it collapses and potentially damages nearby creatures. A creature within half the distance of a structure's height must make a Dexterity saving throw. On a failed save, the creature takes 5d6 bludgeoning damage, is knocked prone, and is buried in the rubble, requiring a DC 20 Strength (Athletics) check as an action to escape. The DM can adjust the DC higher or lower, depending on the nature of the rubble. On a successful save, the creature takes half as much damage and doesn't fall prone or become buried."
			])
		}]
	},
	"fire" : {
		name : "Devastation Orb of Fire",
		description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates a dry heat wave in 1 mile around it for 24 hours. There is extreme heat within the area and wildfires can appear within, see Notes.",
		descriptionFull : PotA_tempDevastationOrbNoteTxt[0] + "\n   " + toUni("Fire Orb") + ". When this orb detonates, it creates a dry heat wave that lasts for 24 hours. Within the area of effect, the rules for extreme heat apply, as detailed in chapter 5 of the Dungeon Master's Guide. At the end of each hour, there is a ten percent chance that the heat wave starts a wildfire in a random location within the area of effect. The wildfire covers a 10-foot-square area initially but expands to fill another 10-foot square each round until the fire is extinguished or burns itself out. A creature that comes within 10 feet of a wildfire for the first time on a turn or starts its turn there takes 3d6 fire damage.",
		toNotesPage : [{
			name : "Features",
			note : PotA_tempDevastationOrbNoteTxt[1].replace(/tELEMENT/g, "fire").replace(/oElement/g, "water") + "\n  When this orb detonates, it creates a dry heat wave within a 1-mile radius sphere that lasts for 24 hours. At the end of each hour, there is a ten percent chance that the heat wave starts a wildfire in a random location within the area of effect. The wildfire covers a 10-foot-square area initially but expands to fill another 10-foot square each round until the fire is extinguished or burns itself out. A creature that comes within 10 feet of a wildfire for the first time on a turn or starts its turn there takes 3d6 fire damage.\n   Within the area of effect, the rules for extreme heat apply, as the temperature is above 100 \u00B0F. Any creature exposed to the heat and without access to drinkable water must succeed on a Constitution saving throw at the end of each hour or gain one level of exhaustion. The DC is 5 for the first hour and increases by 1 for each additional hour. Creatures wearing medium or heavy armor, or who are clad in heavy clothing, have disadvantage on the saving throw. Creatures with resistance or immunity to fire damage automatically succeed on the saving throw, as do creatures naturally adapted to hot climates."
		}]
	},
	"water" : {
		name : "Devastation Orb of Water",
		description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates torrential rainstorm in 1 mile around it for 24 hours. If bodies of water exist in the area, they rise 10 ft and flood. See Notes page.",
		descriptionFull : PotA_tempDevastationOrbNoteTxt[0] + "\n   " + toUni("Water Orb") + ". When this orb detonates, it creates a torrential rainstorm that lasts for 24 hours. Within the area of effect, the rules for heavy precipitation apply, as detailed in chapter 5 of the Dungeon Master's Guide. If there is a substantial body of water in the area, it floods after 2d10 hours of heavy rain, rising 10 feet above its banks and inundating the surrounding area. The flood advances at a rate of 100 feet per round, moving away from the body of water where it began until it reaches the edge of the area of effect: at that point, the water flows downhill (and possibly recedes back to its origin). Light structures collapse and wash away. Any Large or smaller creature caught in the flood's path is swept away. The flooding destroys crops and might trigger mudslides, depending on the terrain.",
		toNotesPage : [{
			name : "Features",
			note : PotA_tempDevastationOrbNoteTxt[1].replace(/tELEMENT/g, "water").replace(/oElement/g, "fire") + "\n  When this orb detonates, it creates a torrential rainstorm in a 1-mile radius sphere that lasts for 24 hours. If there is a substantial body of water in the area, it floods after 2d10 hours of heavy rain, rising 10 feet above its banks and inundating the surrounding area. The flood advances at a rate of 100 feet per round, moving away from the body of water where it began until it reaches the edge of the area of effect: at that point, the water flows downhill (and possibly recedes back to its origin). Light structures collapse and wash away. Any Large or smaller creature caught in the flood's path is swept away. The flooding destroys crops and might trigger mudslides, depending on the terrain.\n   Within the area of effect, the rules for heavy precipitation apply. Everything is lightly obscured, and creatures in the area have disadvantage on Wisdom (Perception) checks that rely on sight. Heavy rain also extinguishes open flames and imposes disadvantage on Wisdom (Perception) checks that rely on hearing."
		}]
	}
}
MagicItemsList["drown"] = {
	name : "Drown",
	source : [["PotA", 224]],
	type : "weapon (trident)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This trident has a +1 bonus on to hit and damage and deals +1d8 cold damage. It allows me to speak Aquan, grants me resistance to cold damage, and allows me to cast Dominate Monster on a water elemental once per dawn. It gives me a flaw, see Notes page.",
	descriptionFull : "A steel trident decorated with bronze barnacles along the upper part of its haft, Drown has a sea-green jewel just below the tines and a silver shell at the end of its haft. It floats on the surface if dropped onto water, and it floats in place if it is released underwater. The trident is always cool to the touch, and it is immune to any damage due to exposure to water. Drown contains a spark of Olhydra, the Princess of Evil Water.\n   You gain a +1 bonus to attack and damage rolls made with this magic weapon. When you hit with it, the targets take an extra 1d8 cold damage.\n   " + toUni("Water Mastery") + ". You gain the following benefits while you hold Drown:\n \u2022 You can speak Aquan fluently.\n \u2022 You have resistance to cold damage.\n \u2022 You can cast Dominate Monster (save DC 17) on a water elemental. Once you have done so, Drown can't be used this way again until the next dawn.\n\n" + toUni("Tears of Endless Anguish") + ". While inside a water node, you can perform a ritual called the Tears of Endless Anguish, using Drown to create a devastation orb of water. Once you perform the ritual, Drown can't be used to perform the ritual again until the next dawn.\n   " + toUni("Flaw") + ". Drown makes its wielder covetous. While attuned to the weapon, you gain the following flaw: \"I demand and deserve the largest share of the spoils, and I refuse to part with anything that's mine.\" In addition, if you are attuned to Drown for 24 consecutive hours, barnacles form on your skin. The barnacles can be removed with a Greater Restoration spell or similar magic, but not while you are attuned to the weapon.",
	attunement : true,
	weight : 4,
	languageProfs : ["Aquan"],
	dmgres : ["Cold"],
	usages : 1,
	recovery : "dawn",
	fixedDC : 17,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"dominate monster" : {
			description : "Water elemental save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect a water elemental."
		}
	},
	weaponOptions : [{
		baseWeapon : "trident",
		regExpSearch : /drown/i,
		name : "Drown",
		source : [["PotA", 224]],
		description : "Thrown, versatile (1d8); +1d8 cold damage",
		modifiers : [1, 1],
		selectNow : true
	}],
	toNotesPage : [{
		name : "Features",
		note : [
			"A steel trident decorated with bronze barnacles along the upper part of its haft, Drown has a sea-green jewel just below the tines and a silver shell at the end of its haft. It floats on the surface if dropped onto water, and it floats in place if it is released underwater. The trident is always cool to the touch, and it is immune to any damage due to exposure to water. Drown contains a spark of Olhydra, the Princess of Evil Water.",
			"I gain a +1 bonus to attack and damage rolls made with this magic weapon. When I hit with it, the targets take an extra 1d8 cold damage.",
			"While holding Drown, I can speak Aquan fluently, have resistance to cold damage, I can cast Dominate Monster (save DC 17) on a water elemental once per dawn.",
			"While inside a water node, I can perform a ritual called the Tears of Endless Anguish, using Drown to create a Devastation Orb of Water. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed. Once I perform the ritual, Drown can't be used to perform the ritual again until the next dawn.",
			"Drown makes me covetous. While attuned to the weapon, I gain the following flaw: \"I demand and deserve the largest share of the spoils, and I refuse to part with anything that's mine.\" In addition, if I am attuned to Drown for 24 consecutive hours, barnacles form on my skin. The barnacles can be removed with a Greater Restoration spell or similar magic, but not while I am attuned to the weapon."
		]
	}]
}
MagicItemsList["ironfang"] = {
	name : "Ironfang",
	source : [["PotA", 224]],
	type : "weapon (war pick)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This war pick has a +2 bonus on to hit and damage and deals +1d8 thunder damage. It allows me to speak Terran, grants me resistance to cold damage, tremorsense 60 ft, allows me to cast Dominate Monster on an earth elemental once per dawn, and to cast Shatter using 1 of its 3 charges and more, see Notes page.",
	descriptionFull : "A war pick forged from a single piece of iron, Ironfang has a fang-like head inscribed with ancient runes. The pick is heavy in the hand, but when the wielder swings the pick in anger, the weapon seems almost weightless. This weapon is immune to any form of rust, acid, or corrosion\u2014nothing seems to mark it. Ironfang contains a spark of Ogr\xE9moch, the Prince of Evil Earth.\n   You gain a +2 bonus to attack and damage rolls made with this magic weapon. When you hit with it, the target takes an extra 1d8 thunder damage.\n   " + toUni("Earth Mastery") + ". You gain the following benefits while you hold Ironfang:\n \u2022 You can speak Terran fluently.\n \u2022 You have resistance to acid damage.\n \u2022 You have tremorsense out to a range of 60 feet.\n \u2022 You can sense the presence of precious metals and stones within 60 feet of you, but not their exact location.\n \u2022 You can cast Dominate Monster (save DC 17) on an earth elemental. Once you have done so, Ironfang can't be used this way again until the next dawn.\n\n" + toUni("Shatter") + ". Ironfang has 3 charges. You can use your action to expend 1 charge and cast the 2nd-level version of Shatter (DC 17). Ironfang regains 1d3 expended charges daily at dawn.\n   " + toUni("The Rumbling") + ". While inside an earth node, you can perform a ritual called the Rumbling, using Ironfang to create a devastation orb of earth. Once you perform the ritual, Ironfang can't be used to perform the ritual again until the next dawn.\n   " + toUni("Flaw") + ". Ironfang heightens its wielder's destructive nature. While attuned to the weapon, you gain the following flaw: \"I like to break things and cause ruin.\"",
	attunement : true,
	weight : 2,
	languageProfs : ["Terran"],
	dmgres : ["Acid"],
	usages : 1,
	recovery : "dawn",
	fixedDC : 17,
	limfeaname : "Ironfang [Rumbling ritual]",
	spellFirstColTitle : "Ch",
	extraLimitedFeatures : [{
		name : "Ironfang [Dominate Monster]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Ironfang [Shatter] (regains 1d3)",
		usages : 3,
		recovery : "dawn",
	}],
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : "oncelr"
	}, {
		name : "1 charge",
		spells : ["shatter"],
		selection : ["shatter"],
		firstCol : 1
	}],
	spellChanges : {
		"dominate monster" : {
			description : "Earth elemental save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect an earth elemental."
		},
		"shatter" : {
			description : "10-ft rad all 4d8 Thunder dmg; save halves; nonmagical unattended objects also take dmg",
			changes : "Cast as if using a 2nd-level spell slot."
		}
	},
	vision : [["Tremorsense", "fixed 60"]],
	weaponOptions : [{
		baseWeapon : "war pick",
		regExpSearch : /ironfang/i,
		name : "Ironfang",
		source : [["PotA", 224]],
		description : "+1d8 thunder damage",
		modifiers : [2, 2],
		selectNow : true
	}],
	toNotesPage : [{
		name : "Features",
		note : [
			"A war pick forged from a single piece of iron, Ironfang has a fang-like head inscribed with ancient runes. The pick is heavy in the hand, but when the wielder swings the pick in anger, the weapon seems almost weightless. This weapon is immune to any form of rust, acid, or corrosion\u2014nothing seems to mark it. Ironfang contains a spark of Ogr\xE9moch, the Prince of Evil Earth.",
			"I gain a +2 bonus to attack and damage rolls made with this magic weapon. When I hit with it, the target takes an extra 1d8 thunder damage.",
			"While holding Ironfang, I can speak Terran fluently, have resistance to acid damage, have tremorsense out to a range of 60 ft, can sense the presence of precious metals and stones within 60 ft of me, but not their exact location, and can cast Dominate Monster (save DC 17) on an earth elemental once per dawn.",
			"Ironfang has 3 charges and regains 1d3 expended charges daily at dawn. I can use your action to expend 1 charge and cast the 2nd-level version of Shatter (DC 17).",
			"While inside an earth node, I can perform a ritual called the Rumbling, using Ironfang to create a Devastation Orb of Earth. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed. Once I perform the ritual, Ironfang can't be used to perform the ritual again until the next dawn.",
			'Ironfang heightens my destructive nature. While attuned to the weapon, I gain the following flaw: "I like to break things and cause ruin."'
		]
	}]
}
MagicItemsList["lost crown of besilmer"] = {
	name : "Lost Crown of Besilmer",
	source : [["PotA", 223]],
	type : "wondrous item",
	rarity : "legendary",
	storyItemAL : true,
	description : "This dwarven battle-helm gives me psychic resistance and adv. on saves against being charmed. It has 3 charges, regaining 1d3 at dawn. As a bonus action, I can use 1 charge to inspire an ally in 60 ft that I can see and that can see and hear me. Once before my next turn ends, it can add a d6 to one check, attack, or save.",
	descriptionFull : "This dwarven battle-helm consists of a sturdy open-faced steel helmet, decorated with a golden circlet above the brow from which seven small gold spikes project upward. You gain the following benefits while wearing the crown:\n \u2022 You have resistance to psychic damage.\n \u2022 You have advantage on saving throws against effects that would charm you.\n \u2022 You can use a bonus action to inspire one creature you can see that is within 60 feet of you and that can see or hear you. Once before the end of your next turn, the inspired creature can roll a d6 and add the number rolled to one ability check, attack roll, or saving throw it makes. This uses 1 charge from the crown. It has 3 charges, and it regains 1d3 expended charges daily at dawn.",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	action : [["bonus action", " (inspire)"]],
	dmgres : ["Psychic"],
	savetxt : { adv_vs : ["charmed"] }
}
MagicItemsList["orcsplitter"] = {
	name : "Orcsplitter",
	source : [["PotA", 224]],
	type : "weapon (greataxe)",
	rarity : "legendary",
	magicItemTable : "G",
	prerequisite : "Requires attunement by a good-aligned dwarf, fighter, or paladin",
	description : "This sentient greataxe has a +2 bonus on to hit and damage. If I roll a 20 on an attack vs. an orc with it, the orc must make a DC 17 Con save or be reduced to 0 HP. While I'm not incapacitated, I can't be surprised by orcs, and me and my allies in 30 ft can't be frightened. I can sense orcs within 120 ft. See Notes page.",
	descriptionFull : "A mighty axe wielded long ago by the dwarf king Torhild Flametongue, Orcsplitter is a battered weapon that appears unremarkable at first glance. Its head is graven with the Dwarvish runes for \"orc,\" but the runes are depicted with a gap or slash through the markings; the word \"orc\" is literally split in two.\n   You gain the following benefits while holding this magic weapon:\n \u2022 You gain a +2 bonus to attack and damage rolls made with it.\n \u2022 When you roll a 20 on an attack roll with this weapon against an orc, that orc must succeed on a DC 17 Constitution saving throw or drop to 0 hit points.\n \u2022 You can't be surprised by orcs while you're not incapacitated. You are also aware when orcs are within 120 feet of you and aren't behind total cover, although you don't know their location.\n \u2022 You and any of your friends within 30 feet of you can't be frightened while you're not incapacitated.\n\n" + toUni("Sentience") + ". Orcsplitter is a sentient, lawful good weapon with an Intelligence of 6, a Wisdom of 15, and a Charisma of 10. It can see and hear out to 120 feet and has darkvision. It communicates by transmitting emotions to its wielder, although on rare occasions it uses a limited form of telepathy to bring to the wielder's mind a couplet or stanza of ancient Dwarvish verse.\n   " + toUni("Personality") + ". Orcsplitter is grim, taciturn, and inflexible. It knows little more than the desire to face orcs in battle and serve a courageous, just wielder. It disdains cowards and any form of duplicity, deception, or disloyalty. The weapon's purpose is to defend dwarves and to serve as a symbol of dwarven resolve. It hates the traditional foes of dwarves\u2014giants, goblins, and, most of all, orcs\u2014and silently urges its possessor to meet such creatures in battle.",
	attunement : true,
	weight : 7,
	weaponOptions : [{
		baseWeapon : "greataxe",
		regExpSearch : /orcsplitter/i,
		name : "Orcsplitter",
		source : [["PotA", 224]],
		description : "Heavy, two-handed; On 20 vs. Orc: it DC 17 Con save or 0 HP",
		modifiers : [2, 2],
		selectNow : true
	}],
	savetxt : { immune : ["frightened"] },
	toNotesPage : [{
		name : "Features",
		note : desc([
			'A mighty axe wielded long ago by the dwarf king Torhild Flametongue, Orcsplitter is a battered weapon that appears unremarkable at first glance. Its head is graven with the Dwarvish runes for "orc," but the runes are depicted with a gap or slash through the markings; the word "orc" is literally split in two.',
			"I gain a +2 bonus to attack and damage rolls made with it. When I roll a 20 on an attack roll with this weapon against an orc, that orc must succeed on a DC 17 Constitution saving throw or drop to 0 hit points.",
			"While I am not incapacitated, I can't be surprised by orcs and I am aware when orcs are within 120 ft of meand aren't behind total cover, although I don't know their location. Also, me and any of my friends within 30 ft of can't be frightened while I am not incapacitated.",
			"Orcsplitter is a sentient, lawful good weapon with an Intelligence of 6, a Wisdom of 15, and a Charisma of 10. It can see and hear out to 120 feet and has darkvision. It communicates by transmitting emotions to its wielder, although on rare occasions it uses a limited form of telepathy to bring to the wielder's mind a couplet or stanza of ancient Dwarvish verse.",
			"Orcsplitter is grim, taciturn, and inflexible. It knows little more than the desire to face orcs in battle and serve a courageous, just wielder. It disdains cowards and any form of duplicity, deception, or disloyalty. The weapon's purpose is to defend dwarves and to serve as a symbol of dwarven resolve. It hates the traditional foes of dwarves\u2014giants, goblins, and, most of all, orcs\u2014and silently urges its possessor to meet such creatures in battle."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["reszur"] = {
	name : "Reszur",
	source : [["PotA", 157]],
	type : "weapon (dagger)",
	rarity : "uncommon",
	description : "I have a +1 bonus to attack and damage rolls made with this dagger. It doesn't make noise when it hits or cuts something. If I speaks the name \"Reszur\", which is engraved on its pommel, the blade gives off a faint, cold glow, shedding dim light in a 10-foot radius until I speak the name again.",
	descriptionFull : "You have a +1 bonus to attack and damage rolls made with this weapon, which doesn't make noise when it hits or cuts something.\n   The name \"Reszur\" is graven on the dagger's pommel. If the wielder speaks the name, the blade gives off a faint, cold glow, shedding dim light in a 10-foot radius until the wielder speaks the name again.",
	weight : 1,
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /reszur/i,
		name : "Reszur",
		source : [["PotA", 157]],
		description : "Finesse, light, thrown; Doesn't make any noise",
		modifiers : [1, 1],
		selectNow : true
	}]
}
MagicItemsList["seeker dart"] = {
	name : "Seeker Dart",
	source : [["PotA", 223]],
	type : "weapon (dart)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "Once as an action, when I whisper \"seek\" and hurl this dart, it seeks out a target of my choice within 120 ft that I have seen at least once. If the target isn't within range or there is no clear path to it, the dart's magic is spent. Else, the target must make a DC 16 Dex save or take 1d4 piercing and 3d4 lightning damage.",
	descriptionFull : "This small dart is decorated with designs like windy spirals that span the length of its shaft.\n   When you whisper the word \"seek\" and hurl this dart, it seeks out a target of your choice within 120 feet of you. You must have seen the target before, but you don't need to see it now. If the target isn't within range or if there is no clear path to it, the dart falls to the ground, its magic spent and wasted. Otherwise, elemental winds guide the dart instantly through the air to the target. The dart can pass though openings as narrow as 1 inch wide and can change direction to fly around corners.\n   When the dart reaches its target, the target must succeed on a DC 16 Dexterity saving throw or take 1d4 piercing damage and 3d4 lightning damage. The dart's magic is then spent, and it becomes an ordinary dart.",
	weight : 0.25
}
MagicItemsList["storm boomerang"] = {
	name : "Storm Boomerang",
	source : [["PotA", 223]],
	type : "weapon (javelin)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "This ranged weapon has 60/120 ft range, deals 1d4 bludgeoning and 3d4 thunder damage, and its target must make a DC 10 Con save or be stunned until its next turn ends. On a miss, it returns to the thrower's hand. Once it deals thunder damage, it can't do so or stun again until recharged in an air node for 1 hour.",
	descriptionFull : "This boomerang is a ranged weapon carved from griffon bone and etched with the symbol of elemental air. When thrown, it has a range of 60/120 feet, and any creature that is proficient with the javelin is also proficient with this weapon. On a hit, the boomerang deals 1d4 bludgeoning damage and 3d4 thunder damage, and the target must succeed on a DC 10 Constitution saving throw or be stunned until the end of its next turn. On a miss, the boomerang returns to the thrower's hand.\n   Once the boomerang deals thunder damage to a target, the weapon loses its ability to deal thunder damage and its ability to stun a target. These properties return after the boomerang spends at least 1 hour inside an elemental air node.",
	weaponOptions : [{
		baseWeapon : "javelin",
		name : "Storm Boomerang",
		regExpSearch : /^(?=.*storm)(?=.*boomerang).*$/i,
		list : "melee",
		ability : 2,
		damage : [1, 4, "bludgeoning"],
		range : "60/120 ft",
		weight : 2,
		description : "Returns on a miss; Once: +3d4 thunder damage, target DC 10 Con save or stunned 1 turn",
		selectNow : true
	}],
	usages : 1,
	recovery : "Air Node",
	additional : "recharge: 1 h in air node"
}
MagicItemsList["tinderstrike"] = {
	name : "Tinderstrike",
	source : [["PotA", 225]],
	type : "weapon (dagger)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This flint dagger has a +2 bonus on to hit and damage and deals +2d6 fire damage. It allows me to speak Ignan, grants me resistance to fire damage, and allows me to cast Dominate Monster on a fire elemental once per dawn. It gives me a flaw, see Notes page.",
	descriptionFull : "A flint dagger, Tinderstrike is uncommonly sharp, and sparks cascade off its edge whenever it strikes something solid. Its handle is always warm to the touch, and the blade smolders for 1d4 minutes after it is used to deal damage. It contains a spark of Imix, Prince of Evil Fire.\n   You gain a +2 bonus to attack and damage rolls made with this magic weapon. When you hit with it, the target takes an extra 2d6 fire damage.\n   " + toUni("Fire Mastery") + ". You gain the following benefits while you hold Tinderstrike:\n \u2022 You can speak Ignan fluently.\n \u2022 You have resistance to fire damage.\n \u2022 You can cast Dominate Monster (save DC 17) on a fire elemental. Once you have done so, Tinderstrike can't be used this way again until the next dawn.\n\n" + toUni("Dance of the All-Consuming Fire") + ". While inside a fire node, you can perform a ritual called the Dance of the All-Consuming Fire, using Tinderstrike to create a devastation orb of fire. Once you perform the ritual, Tinderstrike can't be used to perform the ritual again until the next dawn.\n   " + toUni("Flaw") + '. Tinderstrike makes its wielder impatient and rash. While attuned to the weapon, you gain the following flaw: "I act without thinking and take risks without weighing the consequences."',
	attunement : true,
	weight : 1,
	languageProfs : ["Ignan"],
	dmgres : ["Fire"],
	usages : 1,
	recovery : "dawn",
	fixedDC : 17,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"dominate monster" : {
			description : "Fire elemental save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect a fire elemental."
		}
	},
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /tinderstrike/i,
		name : "Tinderstrike",
		source : [["PotA", 225]],
		description : "Finesse, light, thrown; +2d6 fire damage",
		modifiers : [2, 2],
		selectNow : true
	}],
	toNotesPage : [{
		name : "Features",
		note : [
			"A flint dagger, Tinderstrike is uncommonly sharp, and sparks cascade off its edge whenever it strikes something solid. Its handle is always warm to the touch, and the blade smolders for 1d4 minutes after it is used to deal damage. It contains a spark of Imix, Prince of Evil Fire.",
			"I gain a +2 bonus to attack and damage rolls made with this magic weapon. When I hit with it, the target takes an extra 2d6 fire damage.",
			"While holding Tinderstrike, I can speak Ignan fluently, have resistance to fire damage, and can cast Dominate Monster (save DC 17) on a fire elemental once per dawn.",
			"While inside a fire node, I can perform a ritual called the Dance of the All-Consuming Fire, using Tinderstrike to create a Devastation Orb of Fire. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed. Once I perform the ritual, Tinderstrike can't be used to perform the ritual again until the next dawn.",
			'Tinderstrike makes me impatient and rash. While attuned to the weapon, I gain the following flaw: "I act without thinking and take risks without weighing the consequences."'
		]
	}]
}
MagicItemsList["weird tank"] = {
	name : "Weird Tank",
	source : [["PotA", 223]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "As an action, I can open (or close) this tank of water, allowing the water weird within it to act or not. The weird is bound to the tank, follows my telepathic commands, and acts after me in combat. If the weird is killed, a new one can be formed by placing the tank in a water node for 24 hours.",
	descriptionLong : "As an action, I can open (or close) this tank of water, allowing the water weird within it to act or not. The weird is bound to the tank, follows my telepathic commands, and acts after me in combat. If it is killed, a new one can be formed by placing the tank in a water node for 24 hours. I can close the tank as an action, but I can only close the tank after commanding the weird to retract into it or if it died. The tank has AC 15, 50 HP, vulnerability to bludgeoning damage, and immunity to poison and psychic damage. Reducing the tank to 0 hit points destroys it and the water weird contained within it.",
	descriptionFull : "A weird tank is a ten-gallon tank of blown glass and sculpted bronze with a backpack-like carrying harness fashioned from tough leather. A water weird is contained within the tank. While wearing the tank, you can use an action to open it, allowing the water weird to emerge. The water weird acts immediately after you in the initiative order, and it is bound to the tank.\n   You can command the water weird telepathically (no action required) while you wear the tank. You can close the tank as an action only if you have first commanded the water weird to retract into it or if the water weird is dead.\n   If the water weird is killed, the tank loses its magical containment property until it spends at least 24 hours inside an elemental water node. When the tank is recharged, a new water weird forms inside it.\n   The tank has AC 15, 50 hit points, vulnerability to bludgeoning damage, and immunity to poison and psychic damage. Reducing the tank to 0 hit points destroys it and the water weird contained within it.",
	weight : 120,
	attunement : true,
	action : [["action", ""]]
}
MagicItemsList["windvane"] = {
	name : "Windvane",
	source : [["PotA", 225]],
	type : "weapon (spear)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This spear with the finesse property has a +2 bonus on to hit and damage and deals +1d6 lightning damage. It allows me to speak Auran, grants me resistance to lightning damage, and allows me to cast Dominate Monster on an air elemental once per dawn. It gives me a flaw, see Notes page.",
	descriptionFull : "A silver spear, Windvane has dark sapphires on the filigreed surface of its polished head. Held by its shining haft, the weapon feels insubstantial, as if clutching a cool, gently flowing breeze. The spear contains a spark of Yan-C-Bin, the Prince of Evil Air.\n   You have a +2 bonus to attack and damage rolls made with this magic weapon, which has the finesse weapon property. When you hit with it, the target takes an extra 1d6 lightning damage.\n   " + toUni("Air Mastery") + ". You gain the following benefits while you hold Windvane:\n \u2022 You can speak Auran fluently.\n \u2022 You have resistance to lightning damage.\n \u2022 You can cast Dominate Monster (save DC 17) on an air elemental. Once you have done so, Windvane can't be used this way again until the next dawn.\n\n" + toUni("Song of the Four Winds") + ". While inside an air node, you can perform a ritual called the Song of the Four Winds, using Windvane to create a devastation orb of air. Once you perform the ritual, Windvane can't be used to perform the ritual again until the next dawn.\n   " + toUni("Flaw") + '. Windvane makes its wielder mercurial and unreliable. While attuned to the weapon, you gain the following flaw: "I break my vows and plans. Duty and honor mean nothing to me."',
	attunement : true,
	weight : 3,
	languageProfs : ["Auran"],
	dmgres : ["Lightning"],
	usages : 1,
	recovery : "dawn",
	fixedDC : 17,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"dominate monster" : {
			description : "Air elemental save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect an air elemental."
		}
	},
	weaponOptions : [{
		baseWeapon : "spear",
		regExpSearch : /windvane/i,
		name : "Windvane",
		source : [["PotA", 225]],
		description : "Finesse, thrown, versatile (1d6); +1d6 lightning damage",
		modifiers : [2, 2],
		selectNow : true
	}],
	toNotesPage : [{
		name : "Features",
		note : [
			"A silver spear, Windvane has dark sapphires on the filigreed surface of its polished head. Held by its shining haft, the weapon feels insubstantial, as if clutching a cool, gently flowing breeze. The spear contains a spark of Yan-C-Bin, the Prince of Evil Air.",
			"I have a +2 bonus to attack and damage rolls made with this magic weapon, which has the finesse weapon property. When I hit with it, the target takes an extra 1d6 lightning damage.",
			"While holding Windvane, I can speak Auran fluently, have resistance to lightning damage, and can cast Dominate Monster (save DC 17) on an air elemental once per dawn.",
			"While inside an air node, I can perform a ritual called the Song of the Four Winds, using Windvane to create a Devastation Orb of Air. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed. Once I perform the ritual, Windvane can't be used to perform the ritual again until the next dawn.",
			'Windvane makes me mercurial and unreliable. While attuned to the weapon, I gain the following flaw: "I break my vows and plans. Duty and honor mean nothing to me."'
		]
	}]
}
MagicItemsList["wingwear"] = {
	name : "Wingwear",
	source : [["PotA", 223]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "This snug uniform with leathery flaps has 3 charges, regaining all when placed in an air not for 1 hour. As a bonus action, I can expend 1 charge to gain a flying speed of 30 ft until I land or have 0 altitude. At the end of each of my turns, my altitude drops by 5 ft and I must move at least 30 ft horizontally or I fall.",
	descriptionFull : "This snug uniform has symbols of air stitched into it and leathery flaps that stretch along the arms, waist, and legs to create wings for gliding. A suit of wingwear has 3 charges. While you wear the suit, you can use a bonus action and expend 1 charge to gain a flying speed of 30 feet until you land. At the end of each of your turns, your altitude drops by 5 feet. Your altitude drops instantly to 0 feet at the end of your turn if you didn't fly at least 30 feet horizontally on that turn. When your altitude drops to 0 feet, you land (or fall), and you must expend another charge to use the suit again.\n   The suit regains all of its expended charges after spending at least 1 hour in an elemental air node.",
	attunement : true,
	usages : 3,
	recovery : "Air Node",
	additional : "recharge: 1 h in air node",
	action : [["bonus action", ""]]
}
// pub_20150415_AL-EE.js
// This file adds the optional backgrounds from the Adventurers League season 2 (Elemental Evil) to MPMB's Character Record Sheet

// Define the source
SourceList["AL:EE"]={
	name : "Elemental Evil Backgrounds [Mulmaster]",
	abbreviation : "AL:EE",
	group : "Adventurers League",
	url : "https://www.dropbox.com/s/ljtrwzmkoijb02o/Mulmaster-Bonds-and-Backgrounds.pdf?dl=1", // used to be https://dndadventurersleague.org/wp-content/uploads/2015/04/Mulmaster-Bonds-and-Backgrounds.pdf
	date : "2015/04/15"
};

// Backgrounds
BackgroundList["caravan specialist"] = {
	regExpSearch : /^(?=.*caravan)(?=.*specialist).*$/i,
	name : "Caravan Specialist",
	source : [["AL:EE", 2], ["ALbackground", 0]],
	skills : ["Animal Handling", "Survival"],
	gold : 10,
	equipleft : [
		["Two-person tent", "", 20],
		["Regional map", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Wagonmaster",
	trait : [
		"Any group is only as strong as its weakest link. Everyone has to pull their own weight.",
		"There's always someone out there trying to take what I've got. Always be vigilant.",
		"Anything can be learned if you have the right teacher. Most folks just need a chance.",
		"Early to bed and early to rise; this much at least is under my control.",
		"You can listen to me or don't and wish you had. Everyone ends up on one side of that fence.",
		"Eventually my hard work will be rewarded. Maybe that time has finally come.",
		"A strong ox or horse is more reliable than most people I've met.",
		"I never had time for books, but wish I had. I admire folks who have taken the time to learn."
	],
	ideal : [
		["Service",
			"Service: Using my talents to help others is the best way of helping myself. (Good)"
		],
		["Selfish",
			"Selfish: What people don't know WILL hurt them, but why is that my problem? (Evil)"
		],
		["Wanderer",
			"Wanderer: I go where the road takes me. Sometimes that's a good thing… (Chaotic)"
		],
		["Fittest",
			"Fittest: On the open road, the law of nature wins. Victims are the unprepared. (Lawful)"
		],
		["Focused",
			"Focused: I simply have a job to do, and I'm going to do it. (Neutral)"
		],
		["Motivated",
			"Motivated: There's a reason I'm good at what I do, I pay attention to the details. (Any)"
		]
	],
	bond : [
		"My brother has a farm In Elmwood and I've helped him and his neigbors move their goods to Mulmaster and other surrounding towns. Those are good people.",
		"A caravan I lead was attacked by bandits and many innocents died. I swear that I will avenge them by killing any bandits I encounter.",
		"The Soldiery are mostly good guys who understand the importance of protecting the roads. The City Watch is who you have to look out for. If they are inspecting your goods, get ready to pay a fine.",
		"The new commander of Southroad Tower, Capt. Holke, understands the importance of safe roads. He's hired me for several jobs and I'm grateful.",
		"There's always a road I haven't traveled before. I'm always looking for new places to explore.",
		"Wealth and power mean little without the freedom to go where and when you want."
	],
	flaw : [
		"I have trouble trusting people I've just met.",
		"I enjoy the open road. Underground and tight spaces make me very nervous.",
		"I expect others to heed my orders and have little respect or sympathy if they don't.",
		"I am very prideful and have trouble admitting when I'm wrong.",
		"Once I decide on a course of action, I do not waver.",
		"I like to explore, and my curiosity will sometimes get me into trouble."
	],
	toolProfs : ["Vehicles (land)"],
	languageProfs : [1],
	lifestyle : "poor"
};
BackgroundList["earthspur miner"] = {
	regExpSearch : /^(?=.*earthspur)(?=.*miner).*$/i,
	name : "Earthspur Miner",
	source : [["AL:EE", 3], ["ALbackground", 0]],
	skills : ["Athletics", "Survival"],
	gold : 5,
	equipleft : [
		["Shovel or miner's pick", "", 5],
		["Block and tackle", "", 5],
		["Climber's kit", "", 12]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Deep Miner",
	trait : [
		"Nothing bothers me for long.",
		"I hate the horrors of the Underdark with a passion. They took my friends and family and almost got me.",
		"Anything worth doing takes time and patience. I have learned to plan and wait for the things I want and to be patient to achieve my goals.",
		"I can party with everyone. Whether with dwarves, or goliaths, or deep gnomes, I can find a way to have a good time.",
		"I'd rather be mining. This is okay; mining is better.",
		"I think that I will stumble upon great riches if I just keep looking.",
		"People who don't work with their hands and who live in houses are soft and weak.",
		"I wish I were more educated. I look up to people who are."
	],
	ideal : [
		["Generosity",
			"Generosity: The riches of the earth are to be shared by all. (Good)"
		],
		["Greed",
			"Greed: Gems and precious metals, I want them all for myself. (Evil)"
		],
		["Mooch",
			"Mooch: Property, schmoperty. If I need it, I take and use it. If I don't, I leave it for someone else. (Chaotic)"
		],
		["Boundaries",
			"Boundaries: Everything and everyone has its prescribed place; I respect that and expect others to do the same. (Lawful) "
		],
		["Let it Be",
			"Let it Be: I don't meddle in the affairs of others if I can avoid it. They're none of my business. (Neutral)"
		],
		["Materialist",
			"Materialist: I want riches to improve my life. (Any)"
		]
	],
	bond : [
		"The people of the Earthspur mines are my family. I will do anything to protect them.",
		"A deep gnome saved my life when I was injured and alone. I owe his people a great debt.",
		"I must behold and preserve the natural beauty of places below the earth.",
		"Gems hold a special fascination for me, more than gold, land, magic, or power.",
		"I want to explore new depths and scale new heights.",
		"Someday I'm going to find the mother lode, then I'll spend the rest of my life in luxury."
	],
	flaw : [
		"I'm uncomfortable spending time under the open sky. I'd rather be indoors or underground.",
		"I'm not used to being around other people much and sometimes get grouchy about it.",
		"Good tools are more reliable than people. In a cave in, I would save a sturdy pick before a stranger.",
		"I jealously guard my secrets, because I think others will take advantage of me if they learn what I know.",
		"I am obsessed with getting rich. I always have a scheme brewing for making it big.",
		"I'm afraid of the dark."
	],
	languageProfs : ["Dwarvish", "Undercommon"],
	lifestyle : "poor"
};
BackgroundList["harborfolk"] = {
	regExpSearch : /harborfolk/i,
	name : "Harborfolk",
	source : [["AL:EE", 4], ["ALbackground", 0]],
	skills : ["Athletics", "Sleight of Hand"],
	gold : 5,
	equipleft : [
		["Fishing tackle", "", 4],
		["Set of dice, playing cards, or three-dragon ante", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1],
		["Rowboat", "", 100]
	],
	feature : "Harborfolk",
	trait : [
		"I am curious. I want to know why things are the way they are and why people do the things that they do.",
		"I can't sing, but that never stops me from doing it, loudly. Everyone loves a good sea chanty!",
		"I think the High Blade is doing a terrific job, don't you?",
		"I'm very excited that the House Built on Gold is being restored. I am a zealous worshipper of Waukeen.",
		"I am quite superstitious. I see portents in everyday occurances.",
		"I resent the rich and enjoy thwarting their plans and spoiling their fun in small ways.",
		"I have a sea story to fit every occasion.",
		"I'm a fisher, but I secretly detest eating fish. I will do anything to avoid it."
	],
	ideal : [
		["Calm",
			"Calm: For all things, there is a tide. I set sail when it is right, and mend my nets when it is not. (Lawful)"
		],
		["Windblown",
			"Windblown: I go where the winds blow. No man or woman tells me where or when to sail. (Chaotic)"
		],
		["Aspiring",
			"Aspiring: I will gain the favor of a Zor or Zora patron, maybe even one of the Blades! (Any)"
		],
		["Salty",
			"Salty: I want people to look to me as an expert on plying Mulmaster Harbor. (Any)"
		],
		["Selfless",
			"Selfless: We are all children of the sea. I help everyone in peril afloat and ashore. (Good)"
		],
		["Let them Drown",
			"Let them Drown: I refuse to risk my hide to help others. They wouldn't help me if roles were reversed. (Evil)"
		]
	],
	bond : [
		"I once lost everything but my rowboat. I'll do anything to protect it.",
		"My brother was in the Soldiery, but he was killed. I really look up to the men and women who serve.",
		"The Cloaks killed my friend for spellcasting. I'll get them back somehow, someday.",
		"The High House of Hurting helped me when I was hurt and asked nothing in return. I owe them my life.",
		"I was robbed in the Zhent ghetto once. It will not happen again.",
		"I would do anything to protect the other harborfolk. They are my family."
	],
	flaw : [
		"I drink too much, which causes me to miss the tide.",
		"I killed a drunk member of the City Watch in a brawl. I am terrified that they might find out.",
		"I oversell myself and make promises I can't keep when I want to impress someone.",
		"Book learning is a waste of time. I have no patience for people who don't speak from experience.",
		"I almost always cheat. I can't help myself.",
		"I am a secret informant for the Hawks. I send them reports about everything I see and hear, even what my friends and allies are up to."
	],
	toolProfs : [["Gaming set", 1], "Vehicles (water)"],
	lifestyle : "poor"
};
BackgroundList["mulmaster aristocrat"] = {
	regExpSearch : /^(?=.*mulmaster)(?=.*aristocrat).*$/i,
	name : "Mulmaster Aristocrat",
	source : [["AL:EE", 5], ["ALbackground", 0]],
	skills : ["Deception", "Performance"],
	gold : 10,
	equipleft : [
		["Artisan's tools or musical instrument", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Purse (with coins)", "", 1]
	],
	feature : "Highborn",
	trait : [
		"My ambitions are boundless. I will be a Zor or Zora one day!",
		"I must alwayss look my best.",
		"Beauty is everywhere. I can find it in even the homliest person and the most horrible tragedy.",
		"Décorum must be preserved at all costs.",
		"I will not admit I am wrong if I can avoid it.",
		"I am extremely well-educated and frequently remind others of that fact.",
		"I take what I can today, because I do not know what tomorrow holds.",
		"My life is full of dance, song, drink, and love."
	],
	ideal : [
		["Generous",
			"Generous: I have a responsibility to help and protect the less fortunate. (Good)"
		],
		["Loyal",
			"Loyal: My word, once given, is my bond. (Lawful)"
		],
		["Callous",
			"Callous: I am unconcerned with any negative effects my actions may have on the lives and fortunes of others. (Evil)"
		],
		["Impulsive",
			"Impulsive: I follow my heart. (Chaotic)"
		],
		["Ignorant",
			"Ignorant: Explanations bore me. (Neutral)"
		],
		["Isolationist",
			"Isolationist: I am concerned with the fortunes of my friends and family. Others must see to themselves. (Any)"
		]
	],
	bond : [
		"I have dedicated my wealth and my talents to the service of one of the city's many temples.",
		"My family and I are loyal supporters of High Blade Jaseen Drakehorn. Our fortunes are inexorably tied to hers. I would do anything to support her.",
		"Like many families who were close to High Blade Selfaril Uoumdolphin, mine has suffered greatly since his fall. We honor his memory in secret.",
		"My family plotted with Rassendyll Uoumdolphin brother usurped brother as High Blade. Betrayal is the quickest route to power.",
		"Wealth and power are nothing. Fulfillment can only be found in artistic expression.",
		"It's not how you feel, who you know, or what you can do - it's how you look, and I look fabulous."
	],
	flaw : [
		"I have difficulty caring about anyone or anything other than myself.",
		"Having grown up with wealth, I am careless with my finances. I overspend and am overly generous.",
		"The ends (my advancement) justify any means.",
		"I must have what I want and will brook no delay.",
		"My family has lost everything. I must keep up appearances, lest we become a laughingstock.",
		"I have no artistic sense. I hide that fact behind extreme opinons and have become a trendsetter."
	],
	toolProfs : [["Artisan's tools", 1], ["Musical instrument", 1]],
	lifestyle : "wealthy"
};
BackgroundList["phlan refugee"] = {
	regExpSearch : /^(?=.*phlan)(?=.*refugee).*$/i,
	name : "Phlan Refugee",
	source : [["AL:EE", 6], ["ALbackground", 0]],
	skills : ["Insight", "Athletics"],
	gold : 15,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Token of the life I once knew", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Phlan Survivor",
	trait : [
		"I may have lost everything I worked for most of my life, but there's work to be done, no time to linger on the past.",
		"I worked hard to get where I am and I refuse to let a little hardship stop me from succeeding.",
		"I protect those around me, you never know when one of them will be useful.",
		"I have always gotten ahead by giving, why change now?",
		"I prepare for everything, it paid off in Phlan and it will pay off again.",
		"I will reclaim my home, though the path may be long, I will never give up hope.",
		"I never cared for personal hygiene, and am amazed that It bothers others.",
		"I am always willing to volunteer my services, just as long as don't have to do anything."
	],
	ideal : [
		["Justice",
			"Justice: Corruption brought Phlan down, I will not tolerate that any longer. (Lawful)"
		],
		["Acceptance",
			"Acceptance: Stability is a myth, to think you can control your future is futile. (Chaotic)"
		],
		["Hope",
			"Hope: I am guided by a higher power and I trust that everything will be right in the end. (Good)"
		],
		["Restraint",
			"Restraint: I hate those who caused my loss. It is all I can do not to lash out at them. (Any)"
		],
		["Strength",
			"Strength: As shown in Phlan, the strong survive. If you are weak you deserve what you get (Evil)"
		],
		["Openness",
			"Openness: I am always willing to share my life story with anyone who will listen. (Any)"
		]
	],
	bond : [
		"I have the chance at a new life and this time I am going to do things right.",
		"The Lord Regent brought this suffering upon his people. I will see him brought to justice.",
		"I await the day I will be able to return to my home in Phlan.",
		"I will never forget the debt owed to Glevith of the Welcomers. I will be ready to repay that debt when called upon.",
		"There was someone I cared about in Phlan, I will find out what happened to them.",
		"Some say my life wasn't worth saving, I will prove them wrong."
	],
	flaw : [
		"I used the lives of children to facilitate my escape from Phlan.",
		"I am a sucker for the underdog, and always bet on the loosing team.",
		"I am incapable of standing up for myself.",
		"I will borrow money from friends with no intention to repay it.",
		"I am unable to keep secrets. A secret is just an untold story.",
		"When something goes wrong, it's never my fault."
	],
	toolProfs : [["Artisan's tools", 1]],
	languageProfs : [1],
	lifestyle : "modest"
};

// Background features
BackgroundFeatureList["wagonmaster"] = {
	description : "I'm used to being in charge. My reputation has me on a short list for critical jobs, allows me to attract two more loyal workers for caravaning, and causes others to look to me for direction. I can identify the most defensible locations for camping. I have a great memory for maps and geography. While travelling, I can always find my cardinal directions.",
	source : [["AL:EE", 2], ["ALbackground", 0]]
};
BackgroundFeatureList["deep miner"] = {
	description : "I am used to navigating the deep places of the earth. I never get lost in caves or mines if I have either seen an accurate map of them or have been through them before. Furthermore, I am able to scrounge fresh water and food for myself and as many as five other people each day if I am in a mine or natural caves.",
	source : [["AL:EE", 3], ["ALbackground", 0]]
};
BackgroundFeatureList["harborfolk"] = {
	description : "I grew up on the docks and waters of Mulmaster Harbor. The harborfolk remember me and still treat me as one of them. They welcome me and my companions. While they might charge me for it, they'll always offer what food and shelter they have; they'll even hide me if the City Watch is after me (but not if the Hawks are).",
	source : [["AL:EE", 4], ["ALbackground", 0]]
};
BackgroundFeatureList["highborn"] = {
	description : "Mulmaster is run by and for its aristoracy. Every other class of citizen in the city defers to me, and even the priesthood, Soldiery, Hawks, and Cloaks treat me with deference. Other aristocrats and nobles accept me in their circles and likely know me or of me. My connections can get me the ear of a Zor or Zora under the right circumstances.",
	source : [["AL:EE", 5], ["ALbackground", 0]]
};
BackgroundFeatureList["phlan survivor"] = {
	description : "Whatever my prior standing I'm now one of the many refugees that came to Mulmaster. I'm able to find refuge with others from Phlan and those who sympathize with my plight. Within Mulmaster this means that I can find a place to sleep, recover, and hide from the watch with either other refugees from Phlan, or the Zhents within the ghettos.",
	source : [["AL:EE", 6], ["ALbackground", 0]]
};

// pub_20150416_EE.js
// This file adds all the player-material from the Elemental Evil Player's Companion (November 2017, after the XGtE update) to MPMB's Character Record Sheet

// Define the source
SourceList.E={
	name : "Elemental Evil Player's Companion", // November 2017 version
	abbreviation : "EE",
	abbreviationSpellsheet : "EE",
	group : "Primary Sources",
	campaignSetting : "Forgotten Realms",
	url : "https://www.dropbox.com/scl/fi/h3rt7296724s6p8xgr1w2/Elemental-Evil-Players-Companion-v2017.pdf?rlkey=99p2n6gpk0qcz9r3hdjka0b9y&dl=1", // used to be https://media.dnd.wizards.com/EE-Players-Companion_0_0.pdf
	date : "2015/04/16"
};

// Races
RaceList["aarakocra"] = {
	regExpSearch : /aarakocra/i,
	name : "Aarakocra",
	source : [["E", 5], ["W", 166]],
	plural : "Aarakocra",
	size : 3,
	speed : {
		walk : { spd : 25, enc : 15 },
		fly : { spd : 50, enc : 0 }
	},
	languageProfs : ["Common", "Aarakocra", "Auran"],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /talon/i,
		name : "Talons",
		source : [["E", 5], ["W", 166]],
		damage : [1, 4, "slashing"],
		selectNow : true
	}],
	age : " reach maturity by age 3 and live about 30 years",
	height : " are about 5 feet tall",
	weight : " weigh between 80 and 100 lb",
	heightMetric : " are about 1,5 metres tall",
	weightMetric : " weigh between 36 and 45 kg",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Aarakocra (+2 Dexterity, +1 Wisdom)\n\nFlight: I have a flying speed of 50 feet. To use this speed, I can't be wearing medium or heavy armor.\n\nTalons: My unarmed strikes deal 1d4 slashing damage on a hit."
};
RaceList["deep gnome"] = {
	regExpSearch : /^((?=.*svirfneblin)|((?=.*\bgnomes?\b)(?=.*\b(underdarks?|deep|depths?)\b))).*$/i,
	name : "Svirfneblin",
	sortname : "Gnome, Deep (Svirfneblin)",
	source : [["E", 7], ["S", 115], ["MToF", 113]],
	plural : "Svirfneblin",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Gnomish", "Undercommon"],
	vision : [["Darkvision", 120]],
	savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. magic"] },
	age : " are considered full-grown adults when they reach 25 and live 200 to 250 years",
	height : " stand between 3 and 3 1/2 feet tall (2'9\" + 2d4\")",
	weight : " weigh around 90 lb (80 + 2d4 \xD7 1d4 lb)",
	heightMetric : " stand between 90 and 105 cm tall (85 + 5d4 cm)",
	weightMetric : " weigh around 50 kg (35 + 5d4 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 2, 0, 0],
	trait : "Svirfneblin (+1 Dexterity, +2 Intelligence)\n\nStone Camouflage:\n   I have advantage on Dexterity (stealth) checks to hide in rocky terrain."
};
RaceList["air genasi"] = {
	regExpSearch : /^(?=.*(genasi|planetouched))(?=.*\bairs?\b).*$/i,
	name : "Air genasi",
	sortname : "Genasi, Air",
	source : [["E", 9], ["W", 172]],
	plural : "Air genasi",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	age : " reach adulthood in their late teens and live up to 120 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 lb (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 2, 0, 0, 0],
	trait : "Air Genasi (+1 Dexterity, +2 Constitution)\n\nUnending Breath: I can hold my breath indefinitely while I am not incapacitated.\n\nMingle with the Wind: I can cast the Levitate spell once with this trait, requiring no material components, and I regain the ability to cast it this way when I finish a long rest. Constitution is my spellcasting ability for this spell.",
	spellcastingAbility : 3,
	features : {
		"levitate" : {
			name : "Mingle with the Wind",
			limfeaname : "Levitate",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Mingle with the Wind",
				spells : ["levitate"],
				selection : ["levitate"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"levitate" : {
					components : "V,S",
					compMaterial : "",
					changes : "Using Mingle with the Wind, I can cast Levitate once per long rest without requiring material components."
				}
			}
		}
	}
};
RaceList["earth genasi"] = {
	regExpSearch : /^(?=.*(genasi|planetouched))(?=.*\bearths?\b).*$/i,
	name : "Earth genasi",
	sortname : "Genasi, Earth",
	source : [["E", 9], ["W", 172]],
	plural : "Earth genasi",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	age : " reach adulthood in their late teens and live up to 120 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 lb (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 2, 0, 0, 0],
	trait : "Earth Genasi (+1 Strength, +2 Constitution)" + (typePF ? "\n" : "") + "\nEarth Walk: I can move across difficult terrain made of earth or stone without expending extra movement." + (typePF ? "\n" : "") + "\nMerge with Stone: I can cast the Pass without Trace spell once with this trait, requiring no material components, and I regain the ability to cast it this way when I finish a long rest. Constitution is my spellcasting ability for this spell.",
	spellcastingAbility : 3,
	features : {
		"pass without trace" : {
			name : "Merge with Stone",
			limfeaname : "Pass without Trace",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Merge with Stone",
				spells : ["pass without trace"],
				selection : ["pass without trace"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"pass without trace" : {
					components : "V,S",
					compMaterial : "",
					changes : "Using Merge with Stone, I can cast Pass without Trace once per long rest without requiring material components."
				}
			}
		}
	}
};
RaceList["fire genasi"] = {
	regExpSearch : /^(?=.*(genasi|planetouched))(?=.*\bfires?\b).*$/i,
	name : "Fire genasi",
	sortname : "Genasi, Fire",
	source : [["E", 9], ["W", 172]],
	plural : "Fire genasi",
	vision : [["Darkvision", 60]],
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live up to 120 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 lb (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 1, 0, 0],
	trait : "Fire Genasi (+2 Constitution, +1 Intelligence)\n\nReach to the Blaze:\n   I know the Produce Flame cantrip.\n   Once I reach 3rd level, I can cast the Burning Hands spell once as a 1st-level spell.\n   I regain the ability to cast it this way when I finish a long rest.\n   Constitution is my spellcasting ability for these spells.",
	spellcastingAbility : 3,
	spellcastingBonus : {
		name : "Reach to the Blaze (level 1)",
		spells : ["produce flame"],
		selection : ["produce flame"],
		firstCol : 'atwill'
	},
	features : {
		"burning hands" : {
			name : "Reach to the Blaze (level 3)",
			limfeaname : "Burning Hands",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Reach to the Blaze (level 3)",
				spells : ["burning hands"],
				selection : ["burning hands"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["water genasi"] = {
	regExpSearch : /^(?=.*(genasi|planetouched))(?=.*\bwaters?\b).*$/i,
	name : "Water genasi",
	sortname : "Genasi, Water",
	source : [["E", 10], ["W", 172]],
	plural : "Water genasi",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	dmgres : ["Acid"],
	age : " reach adulthood in their late teens and live up to 120 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 lb (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 0, 1, 0],
	trait : "Water Genasi (+2 Constitution, +1 Wisdom)\nAmphibious: I can breathe air and water.\nSwim: I have a swimming speed of 30 feet.\nCall to the Wave: I know the Shape Water cantrip.\n   When I reach 3rd level, I can cast the Create or Destroy Water spell as a 2nd-level spell once with this trait, and I regain the ability to cast it this way when I finish a long rest.\n   Constitution is my spellcasting ability for these spells.",
	spellcastingAbility : 3,
	spellcastingBonus : {
		name : "Call to the Wave (level 1)",
		spells : ["shape water"],
		selection : ["shape water"],
		firstCol : 'atwill'
	},
	features : {
		"create or destroy water" : {
			name : "Call to the Wave (level 3)",
			limfeaname : "Create/Destroy Water (level 2)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Call to the Wave (level 3)",
				spells : ["create or destroy water"],
				selection : ["create or destroy water"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["goliath"] = { // Added cold resistance in accordance with the VGtM 2020 errata https://media.wizards.com/2020/dnd/downloads/VGtM-Errata.pdf
	regExpSearch : /goliath/i,
	name : "Goliath",
	source : [["E", 11], ["V", 108], ["W", 175]],
	plural : "Goliaths",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Giant"],
	dmgres : ["Cold"],
	skills : ["Athletics"],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " are between 6 and a half and 8 feet tall (6'2\" + 2d10\")",
	weight : " weigh between 280 and 340 lb (200 + 2d10 \xD7 2d6 lb)",
	heightMetric : " are between 2 and 2,4 metres tall (190 + 5d10 cm)",
	weightMetric : " weigh between 100 and 155 kg (90 + 5d10 \xD7 4d6 / 10 kg)",
	scores : [2, 0, 1, 0, 0, 0],
	features : {
		"stone's endurance" : {
			name : "Stone's Endurance",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : [["reaction", ""]]
		}
	},
	trait : "Goliath (+2 Strength, +1 Constitution)"+
	"\n \u2022 Stone's Endurance: Once per short rest, when I take damage, I can use my reaction to reduce the damage by 1d12 + my Constitution modifier."+
	"\n \u2022 Powerful Build: I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift."+
	"\n \u2022 Mountain Born: I have resistance to cold damage and I'm acclimated to high altitude, including elevations above 20000 ft."+
	(typePF ? "\n \u2022 Natural Athlete: I have proficiency in the Athletics skill." : ""),
	carryingCapacity : 2
};

// Feat
FeatsList["svirfneblin magic"] = {
	name : "Svirfneblin Magic",
	source : [["E", 7], ["S", 115], ["MToF", 114]],
	prerequisite : "Being a Svirfneblin (Deep Gnome)",
	prereqeval : function(v) { return CurrentRace.known === 'deep gnome'; },
	descriptionFull : "You have inherited the innate spellcasting ability of your ancestors. This ability allows you to cast Nondetection on yourself at will, without needing a material component. You can also cast each of the following spells once with this ability: Blindness/Deafness, Blur, and Disguise Self. You regain the ability to cast these spells when you finish a long rest.\n   Intelligence is your spellcasting ability for these spells, and you cast them at their lowest possible levels.",
	description : "I can cast Nondetection on myself at will, without a material component. I can also cast the spells Blindness/Deafness, Blur, and Disguise Self once each. I regain the ability to cast these spells when I finish a long rest. Intelligence is my spellcasting ability for these spells.",
	spellcastingBonus : [{
		name : "at will (self only)",
		spellcastingAbility : 4,
		spells : ["nondetection"],
		selection : ["nondetection"],
		firstCol : 'atwill'
	}, {
		name : "1x long rest (self only)",
		spells : ["blindness/deafness", "blur", "disguise self"],
		selection : ["blindness/deafness", "blur", "disguise self"],
		firstCol : 'oncelr',
		times : 3
	}],
	spellChanges : {
		"nondetection" : {
			range : "Self",
			components : "V,S",
			compMaterial : "",
			description : "I am hidden from all divination magic",
			changes : "Using Svirfneblin Magic, I can cast Nondetection without a material component, but only on myself."
		}
	}
};

// Spells
SpellsList["abi-dalzim's horrid wilting"] = {
	name : "Abi-Dalzim's Horrid Wilting",
	nameShort : "Abi-D's Horrid Wilting",
	nameAlt : "Horrid Wilting",
	classes : ["sorcerer", "wizard"],
	source : [["X", 150], ["E", 15]],
	level : 8,
	school : "Necro",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "A bit of sponge",
	duration : "Instantaneous",
	save : "Con",
	description : "30-ft cube all crea 12d8 Necrotic dmg; save halves; plants/water elem. dis. const/undead immune",
	descriptionFull : "You draw the moisture from every creature in a 30-foot cube centered on a point you choose within range. Each creature in that area must make a Constitution saving throw. Constructs and undead aren't affected, and plants and water elementals make this saving throw with disadvantage. A creature takes 12d8 necrotic damage on a failed save, or half as much damage on a successful one." + "\n   " + "Nonmagical plants in the area that aren't creatures, such as trees and shrubs, wither and die instantly."
};
SpellsList["absorb elements"] = {
	name : "Absorb Elements",
	classes : ["artificer", "druid", "ranger", "sorcerer", "wizard"],
	source : [["X", 150], ["E", 15]],
	level : 1,
	school : "Abjur",
	time : "1 rea",
	timeFull : "1 reaction, which you take when you take acid, cold, fire, lightning, or thunder damage",
	range : "Self",
	components : "S",
	duration : "1 rnd",
	description : "Acid, Cold, Fire, Lightning, or Thunder resistance till next turn start; first melee hit +1d6+1d6/SL dmg",
	descriptionFull : "The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra 1d6 damage of the triggering type, and the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the extra damage increases by 1d6 for each slot level above 1st."
};
SpellsList["aganazzar's scorcher"] = {
	name : "Aganazzar's Scorcher",
	nameAlt : "Scorch", //as per the Spell Compandium's (DnD 3.5e) alternative name
	classes : ["sorcerer", "wizard"],
	source : [["X", 150], ["E", 15]],
	level : 2,
	school : "Evoc",
	time : "1 a",
	range : "30-ft line",
	components : "V,S,M",
	compMaterial : "A red dragon's scale",
	duration : "Instantaneous",
	save : "Dex",
	description : "30-ft long 5-ft wide line all creatures 3d8+1d8/SL Fire dmg; save halves",
	descriptionFull : "A line of roaring flame 30 feet long and 5 feet wide emanates from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 3d8 fire damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd."
};
SpellsList["beast bond"] = {
	name : "Beast Bond",
	classes : ["druid", "ranger"],
	source : [["X", 150], ["E", 15]],
	level : 1,
	school : "Div",
	time : "1 a",
	range : "Touch",
	components : "V,S,M",
	compMaterial : "A bit of fur wrapped in a cloth",
	duration : "Conc, 10 min",
	description : "Telepathic link with 1 beast Int<4 while in line of sight; beast has adv. on attacks vs. crea I can see",
	descriptionFull : "You establish a telepathic link with one beast you touch that is friendly to you or charmed by you. The spell fails if the beast's Intelligence is 4 or higher. Until the spell ends, the link is active while you and the beast are within line of sight of each other. Through the link, the beast can understand your telepathic messages to it, and it can telepathically communicate simple emotions and concepts back to you. While the link is active, the beast gains advantage on attack rolls against any creature within 5 feet of you that you can see."
};
SpellsList["bones of the earth"] = {
	name : "Bones of the Earth",
	classes : ["druid"],
	source : [["X", 150], ["E", 15]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Dex",
	description : "6+2/SL 5-ft dia stone lift up 30 ft; \u2265Medium crea save or lifted, 6d6 Bludg. dmg if hit ceiling; see B",
	descriptionShorter : "6+2/SL 5-ft dia stone lift up 30 ft; \u2265Medium crea save or lift, 6d6 Bludg. dmg if hit ceiling; see B",
	descriptionShorterMetric : "6+2/SL 1,5-m dia stone lift 9 m; \u2265Medium crea save or lift, 6d6 Bludg. dmg if hit ceiling; see B",
	descriptionFull : "You cause up to six pillars of stone to burst from places on the ground that you can see within range. Each pillar is a cylinder that has a diameter of 5 feet and a height of up to 30 feet. The ground where a pillar appears must be wide enough for its diameter, and you can target the ground under a creature if that creature is Medium or smaller. Each pillar has AC 5 and 30 hit points. When reduced to 0 hit points, a pillar crumbles into rubble, which creates an area of difficult terrain with a 10-foot radius that lasts until the rubble is cleared. Each 5-foot-diameter portion of the area requires at least 1 minute to clear by hand.\n   If a pillar is created under a creature, that creature must succeed on a Dexterity saving throw or be lifted by the pillar. A creature can choose to fail the save.\n   If a pillar is prevented from reaching its full height because of a ceiling or other obstacle, a creature on the pillar takes 6d6 bludgeoning damage and is restrained, pinched between the pillar and the obstacle. The restrained creature can use an action to make a Strength or Dexterity check (the creature's choice) against the spell's save DC. On a success, the creature is no longer restrained and must either move off the pillar or fall off it." + AtHigherLevels + "When you cast this spell using a spell slot of 7th level or higher, you can create two additional pillars for each slot level above 6th."
};
SpellsList["catapult"] = {
	name : "Catapult",
	classes : ["artificer", "sorcerer", "wizard"],
	source : [["X", 150], ["E", 15]],
	level : 1,
	school : "Trans",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "Instantaneous",
	save : "Dex",
	description : "Send 5+5/SL lb unattended object in 90 ft straight line; if crea hit, save or 3d8+1d8/SL Bludg. dmg",
	descriptionFull : "Choose one object weighing 1 to 5 pounds within range that isn't being worn or carried. The object flies in a straight line up to 90 feet in a direction you choose before falling to the ground, stopping early if it impacts against a solid surface. If the object would strike a creature, that creature must make a Dexterity saving throw. On a failed save, the object strikes the target and stops moving. When the object strikes something, the object and what it strikes each take 3d8 bludgeoning damage." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the maximum weight of objects that you can target with this spell increases by 5 pounds, and the damage increases by 1d8, for each slot level above 1st."
};
SpellsList["control flames"] = {
	name : "Control Flames",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 152], ["E", 16]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "Instant. or 1 h",
	description : "Nonmagical flame up to 5 cu ft; instant: expand/extinguish, 1h: brighten/dim/color/create shapes",
	descriptionFull : "You choose nonmagical flame that you can see within range and that fits within a 5-foot cube. You affect it in one of the following ways." + "\n \u2022 " + "You instantaneously expand the flame 5 feet in one direction, provided that wood or other fuel is present in the new location." + "\n \u2022 " + "You instantaneously extinguish the flames within the cube." + "\n \u2022 " + "You double or halve the area of bright light and dim light cast by the flame, change its color, or both. The change lasts for 1 hour." + "\n \u2022 " + "You cause simple shapes-such as the vague form of a creature, an inanimate object, or a location-to appear within the flames and animate as you like. The shapes last for 1 hour." + "\n   " + "If you cast this spell multiple times, you can have up to three of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
};
SpellsList["control winds"] = {
	name : "Control Winds",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 152], ["E", 16], ["UA:D", 8]],
	level : 5,
	school : "Trans",
	time : "1 a",
	range : "300 ft",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "100-ft cube of air either gusts, downdraft, or updraft; affects flying/jump/ranged; 1 a change; see B",
	descriptionFull : "You take control of the air in a 100-foot cube that you can see within range. Choose one of the following effects when you cast the spell. The effect lasts for the spell's duration, unless you use your action on a later turn to switch to a different effect. You can also use your action to temporarily halt the effect or to restart one you've halted." + "\n   " + toUni("Gusts") + ": A wind picks up within the cube, continually blowing in a horizontal direction you designate. You choose the intensity of the wind: calm, moderate, or strong. If the wind is moderate or strong, ranged weapon attacks that enter or leave the cube or pass through it have disadvantage on their attack rolls. If the wind is strong, any creature moving against the wind must spend 1 extra foot of movement for each foot moved." + "\n   " + toUni("Downdraft") + ": You cause a sustained blast of strong wind to blow downward from the top of the cube. Ranged weapon attacks that pass through the cube or that are made against targets within it have disadvantage on their attack rolls. A creature must make a Strength saving throw if it flies into the cube for the first time on a turn or starts its turn there flying. On a failed save, the creature is knocked prone." + "\n   " + toUni("Updraft") + ": You cause a sustained updraft within the cube, rising upward from the cube's bottom side. Creatures that end a fall within the cube take only half damage from the fall. When a creature in the cube makes a vertical jump, the creature can jump up to 10 feet higher than normal."
};
SpellsList["create bonfire"] = {
	name : "Create Bonfire",
	classes : ["artificer", "druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 152], ["E", 16]],
	level : 0,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "5-ft cube all crea now/enter/end turn save or 1d8 Fire dmg; ignites flammable; +1d8 at CL 5/11/17",
	descriptionShorter : "5-ft cube all now/enter/end save or 1d8 Fire dmg; ignites flammable; +1d8 at CL 5/11/17",
	descriptionCantripDie : "5-ft cube all crea at casting, entering, or end turn in save or `CD`d8 Fire dmg; ignites flammable",
	descriptionFull : "You create a bonfire on ground that you can see within range. Until the spell ends, the magic bonfire fills a 5-foot cube. Any creature in the bonfire's space when you cast the spell must succeed on a Dexterity saving throw or take 1d8 fire damage. A creature must also make the saving throw when it moves into the bonfire's space for the first time on a turn or ends its turn there." + "\n   " + "The bonfire ignites flammable objects in its area that aren't being worn or carried." + "\n   " + "The spell's damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8)."
};
SpellsList["dust devil"] = {
	name : "Dust Devil",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 154], ["E", 17]],
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A pinch of dust",
	duration : "Conc, 1 min",
	save : "Str",
	description : "5-ft cube; all in 5-ft 1d8+1d8/SL Bludg. dmg and pushed 10 ft away; save halves, no push; see book",
	descriptionFull : "Choose an unoccupied 5-foot cube of air that you can see within range. An elemental force that resembles a dust devil appears in the cube and lasts for the spell's duration." + "\n   " + "Any creature that ends its turn within 5 feet of the dust devil must make a Strength saving throw. On a failed save, the creature takes 1d8 bludgeoning damage and is pushed 10 feet away from the dust devil. On a successful save, the creature takes half as much damage and isn't pushed." + "\n   " + "As a bonus action, you can move the dust devil up to 30 feet in any direction. If the dust devil moves over sand, dust, loose dirt, or light gravel, it sucks up the material and forms a 10-foot-radius cloud of debris around itself that lasts until the start of your next turn. The cloud heavily obscures its area." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd."
};
SpellsList["earthbind"] = {
	name : "Earthbind",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 154], ["E", 17]],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "300 ft",
	components : "V",
	duration : "Conc, 1 min",
	save : "Str",
	description : "1 creatures save or fly speed is reduced to 0; airborne creatures safely descend at 60 ft per round",
	descriptionFull : "Choose one creature you can see within range. Yellow strips of magical energy loop around the creature. The target must succeed on a Strength saving throw, or its flying speed (if any) is reduced to 0 feet for the spell's duration. An airborne creature affected by this spell safely descends at 60 feet per round until it reaches the ground or the spell ends."
};
SpellsList["earth tremor"] = {
	name : "Earth Tremor",
	classes : ["bard", "druid", "sorcerer", "wizard"],
	source : [["X", 155], ["E", 17]],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "10 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Dex",
	description : "All crea in range except me save or 1d6+1d6/SL Bludgeoning dmg and prone; loose ground is dif. ter.",
	descriptionFull : "You cause a tremor in the ground within range. Each creature other than you in that area must make a Dexterity saving throw. On a failed save, a creature takes 1d6 bludgeoning damage and is knocked prone. If the ground in that area is loose earth or stone, it becomes difficult terrain until cleared, with each 5-foot-diameter portion requiring at least 1 minute to clear by hand." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
};
SpellsList["elemental bane"] = {
	name : "Elemental Bane",
	classes : ["artificer", "druid", "warlock", "wizard"],
	source : [["X", 155], ["E", 17]],
	level : 4,
	school : "Trans",
	time : "1 a",
	range : "90 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Con",
	description : "1+1/SL crea, each max 30 ft apart, save or 1 energy: lose resist. to it \u0026 +2d6 to first dmg with it/turn",
	descriptionShorter : "1+1/SL crea, each max 30 ft apart, save or 1 energy: lose resist. \u0026 +2d6 first dmg/turn",
	descriptionFull : "Choose one creature you can see within range, and choose one of the following damage types - acid, cold, fire, lightning, or thunder. The target must succeed on a Constitution saving throw or be affected by the spell for its duration. The first time each turn the affected target takes damage of the chosen type, the target takes an extra 2d6 damage of that type. Moreover, the target loses any resistance to that damage type until the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, you can target one additional creature for each slot level above 4th. The creatures must be within 30 feet of each other when you target them.",
	dynamicDamageBonus : {
		multipleDmgTypes : {
			dmgTypes : ["acid", "cold", "fire", "lightning", "thunder"],
			inDescriptionAs : "first"
		}
	}
};
SpellsList["erupting earth"] = {
	name : "Erupting Earth",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 155], ["E", 17]],
	level : 3,
	school : "Trans",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A piece of obsidian",
	duration : "Instantaneous",
	save : "Dex",
	description : "20-ft cube all crea 3d12+1d12/SL Bludgeoning dmg; save halves; area becomes difficult terrain",
	descriptionFull : "Choose a point you can see on the ground within range. A fountain of churned earth and stone erupts in a 20-foot cube centered on that point. Each creature in that area must make a Dexterity saving throw. A creature takes 3d12 bludgeoning damage on a failed save, or half as much damage on a successful one. Additionally, the ground in that area becomes difficult terrain until cleared. Each 5-foot-square portion of the area requires at least 1 minute to clear by hand." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d12 for each slot level above 3rd."
};
SpellsList["flame arrows"] = {
	name : "Flame Arrows",
	classes : ["artificer", "druid", "ranger", "sorcerer", "wizard"],
	source : [["X", 156], ["E", 18]],
	level : 3,
	school : "Trans",
	time : "1 a",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "12+2/SL ammunition drawn from touched quiver do +1d6 Fire damage on a successful hit",
	descriptionFull : "You touch a quiver containing arrows or bolts. When a target is hit by a ranged weapon attack using a piece of ammunition drawn from the quiver, the target takes an extra 1d6 fire damage. The spell's magic ends on the piece of ammunition when it hits or misses, and the spell ends when twelve pieces of ammunition have been drawn from the quiver." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the number of pieces of ammunition you can affect with this spell increases by two for each slot level above 3rd."
};
SpellsList["frostbite"] = {
	name : "Frostbite",
	classes : ["artificer", "druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 156], ["E", 18]],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "1 crea save or 1d6 Cold dmg and dis. on next weapon attack roll; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "1 crea save or `CD`d6 Cold dmg and dis. on next weapon attack roll",
	descriptionFull : "You cause numbing frost to form on one creature that you can see within range. The target must make a Constitution saving throw. On a failed save, the target takes 1d6 cold damage, and it has disadvantage on the next weapon attack roll it makes before the end of its next turn." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["gust"] = {
	name : "Gust",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 157], ["E", 19], ["E:RLW", 50], ["UA:D", 6], ["WGtE", 107]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Str",
	description : "Med. or smaller crea save or push 5 ft; or push unattended 5 lb obj 10 ft; or harmless sensory effect",
	descriptionFull : "You seize the air and compel it to create one of the following effects at a point you can see within range." + "\n " + "\u2022 One Medium or smaller creature that you choose must succeed on a Strength saving throw or be pushed up to 5 feet away from you." + "\n " + "\u2022 You create a small blast of air capable of moving one object that is neither held nor carried and that weighs no more than 5 pounds. The object is pushed up to 10 feet away from you. It isn't pushed with enough force to cause damage." + "\n " + "\u2022 You create a harmless sensory affect using air, such as causing leaves to rustle, wind to slam shutters shut, or your clothing to ripple in a breeze."
};
SpellsList["ice knife"] = {
	name : "Ice Knife",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 157], ["E", 19]],
	level : 1,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "S,M",
	compMaterial : "A drop of water or piece of ice",
	duration : "Instantaneous",
	save : "Dex",
	description : "Ranged atk for 1d10 Piercing dmg; hit/miss 5-ft rad on target all crea save or 2d6+1d6/SL Cold dmg",
	descriptionShorter : "Ranged atk 1d10 Piercing dmg; on target 5-ft rad all crea save or 2d6+1d6/SL Cold dmg",
	descriptionFull : "You create a shard of ice and fling it at one creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 piercing damage. Hit or miss, the shard then explodes. The target and each creature within 5 feet of it must succeed on a Dexterity saving throw or take 2d6 cold damage." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the cold damage increases by 1d6 for each slot level above 1st."
};
SpellsList["immolation"] = {
	name : "Immolation",
	classes : ["sorcerer", "wizard"],
	source : [["X", 158], ["E", 19]],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "90 ft",
	components : "V",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "1 crea save or 8d6 Fire dmg \u0026 burns for 4d6 Fire dmg/rnd; save each rnd to end; save half, no burning",
	descriptionShorter : "1 crea save or 8d6 Fire dmg \u0026 4d6 Fire dmg/rnd; save each rnd to end; save half, no rnds",
	descriptionFull : "Flames wreathe one creature you can see within range. The target must make a Dexterity saving throw. It takes 8d6 fire damage on a failed save, or half as much damage on a successful one. On a failed save, the target also burns for the spell's duration. The burning target sheds bright light in a 30-foot radius and dim light for an additional 30 feet. At the end of each of its turns, the target repeats the saving throw. It takes 4d6 fire damage on a failed save, and the spell ends on a successful one. These magical flames can't be extinguished by nonmagical means." + "\n   " + "If damage from this spell kills a target, the target is turned to ash.",
	dynamicDamageBonus : { multipleDmgMoments : false }
};
SpellsList["investiture of flame"] = {
	name : "Investiture of Flame",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 159], ["E", 19]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Dex",
	description : "Fire immune; Cold res.; 1d10 Fire dmg in 5 ft; 1 a 15-ft long 5-ft wide all crea 4d8 Fire dmg, save half",
	descriptionShorter : "Fire im.; Cold res.; 1d10 Fire dmg in 5 ft; 1a 15-ft long 5-ft wide all 4d8 Fire dmg, save half",
	descriptionShorterMetric : "Fire immune; Cold res.; 1d10 Fire dmg in 1,5 m; 1 a 4,5-m long all 4d8 Fire dmg, save half",
	descriptionFull : "Flames race across your body, shedding bright light in a 30-foot radius and dim light for an additional 30 feet for the spell's duration. The flames don't harm you. Until the spell ends, you gain the following benefits." + "\n " + "\u2022 You are immune to fire damage and have resistance to cold damage." + "\n " + "\u2022 Any creature that moves within 5 feet of you for the first time on a turn or ends its turn there takes 1d10 fire damage." + "\n " + "\u2022 You can use your action to create a line of fire 15 feet long and 5 feet wide extending from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 4d8 fire damage on a failed save, or half as much damage on a successful one."
};
SpellsList["investiture of ice"] = {
	name : "Investiture of Ice",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 159], ["E", 19]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Con",
	description : "Cold im.; Fire res.; 10-ft rad dif. ter.; 1 a 15-ft cone all crea 4d6 Cold dmg, half spd; save half, no spd",
	descriptionShorter : "Cold im.; Fire res.; 10-ft rad dif. ter.; 1 a 15-ft cone all 4d6 Cold dmg, half speed; save half",
	descriptionFull : "Until the spell ends, ice rimes your body, and you gain the following benefits." + "\n " + "\u2022 You are immune to cold damage and have resistance to fire damage." + "\n " + "\u2022 You can move across difficult terrain created by ice or snow without spending extra movement." + "\n " + "\u2022 The ground in a 10-foot radius around you is icy and is difficult terrain for creatures other than you. The radius moves with you." + "\n " + "\u2022 You can use your action to create a 15-foot cone of freezing wind extending from your outstretched hand in a direction you choose. Each creature in the cone must make a Constitution saving throw. A creature takes 4d6 cold damage on a failed save, or half as much damage on a successful one. A creature that fails its save against this effect has its speed halved until the start of your next turn."
};
SpellsList["investiture of stone"] = {
	name : "Investiture of Stone",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 159], ["E", 19]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Dex",
	description : "Nonmagical Bludg/Pierc/Slash resist.; 1 a 15-ft rad all crea save or prone; move through earth/stone",
	descriptionFull : "Until the spell ends, bits of rock spread across your body, and you gain the following benefits:" + "\n \u2022 " + "You have resistance to bludgeoning, piercing, and slashing damage from nonmagical attacks." + "\n \u2022 " + "You can use your action to create a small earthquake on the ground in a 15-foot radius centered on you. Other creatures on that ground must succeed on a Dexterity saving throw or be knocked prone." + "\n \u2022 " + "You can move across difficult terrain made of earth or stone without spending extra movement. You can move through solid earth or stone as if it was air and without destabilizing it, but you can't end your movement there. If you do so, you are ejected to the nearest unoccupied space, this spell ends, and you are stunned until the end of your next turn."
};
SpellsList["investiture of wind"] = {
	name : "Investiture of Wind",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 160], ["E", 20]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Con",
	description : "Rngd wea atks dis. vs. me; fly 60 ft; 1 a 15-ft cube in 60 ft all 2d10 Bludg. dmg, push 10 ft, save half",
	descriptionShorter : "Rngd wea atk dis; fly 60 ft; 1 a 15-ft cu in 60 ft all 2d10 Bludg. dmg, push 10 ft, save half",
	descriptionFull : "Until the spell ends, wind whirls around you, and you gain the following benefits." + "\n " + "\u2022 Ranged weapon attacks made against you have disadvantage on the attack roll." + "\n " + "\u2022 You gain a flying speed of 60 feet. If you are still flying when the spell ends, you fall, unless you can somehow prevent it." + "\n " + "\u2022 You can use your action to create a 15-foot cube of swirling wind centered on a point you can see within 60 feet of you. Each creature in that area must make a Constitution saving throw. A creature takes 2d10 bludgeoning damage on a failed save, or half as much damage on a successful one. If a Large or smaller creature fails the save, that creature is also pushed up to 10 feet away from the center of the cube."
};
SpellsList["maelstrom"] = {
	name : "Maelstrom",
	classes : ["druid"],
	source : [["X", 160], ["E", 20]],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "Paper or leaf in the shape of a funnel",
	duration : "Conc, 1 min",
	save : "Str",
	description : "5-ft deep 30-ft rad dif. ter.; all crea starting turn in save or 6d6 Bludg. dmg and pulled 10 ft to center",
	descriptionShorter : "5-ft deep 30-ft rad dif. ter.; all start turn in save or 6d6 Bludg. dmg \u0026 pull 10 ft to center",
	descriptionFull : "A mass of 5-foot-deep water appears and swirls in a 30-foot radius centered on a point you can see within range. The point must be on ground or in a body of water. Until the spell ends, that area is difficult terrain, and any creature that starts its turn there must succeed on a Strength saving throw or take 6d6 bludgeoning damage and be pulled 10 feet toward the center."
};
SpellsList["magic stone"] = {
	name : "Magic Stone",
	classes : ["artificer", "druid", "warlock"],
	source : [["X", 160], ["E", 20]],
	level : 0,
	school : "Trans",
	time : "1 bns",
	range : "Touch",
	components : "V,S",
	duration : "1 min",
	description : "Imbue 3 pebbles for spell attacks, thrown 60 ft or with sling, do 1d6+spellcasting mod Bludg. dmg",
	descriptionShorter : "Imbue 3 pebbles for spell atk, thrown 60 ft or sling, do 1d6+spellcasting mod Bludg. dmg",
	descriptionFull : "You touch one to three pebbles and imbue them with magic. You or someone else can make a ranged spell attack with one of the pebbles by throwing it or hurling it with a sling. If thrown, it has a range of 60 feet. If someone else attacks with the pebble, that attacker adds your spellcasting ability modifier, not the attacker's, to the attack roll. On a hit, the target takes bludgeoning damage equal to 1d6 + your spellcasting ability modifier. Hit or miss, the spell then ends on the stone." + "\n   " + "If you cast this spell again, the spell ends early on any pebbles still affected by it."
};
SpellsList["maximilian's earthen grasp"] = {
	name : "Maximilian's Earthen Grasp",
	nameShort : "Max's Earthen Grasp",
	nameAlt : "Earthen Grasp",
	classes : ["sorcerer", "wizard"],
	source : [["X", 161], ["E", 20]],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "A miniature hand sculpted from clay",
	duration : "Conc, 1 min",
	save : "Str",
	description : "Medium hand atks 1 crea: save or 2d6 Bludg. dmg \u0026 restrained; 1 a hand moves/atks, releases; see B",
	descriptionShorter : "Medium hand atk 1 crea: save or 2d6 Bludg. dmg \u0026 restrained; 1 a move/atk, release; see B",
	descriptionFull : "You choose a 5-foot-square unoccupied space on the ground that you can see within range. A Medium hand made from compacted soil rises there and reaches for one creature you can see within 5 feet of it. The target must make a Strength saving throw. On a failed save, the target takes 2d6 bludgeoning damage and is restrained for the spell's duration." + "\n   " + "As an action, you can cause the hand to crush the restrained target, which must make a Strength saving throw. The target takes 2d6 bludgeoning damage on a failed save, or half as much damage on a successful one." + "\n   " + "To break out, the restrained target can use its action to make a Strength check against your spell save DC. On a success, the target escapes and is no longer restrained by the hand." + "\n   " + "As an action, you can cause the hand to reach for a different creature or to move to a different unoccupied space within range. The hand releases a restrained target if you do either."
};
SpellsList["melf's minute meteors"] = {
	name : "Melf's Minute Meteors",
	nameAlt : "Minute Meteors",
	classes : ["sorcerer", "wizard"],
	source : [["X", 161], ["E", 20]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "Self",
	components : "V,S,M",
	compMaterial : "Niter, sulfur, and pine tar formed into a bead",
	duration : "Conc, 10 min",
	save : "Dex",
	description : "6+2/SL meteors; at casting/bns a send up to two 120 ft for 5-ft rad all crea 2d6 Fire dmg; save half",
	descriptionShorter : "6+2/SL meteors; at cast/bns a send up to two 120 ft for 5-ft rad all 2d6 Fire dmg; save half",
	descriptionFull : "You create six tiny meteors in your space. They float in the air and orbit you for the spell's duration. When you cast the spell-and as a bonus action on each of your turns thereafter-you can expend one or two of the meteors, sending them streaking toward a point or points you choose within 120 feet of you. Once a meteor reaches its destination or impacts against a solid surface, the meteor explodes. Each creature within 5 feet of the point where the meteor explodes must make a Dexterity saving throw. A creature takes 2d6 fire damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the number of meteors created increases by two for each slot level above 3rd."
};
SpellsList["mold earth"] = {
	name : "Mold Earth",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 162], ["E", 21]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "S",
	duration : "Instant. or 1 h",
	description : "5 cu ft earth; instant.: excavate; 1h: change to difficult or normal terrain, or change shape and color",
	descriptionFull : "You choose a portion of dirt or stone that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways." + "\n " + "\u2022 If you target an area of loose earth, you can instantaneously excavate it, move it along the ground, and deposit it up to 5 feet away. This movement doesn't have enough force to cause damage." + "\n " + "\u2022 You cause shapes, colors, or both to appear on the dirt or stone, spelling out words, creating images, or shaping patterns. The changes last for 1 hour." + "\n " + "\u2022 If the dirt or stone you target is on the ground, you cause it to become difficult terrain. Alternatively, you can cause the ground to become normal terrain if it is already difficult terrain. This change lasts for 1 hour." + "\n\n" + "If you cast this spell multiple times, you can have no more than two of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
};
SpellsList["primordial ward"] = {
	name : "Primordial Ward",
	classes : ["druid"],
	source : [["X", 163], ["E", 21]],
	level : 6,
	school : "Abjur",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "Acid, Cold, Fire, Lightning, and Thunder resistance; use rea to gain 1 immunity for 1 rnd, spell ends",
	descriptionFull : "You have resistance to acid, cold, fire, lightning, and thunder damage for the spell's duration." + "\n   " + "When you take damage of one of those types, you can use your reaction to gain immunity to that type of damage, including against the triggering damage. If you do so, the resistances end, and you have the immunity until the end of your next turn, at which time the spell ends."
};
SpellsList["pyrotechnics"] = {
	name : "Pyrotechnics",
	classes : ["artificer", "bard", "sorcerer", "wizard"],
	source : [["X", 163], ["E", 21]],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "5 cu ft nonma. flame extinguish, or 10-ft rad all crea save or blind 1 rnd, or 20-ft rad hvy obsc. 1 min",
	descriptionFull : "Choose an area of nonmagical flame that you can see and that fits within a 5-foot cube within range. You can extinguish the fire in that area, and you create either fireworks or smoke when you do so." + "\n   " + toUni("Fireworks") + ": The target explodes with a dazzling display of colors. Each creature within 10 feet of the target must succeed on a Constitution saving throw or become blinded until the end of your next turn." + "\n   " + toUni("Smoke") + ": Thick black smoke spreads out from the target in a 20-foot radius, moving around corners. The area of the smoke is heavily obscured. The smoke persists for 1 minute or until a strong wind disperses it."
};
SpellsList["shape water"] = {
	name : "Shape Water",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 164], ["E", 21], ["W", 172]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "S",
	duration : "Instant. or 1 h",
	description : "5 cu ft water; instant: move/change flow; 1h: simple shapes/change color or opacity/freeze",
	descriptionFull : "You choose an area of water that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways." + "\n " + "\u2022 You instantaneously move or otherwise change the flow of the water as you direct, up to 5 feet in any direction. This movement doesn't have enough force to cause damage." + "\n " + "\u2022 You cause the water to form into simple shapes and animate at your direction. This change lasts for 1 hour." + "\n " + "\u2022 You change the water's color or opacity. The water must be changed in the same way throughout. This change lasts for 1 hour." + "\n " + "\u2022 You freeze the water, provided that there are no creatures in it. The water unfreezes in 1 hour." + "\n\n" + "If you cast this spell multiple times, you can have no more than two of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
};
SpellsList["skywrite"] = {
	name : "Skywrite",
	classes : ["artificer", "bard", "druid", "wizard"],
	source : [["X", 165], ["E", 22]],
	ritual : true,
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "Sight",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "Write up to 10 words with clouds in a part of the sky I can see; strong wind can diperse the clouds",
	descriptionFull : "You cause up to ten words to form in a part of the sky you can see. The words appear to be made of cloud and remain in place for the spell's duration. The words dissipate when the spell ends. A strong wind can disperse the clouds and end the spell early."
};
SpellsList["snilloc's snowball swarm"] = {
	name : "Snilloc's Snowball Swarm",
	nameAlt : "Snowball Swarm",
	classes : ["sorcerer", "wizard"],
	source : [["X", 165], ["E", 22]],
	level : 2,
	school : "Evoc",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M",
	compMaterial : "A piece of ice or a small white rock chip",
	duration : "Instantaneous",
	save : "Dex",
	description : "5-ft radius all creatures 3d6+1d6/SL Cold damage; save halves",
	descriptionFull : "A flurry of magic snowballs erupts from a point you choose within range. Each creature in a 5-foot-radius sphere centered on that point must make a Dexterity saving throw. A creature takes 3d6 cold damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd."
};
SpellsList["storm sphere"] = {
	name : "Storm Sphere",
	classes : ["sorcerer", "wizard"],
	source : [["X", 166], ["E", 22]],
	level : 4,
	school : "Evoc",
	time : "1 a",
	range : "150 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Str",
	description : "20-ft rad dif. ter., all now/end turn save or 2d6 Bludg. dmg; bns a 60 ft atk 4d6 Lightn. dmg; +1d6/SL",
	descriptionShorter : "20-ft rad dif. ter., all save/turn 2d6 Bludg. dmg; bns a 60 ft atk 4d6 Lightn. dmg; +1d6/SL",
	descriptionFull : "A 20-foot-radius sphere of whirling air springs into existence centered on a point you choose within range. The sphere remains for the spell's duration. Each creature in the sphere when it appears or that ends its turn there must succeed on a Strength saving throw or take 2d6 bludgeoning damage. The sphere's space is difficult terrain." + "\n   " + "Until the spell ends, you can use a bonus action on each of your turns to cause a bolt of lightning to leap from the center of the sphere toward one creature you choose within 60 feet of the center. Make a ranged spell attack. You have advantage on the attack roll if the target is in the sphere. On a hit, the target takes 4d6 lightning damage." + "\n   " + "Creatures within 30 feet of the sphere have disadvantage on Wisdom (Perception) checks made to listen." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the damage increases for each of its effects by 1d6 for each slot level above 4th."
};
SpellsList["thunderclap"] = {
	name : "Thunderclap",
	classes : ["artificer", "bard", "druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 168], ["E", 22]],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "5 ft",
	components : "S",
	duration : "Instantaneous",
	save : "Con",
	description : "100-ft rad audible; all crea but me in area save or 1d6 Thunder dmg; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "100-ft rad audible; all crea but me in area save or `CD`d6 Thunder dmg",
	descriptionFull : "You create a burst of thunderous sound that can be heard up to 100 feet away. Each creature within range, other than you, must succeed on a Constitution saving throw or take 1d6 thunder damage." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["tidal wave"] = {
	name : "Tidal Wave",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 168], ["E", 22]],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A drop of water",
	duration : "Instantaneous",
	save : "Dex",
	description : "30-ft x 10-ft, 10-ft high all crea 4d8 Bludg. dmg and prone; save halves not prone; extinguish flames",
	descriptionFull : "You conjure up a wave of water that crashes down on an area within range. The area can be up to 30 feet long, up to 10 feet wide, and up to 10 feet tall. Each creature in that area must make a Dexterity saving throw. On a failed save, a creature takes 4d8 bludgeoning damage and is knocked prone. On a successful save, a creature takes half as much damage and isn't knocked prone. The water then spreads out across the ground in all directions, extinguishing unprotected flames in its area and within 30 feet of it, and then it vanishes."
};
SpellsList["transmute rock"] = {
	name : "Transmute Rock",
	classes : ["artificer", "druid", "wizard"],
	source : [["X", 169], ["E", 22]],
	level : 5,
	school : "Trans",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "Clay and water",
	duration : "Until dispelled",
	description : "40 cu ft stone to mud or mud to stone; mud and stone restrains; mud from ceiling falls; see book",
	descriptionFull : "You choose an area of stone or mud that you can see that fits within a 40-foot cube and is within range, and choose one of the following effects." + "\n   " + toUni("Transmute Rock to Mud") + ": Nonmagical rock of any sort in the area becomes an equal volume of thick, flowing mud that remains for the spell's duration." + "\n   " + "The ground in the spell's area becomes muddy enough that creatures can sink into it. Each foot that a creature moves through the mud costs 4 feet of movement, and any creature on the ground when you cast the spell must make a Strength saving throw. A creature must also make the saving throw when it moves into the area for the first time on a turn or ends its turn there. On a failed save, a creature sinks into the mud and is restrained, though it can use an action to end the restrained condition on itself by pulling itself free of the mud." + "\n   " + "If you cast the spell on a ceiling, the mud falls. Any creature under the mud when it falls must make a Dexterity saving throw. A creature takes 4d8 bludgeoning damage on a failed save, or half as much damage on a successful one." + "\n   " + toUni("Transmute Mud to Rock") + ": Nonmagical mud or quicksand in the area no more than 10 feet deep transforms into soft stone for the spell's duration. Any creature in the mud when it transforms must make a Dexterity saving throw. On a successful save, a creature is shunted safely to the surface in an unoccupied space. On a failed save, a creature becomes restrained by the rock. A restrained creature, or another creature within reach, can use an action to try to break the rock by succeeding on a DC 20 Strength check or by dealing damage to it. The rock has AC 15 and 25 hit points, and it is immune to poison and psychic damage."
};
SpellsList["vitriolic sphere"] = {
	name : "Vitriolic Sphere",
	classes : ["sorcerer", "wizard"],
	source : [["X", 170], ["E", 23]],
	level : 4,
	school : "Evoc",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "A drop of giant slug bile",
	duration : "Instantaneous",
	save : "Dex",
	description : "20-ft rad all crea 10d4+2d4/SL Acid dmg, +5d4 dmg next turn end; save half \u0026 no dmg next turn",
	descriptionShorter : "20-ft rad all crea 10d4+2d4/SL Acid dmg, +5d4 dmg next turn; save half \u0026 no next turn",
	descriptionFull : "You point at a location within range, and a glowing, 1-foot-diameter ball of emerald acid streaks there and explodes in a 20-foot-radius sphere. Each creature in that area must make a Dexterity saving throw. On a failed save, a creature takes 10d4 acid damage and another 5d4 acid damage at the end of its next turn. On a successful save, a creature takes half the initial damage and no damage at the end of its next turn." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the initial damage increases by 2d4 for each slot level above 4th.",
	dynamicDamageBonus : {
		multipleDmgMoments : false,
		extraDmgGroupsSameType : /((?:\+?\d+d?\d*)+)( dmg next turn)/i
	}
};
SpellsList["wall of sand"] = {
	name : "Wall of Sand",
	classes : ["wizard"],
	source : [["X", 170], ["E", 23]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M",
	compMaterial : "A handful of sand",
	duration : "Conc, 10 min",
	description : "30\xD710\xD710ft (l\xD7w\xD7h) wall on the ground; blocks line of sight; blinded while inside; 1/3 move",
	descriptionMetric : "9\xD73\xD73m (l\xD7w\xD7h) wall on the ground; blocks line of sight; blinded while inside; 1/3 move",
	descriptionFull : "You conjure up a wall of swirling sand on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 10 feet thick, and it vanishes when the spell ends. It blocks line of sight but not movement. A creature is blinded while in the wall's space and must spend 3 feet of movement for every 1 foot it moves there."
};
SpellsList["wall of water"] = {
	name : "Wall of Water",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 170], ["E", 23], ["V", 116], ["MOT", 27]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A drop of water",
	duration : "Conc, 10 min",
	description : "30\xD71\xD710ft (l\xD7w\xD7h) or 20-ft rad 20-ft high; dif. ter.; range wea dis.; Fire dmg half; Cold dmg freezes",
	descriptionMetric : "9\xD70,3\xD73m (l\xD7w\xD7h) or 6-m rad 6-m high; dif. ter.; ranged wea dis.; Fire dmg half; Cold dmg freezes",
	descriptionFull : "You conjure up a wall of water on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 1 foot thick, or you can make a ringed wall up to 20 feet in diameter, 20 feet high, and 1 foot thick. The wall vanishes when the spell ends. The wall's space is difficult terrain." + "\n   " + "Any ranged weapon attack that enters the wall's space has disadvantage on the attack roll, and fire damage is halved if the fire effect passes through the wall to reach its target. Spells that deal cold damage that pass through the wall cause the area of the wall they pass through to freeze solid (at least a 5-foot square section is frozen). Each 5-foot-square frozen section has AC 5 and 15 hit points. Reducing a frozen section to 0 hit points destroys it. When a section is destroyed, the wall's water doesn't fill it."
};
SpellsList["warding wind"] = {
	name : "Warding Wind",
	classes : ["bard", "druid", "sorcerer", "wizard"],
	source : [["X", 170], ["E", 23]],
	level : 2,
	school : "Evoc",
	time : "1 a",
	range : "S:10-ft rad",
	components : "V",
	duration : "Conc, 10 min",
	description : "Strong (20 mph) wind around me deafens/extinguishes unprotected flames/dif. ter./ranged wea dis.",
	descriptionMetric : "Strong (32 kph) wind around me deafens/extinguishes unprotected flames/dif. ter./ranged wea dis.",
	descriptionFull : "A strong wind (20 miles per hour) blows around you in a 10-foot radius and moves with you, remaining centered on you. The wind lasts for the spell's duration.\n   The wind has the following effects."+
	"\n \u2022 It deafens you and other creatures in its area."+
	"\n \u2022 It extinguishes unprotected flames in its area that are torch-sized or smaller."+
	"\n \u2022 The area is difficult terrain for creatures other than you."+
	"\n \u2022 The attack rolls of ranged weapon attacks have disadvantage if they pass in or out of the wind."+
	"\n \u2022 It hedges out vapor, gas, and fog that can be dispersed by strong wind."
};
SpellsList["watery sphere"] = {
	name : "Watery Sphere",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 170], ["E", 23]],
	level : 4,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M",
	compMaterial : "A droplet of water",
	duration : "Conc, 1 min",
	save : "Str",
	description : "5-ft rad all crea < Huge save or restrained; on save ejected; save each rnd; 1 a move sphere 30 ft",
	descriptionFull : "You conjure up a sphere of water with a 5-foot radius at a point you can see within range. The sphere can hover but no more than 10 feet off the ground. The sphere remains for the spell's duration." + "\n   " + "Any creature in the sphere's space must make a Strength saving throw. On a successful save, a creature is ejected from that space to the nearest unoccupied space of the creature's choice outside the sphere. A Huge or larger creature succeeds on the saving throw automatically, and a Large or smaller creature can choose to fail it. On a failed save, a creature is restrained by the sphere and is engulfed by the water. At the end of each of its turns, a restrained target can repeat the saving throw, ending the effect on itself on a success." + "\n   " + "The sphere can restrain as many as four Medium or smaller creatures or one Large creature. If the sphere restrains a creature that causes it to exceed this capacity, a random creature that was already restrained by the sphere falls out of it and lands prone in a space within 5 feet of it." + "\n   " + "As an action, you can move the sphere up to 30 feet in a straight line. If it moves over a pit, a cliff, or other drop-off, it safely descends until it is hovering 10 feet above the ground. Any creature restrained by the sphere moves with it. You can ram the sphere into creatures, forcing them to make the saving throw." + "\n   " + "When the spell ends, the sphere falls to the ground and extinguishes all normal flames within 30 feet of it. Any creature restrained by the sphere is knocked prone in the space where it falls. The water then vanishes."
};
SpellsList["whirlwind"] = {
	name : "Whirlwind",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 171], ["E", 24]],
	level : 7,
	school : "Evoc",
	time : "1 a",
	range : "300 ft",
	components : "V,M",
	compMaterial : "A piece of straw",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "10-ft rad 30-ft high all crea 10d6 Bludg. dmg; save halves; restrains; 1 a move 30 ft; see book",
	descriptionFull : "A whirlwind howls down to a point that you can see on the ground within range. The whirlwind is a 10-foot-radius, 30-foot-high cylinder centered on that point. Until the spell ends, you can use your action to move the whirlwind up to 30 feet in any direction along the ground. The whirlwind sucks up any Medium or smaller objects that aren't secured to anything and that aren't worn or carried by anyone." + "\n   " + "A creature must make a Dexterity saving throw the first time on a turn that it enters the whirlwind or that the whirlwind enters its space, including when the whirlwind first appears. A creature takes 10d6 bludgeoning damage on a failed save, or half as much damage on a successful one. In addition, a Large or smaller creature that fails the save must succeed on a Strength saving throw or become restrained in the whirlwind until the spell ends. When a creature starts its turn restrained by the whirlwind, the creature is pulled 5 feet higher inside it, unless the creature is at the top. A restrained creature moves with the whirlwind and falls when the spell ends, unless the creature has some means to stay aloft." + "\n   " + "A restrained creature can use an action to make a Strength or Dexterity check against your spell save DC. If successful, the creature is no longer restrained by the whirlwind and is hurled 3d6 \xD7 10 feet away from it in a random direction."
};

// Weapons (attack cantrips)
WeaponsList["create bonfire"] = {
	regExpSearch : /^(?=.*create)(?=.*bonfire).*$/i,
	name : "Create Bonfire",
	source : [["X", 152], ["E", 16]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 8, "fire"],
	range : "60 ft",
	description : "5-ft cube; Dex save at casting or when moved into, success - no damage; Conc, 1 min",
	abilitytodamage : false,
	dc : true
};
WeaponsList["frostbite"] = {
	regExpSearch : /frostbite/i,
	name : "Frostbite",
	source : [["X", 156], ["E", 18]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "cold"],
	range : "60 ft",
	description : "Con save, success - no damage, fail - also disadv. on next weapon attack roll in next turn; 1 creature",
	abilitytodamage : false,
	dc : true
};
WeaponsList["magic stone"] = {
	regExpSearch : /^(?=.*magic)(?=.*stone).*$/i,
	name : "Magic Stone",
	source : [["X", 160], ["E", 20]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : [1, 6, "bludgeoning"],
	range : "60/120 ft",
	description : "Produces 3 stones that each can be thrown (60 ft) or hurled with a sling (120 ft) as a spell attack",
	abilitytodamage : true
};
WeaponsList["thunderclap"] = {
	regExpSearch : /thunderclap/i,
	name : "Thunderclap",
	source : [["X", 168], ["E", 22]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "thunder"],
	range : "5-ft radius",
	description : "Con save, success - no damage; all creatures in area; audible in 100 ft",
	abilitytodamage : false,
	dc : true
};

// pub_20150714_AL-RoD.js
// This file adds the optional backgrounds from the Adventurers League season 3 (Rage of Demons) to MPMB's Character Record Sheet

// Define the source
SourceList["AL:RoD"]={
	name : "Rage of Demons Backgrounds [Hillsfar]",
	abbreviation : "AL:RoD",
	group : "Adventurers League",
	campaignSetting : "Forgotten Realms",
	url : "https://www.dropbox.com/s/h4ijcnfun1cn580/Hillsfar-Regional-Character-Options.pdf?dl=1", // used to be https://dndadventurersleague.org/wp-content/uploads/2015/07/Hillsfar-Regional-Character-Options.pdf
	date : "2015/07/14"
};

// Backgrounds (with contributions by AggieBear)
BackgroundList["cormanthor refugee"] = {
	regExpSearch : /^(?=.*cormanthor)(?=.*refugee).*$/i,
	name : "Cormanthor Refugee",
	source : [["AL:RoD", 5], ["ALbackground", 0]],
	skills : ["Nature", "Survival"],
	gold : 5,
	equipleft : [
		["Two-person tent", "", 20],
		["Set of artisan's tools", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Holy symbol (type)", "", 1],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Shelter of the Elven Clergy",
	trait : [
		"I long for a home that never really existed, whether in the camps, Hillsfar, or Myth Drannor.",
		"Though I am not an elf, I am a fervent, radical worshipper of the elven gods.",
		"I live in the moment, knowing my life could be turned upside down any day.",
		"I appreciate beauty in all of its forms.",
		"I hate the dark elves and the Netherese for each driving the elves out of Cormanthyr in the past.",
		"I am a forest bumpkin who grew up in a tent in the woods and is wholly ignorant of city life.",
		"I was raised alongside children of many other races. I harbor no racial prejudices at all.",
		"The elves have just the right word for so many things that cannot be expressed as well in other languages. I pepper my speech with elven words, phrases, and sayings."
	],
	ideal : [
		["Patient",
			"Patient: The elves have taught me to think and plan for the long-term. (Lawful)"
		],
		["Rebellious",
			"Rebellious: Governments and politicians drove my family to the camps. I subtly defy authority whenever I think I can get away with it. (Chaotic)"
		],
		["Self-Absorbed",
			"Self-Absorbed: I've had to look out for number one so long that it has become second nature. (Any)"
		],
		["Wanderlust",
			"Wanderlust: I want to see as much of the world beyond the camps as I can. (Any)"
		],
		["Generous",
			"Generous: I give everything I can to help those in need, regardless of who they are. (Good)"
		],
		["To the Abyss with Them",
			"To the Abyss with Them: The people of Hillsfar cast me out. I won't risk my hide to help them. (Evil)"
		]
	],
	bond : [
		"The elves took me in when I had nowhere else to go. In return, I do what I can to help elves in need.",
		"I seek revenge against the people of Hillsfar for driving my family into the forest.",
		"My family lost everything when they were driven from Hillsfar. I strive to rebuild that fortune.",
		"The forest has provided me with food and shelter. In return, I protect forests and those who dwell within.",
		"I am deeply, tragically in love with someone whose racial lifespan is far longer or shorter than mine.",
		"Members of my extended family did not make it to the camps or have been kidnapped to fight in the Arena. I search for them tirelessly."
	],
	flaw : [
		"I am very uncomfortable indoors and underground",
		"I am haughty. I grew up among the elves and emulate them. Other races are crude in comparison.",
		"Elf this, elf that. I am sick and tired of the elves.",
		"I am a miser. Having lost everything once before, I clutch my possessions and wealth very tightly.",
		"I am a moocher. I am so used to others providing for me that I have come to expect everyone to do it.",
		"I believe the gods have cursed me, my family, and all of the Cormanthor refugees. We are all doomed, doomed I tell you!"
	],
	toolProfs : [["Artisan's tools", 1]],
	languageProfs : ["Elvish"],
	lifestyle : "poor"
};
BackgroundList["gate urchin"] = {
	regExpSearch : /^(?=.*gate)(?=.*urchin).*$/i,
	name : "Gate Urchin",
	source : [["AL:RoD", 6], ["ALbackground", 0]],
	skills : ["Deception", "Sleight of Hand"],
	gold : 10,
	equipleft : [
		["Battered alms box", "", 1]
	],
	equipright : [
		["Common clothes", "", 3],
		["Cast-off military jacket, cap, or scarf", "", ""],
		["Belt pouch (with coins)", "", 1],
		["Musical instrument of my choice", "", ""]
	],
	feature : "Red Plume and Mage Guild Contacts",
	trait : [
		"I appreciate the simple things in life: a song, a warm meal, a sunny day. I don't need any more.",
		"My problems are always caused by others. I'm never to blame.",
		"I am afraid I could wind up back on the streets any day.",
		"I get along with everyone.",
		"I see people as marks for a con and have difficulty feeling true empathy for them.",
		"I have a real flair for matchmaking. I can find anyone a spouse!",
		"I think money is the true measure of appreciation and affection. Everything else is talk or an act.",
		"I don't like having a lot of stuff, just a few simple things I need. I don't like being tied down and tend to leave things behind when I don't need them anymore."
	],
	ideal : [
		["Loyal",
			"Loyal: I never rat out any of my friends, even when the Red Plumes or the Rogues Guild ask. (Lawful)"
		],
		["Adventurous",
			"Adventurous: I don't like doing the same thing every day. I crave variety. (Chaotic)"
		],
		["Strong",
			"Strong: Only the strong survive. I respect those who are strong and powerful. (Any)"
		],
		["Witty",
			"Witty: Brains are better than brawn. I rely on my wits and respect others who do the same. (Any)"
		],
		["Honest",
			"Honest: Others can do what they want, but I won't lie or steal, even to feed my family. (Good)"
		],
		["Ungrateful",
			"Ungrateful: Those who give, only do it to make themselves feel better. I steal from them. (Evil)"
		]
	],
	bond : [
		"The Joydancers of Lliira gave me my instrument when I really needed food. I hate them for that.",
		"Busking has taught me to love music above all else.",
		"The Rogues Guild spared me when I did a job without cutting them in. I owe them a great debt.",
		"I know people hate the Red Plumes, but some of them were really good to me. I help Red Plumes whenever I can, and I respect them. They're just doing what they have to do to get by in this world.",
		"I will be wealthy some day. My descendants will live in comfort and style.",
		"I know how hard life on the streets is. I do everything I can for those who have less than me."
	],
	flaw : [
		"Though I no longer live at the Gate, I am still always concerned about where I will get my next meal.",
		"Years of thieving have become habit. I sometimes steal from strangers without thinking about it.",
		"I am ashamed of my origins. I pretend I am higher-born and fear others will find out the truth.",
		"I think people who grew up in houses are soft, spoiled, and ungrateful. I frequently tell them so.",
		"I am still very uncomfortable wearing nice clothes, sleeping in a warm bed, and eating fine food.",
		"I do not trust anyone who has not had a hard life."
	],
	toolProfs : [["Thieves' tools", "Dex"], ["Musical instrument", 1]],
	lifestyle : "poor"
};
BackgroundList["hillsfar merchant"] = {
	regExpSearch : /^(?=.*hillsfar)(?=.*merchant).*$/i,
	name : "Hillsfar Merchant",
	source : [["AL:RoD", 7], ["ALbackground", 0]],
	skills : ["Insight", "Persuasion"],
	gold : 25,
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Purse (with coins)", "", 1],
		["Letter of introduction from family's trading house", "", 1]
	],
	feature : "Factor",
	featureAlt : "Trade Contact",
	trait : [
		"I fill my evenings with wine or mead and song.",
		"I greatly admire gladiators and enjoy the Arena.",
		"I take my wealth for granted. It seldom occurs to me that others aren't rich themselves.",
		"I leave broken hearts all around the Moonsea and up and down the Sword Coast.",
		"I work hard and seldom make time for fun.",
		"I am a particularly devout and pray often.",
		"The Red Plumes caught me once. I hate them.",
		"I ask a lot of questions to get information about those with whom I am working and dealing."
	],
	ideal : [
		["Frugal",
			"Frugal: I spend my money very carefully. (Lawful)"
		],
		["Profligate",
			"Profligate: I tend to spend extravagantly. (Chaotic)"
		],
		["Honest",
			"Honest: I deal with others above board. (Any)"
		],
		["Sharp",
			"Sharp: I seek to make the best deal possible. (Any)"
		],
		["Charitable",
			"Charitable: I give generously to others. (Good)"
		],
		["Greedy",
			"Greedy: I do not share my wealth with others. (Evil)"
		]
	],
	bond : [
		"I am fiercely loyal to those with whom I work.",
		"I must uphold the good name of my family.",
		"I will prove myself to my family as an adventurer.",
		"Deals are sacrosanct. I never go back on my word.",
		"I love making deals and negotiating agreements.",
		"I guard my wealth jealously."
	],
	flaw : [
		"I am a braggart. I promote myself shamelessly.",
		"I am vain. I always wear the latest fashions.",
		"I am a glutton. I eat and drink to excess.",
		"I am a snob. I want only the finest things in life.",
		"I am lazy. I want others to take care of everything.",
		"I am overconfident. I overestimate my abilities."
	],
	toolProfs : ["Vehicles (land)", "Vehicles (water)"],
	lifestyle : "wealthy"
};
BackgroundList["hillsfar smuggler"] = {
	regExpSearch : /^(?=.*hillsfar)(?=.*smuggler).*$/i,
	name : "Hillsfar Smuggler",
	source : [["AL:RoD", 8], ["ALbackground", 0]],
	skills : ["Perception", "Stealth"],
	gold : 5,
	equipleft : [
		["Forgery kit", "", 5]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Secret Passage",
	trait : [
		"When I'm not smuggling, I gamble.",
		"I just love Halfling cooking and baking!",
		"I party with dwarves whenever I can.",
		"I'm a terrible singer, but I love to do it.",
		"I was raised to honor Chauntea and still do.",
		"The blood sports of the Arena sicken me.",
		"I think non-humans are really interesting.",
		"I exaggerate the tales of my exploits."
	],
	ideal : [
		["Fair",
			"Fair: I think everyone deserves to be treated fairly. I don't play favorites. (Lawful)"
		],
		["Impulsive",
			"Impulsive: Planning is often a waste of time. No plan survives contact with reality. It's easier to dive in and deal with the consequences. (Chaotic)"
		],
		["Curious",
			"Curious: I want to learn as much as I can about the people and places I encounter. (Any)"
		],
		["Prepared",
			"Prepared: I think success depends on preparing as much as possible in advance. (Any)"
		],
		["Respectful",
			"Respectful: I think everyone deserves to be treated with respect and dignity, regardless of their race, creed, color, or origin. (Good)"
		],
		["Corrupt",
			"Corrupt: I will break the law or act dishonestly if the money is right. (Evil)"
		]
	],
	bond : [
		"I am loyal to the Rogues Guild and would do anything for them.",
		"I love the city of Hillsfar and my fellow Hillsfarians, despite the recent problems.",
		"I admire the elves. I help them whenever I can.",
		"A gnome helped me once. I pay the favor forward.",
		"I enjoy tricking the Red Plumes at every opportunity.",
		"I smuggled agricultural goods for non-human farmers. I try to help them when I can."
	],
	flaw : [
		"My hatred for the Red Plumes burns so brightly that I have difficulty suppressing It around them.",
		"The Red Plumes caught me once before, and I was branded for my crime. If they catch me again, for any offense, the punishment will be dire.",
		"I treat all Hillsfarans poorly. I am disgusted with their failure to revolt against the Great Law of Humanity.",
		"I have difficulty trusting strangers. Anyone could be a spy for the authorities.",
		"I am greedy. There Isn't much I won't do for money.",
		"I'm an informant for the Red Plumes. They let me continue my activities, so long as I pass them information about illegal activity in Hillsfar."
	],
	toolProfs : ["Forgery kit"],
	languageProfs : [1],
	lifestyle : "modest"
};
BackgroundList["secret identity"] = {
	regExpSearch : /^(?=.*secret)(?=.*identity).*$/i,
	name : "Secret Identity",
	source : [["AL:RoD", 9], ["ALbackground", 0]],
	skills : ["Deception", "Stealth"],
	gold : 5,
	equipleft : [
		["Disguise kit", "", 3],
		["Forgery kit", "", 5]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Secret Identity",
	trait : [
		"Despite its problems, I love Hillsfar, it's the greatest city in the world. The only one for me.",
		"I move from place to place, never staying anywhere long and leaving nothing behind.",
		"I think flattery is the best way to direct attention away from me.",
		"I don't make friends easily. They're a liability I cannot afford.",
		"Risk and danger are exhilarate me. Pulling off schemes and deceptions is a rush.",
		"The First Lord is right, humans are superior. I really admire them, despite the atrocities.",
		"I avoid people of my own race, as well as things associated with my race, lest they give me away.",
		"I live for the Arena. I admire gladiators and enjoy the thrill of blood on the sands!"
	],
	ideal : [
		["Quisling",
			"Quisling: Supporting the rulers of the land and following the laws is the road to salvation. (Lawful)"
		],
		["Scoflaw",
			"Scoflaw: The laws and lawmakers are corrupt. I follow laws only when it suits me. (Chaotic))"
		],
		["Optimist",
			"Optimist: Everyone Is basically good. Though the government is misguided it will all be okay. (Any)"
		],
		["Secretive",
			"Secretive: I am in the habit of not talking about myself. My business is none of yours. (Any)"
		],
		["Heroic",
			"Heroic: I do everything I can to help non-humans, regardless of the personal cost to me. (Good)"
		],
		["Depraved",
			"Depraved: I have lost my moral compass. The ends justify most any means. (Evil)"
		]
	],
	bond : [
		"The humans of Hillsfar have inflicted terrible harm on me, my family, and my race. I will have revenge.",
		"I am part of an underground network that smuggles non-humans into and out of the city.",
		"I am a partisan. I commit minor acts of defiance against the First Lord and Red Plumes when I can.",
		"I am a spy. I report on events in and around Hillfar.",
		"My secret identity is the only thing protecting me from the Arena. I will stop at nothing to maintain it.",
		"I am madly in love with a human who does not know my true identity, and I fear rejection if I reveal it."
	],
	flaw : [
		"After years of denying who I am, I now despise myself and other members of my pathetic race.",
		"Years of hiding have made me somewhat paranoid. I trust no one.",
		"I've been lying so often and for so long that I can't help it anymore. I frequently lie for no reason at all.",
		"I am ashamed. I failed to protect a member of my family who was seized and thrown into the Area.",
		"I am struggling with maintaining my secret identity. I subconsciously want to get caught and therefore sometimes let my secret identity slip.",
		"Years of successfully deceiving others have made me cocky. I think no one can see through my lies."
	],
	toolProfs : ["Disguise kit", "Forgery kit"],
	lifestyle : "modest"
};
BackgroundList["shade fanatic"] = {
	regExpSearch : /^(?=.*shade)(?=.*fanatic).*$/i,
	name : "Shade Fanatic",
	source : [["AL:RoD", 10], ["ALbackground", 0]],
	skills : ["Deception", "Intimidation"],
	gold : 15,
	equipleft : [
		["Forgery kit", "", 5],
		["Transparent shadow cylinder", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Secret Society",
	trait : [
		"I am a bully; I try to hide it though.",
		"I let my actions speak for themselves",
		"I am important; I will not let anyone forget that.",
		"You are either with me or against me.",
		"I know it is only a time before I am betrayed by those I care for.",
		"I never understand why people get so emotional.",
		"They are out to get me. It is only my cunning that keeps me ahead of them",
		"Everyone has a choice, the one I make is always right though."
	],
	ideal : [
		["Hope",
			"Hope: I know even if I need do evil acts, history will be my redemption. (Chaos)"
		],
		["Dedicated",
			"Dedicated: I can do anything I put my mind to (Lawful)"
		],
		["Exciting",
			"Exciting: I have found the truth of the Shadovar and want to share it with everyone. (Any)"
		],
		["Frugal",
			"Frugal: I horde my possessions knowing that someday I will be called upon to give everything I have to the cause (Any)"
		],
		["Eloquent",
			"Eloquent: I use my words to sway others to my beliefs. (Any)"
		],
		["Compassionate",
			"Compassionate: It is through love that others will join In our cause. (Good)"
		]
	],
	bond : [
		"They say the Shade broke the bonds of mortality; I want to find out how.",
		"The whispers in my head remind me that there is power to be found in the shadows.",
		"For the glory of Netheril, I will grow in power.",
		"I once lived in Hillsfar, I was chased out before I was able to say farewell.",
		"My true love was a killed by the Red Plumes; I plot to make them suffer.",
		"I had a loved one die in the arena at Hillsfar; I am out to prove I am stronger than them!"
	],
	flaw : [
		"I always over exaggerate my abilities.",
		"I cannot bear to let those I care for out of my sight.",
		"I am incapable of standing up for myself.",
		"The group I am with has committed atrocities; I am always worried their actions will become public.",
		"I always enjoy a good mug of ale … or five.",
		"I know what I do is wrong, but am afraid to speak up about it."
	],
	toolProfs : ["Forgery kit"],
	languageProfs : ["Netherese"],
	lifestyle : "moderate"
};
BackgroundList["trade sheriff"] = {
	regExpSearch : /^(?=.*trade)(?=.*sheriff).*$/i,
	name : "Trade Sheriff",
	source : [["AL:RoD", 11], ["ALbackground", 0]],
	skills : ["Investigation", "Persuasion"],
	gold : 17,
	equipleft : [
		["Thieves' tools", "", 1]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Gray cloak", "", ""],
		["Sheriff's insignia", "", ""]
	],
	feature : "Investigative Services",
	trait : [
		"I am always polite and respectful",
		"I let my actions speak for themselves",
		"I am haunted by my past having seen the murder of a close friend or family member and it is the one case I always needed to solve but have not been able to.",
		"I am quick to judge and slow to vindicate",
		"I can be very persuasive and am able to ask questions where others might not be able to.",
		"I have a quirky personality that seems to take others off their guard.",
		"My sense of humor is considered by most to be awkward",
		"Everyone has a choice, and they can always make the right choice, mine!"
	],
	ideal : [
		["Hope",
			"Hope: my job is to speak for the victim (good)"
		],
		["Dedicated",
			"Dedicated: Once I start an investigation, until told to do so, I do not quit, not matter where it leads. (Lawful)"
		],
		["Nation",
			"Nation: My city, nation, or people are all that matter (any)"
		],
		["Mercenary",
			"Mercenary: When I do investigations, I expect answers immediately (Any)"
		],
		["Eloquent",
			"Eloquent: I use my words to sway others to give me answers.(good)"
		],
		["Might",
			"Might: It is through threats and force that I get my answers (lawful)"
		]
	],
	bond : [
		"To this day an unsolved case will always leave me haunted and bother me.",
		"Through the might of my personality I will solve an investigation or puzzle.",
		"It is my right to believe what I will, just try and stop me.",
		"I need to prove my worth to my fellow Sheriffs.",
		"Someone I cared for died under suspicious circumstances. I will find out what happened to them and bring their killer to justice.",
		"I speak for those that cannot speak for themselves."
	],
	flaw : [
		"I always over exaggerate my abilities.",
		"I cannot bear to let those I care for out of my sight.",
		"I took a bribe to tank an investigation and I would do anything to keep it secret.",
		"I have little respect for those that are of \"low\" intelligence/race.",
		"I always enjoy a good mug of ale … or five to cover up my past.",
		"I speak for the First Lord of Hillsfar and make sure everyone knows it."
	],
	toolProfs : [["Thieves' tools", "Dex"]],
	languageProfs : ["Elvish"],
	lifestyle : "moderate"
};

// Background features
BackgroundFeatureList["factor"] = {
	description : "My family has assigned me the services of a loyal retainer from the business. This person can perform mundane tasks for me such as making purchases, delivering messages, and running errands. He or she will not fight for me or follow me into danger, and will leave if frequently endangered or abused. If killed, my family assigns me another within days.",
	source : [["AL:RoD", 7], ["ALbackground", 0]]
};
BackgroundFeatureList["investigative services"] = {
	description : "I have a way of communicating with others that puts them at ease. I can invoke my rank to allow me access to a crime scene or to requisition equipment or horses on a temporary basis. When entering a settlement around Hillsfar, I can identify a contact who will give me information and would help me because I want to stop anyone from disrupting trade.",
	source : [["AL:RoD", 11], ["ALbackground", 0]]
};
BackgroundFeatureList["red plume and mage guild contacts"] = {
	description : "I made friends among the Red Plumes and Mage's Guild when I lived at the Hillsfar Gate. They remember me fondly and help me in little ways when they can. I can invoke their assistance in and around Hillsfar to obtain food, simple equipment for temporary use, and to gain access to the low-security areas of their garrisons, halls, and encampments.",
	source : [["AL:RoD", 6], ["ALbackground", 0]]
};
BackgroundFeatureList["secret identity"] = {
	description : "I have created a secret identity that I use to conceal my true race and that offers a covering explanation for my presence in Hillsfar. In addition, I can forge documents, including official papers and personal letters, as long as I have seen an example of the kind of document or the handwriting I am trying to copy.",
	source : [["AL:RoD", 9], ["ALbackground", 0]]
};
BackgroundFeatureList["secret passage"] = {
	description : "I can call on my smuggler contacts to secure secret passage into or out of Hillsfar for myself and my friends, no questions asked, and no Red Plume entanglements. Because I'm calling in a favor, I can't be certain when or if they can help. In return for passage, my companions and I may owe the Rogue's Guild a favor and/or may have to pay bribes.",
	source : [["AL:RoD", 8], ["ALbackground", 0]]
};
BackgroundFeatureList["secret society"] = {
	description : "I have a special way of communicating with others who feel the same way I do about the Shade. When I enter a village or larger city, I can identify a contact who will give me information on those that would hinder my goals and those would help me simply because of my desire to see the Shade Enclave return in all its glory.",
	source : [["AL:RoD", 10], ["ALbackground", 0]]
};
BackgroundFeatureList["shelter of the elven clergy"] = {
	description : "The clerics of Elventree have vowed to care for the Cormanthor refugees. They will help me when they can, including providing me and my companions with free healing and care at temples, shrines, and other established presences in Elventree. They will also provide me (but only me) with a poor lifestyle.",
	source : [["AL:RoD", 5], ["ALbackground", 0]]
};
BackgroundFeatureList["trade contact"] = {
	description : "My family and I have trade contacts such as caravan masters, sailors, artisans, farmers, and shopkeepers throughout the Moonsea region and all along the Sword Coast. When adventuring in either of those areas, I can use those contacts to get information about the local area or to pass a message to someone in those areas, even across great distance.",
	source : [["AL:RoD", 7], ["ALbackground", 0]]
};

// pub_20150915_OotA.js
// This file adds all the beasts and background features from the Out of the Abyss adventure book to MPMB's Character Record Sheet

// Define the source
SourceList.OotA={
	name : "Out of the Abyss [beasts, background features, items]",
	abbreviation : "OotA",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/outoftheabyss",
	date : "2015/09/15"
};

// Background features
BackgroundFeatureList["deep delver"] = {
	description : "I have a knack for finding my way in the Underdark, recalling all twists and turns with ease, such that I can always retrace my steps underground. I can determine which sources of food and water are safe to consume. I can always find sufficient food and water for myself and up to five other people in the Underdark, if sustenance is available in the area.",
	source : [["OotA", 221], ["ALbackground", 0]]
};
BackgroundFeatureList["underdark experience"] = {
	description : "I'm no casual visitor to the Underdark, but have spent considerable time there learning its ways. I'm familiar with the various races, civilizations, settlements, and travel routes of the Underdark. If I fail an Intelligence check to recall some piece of Underdark lore, I know a source I can consult for the answer unless the DM rules that the lore is unknown.",
	source : [["OotA", 221], ["ALbackground", 0]]
};

// Creatures
CreatureList["cave badger"] = { // contributed by Nod_Hero
	name : "Cave Badger",
	nameAlt : ["Badger, Cave"],
	source : [["OotA", 96]],
	size : 3,
	type : "Beast",
	alignment : "Unaligned",
	ac : 12,
	hp : 13,
	hd : [2, 8],
	speed : "30 ft, burrow 15 ft",
	scores : [13, 10, 15, 2, 12, 5],
	senses : "Darkvision 30 ft, Tremorsense 60 ft; Adv. on Wis (Perception) checks using smell",
	passivePerception : 11,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 6, "piercing"],
		range : "Melee (5 ft)",
		description : "One bite and one claws attack as an Attack action"
	}, {
		name : "Claws",
		ability : 1,
		damage : [2, 4, "slashing"],
		range : "Melee (5 ft)",
		description : "One claws and one bite attack as an Attack action"
	}],
	actions : [{
		name : "Multiattack",
		description : "The badger makes two attacks: one with its bite and one with its claws."
	}],
	traits : [{
		name : "Keen Smell",
		description : "The badger has advantage on Wisdom (Perception) checks that rely on smell."
	}]
};
CreatureList["steeder, female"] = {
	name : "Female Steeder",
	nameAlt : ["Steeder, Female", "Steeder"],
	source : [["OotA", 231]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 14,
	hp : 30,
	hd : [4, 10],
	speed : "30 ft, climb 30 ft",
	scores : [15, 16, 14, 2, 10, 3],
	skills : {
		"stealth" : 7
	},
	senses : "Darkvision 120 ft",
	passivePerception : 10,
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 8, "piercing"],
		range : "Melee (5 ft)",
		description : "Target also takes 2d8 acid damage, half on a DC 12 Constitution saving throw"
	}, {
		name : "Sticky Leg",
		ability : 2,
		damage : ["\u2015", "", "Grappled"],
		range : "Melee (5 ft)",
		description : "Medium or smaller is stuck to the steeder's leg and grappled (escape DC 12); Can't use again until grapple ends",
		abilitytodamage : false
	}],
	traits : [{
		name : "Spider Climb",
		description : "The steeder can climb difficult surfaces, including upside down on ceilings, without needing to make an ability check."
	}, {
		name : "Leap",
		description : "The steeder can expend all its movement on its turn to jump up to 90 ft vertically or horizontally, provided that its speed is at least 30 feet."
	}]
};
CreatureList["steeder, male"] = {
	name : "Male Steeder",
	nameAlt : ["Steeder, Male"],
	source : [["OotA", 231]],
	size : 3,
	type : "Beast",
	alignment : "Unaligned",
	ac : 12,
	hp : 13,
	hd : [2, 8],
	speed : "30 ft, climb 30 ft",
	scores : [15, 12, 14, 2, 10, 3],
	skills : {
		"stealth" : 5
	},
	senses : "Darkvision 120 ft",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 8, "piercing"],
		range : "Melee (5 ft)",
		description : "Target also takes 1d8 acid damage, half on a DC 12 Constitution saving throw"
	}, {
		name : "Sticky Leg",
		ability : 1,
		damage : ["\u2015", "", "Grappled"],
		range : "Melee (5 ft)",
		description : "Small or smaller is stuck to the steeder's leg and grappled (escape DC 12); Can't use again until grapple ends",
		abilitytodamage : false
	}],
	traits : [{
		name : "Spider Climb",
		description : "The steeder can climb difficult surfaces, including upside down on ceilings, without needing to make an ability check."
	}, {
		name : "Leap",
		description : "The steeder can expend all its movement on its turn to jump up to 60 ft vertically or horizontally, provided that its speed is at least 30 feet."
	}]
};

// Magic Items
MagicItemsList["dawnbringer"] = {
	name : "Dawnbringer",
	source : [["OotA", 222]],
	type : "weapon (longsword)",
	rarity : "legendary",
	storyItemAL : true,
	prerequisite : "Requires attunement by a creature of non-evil alignment",
	prereqeval : function(v) { return !(/evil/i).test(What("Alignment")); },
	description : "As a bonus action, I can have this hilt create a blade of radiance. It acts like a longsword that does +2 to attack and damage rolls, radiant damage (+1d8 to undead), has finesse, emits bright sunlight in a 15-ft radius and dim light in another 15 ft. I can use it to cast Lesser Restoration and it is sentient, see Notes page.",
	descriptionLong : "As a bonus action, I can have this longsword hilt create or dismiss a blade of pure radiance. It acts like a longsword that grants a +2 bonus to attack and damage rolls, does radiant damage and has the finesse property. It deals +1d8 radiant damage to undead and emits sunlight, bright light in a 15-ft radius and dim light in an additional 15ft. As an action, I can expand or reduce both the bright and dim light's radius by 5 ft each, to a maximum of 30 feet each or a minimum of 10 feet each. Once per dawn, I can use it to cast Lesser Restoration. Also, it is sentient, see Notes page.",
	descriptionFull : "Lost for ages in the Underdark, Dawnbringer appears to be a gilded longsword hilt. While grasping the hilt, you can use a bonus action to make a blade of pure radiance spring from the hilt, or cause the blade to disappear. While the blade exists, this magic longsword has the finesse property. If you are proficient with shortswords or longswords, you are proficient with Dawnbringer.\n   You gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When you hit an undead with it, that target takes an extra 1d8 radiant damage.\n   The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 feet. The light is sunlight. While the blade persists, you can use an action to expand or reduce its radius of bright and dim light by 5 feet each, to a maximum of 30 feet each or a minimum of 10 feet each.\n   While holding the weapon, you can use an action to touch a creature with the blade and cast Lesser Restoration on that creature. Once used, this ability can't be used again until the next dawn.\n   " + toUni("Sentience") + ". Dawnbringer is a sentient neutral good weapon with an Intelligence of 12, a Wisdom of 15, and a Charisma of 14. It has hearing and darkvision out to a range of 120 feet.\n   The sword can speak, read, and understand Common, and it can communicate with its wielder telepathically. Its voice is kind and feminine. It knows every language you know while attuned to it.\n   " + toUni("Personality") + ". Forged by ancient sun worshippers, Dawnbringer is meant to bring light into darkness and to fight creatures of darkness. It is kind and compassionate to those in need, but fierce and destructive to its enemies.\n   Long years lost in darkness have made Dawnbringer frightened of both the dark and abandonment. It prefers that its blade always be present and shedding light in areas of darkness, and it strongly resists being parted from its wielder for any length of time." +
	// Addition from Adventurers League Content Catalogue 8.07
	"\n   If an evil creature attempts to attune to the weapon, it not only finds it impossible, but Dawnbringer attempts to take control of its wielder (DC 14 Charisma saving throw). If the weapon is successful, it insists on being taken to the surface or willingly given to the first creature it comes across that is not a member of a race indigenous to the Underdark. Dawnbringer will not allow its relinquishment to a creature that it or its wielder knows is evil, and instead compels its wielder to find a new recipient.",
	attunement : true,
	weight : 3,
	action : [["bonus action", " (start/stop)"], ["action", " (change light)"]],
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /dawnbringer/i,
		name : "Dawnbringer",
		source : [["OotA", 222]],
		damage : [1, 8, "radiant"],
		description : "Finesse, versatile (1d10); +1d8 damage to undead",
		modifiers : [2, 2],
		selectNow : true
	}],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.name == "Dawnbringer" && !fields.Proficiency) {
					fields.Proficiency = CurrentProfs.weapon.otherWea && CurrentProfs.weapon.otherWea.finalProfs.indexOf("shortsword") !== -1;
				}
			}, ''
		]
	},
	usages : 1,
	recovery : "dawn",
	additional : "Lesser Restoration",
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["lesser restoration"],
		selection : ["lesser restoration"],
		firstCol : "oncelr"
	},
	toNotesPage : [{
		name : "Features",
		note : desc([
			"Lost for ages in the Underdark, Dawnbringer appears to be a gilded longsword hilt. While grasping the hilt, I can use a bonus action to make a blade of pure radiance spring from the hilt, or cause the blade to disappear. While the blade exists, it functions as a magic longsword that has the finesse property. I'm proficient with it if I'm proficient with either shortswords or longswords.",
			"I gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When I hit an undead with it, that target takes an extra 1d8 radiant damage.",
			"The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 ft. The light is sunlight. As an action while the blade persists, I can expand or reduce its radius of bright and dim light by 5 ft each, to a maximum of 30 ft each or a minimum of 10 ft each.",
			"As an action while holding the weapon, I can touch a creature with the blade and cast Lesser Restoration on that creature. Once used, this ability can't be used again until the next dawn.",
			"Dawnbringer is a sentient neutral good weapon with an Intelligence of 12, a Wisdom of 15, and a Charisma of 14. It has hearing and darkvision out to a range of 120 feet. The sword can speak, read, and understand Common, and it can communicate with its wielder telepathically. Its voice is kind and feminine. It knows every language you know while attuned to it.",
			"Forged by ancient sun worshippers, Dawnbringer is meant to bring light into darkness and to fight creatures of darkness. It is kind and compassionate to those in need, but fierce and destructive to its enemies. Long years lost in darkness have made Dawnbringer frightened of both the dark and abandonment. It prefers that its blade always be present and shedding light in areas of darkness, and it strongly resists being parted from its wielder for any length of time."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["piwafwi (cloak of elvenkind)"] = {
	name : "Piwafwi",
	source : [["OotA", 222]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "While I wear this dark spider-silk cloak with its hood up, Wisdom (Perception) checks made to see me have disadv., and I have adv. on Dex (Stealth) checks made to hide, as its color shifts to camouflage me. Pulling the hood up or down requires an action. It loses its magic if exposed to sunlight for 1 uninterrupted hour.",
	descriptionFull : "This dark spider-silk cloak is made by drow. It is a cloak of elvenkind. It loses its magic if exposed to sunlight for 1 hour without interruption.\n   While you wear this cloak with its hood up, Wisdom (Perception) checks made to see you have disadvantage. and you have advantage on Dexterity (Stealth) checks made to hide, as the cloak's color shifts to camouflage you. Pulling the hood up or down requires an action.",
	attunement : true,
	action : [["action", " (hood up/down)"]],
	eval : function () {
		if (CurrentMagicItems.known.indexOf("boots of elvenkind") !== -1) {
			SetProf("advantage", true, ["Stealth", true], "Cloak and Boots of Elvenkind (magic items)");
		}
	},
	removeeval : function () {
		SetProf("advantage", false, ["Stealth", true], "Cloak and Boots of Elvenkind (magic items)");
	}
}
MagicItemsList["piwafwi of fire resistance (cloak of elvenkind)"] = {
	name : "Piwafwi of Fire Resistance",
	source : [["OotA", 222]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "While I wear this dark spider-silk cloak with its hood up, Wisdom (Perception) checks made to see me have disadv., and I get adv. on Dex (Stealth) checks made to hide. Pulling the hood up or down requires an action. It also grants me fire resistance. It loses its magic if exposed to sunlight for 1 hour without interruption.",
	descriptionFull : "This dark spider-silk cloak is made by drow. It is a cloak of elvenkind. It also grants resistance to fire damage while you wear it. It loses its magic if exposed to sunlight for 1 hour without interruption.\n   While you wear this cloak with its hood up, Wisdom (Perception) checks made to see you have disadvantage. and you have advantage on Dexterity (Stealth) checks made to hide, as the cloak's color shifts to camouflage you. Pulling the hood up or down requires an action.",
	attunement : true,
	dmgres : ["Fire"],
	action : [["action", " (hood up/down)"]],
	eval : function () {
		if (CurrentMagicItems.known.indexOf("boots of elvenkind") !== -1) {
			SetProf("advantage", true, ["Stealth", true], "Cloak and Boots of Elvenkind (magic items)");
		}
	},
	removeeval : function () {
		SetProf("advantage", false, ["Stealth", true], "Cloak and Boots of Elvenkind (magic items)");
	}
}
MagicItemsList["spell gem"] = { // not legal in AL
	name : "Spell Gem",
	source : [["OotA", 223]],
	type : "wondrous item",
	notLegalAL : true,
	description : "This gem can store 1 spell in it. If it is empty, I can cast a spell as normal, but have it stored in the gem. As an action, I can cast a stored spell from it, if that spell is on my class' spell list.",
	descriptionFull : "A spell gem can contain one spell from any class's spell list. You become aware of the spell when you learn the gem's properties. While holding the gem, you can cast the spell from it as an action if you know the spell or if the spell is on your class's spell list. Doing so doesn't require any components, and doesn't require attunement. The spell then disappears from the gem.\n   If the spell is of a higher level than you can normally cast, you must make an ability check using your spellcasting ability to determine whether you cast it successfully. The DC equals 10 + the spell's level. On a failed check, the spell disappears from the gem with no other effect\n   Each spell gem has a maximum level for the spell it can store. The spell level determines the gem's rarity, the stored spell's saving throw DC, and attack bonus, as shown in the table below.\n   You can imbue the gem with a spell if you're attuned to it and it's empty. To do so, you cast the spell while holding the gem. The spell is stored in the gem instead of having any effect. Casting the spell must require either 1 action or 1 minute or longer, and the spell's level must be no higher than the gem's maximum. If the spell belongs to the school of abjuration and requires material components that are consumed, you must provide them, but they can be worth half as much as normal.\n   Once imbued with a spell, the gem can't be imbued again until the next dawn.\n   Deep gnomes created these magic gemstones and keep the creation process a secret.\n\n" + [
		toUni("Level\tStone\t\tRarity\t\tDC/Atk"),
		"Cantrip\tObsidian\t\tUncommon\t13/+5",
		"1st\tLapis Lazuli\tUncommon\t13/+5",
		"2nd\tQuartz\t\tRare\t\t13/+5",
		"3rd\tBloodstone\tRare\t\t15/+7",
		"4th\tAmber\t\tVery Rare   \t15/+9",
		"5th\tJade\t\tVery Rare   \t17/+9",
		"6th\tTopaz\t\tVery Rare   \t17/+10",
		"7th\tStar Ruby  \tLegendary \t18/+10",
		"8th\tRuby\t\tLegendary \t18/+10",
		"9th\tDiamond\t\tLegendary \t19/+11"
	].join("\n"),
	attunement : true,
	allowDuplicates : true,
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if ((/spell gem/i).test(spName) && spellObj.time != "1 a") {
					spellObj.time = "1 a";
					return true;
				}
			},
			"Spells cast into a Spell Gem can only have a casting time of either 1 action or 1 minute or longer.\n \u2022 Spells cast from a Spell Gem always require 1 action to cast."
		],
		spellList : [
			function(spList, spName, spType) {
				// only continue for spell gems
				if (!(/spell gem/i).test(CurrentSpells[spName].name)) return;
				// create the notspells array if it didn't already exist
				if (!spList.notspells) spList.notspells = [];
				// now add all the spells of this spell gem's level that have a casting time of 1 reaction or 1 bonus action
				for (var spell in SpellsList) {
					var aSp = SpellsList[spell];
					if (aSp.level <= spList.level[1] && aSp.time && (/1 (rea|bns)/i).test(aSp.time)) spList.notspells.push(spell);
				}
			}, ""
		]
	},
	toNotesPage : [{
		name : "Storing Spells",
		page3notes : true,
		note : [
			"Casting a spell stored from a spell gem doesn't require attunement",
			"Only spells with a casting time of 1 action or 1 min or more can be stored in a spell gem",
			"Imbuing a spell gem requires casting a spell as normal, but the spell produces no effect",
			"I only need to provide half the costly material components for abjuration spells to imbue"
		]
	}],
	choices : ["Obsidian (cantrip, uncommon)", "Lapis Lazuli (1st-level, uncommon)", "Quartz (2nd-level, rare)", "Bloodstone (3rd-level, rare)", "Amber (4th-level, very rare)", "Jade (5th-level, very rare)", "Topaz (6th-level, very rare)", "Star Ruby (7th-level, legendary)", "Ruby (8th-level, legendary)", "Diamond (9th-level, legendary)"],
	"obsidian (cantrip, uncommon)" : {
		name : "Spell Gem [Obsidian]",
		sortname : "Spell Gem  (cantrip) [Obsidian]",
		rarity : "uncommon",
		description : "This gem can store one cantrip. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 13 and +5 spell attack.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,0],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"lapis lazuli (1st-level, uncommon)" : {
		name : "Spell Gem [Lapis Lazuli]",
		sortname : "Spell Gem (1st-level) [Lapis Lazuli]",
		rarity : "uncommon",
		description : "This gem can store one spell up to 1st-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 13 and +5 spell attack. If the spell's level is higher than I can cast, I need to make a DC 11 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,1],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"quartz (2nd-level, rare)" : {
		name : "Spell Gem [Quartz]",
		sortname : "Spell Gem (2nd-level) [Quartz]",
		rarity : "rare",
		description : "This gem can store one spell up to 2nd-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 13 and +5 spell attack. If the spell's level is higher than I can cast, I need to make a DC 12 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,2],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"bloodstone (3rd-level, rare)" : {
		name : "Spell Gem [Bloodstone]",
		sortname : "Spell Gem (3rd-level) [Bloodstone]",
		rarity : "rare",
		description : "This gem can store one spell up to 3rd-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 15 and +7 spell attack. If the spell's level is higher than I can cast, I need to make a DC 13 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 15,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,3],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"amber (4th-level, very rare)" : {
		name : "Spell Gem [Amber]",
		sortname : "Spell Gem (4th-level) [Amber]",
		rarity : "very rare",
		description : "This gem can store one spell up to 4th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 15 and +9 spell attack. If the spell's level is higher than I can cast, I need to make a DC 14 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 15,
		fixedSpAttack : 9,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,4],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"jade (5th-level, very rare)" : {
		name : "Spell Gem [Jade]",
		sortname : "Spell Gem (5th-level) [Jade]",
		rarity : "very rare",
		description : "This gem can store one spell up to 5th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 17 and +9 spell attack. If the spell's level is higher than I can cast, I need to make a DC 15 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 17,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,5],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"topaz (6th-level, very rare)" : {
		name : "Spell Gem [Topaz]",
		sortname : "Spell Gem (6th-level) [Topaz]",
		rarity : "very rare",
		description : "This gem can store one spell up to 6th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 17, +10 spell attack. If the spell's level is higher than I can cast, I need to make a DC 16 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 17,
		fixedSpAttack : 10,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,6],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"star ruby (7th-level, legendary)" : {
		name : "Spell Gem [Star Ruby]",
		sortname : "Spell Gem (7th-level) [Star Ruby]",
		rarity : "legendary",
		description : "This gem can store one spell up to 7th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 18, +10 spell attack. If the spell's level is higher than I can cast, I need to make a DC 17 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 18,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,7],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"ruby (8th-level, legendary)" : {
		name : "Spell Gem [Ruby]",
		sortname : "Spell Gem (8th-level) [Ruby]",
		rarity : "legendary",
		description : "This gem can store one spell up to 8th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 18, +10 spell attack. If the spell's level is higher than I can cast, I need to make a DC 18 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 18,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,8],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	},
	"diamond (9th-level, legendary)" : {
		name : "Spell Gem [Diamond]",
		sortname : "Spell Gem (9th-level) [Diamond]",
		rarity : "legendary",
		description : "This gem can store one spell up to 9th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 19, +11 spell attack. If the spell's level is higher than I can cast, I need to make a DC 19 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 19,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,9],
			psionic : false,
			firstCol : "checkbox",
			times : 20
		}
	}
}
MagicItemsList["stonespeaker crystal"] = {
	name : "Stonespeaker Crystal",
	source : [["OotA", 223]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This crystal has 10 charges, regaining 1d6+4 at dawn, which I can use to cast its spells. When I use its last charge, roll a d20. On a 1, it vanishes. It gives me adv. on Int (Investigation) checks. When I cast an abjuration spell, I can expend 1 charge per level of the spell to substitute one material component of the spell.",
	descriptionFull : "Created by the stone giant librarians of Gravenhollow, this nineteen-inch-long shard of quartz grants you advantage on Intelligence (Investigation) checks while it is on your person.\n   The crystal has 10 charges. While holding it, you can use an action to expend some of its charges to cast one of the following spells from it: Speak with Animals (2 charges), Speak with Dead (4 charges), or Speak with Plants (3 charges).\n   When you cast a Divination spell, you can use the crystal in place of one material component that would normally be consumed by the spell, at a cost of 1 charge per level of the spell. The crystal is not consumed when used in this way.\n   The crystal regains 1d6+4 expended charges daily at dawn. If you expend the crystal's last charge, roll a d20. On a 1, the crystal vanishes, lost forever.",
	attunement : true,
	weight : 1,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["speak with animals"],
		selection : ["speak with animals"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["speak with plants"],
		selection : ["speak with plants"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["speak with dead"],
		selection : ["speak with dead"],
		firstCol : 4
	}],
	advantages : [["Investigation", true]]
}
MagicItemsList["wand of viscid globs"] = {
	name : "Wand of Viscid Globs",
	source : [["OotA", 223]],
	type : "wand",
	rarity : "rare",
	attunement : true,
	magicItemTable : "G",
	description : "This black wand has 7 charges, regaining 1d6+1 at midnight. If its last charge is used, roll a d20. On a 1, it melts. As an action, I can expend 1 charge to make a ranged attack roll on a target in 60 ft (with my spellcasting ability). On a hit, it is restrained for 1 hour. The wand is destroyed if exposed to sunlight for 1 hour.",
	descriptionFull : "Crafted by the drow, this slim black wand has 7 charges. While holding it, you can use an action to expend 1 of its charges to cause a small glob of viscous material to launch from the tip at one creature within 60 feet of you. Make a ranged attack roll against the target, with a bonus equal to your spellcasting modifier (or your Intelligence modifier, if you don't have a spellcasting modifier) plus your proficiency bonus. On a hit, the glob expands and dries on the target, which is restrained for 1 hour. After that time, the viscous material cracks and falls away.\n   Applying a pint or more of alcohol to the restrained creature dissolves the glob instantly, as does the application of oil of etherealness or universal solvent. The glob also dissolves instantly if exposed to sunlight. No other nonmagical process can remove the viscous material until it deteriorates on its own.\n   The wand regains 1d6+1 expended charges daily at midnight. If you expend the wands last charge, roll a d20. On a 1, the wand melts into harmless slime and is destroyed.\n   A wand of viscous globs is destroyed if exposed to sunlight for 1 hour without interruption.",
	weight : 1,
	usages : 7,
	recovery : "Midnight",
	additional : "regains 1d6+1",
	action : [["action", ""]],
	weaponOptions : [{
		regExpSearch : /^(?=.*wand)(?=.*viscid)(?=.*globs).*$/i,
		name : "Wand of Viscid Globs",
		source : [["OotA", 223]],
		ability : 4,
		type : "Spell",
		damage : ["\u2015", "", "Restrained"],
		range : "60 ft",
		description : "1 charge; Lasts 1 hour or until exposed to sunlight, a pint of alcohol, oil of etherealness, or universal solvent",
		abilitytodamage : false,
		useSpellcastingAbility : true,
		selectNow : true
	}]
}

// pub_20151103_SCAG.js
// This file adds all the player-material from Sword Coast Adventure Guide to MPMB's Character Record Sheet

// Define the source
SourceList.S={
	name : "Sword Coast Adventure Guide",
	abbreviation : "SCAG",
	group : "Campaign Sourcebooks",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/sword-coast-adventurers-guide",
	date : "2015/11/03"
};

// Races
RaceList["ghostwise halfling"] = {
	regExpSearch : /^(?=.*\b(halflings?|hobbits?)\b)(?=.*ghostwise).*$/i,
	name : "Ghostwise halfling",
	sortname : "Halfling, Ghostwise",
	plural : "Ghostwise halflings",
	source : [["S", 110]],
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened"] },
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Ghostwise Halfling (+2 Dexterity, +1 Wisdom)" + (typePF ? "\n" : " ") + "\nLucky: When I roll a 1 on an attack roll, ability check, or saving throw, I can reroll the die and must use the new roll." + (typePF ? "\n" : " ") + "\nHalfling Nimbleness: I can move through the space of any creature that is of a size larger than me." + (typePF ? "\n" : " ") + "\nSilent Speech: I can speak telepathically to any one creature within 30 feet of me. It only understands me if we share a language."
};
RaceList["gray dwarf"] = {
	regExpSearch : /^((?=.*\bduergars?\b)|((?=.*\b(dwarfs?|dwarves|dwarfish|dwarvish|dwarven)\b)(?=.*\b(grey|gray|underdark)\b))).*$/i,
	name : "Duergar",
	sortname : "Dwarf, Gray (Duergar)",
	source : [["S", 104], ["MToF", 81]],
	plural : "Duergar",
	size : 3,
	speed : {
		walk : { spd : 25, enc : 25 }
	},
	languageProfs : ["Common", "Dwarvish", "Undercommon"],
	vision : [["Darkvision", 120], ["Sunlight Sensitivity", 0]],
	savetxt : { adv_vs : ["charmed", "illusions", "paralyzed", "poison"] },
	dmgres : ["Poison"],
	weaponProfs : [false, false, ["battleaxe", "handaxe", "warhammer", "light hammer"]],
	toolProfs : [["Smith, brewer, or mason tools", 1]],
	age : " are considered young until they are 50 and live about 350 years",
	height : " stand between 4 and 5 feet tall (3'8\" + 2d4\")",
	weight : " weigh around 150 lb (115 + 2d4 \xD7 2d6 lb)",
	heightMetric : " stand between 1,2 and 1,5 metres tall (110 + 5d4 cm)",
	weightMetric : " weigh around 70 kg (55 + 5d4 \xD7 4d6 / 10 kg)",
	scores : [1, 0, 2, 0, 0, 0],
	trait : "Duergar (+2 Constitution, +1 Strength)\nStonecunning: Whenever I make an Int (History) check related to the origin of stonework, I am considered proficient in the skill and add double my proficiency bonus to the check.\nSunlight Sensitivity: Disadvantage on attack rolls and Wisdom (Perception) checks that rely on sight when I or what I am trying to attack/perceive is in direct sunlight.\nDuergar Magic: 3rd: Enlarge/Reduce to enlarge; 5th: Invisibility. If not in direct sunlight," + (!typePF ? "\n" : " ") + "I can cast both spells on myself once per long rest without material components, using Int.",
	spellcastingAbility : 4,
	features : {
		"enlarge" : {
			name : "Duergar Magic (level 3)",
			limfeaname : "Enlarge (self only)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Duergar Magic (level 3)",
				spells : ["enlarge/reduce"],
				selection : ["enlarge/reduce"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"enlarge/reduce" : {
					name : "Enlarge",
					range : "Self",
					components : "V,S",
					compMaterial : "",
					description : "I'm enlarged, adv. on Str checks/aves and +1d4 on weapon dmg; Can't cast this in direct sunlight",
					changes : "Using Duergar Magic, I cast Enlarge/Reduce while I'm not in direct sunlight, but only to enlarge myself."
				}
			}
		},
		"invisibility" : {
			name : "Duergar Magic (level 5)",
			limfeaname : "Invisibility (self only)",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Duergar Magic (level 5)",
				spells : ["invisibility"],
				selection : ["invisibility"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"invisibility" : {
					range : "Self",
					components : "V,S",
					compMaterial : "",
					description : "Me and my worn/carried invisible until I attack or cast; Can't cast this spell in direct sunlight",
					changes : "Using Duergar Magic, I can cast Invisibility while I'm not in direct sunlight, but only on myself."
				}
			}
		}
	}
};
// Racial variants
AddRacialVariant("half-elf", "aquatic", {
	regExpSearch : /aquatic/i,
	name : "Half-aquatic elf",
	source : [["S", 116]],
	plural : "Half-aquatic elves",
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	skillstxt : "",
	trait : "Half-Aquatic Elf (+2 Charisma and +1 to two other ability scores of my choice)\n\nSwimming Speed:\n   My aquatic heritage gives me a swimming speed of 30 feet."
});
AddRacialVariant("half-elf", "cantrip", {
	regExpSearch : /cantrip/i,
	name : "Half-high elf",
	source : [["S", 116]],
	plural : "Half-high elves",
	skillstxt : "",
	trait : "Half-High Elf (+2 Charisma and +1 to two other ability scores of my choice)\n\nCantrip:\n   I know one cantrip of my choice from the wizard spell list.\n   Intelligence is my spellcasting ability for it.",
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "High Elf Cantrip",
		"class" : "wizard",
		level : [0, 0],
		firstCol : 'atwill'
	}
});
AddRacialVariant("half-elf", "drow magic", {
	regExpSearch : /^(?=.*drow)(?=.*magic).*$/i,
	name : "Half-drow",
	source : [["S", 116]],
	plural : "Half-drow",
	skillstxt : "",
	trait : "Half-drow (+2 Charisma and +1 to two other ability scores of my choice)\n\nDrow Magic:\n   I know the Dancing Lights cantrip.\n   Once I reach 3rd level, I can cast the Faerie Fire spell once per long rest.\n   Once I reach 5th level, I can also cast the Darkness spell once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Drow Magic (level 1)",
		spells : ["dancing lights"],
		selection : ["dancing lights"],
		firstCol : 'atwill'
	},
	features : {
		"faerie fire" : {
			name : "Drow Magic (level 3)",
			limfeaname : "Faerie Fire",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Drow Magic (level 3)",
				spells : ["faerie fire"],
				selection : ["faerie fire"],
				firstCol : 'oncelr'
			}
		},
		"darkness" : {
			name : "Drow Magic (level 5)",
			limfeaname : "Darkness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Drow Magic (level 5)",
				spells : ["darkness"],
				selection : ["darkness"],
				firstCol : 'oncelr'
			}
		}
	}
});
AddRacialVariant("half-elf", "elf weapon training", {
	regExpSearch : /^(?=.*\b(elf|elven)\b)(?=.*weapon)(?=.*training).*$/i,
	source : [["S", 116]],
	skillstxt : "",
	trait : "Half-Elf (+2 Charisma and +1 to two other ability scores of my choice)",
	weaponProfs : [false, false, ["longsword", "shortsword", "longbow", "shortbow"]]
});
AddRacialVariant("half-elf", "fleet of foot", {
	regExpSearch : /^(?=.*fleet)(?=.*\b(foot|feet)\b).*$/i,
	name : "Half-wood elf",
	source : [["S", 116]],
	plural : "Half-wood elves",
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	skillstxt : "",
	trait : "Half-Wood Elf (+2 Charisma and +1 to two other ability scores of my choice)"
});
AddRacialVariant("half-elf", "mask of the wild", {
	regExpSearch : /^(?=.*\bmasks?\b)(?=.*\bwilds?\b).*$/i,
	name : "Half-wood elf",
	source : [["S", 116]],
	plural : "Half-wood elves",
	skillstxt : "",
	trait : "Half-Wood Elf (+2 Charisma and +1 to two other ability scores of my choice)\n\nMask of the Wild:\n   I can attempt to hide even when I am only lightly obscured by foliage, heavy rain, falling snow, mist, and other natural phenomena."
});
AddRacialVariant("tiefling", "devil's tongue", {
	regExpSearch : /^(?=.*devil)(?=.*tongue).*$/i,
	name : "Devil's tongue tiefling",
	source : [["S", 118]],
	plural : "Devil's tongue tieflings",
	trait : "Devil's Tongue Tiefling (+1 Intelligence, +2 Charisma)\n\nDevil's Tongue:\n   I know the Vicious Mockery cantrip.\n   At 3rd level, I can cast the Charm Person spell once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast the Enthrall spell once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingBonus : {
		name : "Devil's Tongue (level 1)",
		spells : ["vicious mockery"],
		selection : ["vicious mockery"],
		firstCol : 'atwill'
	},
	features : {
		"charm person" : {
			name : "Devil's Tongue (level 3)",
			limfeaname : "Charm Person (2 targets)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Devil's Tongue (level 3)",
				spells : ["charm person"],
				selection : ["charm person"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"charm person" : {
					description : "2 humanoids, max 30 ft apart, save or charmed; advantage on save if I or my allies are fighting it",
					changes : "Using Devil's Tongue, I cast Charm Person as if I'm using a 2nd-level spell slot, affecting 2 humanoids."
				}
			}
		},
		"enthrall" : {
			name : "Devil's Tongue (level 5)",
			limfeaname : "Enthrall",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Devil's Tongue (level 5)",
				spells : ["enthrall"],
				selection : ["enthrall"],
				firstCol : 'oncelr'
			}
		}
	}
});
AddRacialVariant("tiefling", "hellfire", {
	regExpSearch : /hellfire/i,
	name : "Hellfire tiefling",
	source : [["S", 118]],
	plural : "Hellfire tieflings",
	trait : "Hellfire Tiefling (+1 Intelligence, +2 Charisma)\n\nInfernal Legacy (Hellfire):\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast the Burning Hands spell once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast the Darkness spell once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	features : {
		"burning hands" : {
			name : "Hellfire Legacy (level 3)",
			limfeaname : "Burning Hands (4d6)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Hellfire Legacy (level 3)",
				spells : ["burning hands"],
				selection : ["burning hands"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"burning hands" : {
					description : "4d6 Fire damage; save halves; unattended flammable objects ignite",
					changes : "Using Hellfire Legacy, I cast Burning Hands as if I'm using a 2nd-level spell slot, doing 4d6 Fire damage."
				}
			}
		},
		"darkness" : {
			name : "Hellfire Legacy (level 5)",
			limfeaname : "Darkness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Infernal Legacy (level 5)",
				spells : ["darkness"],
				selection : ["darkness"],
				firstCol : 'oncelr'
			}
		}
	}
});
AddRacialVariant("tiefling", "winged", {
	regExpSearch : /wing/i,
	name : "Winged tiefling",
	source : [["S", 118]],
	plural : "Winged tieflings",
	speed : {
		walk : { spd : 30, enc : 20 },
		fly : { spd : 30, enc : 0 }
	},
	trait : "Winged Tiefling (+1 Intelligence, +2 Charisma)\n\nWings:\n   I have bat-like wings sprouting from my shoulder blades that give me flying speed of 30 ft when I'm not wearing heavy armor.",
	features : "",
	spellcastingAbility : "",
	spellcastingBonus : ""
});
RunFunctionAtEnd(function() {
	if (!RaceList.tiefling) return;
	var tRace = {
		objname : "feral tiefling",
		replaceTraitTxt : ["+1 Intelligence, +2 Charisma", "+2 Dexterity, +1 Intelligence"],
		replaceNameTxt : ["tiefling", "feral tiefling"],
		regExpSearch : /^(?=.*feral)((?=.*tiefling)|(?=.*planetouched)(?=.*(hell|abyss|fiend|devil))).*$/i,
		name : "Feral tiefling",
		sortname : "Tiefling, Feral",
		source : [["S", 118]],
		plural : "Feral tieflings",
		scores : [0, 2, 0, 1, 0, 0],
		trait : "Feral Tiefling (+2 Dexterity, +1 Intelligence)\n\nInfernal Legacy:\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast the Hellish Rebuke spell once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast the Darkness spell once per long rest.\n   Charisma is my spellcasting ability for these spells."
	};
	// Create the RaceList entry
	RaceList[tRace.objname] = newObj(RaceList.tiefling);
	for (var rFea in tRace) {
		if ((/objname|replaceTraitTxt|replaceNameTxt/).test(rFea)) continue;
		RaceList[tRace.objname][rFea] = tRace[rFea];
	};
	// Create feral tiefling variants
	RaceList[tRace.objname].variants.forEach( function(nVar) {
		RaceSubList[tRace.objname + "-" + nVar] = newObj(RaceSubList["tiefling-" + nVar]);
		var thisVar = RaceSubList[tRace.objname + "-" + nVar];
		thisVar.trait = thisVar.trait.replace(tRace.replaceTraitTxt[0], tRace.replaceTraitTxt[1]);
		thisVar.trait = thisVar.trait.replace(tRace.replaceNameTxt[0].capitalize(), tRace.replaceNameTxt[1].capitalize());
		thisVar.name = thisVar.name.replace(tRace.replaceNameTxt[0], tRace.replaceNameTxt[1]);
		thisVar.plural = thisVar.plural.replace(tRace.replaceNameTxt[0], tRace.replaceNameTxt[1]);
	});
});

// Subclasses
AddSubClass("barbarian", "battlerager", {
	regExpSearch : /(battlerager|kuldjargh)/i,
	subname : "Path of the Battlerager",
	fullname : "Battlerager",
	source : [["S", 121]],
	abilitySave : 6,
	features : {
		"subclassfeature3" : {
			name : "Battlerager Armor",
			source : [["S", 121]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with spiked armor both as an armor and as a weapon",
				"As a bonus action while raging, I can attack once with my armor spikes",
				"With my spiked armor I do 3 piercing damage when I use my Attack action to grapple"
			]),
			action : ["bonus action", "Armor Spikes attack (in rage)"],
			armorOptions : [{
				regExpSearch : /^(?!.*(dragon|draconic|beast))(?=.*spike(d|s))(?=.*armou?r).*$/i,
				name : "Spiked armor",
				source : [["S", 121]],
				type : "medium",
				ac : 14,
				stealthdis : true,
				weight : 45
			}],
			weaponOptions : [{
				regExpSearch : /^(?=.*armou?r)(?=.*spike).*$/i,
				name : "Armor spikes",
				source : [["S", 121]],
				ability : 1,
				type : "armor spikes",
				damage : [1, 4, "piercing"],
				range : "Melee",
				description : "Does 3 piercing damage when grappling during my Attack action",
				abilitytodamage : true,
				selectNow : true
			}],
			weaponProfs : [false, false, ["armor spikes"]],
			eval : function() {
				AddString('Proficiency Armor Other Description', 'Spiked Armor', ', ');
			},
			removeeval : function () {
				RemoveString('Proficiency Armor Other Description', 'Spiked Armor');
			}
		},
		"subclassfeature6" : {
			name : "Reckless Abandon",
			source : [["S", 121]],
			minlevel : 6,
			description : "\n   " + "If I use Reckless Attack during rage, I also gain temporary HP equal to my Con mod"
		},
		"subclassfeature10" : {
			name : "Battlerager Charge",
			source : [["S", 121]],
			minlevel : 10,
			description : "\n   " + "As a bonus action while raging, I can use the Dash action",
			action : ["bonus action", " (in rage)"]
		},
		"subclassfeature14" : {
			name : "Spiked Retribution",
			source : [["S", 121]],
			minlevel : 14,
			description : "\n   " + "When I'm hit in melee by an attacker within 5 ft, it takes 3 piercing damage" + "\n   " + "This only works while I'm wearing spiked armor, in rage, and I'm not incapacitated"
		}
	}
});
AddSubClass("cleric", "arcana domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(arcana|magic|wizardry)).*$/i,
	subname : "Arcana Domain",
	source : [["S", 125]],
	spellcastingExtra : ["detect magic", "magic missile", "magic weapon", "nystul's magic aura", "dispel magic", "magic circle", "arcane eye", "leomund's secret chest", "planar binding", "teleportation circle"],
	features : {
		"subclassfeature1" : {
			name : "Arcane Initiate",
			source : [["S", 125]],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with Arcana and two wizard cantrips that count as cleric cantrips",
			skills : ["Arcana"],
			spellcastingBonus : {
				name : "Arcane Initiate",
				"class" : "wizard",
				level : [0, 0],
				times : 2
			}
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Arcane Abjuration",
			source : [["S", 125]],
			minlevel : 2,
			description : "\n   " + "As an action, one celestial, elemental, fey, or fiend within 30 ft must make a Wis save" + "\n   " + "If it fails and is able to see/hear me, it is turned for 1 min or until it takes damage" + "\n   " + "Turned: move away, never within 30 ft of me, no reactions or actions other than Dash" + "\n   " + "Turned: may Dodge instead of Dash when nowhere to move and unable to escape bonds" + "\n   " + "If its CR is low enough and it is not on its home plane, it is banished for 1 min instead" + "\n   " + "Banished: sent to home plane, reappearing where it was if the effect ends before 1 min",
			additional : ["", "", "", "", "CR 1/2 or lower", "CR 1/2 or lower", "CR 1/2 or lower", "CR 1 or lower", "CR 1 or lower", "CR 1 or lower", "CR 2 or lower", "CR 2 or lower", "CR 2 or lower", "CR 3 or lower", "CR 3 or lower", "CR 3 or lower", "CR 4 or lower", "CR 4 or lower", "CR 4 or lower", "CR 4 or lower"],
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Spell Breaker",
			source : [["S", 126]],
			minlevel : 6,
			description : "\n   " + "When I restore HP to an ally with a 1st-level or higher spell, I can also end one spell" + "\n   " + "The chosen spell on the ally ends if it is equal or lower level to the spell slot level used",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {							
						var startDescr = spellObj.description;
						switch (spellKey) {
							case "mass heal" :
								spellObj.description = "Heal 700 hp, split over crea in range; also cures blindness, deafness, and all diseases; spell breaker";
								break;
							case "power word heal" :
								spellObj.description = spellObj.description.replace(/heals all.*/i, "full hp; no longer charmed, frightened, paralyzed, stunned; can stand up as rea; spell breaker");
								break;
							case "goodberry" :
								spellObj.description = spellObj.description.replace("Create ", "").replace("lose potency after ", "remain");
							case "regenerate" :
								spellObj.description = spellObj.description.replace(" for rest of duration", "");
							case "heal" :
								spellObj.description = spellObj.description.replace("all diseases", "diseases");
							case "cure wounds" :
							case "healing word" :
							case "life transference" :
							case "mass cure wounds" :
							case "mass healing word" :
							case "prayer of healing" :
								spellObj.description = spellObj.description.replace(/creatures?/i, "crea").replace("within", "in").replace("spellcasting ability modifier", "spellcasting ability mod") + "; spell breaker";
						}
						return startDescr !== spellObj.description;
					},
					"When I cast a spell that restores hit points to another creature than myself, I can also end a spell affecting the target. This spell can be of the same level of the spell slot used to cast the healing spell, or lower."
				]
			}
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : [["S", 126]],
			minlevel : 8,
			description : desc("I add my Wisdom modifier to the damage I deal with my cleric cantrips"),
			calcChanges : GenericClassFeatures["potent spellcasting"].calcChanges
		},
		"subclassfeature17" : {
			name : "Arcane Mastery",
			source : [["S", 126]],
			minlevel : 17,
			description : "\n   " + "I add four wizards spells, a 6th, 7th, 8th, and 9th-level spell, to my domain spells" + "\n   " + "As any domain spell, these spells are automatically prepared and count as cleric spells",
			spellcastingBonus : [{
				name : "Arcane Mastery (6)",
				"class" : "wizard",
				level : [6, 6],
				firstCol : 'markedbox'
			}, {
				name : "Arcane Mastery (7)",
				"class" : "wizard",
				level : [7, 7],
				firstCol : 'markedbox'
			}, {
				name : "Arcane Mastery (8)",
				"class" : "wizard",
				level : [8, 8],
				firstCol : 'markedbox'
			}, {
				name : "Arcane Mastery (9)",
				"class" : "wizard",
				level : [9, 9],
				firstCol : 'markedbox'
			}]
		}
	}
});
AddSubClass("fighter", "purple dragon knight", {
	regExpSearch : /^(((?=.*purple)(?=.*dragon)(?=.*knight))|(?=.*banneret)).*$/i,
	subname : "Purple Dragon Knight",
	fullname : "Purple Dragon Knight",
	source : [["S", 128]],
	features : {
		"subclassfeature3" : {
			name : "Rallying Cry",
			source : [["S", 128]],
			minlevel : 3,
			description : "\n   " + "When I use Second Wind, I also heal three allies within 60 ft that can see or hear me",
			additional : levels.map(function (n) {
				return n < 3 ? "" : n + " HP";
			}),
			action : [["bonus action", "Second Wind (+Rallying Cry)", "Second Wind"]]
		},
		"subclassfeature7" : {
			name : "Royal Envoy",
			source : [["S", 128]],
			minlevel : 7,
			description : "\n   " + "I gain proficiency with the Persuasion skill and I gain expertise with the Persuasion skill" + "\n   " + "If already proficient, I can choose Animal Handling, Insight, Intimidation, or Performance",
			skillstxt : "Persuasion proficiency and expertise; If already proficient, choose one from Animal Handling, Insight, Intimidation, or Performance",
			skills : ["Persuasion", "full"]
		},
		"subclassfeature10" : {
			name : "Inspiring Surge",
			source : [["S", 128]],
			minlevel : 10,
			description : "\n   " + "When I use my Action Surge, I can inspire an ally within 60 ft that can see or hear me" + "\n   " + "The ally can then use its reaction to make one melee or ranged weapon attack",
			additional : levels.map(function (n) {
				return n < 10 ? "" : n < 18 ? "1 ally" : "2 allies"; // level 18 per errata
			})
		},
		"subclassfeature15" : {
			name : "Bulwark",
			source : [["S", 128]],
			minlevel : 15,
			description : "\n   " + "When I use Indomitable to reroll a Int, Wis, or Cha save, I can extend it to an ally" + "\n   " + "The ally can reroll its failed saving throw against the same effect and take the result" + "\n   " + "It only works if not incapacitated and the ally is within 60 ft and can see or hear me"
		}
	}
});
AddSubClass("monk", "way of the long death", {
	regExpSearch : /^(?=.*\blong)(?=.*\b(death|dead))((?=.*(monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of the Long Death",
	source : [["S", 130]],
	features : {
		"subclassfeature3" : {
			name : "Touch of Death",
			source : [["S", 130]],
			minlevel : 3,
			description : "\n   " + "If I reduce someone within 5 ft to 0 HP, I gain Wis mod + monk level temporary HP"
		},
		"subclassfeature6" : {
			name : "Hour of Reaping",
			source : [["S", 130]],
			minlevel : 6,
			description : "\n   " + "As an action, all creatures within 30 feet of me must make a Wisdom saving throw" + "\n   " + "On a failed save the creature is frightened until the end of my next turn",
			action : ["action", ""]
		},
		"subclassfeature11" : {
			name : "Mastery of Death",
			source : [["S", 131]],
			minlevel : 11,
			additional : "1 ki point",
			description : "\n   " + "When I'm reduced to 0 HP, I can expend 1 ki point to have 1 HP instead",
			"touch of the long death" : {
				name : "Touch of the Long Death",
				extraname : "Way of the Long Death 17",
				source : [["S", 131]],
				description : " [1-10 ki points]" + "\n   " + "As an action, a target within 5 ft takes 2d10 necrotic damage per ki point I spent" + "\n   " + "It can make a Constitution saving throw to half the damage",
				action : ["action", ""]
			},
			autoSelectExtrachoices : [{
				extrachoice : "touch of the long death",
				minlevel : 17
			}]
		}
	}
});
AddSubClass("monk", "way of the sun soul", {
	regExpSearch : /^(?=.*\bsun)(?=.*\b(soul|spirit))((?=.*(warrior|monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of the Sun Soul",
	source : [["S", 131], ["X", 35]],
	features : {
		"subclassfeature3" : {
			name : "Radiant Sun Bolt",
			source : [["S", 131], ["X", 35]],
			minlevel : 3,
			additional : "1 ki point for 2 extra attacks",
			description : desc([
				"I gain a ranged spell attack that I can use as an attack in the Attack action",
				"If I do this and spend 1 ki point, I can make 2 of these attacks as a bonus action"
			]),
			action : ["bonus action", " (2\xD7 with Attack action)"],
			weaponOptions : [{
				regExpSearch : /^(?=.*radiant)(?=.*(sun|light))(?=.*bolt).*$/i,
				name : "Radiant Sun Bolt",
				source : [["S", 131], ["X", 35]],
				ability : 2,
				type : "Spell",
				damage : [1, 4, "radiant"],
				range : "30 ft",
				description : "If used in an Attack action, spend 1 ki point to use it twice as a bonus action",
				monkweapon : true,
				abilitytodamage : true,
				selectNow : true
			}],
			"searing arc strike" : {
				name : "Searing Arc Strike",
				extraname : "Way of the Sun Soul 6",
				source : [["S", 131], ["X", 35]],
				description : desc([
					"After taking the Attack action, I can cast Burning Hands as a bonus action [PHB 220]",
					"For every additional ki point I spend, Burning hands is cast at 1 higher spell level",
					"The maximum total ki points I can spend for this (including the 2) is half my Monk level"
				]),
				additional : levels.map(function (n) {
					if (n < 3) return "";
					var xtrKi = Math.max(0,Math.floor(n/2) - 2);
					return "2 ki points + max " + xtrKi + " ki point" + (xtrKi == 1 ? "" : "s");
				}),
				action : ["bonus action", " (after Attack action)"],
				spellcastingBonus : {
					name : "Searing Arc Strike",
					spells : ["burning hands"],
					selection : ["burning hands"],
					firstCol : 2
				},
				spellFirstColTitle : "Ki",
				spellChanges : {
					"burning hands" : {
						time : "1 bns",
						description : "3d6+1d6/extra Ki Fire dmg; save halves; unattended flammable objects ignite (ki max 1/2 monk lvl)",
						changes : "After I use the Attack action, I can cast Burning Hands as a bonus action by spending 2 ki points. I can even spend additional ki points to increase its spell level. The total amount of ki points I can spend on it is half my monk level."
					}
				}
			},
			autoSelectExtrachoices : [{
				extrachoice : "searing arc strike",
				minlevel : 6
			}]
		},
		"subclassfeature11" : {
			name : "Searing Sunburst",
			source : [["S", 131], ["X", 35]],
			minlevel : 11,
			description : desc([
				"As an action, anyone in a 20-ft radius light on a point within 150 ft makes a Con save",
				"If failed and not behind opaque total cover, take 2d6 (+ 2d6/ki point) radiant damage"
			]),
			action : ["action", ""],
			additional : "0 ki points + max 3 ki points",
			weaponOptions : [{
				regExpSearch : /^(?=.*searing)(?=.*sunburst).*$/i,
				name : "Searing Sunburst",
				source : [["S", 131], ["X", 35]],
				ability : 5,
				type : "Spell",
				damage : [2, 6, "radiant"],
				range : "150 ft",
				description : "All in 20-ft radius; Con save - success no damage; +2d6 damage per ki point (max 3 ki)",
				abilitytodamage : false,
				dc : true,
				useSpellMod : "monk",
				selectNow : true
			}]
		},
		"subclassfeature17" : {
			name : "Sun Shield",
			source : [["S", 131], ["X", 35]],
			minlevel : 17,
			description : desc([
				"As a reaction, when I'm hit by a melee attack, I can deal 5 + Wis mod radiant damage",
				"I can only do this while my light aura is on; I can turn it on/off as a bonus action"
			]),
			action : [["bonus action", " (start/stop)"], ["reaction", " (hit in melee)"]],
			additional : "30-ft rad bright + 30-ft dim light"
		}
	}
});
AddSubClass("paladin", "oath of the crown", {
	regExpSearch : /^(?=.*(crown|king|country))(((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper))))).*$/i,
	subname : "Oath of the Crown",
	source : [["S", 133]],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Champion Challenge",
			source : [["S", 133]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can have any chosen creatures within 30 ft of me make a Wis save",
				"If failed, a target is unable to willingly move more than 30 ft away from me",
				"The effect ends if I'm incapacitated, die, or it is moved more than 30 ft away from me"
			]),
			action : [["bonus action", ""]], // changed to bonus action per errata (v1.0, 2017)
			spellcastingExtra : ["command", "compelled duel", "warding bond", "zone of truth", "aura of vitality", "spirit guardians", "banishment", "guardian of faith", "circle of power", "geas"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Turn the Tide",
			source : [["S", 133]],
			minlevel : 3,
			description : "\n   " + "As a bonus action, any chosen creatures within 30 ft that can hear me regains HP" + "\n   " + "Each regain 1d6 + my Charisma modifier HP, up to half of its total HP",
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Divine Allegiance",
			source : [["S", 133]],
			minlevel : 7,
			description : "\n   " + "When a creature within 5 feet of me takes damage, I can substitute my HP for it" + "\n   " + "The creature takes no damage and I take all of it; this damage can't be prevented",
			action : ["reaction", ""]
		},
		"subclassfeature15" : {
			name : "Unyielding Spirit",
			source : [["S", 133]],
			minlevel : 15,
			description : "\n   " + "I have advantage on saving throws against effects that paralyze or stun",
			savetxt : { adv_vs : ["paralyzed", "stunned"] }
		},
		"subclassfeature20" : {
			name : "Exalted Champion",
			source : [["S", 133]],
			minlevel : 20,
			description : desc([
				"As an action, I gain the following benefits for 1 hour or until I'm incapacitated:",
				" \u2022 " + "Resistance to bludgeoning, piercing, and slashing damage from nonmagical weapons",
				" \u2022 " + "My allies within 30 ft of me and I have advantage on Wisdom and Death saves"
			]),
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("rogue", "mastermind", {
	regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*(mastermind|strategist)).*$/i,
	subname : "Mastermind",
	fullname : "Mastermind",
	source : [["S", 135], ["X", 46]],
	features : {
		"subclassfeature3" : {
			name : "Master of Intrigue",
			source : [["S", 135], ["X", 46]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with disguise kits, forgery kits, one gaming set, and two languages",
				"I can mimic speech patterns and accents if I've heard them for at least 1 minute"
			]),
			languageProfs : [2],
			toolProfs : ["Disguise kit", "Forgery kit", ["Gaming set", 1]]
		},
		"subclassfeature3.1" : {
			name : "Master of Tactics",
			source : [["S", 135], ["X", 46]],
			minlevel : 3,
			description : desc([
				"I can use the Help action as a bonus action",
				"This even works if the ally attacks a target within 30 ft of me that can see or hear me"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature9" : {
			name : "Insightful Manipulator",
			source : [["S", 135], ["X", 46]],
			minlevel : 9,
			description : desc([
				"By spending 1 minute observing/interacting outside of combat I can learn capabilities",
				"The DM tells me if the target is my equal, superior, or inferior in regard to two things:",
				" - Intelligence score    - Wisdom score    - Charisma score    - Class levels (if any)"
			])
		},
		"subclassfeature13" : {
			name : "Misdirection",
			source : [["S", 135], ["X", 46]],
			minlevel : 13,
			description : desc([
				"As a reaction, I can redirect an attack meant for me to a creature within 5 ft of me",
				"This only works if the creature is providing me with cover against the attack"
			]),
			action : ["reaction", ""]
		},
		"subclassfeature17" : {
			name : "Soul of Deceit",
			source : [["S", 135], ["X", 46]],
			minlevel : 17,
			description : desc([
				"My thoughts can't be read by telepathy or similar means; I can project false thoughts",
				"For that, I must pass a Cha (Deception) vs. Wis (Insight) check to fool the mind reader",
				"Magic always determines I'm truthful; I can't be magically compelled to tell the truth"
			])
		}
	}
});
AddSubClass("rogue", "swashbuckler", {
	regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*swashbuckl).*$/i,
	subname : "Swashbuckler",
	fullname : "Swashbuckler",
	source : [["S", 135], ["X", 47]],
	features : {
		"subclassfeature3" : {
			name : "Fancy Footwork",
			source : [["S", 135], ["X", 47]],
			minlevel : 3,
			description : desc([
				"Enemies I make a melee attack against in my turn can't use opportunity attacks on me",
				"This lasts until the end of my current turn"
			])
		},
		"subclassfeature3.1" : {
			name : "Rakish Audacity",
			source : [["S", 136], ["X", 47]],
			minlevel : 3,
			description : desc([
				"I don't need advantage to sneak attack if my target is the only one within 5 ft of me",
				"I still can't sneak attack if I have disadv.; I add my Charisma modifier to initiative rolls"
			]),
			addMod : { type : "skill", field : "Init", mod : "max(Cha|0)", text : "I can add my Charisma modifier to initiative rolls." }
		},
		"subclassfeature9" : {
			name : "Panache",
			source : [["S", 136], ["X", 47]],
			minlevel : 9,
			description : desc([
				"As an action, I can beguile a creature that hears and understands me, for 1 minute",
				"It must succeed a Wis (Insight) check opposed by my Cha (Persuasion) or be affected as:",
				"\u2022 A hostile target gains disadv. on attacks and can't do opportunity attacks vs. not-me",
				"  This effect ends if an ally attacks or casts a spell vs. it, or if it and I are 60 ft apart",
				"\u2022 Targets that are not hostile are charmed and regard me as a friendly acquaintance",
				"  This effect ends if me or an ally do anything harmful to it"
			]),
			action : ["action", ""]
		},
		"subclassfeature13" : {
			name : "Elegant Maneuver",
			source : [["S", 136], ["X", 47]],
			minlevel : 13,
			description : "\n   " + "As a bonus action, I can gain adv. on my next Dex (Acrobatics) or Str (Athletics) check",
			action : ["bonus action", ""]
		},
		"subclassfeature17" : {
			name : "Master Duelist",
			source : [["S", 136], ["X", 47]],
			minlevel : 17,
			description : "\n   " + "Once per short rest, when I miss with an attack roll, I can roll again with advantage",
			recovery : "short rest",
			usages : 1
		}
	}
});
AddSubClass("sorcerer", "storm sorcery", {
	regExpSearch : /^(?=.*(sorcerer|witch))((?=.*(storm|tempest|hurricane))|((?=.*air)(?=.*element))).*$/i,
	subname : "Storm Sorcery",
	fullname : "Storm Sorcerer",
	source : [["S", 137], ["X", 51]],
	features : {
		"subclassfeature1" : {
			name : "Wind Speaker",
			source : [["S", 137], ["X", 52]],
			minlevel : 1,
			description : "\n   " + "I can speak, read, and write Primordial (and its dialects Aquan, Auran, Ignan, Terran)",
			languageProfs : ["Primordial"]
		},
		"subclassfeature1.1" : {
			name : "Tempestuous Magic",
			source : [["S", 137], ["X", 52]],
			minlevel : 1,
			description : desc([
				"As a bonus action, before or after casting a 1st-level or higher spell, I can fly 10 ft",
				"This movement doesn't provoke opportunity attacks as whirling gust of air surround me"
			]),
			action : ["bonus action", " (with casting)"]
		},
		"subclassfeature6" : {
			name : "Heart of the Storm",
			source : [["S", 137], ["X", 52]],
			minlevel : 6,
			description : desc([
				"I have resistance to lightning and thunder damage",
				"When I start casting a 1st-level or higher spell that deals lightning or thunder damage,",
				"I deal lightning or thunder damage to creatures of my choice that I can see within 10 ft"
			]),
			additional : levels.map(function (n) { return n < 6 ? "" : Math.floor(n/2) + " damage"; }),
			dmgres : ["Lightning", "Thunder"]
		},
		"subclassfeature6.1" : {
			name : "Storm Guide",
			source : [["S", 137], ["X", 52]],
			minlevel : 6,
			description : desc([
				"As an action, I can stop rain around me in 20-ft radius; bonus action for it to resume",
				"As a bonus action, I can choose the direction of wind around me in a 100-ft radius",
				"This lasts until the end of my next turn and doesn't alter the wind's speed"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature14" : {
			name : "Storm's Fury",
			source : [["S", 137], ["X", 52]],
			minlevel : 14,
			description : desc([
				"As a reaction when hit by a melee attack, I can deal lightning damage to the attacker",
				"The attacker must also make a Strength save or be pushed up to 20 ft away from me"
			]),
			action : ["reaction", ""],
			additional : levels.map(function (n) { return n < 14 ? "" : n + " lightning damage"; })
		},
		"subclassfeature18" : {
			name : "Wind Soul",
			source : [["S", 137], ["X", 52]],
			minlevel : 18,
			description : desc([
				"I have immunity to lightning and thunder damage and gain magical 60 ft fly speed",
				"As an action, I reduce my fly speed to 30 ft and give allies 30 ft fly speed for 1 hour",
				"I can do this once per short rest for up to 3 + my Charisma modifier allies within 30 ft"
			]),
			action : ["action", ""],
			savetxt : { immune : ["lightning", "thunder"] },
			speed : { fly : { spd : "fixed 60", enc : "fixed 60" } },
			usages : 1,
			recovery : "short rest"
		}
	}
});
AddSubClass("warlock", "the undying", {
	regExpSearch : /^(?!.*light)(?=.*warlock)(?=.*(immortal|undying|neverending|unending)).*$/i,
	subname : "the Undying",
	source : [["S", 139]],
	spellcastingExtra : ["false life", "ray of sickness", "blindness/deafness", "silence", "feign death", "speak with dead", "aura of life", "death ward", "contagion", "legend lore"],
	features : {
		"subclassfeature1" : {
			name : "Among the Dead",
			source : [["S", 139]],
			minlevel : 1,
			description : "\n   " + "I learn the Spare the Dying cantrip and gain advantage on saving throws vs. diseases" + "\n   " + "If an undead targets me directly with an attack or spell, it must make a Wisdom save" + "\n   " + "On a fail, it must choose a new target or forfeit its attack or harmful spell" + "\n   " + "On a success or if I attack or cast a harmful spell on it, it is immune for 24 hours",
			savetxt : { adv_vs : ["disease"] },
			spellcastingBonus : {
				name : "Among the Dead",
				spells : ["spare the dying"],
				selection : ["spare the dying"]
			}
		},
		"subclassfeature6" : {
			name : "Defy Death",
			source : [["S", 140]],
			minlevel : 6,
			description : "\n   " + "I regain 1d8 + my Constitution modifier in HP when I succeed on a Death saving throw" + "\n   " + "I also regain this amount whenever I use Spare the Dying to stabilize a creature",
			recovery : "long rest",
			usages : 1
		},
		"subclassfeature10" : {
			name : "Undying Nature",
			source : [["S", 140]],
			minlevel : 10,
			description : "\n   " + "I can hold my breath indefinitely; I don't require food, water, or sleep (I still need rest)" + "\n   " + "I age more slowly, only 1 year for every 10 years that pass; I can't be magically aged"
		},
		"subclassfeature14" : {
			name : "Indestructible Life",
			source : [["S", 140]],
			minlevel : 14,
			description : "\n   " + "As a bonus action, I can regain HP and reattach severed body parts",
			action : ["bonus action", ""],
			recovery : "short rest",
			usages : 1,
			additional : levels.map(function (n) { return n < 14 ? "" : "1d8 + " + n + " HP"; })
		}
	}
});
AddSubClass("wizard", "bladesinging", {
	regExpSearch : /(bladesinging|bladesinger)/i,
	subname : "Tradition of Bladesinging",
	fullname : "Bladesinger",
	attacks : [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	source : [["S", 142], ["T", 76]],
	features : {
		"subclassfeature2" : {
			name : "Training in War and Song",
			source : [["S", 142], ["T", 76]],
			minlevel : 2,
			description : "\n   " + "I gain proficiency with light armor, a one-handed melee weapon, and Performance",
			armorProfs : [true, false, false, false],
			skills : ["Performance"]
		},
		"subclassfeature2.1" : {
			name : "Bladesong",
			source : [["S", 142], ["T", 76]],
			minlevel : 2,
			description : desc([
				"As a bonus action, I can start the bladesong for 1 minute; I can dismiss it at any time",
				"It stops when I wear a shield, medium or heavy armor, or attack with two hands",
				"While the bladesong is active I have the following benefits:",
				" \u2022 Intelligence modifier (min 1) to AC",
				" \u2022 Base walking speed increases by 10 foot",
				" \u2022 Advantage on Dexterity (Acrobatics) checks",
				" \u2022 Intelligence modifier (min 1) to concentration saves for maintaining conc. on a spell"
			]),
			action : [["bonus action", " (start)"]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature6" : {
			name : "Extra Attack",
			source : [["S", 142], ["T", 77]],
			minlevel : 6,
			description : desc([
				"I can attack twice instead of once when I take the Attack action on my turn",
				"Moreover, I can cast one of my cantrips in place of one of those attacks"
			])
		},
		"subclassfeature10" : {
			name : "Song of Defense",
			source : [["S", 142], ["T", 77]],
			minlevel : 10,
			description : desc([
				"As a reaction while my bladesong is active, I can expend a spell slot to reduce damage",
				"The damage I take is reduced by 5 for every level of the spell slot I expend"
			]),
			action : [["reaction", " (in bladesong)"]]

		},
		"subclassfeature14" : {
			name : "Song of Victory",
			source : [["S", 142], ["T", 77]],
			minlevel : 14,
			description : "\n   " + "While my bladesong is active, I add my Int mod (min 1) to melee weapon attack damage",
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (v.isMeleeWeapon && (/blade.?song/i).test(v.WeaponTextName)) {
							output.extraDmg += Math.max(1, Number(What('Int Mod')));
						};
					},
					"If I include the word 'Bladesong' in the name or description of a melee weapon, it gets my Intelligence modifier added to its Damage."
				]
			}
		}
	}
});

// New Totem Warrior options
if (ClassSubList["barbarian-totem warrior"]) {
	var SCAG_TotemWarriorFeature = ClassSubList["barbarian-totem warrior"].features["subclassfeature3.1"];
	if (SCAG_TotemWarriorFeature) {
		AddFeatureChoice(SCAG_TotemWarriorFeature, false, "Elk", {
			name : "Elk Spirit",
			source : [["S", 122]],
			description : "\n   While raging without heavy armor, my base walking speed increases by 15 ft"
		});
		AddFeatureChoice(SCAG_TotemWarriorFeature, false, "Tiger", {
			name : "Tiger Spirit",
			source : [["S", 122]],
			description : "\n   While raging, I can add 10 ft to my long jump and 3 ft to my high jump distance"
		});
	}
	SCAG_TotemWarriorFeature = ClassSubList["barbarian-totem warrior"].features["subclassfeature6"];
	if (SCAG_TotemWarriorFeature) {
		AddFeatureChoice(SCAG_TotemWarriorFeature, false, "Elk", {
			name : "Aspect of the Elk",
			source : [["S", 122]],
			description : desc([
				"While mounted or on foot and not incapacitated, my travel pace is doubled",
				"I can extend this benefit to up to ten companions, while they are within 60 ft of me"
			])
		});
		AddFeatureChoice(SCAG_TotemWarriorFeature, false, "Tiger", {
			name : "Aspect of the Tiger",
			source : [["S", 122]],
			description : "\n   I gain proficiency with two skills chosen from: Athletics, Acrobatics, Stealth, or Survival",
			skillstxt : "Choose two from Athletics, Acrobatics, Stealth, and Survival"
		});
	}
	SCAG_TotemWarriorFeature = ClassSubList["barbarian-totem warrior"].features["subclassfeature14"];
	if (SCAG_TotemWarriorFeature) {
		AddFeatureChoice(SCAG_TotemWarriorFeature, false, "Elk", {
			name : "Elk Attunement",
			source : [["S", 122]],
			description : desc([
				"As a bonus action while raging, I can move through a Large or smaller creature's space",
				"It must make a Strength save of DC 8 + Strength modifier + Proficiency bonus",
				"If failed, it is knocked prone and takes 1d12 + Strength modifier bludgeoning damage"
			]),
			action : [["bonus action", " (in rage)"]]
		});
		AddFeatureChoice(SCAG_TotemWarriorFeature, false, "Tiger", {
			name : "Tiger Attunement",
			source : [["S", 122]],
			description : desc([
				"As a bonus action while raging, I can make a melee weapon attack on these conditions:",
				" \u2022 I move at least 20 ft in a straight line towards the target that is Large or smaller",
				" \u2022 I make a melee weapon attack against it after the bonus action"
			]),
			action : [["bonus action", " (in rage)"]]
		});
	}
}

// Backgrounds
BackgroundList["far traveler"] = {
	regExpSearch : /^(?=.*far)(?=.*traveler).*$/i,
	name : "Far Traveler",
	source : [["S", 148], ["ALbackground", 0]],
	skills : ["Insight", "Perception"],
	gold : 5,
	equipleft : [
		["Gaming set or musical instrument", "", ""],
		["Poorly wrought maps", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Piece of jewelry worth 10 gp", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "All Eyes on You",
	trait : [
		"I have different assumptions from those around me concerning personal space, blithely invading others' space in innocence, or reacting to ignorant invasion of my own.",
		"I have my own ideas about what is and is not food, and I find the eating habits of those around me fascinating, confusing, or revolting.",
		"I have a strong code of honor or sense of propriety that others don't comprehend.",
		"I express affection or contempt in ways that are unfamiliar to others.",
		"I honor my deities through practices that are foreign to this land.",
		"I begin or end my day with small traditional rituals that are unfamiliar to those around me."
	],
	ideal : [
		["Open",
			"Open: I have much to learn from the kindly folk I meet along my way. (Good)"
		],
		["Reserved",
			"Reserved: As someone new to these strange lands, I am cautious and respectful in my dealings. (Lawful)"
		],
		["Adventure",
			"Adventure: I'm far from home, and everything is strange and wonderful! (Chaotic)"
		],
		["Cunning",
			"Cunning: Though I may not know their ways, neither do they know mine, which can be to my advantage. (Evil)"
		],
		["Inquisitive",
			"Inquisitive: Everything is new, but I have a thirst to learn. (Neutral)"
		],
		["Suspicious",
			"Suspicious: I must be careful, for I have no way of telling friend from foe here. (Any)"
		]
	],
	bond : [
		"So long as I have this token from my homeland, I can face any adversity in this strange land.",
		"The gods of my people are a comfort to me so far from home.",
		"I hold no greater cause than my service to my people.",
		"My freedom is my most precious possession. I'll never let anyone take it from me again.",
		"I'm fascinated by the beauty and wonder of this new land.",
		"Though I had no choice, I lament having to leave my loved one(s) behind. I hope to see them again one day."
	],
	flaw : [
		"I am secretly (or not so secretly) convinced of the superiority of my own culture over that of this foreign land.",
		"I pretend not to understand the local language in order to avoid interactions I would rather not have.",
		"I have a weakness for the new intoxicants and other pleasures of this land.",
		"I don't take kindly to some of the actions and motivations of the people of this land, because these folk are different from me.",
		"I consider the adherents of other gods to be deluded innocents at best, or ignorant fools at worst.",
		"I have a weakness for the exotic beauty of the people of these lands."
	],
	extra : [
		"Select Why You Are Here",
		"Emissary",
		"Exile",
		"Fugitive",
		"Pilgrim",
		"Sightseer",
		"Wanderer"
	],
	toolProfs : [["Gaming set or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "modest"
};

// Background variants
AddBackgroundVariant("soldier", "city watch", {
	regExpSearch : /^(?=.*city)(?=.*(watch|guard)).*$/i,
	name : "City Watch",
	source : [["S", 145], ["ALbackground", 0]],
	skills : ["Athletics", "Insight"],
	equipright : [
		["Uniform of my unit", "", 3],
		["Insignia of rank", "", ""],
		["Horn", "", 2],
		["Manacles", "", 6],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Watcher's Eye",
	extra : "",
	toolProfs : "",
	languageProfs : [2],
	lifestyle : "modest"
});
AddBackgroundVariant("guild artisan", "clan crafter", {
	regExpSearch : /^(?=.*clan)(?=.*(crafter|smith|builder|miner)).*$/i,
	name : "Clan Crafter",
	source : [["S", 145], ["ALbackground", 0]],
	skills : ["History", "Insight"],
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Maker's mark chisel", "", 0.5]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins and 10 gp gem)", "", 1],
	],
	feature : "Respect of the Stout Folk",
	extra : "",
	languageProfs : ["Dwarvish"],
	lifestyle : "comfortable"
});
AddBackgroundVariant("sage", "cloistered scholar", {
	regExpSearch : /^(?=.*cloistered)(?=.*scholar).*$/i,
	name : "Cloistered Scholar",
	source : [["S", 146], ["ALbackground", 0]],
	skills : ["History"],
	skillstxt : "History and choose one from Arcana, Nature, and Religion",
	gold : 10,
	equipleft : [
		["Ink, 1 ounce bottle of", 1, ""],
		["Quill", "", ""],
		["Parchment, sheets of", 1, ""],
		["Small penknife", "", 0.5],
		["Borrowed book", "", 5]
	],
	equipright : [
		["Scholar's robes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Library Access",
	extra : ["Name your Library"],
	languageProfs : [2],
	lifestyle : "modest"
});
AddBackgroundVariant("guild artisan", "courtier", {
	regExpSearch : /courtier/i,
	name : "Courtier",
	source : [["S", 146], ["ALbackground", 0]],
	skills : ["Insight", "Persuasion"],
	gold : 5,
	equipleft : "",
	equipright : [
		["Fine clothes", "", 3],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Court Functionary",
	extra : "",
	toolProfs : "",
	languageProfs : [2],
	lifestyle : "comfortable"
});
AddBackgroundVariant("acolyte", "faction agent", {
	regExpSearch : /^(?=.*agent)(?=.*(faction|harper|order of the gauntlet|emerald enclave|lord.?s alliance|zhentarim)).*$/i,
	name : "Faction Agent",
	source : [["S", 147], ["ALbackground", 0]],
	skills : ["Insight"],
	skillstxt : "Insight and choose one Intelligence, Wisdom, or Charisma skill",
	gold : 15,
	equipleft : [
		["Copy of seminal faction's text", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Badge or emblem of faction", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Safe Haven",
	extra : [
		"Select a Faction",
		"The Harpers",
		"The Order of the Gauntlet",
		"The Emerald Enclave",
		"The Lord's Alliance",
		"The Zhentarim"
	],
	languageProfs : [2],
	lifestyle : "modest"
});
AddBackgroundVariant("folk hero", "inheritor", {
	regExpSearch : /inheritor/i,
	name : "Inheritor",
	source : [["S", 150], ["ALbackground", 0]],
	skills : ["Survival"],
	skillstxt : "Survival and choose one from Arcana, History, and Religion",
	gold : 15,
	equipleft : [
		["Gaming set or musical instrument", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["The inheritance", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Inheritance",
	extra : [
		"Select an Inheritance",
		"Document such as a map, letter, or journal",
		"A trinket",
		"Article of clothing",
		"Piece of jewelry",
		"Arcane book or formulary",
		"Written story, song, poem, or secret",
		"Tattoo or other body marking"
	],
	toolProfs : [["Gaming set or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "wealthy"
});
AddBackgroundVariant("soldier", "investigator", {
	regExpSearch : /investigator/i,
	name : "Investigator",
	source : [["S", 145], ["ALbackground", 0]],
	skills : ["Insight", "Investigation"],
	equipright : [
		["Uniform", "", 3],
		["Insignia of rank", "", ""],
		["Horn", "", 2],
		["Manacles", "", 6],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Watcher's Eye",
	extra : "",
	toolProfs : "",
	languageProfs : [2]
});
AddBackgroundVariant("soldier", "knight of the order", {
	regExpSearch : /^(?=.*knight)(?=.*order).*$/i,
	name : "Knight of the Order",
	source : [["S", 151], ["ALbackground", 0]],
	skills : ["Persuasion"],
	skillstxt : "Persuasion and choose one from Arcana, History, Nature, and Religion",
	equipright : [
		["Traveler's clothes", "", 4],
		["Signet, banner, or seal of rank", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Knightly Regard",
	extra : ["Name your Knightly Order"],
	toolProfs : [["Gaming set or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "comfortable"
});
AddBackgroundVariant("soldier", "mercenary veteran", {
	regExpSearch : /^(?=.*mercenary)(?=.*(veteran|soldier)).*$/i,
	name : "Mercenary Veteran",
	source : [["S", 152], ["ALbackground", 0]],
	skills : ["Athletics", "Persuasion"],
	equipright : [
		["Uniform of my company", "", 4],
		["Insignia of rank", "", ""],
		["Gaming set", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Mercenary Life",
	extra : ["Name your Mercenary Company"],
	lifestyle : "modest"
});
AddBackgroundVariant("criminal", "urban bounty hunter", {
	regExpSearch : /^(?=.*urban)(?=.*bounty)(?=.*hunter).*$/i,
	name : "Urban Bounty Hunter",
	source : [["S", 153], ["ALbackground", 0]],
	skills : "",
	skillstxt : "Choose two from Deception, Insight, Persuasion, and Stealth",
	gold : 20,
	equipright : [
		["Appropriate Clothes", "", 3],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Ear to the Ground",
	extra : "",
	toolProfs : [["Gaming set, instrument, or thieves' tools", 2]],
	lifestyle : "poor"
});
AddBackgroundVariant("outlander", "uthgardt tribe member", {
	regExpSearch : /^(?=.*(uthgardt|barbarian|nomad|clan))(?=.*tribe)(?=.*member).*$/i,
	name : "Uthgardt Tribe Member",
	source : [["S", 153], ["ALbackground", 0]],
	equipright : [
		["Traveler's clothes", "", 4],
		["Hunting trap", "", 25],
		["Totemic token or tattoos of tribal totem", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Uthgardt Heritage",
	extra : "",
	toolProfs : [["Artisan's tools or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "poor"
});
AddBackgroundVariant("noble", "waterdhavian noble", {
	regExpSearch : /^(?=.*(waterdhavian|waterdeep))(?=.*noble).*$/i,
	name : "Waterdhavian Noble",
	source : [["S", 154], ["ALbackground", 0]],
	gold : 20,
	equipleft : [
		["Scroll of pedigree", "", ""],
		["Skin of fine zzar or wine", "", 5] // weight based on waterskin
	],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring or brooch", "", ""],
		["Purse (with coins)", "", 1],
	],
	feature : "Kept in Style",
	toolProfs : [["Gaming set or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "wealthy"
});

// Background features
BackgroundFeatureList["court functionary"] = {
	description : "My knowledge of how bureaucracies function lets me gain access to the records and inner workings of any noble court or government I encounter. I know or can easily acquire the knowledge who the movers and shakers are, whom to go to for the favors I seek, and what the current intrigues of interest in the group are.",
	source : [["S", 147], ["ALbackground", 0]]
};
BackgroundFeatureList["all eyes on you"] = {
	description : "My accent, mannerisms, figures of speech all mark me as foreign. Curious glances are directed my way wherever I go. A nuisance, but I also gain the friendly interest of the curious. I can parley this attention into access I might not otherwise have, for me and my companions. Nobles, scholars, merchants, and guilds, might be among the interested.",
	source : [["S", 149], ["ALbackground", 0]]
};
BackgroundFeatureList["ear to the ground"] = {
	description : "I am in frequent contact with people in my chosen segment of society. These people might be associated with the criminal underworld, the rough-and-tumble folk of the streets, or members of high society. This connection comes in the form of a contact in any city I visit, a person who provides information about the people and places of the local area.",
	source : [["S", 153], ["ALbackground", 0]]
};
BackgroundFeatureList["inheritance"] = {
	description : "The item I inherited has a special significance, history, power, and/or important value. When I begin my adventuring career, I can decide whether to tell my companions about it right away. Rather than attracting attention to myself, I could decide to keep it a secret until I learn more about what it means to me and what it can do for me.",
	source : [["S", 150], ["ALbackground", 0]]
};
BackgroundFeatureList["kept in style"] = {
	description : "While I am in Waterdeep or elsewhere in the North my house sees to my everyday needs. My name and signet are sufficient to cover most of my expenses; the inns, taverns, and festhalls I frequent are glad to record my debt and send an accounting to my family's estate. This advantage enables me to take 2 gp of my daily lifestyle costs down to 0 gp.",
	source : [["S", 154], ["ALbackground", 0]]
};
BackgroundFeatureList["knightly regard"] = {
	description : "I receive shelter and succor from members of my knightly order and its sympathizers. Religious knightly orders get aid from temples and communities of my deity. Civic order knights get help from the community they serve. Philosophical order knights can find help from those they have aided in pursuit of their ideals, and those who share those ideals.",
	source : [["S", 151], ["ALbackground", 0]]
};
BackgroundFeatureList["library access"] = {
	description : "I have free access to most of the library I work at, though it might have repositories of lore that are too valuable, magical, or secret to permit anyone immediate access. I have a working knowledge of my cloister's personnel and bureaucracy, and I know how to navigate those connections. I am likely to gain preferential treatment at other libraries.",
	source : [["S", 146], ["ALbackground", 0]]
};
BackgroundFeatureList["mercenary life"] = {
	description : "I know the mercenary life well. I am able to identify mercenary company emblems, and I know a little about any such company, including the leaders, reputation, and who hired them recently. I can find the locales where mercenaries abide anywhere, as long as I speak the language. My mercenary work between adventures affords me a comfortable lifestyle.",
	source : [["S", 152], ["ALbackground", 0]]
};
BackgroundFeatureList["respect of the stout folk"] = {
	description : "No one esteems clan crafters quite so highly as dwarves do. I always have free room and board in any place where shield dwarves or gold dwarves dwell, and the individuals in such a settlement might vie among themselves to determine who can offer me (and possibly my compatriots) the finest accommodations and assistance.",
	source : [["S", 145], ["ALbackground", 0]]
};
BackgroundFeatureList["safe haven"] = {
	description : "As a faction agent, I have access to a secret network of support and operatives who can provide assistance on my adventures. I know secret signs and passwords to identify such operatives, who can provide me with access to a hidden safe house, free room and board, or assistance in finding information. These agents never risk their lives or identity for me.",
	source : [["S", 147], ["ALbackground", 0]]
};
BackgroundFeatureList["uthgardt heritage"] = {
	description : "I have an excellent knowledge of my tribe's territory, and surrounding terrain and natural resources. I am familiar enough with any wilderness area that I can find twice as much food and water as one normally would. I can call upon the hospitality of my people, and those allied, often including members of druid circles, nomadic elves, and priesthoods.",
	source : [["S", 154], ["ALbackground", 0]]
};
BackgroundFeatureList["watcher's eye"] = {
	description : "My experience in enforcing the law, and dealing with lawbreakers, gives me a feel for local laws and criminals. I can easily find the local outpost of the watch, guards or a similar organization, and just as easily pick out the dens of criminal activity in a community. I am far more likely to be welcome in the former locations rather than the latter, however.",
	source : [["S", 145], ["ALbackground", 0]]
};

// Spells
SpellsList["booming blade"] = {
	name : "Booming Blade",
	classes : ["artificer", "sorcerer", "warlock", "wizard"],
	source : [["T", 106], ["S", 142]],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "S:5-ft rad",
	components : "S,M\u0192",
	compMaterial : "A melee weapon worth at least 1 sp",
	duration : "1 round",
	description : "Melee wea atk with cast; hit: 0d8 Thunder dmg, if it moves next round +1d8; +1d8 at CL5, 11, \u0026 17",
	descriptionShorter : "melee wea atk with cast; hit: 0d8 Thunder dmg, if move next rnd +1d8; +1d8 CL 5/11/17 ",
	descriptionCantripDie : "Melee wea atk with cast; if hit: `CD-1`d8 Thunder dmg and if moves next round +`CD`d8 Thunder dmg",
	descriptionFull : "You brandish the weapon used in the spell's casting and make a melee attack with it against one creature within 5 feet of you. On a hit, the target suffers the weapon attack's normal effects and then becomes sheathed in booming energy until the start of your next turn. If the target willingly moves 5 feet or more before then, the target takes 1d8 thunder damage, and the spell ends.\n   This spell's damage increases when you reach certain levels. At 5th level, the melee attack deals an extra 1d8 thunder damage to the target on a hit, and the damage the target takes for moving increases to 2d8. Both damage rolls increase by 1d8 at 11th level (2d8 and 3d8) and again at 17th level (3d8 and 4d8).",
	dynamicDamageBonus : {
		extraDmgGroupsSameType : /(next r(?:ou)?nd )((?:\+?\d+d?\d*)+)/i
	}
};
SpellsList["green-flame blade"] = {
	name : "Green-Flame Blade",
	classes : ["artificer", "sorcerer", "warlock", "wizard"],
	source : [["T", 107], ["S", 143]],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "S:5-ft rad",
	components : "S,M\u0192",
	compMaterial : "A melee weapon worth at least 1 sp",
	duration : "Instantaneous",
	description : "Melee wea atk with cast; hit: 0d8 Fire dmg, 1 crea in 5 ft 0d8+spell mod Fire dmg; +1d8 CL5/11/17",
	descriptionShorter : "Melee wea atk; hit: 0d8 Fire dmg, 1 crea in 5 ft 0d8+spell mod Fire dmg; +1d8 CL5/11/17",
	descriptionCantripDie : "Melee wea atk with cast; if hit: `CD-1`d8 Fire dmg, 1 crea in 5 ft `CD-1`d8+spellcasting ability modifier Fire dmg",
	descriptionFull : "You brandish the weapon used in the spell's casting and make a melee attack with it against one creature within 5 feet of you. On a hit, the target suffers the weapon attack's normal effects, and you can cause green fire to leap from the target to a different creature of your choice that you can see within 5 feet of it. The second creature takes fire damage equal to your spellcasting ability modifier.\n   This spell's damage increases when you reach certain levels. At 5th level, the melee attack deals an extra 1d8 fire damage to the target on a hit, and the fire damage to the second creature increases to 1d8 + your spellcasting ability modifier. Both damage rolls increase by 1d8 at 11th level (2d8 and 2d8) and 17th level (3d8 and 3d8)."
};
SpellsList["lightning lure"] = {
	name : "Lightning Lure",
	classes : ["artificer", "sorcerer", "warlock", "wizard"],
	source : [["T", 107], ["S", 143]],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "S:15-ft rad",
	components : "V",
	duration : "Instantaneous",
	save : "Str",
	description : "1 crea in 15 ft save or pulled 10 ft to me; if it ends in 5 ft, 1d8 Lightning dmg; +1d8 at CL 5, 11, \u0026 17",
	descriptionShorter : "1 crea in 15 ft save or pulled 10 ft to me; if end in 5 ft, 1d8 Lightning dmg; +1d8 at CL 5/11/17",
	descriptionCantripDie : "1 crea I see save or pulled 10 ft to me; if it ends in 5 ft, `CD`d8 Lightning dmg",
	descriptionFull : "You create a lash of lightning energy that strikes at one creature of your choice that you can see within 15 feet of you. The target must succeed on a Strength saving throw or be pulled up to 10 feet in a straight line toward you and then take 1d8 lightning damage if it is within 5 feet of you." + "\n   " + "This spell's damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8)."
};
SpellsList["sword burst"] = {
	name : "Sword Burst",
	classes : ["artificer", "sorcerer", "warlock", "wizard"],
	source : [["T", 115], ["S", 143]],
	level : 0,
	school : "Conj",
	time : "1 a",
	range : "S:5-ft rad",
	components : "V",
	duration : "Instantaneous",
	save : "Dex",
	description : "All crea in range save or 1d6 Force damage; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "All crea in range save or `CD`d6 Force damage",
	descriptionFull : "You create a momentary circle of spectral blades that sweep around you. All other creatures within 5 feet of you must succeed on a Dexterity saving throw or take 1d6 force damage." + "\n   " + "This spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};

WeaponsList["booming blade"] = {
	regExpSearch : /^(?=.*booming)(?=.*blade).*$/i,
	name : "Booming Blade",
	source : [["T", 106], ["S", 142]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["Bd8/Cd8", "", "thunder"],
	range : "With melee wea",
	description : "First damage added to the attack; second to the target if it moves next round",
	abilitytodamage : false
};
WeaponsList["green-flame blade"] = {
	regExpSearch : /^(?=.*green)(?=.*flame)(?=.*blade).*$/i,
	name : "Green-Flame Blade",
	source : [["T", 107], ["S", 143]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["Bd8/Bd8", "", "fire"],
	range : "With melee wea",
	description : "First damage added to the attack; second to a target within 5 ft",
	abilitytodamage : true
};
WeaponsList["lightning lure"] = {
	regExpSearch : /^(?=.*lightning)(?=.*lure).*$/i,
	name : "Lightning Lure",
	source : [["T", 107], ["S", 143]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 8, "lightning"],
	range : "15 ft",
	description : "Str save; success - nothing; fail - pulled 10 ft closer to me, only take damage if end within 5 ft of me",
	abilitytodamage : false,
	dc : true
};
WeaponsList["sword burst"] = {
	regExpSearch : /^(?=.*sword)(?=.*burst).*$/i,
	name : "Sword Burst",
	source : [["T", 115], ["S", 143]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "force"],
	range : "5-ft radius",
	description : "Dex save, success - no damage; all creatures in range",
	abilitytodamage : false,
	dc : true
};

// pub_20160315_CoS.js
// This file adds the backgrounds from the Curse of Strahd adventure book and the optional backgrounds from the Adventurers League season 4 (Curse of Strahd) to MPMB's Character Record Sheet

// Define the sources
SourceList.CoS={
	name : "Curse of Strahd [background, items, pack]",
	abbreviation : "CoS",
	group : "Adventure Books",
	campaignSetting : "Ravenloft",
	url : "https://media.wizards.com/2016/downloads/DND/CoS_Character_Options.pdf?dl=1",
	date : "2016/03/15"
};
SourceList["AL:CoS"]={
	name : "Curse of Strahd Backgrounds", // v1.1
	abbreviation : "AL:CoS",
	group : "Adventurers League",
	url : "https://www.dropbox.com/s/f9ktz5u2gcu2509/Curse-of-Strahd-Backgrounds-v1.1.pdf", // used to be https://dndadventurersleague.org/wp-content/uploads/2016/06/Curse-of-Strahd-Backgrounds-v1.1.pdf
	date : "2016/04/07"
};

// Backgrounds (with contributions by RCanine)
BackgroundList["haunted one"] = {
	regExpSearch : /haunted.one/i,
	name : "Haunted One",
	source : [["CoS", 209], ["VRGtR", 34], ["ALbackground", 0]],
	skillstxt : "Choose two from Arcana, Investigation, Religion, and Survival",
	languageProfs : [2], // was 1 in book, fixed in errata
	gold : 0.01,
	equipleft : [
		["Chest, with:", "", 25],
		["Crowbar", "", 5],
		["Hammer", "", 3],
		["Wooden Stakes", 3, 1],
		["Holy symbol", "", 1],
		["Holy water, flasks of", "", 1],
		["Manacles", "", 6],
		["Steel Mirror", "", 0.5],
		["Oil, flasks of", "", 1],
		["Tinderbox", "", 1],
		["Torch", 3, 1]
	],
	equipright : [
		["Common clothes", "", 3],
		["Trinket of special significance", "", ""]
	],
	feature : "Heart of Darkness",
	trait : [
		"I don't run from evil. Evil runs from me.",
		"I like to read and memorize poetry. It keeps me calm and brings me fleeting moments of happiness.",
		"I spend money freely and live life to the fullest, knowing that tomorrow I might die.",
		"I live for the thrill of the hunt.",
		"I don't talk about the thing that torments me. I'd rather not burden others with my curse.",
		"I expect danger around every corner.",
		"I refuse to become a victim, and I will not allow others to be victimized.",
		"I put no trust in divine beings."
	],
	ideal : [
		["Sacrifice", "Sacrifice: I try to help those in need, no matter what the personal cost. (Good)"],
		["Desperation", "Desperation: I'll stop the spirits that haunt me or die trying. (Any)"],
		["Cleansing", "Cleansing: I kill monsters to make the world a safer place, and to exorcise my own demons. (Good)"],
		["Vigilante", "Vigilante: I have a dark calling that puts me above the law. (Chaotic)"],
		["Preparation", "Preparation: I like to know my enemy's capabilities and weaknesses before rushing into battle. (Lawful)"],
		["Destruction", "Destruction: I'm a monster that destroys other monsters, and anything else that gets in my way. (Evil)"]
	],
	bond : [
		"I keep my thoughts and discoveries in a journal. My journal is my legacy.",
		"I would sacrifice my life and my soul to protect the innocent.",
		"My torment drove away the person I love. I strive to win back the love I've lost.",
		"A terrible guilt consumes me. I hope that I can find redemption through my actions.",
		"There's evil in me, I can feel it. It must never be set free.",
		"I have a child to protect. I must make the world a safer place for him (or her)."
	],
	flaw : [
		"I have certain rituals that I must follow every day. I can never break them.",
		"I assume the worst in people.",
		"I feel no compassion for the dead. They're the lucky ones.",
		"I have an addiction.",
		"I am a purveyor of doom and gloom who lives in a world without hope.",
		"I talk to spirits that no one else can see."
	],
	extra : [
		"Select a Harrowing Event",
		"Monster spared my life",
		"Born under a dark star",
		"Haunted by an apparition",
		"Dark arts in the family",
		"An oni took my sibling",
		"Memory of cured lycanthropy",
		"Raised by a hag",
		"Studied an eldritch tome",
		"Formerly possessed by a fiend",
		"Avenged a murder"
	]
};
BackgroundList["black fist double agent"] = {
	regExpSearch : /black\W*fist/i,
	name : "Black Fist Double Agent",
	source : [["AL:CoS", 2], ["ALbackground", 0]],
	skills : ["Deception", "Insight"],
	gold : 15,
	equipleft : [
		["Disguise kit", "", 3],
		["Tears of Virulence emblem", "", ""],
		["Writ of free agency", "", ""],
		["Set of artisan's tools or gaming set", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Double Agent",
	trait : [
		"People are only as trustworthy as you are valuable to them. Always strive to be the most valuable person around.",
		"My eloquence and sophistication are tools I use to avoid arousing suspicion myself.",
		"I am a thrill-seeker, excited by covert and dangerous missions.",
		"I live by my wits and always check every lock twice, just to be certain.",
		"I never admit to my mistakes lest they be used against me.",
		"I take every effort to be unnoticeable and blend into the crowd. Passersby rarely give me a second look.",
		"I am prepared for any eventuality; including the day my usefulness as a spy comes to an end.",
		"I always make certain to know my enemy before acting, lest I bite off more than I can chew."
	],
	ideal : [
		["Suspicious", "Suspicious: In my experience, everybody has something to hide, and what they hide can usually hurt me. (Any)"],
		["Secretive", "Secretive: I trade in secrets, and am not about to let any of mine slip. (Any)"],
		["Hedonist", "Hedonist: Life is short. I live my life to the fullest, as I know any day could be my last. (Chaotic)"],
		["Selfless", "Selfless: I use my position to help the downtrodden avoid persecution from the authorities. (Good)"],
		["Patriotic" , "Patriotic: I am a loyal supporter of Phlan and its leaders, and see my role as a solemn duty and necessary evil to prevent anarchy. (Lawful)"],
		["Manipulative", "Manipulative: I use my knowledge to blackmail and manipulate others to my own benefit. (Evil)"]
	],
	bond : [
		"I was framed for a crime I did not commit, and seek to bring the true culprit to justice.",
		"I am a part of an underground network that smuggles innocent civilians out of the city prior to being raided by the authorities.",
		"I miss the glory days of Phlan, before the coming of the dragon.",
		"I seek to prove myself worthy of joining the Black Fist as a member of their order.",
		"My sister was killed by a Tear of Virulence, and now I feed them false information whenever possible.",
		"My family was wrongly imprisoned, and I act as an informant in order to secure their release."
	],
	flaw : [
		"I think too highly of myself, and have an exaggerated sense of self-importance.",
		"I have difficulty trusting strangers. I see spies and informants everywhere.",
		"Years of getting away with minor crimes has left me believing that I am above the law, and have diplomatic immunity above my station.",
		"Years of seeing innocent people suffer have left me despondent and pessimistic for the future.",
		"My desire for vengeance often gets me into trouble",
		"I am spendthrift, and share my wealth with the patrons of my favorite tavern."
	],
	toolProfs : ["Disguise Kit", ["Artisan's tools or gaming set", 1]],
	lifestyle : "modest"
};
BackgroundList["dragon casualty"] = {
	regExpSearch : /^(?=.*dragon)(?=.*casualty).*$/i,
	name : "Dragon Casualty",
	source : [["AL:CoS", 3], ["ALbackground", 0]],
	skills : ["Intimidation", "Survival"],
	toolProfs : ["Based on my origin"],
	gold : 5,
	equipleft : [
		["Loaf of moldy bread", "", 1],
		["Cast-off Vorgansharax scale", "", ""]
	],
	equipright : [
		["Tattered Rags", "", 3],
		["Dagger", "", 1],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Dragonscarred",
	extra : [
		"Select an Origin (or Disfigurement)",
		"Dockworker",
		"Fisherman",
		"Tradesperson",
		"Merchant",
		"Black Fist Soldier",
		"Adventurer",
		"Visitor",
		"Entertainer",
		"Scholar",
		"Healer",
		"Criminal",
		"Unskilled laborer",
		"",
		"- Disfigurements (optional):",
		"Extensive scarring",
		"Small non-functional wing(s)",
		"Misshapen, wing-like membrane(s)",
		"Elongated, claw-like hand(s) or feet",
		"Painful green scales embedded in skin",
		"Bulbous, reptilian eye(s)",
		"Enlarged dorsal spines",
		"Small irregular spines instead of hair"
	],
	trait : [
		"I am driven to escape my past, and rarely stay in one place long.",
		"I know secrets of the Maimed Virulence, but fear the harm that may befall me should others learn them.",
		"Speaking of my ordeal helps sooth the still open wounds in my soul.",
		"My former life is meaningless, and was ripped to shreds by the claws of Vorgansharax. All that matters now is what I do with the future.",
		"I have faced the worst a dragon can deliver and survived. I am fearless, and my resolve unshakable.",
		"I am haunted my tortured past, and wake at night screaming at half-remembered horrors.",
		"I sleep with my back to a wall or tree, and a weapon within arm's reach.",
		"I am slow to trust, but incredibly loyal to those who have earned it."
	],
	ideal : [
		["Survivor", "Survivor: No matter the cost, I will take any action necessary to survive (any)"],
		["Independence", "Independence: When in trouble, the only person I can rely on is myself (Chaotic)"],
		["Compassionate", "Compassionate: I have suffered long at the hands of a Dragon, and take pity and compassion on the suffering of others (Good)"],
		["Secretive", "Secretive: I am withdrawn, and hide my monstrous appearance for fear of drawing unwanted attention. (Chaotic)"],
		["Justice", "Justice: I have been wronged, and will not allow the same fate to befall others. (Lawful)"],
		["Sycophant", "Sycophant: During my ordeal, I became a willing servant of the Maimed Virulence, and spy on his behalf. (Evil)"]
	],
	bond : [
		"I have sworn vengeance on the Maimed Virulence and those that follow him.",
		"I long to reunite with friends and family who may dwell among the Phlan Refugees, and protect them.",
		"While a prisoner of the Maimed Virulence, I overheard rumors of an item or treasure the Dragon seeks. I will have that treasure for myself!",
		"I seek to reclaim and rebuild my former life to the best of my ability.",
		"I have been reborn as a child of Vorgansharax. I will claim my birthright as his chosen heir and successor.",
		"I attribute my survival to the work of the divine, and seek to prove myself worthy of the honor."
	],
	flaw : [
		"I have been touched with dragon-greed, and have a lust for wealth which can never be satisfied.",
		"I secretly believe others are plotting to harm me.",
		"I no longer enjoy the simple pleasures in life. Food is but ashes and bile in my throat.",
		"Anyone who refuses to celebrate my celebrity does not deserve my company.",
		"I am paranoid and overly suspicious of others. Anyone may be an agent of the Maimed Virulence.",
		"Once I make up my mind, I follow my chosen course of action regardless of the consequences."
	],
	languageProfs : ["Draconic"],
	lifestyle : "wretched"
};
BackgroundList["iron route bandit"] = {
	regExpSearch : /^(?=.*iron)(?=.*route)(?=.*bandit).*$/i,
	name : "Iron Route Bandit",
	source : [["AL:CoS", 5], ["ALbackground", 0]],
	skills : ["Animal Handling", "Stealth"],
	toolProfs : [["Gaming set", 1], "Vehicles (land)"],
	gold : 5,
	equipleft : [
		["Backpack, with:", "", 5],
		["Bag of 1000 ball bearings", 1, 2],
		["String, feet of", 10, ""],
		["Bell", "", ""],
		["Candles", 5, ""],
		["Crowbar", "", 5],
		["Hammer", "", 3],
		["Pitons", 10, .25],
		["Hooded lantern", "", 2],
		["Oil, flasks of", 2, 1],
		["Rations, days of", 5, 2],
		["Tinderbox", "", 1],
		["Waterskin", "", 5],
		["Hempen rope, feet of", 50, 0.2]
	],
	equipright : [
		["Dark common clothes", "", 3],
		["Pack Saddle", "", ""],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Black-Market Breeder",
	trait : [
		"If people leave their gear unsecured, they must not want it very much.",
		"I feel more comfortable sleeping under the open sky.",
		"I always pre-plan my escape should things go bad; I always like to have an exit strategy.",
		"I tend to give animal owners breeding and care advice whether or not they want it.",
		"I lost a pet as a child and sadly reflect on it to this day.",
		"I always form a powerful, emotional bond with my mount.",
		"I recoil at the thought of killing someone else's pet or mount.",
		"I prefer to hang to the back of a scuffle or discussion. Better to have my enemies in front of me."
	],
	ideal : [
		["Loyalty", "Loyalty: Never bite the hand that feeds. (Good)"],
		["Unpredictability", "Unpredictability: Keep your enemy guessing and off-balance like a confused deer. (Chaotic)"],
		["Power", "Power: I strive to become leader of the pack at all costs. (Lawful)"],
		["Freedom", "Freedom: I bow to no one I don't respect. (Chaotic)"],
		["Resourcefulness", "Resourcefulness: Our wits are our most valuable resource in troubled times. (Any)"],
		["Unity", "Unity: Lone wolves fail where the pack succeeds. (Any)"]
	],
	bond : [
		"I cannot leave a harmed animal behind; I must save it or put it out of its misery.",
		"I leave behind my own personal calling cards when I do a job.",
		"I do not trust people who do not have a pet, mount, or furry companion.",
		"The pelt I wear on my back was from an animal that died saving my life, I will always cherish it.",
		"If my pet does not like you, I do not like you!",
		"Once you've ridden with me and fought by my side, I'll be there for you odds be damned."
	],
	flaw : [
		"I talk to animals; I believe they understand me, even if they do not.",
		"I growl at and bite anyone who gets too close to my food while I am eating.",
		"I strongly dislike enclosed spaces and require intoxication or firm encouragement to enter them.",
		"I robbed the wrong caravan once. The owner is a powerful merchant who holds a grudge.",
		"I'm an inveterate gambler.",
		"I judge people based on how well they stand their ground in a fight. I got not time for cowards…"
	],
	lifestyle : "poor"
};
BackgroundList["phlan insurgent"] = {
	regExpSearch : /^(?=.*phlan)(?=.*insurgent).*$/i,
	name : "Phlan Insurgent",
	source : [["AL:CoS", 6], ["ALbackground", 0]],
	skills : ["Stealth", "Survival"],
	toolProfs : [["Artisan's tools", 1], "Vehicles (land)"],
	gold : 5,
	equipleft : [
		["Caltrops", 20, 0.1],
		["Small trinket of my life before", "", ""],
		["Healer's kit", "", 3]
	],
	equipright : [
		["Dark common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Guerilla",
	extra : [
		"Select an Origin",
		"Fisher",
		"Hunter",
		"Craftsperson",
		"Priest/Priestess",
		"Cook",
		"City Watch",
		"Servant",
		"Unskilled laborer",
		"Stojanow river worker",
		"Twilight Marsh worker",
		"Mantor's Library scribe",
		"Clergy of Ilmater",
		"Laughing Goblin server",
		"Black Fist guard",
		"House Sokol retainer",
		"Bay of Phlan dockworker"
	],
	trait : [
		"My patience knows no bounds, so long as my goal is in sight.",
		"In life and in struggle, the ends justify my actions.",
		"If you aren't helping me, you'd best at least stay out of my way.",
		"I long for the life that was taken away from me.",
		"Friends and family perished, tragically, before my eyes. I hope never to undergo that again.",
		"Making the right choices in life are important to me. The choices I make might save not just my life, but the lives of others as well.",
		"I can never allow my foes to get the drop on me.",
		"Time is a precious resource that I must spend wisely."
	],
	ideal : [
		["Leadership", "Leadership: The oppressed need someone to inspire them to courageous acts. (Good)"],
		["Unpredictability", "Unpredictability: Keeping the enemy guessing and off-balance is my tactical strength. (Chaos)"],
		["Determination", "Determination: Threats to my home must be eliminated at all costs. (Any)"],
		["Freedom", "Freedom: Those who are enslaved and unjustly imprisoned deserve my aid. (Good)"],
		["Resourcefulness", "Resourcefulness: Our wits are our most valuable resource in troubled times. (Any)"],
		["Unity", "Unity: Working together, we can overcome all obstacles, even the most seemingly insurmountable ones. (Any)"]
	],
	bond : [
		"I'll never let my fellow insurgents down. They are my only remaining friends.",
		"I was separated from a loved one during my escape from town. I will find them.",
		"One of the Tears of the Virulence was a trusted friend, until the day they betrayed the city. They will pay harshly for their transgressions.",
		"An item I hold close is my last remaining connection to the family I lost during the fall.",
		"The dragon who took my past life away from me will feel the full extent of my vengeance.",
		"The knowledge in Mantor's Library is an irreplaceable treasure that must be protected."
	],
	flaw : [
		"I have no respect for those who flee. I harbor a deep grudge against the citizens who abandoned Phlan.",
		"Ale is the only way I can escape the desperation of my circumstances.",
		"It doesn't take much to get me into a fight.",
		"Being an insurgent means doing things that aren't always ethical. I'm still learning to live with that.",
		"My desire to liberate Phlan oftentimes clouds my judgement, despite my best efforts.",
		"I relentlessly despise the Maimed Virulence and his allies. I'd abandon other goals in order to strike out at them"
	],
	lifestyle : "poor"
};
BackgroundList["stojanow prisoner"] = {
	regExpSearch : /^(?=.*stojanow)(?=.*prisoner).*$/i,
	name : "Stojanow Prisoner",
	source : [["AL:CoS", 8], ["ALbackground", 0]],
	skills : ["Deception", "Perception"],
	toolProfs : [["Gaming set", 1], ["Thieves' tools", "Dex"]],
	gold : 10,
	equipleft : [
		["Small knife", "", 0.25],
		["Small trinket from my life before", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Ex-Convict",
	trait : [
		"I am a bully; others will suffer as I have.",
		"I always say yes even when I mean no; it's just easier.",
		"I aim to misbehave.",
		"I go out of my way to frustrate or anger those in power.",
		"I strive to obey the law. I will never again make the mistake of going against authority.",
		"I always plan everything out. The one time I let others plan things it did not end well for me.",
		"I take blame to protect others from pain.",
		"I horde information, you never know what may come in handy."
	],
	ideal : [
		["Loss", "Loss: I freely give those who offend me what was so brutally denied me, death. (Chaos)"],
		["Dedication", "Dedication: I never betray those who trust me. (Law)"],
		["Vengeance", "Vengeance: I use any means to get information I need; I have been well taught. (Evil)"],
		["Redemption", "Redemption: Everyone deserves a second chance. (Good)"],
		["Resilience", "Resilience: I can survive any challenge. (Any)"],
		["Leadership", "Leadership: The best teams are made up of those that society has discarded. (Any)"]
	],
	bond : [
		"I take up arms to help establish a free Phlan.",
		"The horrors of my time in Stojanow haunt my dreams, only after a day of hard work can I find sleep.",
		"I am indebted to those who freed me from prison, I will repay this debt.",
		"My torturer survived the attack that set me free, I will find him/her.",
		"I will not rest while others suffer fates similar to mine.",
		"I am searching for a way to heal the scars of Stojanow, both physical and emotional."
	],
	flaw : [
		"During stressful times, I find myself crying for no reason.",
		"My nerve endings are shot from the interrogations; I am numb to all but the harshest touch.",
		"I am incapable of standing up for myself.",
		"I folded under the torture, and gave information that I promised would be kept secret. My life would be in jeopardy if others found out.",
		"Survival is worth more than friendship.",
		"The ghosts from my past hinder my actions."
	],
	lifestyle : "poor"
};
BackgroundList["ticklebelly nomad"] = {
	regExpSearch : /^(?=.*ticklebelly)(?=.*nomad).*$/i,
	name : "Ticklebelly Nomad",
	source : [["AL:CoS", 9], ["ALbackground", 0]],
	skills : ["Animal Handling", "Nature"],
	toolProfs : ["Herbalism Kit"],
	gold : 5,
	equipleft : [
		["Herbalism kit", "", 3],
		["Small tribal jewelry", "", ""],
		["Hunting trap", "", 25]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "At Home in the Wild",
	trait : [
		"I eagerly inject myself into the unknown.",
		"Villages, towns, and cities do not suit me. I'd rather be out in the wilderness any day.",
		"I accomplish my tasks efficiently, using as few resources as possible.",
		"It's difficult for me to remain in one place for long.",
		"I loudly brag about my tribe every chance I get.",
		"Having walked among giants, I am fearless in the face of bigger creatures.",
		"I am quiet and reserved, but observant. Nothing escapes my attention.",
		"My word is my bond. I see a promise to completion, even if it conflicts with my beliefs."
	],
	ideal : [
		["Kinship", "Kinship: Family is most important in life. Though I may be far from my own, the bonds of family must be protected in others' lives as well. (Good)"],
		["Preservation", "Preservation: Nature must not be despoiled by encroaching civilization. (Any)"],
		["Wanderlust", "Wanderlust: One must expand their horizons by seeing the world and exploring. (Chaos)"],
		["Isolation", "Isolation: My tribe and its ways must be protected and shielded from outside influence. (Neutral)"],
		["Protection", "Protection: Threats to the land and to the people must be dealt with at any and all costs. (Law)"],
		["Belonging", "Belonging: All creatures have a place in the world, so I strive to help others find theirs. (Good)"]
	],
	bond : [
		"I ache to return to my tribe and the family I left, but cannot until my obligations are fulfilled.",
		"The dragon cultists that invaded my homeland stole away one of my tribe's people. I will not know rest until I've found them.",
		"The dragon's presence in the hills destroyed valuable territory and resulted in deaths within my tribe. The creature must pay for what it has done.",
		"I carry a trinket that spiritually and emotionally ties me to my people and my home.",
		"I discovered a strange relic in the hills during my tribe's wanderings. I must discover what it is.",
		"One of the stone giant clans from the Giant's Cairn has graced me with a mark of kinship."
	],
	flaw : [
		"I throw myself and my friends into situations rarely ever thinking about consequences.",
		"Unfamiliar people and surroundings put me on edge.",
		"I have absolutely no patience for slowpokes and those who prove indecisive.",
		"My desire to experience new things causes me to make unsafe choices.",
		"I am overly protective of nature, sometimes to the detriment of my companions and myself.",
		"My lack of worldliness often proves my undoing in social, commercial, and hostile situations."
	],
	languageProfs : ["Giant"],
	lifestyle : "poor"
};

// Background features
BackgroundFeatureList["at home in the wild"] = {
	description : "In the wilderness, my home, I can find a place to hide, rest, or recuperate that is secure enough to conceal me from most natural threats, but not all supernatural, magical, or threats that actively seek me out. However, this feature doesn't shield or conceal me from scrying, mental probing, nor from threats that don't need the five senses to find me.",
	source : [["AL:CoS", 9], ["ALbackground", 0]]
};
BackgroundFeatureList["black-market breeder"] = {
	description : "I know how to find people who are always looking for stolen animals and vehicles, for pit fights or getaways during an illegal job. This provides me with information of what such animals & vehicles are in high demand in the area, but also offer to give me favors and information (DM choice) if I bring such animals and vehicles to them.",
	source : [["AL:CoS", 5], ["ALbackground", 0]]
};
BackgroundFeatureList["double agent"] = {
	description : "I have a trusty contact in the Tears of Virulence garrison in Phlan to whom I pass information. In exchange, I get away with minor criminal offenses in Phlan. My Black Fists contacts can help me get an audience with the Lord Regent, the Lord Sage, Black Fists members, or deposed nobles who are sympathetic to the Phlan refugees and insurgents.",
	source : [["AL:CoS", 2], ["ALbackground", 0]]
};
BackgroundFeatureList["dragonscarred"] = {
	description : "My extensive scars from being tortured by Vorgansharax give me fame and notoriety, but it is difficult to disguise my appearance and hide from prying eyes. I can use this to gain access to people and places I might not otherwise have, for me and my companions. However, I fear that my afflictions are not completely mundane, as they burn and writhe.",
	source : [["AL:CoS", 3], ["ALbackground", 0]]
};
BackgroundFeatureList["ex-convict"] = {
	description : "The knowledge gained during my incarceration lets me gain insight into local guards and jailors. I know which will accept bribes, or look the other way for me. I can also seek shelter for myself from authorities with other criminals in the area.",
	source : [["AL:CoS", 8], ["ALbackground", 0]]
};
BackgroundFeatureList["guerilla"] = {
	description : "I've come to know the surrounding other natural features in which I can take refuge--or set up ambushes. I can quickly survey my environment for advantageous features. Additionally, I can scavenge around my natural surroundings to cobble together simple supplies (such as improvised torches, rope, patches of fabric, etc.) that are consumed after use.",
	source : [["AL:CoS", 6], ["ALbackground", 0]]
};
BackgroundFeatureList["heart of darkness"] = {
	description : "Those who look into my eyes can see that I have faced unimaginable horror and that I am no stranger to darkness. Though they might fear me, commoners will extend me every courtesy and do their utmost to help. Unless I have shown myself to be a danger to them, they will even take up arms to fight with me, should I find myself facing an enemy alone.",
	source : [["CoS", 209], ["VRGtR", 34], ["ALbackground", 0]]
};

// Equipment pack
PacksList.monsterhunter = {
	name : "Monster hunter's pack (33 gp)",
	source : [["CoS", 209], ["VRGtR", 34]],
	items : [
		["Chest, with:", "", 25],
		["Crowbar", "", 5],
		["Hammer", "", 3],
		["Wooden stake", 3, 1],
		["Amulet holy symbol", "", ""],
		["Holy water, flasks of", 1, 1],
		["Manacles", "", 6],
		["Steel mirror", "", 0.5],
		["Oil, flasks of", 1, 1],
		["Tinderbox", "", 1],
		["Torches", 3, 1]
	]
};

// Magic Items
MagicItemsList["plantslayer battleaxe"] = {
	name : "Plantslayer Battleaxe", // name taken from Adventurers League Content Catalogue v8.07, page 28
	nameAlt : "Adventurer's Battleaxe",
	source : [["CoS", 198]],
	type : "weapon (battleaxe)",
	rarity : "rare",
	magicItemTable : "F",
	description : "This battleaxe's handle is carved with leaves and vines. It deals an extra 1d8 slashing damage against ordinary plants and plant creatures. When a creature of non-good alignment makes an attack with it, it sprouts thorns, dealing 1 magical piercing damage to the wielder after the attack is made.",
	descriptionFull : "The axe's handle is carved with leaves and vines, and it weighs half as much as a normal battleaxe. When the axe hits a plant, whether an ordinary plant or a plant creature, the target takes an extra 1d8 slashing damage. When a creature of non-good alignment wields the axe, it sprouts thorns whenever its wielder makes an attack with it. These thorns prick the wielder for 1 piercing damage after the attack is made, and this damage is considered magical.",
	weight : 2,
	weaponOptions : [{
		baseWeapon : "battleaxe",
		regExpSearch : /^(?=.*plantslayer)(?=.*battleaxe).*$/i,
		name : "Plantslayer Battleaxe",
		source : [["CoS", 198]],
		description : "Versatile (1d10); +1d8 damage vs. plants",
		weight : 2,
		selectNow : true
	}]
}
MagicItemsList["blood spear"] = {
	name : "Blood Spear",
	source : [["CoS", 221]],
	type : "weapon (spear)",
	rarity : "uncommon",
	magicItemTable : "G",
	description : "This spear drains the life from those it kills and transfers that life to its wielder, imbuing that individual with the stamina to keep fighting. When I use it to reduce the target to 0 HP, I gain 2d6 temporary HP. If I'm chosen by Kavan to wield this spear, I gain a +2 bonus to attack and damage rolls made with it.",
	descriptionFull : "Kavan was a ruthless chieftain whose tribe lived in the Balinok Mountains centuries before the arrival of Strahd von Zarovich. Although he was very much alive, Kavan had some traits in common with vampires: he slept during the day and hunted at night, he drank the blood of his prey, and he lived underground. In battle, he wielded a spear stained with blood. His was the first blood spear, a weapon that drains life from those it kills and transfers that life to its wielder, imbuing that individual with the stamina to keep fighting.\n   When you hit with a melee attack using this magic spear and reduce the target to 0 hit points, you gain 2d6 temporary hit points.\n   Any creature can wield the spear, but only the character chosen by Kavan to wield it gains a +2 bonus to attack and damage rolls made with this magic weapon.",
	attunement : true,
	weight : 3,
	choices : ["Chosen of Kavan", "Not a chosen of Kavan"],
	choicesNotInMenu : true,
	"chosen of kavan" : {
		name : "Blood\u200A Spear",
		weaponOptions : [{
			baseWeapon : "spear",
			regExpSearch : /^(?=.*blood)(?=.*spear).*$/i,
			name : "Blood Spear",
			source : [["CoS", 221]],
			description : "Thrown, versatile (1d8); If used to reduce target to 0 HP, I gain 2d6 temp HP",
			modifiers : [2, 2],
			selectNow : true
		}]
	},
	"not a chosen of kavan" : {
		name : "Blood\u200A\u200A Spear",
		weaponOptions : [{
			baseWeapon : "spear",
			regExpSearch : /^(?=.*blood)(?=.*spear).*$/i,
			name : "Blood Spear",
			source : [["CoS", 221]],
			description : "Thrown, versatile (1d8); If used to reduce target to 0 HP, I gain 2d6 temp HP",
			selectNow : true
		}]
	}
}
MagicItemsList["green copper ewer"] = {
	name : "Green Copper Ewer",
	source : [["CoS", 188]],
	type : "wondrous item",
	rarity : "unknown",
	description : "Any poisonous liquid poured into the ewer is instantly transformed into an equal amount of sweet wine. If I speak the ewer's command word while grasping its handle, the ewer fills with 1 gallon of wine. After doing so, it can't produce more wine until the next dawn.",
	descriptionFull : "Any poisonous liquid poured into the ewer is instantly transformed into an equal amount of sweet wine. Furthermore, a creature that grasps the ewer's handle can command the ewer to fill with 1 gallon of wine, and it can't produce more wine until the next dawn."
}
MagicItemsList["gulthias staff"] = {
	name : "Gulthias Staff",
	source : [["CoS", 221]],
	type : "staff",
	rarity : "rare",
	magicItemTable : "G",
	description : "This black wooden quarterstaff has 10 charges, regaining 1d6+4 at dusk. When I hit with it in melee, I can use 1 charge to regain HP equal to the damage dealt, but I must make a DC 12 Wis save or be afflicted by short-term madness (DMG 259). While attuned to it, evil plant creatures are indifferent to me.",
	descriptionLong : "This spongy, black wooden quarterstaff has 10 charges, regaining 1d6+4 at dusk. When I hit with it in melee, I can use 1 charge to regain HP equal to the damage dealt, but I must make a DC 12 Wis save or be afflicted by short-term madness (see table at SRD 201 or DMG 259). While I'm attuned to the staff, evil plant creatures don't regard me as hostile unless I harm them. If it is broken or burned to ashes, it releases an inhuman scream that can be heard out to 300 ft. All blights that can hear the scream immediately wither and die.",
	descriptionFull : "Made from the branch of a Gulthias tree (see the blights entry of the Monster Manual), a Gulthias staff is a spongy, black length of wood. Its evil makes beasts visibly uncomfortable while within 30 feet of it. The staff has 10 charges and regains 1d6+4 of its expended charges daily at dusk.\n   If the staff is broken or burned to ashes, its wood releases a terrible, inhuman scream that can be heard out to a range of 300 feet. All blights that can hear the scream immediately wither and die.\n   " + toUni("Vampiric Strike") + ". The staff can be wielded as a magic quarterstaff. On a hit, it deals damage as a normal quarterstaff, and you can expend 1 charge to regain a number of hit points equal to the damage dealt by the weapon. Each time a charge is spent, red blood oozes from the staff's pores, and you must succeed on a DC 12 Wisdom saving throw or be afflicted with short term madness (see \"Madness\" in chapter 8 of the Dungeon Master's Guide).\n   " + toUni("Blight Bane") + ". While you are attuned to the staff, blights and other evil plant creatures don't regard you as hostile unless you harm them.",
	attunement : true,
	weight : 4,
	usages : 10,
	recovery : "Dusk",
	additional : "regains 1d6+4",
	weaponOptions : [{
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*gulthias)(?=.*staff).*$/i,
		name : "Gulthias Staff",
		source : [["CoS", 221]],
		description : "Versatile (1d8); On hit, 1 charge to regain HP equal to damage dealt but DC 12 Wis save or madness",
		selectNow : true
	}]
}
MagicItemsList["holy symbol of ravenkind"] = {
	name : "Holy Symbol of Ravenkind",
	source : [["CoS", 222]],
	type : "wondrous item",
	rarity : "legendary",
	storyItemAL : true,
	prerequisite : "Requires attunement by a cleric or paladin of good alignment",
	prereqeval : function(v) { return (/good/i).test(What("Alignment")) && (classes.known.cleric || classes.known.paladin); },
	description : "This platinum amulet has 10 charges, regaining 1d6+4 at dawn. As an action, I can use 1 charge to hold vampires (see 3rd page notes). I can use 3 charges with Turn Undead to give disadv. on its saves. As an action, ican use 5 charges to shed daylight, 30-ft radius bright light and dim light for another 30-ft for 10 minutes.",
	descriptionFull : "The Holy Symbol of Ravenkind is a unique holy symbol sacred to the good-hearted faithful of Barovia. It predates the establishment of any church in Barovia. According to legend, it was delivered to a paladin named Lugdana by a giant raven - or an angel in the form of a giant raven. Lugdana used the holy symbol to root out and destroy nests of vampires until her death. The high priests of Ravenloft kept and wore the holy symbol after Lugdana's passing.\n   The holy symbol is a platinum amulet shaped like the sun, with a large crystal embedded in its center.\n   The holy symbol has 10 charges for the following properties. It regains 1d6+4 charges daily at dawn.\n   " + toUni("Hold Vampires") + ". As an Action, you can expend 1 charge and present the holy symbol to make it flare with holy power. Vampires and vampire spawn within 30 feet of the holy symbol when it flares must make a DC 15 Wisdom saving throw. On a failed save, a target is paralyzed for 1 minute. It can repeat the saving throw at the end of its turns to end the effect on itself.\n   " + toUni("Turn Undead") + ". If you have the Turn Undead or the Turn the Unholy feature, you can expend 3 charges when you present the holy symbol while using that feature. When you do so, undead have disadvantage on their saving throws against the effect.\n   " + toUni("Sunlight") + ". As an action, you can expend 5 charges while presenting the holy symbol to make it shed bright light in a 30-foot radius and dim light for an additional 30 feet. The light is sunlight and lasts for 10 minutes or until you end the effect (no action required).",
	attunement : true,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	action : [["action"]],
	toNotesPage : [{
		name : "Hold Vampires",
		page3notes : true,
		note : [
			"As an action, I can use 1 charge to have all vampires within 30 ft make a DC 15 Wis save",
			"If failed, a target is paralyzed for 1 minute but can repeat the save at the end of its turns"
		],
		additional : "1 charge"
	}]
}
MagicItemsList["icon of ravenloft"] = {
	name : "Icon of Ravenloft",
	source : [["CoS", 222]],
	type : "wondrous item",
	rarity : "legendary",
	storyItemAL : true,
	prerequisite : "Requires attunement by a creature of good alignment",
	prereqeval : function(v) { return (/good/i).test(What("Alignment")); },
	description : "All within 30 ft of this silver statue are under the effect of Protection from Evil and Good that works against fiends and undead. As an action while attuned to it, I can cast Augury or Cure Wounds (3d8+3, 30 ft range) from it, each once per dawn and if I use it for my Turn Undead, the DC increases by 2.",
	descriptionFull : "The Icon of Ravenloft is a 12-inch tall statuette made of the purest silver, weighing 10 pounds. It depicts a cleric kneeling in supplication.\n   The icon was given to Strahd by the archpriest Ciril Romulich, an old family friend, to consecrate the castle and its chapel.\n   While within 30 feet of the icon, a creature is under the effect of a Protection from Evil and Good spell against fiends and undead. Only a creature attuned to the icon can use its other properties.\n   " + toUni("Augury") + ". You can use an action to cast an Augury spell from the icon, with no material components required. Once used, this property can't be used again until the next dawn.\n   " + toUni("Bane of the Undead") + ". You can use the icon as a holy symbol while using the Turn Undead or Turn the Unholy feature. If you do so, increase the save DC by 2.\n   " + toUni("Cure Wounds") + ". While holding the icon, you can take an action to heal one creature that you can see within 30 feet of you. The target regains 3d8+3 hit points, unless it is an undead, a construct, or a fiend. Once used, this property can't be used again until the next dawn.",
	attunement : true,
	weight : 10,
	extraLimitedFeatures : [{
		name : "Icon of Ravenloft [Augury]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Icon of Ravenloft [Cure Wounds]",
		usages : 1,
		recovery : "dawn"
	}],
	spellcastingBonus : [{
		name : "All in 30 ft",
		spells : ["protection from evil and good"],
		selection : ["protection from evil and good"],
		firstCol : "markedbox"
	}, {
		name : "Once per dawn",
		spells : ["augury", "cure wounds"],
		selection : ["augury", "cure wounds"],
		firstCol : "oncelr",
		times : 2
	}],
	spellChanges : {
		"protection from evil and good" : {
			range : "30-ft rad",
			time : "Always",
			description : "All in range immune to fear, charm, and possession by fiends and undead, they also disadv. on attacks",
			duration : "Unlimited",
			changes : "All within 30 ft of the Icon of Ravenloft have this spell protect them from undead and fiends."
		},
		"augury" : {
			time : "1 a",
			changes : "Using the Icon of Ravenloft, it only takes an action to cast."
		},
		"cure wounds" : {
			range : "30 ft",
			description : "1 living creature heals 3d8+3 HP if it not an undead, construct, or fiend",
			dynamicDamageBonus : { doNotProcess : true },
			changes : "Using the Icon of Ravenloft, it has a range of 30 ft and always heals 3d8+3 HP, but can't affect undead, a construct, or a fiend."
		}
	}
}
MagicItemsList["lost sword"] = {
	name : "Lost Sword",
	source : [["CoS", 81]],
	type : "weapon (shortsword)",
	rarity : "very rare",
	magicItemTable : "G",
	prerequisite : "Requires attunement by a creature of lawful good alignment",
	prereqeval : function(v) { return (/^(?=.*lawful)(?=.*good).*$/i).test(What("Alignment")); },
	description : "This lawful good shortsword is sentient (Int 11, Wis 13, Cha 13). It adds +1 to hit and damage and shines bright light in a 15-ft radius and dim light for an additional 15 ft. Attuning to it takes only 1 minute. Once per dawn, I can use it to cast Crusader's Mantle. Its purpose is to fight evil. See Notes page.",
	descriptionFull : "The Lost Sword is a sentient lawful good +1 shortsword (Intelligence 11, Wisdom 13, Charisma 13). It has hearing and normal vision out to a range of 120 feet. It communicates by transmitting emotion to the creature carrying or wielding it.\n   The sword's purpose is to fight evil. The sword has the following additional properties:\n \u2022 The sword continually sheds bright light in a 15-foot radius and dim light for an additional 15 feet. Only by destroying the sword can this light be extinguished.\n \u2022 A lawful good creature can attune itself to the sword in 1 minute.\n \u2022 While attuned to the weapon, the sword's wielder can use the sword to cast the Crusader's Mantle spell. Once used, this property of the sword can't be used again until the next dawn.",
	attunement : true,
	weight : 2,
	usages : 1,
	recovery : "dawn",
	additional : "Crusader's Mantle",
	weaponOptions : [{
		baseWeapon : "shortsword",
		regExpSearch : /^(?=.*lost)(?=.*sword).*$/i,
		name : "Lost Sword",
		source : [["CoS", 81]],
		modifiers : [1, 1],
		selectNow : true
	}],
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["crusader's mantle"],
		selection : ["protection from evil and good"],
		firstCol : "oncelr"
	},
	toNotesPage : [{
		name : "Features",
		note : desc([
			"The Lost Sword is a sentient lawful good +1 shortsword.",
			"A lawful good creature can attune itself to the sword in 1 minute.",
			"It continually sheds bright light in a 15-ft radius and dim light for an additional 15 ft. Only by destroying the sword can this light be extinguished.",
			"While attuned to the weapon, the sword's wielder can use the sword to cast the Crusader's Mantle spell. Once used, this property of the sword can't be used again until the next dawn.",
			"It has Intelligence 11, Wisdom 13, and Charisma 13 and can hear and see as a human out to a range of 120 ft. It communicates by transmitting emotion to the creature carrying or wielding it. The sword's purpose is to fight evil."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["saint markovia's thighbone"] = {
	name : "Saint Markovia's Thighbone",
	source : [["CoS", 222]],
	type : "weapon (mace)",
	rarity : "rare",
	description : "This mace sheds bright light in a 20-ft radius and dim light for another 20 ft while held. Fiends and undead hit with it take +2d6 radiant damage, become frightened of me until my next turn ends, and if below 26 HP after its damage, must make a DC 15 Wis save or die. If it hits an undead, it crumbles after the combat.",
	descriptionFull : "Saint Markovia's thighbone has the properties of a mace of disruption. If it scores one or more hits against a vampire or a vampire spawn in the course of a single battle, the thighbone crumbles into dust once the battle concludes.\n   As a youth, Markovia followed her heart and became a priest of the Morninglord soon after her eighteenth birthday. She proved to be a charismatic proselytizer and, before the age of thirty, had gained a reputation for allowing no evil to stand before her.\n   Markovia had long considered Strahd a mad tyrant, but only after his transformation into a vampire did she dare to challenge him. As she rallied her followers and prepared to march on Castle Ravenloft, Strahd sent a group of vampire spawn to her abbey. They confronted Markovia and were destroyed to a one.\n   Suffused with confidence born of a righteous victory, Markovia advanced on Castle Ravenloft. A great battle raged from the catacombs to the parapets. In the end, Markovia never returned to Barovia, and Strahd long afterward walked with a limp and a grimace of pain. It is said that he trapped Markovia in a crypt beneath his castle, and her remains linger there yet.\n   The essence of Markovia's saintliness passed partly into her bones as the rest of her body decomposed. Her remaining thighbone is imbued with power that inflicts grievous injury on the undead.\n   Mace of Disruption. When you hit a fiend or an undead with this magic weapon, that creature takes an extra 2d6 radiant damage. If the target has 25 hit points or fewer after taking this damage, it must succeed on a DC 15 Wisdom saving throw or be destroyed. On a successful save, the creature becomes frightened of you until the end of your next turn.\n   While you hold this weapon, it sheds bright light in a 20-foot radius and dim light for an additional 20 feet.",
	attunement : true,
	weight : 4,
	weaponOptions : [{
		baseWeapon : "mace",
		regExpSearch : /^(?=.*markovia)(?=.*thighbone).*$/i,
		name : "Saint Markovia's Thighbone",
		source : [["CoS", 222]],
		description : "Fiend/undead +2d6 radiant damage, frightened until my next turn ends, and if HP<26, DC 15 Wis save or die",
		selectNow : true
	}]
}
MagicItemsList["silver dragon shield +2"] = {
	name : "Silver Dragon Shield +2",
	source : [["CoS", 68]],
	type : "shield",
	rarity : "rare",
	description : "While holding this shield, I have a +2 bonus to AC. This bonus is in addition to the shield's normal bonus to AC. It is emblazoned with a stylized silver dragon that is the emblem of the Order of the Silver Dragon. The shield whispers warnings to me, granting me a +2 bonus to initiative while I am not incapacitated.",
	descriptionFull : "While holding this shield, you have a +2 bonus to AC. This bonus is in addition to the shield's normal bonus to AC.\n   The shield is emblazoned with a stylized silver dragon that is the emblem of the Order of the Silver Dragon (see Curse of Strahd, chapter 7). The shield whispers warnings to its bearer, granting a +2 bonus to initiative if the bearer isn't incapacitated.",
	weight : 6,
	shieldAdd : "Silver Dragon Shield +2",
	addMod : [{ type : "skill", field : "Init", mod : 2, text : "While I carry the Silver Dragon Shield, it whispers warnings to me, granting me a +2 bonus to initiative rolls." }]
}
MagicItemsList["statuette of saint markovia"] = {
	name : "Statuette of Saint Markovia",
	source : [["CoS", 152]],
	type : "wondrous item",
	rarity : "unknown",
	storyItemAL : true,
	description : "This golden statuette grants any good-aligned creature that carries it a +1 bonus to saving throws.",
	descriptionFull : "This golden statuette grants any good-aligned creature that carries it a +1 bonus to saving throws.",
	addMod : [{ type : "save", field : "all", mod : 1, text : "While I carry the Statuette of Saint Markovia, I gain a +1 bonus to all my saving throws." }]
}
MagicItemsList["sunsword"] = {
	name : "Sunsword",
	source : [["CoS", 223]],
	type : "weapon (longsword)",
	rarity : "legendary",
	storyItemAL : true,
	description : "As a bonus action, I can have this hilt create a blade of radiance. It acts like a longsword with +2 to hit and damage, does radiant damage (+1d8 to undead), has finesse, emits bright sunlight in a 15-ft radius and dim light in another 15 ft. As an action, I can change the light's radius by 5 ft. It is sentient, see Notes page.",
	descriptionLong : "As a bonus action, I can have this longsword hilt create or dismiss a blade of pure radiance. While the blade exists, it acts like a longsword that has +2 to attack and damage rolls, does radiant damage, and has the finesse property. It deals +1d8 damage to undead and emits sunlight, bright light in a 15-ft radius and dim light in an additional 15-ft radius. As an action, I can expand or reduce both the bright and dim light's radius by 5 ft each, to a maximum of 30 ft each or a minimum of 10 ft each. I'm proficient with it if I'm proficient with either longswords or shortswords. It is sentient, see Notes page.",
	descriptionFull : "The Sunsword is a unique blade once possessed by Strahd's brother, Sergei von Zarovich. In its original form, it had a platinum hilt and guard, and a thin crystal blade as strong as steel.\n   Strahd employed a powerful wizard named Khazan to destroy the weapon after Sergei's death. The first part of the process required the hilt and the blade to be separated, which Khazan accomplished. While Khazan was busying himself destroying the blade, his apprentice stole the hilt and fled. Khazan later located his apprentice's mutilated corpse in the Svalich Woods, but the hilt was nowhere to be found. To avoid the vampire's wrath, Khazan told Strahd that the entire weapon had been destroyed.\n   The hilt, which is sentient, knows that it can never be reunited with its original crystal blade. It has, however, gained the properties of a sun blade.\n   While grasping the hilt, you can use a bonus action to cause a blade of pure radiance to spring into existence, or make the blade disappear. While the blade exists, this magic longsword has the finesse property. If you are proficient with shortswords or longswords, you are proficient with the sun blade.\n   You gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When you hit an undead with it, that target takes an extra 1d8 radiant damage.\n   The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 feet. The light is sunlight. While the blade persists, you can use an action to expand or reduce its radius of bright and dim light by 5 feet each, to a maximum of 30 feet each or a minimum of 10 feet each.\n   " + toUni("Sentience") + ". The Sunsword is a sentient chaotic good weapon with an Intelligence of 11, a Wisdom of 17, and a Charisma of 16. It has hearing and normal vision out to a range of 60 feet. The weapon communicates by transmitting emotions to the creature carrying it or wielding it.\n   " + toUni("Personality") + ". The Sunsword's special purpose is to destroy Strahd, not so much because it wants to free the land of Barovia from evil but because it wants revenge for the loss of its crystal blade. The weapon secretly fears its own destruction.",
	attunement : true,
	weight : 3,
	action : [["bonus action", " (start/stop)"], ["action", " (change light)"]],
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /sunsword/i,
		name : "Sunsword",
		source : [["CoS", 223]],
		damage : [1, 8, "radiant"],
		description : "Finesse, versatile (1d10); +1d8 damage to undead",
		modifiers : [2, 2],
		selectNow : true
	}],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.name == "Sunsword" && !fields.Proficiency) {
					fields.Proficiency = CurrentProfs.weapon.otherWea && CurrentProfs.weapon.otherWea.finalProfs.indexOf("shortsword") !== -1;
				}
			}, ''
		]
	},
	toNotesPage : [{
		name : "Features",
		note : desc([
			"The Sunsword is a unique blade once possessed by Strahd's brother, Sergei von Zarovich. In its original form, it had a platinum hilt and guard, and a thin crystal blade as strong as steel.",
			"Strahd employed a powerful wizard named Khazan to destroy the weapon after Sergei's death. The first part of the process required the hilt and the blade to be separated, which Khazan accomplished. While Khazan was busying himself destroying the blade, his apprentice stole the hilt and fled. Khazan later located his apprentice's mutilated corpse in the Svalich Woods, but the hilt was nowhere to be found. To avoid the vampire's wrath, Khazan told Strahd that the entire weapon had been destroyed.",
			"The hilt, which is sentient, knows that it can never be reunited with its original crystal blade. It has, however, gained the properties of a sun blade. While grasping the hilt, I can use a bonus action to make a blade of pure radiance spring from the hilt, or cause the blade to disappear. While the blade exists, it functions as a magic longsword that has the finesse property. I'm proficient with it if I'm proficient with either shortswords or longswords.",
			"I gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When I hit an undead with it, that target takes an extra 1d8 radiant damage.",
			"The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 ft. The light is sunlight. As an action while the blade persists, I can expand or reduce its radius of bright and dim light by 5 ft each, to a maximum of 30 ft each or a minimum of 10 ft each.",
			"The Sunsword is a sentient chaotic good weapon with an Intelligence of 11, a Wisdom of 17, and a Charisma of 16. It has hearing and normal vision out to a range of 60 feet. The weapon communicates by transmitting emotions to the creature carrying it or wielding it.",
			"The Sunsword's special purpose is to destroy Strahd, not so much because it wants to free the land of Barovia from evil but because it wants revenge for the loss of its crystal blade. The weapon secretly fears its own destruction"
		]) + "\n\n" + sentientItemConflictTxt
	}]
}

// pub_20160906_SKT.js
// This file adds the beasts from the Storm King's Thunder adventure book to MPMB's Character Record Sheet

// Define the source
SourceList.SKT={
	name : "Storm King's Thunder [beasts, items]",
	abbreviation : "SKT",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/storm-kings-thunder",
	date : "2016/09/06"
};

// Creatures [Crag Cat removed, because it is a monstrosity according to 2020 errata https://media.wizards.com/2020/dnd/downloads/SKT-Errata.pdf ]
CreatureList["ice spider"] = { // contributed by Nod_Hero
	name : "Ice Spider",
	nameAlt : ["Spider, Ice"],
	source : [["SKT", 127]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 14,
	hp : 26,
	hd : [4, 10],
	speed : "30 ft, climb 30 ft",
	scores : [14, 16, 12, 2, 11, 4],
	skills : {
		"stealth" : 7
	},
	senses : "Blindsight 10 ft; Darkvision 60 ft",
	passivePerception : 10,
	languages : "",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 8, "piercing"],
		range : "Melee (5 ft)",
		description : "Target also takes 2d8 poison damage, half on a DC 11 Constitution saving throw"
	}, {
		name : "Icy Web (Recharge 5-6)",
		ability : 2,
		damage : ["\u2015", "", "Restrained"],
		range : "30/60 ft",
		description : "Target can escape as an action with a DC 12 Strength check, or by destroying the webbing (AC 10; 5 HP)",
		modifiers : ["", "", false],
		tooltip : "On a hit, the target is restrained by webbing and takes 1 cold damage at the start of each of its turns. As an action, the restrained target can make a DC 12 Strength check, bursting the webbing on a success. The webbing can also be attacked and destroyed (AC 10; hp 5; vulnerability to fire damage; immunity to poison and psychic damage)."
	}],
	traits : [{
		name : "Bite",
		description : "If the poison damage from the spider's bite attack reduces the target to 0 HP, the target is stable but poisoned for 1 hour, even after regaining HP, and is paralyzed while poisoned in this way."
	}, {
		name : "Spider Climb",
		description : "The spider can climb difficult surfaces, including upside down on ceilings, without needing to make an ability check."
	}, {
		name : "Web Sense",
		description : "While in contact with a web, the spider knows the exact location of any other creature in contact with the same web."
	}, {
		name : "Web Walker",
		description : "The spider ignores movement restrictions caused by webbing."
	}],
	actions : [{
		name : "Icy Web (Recharge 5-6)",
		description : "See attack. On a hit, the target is restrained by webbing and takes 1 cold damage at the start of each of its turns. As an action, the restrained target can make a DC 12 Strength check, bursting the webbing on a success. The webbing can also be attacked and destroyed (AC 10; hp 5; vulnerability to fire damage; immunity to bludgeoning, poison, and psychic damage)."
	}],
	wildshapeString : "Blindsight 10 ft; Darkvision 60 ft| If the bite's poison damage reduces the target to 0 HP, the target is stable but poisoned and paralyzed for 1 hour, even after regaining HP| Spider Climb: climb difficult surfaces, including upside down, without an ability check| Web Sense: knows the exact location of any other creature in contact with the same web| Web Walker: ignores movement restrictions from webbing"
};
CreatureList["sheep"] = {
	name : "Sheep",
	source : [["SKT", 142]],
	size : 4, //Small
	type : "Beast",
	alignment : "Unaligned",
	ac : 10,
	hp : 3,
	hd : [1, 6],
	speed : "30 ft",
	scores : [12, 10, 11, 2, 10, 5],
	senses : "",
	passivePerception : 10,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 0,
	attacks : [],
	traits : [{
		name : "Sure-Footed",
		description : "The sheep has advantage on Strength and Dexterity saving throws made against effects that would knock it prone."
	}]
};
CreatureList["pig"] = {
	name : "Pig",
	source : [["SKT", 143]],
	size : 3, //Medium
	type : "Beast",
	alignment : "Unaligned",
	ac : 10,
	hp : 5,
	hd : [1, 8],
	speed : "30 ft",
	scores : [13, 11, 12, 2, 9, 5],
	senses : "",
	passivePerception : 9,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 0,
	attacks : []
};
CreatureList["hulking crab"] = {
	name : "Hulking Crab",
	nameAlt : ["Crab, Hulking"],
	source : [["SKT", 240]],
	size : 1, //Huge
	type : "Beast",
	alignment : "Unaligned",
	ac : 17,
	hp : 76,
	hd : [8, 12], //[#, die]
	speed : "20 ft, swim 30 ft",
	scores : [19, 8, 16, 3, 11, 3], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 2
	},
	senses : "Blindsight 30 ft",
	passivePerception : 10,
	challengeRating : "5",
	proficiencyBonus : 3,
	attacksAction : 2,
	attacks : [{
			name : "Claws",
			ability : 2,
			damage : [1, "", "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "",
			modifiers : [-4, ""],
			abilitytodamage : false
		}
	],
	traits : [{
			name : "Amphibious",
			description : "The hulking crab can breate air and water."
		}, {
			name : "Shell Camouflage",
			description : "While the hulking crab remains motionless with its eyestalks and pincers tucked close to its body, it resembles a natural formation or a pile of detritus. A creature within 30 feet of it can discern its true nature with a DC 15 Intelligence (Nature) check."
		}
	]
};
CreatureList["tressym"] = {
	name : "Tressym",
	source : [["SKT", 242]],
	size : 5, //Tiny
	type : "Beast",
	companion : "familiar_not_al",
	alignment : "Unaligned",
	ac : 12,
	hp : 5,
	hd : [2, 4], //[#, die]
	speed : "40 ft, climb 30 ft, fly 40 ft",
	scores : [3, 15, 10, 11, 12, 12], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 5,
		"stealth" : 4
	},
	damage_immunities : "poison",
	condition_immunities : "poisoned",
	senses : "Darkvision 60 ft; Adv. on Wis (Perception) checks using smell",
	passivePerception : 15,
	languages : "understands Common but can't speak",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Claws",
			ability : 2,
			damage : [1, "", "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "",
			modifiers : [-4, ""],
			abilitytodamage : false
		}
	],
	traits : [{
			name : "Detect Invisibility",
			description : "Within 60 feet of the tressym, magical invisibility fails to conceal anything from the tressym's sight."
		}, {
			name : "Keen Smell",
			description : "The tressym has advantage on Wisdom (Perception) checks that rely on smell."
		}, {
			name : "Poison Sense",
			description : "The tressym can detect whether a substance is poisonous by taste, touch, or smell."
		}
	],
	wildshapeString : "\u25C6 Languages: understands Common but can't speak.\n\u25C6 Senses: Darkvision 60 ft; Advantage on Wisdom (Perception) checks that rely on smell.\n\u25C6 Detect Invisibility: Magical invisibility fails to conceal anything from sight, out to 60 ft.\n\u25C6 Immune to: poison damage, poisoned condition.\n\u25C6 Poison Sense: Detect whether a substance is poisonous by taste, touch, or smell."
};

// Magic Items
MagicItemsList["faerie dust"] = { // contains contributions by Nod_Hero
	name : "Faerie Dust",
	source : [["SKT", 35]],
	type : "wondrous item",
	description : "A pinch of this dust can substitute for the material components of any enchantment spell of 3rd level or lower. If a pinch of faerie dust is sprinkled on a creature, roll percentile dice and consult the Faerie Dust Table to determine the effect, see notes.",
	descriptionFull : "This small pouch contains ten pinches of faerie dust. A pinch of this dust can substitute for the material components of any enchantment spell of 3rd level or lower. If a pinch of faerie dust is sprinkled on a creature, roll percentile dice and consult the Faerie Dust table to determine the effect."+
	"\n\nFaerie Dust Table"+
	"\n   d100\tMagical Effect"+
	"\n  01-70\tThe creature sprinkled with dust gains a flying"+
		"\n\tspeed of 60 feet for 10 minutes."+
	"\n  71-80\tThe creature sprinkled with dust must succeed"+
		"\n\ton a DC 11 Constitution saving throw or fall"+
		"\n\tunconscious for 1 minute. The creature awakens"+
		"\n\tif it takes damage or if it is shaken or slapped as"+
		"\n\tan action."+
	"\n  81-90\tThe creature sprinkled with dust must succeed on"+
		"\n\ta DC 11 Wisdom saving throw or be affected by a"+
		"\n\tconfusion spell."+
	"\n  91-00\tThe creature sprinkled with dust becomes"+
		"\n\tinvisible for 1 hour. Any equipment it is wearing"+
		"\n\tor carrying is invisible as long as it is on the"+
		"\n\tcreature's person. The effect on the creature ends"+
		"\n\tif it attacks, deals any damage, or casts a spell.",
	toNotesPage : [{
		name : "Faerie Dust Table",
		note : "\n   d100 \tMagical Effect"+
			"\n  01-70\tThe creature sprinkled with dust gains a flying speed of 60 ft"+
			"\n\tfor 10 minutes."+
			"\n  71-80\tThe creature sprinkled with dust must succeed on a DC 11"+
				"\n\tConstitution saving throw or fall unconscious for 1 minute."+
				"\n\tThe creature awakens if it takes damage or if it is shaken or slapped"+
				"\n\tas an action."+
			"\n  81-90\tThe creature sprinkled with dust must succeed on a DC 11 Wisdom"+
				"\n\tsaving throw or be affected by a confusion spell."+
			"\n  91-00\tThe creature sprinkled with dust becomes invisible for 1 hour."+
				"\n\tAny equipment it is wearing or carrying is invisible as long as it is on"+
				"\n\tthe creature's person. The effect on the creature ends if it attacks,"+
				"\n\tdeals any damage, or casts a spell."
	}],
	usages : 10,
	recovery : "Never"
};
MagicItemsList["banner of the krig rune"] = {
	name : "Banner of the Krig Rune",
	source : [["SKT", 233]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "As an action, I can furl or unfurl this 5 ft by 3 ft banner. While it is unfurled and I'm attuned to it, I can use its magical properties to see invisible creatures, and each once per short rest emanate courage or protect from ranged attacks. I can even transfer them over to a place, destroying the banner in the process. See Notes.",
	descriptionFull : "Crafted from a thick, red fabric, this banner measures 5 feet high and 3 feet wide. The krig (war) rune is displayed on the fabric with round, metal plates sewn into it. It can be attached to a 10-foot pole to serve as a standard. Furling or unfurling the banner requires an action. The banner has the following properties.\n   " + toUni("Mark of Courage") + ". As a bonus action, you can touch the unfurled banner and cause it to emanate courage. You and your allies are immune to the frightened condition while within 20 feet of it. This benefit lasts for 10 minutes or until the banner is furled. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Sentinel Standard") + ". You can see invisible creatures while they are within 20 feet of the unfurled banner and within your line of sight.\n   " + toUni("Standard's Shield") + ". As a bonus action, you can touch the unfurled banner and invoke this power. Any ranged attack roll that targets you or an ally of yours has disadvantage if the target is within 20 feet of the unfurled banner. This benefit lasts for 1 minute or until the banner is furled. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Gift of Battle") + ". You can transfer the banner's magic to a place by tracing the krig rune on the ground with your finger. The point where you trace it becomes the center of a spherical area of magic that has a 500-foot radius and that is fixed to the place. The transfer takes 8 hours of work that requires the banner to be within 5 feet of you and during which you choose creatures, creature types, or both that will benefit from the magic. At the end, the banner is destroyed, and the area gains the following property:\n   While in the 500-foot-radius sphere, the creatures you chose during the transfer process are immune to the frightened condition and gain a +1 bonus to attack rolls and AC.",
	attunement : true,
	action : [
		["bonus action", "Mark of Courage (Krig Banner)"],
		["bonus action", "Standard's Shield (Krig Banner)"]
	],
	extraLimitedFeatures : [{
		name : "Mark of Courage (Krig Banner)",
		usages : 1,
		recovery : "short rest"
	}, {
		name : "Standard's Shield (Krig Banner)",
		usages : 1,
		recovery : "short rest"
	}],
	toNotesPage : [{
		name : "Features",
		note : [
			"Crafted from a thick, red fabric, this banner measures 5 ft high and 3 ft wide. The krig (war) rune is displayed on the fabric with round, metal plates sewn into it. It can be attached to a 10-ft pole to serve as a standard. Furling or unfurling the banner requires an action. The banner has the following properties.",
			"As a bonus action, I can touch the unfurled banner and use the Mark of Courage, have it emanate courage. Me and my allies are immune to the frightened condition while within 20 ft of it. This benefit lasts for 10 minutes or until the banner is furled. Once I use this property, I can't use it again until I finish a short or long rest.",
			"I can see invisible creatures while they are within 20 ft of the unfurled banner and within my line of sight.",
			"As a bonus action, I can touch the unfurled banner and invoke the Standard's Shield power. While within 20 ft of the unfurled banner, me an my allies are protected from ranged attacks. Any ranged attack roll targetting those protected has disadvantage. This benefit lasts for 1 minute or until the banner is furled. Once I use this property, I can't use it again until I finish a short or long rest.\n",
			"I can transfer the banner's magic to a place by tracing the krig rune on the ground with my finger. The point where I trace it becomes the center of a spherical area of magic that has a 500-ft radius and that is fixed to the place. The transfer takes 8 hours of work that requires the banner to be within 5 ft of me and during which I choose creatures, creature types, or both that will benefit from the magic. At the end, the banner is destroyed, and the creatures I chose during the transfer process are immune to the frightened condition and gain a +1 bonus to attack rolls and AC while within the area."
		]
	}]
}
MagicItemsList["blod stone"] = {
	name : "Blod Stone",
	source : [["SKT", 233]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "As an action while I carry this diamond with the blod rune, I can divine the location of the creature nearest to me that is related to the blood in the item and that isn't undead. I sense the distance and direction of the creature. The diamond is worth at least 5000 gp. If it is destroyed, the blood inside evaporates.",
	descriptionFull : "This diamond contains the blood of a creature\u2014blood that appears in the form of the blod (blood) rune. While the item is on your person, you can use your action to divine the location of the creature nearest to you that is related to the blood in the item and that isn't undead. You sense the distance and direction of the creature relative to your location. The creature is either the one whose blood is in the item or a blood relative.\n   This item is made from a large diamond worth at least 5,000 gp. When the blood of a creature is poured onto it during the creation process, the blood seeps into the heart of the gem. If the gem is destroyed, the blood evaporates and is gone forever. A vengeful being might use a blod stone to hunt down an entire bloodline. Such stones are sometimes given as gifts to siblings or handed down from parent to child.",
	attunement : true,
	action : [["action", ""]]
}
MagicItemsList["claw of the wyrm rune"] = {
	name : "Claw of the Wyrm Rune",
	source : [["SKT", 233]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This silvered dragon's claw gives me resistance to dragon breath weapons. As an action 3 times per dawn, I can have a dragon within 30 ft make a DC 15 Con save or gain vulnerability to all damage types until the end of my next turn. I can transfer its magic to a place, destroying the claw in the process. See book.",
	descriptionFull : "This dragon's claw has been covered with a coat of molten silver, upon which has been inscribed the wyrm (dragon) rune. The claw has the following properties.\n   " + toUni("Wyrmslayer") + ". As an action, you can point the claw at a dragon within 30 feet of you. The dragon must then succeed on a DC 15 Constitution saving throw or gain vulnerability to all damage types until the end of your next turn. This property can be used three times. The claw regains all expended uses at the next dawn.\n   " + toUni("Wyrm Shield") + ". While the claw is displayed on your person, you have resistance to the damage caused by any dragon's breath weapon.\n   " + toUni("Wyrm Ward") + ". You can transfer the c1aw's magic to a place by tracing the wyrm rune on the ground with your finger. The point where you trace it becomes the center of a spherical area of magic that has a 100-foot radius and that is fixed to the place. The transfer takes 8 hours of work that requires the claw to be within 5 feet of you. At the end, the claw is destroyed, and the area gains the following property:\n   While in the 100-foot-radius sphere, any dragon has disadvantage on saving throws and can have a flying speed no higher than 10 feet.",
	attunement : true,
	dmgres : ["Dragon Breath Weapons"],
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["conch of teleportation"] = {
	name : "Conch of Teleportation",
	source : [["SKT", 234]],
	type : "wondrous item",
	rarity : "very rare",
	storyItemAL : true,
	description : "This 2.5 ft conch shell is inscribed with the uvar rune. As an action once per dawn, I can blow into the shell, teleporting myself and up to 8 willing creatures to a predetermined location without any chance of mishap. The location is determined at creation of the item and can't be changed.",
	descriptionFull : "This item is an ordinary, albeit rather large, conch shell that has been inscribed with the uvar rune. The conch measures 2\xBD feet long and weighs 20 pounds.\n   As an action, you can cast the Teleport spell by blowing into the shell. The destination is fixed, and there is no chance of either a mishap or the spell being off target. Anyone teleported by the conch appears in a specific location designated by the item's creator at the time the uvar rune is inscribed on the conch. It doesn't allow teleportation to any other destination. Once its spell is cast, the conch can't be used again until the next dawn.",
	weight : 20,
	attunement : true,
	action : [["action", ""]],
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["gavel of the venn rune"] = {
	name : "Gavel of the Venn Rune",
	source : [["SKT", 234]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This wooden gavel imposes disadv. on attacks against me before my first turn in a combat. As an action once per long rest, I can strike it on a hard surface and have the first creature that deals damage with an attack within 60 ft of the strike take half that damage itself as psychic damage. Can transfer rune, see book.",
	descriptionFull : "This wooden gavel is small by giant reckoning but nearly the size of a warhammer in human hands. The venn (friend) rune is inscribed in mithral in the base of the haft. Among giants, this item is used as part of rituals to resolve disputes. The gavel has the following properties.\n   " + toUni("Arbiters Shield") + ". At the start of every combat, attack rolls against you have disadvantage before the start of your first turn, provided that the gavel is on your person.\n   " + toUni("Bond of Amity") + ". As an action, you can use the gavel to strike a point on a hard surface. The first time in the next minute that a creature within 60 feet of that point deals damage to another creature with an attack that hits, the attacker takes psychic damage equal to half the damage it dealt to the target. Once you use this property, you can't use it again until you finish a long rest.\n   " + toUni("Gift of Truth") + ". You can transfer the gavel's magic to a place by tracing the venn rune on the ground with your finger. The point where you trace it becomes the center of a spherical area of magic that has a 30-foot radius and that is fixed to the place. The transfer takes 8 hours of work that requires the gavel to be within 5 feet of you. At the end, the gavel is destroyed, and the area gains the following property:\n   Whenever a creature utters a lie while within the 30-foot-radius sphere, that creature takes 5 psychic damage and flinches visibly.",
	attunement : true,
	action : [["action", ""]],
	usages : 1,
	recovery : "long rest"
}
MagicItemsList["gurt's greataxe"] = {
	name : "Gurt's Greataxe",
	source : [["SKT", 234]],
	type : "weapon (greataxe)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This giant-sized greataxe adds +1 to hit and damage and deals 3d12 slashing damage (+2d12 vs. humans). When in an area that is below 0 \u00B0F, it sheds bright light in a 20-ft radius and dim light for another 20 ft. As an action once per dawn, I can use it to cast Heat Metal (DC 13) that deals cold damage instead of fire.",
	descriptionFull : "In the Year of the Icy Axe (123 DR), the frost giant Lord Gurt fell to Uthgar Gardolfsson\u2014leader of the folk who would become the Uthgardt barbarians\u2014in a battle that marked the ascendance of humankind over the giants in the Dessarin Valley. Gurt's greataxe was buried in Morgur's Mound until it was unearthed and brought back to Waterdeep. After laying in the city's vaults for decades, the axe was given to Harshnag, a frost giant adventurer, in recognition of his service to Waterdeep. Uthgardt barbarians recognize the weapon on sight and attack any giant that wields it.\n   You gain a +1 bonus to attack and damage rolls made with this magic weapon. It is sized for a giant, weighs 325 pounds, and deals 3d12 slashing damage on a hit, plus an extra 2d12 slashing damage if the target is human.\n   The axe sheds light as a torch when the temperature around it drops below 0 degrees Fahrenheit. The light can't be shut off in these conditions.\n   As an action, you can cast a version of the Heat Metal spell (save DC 13) that deals cold damage instead of fire damage. Once this power is used, it can't be used again until the next dawn.",
	attunement : true,
	weight : 325,
	usages : 1,
	recovery : "dawn",
	weaponOptions : [{
		baseWeapon : "greataxe",
		regExpSearch : /^(?=.*gurt)(?=.*greataxe).*$/i,
		name : "Gurt's Greataxe",
		source : [["SKT", 234]],
		damage : [3, 12, "slashing"],
		weight : 325,
		description : "Heavy, two-handed; +2d12 damage against humans",
		modifiers : [1, 1],
		selectNow : true
	}],
	fixedDC : 13,
	spellcastingBonus : {
		name : "Deals cold damage",
		spells : ["heat metal"],
		selection : ["heat metal"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"heat metal" : {
			description : "1 metal obj on touch 2d8 Cold dmg; save or drop obj; if held: dis. atk/chk; bns a cool obj again",
			descriptionShorter : "1 metal obj, touch it 2d8 Cold dmg; save or drop it; if held: dis. atk/chk; bns a redo",
			changes : "Using Gurt's Greataxe, the spell deals cold damage instead of fire."
		}
	}
}
MagicItemsList["ingot of the skold rune"] = {
	name : "Ingot of the Skold Rune",
	source : [["SKT", 234]],
	magicItemTable : "H",
	description : "I can use the ingot as it is, or transfer its runic properties over to a shield or two-handed melee weapon.",
	descriptionFull : "This appears to be a simple ingot of iron ore, about a foot long and a few inches across. Inspection of its surface reveals the faint, silvery outline of the skold (shield) rune. The ingot has the following properties, which work only while it's on your person.\n   " + toUni("Runic Shield") + ". You have a +1 bonus to AC.\n   " + toUni("Shield Bond") + ". As a bonus action, choose a creature that you can see within 30 feet of you, other than yourself. Until the end of your next turn, any damage the target takes is reduced to 1, but you take half the damage prevented in this way. The damage you take can't be reduced in any way. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Shield Ward") + ". You can transfer the ingot's magic to a nonmagical item\u2014a shield or a two-handed melee weapon-by tracing the skold rune there with your finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the ingot is destroyed, and the rune appears in silver on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Shield") + ". The shield is now a rare magic item that requires attunement. Its magic gives you a +1 bonus to AC, and the first time after each of your long rests that damage reduces you to 0 hit points, you are instead reduced to 1 hit point. You must be wielding the shield to gain these benefits.\n \u2022 " + toUni("Weapon") + ". The weapon is now an uncommon magic weapon. It grants you a +1 bonus to AC while you're holding it.",
	choices : ["Ingot", "Transferred to a shield", "Transferred to a two-handed melee weapon"],
	"ingot" : {
		name : "Ingot of the Skold Rune ",
		type : "wondrous item",
		rarity : "very rare",
		description : "This iron ingot gives me +1 AC. As a bonus action, I can use it to choose a creature within 30 ft other than myself. Until the end of my next turn, any damage it takes is reduced to 1, but I take half the prevented damage and this damage can't be reduced in any way. I can transfer the rune to a shield or weapon, see book.",
		attunement : true,
		extraAC : [{name : "Skold Rune", mod : 1, magic : true, text : "I gain a +1 bonus to AC while attuned."}],
		action : [["bonus action", ""]]
	},
	"transferred to a shield" : {
		name : "Skold Rune Shield",
		sortname : "Rune Shield, Skold",
		type : "shield",
		rarity : "rare",
		description : "This shield gives my +1 AC on top of its normal bonus to AC. While carrying it, the first time after a long rest that damage reduces me to 0 HP, I drop to 1 HP instead.",
		shieldAdd : ["Skold Rune Shield", 3, 6],
		usages : 1,
		recovery : "long rest"
	},
	"transferred to a two-handed melee weapon" : {
		name : "Skold Rune Weapon",
		sortname : "Rune Weapon, Skold",
		type : "weapon (any two-handed melee)",
		rarity : "uncommon",
		description : "This magic weapon grants me a +1 bonus to AC.",
		extraAC : [{name : "Skold Rune", mod : 1, magic : true, text : "I gain a +1 bonus to AC while attuned."}],
		chooseGear : {
			type : "weapon",
			prefixOrSuffix : "brackets",
			descriptionChange : ["replace", "weapon"],
			itemName1stPage : ["suffix", "Skold Rune"],
			excludeCheck : function (inObjKey, inObj) {
				return !(/melee/i).test(inObj.range) || !(/((^|[^+-]\b)2|\btwo).?hand(ed)?s?\b/i).test(inObj.description);
			}
		},
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && !v.isSpell && (/^(?=.*\bskold\b)(?=.*(rune|runic)).*$/i).test(v.WeaponTextName)) {
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					}
				},
				'If I include the words "Skold Rune" in the name of a weapon, it will be treated as the magic weapon Skold Rune Weapon.'
			]
		}
	}
}
MagicItemsList["korolnor scepter"] = {
	name : "Korolnor Scepter",
	source : [["SKT", 234]],
	type : "weapon (club)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This tapered mithral rod the size of a dwarf's forearm has 10 charges, regaining 1d6+4 at dawn. It can be wielded as a +3 club. As an action while below sea level, I can expend 1 charge to determine the distance to the surface. I can also use the charges to cast Sending (2 charges) and Teleport (3 charges).",
	descriptionFull : "The Korolnor Scepter is one of ten Ruling Scepters of Shanatar, forged by the dwarven gods and given to the ruling houses of the ancient dwarven empire. The Korolnor Scepter's location was unknown for the longest time until a storm giant queen, Neri, found it in a barnacle-covered shipwreck at the bottom of the Trackless Sea. The Ruling Scepters are all roughly the same size and shape, but their materials and properties vary.\n   The Korolnor Scepter is a tapered mithral rod as thick and long as a dwarf's forearm, with a small platinum knob at the bottom and a rounded disk adorned with a ring of seven tiny blue gems at the top.\n   You gain a +3 bonus to attack and damage rolls made with this scepter, which can be wielded as a magic club.\n   You can use the properties of the Wyrmskull Throne, as well as the properties of the scepter itself. The scepter has 10 charges, and it regains 1d6+4 expended charges at dawn. Its properties are as follows.\n   If you are underground or underwater, you can use an action to expend 1 charge to determine the distance to the surface.\n   As an action: you can expend 2 charges to cast the Sending spell from the scepter.\n   As an action: you can expend 3 charges to cast the Teleport spell from the scepter. If the destination is within 60 feet of the Wyrmskull Throne, there is no chance of a teleport error or mishap occurring.",
	attunement : true,
	weight : 2,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["sending"],
		selection : ["sending"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["teleport"],
		selection : ["teleport"],
		firstCol : 3
	}],
	weaponOptions : [{
		baseWeapon : "club",
		regExpSearch : /^(?=.*korolnor)(?=.*scepter).*$/i,
		name : "Korolnor Scepter",
		source : [["SKT", 234]],
		modifiers : [3, 3],
		selectNow : true
	}]
}
MagicItemsList["navigation orb"] = {
	name : "Navigation Orb",
	source : [["SKT", 235]],
	type : "wondrous item",
	rarity : "very rare",
	storyItemAL : true,
	description : "This hollow 7-ft diameter sphere of thin, polished mithral bears the skye rune and is keyed to a particular cloud castle. It only works while within that castle. As an action while touching it, I can use it to move the cloud castle 1 mph until commanded otherwise, have it stop, or turn 90 degrees.",
	descriptionFull : "A navigation orb is a hollow, 7-foot-diameter sphere of thin, polished mithral with a large skye (cloud) rune embossed on its outer surface. The orb levitates 10 feet above the ground and is keyed to a particular cloud castle, allowing you to control that castle's altitude and movement while the orb is inside the castle. If the orb is destroyed or removed from its castle, the castle's altitude and location remain fixed until the orb is returned or replaced.\n   As an action, you can cause one of the following effects to occur if you are touching the orb:\n   The castle moves at a speed of 1 mph in a straight line, in a direction of your choice, until the castle stops or is made to stop, or until another action is used to change its direction. If this movement brings the castle into contact with the ground, the castle lands gently.\n   The castle, if it is moving, comes to a gradual stop.\n   The castle makes a slow, 90-degree turn clockwise or counterclockwise (turning a northerly view into a westerly view, for example). The castle can turn while it is moving in a straight line.\n   Any creature touching the orb knows the altitude of the base of the castle above the ground or water below it.",
	attunement : true
}
MagicItemsList["opal of the ild rune"] = {
	name : "Opal of the Ild Rune",
	source : [["SKT", 235]],
	magicItemTable : "G",
	description : "I can use the opal as it is, or transfer its runic properties over to a suit of armor or weapon.",
	descriptionFull : "This triangular fire opal measures about three inches on each side and is half an inch thick. The ild (fire) rune shimmers within its core, causing it to be slightly warm to the touch. The opal has the following properties, which work only while it's on your person.\n   " + toUni("Ignite") + ". As an action, you can ignite an object within 10 feet of you. The object must be flammable, and the fire starts in a circle no larger than 1 foot in diameter.\n   " + toUni("Fires Friend") + ". You have resistance to cold damage.\n   " + toUni("Fire Tamer") + ". As an action, you can extinguish any open flame within 10 feet of you. You choose how much fire to extinguish in that radius.\n   " + toUni("Gift of Flame") + ". You can transfer the opal's magic to a nonmagical item\u2014a weapon or a suit of armor\u2014by tracing the ild rune there with your finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the opal is destroyed, and the rune appears in red on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Weapon") + ". The weapon is now an uncommon magic weapon. It deals an extra 1d6 fire damage to any target it hits.\n \u2022 " + toUni("Armor") + ". The armor is now a rare magic item that requires attunement. You have resistance to cold damage while wearing the armor.",
	choices : ["Opal", "Transferred to a suit of armor", "Transferred to a weapon"],
	"opal" : {
		name : "Opal of the Ild Rune ",
		type : "wondrous item",
		rarity : "rare",
		description : "This triangular fire opal gives me resistance to cold damage. As an action, I can use it to extinguish any open flames of my choice within 10 ft, or I can ignite a flammable object within 10 ft with a fire up to 1 ft in diameter. I can undertake an 8 hour ritual to transfer the rune to a suit of armor or weapon, see book.",
		attunement : true,
		dmgres : ["Cold"],
		action : [["action", ""]]
	},
	"transferred to a suit of armor" : {
		name : "Ild Rune Armor",
		sortname : "Rune Armor, Ild",
		type : "armor (any)",
		rarity : "rare",
		description : "This magic armor gives me resistance to cold damage.",
		attunement : true,
		dmgres : ["Cold"],
		chooseGear : {
			type : "armor",
			prefixOrSuffix : "brackets",
			descriptionChange : ["prefix", "armor"],
			itemName1stPage : ["suffix", "Ild Rune"]
		}
	},
	"transferred to a weapon" : {
		name : "Ild Rune Weapon",
		sortname : "Rune Weapon, Ild",
		type : "wondrous item",
		rarity : "uncommon",
		description : "This magic weapon deals +1d6 fire damage to any target it hits.",
		chooseGear : {
			type : "weapon",
			prefixOrSuffix : "brackets",
			descriptionChange : ["replace", "weapon"],
			itemName1stPage : ["suffix", "Ild Rune"]
		},
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && !v.isSpell && (/^(?=.*\bild\b)(?=.*(rune|runic)).*$/i).test(v.WeaponTextName)) {
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + '+1d6 fire damage';
					}
				},
				'If I include the words "Ild Rune" in a the name of a weapon, it will be treated as the magic weapon Ild Rune Weapon, which deals +1d6 fire damage.'
			]
		}
	}
}
MagicItemsList["orb of the stein rune"] = {
	name : "Orb of the Stein Rune",
	source : [["SKT", 235]],
	magicItemTable : "G",
	description : "I can use the orb as it is, or transfer its runic properties over to a shield or pair of boots.",
	descriptionFull : "This orb of granite is about the size of an adult human's fist. The stein (stone) rune appears on it in the form of crystalline veins that run across the surface. The orb has the following properties, which work only while it's on your person.\n   " + toUni("Indomitable Stand") + ". As an action, you can channel the orb's magic to hold your ground. For the next minute or until you move any distance, you have advantage on all checks and saving throws to resist effects that force you to move. In addition, any enemy that moves to a space within 10 feet of you must succeed on a DC 12 Strength saving throw or be unable to move any farther this turn.\n   " + toUni("Stone Soul") + ". You can't be petrified.\n   " + toUni("Earthen Step") + ". You can cast Meld into Stone as a bonus action. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Gift of Stone") + ". You can transfer the orb's magic to a nonmagical item\u2014a shield or a pair of boots\u2014by tracing the stein rune there with your finger. The transfer takes8 hours of work that requires the two items to be within 5 feet of each other. At the end, the orb is destroyed, and the rune appears in silver on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Shield") + ". The shield is now a rare magic item that requires attunement. While you wield it, you have resistance to all damage dealt by ranged weapon attacks.\n \u2022 " + toUni("Boots") + ". The pair of boots is now an uncommon magic item that requires attunement. While you wear the boots, you have advantage on Strength saving throws, and you can use your reaction to avoid being knocked prone.",
	choices : ["Orb", "Transferred to a shield", "Transferred to a pair of boots"],
	"orb" : {
		name : "Orb of the Stein Rune ",
		type : "wondrous item",
		rarity : "rare",
		description : "This orb gives me petrification immunity. As a bonus action once per short rest, I can cast Meld Into Stone. As an action, I can hold my ground for 1 min or until I move any distance, giving me adv. on saves/checks vs. moving and enemies moving to a space in 10 ft must make a DC 12 Str save or have speed 0 for this turn.",
		attunement : true,
		savetxt : { immune : ["petrified"] },
		action : [["action", ""]],
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["meld into stone"],
			selection : ["meld into stone"],
			firstCol : "oncesr"
		},
		spellChanges : {
			"meld into stone" : {
				time : "1 bns",
				changes : "Using the Orb of the Stein Rune, I can cast this as a bonus action."
			}
		}
	},
	"transferred to a shield" : {
		name : "Stein Rune Shield",
		sortname : "Rune Shield, Stein",
		type : "shield",
		rarity : "rare",
		description : "This shield gives me resistance to all damage dealt by range weapon attack.",
		attunement : true,
		shieldAdd : "Stein Rune Shield",
		dmgres : ["Ranged Weapon Attacks"]
	},
	"transferred to a pair of boots" : {
		name : "Stein Rune Boots",
		type : "wondrous item",
		rarity : "uncommon",
		description : "These pair of boots give me advantage on Strength saving throws. As a reaction, I can avoid being knocked prone.",
		attunement : true,
		savetxt : { text : ["Adv. on Str saves"] },
		advantages : ["Strength", true],
		action : [["reaction", ""]]
	}
}
MagicItemsList["pennant of the vind rune"] = {
	name : "Pennant of the Vind Rune",
	source : [["SKT", 235]],
	magicItemTable : "H",
	description : "I can use the pennant as it is, or transfer its runic properties over to a suit of armor, pair of boots, or cloak.",
	descriptionFull : "This blue pennant is crafted from silk and is five feet long and whips about as if buffeted by a wind. The vind (wind) rune appears on its surface, looking almost like a cloud. The pennant has the following properties, which work only while it's on your person.\n   " + toUni("Wind Step") + ". As an action, you fly up to 20 feet. If you don't land at the end of this flight, you fall unless you have another means of staying aloft.\n   " + toUni("Comforting Wind") + ". You can't suffocate.\n   " + toUni("Winds Grasp") + ". As a reaction when you fall, you can cause yourself to take no damage from the fall. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Wind Walker") + ". While you are attuned to this rune, you can cast Levitate as a bonus action. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Gift of Wind") + ". You can transfer the pennant's magic to a nonmagical item\u2014a suit of armor, a pair of boots, or a cloak\u2014by tracing the vind rune there with your finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the pennant is destroyed, and the rune appears in silver on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Armor") + ". The armor is now an uncommon magic item that requires attunement. You gain a bonus to speed of 5 feet while you wear the armor, and if it normally imposes disadvantage on Stealth checks, it no longer does so.\n \u2022 " + toUni("Boots/Cloak") + ". The pair of boots or cloak is now a rare magic item that requires attunement. While wearing the item, you can convert up to 20 feet of your movement on each of your turns into flight. If you don't land at the end of this flight, you fall unless you have another means of staying aloft. You can also cast Feather Fall once from the item, and you regain the ability to do so when you finish a short or long rest.",
	choices : ["Pennant", "Transferred to a suit of armor", "Transferred to a pair of boots or cloak"],
	"pennant" : {
		name : "Pennant of the Vind Rune ",
		type : "wondrous item",
		rarity : "very rare",
		description : "This blue pennant stops me from suffocating. As an action, I can fly up to 20 ft, but won't stay aloft at the end of it. As a reaction once per short rest when I fall, I can use Wind Grasp to take no damage from the fall. As a bonus action once per short rest, I can cast Levitate. I can transfer this rune, see book.",
		attunement : true,
		savetxt : { immune : ["suffocation"] },
		action : [
			["action", "Wind Step (Vind Rune)"],
			["reaction", "Winds Grasp (Vind Rune)"]
		],
		extraLimitedFeatures : [{
			name : "Levitate (Vind Rune)",
			usages : 1,
			recovery : "short rest"
		}, {
			name : "Winds Grasp (Vind Rune)",
			usages : 1,
			recovery : "short rest"
		}],
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["levitate"],
			selection : ["levitate"],
			firstCol : "oncesr"
		},
		spellChanges : {
			"levitate" : {
				time : "1 bns",
				changes : "Using the Pennant of the Vind Rune, I can cast this as a bonus action."
			}
		}
	},
	"transferred to a suit of armor" : {
		name : "Vind Rune Armor",
		sortname : "Rune Armor, Vind",
		type : "armor (any)",
		rarity : "uncommon",
		description : "This magic armor doesn't impose disadvantage on stealth checks and gives me a 5 ft bonus to my speed.",
		attunement : true,
		speed : { allModes : "+5" },
		chooseGear : {
			type : "armor",
			prefixOrSuffix : "brackets",
			descriptionChange : ["prefix", "armor"],
			itemName1stPage : ["suffix", "Ild Rune"]
		}
	},
	"transferred to a pair of boots or cloak" : {
		name : "Vind Rune Boots or Cloak",
		nameAlt : "Vind Rune Boots",
		nameTest : "Vind Rune Cloak",
		type : "wondrous item",
		rarity : "rare",
		description : "While wearing this item, I can convert up to 20 ft of my movement on each of my turns into flight. If I don't land at the end of this flight, I fall unless I have other means of staying aloft. Once per short rest, I can use this item to cast Feather Fall.",
		attunement : true,
		usages : 1,
		recovery : "short rest",
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["feather fall"],
			selection : ["feather fall"],
			firstCol : "oncesr"
		}
	}
}
MagicItemsList["potion of giant size"] = {
	name : "Potion of Giant Size",
	source : [["SKT", 236]],
	type : "potion",
	rarity : "legendary",
	description : "Once as an action, I can drink this potion of pale white liquid or administer it to another to grow to Huge for 24 hours. This gives Str 25, +5 ft reach, double max HP (current HP also doubles), and roll three times damage die for weapons. When its effect ends, HP above the max HP becomes temporary HP.",
	descriptionFull : "When you drink this potion, you become Huge for 24 hours if you are Medium or smaller, otherwise the potion does nothing. For that duration, your Strength becomes 25, if it isn't already higher, and your hit point maximum is doubled (your current hit points are doubled when you drink the potion). In addition, the reach of your melee attacks increases by 5 feet.\n   Everything you are carrying and wearing also increases in size for the duration. When rolling damage for weapons enlarged in this manner, roll three times the normal number of dice; for example, an enlarged longsword would deal 3d8 slashing damage (instead of1d8), or 3d10 slashing damage (instead of 1d10) when used with two hands.\n   When the effect ends, any hit points you have above your hit point maximum become temporary hit points. This potion is a pale white liquid made from the tongue of a giant clam, with a pungent aroma akin to that of rotting algae. It tastes sweet, however, when consumed.",
	weight : 0.5
}
MagicItemsList["robe of serpents"] = {
	name : "Robe of Serpents",
	source : [["SKT", 236]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "As a bonus action, I can remove one of the 1d4+3 emblazoned, brightly colored snakes from this robe and have it turn into a giant poisonous snake within 5 ft of me. It acts on my initiative and attacks those hostile to me. It disappears after 1 hour, when it drops to 0 HP, or when I dismiss it (no action).",
	descriptionFull : "A robe of serpents is a stylish silk garment that is popular among wealthy nobles and retired assassins. The robe is emblazoned with 1d4+3 stylized serpents, all brightly colored.\n   As a bonus action on your turn, you can transform one of the robe's serpents into a giant poisonous snake. The snake instantly falls from the robe, slithers into an unoccupied space next to you, and acts on your initiative count. The snake can tell friendly creatures from hostile ones and attacks the latter. The snake disappears in a harmless puff of smoke after 1 hour, when it drops to 0 hit points, or when you dismiss it (no action required). Once detached, a snake can't return to the robe. When all of the robe's snakes have detached, the robe becomes a nonmagical garment.",
	attunement : true,
	action : [["bonus action", ""]],
	usages : "1d4+3",
	recovery : "Never"
}
MagicItemsList["rod of the vonindod"] = {
	name : "Rod of the Vonindod",
	source : [["SKT", 236]],
	type : "rod",
	rarity : "rare",
	magicItemTable : "F",
	description : "This 4 ft adamantine rod sized for a giant has 10 charges and regains 1d6+4 expended charges daily at dawn. I can expend 1 charge to cast Locate Object from it which has a range of 10 miles when used to locate objects made of adamantine. It has two prongs at one end and a molded handle grip on the other.",
	descriptionFull : "The fire giant Duke Zalto hired a wizard to craft several of these adamantine rods. Each measures 4 feet long, weighs 100 pounds, and is sized to fit comfortably in a fire giant's hand. The rod has two prongs at one end and a molded handle grip on the opposite end.\n   The rod has 10 charges and regains 1d6+4 of its expended charges daily at dawn. As an action, you can grasp it by the handle and expend 1 charge to cast the Locate Object spell from it. When the rod is used to detect objects made of adamantine, such as fragments of the Vonindod construct, its range increases to 10 miles.",
	weight : 100,
	attunement : true,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["locate object"],
		selection : ["locate object"],
		firstCol : 1
	},
	spellChanges : {
		"locate object" : {
			description : "Learn direction to closest described kind or specific obj in 1000 ft (10 miles if adamantine); see book",
			changes : "Using the Rod of the Vonindod, the spell detection range increases to 10 miles when used to locate adamantine objects."
		}
	}
}
MagicItemsList["shard of the ise rune"] = {
	name : "Shard of the Ise Rune",
	type : "wondrous item",
	source : [["SKT", 236]],
	magicItemTable : "H",
	description : "I can use the shard as it is, or transfer its runic properties over to a cloak or a pair of boots.",
	descriptionFull : "This shard of ice is long and slender, roughly the size of a dagger. The ise (ice) rune glows within it. The shard has the following properties, which work only while it's on your person.\n   " + toUni("Frigid Touch") + ". As an action, you can touch a body of water and freeze the water in a 10-foot-radius sphere around the spot you touched. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Frost Friend") + ". You have resistance to fire damage.\n   " + toUni("Icy Mantle") + ". As an action, you can touch yourself or another creature with water on your finger. The water creates an icy mantle of protection. The next time within the next minute that the target takes bludgeoning, slashing, or piercing damage, that damage is reduced to 0, and the mantle is destroyed. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Winter's Howl") + ". As an action, you can cast Sleet Storm (spell save DC 17). You regain this ability after you finish a short or long rest.\n   " + toUni("Gift of Frost") + ". You can transfer the shard's magic to a nonmagical item\u2014a cloak or a pair of boots-by tracing the ise rune there with your finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the shard is destroyed, and the rune appears in blue on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Cloak") + ". The cloak is now a rare magic item that requires attunement. While wearing it, you have resistance to fire damage, and you have advantage on Dexterity (Stealth) checks made while in snowy terrain.\n \u2022 " + toUni("Boots") + ". The pair of boots is now a rare magic item that requires attunement. While wearing it, you ignore difficult terrain while walking, and you can walk on water.",
	attunement : true,
	choices : ["Shard", "Transferred to a cloak", "Transferred to a pair of boots"],
	"shard" : {
		name : "Shard of the Ise Rune ",
		rarity : "very rare",
		description : "This shard of ice gives me fire resistance. As an action, I can use Frigid Touch, freezing water in a 10-ft radius where I touch it, or Icy Mantle, to prevent the first bludgeoning, slashing, or piercing damagein the next minute for a creature I touch. I can use it to cast Sleet Storm (DC 17). I can do all 3 each once per short rest.",
		dmgres : ["Fire"],
		action : [
			["action", "Frigid Touch (Ise Rune)"],
			["action", "Icy Mantle (Ise Rune)"]
		],
		extraLimitedFeatures : [{
			name : "Frigid Touch (Ise Rune)",
			usages : 1,
			recovery : "short rest"
		}, {
			name : "Icy Mantle (Ise Rune)",
			usages : 1,
			recovery : "short rest"
		}, {
			name : "Sleet Storm (Ise Rune)",
			usages : 1,
			recovery : "short rest"
		}],
		fixedDC : 17,
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["sleet storm"],
			selection : ["sleet storm"],
			firstCol : "oncesr"
		}
	},
	"transferred to a cloak" : {
		name : "Ise Rune Cloak",
		rarity : "rare",
		description : "While wearing this cloak, I have resistance to fire damage, and I have advantage on Dexterity (Stealth) checks made while in snowy terrain.",
		dmgres : ["Fire"]
	},
	"transferred to a pair of boots" : {
		name : "Ise Rune Boots",
		rarity : "rare",
		description : "While wearing these boots, I ignore difficult terrain while walking, and I can walk on water."
	}
}
MagicItemsList["ring of hardened magma"] = {
	name : "Ring of Hardened Magma",
	source : [["SKT", 105]], // Raven Rock ancient relic
	type : "ring",
	rarity : "unknown",
	storyItemAL : true,
	description : "Warm orange light spills from minuscule cracks that form on this rings outer surface. It automatically resizes to fit the creature attuned to it. It has 6 charges which can be used to cast Conjure Minor Elementals (summoning 4 magma mephits or 4 magmins) or Fire Shield (warm shield version only), costing 1 charge each.",
	descriptionFull : "This ring is sized for a fire giant's finger. When a creature attunes to the ring, it magically shrinks to fit that creature's index finger, and warm orange light spills from minuscule cracks that form on its outer surface. The ring has 6 charges. While attuned to the ring, a creature can expend 1 charge to cast conjure minor elementals (summoning either four magma mephits or four magmins, as the wearer wishes) or fire shield (warm shield version only) from the ring. Once all of its charges are spent, the ring loses its spellcasting properties but retains its resizing property.",
	attunement : true,
	usages : 6,
	recovery : "Never",
	spellcastingAbility : "class", // https://www.sageadvice.eu/2015/11/27/hat-of-disguise-dc/
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["conjure minor elementals", "fire shield"],
		selection : ["conjure minor elementals", "fire shield"],
		firstCol : 1,
		times : 2
	},
	spellChanges : {
		"conjure minor elementals" : {
			description : "Summon 4 magma mephits or 4 magmins that obey my verbal commands",
			changes : "Using the Ring of Hardened Magma, the spell summons either four magma mephits or four magmins."
		},
		"fire shield" : {
			description : "Fiery shield gives resistance to Cold damage and deals 2d8 Fire damage to melee attackers",
			dynamicDamageBonus : false,
			changes : "Using the Ring of Hardened Magma, the spell can only produce the warm shield."
		}
	}
}
MagicItemsList["red dragon's thighbone"] = {
	name : "Red Dragon's Thighbone",
	source : [["SKT", 105]], // Raven Rock ancient relic
	type : "weapon (greatclub)",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This 14-ft long, 250 lb red dragon's thighbone can be used as a greatclub by a giant. It magically shrinks to a size that a creature that attunes to it can wield it effectively as a greatclub. It deals an extra 2d8 bludgeoning damage whenever it hits a creature of the dragon type.",
	descriptionFull : "This 14-ft long, 250 lb red dragon's thighbone can be used as a greatclub by a giant. If a creature attunes to the greatclub, it magically shrinks to a size that the creature can wield effectively. The greatclub is considered a magic weapon that deals an extra 2d8 bludgeoning damage whenever it hits a dragon (including any creature of the dragon type).",
	attunement : true,
	weight : 10,
	weaponOptions : [{
		baseWeapon : "greabclub",
		regExpSearch : /^(?=.*red)(?=.*dragon)(?=.*thighbone).*$/i,
		name : "Red Dragon's Thighbone",
		source : [["SKT", 105]],
		description : "Two-handed; +2d6 damage vs. dragons",
		selectNow : true
	}]
}
MagicItemsList["ancient relic boulder"] = {
	name : "Ancient Relic Boulder",
	source : [["SKT", 105]], // One Stone ancient relic
	type : "wondrous item",
	rarity : "unknown",
	storyItemAL : true,
	description : "As an action once per 7 days, I can use this stone to cast either Control Weather or Divination. As an action once per 24 hours, I can have it shrink to 6-inch diameter, 25 lb, or enlarge to normal, 15-ft diameter, 24000 lb. Anything the enlarged boulder falls on takes 10d10 bludgeoning damage, DC 15 Dex save to avoid.",
	descriptionFull : "This boulder is a relic of giantkind that was shaped, carved, and abandoned long ago by a stone giant earth shaman. Any character who succeeds on a DC 15 Intelligence (Arcana) check can tell that the engraved lines adorning its outer surface are carefully designed to channel magical energy. A detect magic spell reveals an aura of transmutation magic emanating from it and casting identify spell on the boulder allows one to learn its magical properties, each of which is activated by tracing specific lines on its surface:\n \u2022 A creature can use an action to cast the control weather spell or the divination spell from the stone. Once either spell is cast, this property can't be used again for 7 days.\n \u2022 A creature can use an action to shrink the stone to the size of a 6-inch-diameter orb weighing 25 pounds, or enlarge the boulder to its normal size (15-foot diameter) and weight (12 tons). Anything the enlarged boulder falls on takes 55 (10d10) bludgeoning damage. A creature can avoid taking this damage by tumbling out of the way with a successful DC 15 Dexterity saving throw. Once the reducing or enlarging effect is used, this property can't be used again for 24 hours.",
	weight : 25,
	action : [["action", " (shrink/enlarge)"]],
	extraLimitedFeatures : [{
		name : "Ancient Relic Boulder (spell)",
		usages : 1,
		recovery : "7 days"
	}, {
		name : "Ancient Relic Boulder (shrink/enlarge)",
		usages : 1,
		recovery : "24 h"
	}],
	spellcastingBonus : {
		name : "",
		spells : ["control weather", "divination"],
		selection : ["control weather", "divination"],
		times : 2
	},
	spellChanges : {
		"control weather" : {
			time : "1 a",
			changes : "Using the Ancient Relic Boulder, the spell takes only 1 action to cast."
		}
	}
}

// pub_20161115_VGtM.js
// This file adds all the player-material from Volo's Guide to Monsters to MPMB's Character Record Sheet

// Define the source
SourceList.V = {
	name : "Volo's Guide to Monsters",
	abbreviation : "VGtM",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/volos-guide-to-monsters",
	date : "2016/11/15"
};

// Races
RaceList["fallen aasimar"] = {
	regExpSearch : /^((?=.*aasimar)|((?=.*planetouched)(?=.*(celestial|angel))))(?=.*fallen).*$/i,
	name : "Fallen Aasimar",
	source : [["V", 104], ["W", 168]],
	plural : "Fallen Aasimar",
	sortname : "Aasimar, Fallen",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Celestial"],
	vision : [["Darkvision", 60]],
	dmgres : ["Necrotic", "Radiant"],
	age : " reach adulthood in their late teens and live around 160 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 0, 0, 0, 2],
	trait : "Fallen Aasimar (+1 Strength, +2 Charisma)" + (typePF ? "\n" : " ") + "Light Bearer: I know the Light cantrip.\nHealing Hands: As an action, once per long rest, I can touch to heal for my level in HP.\nNecrotic Shroud: Once per long rest when I'm 3rd level, I can use an action to transform, causing all within 10 ft of me to make a Cha" + (typePF ? "" : "risma") + " saving throw (DC 8 + Cha mod + Prof Bonus) or be frightened of me until the end of my next turn. This lasts for 1 minute or until I end it as a bonus action. Once on my turn I can have one of my attacks or spells deals my level in extra necrotic damage to one target.",
	abilitySave : 6,
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Light Bearer",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"healing hands" : {
			name : "Healing Hands",
			usages : 1,
			minlevel : 1,
			recovery : "long rest",
			additional : levels.map(function (n) { return n + " HP"; }),
			action : ["action", ""]
		},
		"necrotic shroud" : {
			name : "Necrotic Shroud",
			usages : 1,
			minlevel : 3,
			recovery : "long rest",
			additional : levels.map(function (n) { return n < 3 ? "" : "+" + n + " damage"; }),
			action : [["action", " (start)"], ['bonus action', ' (end)']]
		}
	}
};
RaceList["protector aasimar"] = {
	regExpSearch : /^((?=.*aasimar)|((?=.*planetouched)(?=.*(celestial|angel))))(?=.*protector).*$/i,
	name : "Protector Aasimar",
	source : [["V", 104], ["W", 167]],
	plural : "Protector Aasimar",
	sortname : "Aasimar, Protector",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Celestial"],
	vision : [["Darkvision", 60]],
	dmgres : ["Necrotic", "Radiant"],
	age : " reach adulthood in their late teens and live around 160 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 0, 1, 2],
	trait : "Protector Aasimar (+1 Wisdom, +2 Charisma)\nLight Bearer: I know the Light cantrip.\nHealing Hands: As an action, once per long rest, I can touch to heal for my level in HP.\nRadiant Soul: Once per long rest when I'm 3rd level, I can use an action to transform, gaining glimmer in my eyes and two incorporeal wings. For 1 minute or until I end it as a bonus action, I have 30 feet fly speed; once on my turn I can have one of my attacks or spells deal my level in extra radiant damage to one target.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Light Bearer",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"healing hands" : {
			name : "Healing Hands",
			usages : 1,
			minlevel : 1,
			recovery : "long rest",
			additional : levels.map(function (n) { return n + " HP"; }),
			action : ["action", ""]
		},
		"radiant soul" : {
			name : "Radiant Soul",
			usages : 1,
			minlevel : 3,
			recovery : "long rest",
			additional : levels.map(function (n) { return n < 3 ? "" : "+" + n + " damage"; }),
			action : [["action", " (start)"], ['bonus action', ' (end)']]
		}
	}
};
RaceList["scourge aasimar"] = {
	regExpSearch : /^((?=.*aasimar)|((?=.*planetouched)(?=.*(celestial|angel))))(?=.*scourge).*$/i,
	name : "Scourge Aasimar",
	source : [["V", 104], ["W", 167]],
	plural : "Scourge Aasimar",
	sortname : "Aasimar, Scourge",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Celestial"],
	vision : [["Darkvision", 60]],
	dmgres : ["Necrotic", "Radiant"],
	age : " reach adulthood in their late teens and live around 160 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 1, 0, 0, 2],
	trait : "Scourge Aasimar (+1 Constitution, +2 Charisma)" + (typePF ? "\n" : " ") + "Light Bearer: I know the Light cantrip.\nHealing Hands: As an action, once per long rest, I can touch to heal for my level in HP.\nRadiant Consumption: Once per long rest when I'm 3rd level, I can use an action to radiate bright light in 10-ft radius and dim light for another 10-ft, for 1 minute or until I end it as a bonus action. Once on my turn my attack or spell deals my level in extra radiant damage to one target, and at the end of my turns all creatures within 10 ft of me, including myself, take half my level in radiant damage.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Light Bearer",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"healing hands" : {
			name : "Healing Hands",
			usages : 1,
			minlevel : 1,
			recovery : "long rest",
			additional : levels.map(function (n) { return n + " HP"; }),
			action : ["action", ""]
		},
		"radiant consumption" : {
			name : "Radiant Consumption",
			usages : 1,
			minlevel : 3,
			recovery : "long rest",
			additional : levels.map(function (n) {
				if (n < 3) return ""
				return Math.ceil(n/2) + "/" + n + " damage";
			}),
			action : [["action", " (start)"], ['bonus action', ' (end)']]
		}
	}
};
RaceList["bugbear"] = {
	regExpSearch : /bugbear/i,
	name : "Bugbear",
	source : [["V", 119], ["E:RLW", 25], ["W", 174]],
	plural : "Bugbears",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	skills : ["Stealth"],
	age : " reach adulthood at age 16 and live up to 80 years",
	height : " are between 6 and 8 feet tall (6'0\" + 2d12\")",
	weight : " weigh between 250 and 350 lb (200 + 2d12 \xD7 2d6 lb)",
	heightMetric : " are between 1,9 and 2,4 metres tall (185 + 5d12 cm)",
	weightMetric : " weigh between 115 and 160 kg (90 + 5d12 \xD7 4d6 / 10 kg)",
	scores : [2, 1, 0, 0, 0, 0],
	features : {
		"surprise attack" : {
			name : "Surprise Attack",
			minlevel : 1,
			usages : 1,
			recovery : "Combat",
			additional : "2d6"
		}
	},
	trait : "Bugbear (+2 Strength, +1 Dexterity)\nPowerful Build: I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift.\nLong-Limbed: I have an additional 5 feet reach with melee attacks that I make on my turn.\nSurprise Attack: If I hit a surprised creature on my first turn in combat, that attack deals an extra 2d6 damage. I can do this only once per combat.",
	carryingCapacity : 2
};
RaceList["firbolg"] = {
	regExpSearch : /firbolg/i,
	name : "Firbolg",
	source : [["V", 106], ["W", 170]],
	plural : "Firbolg",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish", "Giant", "Speech of Beast and Leaf"],
	age : " reach adulthood around 30 and can live for 500 years",
	height : " are between 6 and half and 8 feet tall (6'2\" + 2d12\")",
	weight : " weigh between 240 and 300 lb (175 + 2d12 \xD7 2d6 lb)",
	heightMetric : " are between 2 and 2,5 metres tall (190 + 5d12 cm)",
	weightMetric : " weigh between 110 and 135 kg (80 + 5d12 \xD7 4d6 / 10 kg)",
	scores : [1, 0, 0, 0, 2, 0],
	trait : "Firbolg (+1 Strength, +2 Wisdom)" + (typePF ? "\n" : " ") + "Hidden Step: Once per short rest, as a bonus action, I turn invisible until the start of my next turn as per the invisibility spell.\nPowerful Build: I count as one size larger for the weight I can carry.\nFirbolg Magic: I can cast the Detect Magic and Disguise Self spells each once per short rest. With Disguise Self I can seem up to 3 feet shorter. Wisdom is my ability for these spells.\nSpeech of Beast and Leaf: I can make my words understood, in a limited manner, by beasts and plants. I have advantage on Charisma checks to influence them.",
	spellcastingAbility : 5,
	features : {
		"firbolg magic (detect magic)" : {
			name : "Firbolg Magic",
			minlevel : 1,
			spellcastingBonus : {
				name : "Firbolg Magic",
				spells : ["detect magic", "disguise self"],
				selection : ["detect magic", "disguise self"],
				firstCol : 'oncesr',
				times : 2
			},
			extraLimitedFeatures : [{
				name : "Detect Magic (Firbolg Magic)",
				usages : 1,
				recovery : "short rest"
			}, {
				name : "Disguise Self (Firbolg Magic)",
				usages : 1,
				recovery : "short rest"
			}],
			spellChanges : {
				"disguise self" : {
					description : "Alter appearance, up to 3ft shorter/taller; Int(Investigation) check vs. spell DC to determine disguise",
					changes : "Using Firbolg Magic, I can cast Disguise Self once per short rest to also seem up to 3 feet shorter or taller."
				}
			}
		},
		"hidden step" : {
			name : "Hidden Step",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : [["bonus action", ""]]
		}
	},
	carryingCapacity : 2
};
RaceList["goblin"] = {
	regExpSearch : /^(?=.*\bgoblins?\b)(?!.*(hobgoblin|bugbear)).*$/i,
	name : "Goblin",
	source : [["V", 119], ["G", 17], ["E:RLW", 26], ["W", 174]],
	plural : "Goblins",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	age : " reach adulthood at age 8 and live up to 60 years",
	height : " are between 3 and a half and 4 feet tall (3'5\" + 2d4\")",
	weight : " weigh between 40 and 70 lb (35 + 2d4 \xD7 1 lb)",
	heightMetric : " are between 100 and 120 cm tall (100 + 5d4 cm)",
	weightMetric : " weigh between 20 and 30 kg (17 + 5d4 \xD7 2 / 10 kg)",
	scores : [0, 2, 1, 0, 0, 0],
	features : {
		"fury of the small" : {
			name : "Fury of the Small",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			additional : levels.map(function (n) { return "+" + n + " damage"; })
		}
	},
	action : [["bonus action", "Nimble Escape (disengage/hide)"]],
	trait : "Goblin (+2 Dexterity, +1 Constitution)"+
	"\n \u2022 Fury of the Small: Once per short rest, when I damage a creature of a size category larger than mine with an attack or a spell, I can have it take extra damage equal to my level."+
	"\n \u2022 Nimble Escape: As a bonus action, I can take the Disengage or Hide action."
};
RaceList["hobgoblin"] = {
	regExpSearch : /hobgoblin/i,
	name : "Hobgoblin",
	source : [["V", 119], ["E:RLW", 26], ["W", 175]],
	plural : "Hobgoblins",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	armorProfs : [true, false, false, false],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh between 150 and 200 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh between 70 and 90 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 1, 0, 0],
	features : {
		"saving face" : {
			name : "Saving Face",
			minlevel : 1,
			usages : 1,
			recovery : "short rest"
		}
	},
	trait : "Hobgoblin (+2 Constitution, +1 Intelligence)\n\nMartial Training: I am proficient with two martial weapons of my choice and light armor.\n\nSaving Face: Once per short rest, when I miss an attack roll or fail an ability check or a saving throw, I can gain a bonus to the roll equal to the number of allies I can see within 30 ft of me (max +5)."
};
RaceList["kenku"] = {
	regExpSearch : /kenku/i,
	name : "Kenku",
	source : [["V", 109], ["W", 177]],
	plural : "Kenku",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose two from Acrobatics, Deception, Stealth, and Sleight of Hand",
	languageProfs : ["Common", "Auran"],
	age : " reach maturity at about 12 years old and can live to 60",
	height : " are around 5 feet tall (4'4\" + 2d8\")",
	weight : " weigh between 90 and 120 lb (70 + 2d8 \xD7 1d4 lb)",
	heightMetric : " are around 1,5 metres tall (135 + 5d8 cm)",
	weightMetric : " weigh between 40 and 55 kg (35 + 5d8 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Kenku (+2 Dexterity, +1 Wisdom)"+
		"\n \u2022 Expert Forgery: Kenku can duplicate other creatures' handwriting and craftwork. I have advantage on all checks made to produce forgeries or duplicates of existing objects."+
		"\n \u2022 Mimicry: I can mimic any sounds I have heard, including voices, but can otherwise not speak. Creatures hearing these sounds can determine they are imitations with a successful Wisdom (Insight) check opposed by my Charisma (Deception)."
};
RaceList["kobold"] = {
	regExpSearch : /kobold/i,
	name : "Kobold",
	source : [["V", 119]],
	plural : "Kobolds",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Draconic"],
	vision : [["Darkvision", 60], ["Sunlight Sensitivity", 0]],
	age : " reach adulthood at age 6 and can live up to 120 years, but rarely do so",
	height : " are between 2 and 3 feet tall (2'1\" + 2d4\")",
	weight : " weigh between 25 and 35 lb (25 + 2d4 \xD7 1 lb)",
	heightMetric : " are between 65 and 90 cm tall (63 + 5d4 cm)",
	weightMetric : " weigh between 10 and 15 kg (11 + 5d4 \xD7 2 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 0],
	features : {
		"grovel, cower, and beg" : {
			name : "Grovel, Cower, and Beg",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["action", ""]
		}
	},
	trait : "Kobold (+2 Dexterity)\nSunlight Sensitivity: Disadvantage on attack rolls and Wisdom (Perception) checks that rely on sight when I or what I am trying to attack/perceive is in direct sunlight.\nGrovel, Cower, and Beg: As an action, I can distract all foes within 10 feet of me that can see me so that my allies gain advantage on attack rolls against them.\nPack Tactics: I have advantage on attack rolls against creatures when at least one of my allies is within 5 feet of that creature and that ally is not incapacitated."
};
RaceList["lizardfolk"] = {
	regExpSearch : /lizard(folk|man|men)/i,
	name : "Lizardfolk",
	source : [["V", 111]],
	plural : "Lizardfolk",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose two from Animal Handling, Nature, Perception, Stealth, and Survival",
	languageProfs : ["Common", "Draconic"],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /\bbite\b/i,
		name : "Bite",
		source : [["V", 113]],
		damage : [1, 6, "piercing"],
		selectNow : true
	}],
	armorOptions : [{
		regExpSearch : /^(?=.*natural)(?=.*armou?r).*$/i,
		name : "Natural Armor",
		source : [["V", 113]],
		ac : 13,
		selectNow : true
	}],
	age : " reach maturity around age 14 and rarely live longer than 60 years",
	height : " range from 5 to well over 6 feet tall (4'9\" + 2d10\")",
	weight : " weigh around 200 lb (120 + 2d10 \xD7 2d6 lb)",
	heightMetric : " range from 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 95 kg (55 + 5d10 \xD7 4d6 / 10 kg)",
	scores : [0, 0, 2, 0, 1, 0],
	features : {
		"cunning artisan" : {
			name : "Cunning Artisan",
			minlevel : 1,
			usages : 1,
			recovery : "short rest"
		},
		"hungry jaws" : {
			name : "Hungry Jaws",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		}
	},
	trait : "Lizardfolk (+2 Constitution, +1 Wisdom) Bite: I can use my fanged maw to make unarmed strikes dealing 1d6 piercing damage." + (typePF ? "\n" : " ") + "Cunning Artisan: As part of a short rest I can harvest parts of a slain creature to make a shield, club, javelin, or 1d4 darts/blowgun needles. This requires a suitable corpse and appropriate tools." + (typePF ? "\n" : " ") + "Hold Breath: I can hold my breath for up to 15 minutes at a time." + (typePF ? "\n" : " ") + "Natural Armor: I have an AC of 13 + Dexterity modifier + shield." + (typePF ? "\n" : " ") + "Hungry Jaws: As a bonus action, once per short rest, I can make a special bite attack and if it hits I gain temporary HP equal to my Con modifier (min 1)."
};
RaceList["orc"] = {
	regExpSearch : /^(?!.*half)(?=.*\bor(c|k)).*$/i,
	name : "Orc",
	source : [["V", 120], ["E:RLW", 32], ["W", 178]],
	plural : "Orcs",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Orc"],
	vision : [["Darkvision", 60]],
	skillstxt : "Choose two from Animal Handling, Insight, Intimidation, Medicine, Nature, Perception, and Survival.",
	age : " reach adulthood at age 12 and live up to 50 years",
	height : " are usually over 6 feet tall (5'4\" + 2d8\")",
	weight : " weigh between 230 and 280 lb (175 + 2d8 \xD7 2d6 lb)",
	heightMetric : " are usually over 1,8 metres tall (160 + 5d8 cm)",
	weightMetric : " weigh between 100 and 125 kg (80 + 5d8 \xD7 4d6 / 10 kg)",
	scores : [2, 0, 1, 0, 0, 0],
	trait : "Orc (+2 Strength, +1 Constitution)\n\nPowerful Build: I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift.\n\nAggressive: As a bonus action, I can move up to my speed toward an enemy that I can see or hear. I must end my move closer to this enemy than I started.",
	action : [["bonus action", "Aggressive (dash to enemy)"]],
	carryingCapacity : 2
};
RaceList["tabaxi"] = {
	regExpSearch : /tabaxi/i,
	name : "Tabaxi",
	source : [["V", 113], ["W", 179]],
	plural : "Tabaxi",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		climb : { spd : 20, enc : 10 }
	},
	skills : ["Perception", "Stealth"],
	languageProfs : ["Common", 1],
	vision : [["Darkvision", 60]],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*(tabaxi|\bcat\b))(?=.*claw).*$/i,
		name : "Tabaxi Claws",
		source : [["V", 115]],
		damage : [1, 4, "slashing"],
		selectNow : true
	}],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from 5 to well over 6 feet tall (4'10\" + 2d10\")",
	weight : " weigh around 150 lb (90 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 70 kg (40 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	features : {
		"feline agility" : {
			name : "Feline Agility",
			minlevel : 1,
			usages : 1,
			recovery : " Turn",
			additional : "still for 1 turn to recover",
			tooltip : " (can be replenished by not moving for one whole turn)"
		}
	},
	trait : "Tabaxi (+2 Dexterity, +1 Charisma)"+
	"\n \u2022 Cat's Talent: I have proficiency in Perception and Stealth."+
	"\n \u2022 Cat's Claws: I can use my retractable claws to make unarmed strikes dealing 1d4 slashing damage. They also give me a climbing speed of 20 ft."+
	"\n \u2022 Feline Agility: When moving on my turn in combat, I can move double my speed. Once I do this, I can't do it again until I don't move at all on one of my turns."
};
RaceList["triton"] = {
	regExpSearch : /triton/i,
	name : "Triton",
	source : [["V", 115], ["MOT", 26]],
	plural : "Triton",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial", "Emissary of the Sea"],
	dmgres : ["Cold"],
	vision : [["Darkvision", 60]],
	age : " reach maturity around age 15 and can live up to 200 years",
	height : " are around 5 feet tall (4'6\" + 2d10\")",
	weight : " weigh around 150 lb (90 + 2d10 \xD7 2d4 lb)",
	heightMetric : " are around 1,6 metres tall (135 + 5d10 cm)",
	weightMetric : " weigh around 70 kg (40 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 1, 0, 0, 1],
	trait : "Triton (+1 Strength, +1 Constitution, and +1 Charisma)\nControl Air and Water: I can cast the Fog Cloud spell. Once I reach 3rd level, I can cast the Gust of Wind spell. Once I reach 5th level, I can cast the Wall of Water spell. All three spells can be used once per long rest. Charisma is my spellcasting ability for these spells.\nEmissary of the Sea: I can communicate simple ideas to beasts that can breathe water.\nGuardians of the Depths: Adapted to even the most extreme ocean depths, I have resistance to cold damage." + (typePF ? "\n" : " ") + "Amphibious: I can breathe air and water.",
	spellcastingAbility : 6,
	features : {
		"fog cloud" : {
			name : "Control Air and Water (level 1)",
			limfeaname : "Fog Cloud",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Control Air and Water (1)",
				spells : ["fog cloud"],
				selection : ["fog cloud"],
				firstCol : 'oncelr'
			}
		},
		"gust of wind" : {
			name : "Control Air and Water (level 3)",
			limfeaname : "Gust of Wind",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Control Air and Water (3)",
				spells : ["gust of wind"],
				selection : ["gust of wind"],
				firstCol : 'oncelr'
			}
		},
		"wall of water" : {
			name : "Control Air and Water (level 5)",
			limfeaname : "Wall of Water",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Control Air and Water (5)",
				spells : ["wall of water"],
				selection : ["wall of water"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["yuan-ti pureblood"] = {
	regExpSearch : /^(?!.*human)(?=.*yuan.ti)(?=.*pure.?blood).*$/i,
	name : "Yuan-Ti Pureblood",
	source : [["V", 120]],
	plural : "Yuan-Ti Purebloods",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Abyssal", "Draconic"],
	vision : [["Darkvision", 60]],
	savetxt : {
		immune : ["poison"],
		adv_vs : ["magic"]
	},
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 1, 0, 2],
	trait : "Yuan-Ti Pureblood (+1 Intelligence, +2 Charisma)"+
		"\n \u2022 Innate Spellcasting: I know the Poison Spray cantrip and I can cast Animal Friendship on snakes at will. Once I reach 3rd level, I can cast Suggestion once per long rest. Charisma is my spellcasting ability for these spells."+
		"\n \u2022 Magic Resistance: I have advantage on saving throws against spells and other magical effects."+
		"\n \u2022 Poison Immunity: I am immune to poison damage and the poisoned condition.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Innate Spellcasting (level 1)",
		spells : ["poison spray", "animal friendship"],
		selection : ["poison spray", "animal friendship"],
		firstCol : 'atwill',
		times : 2
	},
	spellChanges : {
		"animal friendship" : {
			description : "One snake with Intelligence 3 or less save or charmed for the duration",
			changes : "I can cast Animal Friendship at-will, but only to target snakes."
		}
	},
	features : {
		"suggestion" : {
			name : "Innate Spellcasting (level 3)",
			limfeaname : "Suggestion",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Innate Spellcasting (level 3)",
				spells : ["suggestion"],
				selection : ["suggestion"],
				firstCol : 'oncelr'
			}
		}
	}
};

// Creatures
CreatureList["aurochs"] = {
	name : "Aurochs",
	source : [["V", 207], ["MotM", 71]],
	size : 2, //Large
	type : "Beast",
	subtype : "cattle", // MotM addition
	alignment : "Unaligned",
	ac : 11,
	hp : 38,
	hd : [4, 10], //[#, die]
	speed : "50 ft",
	scores : [20, 10, 19, 2, 12, 5], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 11,
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Gore",
		ability : 1,
		damage : [2, 8, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, see Charge trait"
	}],
	traits : [{
		name : "Charge",
		description : "If the aurochs moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 9 (2d8) piercing damage. A targeted creature must succeed on a DC 15 Strength saving throw or be knocked prone."
	}]
};
CreatureList["cow"] = {
	name : "Cow",
	source : [["V", 207]],
	size : 2, //Large
	type : "Beast",
	subtype : "cattle", // MotM addition
	alignment : "Unaligned",
	ac : 10,
	hp : 15,
	hd : [2, 10], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Gore",
		ability : 1,
		damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
	}],
	traits : [{
		name : "Charge",
		description : "If the cow moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
	}]
};
CreatureList["ox"] = {
	name : "Ox",
	source : [["V", 208], ["MotM", 72]],
	size : 2, //Large
	type : "Beast",
	subtype : "cattle", // MotM addition
	alignment : "Unaligned",
	ac : 10,
	hp : 15,
	hd : [2, 10], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Gore",
		ability : 1,
		damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
	}],
	traits : [{
		name : "Charge",
		description : "If the ox moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
	}, {
		name : "Beast of Burden",
		description : "The oxen is considered to be a Huge animal for the purpose of determining its carrying capacity."
	}]
};
CreatureList["deep rothe"] = {
	name : "Deep Roth\xE9",
	nameAlt : ["Roth\xE9, Deep"],
	source : [["V", 208], ["MotM", 71]],
	size : 3, //Medium
	type : "Beast",
	subtype : "cattle", // MotM addition
	alignment : "Unaligned",
	ac : 10,
	hp : 13,
	hd : [2, 8], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Gore",
		ability : 1,
		damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
	}],
	traits : [{
		name : "Charge",
		description : "If the roth\xE9 moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
	}, {
		name : "Dancing Lights",
		description : "The roth\xE9 casts dancing lights, requiring no spell components and using Wisdom as the spellcasting ability."
	}]
};
CreatureList["rothe"] = {
	name : "Roth\xE9",
	source : [["V", 208]],
	size : 2, //Large
	type : "Beast",
	subtype : "cattle", // MotM addition
	alignment : "Unaligned",
	ac : 10,
	hp : 15,
	hd : [2, 10], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "Darkvision 30 ft",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Gore",
		ability : 1,
		damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
	}],
	traits : [{
		name : "Charge",
		description : "If the roth\xE9 moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
	}]
};
CreatureList["stench kow"] = {
	name : "Stench Kow",
	source : [["V", 208], ["MotM", 72]],
	size : 2, //Large
	type : "Fiend", // Change in MotM from Beast
	subtype : "cattle", // MotM addition
	alignment : "Unaligned",
	ac : 10,
	hp : 15,
	hd : [2, 10], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	damage_resistances : "cold, fire, and poison damage",
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Gore",
		ability : 1,
		damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
	}],
	traits : [{
		name : "Charge",
		description : "If the stench kow moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
	}, {
		name : "Stench",
		description : "Any creature other than a stench kow starting its turn within 5 ft of a stench kow must make a DC 12 Constitution saving throw or be poisoned until the start of the creature's next turn. On a successful saving throw, the creature is immune to the stench of all stench kows for 1 hour."
	}],
	wildshapeString : "Darkvision 60 ft | Resistant to: cold, fire, poison | Charge: If the stench kow moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, it deals extra 2d6 piercing damage | Stench: Any creature starting its turn within 5 ft of a stench kow must make a DC 12 Con save or be poisoned until the start of the its next turn. On a success, it is immune to the stench of all stench kows for 1 hour"
};
CreatureList["dolphin"] = {
	name : "Dolphin",
	source : [["V", 208], ["MotM", 97]],
	size : 3, //Medium
	type : "Beast",
	alignment : "Unaligned",
	ac : 12,
	hp : 11,
	hd : [2, 8], //[#, die]
	speed : "swim 60 ft",
	scores : [14, 13, 13, 6, 12, 7], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 3
	},
	senses : "Blindsight 60 ft",
	passivePerception : 13,
	challengeRating : "1/8",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Slam",
		ability : 1,
		damage : [1, 6, "bludgeoning"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "If used after moving 30 ft straight in the same round, deals extra 1d6 damage (Charge)"
	}],
	traits : [{
		name : "Charge",
		description : "If the dolphin moves at least 30 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 3 (1d6) bludgeoning damage."
	}, {
		name : "Hold Breath",
		description : "The dolphin can hold its breath for 20 minutes."
	}]
};
CreatureList["cranium rat"] = {
	name : "Cranium Rat",
	nameAlt : ["Rat, Cranium"],
	source : [["V", 133], ["MotM", 83]],
	size : 5, //Tiny
	type : "Aberration", // Change in MotM from Beast
	companion : "familiar_not_al",
	alignment : "Lawful Evil",
	ac : 12,
	hp : 2,
	hd : [1, 4], //[#, die]
	speed : "30 ft",
	scores : [2, 14, 10, 4, 11, 8], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "Darkvision 30 ft",
	passivePerception : 10,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, "", "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "",
		abilitytodamage : false
	}],
	traits : [{
		name : "Illumination",
		description : "As a bonus action, the cranium rat can shed dim light from its brain in a 5-foot radius or extinguish the light."
	}, {
		name : "Telepathic Shroud",
		description : "The cranium rat is immune to any effect that would sense its emotions or read its thoughts, as well as to all divination spells."
	}]
};
CreatureList["brontosaurus"] = {
	name : "Brontosaurus",
	source : [["V", 139], ["ToA", 215], ["MotM", 95]],
	size : 0, //Gargantuan
	type : "Beast",
	subtype : "dinosaur", // MotM addition
	alignment : "Unaligned",
	ac : 15,
	hp : 121,
	hd : [9, 20], //[#, die]
	speed : "30 ft",
	scores : [21, 9, 17, 2, 10, 7], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", 6, "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	challengeRating : "5",
	proficiencyBonus : 3,
	attacksAction : 1,
	attacks : [{
		name : "Stomp",
		ability : 1,
		damage : [5, 8, "bludgeoning"], //[#, die, type] "" for die is allowed
		range : "Melee (20 ft)",
		description : "Target must succeed on a DC 14 Strength saving throw or be knocked prone"
	}, {
		name : "Tail",
		ability : 1,
		damage : [6, 8, "bludgeoning"], //[#, die, type] "" for die is allowed
		range : "Melee (20 ft)",
		description : ""
	}]
};
CreatureList["deinonychus"] = {
	name : "Deinonychus",
	source : [["V", 139], ["ToA", 217], ["MotM", 95]],
	size : 3, //Medium
	type : "Beast",
	subtype : "dinosaur", // MotM addition
	alignment : "Unaligned",
	ac : 13,
	hp : 26,
	hd : [4, 8], //[#, die]
	speed : "40 ft",
	scores : [15, 15, 14, 4, 12, 6], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 3
	},
	senses : "",
	passivePerception : 13,
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 3,
	attacks : [{
		name : "Claw",
		ability : 1,
		damage : [1, 8, "slashing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "Two claw and one bite as one Attack action; If used after moving 20 ft straight in the same round, see Pounce trait"
	}, {
		name : "Bite",
		ability : 1,
		damage : [1, 8, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "Two claw and one bite as one Attack action (also, see Pounce trait)"
	}],
	traits : [{
		name : "Multiattack",
		description : "The deinonychus makes three attacks: two with its claws and one with its bite."
	}, {
		name : "Pounce",
		description : "If the deinonychus moves at least 20 ft straight toward a creature and then hits it with a claw attack on the same turn, that target must succeed on a DC 12 Strength saving throw or be knocked prone. If the target is prone, the deinonychus can make one bite attack against it as a bonus action."
	}]
};
CreatureList["dimetrodon"] = {
	name : "Dimetrodon",
	source : [["V", 139], ["ToA", 217], ["MotM", 95]],
	size : 3, //Medium
	type : "Beast",
	subtype : "dinosaur", // MotM addition
	alignment : "Unaligned",
	ac : 12,
	hp : 19,
	hd : [3, 8], //[#, die]
	speed : "30 ft, swim 20 ft",
	scores : [14, 10, 15, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : ""
	}]
};
CreatureList["hadrosaurus"] = {
	name : "Hadrosaurus",
	source : [["V", 140], ["ToA", 224], ["MotM", 96]],
	size : 2, //Large
	type : "Beast",
	subtype : "dinosaur", // MotM addition
	alignment : "Unaligned",
	ac : 11,
	hp : 19,
	hd : [3, 10], //[#, die]
	speed : "40 ft",
	scores : [15, 10, 13, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Tail",
		ability : 1,
		damage : [1, 10, "bludgeoning"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : ""
	}]
};
CreatureList["quetzalcoatlus"] = {
	name : "Quetzalcoatlus",
	source : [["V", 140], ["ToA", 230], ["MotM", 96]],
	size : 1, //Huge
	type : "Beast",
	subtype : "dinosaur", // MotM addition
	alignment : "Unaligned",
	ac : 13,
	hp : 30,
	hd : [4, 12], //[#, die]
	speed : "10 ft, fly 80 ft",
	scores : [15, 13, 13, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [3, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (10 ft)",
		description : "If used after diving 30 ft towards a target, the attack deals 3d6 extra damage (Dive Attack)"
	}],
	traits : [{
		name : "Dive Attack",
		description : "If the quetzalcoatlus is flying and dives at least 30 ft toward a creature and then hits it with a bite attack, the attack deals an extra 10 (3d6) damage to the target."
	}, {
		name : "Flyby",
		description : "The quetzalcoatlus doesn't provoke opportunity attacks when it flies out of an enemy's reach."
	}]
};
CreatureList["stegosaurus"] = {
	name : "Stegosaurus",
	source : [["V", 140], ["ToA", 231], ["MotM", 96]],
	size : 1, //Huge
	type : "Beast",
	subtype : "dinosaur", // MotM addition
	alignment : "Unaligned",
	ac : 13,
	hp : 76,
	hd : [8, 12], //[#, die]
	speed : "40 ft",
	scores : [20, 9, 17, 2, 11, 5], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	challengeRating : "4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [6, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (10 ft)",
		description : ""
	}]
};
CreatureList["velociraptor"] = {
	name : "Velociraptor",
	source : [["V", 140], ["ToA", 235], ["MotM", 96]],
	size : 5, //Tiny
	type : "Beast",
	subtype : "dinosaur", // MotM addition
	alignment : "Unaligned",
	ac : 13,
	hp : 10,
	hd : [3, 4], //[#, die]
	speed : "30 ft",
	scores : [6, 14, 13, 4, 12, 6], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 3
	},
	senses : "",
	passivePerception : 13,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "One bite and one claw attack as an Attack action"
	}, {
		name : "Claw",
		ability : 2,
		damage : [1, 4, "slashing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "One bite and one claw attack as an Attack action"
	}],
	actions : [{
		name : "Multiattack",
		description : "The velociraptor makes two attacks: one with its bite and one with its claws."
	}],
	traits : [{
		name : "Pack Tactics",
		description : "The velociraptor has advantage on an attack roll against a creature if at least one of the velociraptor's allies is within 5 ft of the creature and the ally isn't incapacitated."
	}]
};
CreatureList["gazer"] = {
	name : "Gazer",
	source : [["V", 126], ["MotM", 134]],
	size : 5, //Tiny
	type : "Aberration",
	subtype : "Beholder", // MotM addition
	companion : "familiar_not_al",
	alignment : "Neutral Evil",
	ac : 13,
	hp : 13,
	hd : [3, 4], //[#, die]
	speed : "0 ft, fly 30 ft",
	scores : [3, 17, 14, 3, 10, 7], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", 2, ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 4,
		"stealth" : 5
	},
	senses : "Darkvision 60 ft",
	passivePerception : 14,
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, "", "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : ""
	}, {
		name : "Eye Rays",
		ability : 3,
		damage : ["Special", "", ""], //[#, die, type] "" for die is allowed
		range : "60 ft",
		description : "Shoot two randomly determined different rays as one action; Each ray has its own target; See traits",
		dc : true,
		abilitytodamage : false
	}],
	traits : [{
		name : "Aggressive",
		description : "As a bonus action, the gazer moves its speed toward an enemy that it can see."
	}, {
		name : "Mimicry",
		description : "The gazer can mimic simple speech it has heard, in any language. Any who hear this can tell it is an imitation with a successful DC 10 Wis (Insight) check."
	}],
	actions : [{
		name : "Eye Rays",
		description : "1. Dazing Ray: Wisdom saving throw or charmed until the start of the gazer's next turn. While charmed, half speed and disadv. on attacks.\n2. Fear Ray: Wisdom saving throw or frightened until the start of the gazer's next turn.\n3. Frost Ray: Target must make a Dexterity saving throw or 10 (3d6) cold damage.\n4. Telekinetic Ray: Medium or smaller creature, Strength saving throw or be moved up to 30 ft away from the gazer. If it is an unattended Tiny object, the gazer moves it up to 30 ft in any direction. It can exert fine control on objects this way." // MotM: no longer 10 lb limit, just Tiny object
	}],
	variant : [{
		name : "Variant: Familiar",
		description : "The gazer can serve another creature as a familiar, forming a telepathic bond with its willing master, provided that the master is at least a 3rd-level spellcaster. While the two are bonded, the master can sense what the gazer senses as long as they are within 1 mile of each other. If its master causes it physical harm, the gazer will end its service as a familiar, breaking the telepathic bond."
	}]
};

// Magic Items
MagicItemsList["mind blade"] = {
	name : "Mind Blade",
	source : [["V", 81]],
	type : "weapon (any sword)",
	rarity : "rare",
	description : "Mind flayers can turn any nonmagical sword into a mind blade. Only one creature can attune to this sword: either a specific mind flayer or one of its thralls. In the hands of its intended wielder, the mind blade is a magic weapon that deals an extra 2d6 psychic damage to any target it hits.",
	descriptionFull : "Mind flayers can turn any nonmagical sword into a mind blade. Only one creature can attune to it: either a specific mind flayer or one of its thralls. In the hands of any other creature, the mind blade functions as a normal sword of its kind. In the hands of its intended wielder, the mind blade is a magic weapon that deals an extra 2d6 psychic damage to any target it hits.",
	attunement : true,
	prerequisite : "Requires attunement by the creature this armor was made for: either a specific mind flayer or one of its thralls",
	prereqeval : function (v) { return false; },
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/^(?=.*mind)(?=.*blade).*$/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + '+2d6 psychic damage';
				}
			},
			'If I include the words "Mind Blade" in a the name of a sword, it will be treated as the magic weapon Mind Blade, which adds +2d6 psychic damage on any hit as long as attuned to its intended wielder.'
		]
	}
}
MagicItemsList["mind carapace armor"] = {
	name : "Mind Carapace Armor",
	source : [["V", 81]],
	type : "armor (heavy)",
	rarity : "uncommon",
	description : "Only one creature can attune to this armor: either a specific mind flayer or one of its thralls. To its intended wearer, the armor grants advantage on Intelligence, Wisdom, and Charisma saving throws and makes its wearer immune to the frightened condition.",
	descriptionFull : "Any nonmagical suit of heavy armor can be turned by mind flayers into mind carapace armor. Only one creature can attune to it: either a specific mind flayer or one of its thralls. While worn by any other creature, the mind carapace armor functions as normal armor of its kind. To its intended wearer, the armor grants advantage on Intelligence, Wisdom, and Charisma saving throws and makes its wearer immune to the frightened condition.",
	attunement : true,
	prerequisite : "Requires attunement by the creature this armor was made for: either a specific mind flayer or one of its thralls",
	prereqeval : function (v) { return false; },
	savetxt : { text : ["Adv. on Int, Wis, and Cha saves"], immune : ["frightened"] },
	advantages : [["Intelligence", true], ["Wisdom", true], ["Charisma", true]],
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["suffix", "Mind Carapace"],
		excludeCheck : function (inObjKey, inObj) {
			return !(/heavy/i).test(inObj.type);
		}
	}
}
MagicItemsList["mind lash"] = {
	name : "Mind Lash",
	source : [["V", 81]],
	type : "weapon (whip)",
	rarity : "rare",
	description : "This magic whip strips away a creature's will to survive as it also strips away flesh and deals +2d4 psychic damage on each hit. Any target taking psychic damage must succeed on a DC 15 Wisdom save or have disadv. on Int, Wis, and Cha saves for 1 minute. It can repeat the save at the end of each of its turns.",
	descriptionFull : "In the hands of any creature other than a mind flayer, a mind lash functions as a normal whip. In the hands of an illithid, this magic weapon strips away a creature's will to survive as it also strips away flesh, dealing an extra 2d4 psychic damage to any target it hits. Any creature that takes psychic damage from the mind lash must also succeed on a DC 15 Wisdom saving throw or have disadvantage on Intelligence, Wisdom, and Charisma saving throws for 1 minute. The creature can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success.",
	attunement : true,
	weight : 3,
	prerequisite : "Requires attunement by an illithid",
	prereqeval : function (v) { return (/mind flayer|illithid/i).test(What("Race")); },
	weaponOptions : [{
		baseWeapon : "whip",
		regExpSearch : /^(?=.*mind)(?=.*lash).*$/i,
		name : "Mind Lash",
		source : [["V", 81]],
		description : "Finesse, reach; +2d4 psychic damage; DC 15 Wis save or disadv. on Int/Wis/Cha saves for 1 min",
		selectNow : true
	}]
}
MagicItemsList["shield of far sight"] = {
	name : "Shield of Far Sight",
	source : [["V", 81]],
	type : "shield",
	rarity : "rare",
	description : "The mind flayer that created this shield can see through its eye with 60 ft darkvision while it is on the same plane. While peering through this magical eye, the mind flayer can use its Mind Blast action as though it were standing behind the shield. If a shield of far sight is destroyed, its creator is blinded for 2d12 hours.",
	descriptionFull : "A mind flayer skilled at crafting magic items creates a shield of far sight by harvesting an eye from an intelligent humanoid and magically implanting it on the outer surface of a nonmagical shield. The shield becomes a magic item once the eyes is implanted, whereupon the mind flayer can give the shield to a thrall or hang it on a wall in its lair. As long as the shield is on the same plane of existence as its creator, the mind flayer can see through the shield's eye, which has darkvision out to a range of 60 feet. While peering through this magical eye, the mind flayer can use its Mind Blast action as though it were standing behind the shield.\n   If a shield of far sight is destroyed, the mind flayer that created it is blinded for 2d12 hours.",
	weight : 6,
	shieldAdd : "Shield of Far Sight"
}
MagicItemsList["survival mantle"] = {
	name : "Survival Mantle",
	source : [["V", 81]],
	type : "armor (half plate)",
	rarity : "unknown",
	description : "This mantle functions as a half plate and takes just as long to don or doff. It encases portions of my shoulders, neck, and chest so that I can breathe normally in any environment (including a vacuum) and gives me advantage on saving throws against gases (such as Cloudkill, Stinking Cloud, or inhaled poisons).",
	descriptionFull : "This carapace-like augmentation encases portions of the wearer's shoulders, neck, and chest. A survival mantle is equivalent to a suit of nonmagical half plate armor and takes just as long to don or doff. It can't be worn with other kinds of armor.\n   A creature wearing a survival mantle can breathe normally in any environment (including a vacuum) and has advantage on saving throws against harmful gases (such as those created by a Cloudkill spell, a Stinking Cloud spell, inhaled poisons, and the breath weapons of some dragons).",
	weight : 40,
	savetxt : { adv_vs : ["gases"] },
	armorOptions : [{
		regExpSearch : /^(?=.*survival)(?=.*mantle).*$/i,
		name : "Survival Mantle",
		source : [["V", 81]],
		type : "medium",
		ac : 15,
		stealthdis : true,
		weight : 40,
		selectNow : true
	}]
}

// pub_20170404_TftYP.js
// This file adds the beasts from the Tales from the Yawning Portal adventure book to MPMB's Character Record Sheet

// Define the source
SourceList.TftYP={
	name : "Tales from the Yawning Portal [beasts, items]",
	abbreviation : "TftYP",
	group : "Adventure Books",
	campaignSetting : "Anthology",
	url : "https://dnd.wizards.com/products/tales-yawning-portal",
	date : "2017/04/04"
};

// Creatures
// Snow leopard is just a tiger under a different name, it has been added to the SRD code as a `nameAlt`
CreatureList["giant crayfish"] = {
	name : "Giant Crayfish",
	nameAlt : ["Crayfish, Giant"],
	source : [["TftYP", 235]],
	size : 2, //Large
	type : "Beast",
	alignment : "Unaligned",
	ac : 15,
	hp : 45,
	hd : [7, 10], //[#, die]
	speed : "30 ft, swim 30 ft",
	scores : [15, 13, 13, 1, 9, 3], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 3
	},
	senses : "Blindsight 30 ft",
	passivePerception : 9,
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
			name : "Claw",
			ability : 1,
			damage : [1, 10, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Target grappled on hit (escape DC 12); 2 claw attacks as Attack action, if not grappling with claw"
		}
	],
	traits : [{
			name : "Amphibious",
			description : "The giant crayfish can breathe air and water."
		}
	]
};
CreatureList["giant ice toad"] = {
	name : "Giant Ice Toad",
	nameAlt : ["Toad, Giant Ice"],
	source : [["TftYP", 235]],
	size : 2, //Large
	type : "Monstrosity",
	alignment : "Unaligned",
	ac : 14,
	hp : 52,
	hd : [7, 10], //[#, die]
	speed : "30 ft",
	scores : [16, 13, 14, 8, 10, 6], //[Str, Dex, Con, Int, Wis, Cha]
	damage_immunities : "cold",
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	languages : "Ice Toad",
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Target is grappled and restrained (escape DC 13); Can't use bite again until grapple ends"
		}
	],
	traits : [{
			name : "Amphibious",
			description : "The toad can breathe air and water"
		}, {
			name : "Cold Aura",
			description : "A creature that starts its turn within 10 feet of the toad takes 5 (1d10) cold damage."
		}, {
			name : "Standing Leap",
			description : "The toad's long jump is up to 20 ft and its high jump is up to 10 ft, with or without a running start."
		}
	],
	features : [{
			name : "Swallow",
			description : "The toad can make a bite attack against a Medium or smaller target it is grappling. If it hits, the target takes bite damage, is swallowed, and the grapple ends. The swallowed target is blinded and restrained, it has total cover against attacks and other effects outside the toad, and it takes 10 (3d6) acid damage and 11 (2d6) cold damage at the start of each of the toad's turns. The toad can have only one target swallowed at a time.\nIf the toad dies, a swallowed creature is no longer restrained by it and can escape from the corpse using 5 feet of movement, exiting prone."
		}
	],
	wildshapeString : "Darkvision 60 ft| Cold Aura: Any within 5 ft at start of their turn take 1d10 cold damage| Amphibious: breathe air and water| Standing Leap: long jump 20 ft and high jump 10 ft, regardless of start| Swallow: if bite attack hits Medium or smaller being grappling, it takes bite damageand is swallowed: blinded, restrained, total cover, takes 3d6 acid and 2d6 cold damage at the start of each of the toad's turns; Only 1 swallowed at a time."
};
CreatureList["giant lightning eel"] = {
	name : "Giant Lightning Eel",
	nameAlt : ["Eel, Giant Lightning"],
	source : [["TftYP", 236]],
	size : 2, //Large
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 42,
	hd : [5, 10], //[#, die]
	speed : "5 ft, swim 30 ft",
	scores : [11, 17, 16, 2, 12, 3], //[Str, Dex, Con, Int, Wis, Cha]
	damage_resistances : "lightning",
	senses : "Blindsight 60 ft",
	passivePerception : 11,
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
		range : "Melee (5 ft)",
		description : "+1d8 lightning damage on a hit; Two bite attacks as an Attack action"
	}, {
		name : "Lightning Jolt (Recharge 5-6)",
		ability : 3,
		damage : [3, 8, "lightning"], //[#, die, type] "" for die is allowed
		range : "Out/in 5/15 ft",
		dc : true,
		description : "Out water: 5 ft, 1 crea; In water: all in 15 ft; Con save: fail― stunned until eel's next turn end, success― half damage",
		modifiers : [-1, ""],
		abilitytodamage : false,
		tooltip : "One creature the eel touches within 5 feet of it outside water, or each creature within 15 feet of it in a body of water, must make a DC 12 Constitution saving throw. On failed save, a target takes 13 (3d8) lightning damage. If the target takes any of this damage, the target is stunned until the end of the eel's next turn. On a successful save, a target takes half as much damage and isn't stunned"
	}],
	traits : [{
		name : "Water Breathing",
		description : "The eel can breathe only underwater."
	}],
	actions : [{
		name : "Multiattack",
		description : "The eel makes two bite attacks."
	}, {
		name : "Lightning Jolt (Recharge 5-6)",
		description : "See Attack. One creature the eel touches within 5 feet of it outside water, or each creature within 15 feet of it in a body of water, must make a DC 12 Constitution saving throw. On failed save, a target takes 13 (3d8) lightning damage. If the target takes any of this damage, the target is stunned until the end of the eel's next turn. On a successful save, a target takes half as much damage and isn't stunned"
	}]
};
CreatureList["giant subterranean lizard"] = {
	name : "Giant Subterranean Lizard",
	nameAlt : ["Lizard, Giant Subterranean"],
	source : [["TftYP", 236]],
	size : 1, //Huge
	type : "Beast",
	alignment : "Unaligned",
	ac : 14,
	hp : 66,
	hd : [7, 12], //[#, die]
	speed : "30 ft, swim 50 ft",
	scores : [21, 9, 17, 2, 10, 7], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 3
	},
	senses : "",
	passivePerception : 10,
	challengeRating : "4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 10, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "1 bite \u0026 1 tail attack as Attack action; Target grappled \u0026 restrained (escape DC 15); Can't use bite until grapple ends"
		}, {
			name : "Tail",
			ability : 1,
			damage : [2, 6, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (10 ft)",
			description : "1 bite \u0026 1 tail attack as Attack action; Target DC 15 Str save or knocked prone"
		}
	],
	traits : [{
			name : "Swallow",
			description : "The lizard can make one bite attack against a Medium or smaller target it is grappling. If the attack hits, the target takes bite damage, is swallowed, and the grapple ends. The swallowed target is blinded and restrained, it has total cover against attacks and other effects outside the lizard, and it takes 10 (3d6) acid damage at the start of each of the lizard's turns. The lizard can have only one target swallowed at a time.\nIf the lizard dies, a swallowed creature is no longer restrained by it and can escape from the corpse using 10 feet of movement, exiting prone."
		}
	],
	wildshapeString : "\u25C6 Swallow: If a bite attack hits a Small or smaller target that is currently being grappled by the lizard, the target is swallowed, ending the grapple. While swallowed, it is blinded, restrained, has total cover, and takes 3d4 acid damage at the start of each of the lizard's turns; The lizard can have only 1 swallowed at a time. If the lizard dies, the swallowed creature is no longer restrained and can escape using 10 ft movement."
};

// Magic Items
MagicItemsList["flame tongue shortsword of gem detection"] = {	// contributed by Nod_Hero
	name : "Flame Tongue Shortsword of Gem Detection",
	source : [["TftYP", 178]],
	type : "weapon (shortsword)",
	attunement : true,
	description : "As a bonus action, I can speak the command word to cause flames that add +2d6 fire damage and shine bright light for 40 ft \u0026 dim light for 40 ft. The flames last until I speak the word again or sheathe it. As an action, I can mentally command it to detect type and quantity of gems and jewels within 60 ft of the sword.",
	descriptionFull : "You can use a bonus action to speak this magic sword's command word, causing flames to erupt from the blade. These flames shed bright light in a 40-foot radius and dim light for an additional 40 feet. While the sword is ablaze, it deals an extra 2d6 fire damage to any target it hits. The flames last until you use a bonus action to speak the command word again or until you drop or sheathe the sword."+
	"\n   While you are attuned to this sword you can use an action to mentally command it to detect gems and jewels. You learn the kind and number of such objects within 60 feet of the sword.",
	action : [
		["bonus action", "Flame Tongue (activate/end)"],
		["action", "Gem Detection (within 60 ft)"]
	],
	weaponOptions : [{
		baseWeapon : "shortsword",
		regExpSearch : /^(?=.*flame tongue)(?=.*short)(?=.*sword).*$/i,
		name : "Flame Tongue Shortsword",
		source : [["TftYP", 179]],
		description : "Finesse, light; While active, +2d6 fire damage",
		selectNow : true
	}]
};
MagicItemsList["amulet of protection from turning"] = {
	name : "Amulet of Protection from Turning",
	source : [["TftYP", 228]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "This silver and turquoise amulet has 3 charges, regain all at dawn. It gives me adv. on saves against effects that turn undead. If I fail a save against such an effect, I can expend 1 charge to succeed instead. It glows with a silvery blue light for a few seconds each time an effect that turns undead is used on me.",
	descriptionFull : "While you wear this amulet of silver and turquoise, you have advantage on saving throws against effects that turn undead.\n   If you fail a saving throw against such an effect, you can choose to succeed instead. You can do so three times, and expended uses recharge daily at dawn. Each time an effect that turns undead is used against you, the amulet glows with silvery blue light for a few seconds.",
	attunement : true,
	weight : 1,
	usages : 3,
	recovery : "dawn",
	savetxt : { adv_vs : ["turn undead"] }
}
MagicItemsList["balance of harmony"] = {
	name : "Balance of Harmony",
	source : [["TftYP", 228]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "D",
	description : "I can use the scale to cast Detect Evil and Good as a ritual by placing a gem of 100 gp or more or holy water on both pans. It then tips to the side it detected, good or evil, or fluctuates slightly if what it detected is neutral. After this, I can touch it to learn the rest of the information the spell normally conveys.",
	descriptionFull : "This scale bears celestial symbols on one pan and fiendish symbols on the other. You can use the scale to cast Detect Evil and Good as a ritual. Doing so requires you to place the scale on a solid surface, then sprinkle the pans with holy water or place a transparent gem worth 100 gp in each pan. The scale remains motionless if it detects nothing, tips to one side or the other for good (consecrated) or evil (desecrated), and fluctuates slightly if it detects a creature appropriate to the spell but neither good nor evil. By touching the scales after casting the ritual, you instantly learn any information the spell can normally convey, and then the effect ends.",
	weight : 1,
	spellcastingBonus : {
		name : "Only as ritual",
		spells : ["detect evil and good"],
		selection : ["detect evil and good"],
		firstCol : "(R)"
	},
	spellChanges : {
		"detect evil and good" : {
			time : "10 min",
			compMaterial : "The Balance of Harmony requires placing the scale on a solid surface and sprinkling the pans with holy water or placing a transparent gem worth 100 gp in each pan.",
			changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
		}
	}
}
MagicItemsList["bracelet of rock magic"] = {
	name : "Bracelet of Rock Magic",
	source : [["TftYP", 228]],
	type : "wondrous item",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This gold bracelet grants me immunity to being petrified. It has 16 charges to cast Flesh to Stone (DC 15). Once all charges are used, it turns to lead and loses its magic. If I use it to target a creature strongly related to stone, the target has adv. on its save. If it saves, Flesh to Stone is cast on me with disadv. on the save.",
	descriptionFull : "While you wear this gold bracelet, it grants you immunity to being petrified, and it allows you to cast Flesh to Stone (save DC 15) as an action. Once the spell has been cast three times, the bracelet can no longer cast it. Thereafter, you can cast Stone Shape as an action. After you have done this thirteen times, the bracelet loses its magic and turns from gold to lead.\n   " + toUni("Curse") + ". The bracelet's affinity with earth manifests as an unusual curse. Creatures of flesh that are strongly related to earth and stone, such as stone giants and dwarves, have advantage on the saving throw against Flesh to Stone cast from the bracelet. If such a creature's save is successful, the bracelet breaks your attunement to it and casts the spell on you. You make your saving throw with disadvantage, and on a failed save you are petrified instantly.",
	attunement : true,
	weight : 1,
	cursed : true,
	usages : 16,
	recovery : "Never",
	savetxt : { immune : ["petrified"] },
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["flesh to stone"],
		selection : ["flesh to stone"],
		firstCol : 1
	}
}
MagicItemsList["eagle whistle"] = {
	name : "Eagle Whistle",
	source : [["TftYP", 228]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "Three times per dawn, I can blow this whistle, gaining a flying speed equal to twice my walking speed while I do so continuously. I can blow it for a number for rounds equal to 5 + five times my Constitution modifier (minimum of 1 round) or until I talk, hold my breath, start suffocating, or land.",
	descriptionFull : "While you blow an eagle whistle continuously, you can fly twice as fast as your walking speed. You can blow the whistle continuously for a number of rounds equal to 5 + five times your Constitution modifier (minimum of 1 round) or until you talk, hold your breath, or start suffocating. A use of the whistle also ends if you land. If you are aloft when you stop blowing the whistle, you fall. The whistle has three uses. It regains expended uses daily at dawn.",
	weight : 1,
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["hell hound cloak"] = {
	name : "Hell Hound Cloak",
	source : [["TftYP", 228]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "H",
	description : "As an action, I can command this cloak to Polymorph me into a hell hound for 1 hour, or until I stop it as a bonus action. The 6th time I use it and every time after, I must make a DC 15 Cha save or be stuck in hell hound form until dispelled or I drop to 0 HP. If I remain in hell hound form for 6 hours, it becomes permanent.",
	descriptionFull : "This dark cloak is made of cured hell hound hide. As an action, you can command the cloak to transform you into a hell hound for up to 1 hour. The transformation otherwise functions as the Polymorph spell, but you can use a bonus action to revert to your normal form.\n   " + toUni("Curse") + ". This cloak is cursed with the essence of a hell hound, and becoming attuned to it extends the curse to you. Until the curse is broken with Remove Curse or similar magic, you are unwilling to part with the cloak, keeping it within reach at all times.\n   The sixth time you use the cloak, and each time thereafter, you must make a DC 15 Charisma saving throw. On a failed save, the transformation lasts until dispelled or until you drop to 0 hit points, and you can't willingly return to normal form. If you ever remain in hell hound form for 6 hours, the transformation becomes permanent and you lose your sense of self. All your statistics are then replaced by those of a hell hound. Thereafter, only Remove Curse or similar magic allows you to regain your identity and return to normal. If you remain in this permanent form for 6 days, only a Wish spell can reverse the transformation.",
	attunement : true,
	weight : 1,
	cursed : true
}
MagicItemsList["javelin of backbiting"] = {
	name : "Javelin of Backbiting",
	source : [["TftYP", 229]],
	type : "weapon (javelin)",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This javelin has +2 to hit and damage, +30 ft range, and deals +1d6 damage when thrown. After a throwing attack, it flies back to my hand immediately. While its curse lasts, I'm unwilling to part with it and have disadv. on attacks with other weapon. Also, on a roll of 1 to hit, I roll the attack again, but at myself with adv.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic weapon. When you throw it, its normal and long ranges both increase by 30 feet. and it deals one extra die of damage on a hit. After you throw it and it hits or misses, it flies back to your hand immediately.\n   " + toUni("Curse") + ". This weapon is cursed, and becoming attuned to it extends the curse to you. Until the curse is broken with Remove Curse or similar magic, you are unwilling to part with the weapon, keeping it within reach at all times. In addition, you have disadvantage on attack rolls made with weapons other than this one.\n   Whenever you roll a 1 on an attack roll using this weapon, the weapon bends or flies to hit you in the back. Make a new attack roll with advantage against your own AC. If the result is a hit, you take damage as if you had attacked yourself with the spear.",
	attunement : true,
	weight : 2,
	cursed : true,
	weaponOptions : [{
		baseWeapon : "javelin",
		regExpSearch : /^(?=.*javelin)(?=.*backbiting).*$/i,
		name : "Javelin of Backbiting",
		source : [["TftYP", 229]],
		range : "Melee, 60/150 ft",
		description : "Thrown; +1d6 damage if thrown; Returning; On 1 to hit: attack myself with adv.",
		modifiers : [2, 2],
		selectNow : true
	}]
}
MagicItemsList["loadstone"] = {
	name : "Loadstone",
	nameAlt : "Lodestone",
	source : [["TftYP", 228]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "The large gem worth 150 gp is cursed. Detect Magic doesn't detect it, but Identify does reveal its nature. If I take the Dash or Disengage action while it is on my person, its curse activates. While cursed, I am unwilling to part with it, my speed is reduced by 5 ft, and my maximum load and lift capacities are halved.",
	descriptionFull : "This stone is a large gem worth 150 gp.\n   " + toUni("Curse") + ". The stone is cursed, but its magical nature is hidden; Detect Magic doesn't detect it. An Identify spell reveals the stone's true nature. If you use the Dash or Disengage action while the stone is on your person, its curse activates. Until the curse is broken with Remove Curse or similar magic, your speed is reduced by 5 feet, and your maximum load and maximum lift capacities are halved. You also become unwilling to part with the stone.",
	weight : 1,
	cursed : true
}
MagicItemsList["mirror of the past"] = {
	name : "Mirror of the Past",
	source : [["TftYP", 228]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "As an action once per dawn, I can gaze into this mirror while thinking of a specific object or creature. The mirror then shows me scenes from the target's past for 1 minute or less, instead of my reflection. Information conveyed is accurate, but it is random and cryptic, and presented in no particular order.",
	descriptionFull : "The holder of this platinum hand mirror can learn something about the history of a specific object or creature by taking an action to gaze into the mirror and think of the target. Instead of the holder's reflection, the mirror presents scenes from the target's past. Information conveyed is accurate, but it is random and cryptic, and presented in no particular order. Once it is activated, the mirror gives its information for 1 minute or less, then returns to normal. It can't be used again until the next dawn.",
	weight : 1,
	usages : 1,
	recovery : "dawn",
	action : [["action", ""]]
}
MagicItemsList["night caller"] = {
	name : "Night Caller",
	source : [["TftYP", 228]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "I can use this whistle to cast Animate Dead, if I blow it under the night sky or in darkness. Once used, it can't function for 7 days. It can affect targets through 10 ft of soft earth or similar, but they take 1 min to claw to the surface. Once per 24 hours, I can blow it to reassert control over 1 or 2 targ I animated with it.",
	descriptionFull : "This whistle is carved from transparent crystal, and it resembles a tiny dragon curled up like a snail. The name Night Caller is etched on the whistle in Dwarvish runes. If a character succeeds on a DC 20 Intelligence (Arcana or History) check, the character recalls lore that says the duergar made several such whistles for various groups in an age past.\n   If you blow the whistle in darkness or under the night sky, it allows you to cast the Animate Dead spell. The target can be affected through up to 10 feet of soft earth or similar material, and if it is, it takes 1 minute to claw its way to the surface to serve you. Once the whistle has animated an undead creature, it can't do so again until 7 days have passed.\n   Once every 24 hours, you can blow the whistle to reassert control over one or two creatures you animated with it.",
	weight : 1,
	usages : 1,
	recovery : "7 days",
	spellFirstColTitle : "Us",
	spellcastingBonus : {
		name : "Once per 7 days",
		spells : ["animate dead"],
		selection : ["animate dead"],
		firstCol : "checkbox"
	},
	spellChanges : {
		"animate dead" : {
			description : "In darkness, turn (buried) corpse into Skeleton/Zombie; control for 24h; bns a command within 60 ft",
			changes : "Night Caller can only be used in darkness or under the night sky. It can only create a single Skeleton or Zombie, but can animate a corpse buried below up to 10 feet of soft earth or similar material."
		}
	}
}
MagicItemsList["potion of mind control"] = {
	name : "Potion of Mind Control",
	source : [["TftYP", 229]],
	type : "potion",
	magicItemTable : "E",
	description : "",
	descriptionFull : "When you drink a potion of mind control, you can cast a dominate spell (save DC 15) on a specific creature if you do so before the end of your next turn. If you don't, the potion is wasted.\n   A potion of mind control produces the effect of a Dominate Beast (beast), Dominate Person (humanoid), or Dominate Monster (monster) spell depending on its type. If the target's initial saving throw fails, the effect lasts for 1 hour, with no concentration required on your part. The charmed creature has disadvantage on new saving throws to break the effect during this time.",
	weight : 1,
	choices : ["Beast", "Humanoid", "Monster"],
	"beast" : {
		rarity : "rare",
		description : "Once as an action, I can drink this potion or administer it to another. The consumer of the potion can cast Dominate Beast before the end of my next turn. The spell save DC is 15 and it lasts for 1 hour, requiring no concentration. Once charmed, the target has disadvantage on new saves to break the effect."
	},
	"humanoid" : {
		rarity : "rare",
		description : "Once as an action, I can drink this potion or administer it to another. The consumer of the potion can cast Dominate Person before the end of my next turn. The spell save DC is 15 and it lasts for 1 hour, requiring no concentration. Once charmed, the target has disadvantage on new saves to break the effect."
	},
	"monster" : {
		rarity : "very rare",
		description : "Once as an action, I can drink this potion or administer it to another. The consumer of the potion can cast Dominate Monster before the end of my next turn. The spell save DC is 15 and it lasts for 1 hour, requiring no concentration. Once charmed, the target has disadvantage on new saves to break the effect."
	}
}
MagicItemsList["robe of summer"] = {
	name : "Robe of Summer",
	source : [["TftYP", 229]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This elegant garment is made from fine cloth in hues of red, orange, and gold. While I wear the robe, I have resistance to cold damage. In addition, I am comfortable as if the temperature were that of a balmy day, so I suffer no ill effects from the weather's temperature extremes.",
	descriptionFull : "This elegant garment is made from fine cloth in hues of red, orange, and gold. While you wear the robe, you have resistance to cold damage. In addition, you are comfortable as if the temperature were that of a balmy day, so you suffer no ill effects from the weather's temperature extremes.",
	attunement : true,
	weight : 1,
	dmgres : ["Cold"]
}
MagicItemsList["shatterspike"] = {
	name : "Shatterspike",
	source : [["TftYP", 229]],
	type : "weapon (longsword)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "I have a +1 bonus to attack and damage rolls made with this magic longsword. If it hits an object, the hit is automatically a critical hit, and it can deal bludgeoning or slashing damage to the object (my choice). Further, damage from nonmagical sources can't harm the weapon.",
	descriptionFull : "You have a +1 bonus to attack and damage rolls made with this magic weapon. If it hits an object, the hit is automatically a critical hit, and it can deal bludgeoning or slashing damage to the object (your choice). Further, damage from nonmagical sources can't harm the weapon.",
	attunement : true,
	weight : 3,
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /Shatterspike/i,
		name : "Shatterspike",
		source : [["TftYP", 229]],
		description : "Versatile (1d10); Against objects: always critical hit, can choose to deal bludgeoning damage",
		modifiers : [1, 1],
		selectNow : true
	}]
}
MagicItemsList["spear of backbiting"] = {
	name : "Spear of Backbiting",
	source : [["TftYP", 229]],
	type : "weapon (spear)",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This spear has +2 to hit and damage, +30 ft range, and deals +1d6 damage when thrown. After a throwing attack, it flies back to my hand immediately. While its curse lasts, I'm unwilling to part with it and have disadv. on attacks with other weapon. Also, on a roll of 1 to hit, I roll the attack again, but at myself with adv.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic weapon. When you throw it, its normal and long ranges both increase by 30 feet. and it deals one extra die of damage on a hit. After you throw it and it hits or misses, it flies back to your hand immediately.\n   " + toUni("Curse") + ". This weapon is cursed, and becoming attuned to it extends the curse to you. Until the curse is broken with Remove Curse or similar magic, you are unwilling to part with the weapon, keeping it within reach at all times. In addition, you have disadvantage on attack rolls made with weapons other than this one.\n   Whenever you roll a 1 on an attack roll using this weapon, the weapon bends or flies to hit you in the back. Make a new attack roll with advantage against your own AC. If the result is a hit, you take damage as if you had attacked yourself with the spear.",
	attunement : true,
	weight : 3,
	cursed : true,
	weaponOptions : [{
		baseWeapon : "spear",
		regExpSearch : /^(?=.*spear)(?=.*backbiting).*$/i,
		name : "Spear of Backbiting",
		source : [["TftYP", 229]],
		range : "Melee, 50/90 ft",
		description : "Thrown, versatile (1d8); +1d6 damage if thrown; Returning; On 1 to hit: attack myself with adv.",
		modifiers : [2, 2],
		selectNow : true
	}]
}
MagicItemsList["stone of ill luck"] = {
	name : "Stone of Ill Luck",
	source : [["TftYP", 229]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "Although this polished agate appears to be a stone of good luck to anyone who tries to identify it. While it is on my person, it gives me a +1 bonus and a -2 penalty (from the curse) to ability checks and saving throws (for a total of -1). Until the curse is broken, I am unwilling to part with the item.",
	descriptionFull : "This polished agate appears to be a stone of good luck to anyone who tries to Identify it, and it confers that item's property while on your person.\n   " + toUni("Curse") + ". This item is cursed. While it is on your person, you take a -2 penalty to ability checks and saving throws. Until the curse is discovered, the DM secretly applies this penalty, assuming you are adding the item's bonus. You are unwilling to part with the stone until the curse is broken with Remove Curse or similar magic.",
	attunement : true,
	weight : 1,
	cursed : true,
	addMod : [
		{ type : "save", field : "all", mod : -1, text : "I gain a +1 bonus and -2 penalty on all my saving throws." },
		{ type : "skill", field : "all", mod : -1, text : "I gain a +1 bonus and -2 penalty on all my ability checks." },
		{ type : "skill", field : "Init", mod : -1, text : "I gain a +1 bonus and -2 penalty on all my ability checks." }
	]
}
MagicItemsList["wand of entangle"] = {
	name : "Wand of Entangle",
	source : [["TftYP", 229]],
	type : "wand",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "This wand has 7 charges, regaining 1d6+1 expended charges daily at dawn. If I use its last charge, I roll a d20. On a 1, it is destroyed. As an action, I can expend 1 charge to cast Entangle (save DC 13) from it.",
	descriptionFull : "This wand has 7 charges. While holding it, you can use an action to expend 1 of its charges to cast the Entangle spell (save DC 13) from it.\n   The wand regains 1d6+1 expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand crumbles into ashes and is destroyed.",
	attunement : true,
	weight : 1,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	usages : 7,
	recovery : "dawn",
	additional : "regains 1d6+1",
	fixedDC : 13,
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["entangle"],
		selection : ["entangle"],
		firstCol : 1
	}
}
MagicItemsList["waythe"] = {
	name : "Waythe",
	source : [["TftYP", 229]],
	type : "weapon (greatsword)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This greatsword adds +1 to hit and damage. Against giants, it deal +2d6 damage and they must make a DC 15 Str save or be knocked prone. It has 7 charges, regaining 1d6+1 at dawn. As an action, I can expend 1 charge to speak its command word to detect enemies within 60 ft. Waythe is sentient, see Notes page.",
	descriptionLong : "This greatsword adds a +1 bonus to attack and damage rolls made with it. Against giants, it deal 2d6 extra slashing damage and when a giant is hit with it, they must make a DC 15 Strength saving throw or be knocked prone. It has 7 charges, regaining 1d6+1 at dawn. As an action, I can expend 1 charge to speak its command, letting me know the direction of the nearest creature hostile to me within 60 ft, regardless of it being ethereal, invisible, disguised, or hidden. This lasts for 1 minute. Waythe is sentient and has a mind of its own, see Notes page.",
	descriptionFull : "Waythe is a unique greatsword most recently in the possession of a high-ranking cloud giant ambassador.\n   You gain a +1 bonus to attack and damage rolls made with this magic weapon. When you hit a creature of the giant type with it, the giant takes an extra 2d6 slashing damage, and it must succeed on a DC 15 Strength saving throw or fall prone.\n   The sword also functions as a wand of enemy detection. It regains all of its expended charges at dawn and isn't at risk of crumbling if its last charge is used.\n   " + toUni("Sentience") + ". Waythe is a sentient weapon of neutral good alignment, with an Intelligence of 12, a Wisdom of 2, and a Charisma of 14. It has hearing and darkvision out to a range of 120 feet.\n   The weapon can speak and understand Giant and Common, and it can communicate telepathically with its wielder.\n   " + toUni("Personality") + ". This sword believes in freedom and allowing others to live as they see fit. It is protective of its friends, and wants to be friends with a like-minded wielder. (It takes only 1 minute for a good-aligned character to gain attunement with the sword.) Waythe is courageous to the point of foolhardiness, however, and vocally urges bold action. It is likely to come into conflict with an evil or a timid wielder.",
	attunement : true,
	weight : 6,
	weaponOptions : [{
		baseWeapon : "greatsword",
		regExpSearch : /waythe/i,
		name : "Waythe",
		source : [["TftYP", 229]],
		description : "Heavy, two-handed; +2d6 damage vs. giants; Giants DC 15 Str save or fall prone",
		modifiers : [1, 1],
		selectNow : true
	}],
	usages : 7,
	recovery : "dawn",
	additional : "regains 1d6+1",
	action : [["action", ""]],
	toNotesPage : [{
		name : "Features",
		note : desc([
			"It takes only 1 minute for a good-aligned character to gain attunement with this sword.",
			"I gain a +1 bonus to attack and damage rolls made with this magic greatsword. When I hit a creature of the giant type with it, it deals an extra 2d6 slashing damage, and the giant must succeed on a DC 15 Strength saving throw or fall prone.",
			"Waythe has 7 charges and regains 1d6+1 expended charges daily at dawn. As an action while holding it, I can expend 1 charge to speak its command word. For the next minute, I know the direction of the nearest creature hostile to me within 60 ft, but not its distance from me. Waythe can sense the presence of hostile creatures that are ethereal, invisible, disguised, or hidden, as well as those in plain sight. The effect ends if I stop holding Waythe.",
			"Waythe is a sentient weapon of neutral good alignment, with an Intelligence of 12, a Wisdom of 2, and a Charisma of 14. It has hearing and darkvision out to a range of 120 feet, can speak and understand Giant and Common, and can communicate telepathically with its wielder.",
			"Waythe believes in freedom and allowing others to live as they see fit. It is protective of its friends, and wants to be friends with a like-minded wielder. Waythe is courageous to the point of foolhardiness, however, and vocally urges bold action. It is likely to come into conflict with an evil or a timid wielder."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["white dragonhide cape"] = { // worn by king Snurre
	name : "White Dragonhide Cape",
	source : [["TftYP", 193]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "I have resistance to cold damage while wearing this cape",
	descriptionFull : "This magic cape grants the wearer resistance to cold damage.",
	dmgres : ["Cold"]
}
MagicItemsList["spellcasting bolts"] = {
	name : "Spellcasting Bolts",
	source : [["TftYP", 209]],
	type : "weapon (crossbow bolts)",
	rarity : "rare",
	magicItemTable : "B",
	description : "These magical crossbow bolts cast a spell on the target they are used on.",
	descriptionFull : "These magical crossbow bolts cast a spell on the target they are used on. The spell has a save DC of 15 and a duration of 1 minute.",
	choices : ["Bolt of Holding", "Bolt of Blinding", "Bolt of Vapors"],
	"bolt of holding" : {
		name : "Bolt of Holding",
		description : "This magic crossbow bolt casts Hold Person on the target hit with it, as well as up to two others within 30 ft of that target. The targets must succeed on a DC 15 Wisdom save or be paralyzed for 1 minute. At the end of each of their turns, they can make another Wisdom save to end the effect on themselves.",
		descriptionFull : "This magic bolt casts hold person on the target hit with it, as well as up to two other targets within 30 feet of that target. The spell has a spell save DC of 15 and a duration of 1 minute."
	},
	"bolt of blinding" : {
		name : "Bolt of Blinding",
		description : "This magic bolt casts Blindness/Deafness on the target hit with it, as well as up to two others within 30 ft of that target. The targets must make a DC 15 Con save or be blinded or deafened (my choice) for 1 minute. At the end of each of their turns, a target can make another Con save to end the effect on itself.",
		descriptionFull : "This magic bolt casts blindness/deafness to blind on a target hit with the bolt, as well as up to two other targets within 30 feet of that target. The spell has a spell save DC of 15 and a duration of 1 minute."
	},
	"bolt of vapors" : {
		name : "Bolt of Vapors",
		description : "This magic crossbow bolt casts Stinking Cloud centered on the point it hits, creating a 20-ft radius sphere of yellow, nauseating gas there for 1 minute. It heavily obscures and creatures fully in the cloud or starting their turn in it must make a DC 15 Con save against poison or spend their action that turn retching.",
		descriptionFull : "This magic bolt casts stinking cloud centered on the point it hits. The spell has a spell save DC of 15 and a duration of 1 minute."
	}
}
MagicItemsList["berserker battleaxe (tamoachan)"] = {
	name : "Berserker Battleaxe (Tamoachan)", // can't just be "Berserker Battleaxe" or the magic item "Berserker Axe" wouldn't work anymore
	source : [["TftYP", 68]], // Tloques' battleaxe
	type : "weapon (battleaxe)",
	rarity : "very rare",
	magicItemTable : "H",
	description : "This axe gives +2 to hit and damage, +1 HP per level, and has 12 charges to cast spells, regaining 1d6+4 at dawn. I can't part with it, have disadv. with other weapons, and if I'm damaged by a hostile, I must make a DC 15 Wis save or go berserk: attack the closest creature with the axe until none remain within 60 ft.",
	descriptionLong : "This axe adds a +2 bonus to attack and damage rolls made with it. While attuned to it, my HP maximum increases by 1 for each level I have. It has scrolls of Passwall, Burning Hands, and Gust of Wind beneath the wrappings of its handle. As long as these remain there, it has 12 charges to cast these spells, regaining 1d6+4 at dawn. It is cursed, making it so that I can't part with it and have disadvantage on attack rolls made with other weapons. If I'm damaged by a hostile, I must make a DC 15 Wis save or go berserk, using my action each turn to attack the closest creature with the axe until none remain within 60 ft.",
	descriptionFull : "This battleaxe has a blade of bronze, and the haft is wound with snakeskin wrappings. You gain a +2 bonus to attack and damage rolls made with this magic weapon. In addition, while you are attuned to this weapon, your hit point maximum increases by 1 for each level you have attained.\n   Concealed beneath the wrappings around the handle is a parchment containing the spells passwall, burning hands, and gust of wind. When the attuned wielder uses an action to say the correct words of power, which are engraved in Olman on the axe blade, one of these spells can be cast.\n   The axe has 12 charges and regains 1d6+4 expended charges daily at dawn. Casting a spell from it takes a number of charges equal to the level at which the spell is cast (5th for passwall, 2nd for gust of wind, and 1st or higher for burning hands; spell save DC 15). If the parchment is removed from the axe, the axe loses the capability of casting these spells forever.\n   " + toUni("Curse") + ". This axe is cursed, and becoming attuned to it extends the curse to you. As long as you remain cursed, you are unwilling to part with the axe, keeping it within reach at all times. You also have disadvantage on attack rolls with weapons other than this one, unless no foe is within 60 feet of you that you can see or hear.\n   Whenever a hostile creature damages you while the axe is in your possession, you must succeed on a DC 15 Wisdom saving throw or go berserk. While berserk, you must use your action each round to attack the creature nearest to you with the axe. If you can make extra attacks as part of the Attack action, you use those extra attacks, moving to attack the next nearest creature after you fell your current target. If you have multiple possible targets, you attack one at random. You are berserk until you start your turn with no creatures within 60 feet of you that you can see or hear.",
	attunement : true,
	weight : 4,
	usages : 12,
	recovery : "dawn",
	additional : "regains 1d6+4",
	limfeaname : "Berserker Battleaxe",
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1+ charges",
		spells : ["burning hands"],
		selection : ["burning hands"],
		firstCol : "1+"
	}, {
		name : "2 charges",
		spells : ["gust of wind"],
		selection : ["gust of wind"],
		firstCol : 2
	}, {
		name : "5 charges",
		spells : ["passwall"],
		selection : ["passwall"],
		firstCol : 5
	}],
	spellChanges : {
		"burning hands" : {
			description : "All in area 3d6+1d6/extra charge Fire dmg; save halves; unattended flammable objects ignite",
			changes : "The spell level this is cast at depends on the amount of charges spend, 1 charge per spell slot level."
		}
	},
	calcChanges : {
		hp : function (totalHD) { return [totalHD]; }
	},
	weaponOptions : [{
		baseWeapon : "battleaxe",
		regExpSearch : /^(?=.*berserker)(?=.*battleaxe).*$/i,
		name : "Berserker Battleaxe",
		source : [["TftYP", 68]],
		description : "Versatile (1d10); Cursed",
		modifiers : [2, 2],
		selectNow : true
	}]
}
MagicItemsList["plantslayer longsword"] = {
	name : "Plantslayer Longsword",
	source : [["TftYP", 70]], // from Stone Statue
	type : "weapon (longsword)",
	rarity : "rare",
	magicItemTable : "F",
	description : "This sword is made of laminated wood, inset with jagged teeth of obsidian. I gain a +1 bonus to attack and damage rolls made with this magic weapon. In addition, it deals an extra 2d6 damage to any creature of the plant type.",
	descriptionFull : "This sword is made of laminated wood, inset with jagged teeth of obsidian. You gain a +1 bonus to attack and damage rolls made with this magic weapon. In addition, it deals an extra 2d6 damage to any creature of the plant type.",
	weight : 3,
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /^(?=.*plantslayer)(?=.*longsword).*$/i,
		name : "Plantslayer Longsword",
		source : [["TftYP", 70]],
		description : "Versatile (1d10); +2d6 damage vs. plants",
		modifiers : [1, 1],
		selectNow : true
	}]
}

// pub_20170915_Tortle.js
// This file adds the Tortle Race from the Tortle Package from Extra Life to MPMB's Character Record Sheet

// Define the source
SourceList.TP={
	name : "Tortle Package",
	abbreviation : "TP",
	group : "Extra Life",
	url : "https://www.dmsguild.com/product/221716/Tortle-Package-5e",
	date : "2017/09/15",
	defaultExcluded : true
};

// The Tortle race
RaceList.tortle = {
	regExpSearch : /tortle/i,
	name : "Tortle",
	source : [["TP", 4], ["W", 181]],
	plural : "Tortles",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Aquan"],
	skills : ["Survival"],
	armorOptions : [{
		regExpSearch : /^(?=.*tortle)(?=.*shell).*$/i,
		name : "Tortle's Shell",
		source : [["TP", 4], ["W", 181]],
		ac : 17,
		dex : -10,
		selectNow : true
	}],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*tortle)(?=.*\bclaws?\b).*$/i,
		name : "Tortle's Claws",
		source : [["TP", 4], ["W", 181]],
		damage : [1, 4, "slashing"],
		selectNow : true
	}],
	age : " reach adulthood by the age of 15 and live an average of 50 years",
	height : " stand between 5 and 6 feet tall (4'10\" + 2d8\")",
	weight : " weigh around 450 lb (400 + 2d8 \xD7 2d4 lb)",
	heightMetric : " stand between 1,5 and 1,8 metres tall (150 + 5d8 cm)",
	weightMetric : " weigh around 190 kg (180 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [2, 0, 0, 0, 1, 0],
	action : [["action", "Shell Defense (start)"], ["bonus action", "Shell Defense (end)"]],
	trait : "Tortle (+2 Strength, +1 Wisdom)"+
	"\n \u2022 Claws: My unarmed strikes with my claws deal 1d4 slashing damage."+
	"\n \u2022 Hold Breath: I can hold my breath for up to 1 hour at a time."+
	"\n \u2022 Natural Armor: I have a base AC of 17, but I can't add my Dex to it or wear armor."+
	"\n \u2022 Shell Defense: As an action, I can withdraw into my shell and gain +4 AC and adv. on Str and Con saves, but I count as prone, have speed 0, have disadv. on Dex saves, and can't take reactions. The only action I can take is a bonus action to emerge from the shell."
};

// pub_20170919_ToA.js
// This file adds the backgrounds and beasts from the Tomb of Annihilation adventure book to MPMB's Character Record Sheet

// Define the source
SourceList.ToA={
	name : "Tomb of Annihilation [backgrounds, beasts, items]",
	abbreviation : "ToA",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/tomb-annihilation",
	date : "2017/09/19"
};

// Add Human to Yuan-ti tranformation from the ritual (excluded by default)
AddRacialVariant("human", "yuan-ti transformed", {
	defaultExcluded : true,
	regExpSearch : /^(?!.*variant)(?=.*yuan.ti)(?=.*transformed)?.*$/i,
	source : [["ToA", 119]],
	vision : [["Darkvision", 60]],
	savetxt : {
		immune : ["poison"],
		adv_vs : ["magic"]
	},
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Innate Spellcasting (level 1)",
		spells : ["poison spray", "animal friendship"],
		selection : ["poison spray", "animal friendship"],
		firstCol : 'atwill',
		times : 2
	},
	spellChanges : {
		"animal friendship" : {
			description : "1 snake (beast) with less than 4 Int save or charmed for the duration",
			changes : "Using Innate Spellcasting, I can cast Animal Friendship at will, but only to target snakes."
		}
	},
	features : {
		"suggestion" : {
			name : "Innate Spellcasting (level 3)",
			limfeaname : "Suggestion",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Innate Spellcasting (level 3)",
				spells : ["suggestion"],
				selection : ["suggestion"],
				firstCol : 'oncelr'
			}
		}
	},
	trait : "Yuan-ti Human (+1 to all ability scores)\n   Madness: I suffer from an indefinite madness (DMG 258).\n   Innate Spellcasting: I know the Poison Spray cantrip and can cast Animal Friendship on snakes at will. Once I reach 3rd level, I can cast Suggestion once per long rest. Charisma is my spellcasting ability for these spells.\n   Magic Resistance: I have advantage on saves against spells and other magical effects."
});
AddRacialVariant("human", "yuan-ti transformed variant", {
	defaultExcluded : true,
	regExpSearch : /^(?=.*variant)(?=.*yuan.ti)(?=.*transformed)?.*$/i,
	source : [["ToA", 119]],
	skillstxt : "Choose any one skill",
	scorestxt : "+1 to two different ability scores of my choice",
	scores : [0, 0, 0, 0, 0, 0],
	vision : [["Darkvision", 60]],
	savetxt : {
		immune : ["poison"],
		adv_vs : ["magic"]
	},
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Innate Spellcasting (level 1)",
		spells : ["poison spray", "animal friendship"],
		selection : ["poison spray", "animal friendship"],
		firstCol : 'atwill',
		times : 2
	},
	spellChanges : {
		"animal friendship" : {
			description : "1 snake (beast) with less than 4 Int save or charmed for the duration",
			changes : "Using Innate Spellcasting, I can cast Animal Friendship at will, but only to target snakes."
		}
	},
	features : {
		"suggestion" : {
			name : "Innate Spellcasting (level 3)",
			limfeaname : "Suggestion",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Innate Spellcasting (level 3)",
				spells : ["suggestion"],
				selection : ["suggestion"],
				firstCol : 'oncelr'
			}
		}
	},
	trait : "Yuan-ti Human (+1 to two different ability scores of my choice)\n   Skill & Feat: I gain proficiency in one skill of my choice and I gain one feat of my choice.\n   Madness: I suffer from an indefinite madness (DMG 258).\n   Innate Spellcasting: I know the Poison Spray cantrip and can cast Animal Friendship on snakes at will. Once I reach 3rd level, I can cast Suggestion once per long rest. Charisma is my spellcasting ability for these spells.\n   Magic Resistance: I have advantage on saves against spells and other magical effects.",
	eval : function() { AddString('Feat Note 1', 'Human bonus feat', '; '); },
	removeeval : function() { RemoveString('Feat Note 1', 'Human bonus feat'); }
});

// Backgrounds (with contributions by SoilentBrad and @lowbrr)
BackgroundList["anthropologist"] = {
	regExpSearch : /anthropologist/i,
	name : "Anthropologist",
	source : [["ToA", 191], ["ALbackground", 0]],
	skills : ["Insight", "Religion"],
	gold : 10,
	equipleft : [
		["Leather-bound diary", "", 5],
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Trinket of special significance", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Adept Linguist",
	trait : [
		"I prefer the company of those who aren't like me, including people of other races.",
		"I'm a stickler when it comes to observing proper etiquette and local customs.",
		"I would rather observe than meddle.",
		"By living among violent people, I have become desensitized to violence.",
		"I would risk life and limb to discover a new culture or unravel the secrets of a dead one.",
		"When I arrive at a new settlement for the first time, I must learn all its customs."
	],
	ideal : [
		["Discovery",
			"Discovery: I want to be the first person to discover a lost culture. (Any)"
		],
		["Distance",
			"Distance: One must not interfere with the affairs of another culture \u2015 even one in need of aid. (Lawful)"
		],
		["Knowledge",
			"Knowledge: By understanding other races and cultures, we learn to understand ourselves. (Any)"
		],
		["Power",
			"Power: Common people crave strong leadership, and I do my utmost to provide it. (Lawful)"
		],
		["Protection",
			"Protection: I must do everything possible to save a society facing extinction. (Good)"
		],
		["Indifferent",
			"Indifferent: Life is cruel. What's the point in saving people if they're going to die anyway? (Chaotic)"
		],
	],
	bond : [
		"My mentor gave me a journal filled with lore and wisdom. Losing it would devastate me.",
		"Having lived among the people of a primeval tribe or clan, I long to return and see how they are faring.",
		"Years ago, tragedy struck the members of an isolated society I befriended, and I will honor them.",
		"I want to learn more about a particular humanoid culture that fascinates me.",
		"I seek to avenge a clan, tribe, kingdom, or empire that was wiped out.",
		"I have a trinket that I believe is the key to finding a long-lost society."
	],
	flaw : [
		"Boats make me seasick.",
		"I talk to myself, and I don't make friends easily.",
		"I believe that I'm intellectually superior to people from other cultures and have much to teach them.",
		"I've picked up some unpleasant habits living among goblins, lizardfolk, or orcs.",
		"I complain about everything.",
		"I wear a tribal mask and never take it off."
	],
	extra : [
		"Select an Adopted Culture",
		"Aarakocra",
		"Dwarf",
		"Elf",
		"Goblin",
		"Halfling",
		"Human",
		"Lizardfolk",
		"Orc",
	],
	languageProfs : [2]
};
BackgroundList["archaeologist"] = {
	regExpSearch : /archa?eologist/i,
	name : "Archaeologist",
	source : [["ToA", 192], ["ALbackground", 0]],
	skills : ["History", "Survival"],
	gold : 25,
	equipleft : [
		["Map case with a map of a ruin/dungeon", "", 1],
		["Bullseye lantern", "", 2],
		["Miner's pick", "", 10],
		["Shovel", "", 5],
		["Two-person tent", "", 20]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Trinket recovered from a dig site", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Historical Knowledge",
	trait : [
		"I love a good puzzle or mystery.",
		"I'm a pack rat who never throws anything away.",
		"Fame is more important to me than money.",
		"I have no qualms about stealing from the dead.",
		"I'm happier in a dusty old tomb than I am in the centers of civilization.",
		"Traps don't make me nervous. Idiots who trigger traps make me nervous.",
		"I might fail, but I will never give up.",
		"You might think I'm a scholar, but I love a good brawl. These fists were made for punching."
	],
	ideal : [
		["Preservation",
			"Preservation: That artifact belongs in a museum. (Good)"
		],
		["Greed",
			"Greed: I won't risk my life for nothing. I expect some kind of payment. (Any)"
		],
		["Death Wish",
			"Death Wish: Nothing is more exhilarating than a narrow escape from the jaws of death. (Chaotic)"
		],
		["Dignity",
			"Dignity: The dead and their belongings deserve to be treated with respect. (Lawful)"
		],
		["Immortality",
			"Immortality: All my exploring is part of a plan to find the secret of everlasting life. (Any)"
		],
		["Danger",
			"Danger: With every great discovery comes grave danger. The two walk hand in hand. (Any)"
		]
	],
	bond : [
		"Ever since I was a child, I've heard stories about a lost city. I aim to find it, learn its secrets, and earn my place in the history books.",
		"I want to find my mentor, who disappeared on an expedition some time ago.",
		"I have a friendly rival. Only one of us can be the best, and I aim to prove it's me.",
		"I won't sell an art object or other treasure that has historical significance or is one of a kind.",
		"I'm secretly in love with the wealthy patron who sponsors my archaeological exploits.",
		"I hope to bring prestige to a library, a museum, or a university."
	],
	flaw : [
		"I have a secret fear of some common wild animal \u2015 and in my work, I see them everywhere.",
		"I can't leave a room without searching it for secret doors.",
		"When I'm not exploring dungeons or ruins, I get jittery and impatient.",
		"I have no time for friends or family. I spend every waking moment thinking about and preparing for my next expedition.",
		"When given the choice of going left or right, I always go left.",
		"I can't sleep except in total darkness."
	],
	extra : [
		"Select a Signature Item",
		"10-foot pole",
		"Crowbar",
		"Hat",
		"Hooded lantern",
		"Medallion",
		"Shovel",
		"Sledgehammer",
		"Whip"
	],
	toolProfs : [["Cartographer or navigator tools", 1]],
	languageProfs : [1]
};

// Background features (with contributions by SoilentBrad and @lowbrr)
BackgroundFeatureList["adept linguist"] = {
	description : "I can communicate with humanoids who don't speak any language I know. I must observe the humanoids interacting with one another for at least one day, after which I learn a handful of important words, expressions, and gestures \u2015 enough to communicate on a rudimentary level.",
	source : [["ToA", 191], ["ALbackground", 0]]
};
BackgroundFeatureList["historical knowledge"] = {
	description : "When I enter a ruin or dungeon, I can correctly ascertain its original purpose and determine its builders, whether those were dwarves, elves, humans, yuan-ti, or some other known race. In addition, I can determine the monetary value of art objects more than a century old.",
	source : [["ToA", 192], ["ALbackground", 0]]
};

// Weapon
WeaponsList["yklwa"] = {
	regExpSearch : /yklwa/i,
	name : "Yklwa",
	source : [["ToA", 32]],
	list : "melee",
	ability : 1,
	type : "Simple",
	damage : [1, 8, "piercing"],
	range : "Melee, 10/30 ft",
	weight : 3,
	description : "Thrown",
	monkweapon : true,
	abilitytodamage : true
};

// Gear
GearList["rain catcher"] = {
	infoname : "Rain catcher [1 gp]",
	name : "Rain catcher",
	source : [["ToA", 32]],
	amount : 1,
	weight : 5
};
GearList["insect repellent salve"] = {
	infoname : "Salve (vial) [5 sp]",
	name : "Insect Repellent Salve, applications of",
	source : [["ToA", 32]],
	amount : 20,
	weight : "",
	type : "insect repellent"
};
GearList["insect repellent incense"] = {
	infoname : "Incense (block) [1 gp]",
	name : "Insect Repellent Incense, blocks of",
	source : [["ToA", 32]],
	amount : 1,
	weight : "",
	type : "insect repellent"
};

// Creatures
// The following creatures were transcribed with the help of SoilentBrand and @lowbrr
CreatureList["almiraj"] = {
	name : "Almiraj",
	source : [["ToA", 211]],
	size : 4, //Small
	type : "Beast",
	companion : "familiar_not_al",
	alignment : "Unaligned",
	ac : 13,
	hp : 3,
	hd : [1, 6],
	speed : "50 ft",
	scores : [2, 16, 10, 2, 14, 10],
	skills : {
		"perception" : 4,
		"stealth" : 5,
	},
	senses : "Darkvision 30 ft; Adv. on Wis (Perception) checks using hearing/sight",
	passivePerception : 14,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Horn",
		ability : 2,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Keen Senses",
		description : "The almiraj has advantage on Wisdom (Perception) checks that rely on hearing or sight."
	}]
};
CreatureList["flying monkey"] = {
	name : "Flying Monkey",
	nameAlt : ["Monkey, Flying"],
	source : [["ToA", 220]],
	size : 4, //Small
	type : "Beast",
	companion : "familiar_not_al",
	alignment : "Unaligned",
	ac : 12,
	hp : 3,
	hd : [1, 6],
	speed : "30 ft, climb 20 ft, fly 30 ft",
	scores : [8, 14, 11, 5, 12, 6],
	senses : "",
	passivePerception : 11,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Pack Tactics",
		description : "The flying monkey has advantage on an attack roll against a creature if at least one of the monkey's allies is within 5 ft of the creature and the ally isn't incapacitated."
	}]
};
CreatureList["giant snapping turtle"] = {
	name : "Giant Snapping Turtle",
	nameAlt : ["Turtle, Giant Snapping"],
	source : [["ToA", 222]],
	size : 2, //Large
	type : "Beast",
	alignment : "Unaligned",
	ac : 17,
	hp : 75,
	hd : [10, 10],
	speed : "30 ft, swim 40 ft",
	scores : [19, 10, 14, 2, 12, 5],
	senses : "Darkvision 60 ft",
	passivePerception : 11,
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [4, 6, "slashing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Amphibious",
		description : "The turtle can breathe air and water."
	}, {
		name : "Stable",
		description : "Whenever an effect knocks the turtle prone, it can make a DC 10 Constitution saving throw to avoid being knocked prone. A prone turtle is upside down. To stand up, it must succeed on a DC 10 Dexterity check on its turn and then use all its movement for that turn. While prone, the turtle's AC becomes 12."
	}]
};
CreatureList["jaculi"] = {
	name : "Jaculi",
	source : [["ToA", 225]],
	size : 2, //Large
	type : "Beast",
	alignment : "Unaligned",
	ac : 14,
	hp : 16,
	hd : [3, 10],
	speed : "30 ft, climb 20 ft",
	scores : [15, 14, 11, 2, 8, 3],
	skills : {
		"athletics" : 4,
		"perception" : 1,
		"stealth" : 4
	},
	senses : "Blindsight 30 ft; Adv. on Wis (Perception) checks using smell",
	passivePerception : 11,
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [2, 6, "piercing"],
		range : "Melee (5 ft)",
		description : "If used after at least 10 ft jump, adv. on to hit and extra 2d6 damage, see Spring trait"
	}],
	actions : [{
		name : "Spring",
		description : "The jaculi springs up to 30 feet in a straight line and makes a bite attack against a target within its reach. This attack has advantage if the jaculi springs at least 10 feet. If the attack hits, the bite deals an extra 7 (2d6) piercing damage."
	}],
	traits : [{
		name : "Camouflage",
		description : "The jaculi has advantage on Dexterity (Stealth) checks made to hide."
	}, {
		name : "Keen Smell",
		description : "The jaculi has advantage on Wisdom (Perception) checks that rely on smell."
	}],
	wildshapeString : "\u25C6 Senses: Blindsight 30 ft.\n\u25C6 Camouflage: advantage on Dexterity (Stealth) checks made to hide.\n\u25C6 Keen Smell: advantage on Wisdom (Perception) checks that rely on smell.\n\u25C6 Spring: 30 ft in a straight line and make a bite attack. Advantage on the attack roll if springing at least 10 ft. It deals an extra 7 (2d6) piercing damage on a hit."
};

// Magic Items
MagicItemsList["bob"] = { // contributed by Nod_Hero
	name : "Bob",
	source : [["ToA", 89]],
	type : "weapon (battleaxe)",
	rarity : "uncommon",
	description : "Dwarvish runes on the head of this rusty battleaxe read 'Bob'. It adds a +1 bonus to attack and damage rolls made with it, floats on water and other liquids, and grants me advantage on Strength (Athletics) checks made to swim.",
	descriptionFull : "Etched into the haft of the battleaxe are Dethek (Dwarvish) runes that spell the weapon's name: Bob. It floats on water and other liquids, adds a +1 bonus to attack and damage rolls made with it, and grants its bearer advantage on Strength (Athletics) checks made to swim.",
	weight : 4,
	weaponOptions : [{
		baseWeapon : "battleaxe",
		regExpSearch : /\bbob\b/i,
		name : '"Bob"',
		source : [["ToA", 89]],
		description : "Versatile (1d10); Floats",
		modifiers : [1, 1],
		selectNow : true
	}]
};
MagicItemsList["longsword of speaking draconic"] = { // contributed by Nod_Hero
	name : "Longsword of Speaking Draconic",
	source : [["ToA", 173]],
	type : "weapon (longsword)",
	rarity : "common",
	description : "This longsword has a dragon-shaped hilt. While I carry it, I gain the ability to speak and understand the Draconic language.",
	descriptionFull : "This longsword has a dragon-shaped hilt. While you carry it, you gain the ability to speak and understand the Draconic language.",
	weight : 3,
	languageProfs : ["Draconic"],
	weaponsAdd : {
		select : ["Longsword of Speaking Draconic"],
		options : ["Longsword of Speaking Draconic"]
	}
};
MagicItemsList["amulet of the black skull"] = {
	name : "Amulet of the Black Skull",
	source : [["ToA", 206]],
	type : "wondrous item",
	rarity : "very rare",
	magicItemTable : "G",
	description : "The obsidian amulet has 6 charges, regaining 1d6 at dawn. As an action, I can expend a charge to teleport to a location within 100 ft that I'm familiar with. If I'm not undead, I must make a DC 16 Con save whenever I do so and if I fail, I'm transformed (see table on Notes page) as I arrive at the destination.",
	descriptionFull : "This amulet is carved from obsidian and shaped like a screaming humanoid skull, with ruby eyes and emeralds for teeth. It hangs from an iron chain necklace.\n   The amulet has 6 charges and regains 1d6 charges daily at dawn. While wearing the amulet, you can use an action to expend 1 of its charges to transport yourself and anything you are wearing or carrying to a location within 100 feet of you. The destination you choose doesn't need to be in your line of sight, but it must be familiar to you (in other words, a place you have seen or visited), and it must be on the same plane of existence as you. This effect isn't subject to the magic restrictions placed on the Tomb of the Nine Gods; thus, the amulet can be used to enter and exit the tomb.\n   If you aren't undead, you must make a DC 16 Constitution saving throw each time you use the amulet to teleport. On a failed saving throw, the black skull cackles as you are transformed in transit. The transformation takes effect as soon as you arrive at the destination, and is determined randomly by rolling percentile dice and consulting the Black Skull Transformation table.\n\n" + toUni("d100\tTransformation") + "\n01-20\tThe symbol of Acererak is burned into your flesh, a curse that can only be removed with a Remove Curse spell or similar magic. Until the curse ends, your hit points can't be restored by magic.\n21-35\tYou grow larger as if affected by an Enlarge/Reduce spell, except the effect lasts for 1 hour.\n36-50\tYou grow smaller as if affected by an Enlarge/Reduce spell, except the effect lasts for 1 hour.\n51-70\tYou arrive at the destination wearing nothing but the amulet of the black skull. Everything else that you were wearing or carrying appears in a random unoccupied space within 100 feet of you.\n71-95\tYou are paralyzed for 1 minute or until this effect is ended with a Lesser Restoration spell or similar magic.\n96-00\tYou become petrified. This effect can be ended only with a Greater Restoration spell or similar magic.",
	attunement : true,
	weight : 1,
	action : [["action", ""]],
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6",
	toNotesPage : [{
		name : "Transformation Table",
		note : [
			"This amulet is carved from obsidian and shaped like a screaming humanoid skull, with ruby eyes and emeralds for teeth. It hangs from an iron chain necklace.",
			"If I'm not undead, I must make a DC 16 Constitution save each time I use the amulet to teleport. On a failure, the black skull cackles as I'm transformed in transit. The transformation is random (see table below) and takes effect as soon as I arrive at the destination.",
			"d100\tTRANSFORMATION",
			"01-20\tThe symbol of Acererak is burned into my flesh, a curse that can only be removed with a Remove Curse spell or similar magic. Until the curse ends, my hit points can't be restored by magic.",
			"21-35\tI grow larger as if affected by an Enlarge/Reduce spell, except the effect lasts for 1 hour.",
			"36-50\tI grow smaller as if affected by an Enlarge/Reduce spell, except the effect lasts for 1 hour.",
			"51-70\tI arrive at the destination wearing nothing but the amulet of the black skull. Everything else that I was wearing or carrying appears in a random unoccupied space within 100 ft.",
			"71-95\tI am paralyzed for 1 minute or until this effect is ended with a Lesser Restoration spell or similar magic.",
			"96-00\tI become petrified. This effect can be ended only with a Greater Restoration spell or similar magic."
		]
	}]
}
MagicItemsList["bookmark"] = {
	name : "Bookmark",
	source : [["ToA", 206]],
	type : "weapon (dagger)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This dagger adds +3 to hit and damage. As a bonus action while holding it, I can have it shed bright light in a 20-ft radius and dim light for another 20 ft, go dark, act as a compass, cast Dimension Door once per dawn, or cast Compulsion once per dawn, which effects only spiders of the beast type within 90 ft.",
	descriptionFull : "This +3 dagger belongs to Artus Cimber. While you have the dagger drawn, you can use a bonus action to activate one of the following properties:\n \u2022 Cause a blue gem set into the dagger's pommel to shed bright light in a 20-foot radius and dim light for an additional 20 feet, or make the gem go dark.\n \u2022 Turn the dagger into a compass that, while resting on your palm, points north.\n \u2022 Cast Dimension Door from the dagger. Once this property is used, it can't be used again until the next dawn.\n \u2022 Cast Compulsion (save DC 15) from the dagger. The range of the spell increases to 90 feet but it targets only spiders that are beasts. Once this property is used, it can't be used again until the next dawn.",
	attunement : true,
	weight : 1,
	action : [["bonus action", ""]],
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /bookmark/i,
		name : "Bookmark",
		source : [["ToA", 206]],
		modifiers : [3, 3],
		selectNow : true
	}],
	extraLimitedFeatures : [{
		name : "Compulsion (Bookmark)",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Dimension Door (Bookmark)",
		usages : 1,
		recovery : "dawn"
	}],
	fixedDC : 15,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["compulsion", "dimension door"],
		selection : ["compulsion", "dimension door"],
		firstCol : "oncelr",
		times : 2
	},
	spellChanges : {
		"compulsion" : {
			time : "1 bns",
			range : "90 ft",
			description : "Any spiders that hear me save or I can, as bns, have it move fully in a direction; save again after move",
			changes : "Using Bookmark, I can cast this as a bonus action with a range of 90 ft, but it can only target spiders with the beast type."
		}
	}
}
MagicItemsList["ghost lantern"] = {
	name : "Ghost Lantern",
	source : [["ToA", 206]],
	type : "wondrous item",
	rarity : "legendary",
	magicItemTable : "C",
	description : "As a bonus action, I can command the spirit in the lantern to shed bright light in 30-ft radius and dim light for another 30 ft. I can order the spirit to act as my Mage Hand. If I fall unconscious within 10 ft of the lantern, the spirit stabilizes me. Casting Dispel Evil and Good on it releases the spirit and makes it nonmagical.",
	descriptionFull : "A restless spirit is trapped inside this lantern. While holding the lantern, you can command the spirit as a bonus action to shed bright light in a 30-foot radius and dim light for an additional 30 feet.\n   While holding the lantern, you can use an action to order the spirit to leave the lantern and duplicate the effect of the Mage Hand spell. The spirit returns to the lantern when the spell ends.\n   If you fall unconscious within 10 feet of the lantern, the spirit emerges from it, magically stabilizes you with a touch, and then quickly returns to the lantern.\n   The spirit is bound to the lantern and can't be harmed, turned, or raised from the dead.\n   Casting a Dispel Evil and Good spell on the lantern releases the spirit to the afterlife and renders the lantern nonmagical.",
	attunement : true,
	weight : 1,
	action : [["bonus action", ""]],
	spellcastingBonus : {
		name : "At will",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : "atwill"
	}
}
MagicItemsList["mask of the beast"] = {
	name : "Mask of the Beast",
	source : [["ToA", 207]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "This wooden mask is shaped in the likeness of a beast's visage and has 3 charges. While wearing the mask I can expend 1 charge and use the mask to cast the Animal Friendship spell as an action. The mask regains all expended charges at dawn.",
	descriptionFull : "This wooden mask is shaped in the likeness of a beast's visage and has 3 charges. While wearing the mask you can expend 1 charge and use the mask to cast the Animal Friendship spell as an action. The mask regains all expended charges at dawn.",
	weight : 1,
	usages : 3,
	recovery : "dawn",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["animal friendship"],
		selection : ["animal friendship"],
		firstCol : 1
	}
}
MagicItemsList["scorpion armor"] = {
	name : "Scorpion Armor",
	source : [["ToA", 208]],
	type : "armor (plate)",
	rarity : "rare",
	magicItemTable : "I",
	description : "This suit of plate armor fashioned from giant scorpion chitin doesn't impose disadv. on stealth or saves against extreme heat. It gives me +5 bonus on initiative while I'm not incapacitated. Whenever I don or doff it, I take 10d10+45 poison damage, DC 15 Con save halves. Only a Wish can remove this curse.",
	descriptionFull : "This suit of plate armor is fashioned from giant scorpion chitin. While wearing this armor, you gain the following benefits:\n \u2022 The armor improves your combat readiness, granting you a +5 bonus to initiative as long as you aren't incapacitated.\n \u2022 The armor doesn't impose disadvantage on your Dexterity (Stealth) checks.\n \u2022 The armor doesn't impose disadvantage on saving throws made to resist the effects of extreme heat (see chapter 5 of the Dungeon Master's Guide).\n\n" + toUni("Curse") + ". This armor is cursed. Whenever you don or doff it, you must make a DC 15 Constitution saving throw, taking 100 (10d10+45) poison damage on a failed save, or half as much damage on a successful one. Only a Wish spell can remove the armor's curse.",
	attunement : true,
	weight : 65,
	cursed : true,
	addMod : [{ type : "skill", field : "Init", mod : 5, text : "I gain a +5 bonus on my initiative rolls." }],
	armorOptions : [{
		regExpSearch : /^(?=.*scorpion)(?=.*armor).*$/i,
		name : "Scorpion Armor",
		source : [["ToA", 208]],
		type : "heavy",
		ac : 18,
		stealthdis : false,
		weight : 65,
		strReq : 15,
		selectNow : true
	}]
}

// pub_20171011_One-Grung-Above.js
// This file adds the Grung Race from the One Grung Above from Extra Life to MPMB's Character Record Sheet
// This file contains contributions by /u/GoldenSnurp
// Be aware that this race is not legal in adventurers league!

SourceList["OGA"] = {
	name : "One Grung Above",
	abbreviation : "OGA",
	group : "Extra Life",
	url : "https://www.dmsguild.com/product/223738/One-Grung-Above-5e",
	date : "2017/10/11",
	defaultExcluded : true
};

RaceList["grung"] = {
	regExpSearch : /grung/i,
	name : "Grung",
	source : [["OGA", 4]],
	plural : "Grung",
	size : 4,
	speed : {
		walk : { spd: 25, enc: 15 },
		climb : { spd: 25, enc: 15 }
	},
	languageProfs : ["Grung"],
	savetxt : { immune: ["poison"] },
	skills : ["Perception"],
	age : " reach adulthood at the age of one and live around 50 years",
	height : " range from 2 1/2 to 3 1/2 feet tall",
	weight : " weigh around 30 lb",
	scores : [0, 2, 1, 0, 0, 0],
	trait : "Grung (+2 Dexterity, +1 Constitution)\nPoisonous Skin: Creatures that touch me must make a DC 12 Con save or be poisoned for 1 min, repeating the save at the end of each of its turns. My piercing weapon attacks deal +2d4 poison damage if the target fails a DC 12 Con save.\nStanding Leap: Without a running start, I can long jump to 25 ft and high jump to 15 ft.\nWater Dependency: I can breathe air and water. I need to be immersed in water for 1 hour every day or suffer 1 level of exhaustion at the end of that day until I immerse for 1 hour."
};

// pub_20171121_XGtE.js
// This file adds the backgrounds and beasts from Xanathar's Guide to Everything to MPMB's Character Record Sheet

// Define the source
SourceList.X={
	name : "Xanathar's Guide to Everything",
	abbreviation : "XGtE",
	abbreviationSpellsheet : "X",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/xanathars-guide-everything",
	date : "2017/11/21"
};

// Add 3 subclasses for the Barbarian
AddSubClass("barbarian", "ancestral guardian", {
	regExpSearch : /^(?=.*ancestral)(?=.*guardian).*$/i,
	subname : "Path of the Ancestral Guardian",
	source : [["X", 9]],
	fullname : "Ancestral Guardian",
	features : {
		"subclassfeature3" : {
			name : "Ancestral Protectors",
			source : [["X", 10]],
			minlevel : 3,
			description : desc([
				"While raging, the first creature I hit with an attack on my turn becomes distracted",
				"While distracted, it has disadvantage on attack rolls that don't target me",
				"In addition, everybody but me counts as having resistance to all of the target's attacks",
				"This lasts until the start of my next turn, or until my rage ends"
			])
		},
		"subclassfeature6" : {
			name : "Spirit Shield",
			source : [["X", 10]],
			minlevel : 6,
			description : desc([
				"As a reaction while raging when an ally I see within 30 ft is damaged, I can reduce it",
				"My guardian spirits reduce the damage by an amount equal to the roll of the dice"
			]),
			additional : levels.map(function (n) { return n < 6 ? "" : (n < 10 ? 2 : n < 14 ? 3 : 4) + "d6 damage reduced"; }),
			action : ["reaction", " (in Rage)"]
		},
		"subclassfeature10" : {
			name : "Consult the Spirits",
			source : [["X", 10]],
			minlevel : 10,
			description : desc([
				"I can cast either Clairvoyance or Augury, without a spell slot or material components",
				"Augury consults ancestral spirits; Clairvoyance summons an invisible ancestral spirit",
				"Wisdom is my spellcasting ability for these spells"
			]),
			spellcastingAbility : 5,
			spellcastingBonus : [{
				name : "Consult the Spirits",
				spells : ["augury"],
				selection : ["augury"],
				firstCol : 'oncesr'
			}, {
				name : "Consult the Spirits",
				spells : ["clairvoyance"],
				selection : ["clairvoyance"],
				firstCol : 'oncesr'
			}],
			usages : 1,
			recovery : "short rest",
			spellChanges : {
				"augury" : {
					components : "V,S",
					compMaterial : "",
					description : "Omen about specific course of action I plan to take in the next 30 min",
					changes : "My casting of Augury is a practice of consulting my ancestral spirits, thus requiring no material components."
				},
				"clairvoyance" : {
					components : "V,S",
					compMaterial : "",
					changes : "My casting of Clairvoyance is a practice of consulting my an ancestral spirit of mine, thus requiring no material components."
				}
			}
		},
		"subclassfeature14" : {
			name : "Vengeful Ancestors",
			source : [["X", 10]],
			minlevel : 14,
			description : "\n   " + "When using Spirit Shield, the attacker takes the reduced amount as force damage"
		}
	}
});
AddSubClass("barbarian", "storm herald", {
	regExpSearch : /^(?=.*storm)(?=.*herald).*$/i,
	subname : "Path of the Storm Herald",
	source : [["X", 10]],
	fullname : "Storm Herald",
	abilitySave : 3,
	features : {
		"subclassfeature3" : {
			name : "Storm Aura",
			source : [["X", 10]],
			minlevel : 3,
			description : desc([
				"While raging, I emanate a 10-ft radius aura, but not through total cover",
				"The aura's features activate when I enter my rage or as a bonus action while raging",
				'Use the "Choose Feature" button above to select the type of aura'
			]),
			choices : ["Desert", "Sea", "Tundra"],
			action : ["bonus action", " (reactivate)"],
			"desert" : {
				name : "Storm Aura: Desert",
				description : desc([
					"While raging, I emanate a 10-ft radius aura, but not through total cover",
					"The aura's features activate when I enter my rage or as a bonus action while raging",
					"Whenever I active my aura, anybody in my aura other than me takes fire damage"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : (n < 5 ? 2 : n < 10 ? 3 : n < 15 ? 4 : n < 20 ? 5 : 6) + " fire damage"; })
			},
			"sea" : {
				name : "Storm Aura: Sea",
				description : desc([
					"While raging, I emanate a 10-ft radius aura, but not through total cover",
					"The aura's features activate when I enter my rage or as a bonus action while raging",
					"Whenever I active my aura, I can choose one creature in my aura other than me",
					"It takes lightning damage, or half as much on a successful Dexterity saving throw",
					"My Storm Herald features have DC 8 + my Proficiency Bonus + my Constitution modifier"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : (n < 10 ? 1 : n < 15 ? 2 : n < 20 ? 3 : 4) + "d6 lightning damage"; })
			},
			"tundra" : {
				name : "Storm Aura: Tundra",
				description : desc([
					"While raging, I emanate a 10-ft radius aura, but not through total cover",
					"The aura's features activate when I enter my rage or as a bonus action while raging",
					"Whenever I active my aura, all creatures of my choice in my aura gain temporary HP"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : (n < 5 ? 2 : n < 10 ? 3 : n < 15 ? 4 : n < 20 ? 5 : 6) + " temporary hit points"; })
			},
			choiceDependencies : [{
				feature : "subclassfeature6"
			}, {
				feature : "subclassfeature10"
			}, {
				feature : "subclassfeature14"
			}]
		},
		"subclassfeature6" : {
			name : "Storm Soul",
			source : [["X", 10]],
			minlevel : 6,
			description : "\n   " + 'Use the "Choose Feature" button above to select the effect',
			choices : ["desert", "sea", "tundra"],
			choicesNotInMenu : true,
			"desert" : {
				name : "Storm Soul: Desert",
				description : desc([
					"I have resistance to fire damage and don't suffer the effects of extreme heat",
					"As an action, I can set fire to an unattended flammable object I touch"
				]),
				action : ["action", " (ignite)"],
				dmgres : ["Fire"],
				savetxt : { immune : ["effects of extreme heat"] }
			},
			"sea" : {
				name : "Storm Soul: Sea",
				description : desc([
					"I can breathe underwater and I have 30 ft swim speed",
					"In addition, I have resistance to lightning damage"
				]),
				dmgres : ["Lightning"],
				speed : { swim : { spd : 30, enc : 20 } }
			},
			"tundra" : {
				name : "Storm Soul: Tundra",
				description : desc([
					"I have resistance to cold damage and don't suffer the effects of extreme cold",
					"As an action, I can turn a 5-ft cube of water to ice, which melts after 1 minute",
					"This action fails if there are any creatures within the cube of water"
				]),
				action : ["action", " (freeze)"],
				dmgres : ["Cold"],
				savetxt : { immune : ["effects of extreme cold"] }
			}
		},
		"subclassfeature10" : {
			name : "Shielding Storm",
			source : [["X", 10]],
			minlevel : 10,
			description : "\n   " + "In rage, creatures of my choice within my Storm Aura also gain Storm Soul resistance",
			choices : ["desert", "sea", "tundra"],
			choicesNotInMenu : true,
			"desert" : {
				name : "Shielding Storm: Desert",
				description : "\n   " + "While raging, creatures of my choice within my Storm Aura also gain resistance to fire"
			},
			"sea" : {
				name : "Shielding Storm: Sea",
				description : "\n   " + "In rage, creatures of my choice within my Storm Aura also gain resistance to lightning"
			},
			"tundra" : {
				name : "Shielding Storm: Tundra",
				description : "\n   " + "While raging, creatures of my choice within my Storm Aura also gain resistance to cold"
			}
		},
		"subclassfeature14" : {
			name : "Raging Storm",
			source : [["X", 11]],
			minlevel : 14,
			description : "\n   " + 'Use the "Choose Feature" button above to select the effect',
			choices : ["desert", "sea", "tundra"],
			choicesNotInMenu : true,
			"desert" : {
				name : "Raging Storm: Desert",
				description : desc([
					"As a reaction when hit by a creature in my Storm Aura, I can have it make a Dex save",
					"On a failed save, the attacker takes fire damage equal to half my barbarian level",
					"My Storm Herald features have DC 8 + my Proficiency Bonus + my Constitution modifier"
				]),
				action : ["reaction", " (if hit)"],
				additional : levels.map(function (n) { return n < 14 ? "" : Math.floor(n/2) + " fire damage"; })
			},
			"sea" : {
				name : "Raging Storm: Sea",
				description : desc([
					"As a reaction when I hit a creature in my Storm Aura, I can have it make a Str save",
					"On a failed save, the creature is knocked prone, as if struck by a wave"
				]),
				action : ["reaction", " (with attack)"]
			},
			"tundra" : {
				name : "Raging Storm: Tundra",
				description : desc([
					"Whenever I activate my Storm Aura, I can choose a creature in my aura that I can see",
					"It must make a Str save or have its speed reduced to 0 until the start of my next turn",
					"My Storm Herald features have DC 8 + my Proficiency Bonus + my Constitution modifier"
				])
			}
		}
	}
});
AddSubClass("barbarian", "zealot", {
	regExpSearch : /zealot/i,
	subname : "Path of the Zealot",
	source : [["X", 11]],
	fullname : "Zealot",
	features : {
		"subclassfeature3" : {
			name : "Divine Fury",
			source : [["X", 11]],
			minlevel : 3,
			description : desc([
				"While raging, the first creature I hit with a weapon attack in my turn gets extra damage",
				"This is necrotic or radiant damage equal to 1d6 + half my barbarian level",
				'Choose a damage type using the "Choose Feature" button above'
			]),
			additional : levels.map(function (n) { return n < 3 ? "" : "+1d6+" + Math.floor(n/2) + " damage"; }),
			choices : ["Necrotic Damage", "Radiant Damage"],
			"necrotic damage" : {
				name : "Divine Fury",
				description : desc([
					"While raging, the first creature I hit with a weapon attack in my turn gets extra damage",
					"It takes an extra 1d6 + half my barbarian level worth of necrotic damage"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : "+1d6+" + Math.floor(n/2) + " necrotic damage"; })
			},
			"radiant damage" : {
				name : "Divine Fury",
				description : desc([
					"While raging, the first creature I hit with a weapon attack in my turn gets extra damage",
					"It takes an extra 1d6 + half my barbarian level worth of radiant damage"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : "+1d6+" + Math.floor(n/2) + " radiant damage"; })
			},
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (!v.isSpell && classes.known.barbarian && classes.known.barbarian.level > 2 && (/\brage\b/i).test(v.WeaponTextName)) {
							var theDMG = GetFeatureChoice('class', 'barbarian', 'subclassfeature3');
							if (!theDMG) return;
							fields.Description += (fields.Description ? '; ' : '') + '+1d6+' + Math.floor(classes.known.barbarian.level / 2) + ' ' + GetFeatureChoice('class', 'barbarian', 'subclassfeature3') + ' on first hit each turn';
						};
					},
					"If I include the word 'Rage' in a melee weapon's name, it will show in its description that its first hit does extra damage."
				]
			}
		},
		"subclassfeature3.1" : {
			name : "Warrior of the Gods",
			source : [["X", 11]],
			minlevel : 3,
			description : "\n   " + "Spells restoring me to life (not undeath or anything else) don't require material comp."
		},
		"subclassfeature6" : {
			name : "Fanatical Focus",
			source : [["X", 11]],
			minlevel : 6,
			description : desc([
				"When I fail a saving throw while raging, I can reroll it and must use the new roll",
				"I can use this ability only once per rage"
			]),
			usages : 1,
			recovery : "rage"
		},
		"subclassfeature10" : {
			name : "Zealous Presence",
			source : [["X", 11]],
			minlevel : 10,
			description : desc([
				"As a bonus action, I choose up to 10 creatures within 60 ft that can hear my battle cry",
				"These creatures gain adv. on attacks and saves until the start of my next turn"
			]),
			usages : 1,
			recovery : "long rest",
			action : ["bonus action", ""]
		},
		"subclassfeature14" : {
			name : "Rage Beyond Death",
			source : [["X", 11]],
			minlevel : 14,
			description : desc([
				"While raging, having 0 hit points doesn't knock me unconscious",
				"I still must make death saves, and I suffer the normal effects of taking damage",
				"I only die due to failed death saves if my rage ends while I'm at 0 HP"
			])
		}
	}
});

// Add 3 subclasses for the Bard
AddSubClass("bard", "college of glamour", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*glamour).*$/i,
	subname : "College of Glamour",
	source : [["X", 14]],
	features : {
		"subclassfeature3" : {
			name : "Mantle of Inspiration",
			source : [["X", 14]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I expend one Bardic Inspiration die to aid those within 60 ft of me",
				"My Cha mod (min 1) of creatures that I can see and can see me gain temporary HP",
				"They can immediately use a reaction to move their speed, without opportunity attacks"
			]),
			additional : levels.map(function (n) { return n < 3 ? "" : "1 inspiration die; " + (n < 5 ? 5 : n < 10 ? 8 : n < 15 ? 11 : 14) + " temp HP"; }),
			action : ["bonus action", ""]
		},
		"subclassfeature3.1" : {
			name : "Enthralling Performance",
			source : [["X", 14]],
			minlevel : 3,
			recovery : "short rest",
			usages : 1,
			description : desc([
				"By performing for at least 1 minute, I can charm humanoids within 60 ft of me",
				"After the performance, my Cha mod (min 1) number of targets must make a Wis save",
				"On a fail, a target is charmed for 1 hour; If success, it doesn't knows I tried to charm it",
				"While charmed, the target idolizes me, hinders those opposing me, and avoids violence",
				"This lasts until a target takes damage, I attack it, or if it sees me attacking its allies"
			])
		},
		"subclassfeature6" : {
			name : "Mantle of Majesty",
			source : [["X", 14]],
			minlevel : 6,
			recovery : "long rest",
			usages : 1,
			action : ["bonus action", ""],
			description : desc([
				"As a bonus action, I appear unearthly beautiful while I concentrate, up to 1 minute",
				"At the same time, and as a bonus action during, I can cast Command without a spell slot",
				"Creatures charmed by me automatically fail their saves against these Command spells"
			]),
			spellcastingBonus : [{
				name : "Mantle of Majesty",
				spells : ["command"],
				selection : ["command"],
				firstCol : 'oncelr'
			}],
			spellChanges : {
				"command" : {
					time : "1 bns",
					description : "1 crea save or follow one word command, e.g. approach, drop, flee, halt",
					changes : "Using my Mantle of Majesty class feature, I can cast Command as a bonus action once per long rest without using a spell slot, thus only affect a single target."
				}
			}
		},
		"subclassfeature14" : {
			name : "Unbreakable Majesty",
			source : [["X", 14]],
			minlevel : 14,
			recovery : "short rest",
			usages : 1,
			action : ["bonus action", ""],
			description : desc([
				"As a bonus action, I gain a magically majestic presence for 1 min or until incapacitated",
				"During this, the first time a creature attacks me each turn they must make a Cha save",
				"If failed, it can't attack me this turn and must choose another target or lose its attack",
				"If successful, it can attack, but has disadv. on all saves against my spells on my next turn"
			])
		}
	}
});
AddSubClass("bard", "college of swords", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*\bswords?\b).*$/i,
	subname : "College of Swords",
	source : [["X", 15]],
	attacks : [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : [["X", 15]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with medium armor and scimitars",
				"My bardic spellcasting focus can be any simple or martial weapon I'm proficient with"
			]),
			armorProfs : [false, true, false, false],
			weaponProfs : [false, false, ["scimitar"]]
		},
		"subclassfeature3.1" : {
			name : "Fighting Style",
			source : [["X", 15]],
			minlevel : 3,
			description : "\n   " + 'Select a Fighting Style for the college of swords using the "Choose Feature" button above',
			choices : ["Dueling", "Two-Weapon Fighting"],
			"dueling" : FightingStyles.dueling,
			"two-weapon fighting" : FightingStyles.two_weapon
		},
		"subclassfeature3.2" : {
			name : "Blade Flourish",
			source : [["X", 15]],
			minlevel : 3,
			description : desc([
				"When I take the Attack action on my turn, I gain bonus speed and special attack options",
				"I gain +10 ft to my walking speed until the end of the current turn",
				"Once per turn when I hit with a weapon attack, I can expend a Bardic Inspiration die",
				"The roll of that die is added to the weapon's damage, in addition to one of the following:",
				"\u2022 Defensive Flourish: the result is also added to my AC until the start of my next turn",
				"\u2022 Slashing Flourish: the extra damage is also dealt to any of my choosing in 5 ft of me",
				"\u2022 Mobile Flourish: the target is also pushed 5 plus the die result in feet away from me",
				"  As a reaction after this push, I can move my speed to a space within 5 ft of the target"
			])
		},
		"subclassfeature14" : {
			name : "Master Flourish",
			source : [["X", 16]],
			minlevel : 14,
			description : "\n   " + "When I do a Blade Flourish, I can use a d6 instead of expending a Bardic Inspiration die"
		}
	}
});
AddSubClass("bard", "college of whispers", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*whispers).*$/i,
	subname : "College of Whispers",
	source : [["X", 16]],
	features : {
		"subclassfeature3" : {
			name : "Psychic Blades",
			source : [["X", 16]],
			minlevel : 3,
			description : desc([
				"When I hit a creature with a weapon attack, I can expend one use of Bardic Inspiration",
				"If so, the attack does extra psychic damage; I can do so only once per round, on my turn"
			]),
			additional : levels.map(function (n) { return n < 3 ? "" : "1 Bardic Inspiration for +" + (n < 5 ? 2 : n < 10 ? 3 : n < 15 ? 5 : 8) + "d6 damage"; })
		},
		"subclassfeature3.1" : {
			name : "Words of Terror",
			source : [["X", 16]],
			minlevel : 3,
			recovery : "short rest",
			usages : 1,
			description : desc([
				"By speaking privately with a humanoid for at least 1 minute, I can try to inspire terror",
				"After the talk, it must make a Wis save or be frightened of me or someone of my choice",
				"If the save is successful, the target doesn't know I tried to frighten it",
				"This lasts for 1 hour, or until it sees its allies or itself being attacked or damaged"
			])
		},
		"subclassfeature6" : {
			name : "Mantle of Whispers",
			source : [["X", 16]],
			minlevel : 6,
			recovery : "short rest",
			usages : 1,
			action : ["reaction", ""],
			description : desc([
				"As a reaction when a humanoid dies within 30 ft of me, I can capture its shadow",
				"As an action, I can use it to make me look just like the dead person did while it was alive",
				"While disguised, I know general information about it and its memories, but not its secrets",
				"Others can see through the disguise with a Wis (Insight) check vs. my Cha (Deception) +5",
				"A shadow lasts until used or next long rest; The disguise ends as a bonus action or 1 hour"
			]),
			action : [['action', 'Shadow Disguise (start)'], ['bonus action', 'Shadow Disguise (end)']]
		},
		"subclassfeature14" : {
			name : "Shadow Lore",
			source : [["X", 16]],
			minlevel : 14,
			recovery : "long rest",
			usages : 1,
			action : ["action", ""],
			description : desc([
				"As an action, I whisper to a creature within 30 ft that can hear and understand me",
				"Only the target can hear me; It must make a Wis save or be charmed by me for 8 hours",
				"If failed, it thinks I know its most mortifying secret, otherwise it only hears mumbling",
				"While charmed, the target obeys my commands, but won't fight or risk its life for me",
				"This lasts for 8 hours, or until I or my allies attack it, damage it, or have it make a save"
				//"When the effect ends, the target has no idea why it was so afraid of me"
			])
		}
	}
});

// Add 2 subclasses for the Cleric
AddSubClass("cleric", "forge domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(forge|forgery|blacksmith)).*$/i,
	subname : "Forge Domain",
	source : [["X", 18]],
	spellcastingExtra : ["identify", "searing smite", "heat metal", "magic weapon", "elemental weapon", "protection from energy", "fabricate", "wall of fire", "animate objects", "creation"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : [["X", 19]],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with heavy armor and smith's tools",
			armorProfs : [false, false, true, false],
			toolProfs : ["Smith's tools"]
		},
		"subclassfeature1.1" : {
			name : "Blessing of the Forge",
			source : [["X", 19]],
			minlevel : 1,
			action : ["action", ""],
			usages : 1,
			recovery : "long rest",
			description : desc([
				"At the end of a long rest, I can imbue magic into a nonmagical weapon or armor",
				"It becomes magical: +1 AC if armor, or +1 to attack and damage rolls if a weapon",
				"This lasts until the end of my next long rest or until I die"
			])
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Artisan's Blessing",
			source : [["X", 19]],
			minlevel : 2,
			description : desc([
				"With an hour-long ritual, I can craft a nonmagical item that is at least part metal",
				"Including: suit of armor, simple or martial weapon, set of tools, 10 pieces of ammunition",
				"The creation can be worth up to 100 gp, and I must expend metals of equal value to it",
				"The metals irretrievably coalesce into the new item, forming even nonmetal parts of it",
				"The item can be an exact duplicate of a nonmagical item if I possess the original",
				"The item comes into existence at the end of the hour in an unoccupied space within 5 ft"
			])
		},
		"subclassfeature6" : {
			name : "Soul of the Forge",
			source : [["X", 19]],
			minlevel : 6,
			description : "\n   " + "I gain resistance to fire damage and +1 to AC while wearing medium or heavy armor",
			dmgres : ["Fire"],
			extraAC : {
				mod : 1,
				text : "I gain a +1 bonus to AC while wearing Medium or Heavy armor.",
				stopeval : function (v) { return !v.mediumArmor && !v.heavyArmor; }
			}
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : [["X", 19]],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 fire damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && v.isWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 fire damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra fire damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Saint of Forge and Fire",
			source : [["X", 19]],
			minlevel : 17,
			description : desc([
				"I gain immunity to fire damage",
				"When wearing heavy armor, I'm resistant to nonmagical bludg./piercing/slashing damage"
			]),
			savetxt : { immune : ["fire"] },
			dmgres : [["Bludgeoning", "Bludg. (nonmagical)"], ["Piercing", "Pierc. (nonmagical)"], ["Slashing", "Slash. (nonmagical)"]]
		}
	}
});
AddSubClass("cleric", "grave domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*grave).*$/i,
	subname : "Grave Domain",
	source : [["X", 19]],
	spellcastingExtra : ["bane", "false life", "gentle repose", "ray of enfeeblement", "revivify", "vampiric touch", "blight", "death ward", "antilife shell", "raise dead"],
	features : {
		"subclassfeature1" : {
			name : "Circle of Mortality",
			source : [["X", 20]],
			minlevel : 1,
			action : ["bonus action", ""],
			description : desc([
				"Spells I cast to heal a living creature at 0 HP have their dice count as their max result",
				"I learn Spare the Dying, which I can cast as a bonus action with a range of 30 ft"
			]),
			spellcastingBonus : {
				name : "Circle of Mortality",
				spells : ["spare the dying"],
				selection : ["spare the dying"],
				firstCol : 'atwill'
			},
			spellChanges : {
				"spare the dying" : {
					time : "1 bns",
					range : "30 ft",
					changes : "I can cast Spare the Dying as a bonus action instead of an action, and it has a range of 30 ft instead of touch."
				}
			}
		},
		"subclassfeature1.1" : {
			name : "Eyes of the Grave",
			source : [["X", 20]],
			minlevel : 1,
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			description : desc([
				"As an action, I sense undead within 60 ft that aren't protected from divination magic",
				"Until the end of my next turn, I sense the location of any undead not behind total cover"
			])
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Path to the Grave",
			source : [["X", 20]],
			minlevel : 2,
			action : ["action", ""],
			description : desc([
				"As an action, I can curse a creature within 30 ft until the end of my next turn",
				"It is vulnerable to all the damage from the next attack by me or my allies that hits it"
			])
		},
		"subclassfeature6" : {
			name : "Sentinel at Death's Door",
			source : [["X", 20]],
			minlevel : 6,
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["reaction", ""],
			description : "\n   " + "As a reaction, I turn a critical hit to me or an ally I see within 30 ft to a normal hit"
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : [["X", 20]],
			minlevel : 8,
			description : desc("I add my Wisdom modifier to the damage I deal with my cleric cantrips"),
			calcChanges : GenericClassFeatures["potent spellcasting"].calcChanges
		},
		"subclassfeature17" : {
			name : "Keeper of Souls",
			source : [["X", 20]],
			minlevel : 17,
			description : desc([
				"Once per round, if I'm not incapacitated, I can manipulate the energy of the dying",
				"When an enemy I can see dies within 60 ft of me, I or an ally within 60 ft regain HP",
				"The HP regained is equal to the enemy's number of Hit Dice"
			])
		}
	}
});

// Add 2 subclasses for the Druid
AddSubClass("druid", "circle of dreams", {
	regExpSearch : /^(?=.*(druid|shaman))(?=.*\bdreams\b).*$/i,
	subname : "Circle of Dreams",
	source : [["X", 22]],
	features : {
		"subclassfeature2" : {
			name : "Balm of the Summer Court",
			source : [["X", 22]],
			minlevel : 2,
			description : desc([
				"I have a pool of fey energy represented by a number of d6s equal to my druid level",
				"As a bonus action, I can spend dice to heal an ally within 120 ft of me that I can see",
				"I can spend up to half my druid level worth of dice from the pool at once",
				"The ally heals an amount equal to the total rolled and gains 1 temp HP per die spent"
			]),
			usages : levels.map(function (n) { return n < 2 ? "" : n + "d6 per "; }),
			recovery : "long rest",
			action : ["bonus action", ""]
		},
		"subclassfeature6" : {
			name : "Hearth of Moonlight and Shadow",
			source : [["X", 22]],
			minlevel : 6,
			description : desc([
				"At the start of a rest, I can create a 30-ft radius invisible magical sphere",
				"The sphere extends from a point in space I touch, but doesn't extend through total cover",
				"Within this area, my allies and I gain +5 on Wis (Perception) and Dex (Stealth) checks",
				"Also, any light from open flames that are in the sphere is invisible from outside the area",
				"This effect lasts until the end of the rest or when I leave the sphere"
			])
		},
		"subclassfeature10" : {
			name : "Hidden Paths",
			source : [["X", 22]],
			minlevel : 10,
			description : desc([
				"As a bonus action, I can teleport myself up to 60 ft to a spot I can see",
				"As an action, I can teleport a willing ally I touch up to 30 ft to a spot I can see"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : [["bonus action", ""], ['action', ' (on ally)']]
		},
		"subclassfeature14" : {
			name : "Walker in Dreams",
			source : [["X", 23]],
			minlevel : 14,
			usages : 1,
			recovery : "long rest",
			description : desc([
				"When I finish a short rest, I can cast either Dream, Scrying, or Teleportation Circle",
				"This doesn't require a spell slot or material components; Dream uses me as the messenger",
				"Teleportation Circle connects to the last place I finished a long rest, if on the same plane"
			]),
			spellcastingBonus : [{
				name : "Walker in Dreams",
				spells : ["dream"],
				selection : ["dream"],
				firstCol : 'oncelr'
			}, {
				name : "Walker in Dreams",
				spells : ["scrying"],
				selection : ["scrying"],
				firstCol : 'oncelr'
			}, {
				name : "Walker in Dreams",
				spells : ["teleportation circle"],
				selection : ["teleportation circle"],
				firstCol : 'oncelr'
			}],
			spellChanges : {
				"dream" : {
					components : "V,S",
					compMaterial : "",
					changes : "Using Walker in Dreams, I can cast either Dream, Scrying, or Teleportation Circle once per long rest without requiring material components."
				},
				"scrying" : {
					components : "V,S",
					compMaterial : "",
					description : "1 crea save or sensor follows it around; or create sensor in familiar location; see book",
					changes : "Using Walker in Dreams, I can cast either Dream, Scrying, or Teleportation Circle once per long rest without requiring material components."
				},
				"teleportation circle" : {
					components : "V",
					compMaterial : "",
					description : "Create a circle to teleport to the place where I finished my last long rest, if on the same plane; see book",
					changes : "Using Walker in Dreams, I can cast either Dream, Scrying, or Teleportation Circle once per long rest without requiring material components.\n \u2022 The teleportation circle brings me back to the place where I finished my last long rest."
				}
			}
		}
	}
});
AddSubClass("druid", "circle of the shepherd", {
	regExpSearch : /^(?=.*(druid|shaman))(?=.*shepherd).*$/i,
	subname : "Circle of the Shepherd",
	source : [["X", 23]],
	features : {
		"subclassfeature2" : {
			name : "Speech of the Woods",
			source : [["X", 23]],
			minlevel : 2,
			description : desc([
				"I can talk with beasts, they understand me and I them, to the limit of their intelligence",
				"This doesn't automatically make me friends with all beasts; Additionally, I learn Sylvan"
			]),
			languageProfs : ["Sylvan"]
		},
		"subclassfeature2.1" : {
			name : "Spirit Totem",
			source : [["X", 23]],
			minlevel : 2,
			description : desc([
				"As a bonus action, I can summon, or move, a spirit to a point I can see within 60 ft",
				"It is a spectral form of a Bear, Hawk, or Unicorn (my choice), with a 30-ft radius aura",
				"It is incorporeal, immobile, doesn't counts as a creature or object, and persists for 1 min",
				"The spirit persists for 1 minute or until I'm incapacitated",
				"\u2022 Bear: my allies and I, if in the aura, immediately gain 5 + my druid level in temp HP",
				"  While in the aura, my allies and I gain advantage on Strength checks and saves",
				"\u2022 Hawk: As a reaction, I can grant advantage on an attack vs. a target in the aura",
				"  While in the aura, my allies and I gain advantage on Wisdom (Perception) checks",
				"\u2022 Unicorn: my allies and I gain advantage on ability checks to detect targets in the aura",
				"  When I cast a healing spell with a spell slot, allies in the aura heal my druid level in HP"
			]),
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		},
		"subclassfeature6" : {
			name : "Mighty Summoner",
			source : [["X", 24]],
			minlevel : 6,
			description : "\n   " + "Beasts or Fey I summon with spells get +2 HP per HD and their attacks count as magical",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						switch (spellKey) {
							case "conjure animals" :
							case "conjure fey" :
								spellObj.description += "; each +2 HP/HD, magical natural attacks";
								return true;
							case "conjure woodland beings" :
								spellObj.description = spellObj.description.replace(/fey.*/, "fey; obeys commands if its align. agrees; breaks free if break conc.; +2 HP/HD, magic atks");
								return true;
						}
					},
					"When I use a spell that summons beast or fey creatures, those summons have +2 HP per HD and their attacks count as magical."
				]
			}
		},
		"subclassfeature10" : {
			name : "Guardian Spirit",
			source : [["X", 24]],
			minlevel : 10,
			description : "\n   " + "When a Beast or Fey that I summoned ends its turn in my Spirit Totem aura, it heals",
			additional : levels.map(function (n) { return n < 10 ? "" : "heals " + Math.floor(n / 2) + " HP"; })
		},
		"subclassfeature14" : {
			name : "Faithful Summons",
			source : [["X", 24]],
			minlevel : 14,
			description : desc([
				"When I am reduced to 0 HP or incapacitated against my will, I can cast Conjure Animals",
				"This is done as if using a 9th-level spell slot to summon 4 beast of my choice up to CR 2",
				"They appear within 20 ft of me, last 1 hour, and protect me from harm and attack foes"
			]),
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Faithful Summons",
				spells : ["conjure animals"],
				selection : ["conjure animals"],
				firstCol : "oncelr"
			},
			spellChanges : {
				"conjure animals" : {
					nameShort : "Conjure Animals (level 9)",
					range : "20 ft",
					duration : "1 h",
					description : "Summon 4 CR 2 beasts; protect me from harm and attack foes",
					changes : "Using my Faithful Summons class feature when I'm reduced to 0 HP, I can cast Conjure Animals as if using a 9th-level spell slot. This then summons 4 beast of my choice up to CR 2 within 20 ft of me without needing concentration."
				}
			}
		}
	}
});

// Add 3 subclasses for the Fighter
AddSubClass("fighter", "arcane archer", {
	regExpSearch : /^(?=.*arcane)(?=.*archer).*$/i,
	subname : "Arcane Archer",
	source : [["X", 28]],
	fullname : "Arcane Archer",
	abilitySave : 4,
	features : {
		"subclassfeature3" : {
			name : "Arcane Archer's Lore",
			source : [["X", 28]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with either the Arcana or Nature skill",
				"I also learn either the Prestidigitation or the Druidcraft cantrip"
			]),
			skillstxt : "Arcana or Nature",
			spellcastingBonus : {
				name : "Arcane Archer's Lore",
				spells : ["druidcraft", "prestidigitation"]
			},
		},
		"subclassfeature3.1" : {
			name : "Arcane Shot",
			source : [["X", 28]],
			minlevel : 3,
			description : desc([
				"I can unleash magical effects when I fire an arrow from a short- or longbow",
				"I can use this once per turn as part of the Attack action, after an attack hits",
				"I know a number of Arcane Shot Options and learn additional at certain levels",
				'Use the "Choose Feature" button above to add Arcane Shots Options to the third page'
			]),
			usages : 2,
			recovery : "short rest",
			additional : levels.map( function(n) { return n < 3 ? "" : (n < 7 ? 2 : n < 10 ? 3 : n < 15 ? 4 : n < 18 ? 5 : 6) + " options known"; }),
			extraname : "Arcane Shot Option",
			extrachoices : ["Banishing Arrow [Abjuration]", "Beguiling Arrow [Enchantment]", "Bursting Arrow [Evocation]", "Enfeebling Arrow [Necromancy]", "Grasping Arrow [Conjuration]", "Piercing Arrow [Transmutation]", "Seeking Arrow [Divination]", "Shadow Arrow [Illusion]"],
			extraTimes : levels.map(function (n) {
				return n < 3 ? 0 : n < 7 ? 2 : n < 10 ? 3 : n < 15 ? 4 : n < 18 ? 5 : 6;
			}),
			"banishing arrow [abjuration]" : {
				name : "Banishing Arrow [Abjuration]",
				source : [["X", 29]],
				description : desc([
					"The target makes a Cha save or is banished to the Feywild until the end of its next turn",
					"While banished, its speed is 0 and is incapacitated; It re-appearing in the same spot",
					"When I reach 18th level, this Arcane Shot Option also does an extra 2d6 force damage"
				]),
				additional : levels.map( function(n) { return n < 18 ? "" : "+2d6 force damage"; })
			},
			"beguiling arrow [enchantment]" : {
				name : "Beguiling Arrow [Enchantment]",
				source : [["X", 29]],
				description : desc([
					"The target takes extra psychic damage and must succeed on a Wisdom save",
					"If failed, it is charmed by one of my allies within 30 ft of it that I choose",
					"This lasts until my next turn starts or until the chosen ally attacks the target in any way"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 2 : 4) + "d6 damage"; })
			},
			"bursting arrow [evocation]" : {
				name : "Bursting Arrow [Evocation]",
				source : [["X", 29]],
				description : "\n   " + "The target, in addition to the shot, and all creatures within 10 ft of it take damage",
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 2 : 4) + "d6 force damage"; })
			},
			"enfeebling arrow [necromancy]" : {
				name : "Enfeebling Arrow [Necromancy]",
				source : [["X", 29]],
				description : desc([
					"The target takes extra necrotic damage and must make a Constitution save",
					"If failed, the damage of the target's attacks are halved until the start of my next turn"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 2 : 4) + "d6 necrotic damage"; })
			},
			"grasping arrow [conjuration]" : {
				name : "Grasping Arrow [Conjuration]",
				source : [["X", 29]],
				description : desc([
					"The target takes extra poison damage as brambles wrap around it for 1 minute",
					"The brambles give it -10 ft speed and do it slashing damage every round it moves",
					"These can be removed by it or another as an action with Strength (Athletics) vs. my DC"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : (n < 18 ? 2 : 4) + "d6 poison/slash. damage"; })
			},
			"piercing arrow [transmutation]" : {
				name : "Piercing Arrow [Transmutation]",
				source : [["X", 29]],
				description : desc([
					"With this I don't roll for the attack, but shoot the arrow in a 30-ft long, 1-ft wide line",
					"It passes through objects, ignoring cover, but all creatures in the area take damage",
					"The damage is the same as a normal hit from my attack, plus extra piercing damage",
					"A creature can make a Dexterity save to reduce the damage by half"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 1 : 2) + "d6 piercing damage"; })
			},
			"seeking arrow [divination]" : {
				name : "Seeking Arrow [Divination]",
				source : [["X", 30]],
				description : desc([
					"With this I don't roll for the attack, but I choose a target I have seen in the last minute",
					"The seeking arrow moves around corners, obstacles, and ignores cover to hit the target",
					"It is hit if it is within the weapon's range and there is a path for the arrow to get to it",
					"The target takes the full damage of the attack plus extra force damage",
					"It can make a Dexterity save to reduce the damage by half; If failed, I know its location"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 1 : 2) + "d6 force damage"; })
			},
			"shadow arrow [illusion]" : {
				name : "Shadow Arrow [Illusion]",
				source : [["X", 30]],
				description : desc([
					"The target takes extra psychic damage and must succeed on a Wisdom save",
					"If failed, the target can't see anything beyond 5 ft until the end of my next turn"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 2 : 4) + "d6 psychic damage"; })
			}
		},
		"subclassfeature7" : {
			name : "Magic Arrow",
			source : [["X", 28]],
			minlevel : 7,
			description : "\n   " + "Whenever I fire a nonmagical arrow from a short- or longbow, I can make it magical"
		},
		"subclassfeature7.1" : {
			name : "Curving Shot",
			source : [["X", 28]],
			minlevel : 7,
			description : desc([
				"Once per turn when I miss with a magic arrow, I can use a bonus action to redirect it",
				"I reroll the attack against a different target within 60 ft of the original target"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature15" : {
			name : "Ever-Ready Shot",
			source : [["X", 28]],
			minlevel : 15,
			description : "\n   " + "I regain one use of Arcane Shot if I have no more remaining when I roll initiative"
		}
	}
});
AddSubClass("fighter", "cavalier", {
	regExpSearch : /cavalier/i,
	subname : "Cavalier",
	source : [["X", 30]],
	fullname : "Cavalier",
	abilitySave : 1,
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiency",
			source : [["X", 30]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with Animal Handling, History, Insight, Performance, or Persuasion",
				'Alternatively, I learn one language; Use the "Choose Feature" button above for this'
			]),
			choices : ["Language proficiency", "Skill proficiency: Animal Handling, History, Insight, Performance, or Persuasion"],
			"language proficiency" : {
				name : "Bonus Proficiency",
				description : "\n   " + "I learn one language of my choice",
				languageProfs : [1]
			},
			"skill proficiency: animal handling, history, insight, performance, or persuasion" : {
				name : "Bonus Proficiency",
				description : "\n   " + "I gain proficiency with Animal Handling, History, Insight, Performance, or Persuasion",
				skillstxt : "Choose one from: Animal Handling, History, Insight, Performance, or Persuasion"
			}
		},
		"subclassfeature3.1" : {
			name : "Born in the Saddle",
			source : [["X", 30]],
			minlevel : 3,
			description : desc([
				"I have advantage on saves to avoid falling off my mount, and land on my feet if I fail",
				"Mounting or dismounting a creature costs me only 5 ft of movement instead of half"
			]),
			savetxt : { adv_vs : ["falling off my mount"] }
		},
		"subclassfeature3.2" : {
			name : "Unwavering Mark",
			source : [["X", 30]],
			minlevel : 3,
			description : desc([
				"If I hit a creature with a melee weapon attack, I mark it until the end of my next turn",
				"While it is within 5 ft of me, a marked target has disadv. on attacks not directed at me",
				"If it damages anybody but me, I can make a special melee attack vs. it in my next turn",
				"This takes a bonus action, but has adv. and adds half my fighter level to the damage",
				"A mark ends early if I'm incapacitated, die, or somebody else marks the target"
			]),
			usages : "Strength modifier per ",
			usagescalc : "event.value = Math.max(1, What('Str Mod'));",
			recovery : "long rest",
			additional : levels.map(function (n) {
				return n < 3 ? "" : "+" + Math.floor(n/2) + " damage";
			}),
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (v.isMeleeWeapon && classes.known.fighter && classes.known.fighter.level > 2 && (/\b(unwavering.?mark|marked)\b/i).test(v.WeaponTextName)) {
							output.extraDmg += Math.floor(classes.known.fighter.level / 2);
						};
					},
					"If I include the words 'Unwavering Mark' or 'Marked' in the name of a melee weapon, it gets half my fighter level added to its Damage."
				]
			}
		},
		"subclassfeature7" : {
			name : "Warding Maneuver",
			source : [["X", 30]],
			minlevel : 7,
			description : desc([
				"As a reaction when I or a creature within 5 ft is hit, I can try to fend off the strike",
				"I add 1d8 to the target's AC; If the attack still hits, the target has resistance against it",
				"I can only do this while wielding a melee weapon or a shield"
			]),
			usages : "Constitution modifier per ",
			usagescalc : "event.value = Math.max(1, What('Con Mod'));",
			recovery : "long rest",
			action : ["reaction", ""],
		},
		"subclassfeature10" : {
			name : "Hold the Line",
			source : [["X", 30]],
			minlevel : 10,
			description : desc([
				"Creatures provoke opportunity attacks when moving 5 ft or more while within my reach",
				"If I hit an opportunity attack, the target's speed is reduced to 0 until the end of the turn"
			])
		},
		"subclassfeature15" : {
			name : "Ferocious Charger",
			source : [["X", 31]],
			minlevel : 15,
			description : desc([
				"If I hit a creature after moving 10 ft in a straight line, it must make a Strength save",
				"If failed, the target is knocked prone; I can do this only once per turn"
			])
		},
		"subclassfeature18" : {
			name : "Vigilant Defender",
			source : [["X", 31]],
			minlevel : 18,
			description : desc([
				"I can make opportunity attacks without using my reaction",
				"I can do this only once on every creature's turn, except on my own turn",
				"I can't do this on the same turn that I use my normal reaction"
			])
		}
	}
});
AddSubClass("fighter", "samurai", {
	regExpSearch : /samurai/i,
	subname : "Samurai",
	source : [["X", 31]],
	fullname : "Samurai",
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiency",
			source : [["X", 31]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with History, Insight, Performance, or Persuasion",
				'Alternatively, I learn one language; Use the "Choose Feature" button above for this'
			]),
			choices : ["Language proficiency", "Skill proficiency: History, Insight, Performance, or Persuasion"],
			"language proficiency" : {
				name : "Bonus Proficiency",
				description : "\n   " + "I learn one language of my choice",
				languageProfs : [1]
			},
			"skill proficiency: history, insight, performance, or persuasion" : {
				name : "Bonus Proficiency",
				description : "\n   " + "I gain proficiency with History, Insight, Performance, or Persuasion",
				skillstxt : "Choose one from: History, Insight, Performance, or Persuasion"
			}
		},
		"subclassfeature3.1" : {
			name : "Fighting Spirit",
			source : [["X", 31]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can give myself advantage on weapon attacks and temporary HP",
				"This advantage on weapon attack rolls lasts until the end of my current turn"
			]),
			recovery : "long rest",
			usages : 3,
			additional : levels.map(function (n) { return n < 3 ? "" : (n < 10 ? 5 : n < 15 ? 10 : 15) + " temporary HP"; }),
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Elegant Courtier",
			source : [["X", 31]],
			minlevel : 7,
			description : desc([
				"I can add my Wisdom modifier to any Charisma (Persuasion) checks I make",
				"I gain proficiency with Wis saves, or if I'm already proficient, either Int or Cha saves"
			]),
			saves : ["Wis"],
			addMod : { type : "skill", field : "Pers", mod : "max(Wis|0)", text : "I can add my Wisdom modifier to any Charisma (Persuasion) checks I make." }
		},
		"subclassfeature10" : {
			name : "Tireless Spirit",
			source : [["X", 31]],
			minlevel : 10,
			description : "\n   " + "I regain one use of Fighting Spirit if I have no more remaining when I roll initiative"
		},
		"subclassfeature15" : {
			name : "Rapid Strike",
			source : [["X", 31]],
			minlevel : 15,
			description : desc([
				"With the Attack action, I can forgo advantage on one attack to make one extra attack",
				"This extra attack is part of the same action; I can do this only once per turn"
			])
		},
		"subclassfeature18" : {
			name : "Strength Before Death",
			source : [["X", 31]],
			minlevel : 18,
			description : desc([
				"If I'm reduced to 0 HP but not killed outright, I can delay falling unconscious",
				"I then immediately take a bonus turn, interrupting the current turn",
				"While I'm at 0 HP, I suffer damage normally and die if I have 3 failed death saves",
				"If I'm still at 0 HP at the end of this bonus turn, I fall unconscious"
			]),
			recovery : "long rest",
			usages : 1
		}
	}
});

// Add 3 subclasses for the Monk
AddSubClass("monk", "way of the drunken master", {
	regExpSearch : /^((?=.*drunken)(?=.*master))|((?=.*drunk)((?=.*(monk|monastic))|((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of the Drunken Master",
	source : [["X", 33]],
	fullname : "Drunken Master",
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : [["X", 34]],
			minlevel : 3,
			description : "\n   " + "I gain proficiency with the Performance skill and brewer's supplies",
			skills : ["Performance"],
			toolProfs : ["Brewer's supplies"]
		},
		"subclassfeature3.1" : {
			name : "Drunken Technique",
			source : [["X", 34]],
			minlevel : 3,
			description : "\n   " + "When using Flurry of Blows, I gain the benefits of a Disengage and +10 ft speed this turn"
		},
		"subclassfeature6" : {
			name : "Tipsy Sway",
			source : [["X", 34]],
			minlevel : 6,
			description : "\n   " + "1 ki point: as a reaction if missed in melee, attacker instead hits other I see within 5 ft",
			additional : "Standing up from prone costs only 5 ft",
			action : ["reaction", ""]
		},
		"subclassfeature11" : {
			name : "Drunkard's Luck",
			source : [["X", 34]],
			minlevel : 11,
			description : "\n   " + "By spending 2 ki points, I can remove disadv. from an ability check, attack roll, or save",
			additional : "2 ki points"
		},
		"subclassfeature17" : {
			name : "Intoxicated Frenzy",
			source : [["X", 34]],
			minlevel : 17,
			description : "\n   " + "I can make 3 extra attacks with Flurry of Blows if each is used on a different target"
		}
	}
});
// Create the Kensei and its weapon options last, so we benefit of all possible weapons that were added
RunFunctionAtEnd(function () {
	var theKenseiSubclassName = AddSubClass("monk", "way of the kensei", {
		regExpSearch : /kensei/i,
		subname : "Way of the Kensei",
		source : [["X", 34]],
		fullname : "Kensei",
		features : {
			"subclassfeature3" : {
				name : "Path of the Kensei",
				source : [["X", 34]],
				minlevel : 3,
				description : desc([
					"I gain proficiency with either calligrapher's supplies or painter's supplies",
					"Some weapons, that don't have the heavy or special property, are kensei weapons for me",
					"At least one ranged and one melee weapon, more at higher levels (longbow does qualify)",
					"With these: proficient, count as a monk weapons, special bonuses depending on type held:",
					"\u2022 Melee: if I do unarmed strike during an Attack action, +2 AC until my next turn starts",
					"\u2022 Ranged: as a bonus action, ranged weapon attacks deal +1d4 damage in current turn"
				]),
				action : ["bonus action", " (with ranged)"],
				additional : levels.map( function(n) { return n < 3 ? "" : (n < 6 ? 2 : n < 11 ? 3 : n < 17 ? 4 : 5) + " kensei weapons"; }),
				toolProfs : ["calligrapher's or painter's supplies"],
				extraname : "Kensei Weapon",
				extrachoices : [], // add these dynamically, see below
				extraTimes : levels.map( function(n) { return n < 3 ? 0 : n < 6 ? 2 : n < 11 ? 3 : n < 17 ? 4 : 5; }),
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							var theKenseiWeapons = GetFeatureChoice("class", "monk", "subclassfeature3", true);
							if (theKenseiWeapons.indexOf(v.baseWeaponName) != -1 || ((/kensei/i).test(v.WeaponTextName) && !v.theWea.special && (!(/heavy|special/i).test(fields.Description) || v.baseWeaponName === 'longbow'))) {
								v.theWea.monkweapon = true;
								v.theWea.kenseiweapon = true;
								if (v.isRangedWeapon) {
									fields.Description += (fields.Description ? '; ' : '') + 'As bonus action with Attack action, +1d4 damage';
								};
								fields.Proficiency = true;
							};
						},
						"For the weapons that I select using the \"Choose Feature\" button on the second page or when I include the word 'Kensei' in the name of a weapon that doesn't have the Heavy or Special attribute, or that is a longbow, that weapon gains the same benefits as any other 'Monk Weapon'.\nIn addition, with ranged 'Kensei Weapons', I can take a bonus action to have that hit, and any other hit after that as part of the same action, do +1d4 damage.",
						1
					]
				}
			},
			"ki-empowered strikes" : {
				name : "One with the Blade",
				source : [["X", 34]],
				minlevel : 6,
				description : "\n   " + "My unarmed strikes and kensei weapon attacks count as magical",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (!v.isSpell && !v.thisWeapon[1] && !v.theWea.isMagicWeapon && !(/counts as( a)? magical/i).test(fields.Description) && (v.baseWeaponName === "unarmed strike" || v.theWea.kenseiweapon)) {
								fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
							};
						},
						"My unarmed strikes and any Kensei Weapons count as magical for overcoming resistances and immunities."
					]
				},
				"deft strike" : {
					name : "Deft Strike",
					extraname : "Way of the Kensei 6",
					source : [["X", 35]],
					description : "\n   " + "Once per turn when I hit with a kensei weapon, I can do a martial arts die extra damage",
					additional : "1 ki point"
				},
				"sharpen the blade" : {
					name : "Sharpen the Blade",
					extraname : "Way of the Kensei 11",
					source : [["X", 35]],
					description : desc([
						"As a bonus action, I can grant my kensei weapon a bonus to attack and damage rolls",
						"This bonus is equal to the number of ki points I spend and doesn't stack with magic",
						"This lasts for 1 minute or until I use this feature again"
					]),
					additional : "1 to 3 ki points",
					action : ["bonus action", ""]
				},
				autoSelectExtrachoices : [{
					extrachoice : "deft strike"
				}, {
					extrachoice : "sharpen the blade",
					minlevel : 11
				}]
			},
			"subclassfeature17" : {
				name : "Unerring Accuracy",
				source : [["X", 35]],
				minlevel : 17,
				description : "\n   " + "Once per turn, if I miss a monk weapon attack on my turn, I can reroll the attack roll"
			}
		}
	});
	var itsFea = ClassSubList[theKenseiSubclassName].features.subclassfeature3;
	for (var weapon in WeaponsList) {
		var aWea = WeaponsList[weapon];
		// skip attacks that are not simple or martial weapons, that have the heavy or special property, are magic weapons, or those that are spells or cantrips
		if (weapon !== "longbow" && (aWea.isMagicWeapon || !(/simple|martial/i).test(aWea.type) || (/heavy|special/i).test(aWea.description) || aWea.special || (/spell|cantrip/i).test(aWea.list))) continue;
		itsFea.extrachoices.push(aWea.name);
		itsFea[aWea.name.toLowerCase()] = {
			name : aWea.name,
			description : "",
			source : aWea.source,
			weaponProfs : [false, false, [weapon]],
			weaponsAdd : { select : [aWea.name] },
			submenu : ((/simple/i).test(aWea.type) ? "\x1BSimple weapon, " : "Martial weapon, ") + ((/^(?!.*melee).*\d+.*$/i).test(aWea.range) ? "ranged" : "melee"),
			prereqeval : 'testSource("' + weapon + '", WeaponsList["' + weapon + '"], "weapExcl") ? "skip" : true;'
		}
	}
});
// Add 2 subclasses for the Paladin
AddSubClass("paladin", "oath of conquest", {
	regExpSearch : /^((?=.*(knight tyrant|iron mongers))|((?=.*(conquest|tyranny|tyrant))(((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper))))))).*$/i,
	subname : "Oath of Conquest",
	source : [["X", 37]],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Conquering Presence",
			source : [["X", 38]],
			minlevel : 3,
			description : desc([
				"As an action, all creatures of my choice within a 30-ft radius must make a Wisdom save",
				"If failed, a target is frightened for 1 minute; It can save again at the end of each turn"
			]),
			action : ["action", ""],
			spellcastingExtra : ["armor of agathys", "command", "hold person", "spiritual weapon", "bestow curse", "fear", "dominate beast", "stoneskin", "cloudkill", "dominate person"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Guided Strike",
			source : [["X", 38]],
			minlevel : 3,
			description : "\n   " + "When I make an attack roll, I can add a +10 bonus to the roll after seeing the d20 roll"
		},
		"subclassfeature7" : {
			name : "Aura of Conquest",
			source : [["X", 38]],
			minlevel : 7,
			description : desc([
				"Creatures that are frightened of me have their speed reduced to 0 while in my aura",
				"They also take psychic damage whenever they start theirs turn within my aura"
			]),
			additional : levels.map(function (n) {
				if (n < 7) return "";
				return (n < 18 ? 10 : 30) + "-foot aura; " + Math.floor(n / 2) + " psychic damage";
			})
		},
		"subclassfeature15" : {
			name : "Scornful Rebuke",
			source : [["X", 38]],
			minlevel : 15,
			description : desc([
				"Whenever I'm hit with an attack while I'm not incapacitated, the attacker takes damage",
				"This is psychic damage equal to my Charisma modifier (minimum of 1)"
			])
		},
		"subclassfeature20" : {
			name : "Invincible Conqueror",
			source : [["X", 38]],
			minlevel : 20,
			description : desc([
				"As an action, I can gain the following benefits for 1 minute:",
				" - I have resistance to all damage",
				" - I can make an additional attack as part of my Attack action",
				" - My melee weapons score critical hits on a roll of 19 or 20"
			]),
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("paladin", "oath of redemption", {
	regExpSearch : /^((?=.*redeemer)|((?=.*redemption)(((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper))))))).*$/i,
	subname : "Oath of Redemption",
	source : [["X", 38]],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Emissary of Peace",
			source : [["X", 39]],
			minlevel : 3,
			description : "\n   " + "As a bonus action, I grant myself +5 on Charisma (Persuasion) checks for 10 minutes",
			action : ["bonus action", ""],
			spellcastingExtra : ["sanctuary", "sleep", "calm emotions", "hold person", "counterspell", "hypnotic pattern", "otiluke's resilient sphere", "stoneskin", "hold monster", "wall of force"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Rebuke the Violent",
			source : [["X", 39]],
			minlevel : 3,
			description : desc([
				"As a reaction after a creature within 30 ft attacks and damages another, I can rebuke it",
				"It takes the same damage as it dealt but as radiant damage, with a Wis save to halve it"
			]),
			action : ["reaction", ""]
		},
		"subclassfeature7" : {
			name : "Aura of the Guardian",
			source : [["X", 39]],
			minlevel : 7,
			description : desc([
				"As a reaction when an ally within my aura takes damage, I instead take the damage",
				"This damage can't be reduced in any way; Other effects might still apply to my ally"
			]),
			additional : levels.map(function (n) { return n < 7 ? "" : (n < 18 ? 10 : 30) + "-foot aura"; }),
			action : ["reaction", ""]
		},
		"subclassfeature15" : {
			name : "Protective Spirit",
			source : [["X", 39]],
			minlevel : 15,
			description : "\n   " + "At the end of my turn when I'm below half HP and not incapacitated, I regain HP",
			additional : levels.map(function (n) { return n < 15 ? "" : "1d6+" + Math.floor(n/2) + " HP"; })
		},
		"subclassfeature20" : {
			name : "Emissary of Redemption",
			source : [["X", 39]],
			minlevel : 20,
			description : desc([
				"When taking damage from a creature, I take only half and it takes the other half",
				"This stops working on any that I attack or force to make a save, until I have a long rest"
			]),
			dmgres : ["All from creatures"]
		}
	}
});

// Add 3 subclasses for the Ranger
var XGtE_Ranger_Subclass_Gloom_Stalker = AddSubClass("ranger", "gloom stalker", {
	regExpSearch : /^(?=.*gloom)(?=.*stalker).*$/i,
	subname : "Gloom Stalker",
	source : [["X", 41]],
	fullname : "Gloom Stalker",
	features : {
		"subclassfeature3" : {
			name : "Dread Ambusher",
			source : [["X", 42]],
			minlevel : 3,
			description : desc([
				"I can add my Wisdom modifier to my initiative rolls",
				"In the first turn of combat I get +10 ft speed and an extra attack with the Attack action",
				"If I take the Attack action and that extra attack hits, it does +1d8 damage"
			]),
			addMod : { type : "skill", field : "Init", mod : "max(Wis|0)", text : "I can add my Wisdom modifier to my initiative rolls." }
		},
		"subclassfeature3.1" : {
			name : "Gloom Stalker Magic",
			source : [["X", 42]],
			minlevel : 3,
			description : desc([
				"I add a spell to my known spells at level 3, 5, 9, 13, and 17",
				"These count as ranger spells, but do not count against the number of spells I can know"
			]),
			spellcastingExtra : ["disguise self", "rope trick", "fear", "greater invisibility", "seeming"],
			spellcastingExtraApplyNonconform : true
		},
		"subclassfeature3.2" : {
			name : "Umbral Sight",
			source : [["X", 42]],
			minlevel : 3,
			description : desc([
				"I gain 60 ft darkvision, or add 30 ft to darkvision if I already had it because of my race",
				"When I'm in darkness, others gain no benefit from darkvision to detect me"
			]),
			vision : [["Darkvision", "fixed 60"], ["Darkvision", "+30"]]
		},
		"subclassfeature7" : {
			name : "Iron Mind",
			source : [["X", 42]],
			minlevel : 7,
			description : "\n   " + "I gain proficiency with Wis saves, or if I'm already proficient, either Int or Cha saves",
			saves : ["Wis"]
		},
		"subclassfeature11" : {
			name : "Stalker's Flurry",
			source : [["X", 42]],
			minlevel : 11,
			description : "\n   " + "Once on each of my turns when I miss a weapon attack, I can make an extra attack"
		},
		"subclassfeature15" : {
			name : "Shadowy Dodge",
			source : [["X", 42]],
			minlevel : 15,
			description : "\n   " + "As a reaction when I'm attacked without adv., I can impose disadv. on the attack roll",
			action : ["reaction", " (when attacked)"]
		}
	}
});
var XGtE_Ranger_Subclass_Horizon_Walker = AddSubClass("ranger", "horizon walker", {
	regExpSearch : /^(?=.*horizon)(?=.*walker).*$/i,
	subname : "Horizon Walker",
	source : [["X", 42]],
	fullname : "Horizon Walker",
	features : {
		"subclassfeature3" : {
			name : "Detect Portal",
			source : [["X", 42]],
			minlevel : 3,
			description : "\n   " + "As an action, I sense the distance and direction to the closest planar portal within 1 mile",
			usages : 1,
			recovery : "short rest",
			action : ["action", ""]
		},
		"subclassfeature3.1" : {
			name : "Horizon Walker Magic",
			source : [["X", 42]],
			minlevel : 3,
			description : desc([
				"I add a spell to my known spells at level 3, 5, 9, 13, and 17",
				"These count as ranger spells, but do not count against the number of spells I can know"
			]),
			spellcastingExtra : ["protection from evil and good", "misty step", "haste", "banishment", "teleportation circle"],
			spellcastingExtraApplyNonconform : true
		},
		"subclassfeature3.2" : {
			name : "Planar Warrior",
			source : [["X", 42]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I choose one creature that I can see within 30 ft of me",
				"All damage from my first weapon attack that hits it on this turn becomes force damage",
				"In addition, that first hit does extra damage"
			]),
			additional : levels.map(function (n) { return n < 3 ? "" : "+" + (n < 11 ? 1 : 2) + "d8 force damage"; }),
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Ethereal Step",
			source : [["X", 43]],
			minlevel : 7,
			description : "\n   " + "As a bonus action, I can cast the Etherealness spell, which lasts until the end of my turn",
			usages : 1,
			recovery : "short rest",
			spellcastingBonus : {
				name : "Ethereal Step",
				spells : ["etherealness"],
				selection : ["etherealness"],
				firstCol : 'oncesr'
			},
			spellChanges : {
				"etherealness" : {
					time : "1 bns",
					duration : "1 rnd",
					description : "I go to Ethereal Plane; move there, but able to perceive 60 ft into the normal plane",
					changes : "Using my Ethereal Step class feature I can cast Etherealness as a bonus action once per short rest, but it only affects myself and lasts until the end of my turn."
				}
			}
		},
		"subclassfeature11" : {
			name : "Distant Strike",
			source : [["X", 43]],
			minlevel : 11,
			description : desc([
				"With the Attack action, I can teleport 10 ft before each attack, to a place I can see",
				"If I attack two different creatures with this action, I get an extra attack against a third"
			])
		},
		"subclassfeature15" : {
			name : "Spectral Defense",
			source : [["X", 43]],
			minlevel : 15,
			description : "\n   " + "As a reaction when an attack damages me, I can give myself resistance vs. that attack",
			action : ["reaction", ""]
		}
	}
});
var XGtE_Ranger_Subclass_Monster_Slayer = AddSubClass("ranger", "monster slayer", {
	regExpSearch : /^(?=.*monster)(?=.*slayer).*$/i,
	subname : "Monster Slayer",
	source : [["X", 43]],
	fullname : "Monster Slayer",
	features : {
		"subclassfeature3" : {
			name : "Hunter's Sense",
			source : [["X", 43]],
			minlevel : 3,
			description : desc([
				"As an action, I learn vulnerabilities/immunities/resistances of a target I see within 60 ft",
				"If it is protected from divination magic, I sense it has none of these"
			]),
			action : ["action", ""],
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest"
		},
		"subclassfeature3.1" : {
			name : "Monster Slayer Magic",
			source : [["X", 43]],
			minlevel : 3,
			description : "\n   " + "I get bonus spells known, which do not count against the number of spells I can know",
			spellcastingExtra : ["protection from evil and good", "zone of truth", "magic circle", "banishment", "hold monster"],
			spellcastingExtraApplyNonconform : true
		},
		"subclassfeature3.2" : {
			name : "Slayer's Prey",
			source : [["X", 43]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I designate a creature I see within 60 ft; This lasts until I do this again",
				"My first hit to the target with a weapon attack on each of my turns does +1d6 damage"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Supernatural Defense",
			source : [["X", 43]],
			minlevel : 7,
			description : desc([
				"I add 1d6 to saving throws the current target of my Slayer's Prey forces me to make",
				"In addition, I also add 1d6 to checks to escape that target's grapple"
			])
		},
		"subclassfeature11" : {
			name : "Magic-User's Nemesis",
			source : [["X", 43]],
			minlevel : 11,
			description : desc([
				"As a reaction when I see someone within 60 ft casting a spell or teleporting, I can foil it",
				"The target must make a Wisdom save or have its spell or teleport fail and be wasted"
			]),
			action : ["reaction", ""],
			usages : 1,
			recovery : "short rest"
		},
		"subclassfeature15" : {
			name : "Slayer's Counter",
			source : [["X", 43]],
			minlevel : 15,
			description : desc([
				"As a reaction when the target of my Slayer's Prey has me make a save, I can attack it",
				"I can make one weapon attack; If this hits, I automatically succeed on the saving throw"
			]),
			action : ["reaction", ""]
		}
	}
});
// Add all three subclasses to the revised ranger as well, if it exists
if (ClassList.rangerua) {
	ClassList.rangerua.subclasses[1].push(XGtE_Ranger_Subclass_Gloom_Stalker, XGtE_Ranger_Subclass_Horizon_Walker, XGtE_Ranger_Subclass_Monster_Slayer);
};

// Add 4 subclasses for the Rogue
AddSubClass("rogue", "inquisitive", {
	regExpSearch : /^(?=.*(rogue|miscreant))(?=.*inquisitive).*$/i,
	subname : "Inquisitive",
	source : [["X", 45]],
	features : {
		"subclassfeature3" : {
			name : "Ear for Deceit",
			source : [["X", 45]],
			minlevel : 3,
			description : "\n   " + "For Wis (Insight) to sense if another is lying, I can treat a die roll of 7 or lower as an 8"
		},
		"subclassfeature3.1" : {
			name : "Eye for Detail",
			source : [["X", 46]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can do either of the following:",
				"\u2022 Make a Wisdom (Perception) check to spot a hidden creature or object",
				"\u2022 Make an Intelligence (Investigation) check to uncover or decipher clues"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature3.2" : {
			name : "Insightful Fighting",
			source : [["X", 46]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can decipher the tactics of another I can see that's not incapacitated",
				"I have to make a Wisdom (Insight) check vs. the target's Charisma (Deception) check",
				"If I succeed, I can use my sneak attack on it even if I don't have adv. (but not if disadv.)",
				"This benefit lasts for 1 minute or until I successfully use Insightful Fighting again"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature9" : {
			name : "Steady Eye",
			source : [["X", 46]],
			minlevel : 9,
			description : desc([
				"I'm more perceptive when I don't move more than half my speed in the same turn",
				"If so, I gain adv. on Wis (Perception) and Int (Investigation) checks during that turn"
			])
		},
		"subclassfeature13" : {
			name : "Unerring Eye",
			source : [["X", 46]],
			minlevel : 13,
			description : desc([
				"As an action, I can sense magical deceptions within 30 feet of me, but not what it does",
				"I learn the presence of illusions, shapechanged creatures, or magic designed to deceive"
			]),
			action : ["action", ""],
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest"
		},
		"subclassfeature17" : {
			name : "Eye for Weakness",
			source : [["X", 46]],
			minlevel : 17,
			description : "\n   " + "While my Insightful Fighting is active, I add 3d6 to sneak attacks against that target"
		}
	}
});
AddSubClass("rogue", "scout", {
	regExpSearch : /scout/i,
	subname : "Scout",
	source : [["X", 47]],
	features : {
		"subclassfeature3" : {
			name : "Skirmisher",
			source : [["X", 47]],
			minlevel : 3,
			description : desc([
				"As a reaction when a hostile ends its turn within 5 ft of me, I can move half my speed",
				"This movement does not provoke attacks of opportunity"
			]),
			action : [["reaction", ""]]
		},
		"subclassfeature3.1" : {
			name : "Survivalist",
			source : [["X", 47]],
			minlevel : 3,
			description : "\n   " + "I gain proficiency and expertise with the Nature and Survival skills",
			skills : [['Nature', 'full'], ['Survival', 'full']]
		},
		"subclassfeature9" : {
			name : "Superior Mobility",
			source : [["X", 47]],
			minlevel : 9,
			description : "\n   " + "I gain +10 ft to my walking speed (and swimming/climbing speed, if applicable)",
			speed : {
				walk : { spd : "+10", enc : "+10" },
				climb : { spd : "_10", enc : "_10" },
				swim : { spd : "_10", enc : "_10" }
			}
		},
		"subclassfeature13" : {
			name : "Ambush Master",
			source : [["X", 47]],
			minlevel : 13,
			description : desc([
				"I gain advantage on Initiative rolls",
				"The first creature I hit in the first round of combat becomes an easy target",
				"Until the start of my next turn, all attacks against the target have advantage"
			]),
			advantages : [["Initiative", true]]
		},
		"subclassfeature17" : {
			name : "Sudden Strike",
			source : [["X", 47]],
			minlevel : 17,
			description : desc([
				"With the Attack action, I can make one additional attack as a bonus action",
				"This attack can benefit from my Sneak Attack even if I already used it this turn",
				"However, I still can't use Sneak Attack on a single target more than once per turn"
			]),
			action : ["bonus action", " (with Attack action)"]
		}
	}
});
// Add 3 subclasses for the Sorcerer
AddSubClass("sorcerer", "divine soul", { // this code includes contributions by SoilentBrad
	regExpSearch : /^(?=.*divine)(?=.*soul).*$/i,
	subname : "Divine Soul",
	source : [["X", 50]],
	fullname : "Divine Soul",
	spellcastingList : {
		"class" : ["cleric", "sorcerer"]
	},
	features : {
		"subclassfeature1" : {
			name : "Divine Magic",
			source : [["X", 50]],
			minlevel : 1,
			description : desc([
				"When I learn spells/cantrips or replace known, I can also pick from the cleric spell list",
				"These cleric spells count as sorcerer spells for me",
				'I also learn a spell based on my affinity, use the "Choose Feature" button above for this'
			]),
			choices : ["Good", "Evil", "Law", "Chaos", "Neutrality"],
			"good" : {
				name : "Divine Magic: Good",
				description : desc([
					"When I learn spells/cantrips or replace known, I can also pick from the cleric spell list",
					"I also learn Cure Wounds, which doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Good)",
					"class" : "cleric",
					level : [1,9],
					selection : ["cure wounds"]
				},
				dependentChoices : "eagle"
			},
			"evil" : {
				name : "Divine Magic: Evil",
				description : desc([
					"When I learn spells/cantrips or replace known, I can also pick from the cleric spell list",
					"I also learn Inflict Wounds, which doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Evil)",
					"class" : "cleric",
					level : [1,9],
					selection : ["inflict wounds"]
				},
				dependentChoices : "bat"
			},
			"law" : {
				name : "Divine Magic: Law",
				description : desc([
					"When I learn spells/cantrips or replace known, I can also pick from the cleric spell list",
					"I also learn Bless, which doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Law)",
					"class" : "cleric",
					level : [1,9],
					selection : ["bless"]
				},
				dependentChoices : "eagle"
			},
			"chaos" : {
				name : "Divine Magic: Chaos",
				description : desc([
					"When I learn spells/cantrips or replace known, I can also pick from the cleric spell list",
					"I also learn Bane, which doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Chaos)",
					"class" : "cleric",
					level : [1,9],
					selection : ["bane"]
				},
				dependentChoices : "bat"
			},
			"neutrality" : {
				name : "Divine Magic: Neutrality",
				description : desc([
					"When I learn spells/cantrips or replace known, I can also pick from the cleric spell list",
					"I learn Protection from Evil \xD7 Good; It doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Neutrality)",
					"class" : "cleric",
					level : [1,9],
					selection : ["protection from evil and good"]
				},
				dependentChoices : "dragonfly"
			},
			choiceDependencies : [{
				feature : "subclassfeature14",
				choiceAttribute : true
			}]
		},
		"subclassfeature1.2" : {
			name : "Favored by the Gods",
			source : [["X", 50]],
			minlevel : 1,
			description : "\n   " + "If I fail a saving throw or miss with an attack roll, I can add 2d4 to the total",
			recovery : "short rest",
			usages : 1
		},
		"subclassfeature6" : {
			name : "Empowered Healing",
			source : [["X", 50]],
			minlevel : 6,
			description : desc([
				"Once per turn, when I or an ally in 5 ft roll dice to healing with a spell, I can reroll dice",
				"By spending 1 sorcery point; I can reroll any number of those dice for that spell once"
			]),
			additional : "1 sorcery point"
		},
		"subclassfeature14" : {
			name : "Otherworldy Wings",
			source : [["X", 50]],
			minlevel : 14,
			description : desc([
				"As a bonus action, I can manifest a pair of spectral wings that give me 30 ft fly speed",
				"These wings last until I become incapacitated or I dismiss them as a bonus action"
			]),
			choices : ["eagle", "bat", "dragonfly"],
			choicesNotInMenu : true,
			"eagle" : {
				name : "Otherworldy Wings",
				description : desc([
					"As a bonus action, I manifest a pair of spectral eagle wings, giving me 30 ft fly speed",
					"These wings last until I become incapacitated or I dismiss them as a bonus action"
				])
			},
			"bat" : {
				name : "Otherworldy Wings",
				description : desc([
					"As a bonus action, I manifest a pair of spectral bat wings, giving me 30 ft fly speed",
					"These wings last until I become incapacitated or I dismiss them as a bonus action"
				])
			},
			"dragonfly" : {
				name : "Otherworldy Wings",
				description : desc([
					"As a bonus action, I create a pair of spectral dragonfly wings, giving me 30 ft fly speed",
					"These wings last until I become incapacitated or I dismiss them as a bonus action"
				])
			},
			action : ["bonus action", ""],
			speed : { fly : { spd : 30, enc : 20 } }
		},
		"subclassfeature18" : {
			name : "Unearthly Recovery",
			source : [["X", 50]],
			minlevel : 18,
			description : desc([
				"As a bonus action when I have less than half of my max HP remaining, I can heal myself",
				"I regain a number of HP equal to half my hit point maximum"
			]),
			action : ["bonus action", ""],
			recovery : "long rest",
			usages : 1
		}
	}
});
AddSubClass("sorcerer", "shadow magic", {
	regExpSearch : /^(?=.*(sorcerer|witch))(?=.*shadow).*$/i,
	subname : "Shadow Magic",
	source : [["X", 50]],
	fullname : "Shadow Sorcerer",
	features : {
		"subclassfeature1" : {
			name : "Eyes of the Dark",
			source : [["X", 51]],
			minlevel : 1,
			description : "\n   " + "I gain 120 ft darkvision",
			vision : [["Darkvision", 120]]
		},
		"subclassfeature1.1" : {
			name : "Strength of the Grave",
			source : [["X", 51]],
			minlevel : 1,
			description : desc([
				"When damage reduces me to 0 HP, that isn't radiant damage or a critical hit,",
				"I can make a Charisma save (DC 5 + damage taken) to drop to 1 HP instead"
			]),
			usages : 1,
			recovery : "long rest"
		},
		"subclassfeature3" : {
			name : "Darkness",
			source : [["X", 51]],
			minlevel : 3,
			description : desc([
				"I learn Darkness, which doesn't count against my number of spells known",
				"I can also cast it by spending 2 sorcery points and then I can see through it normally"
			]),
			additional : "2 sorcery points",
			action : ["action", " (2 sorcery points)"],
			spellcastingBonus : {
				name : "Eyes of the Dark",
				spells : ["darkness"],
				selection : ["darkness"]
			}
		},
		"subclassfeature6" : {
			name : "Hound of Ill Omen",
			source : [["X", 51]],
			minlevel : 6,
			description : desc([
				"As a bonus action, I summon a hound within 30 ft of a creature I see within 120 ft",
				"The hound has all the stats of a dire wolf with the following exceptions:",
				"\u2022 It is medium size and counts as a monstrosity not a beast",
				"\u2022 It starts with a number of temporary hit points equal to half my sorcerer level",
				"\u2022 At the start of its turn, it automatically knows where the (hidden) target is",
				"\u2022 It can only move towards and make (opportunity) attack against the target",
				"\u2022 It can move through other creatures and objects as if they were difficult terrain",
				"\u2022 It takes 5 force damage if it ends its turn inside an object",
				"The target has disadvantage on saves vs. my spells while the hound is within 5 ft of it",
				"It disappears if reduced to 0 HP, if the target is reduced to 0 HP, or after 5 minutes"
			]),
			additional : levels.map(function (n) { return n < 6 ? "" : "3 sorcery points; " + Math.floor(n/2) + " temporary HP"; }),
			action : [["bonus action", " (3 sorcery points)"]],
			creaturesAdd : [["Hound of Ill Omen", true]],
			creatureOptions : [{
				name : "Hound of Ill Omen",
				source : [["X", 51]],
				size : 3,
				type : "Monstrosity",
				alignment : "Unaligned",
				ac : 14,
				hp : 37,
				hd : [5, 10],
				speed : "50 ft",
				scores : [17, 15, 15, 3, 12, 7],
				skills : {
					"perception" : 3,
					"stealth" : 4
				},
				senses : "Adv. on Wis (Perception) checks using hearing/smell;\nAt the start of each turn, knows where the target is",
				passivePerception : 13,
				challengeRating : "1",
				proficiencyBonus : 2,
				attacksAction : 1,
				attacks : [{
					name : "Bite",
					ability : 1,
					damage : [2, 6, "piercing"],
					range : "Melee (5 ft)",
					description : "Target must succeed on a DC 13 Strength saving throw or be knocked prone"
				}],
				traits : [{
					name : "Keen Hearing and Smell",
					description : "The hound has advantage on Wisdom (Perception) checks that rely on hearing or smell."
				}, {
					name : "Pack Tactics",
					description : "The hound has advantage on an attack roll against a creature if at least one of the hound's allies is within 5 ft of the creature and the ally isn't incapacitated."
				}],
				features : [{
					name : "Actions",
					description : "The hound can only move towards its targets and make attacks or opportunity attacks against its target."
				}, {
					name : "Temporary Hit Points",
					description : "When the hound is summoned, it gains temporary HP equal to half my sorcerer level."
				}, {
					name : "Shadowy Form",
					description : "The hound can move through other creatures and objects as if they were difficult terrain. It takes 5 force damage if it ends its turn inside an object."
				}, {
					name : "Sign of Ill Omen",
					description : "While the hound is within 5 ft of its target, that target has disadvantage on saving throws versus my spells."
				}],
				header : "Summoned",
				eval : function(prefix, lvl) {
					AddTooltip(prefix + 'Comp.Use.HP.Temp', "The hound of ill omen gains half my sorcerer level as temporary HP when created.");
				},
				removeeval : function(prefix, lvl) {
					AddTooltip(prefix + 'Comp.Use.HP.Temp', "");
				},
				changeeval : function (prefix, lvl) {
					if (!classes.known.sorcerer) return;
					Value(prefix + 'Comp.Use.HP.Temp', Math.floor(classes.known.sorcerer.level / 2));
				}
			}]
		},
		"subclassfeature14" : {
			name : "Shadow Walk",
			source : [["X", 51]],
			minlevel : 14,
			description : desc([
				"As a bonus action when I'm in dim light or darkness, I can teleport up to 120 ft",
				"The destination has to be unoccupied, within line of sight, and in dim light or darkness"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature18" : {
			name : "Umbral Form",
			source : [["X", 51]],
			minlevel : 18,
			additional : "6 sorcery points",
			description : desc([
				"As a bonus action, I transform into a shadow form for 1 minute",
				"While transformed, I have resistance to all damage except force and radiant damage",
				"Also, I can move through other creatures and objects as if they were difficult terrain",
				"I take 5 force damage if I end my turn inside an object",
				"This ends early if I end it as a bonus action, I die, or I'm incapacitated"
			]),
			action : ["bonus action", " (6 sorcery points)"]
		}
	}
});
// Add 2 subclasses for the Warlock
AddSubClass("warlock", "the celestial", {
	regExpSearch : /^(?=.*warlock)(?=.*celestial).*$/i,
	subname : "the Celestial",
	source : [["X", 54]],
	spellcastingExtra : ["cure wounds", "guiding bolt", "flaming sphere", "lesser restoration", "daylight", "revivify", "guardian of faith", "wall of fire", "flame strike", "greater restoration"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Cantrips",
			source : [["X", 54]],
			minlevel : 1,
			description : "\n   " + "I learn the Light and Sacred Flame cantrips, not counting for the number I can know",
			spellcastingBonus : [{
				name : "Bonus Cantrips",
				spells : ["light"],
				selection : ["light"]
			}, {
				name : "Bonus Cantrips",
				spells : ["sacred flame"],
				selection : ["sacred flame"]
			}]
		},
		"subclassfeature1.1" : {
			name : "Healing Light",
			source : [["X", 54]],
			minlevel : 1,
			description : desc([
				"As a bonus action, I can heal a creature I can see within 60 ft by expending dice",
				"I can expend up to my Charisma modifier (min 1) of dice from my pool at a time",
				"The target heals HP equal to the roll of the dice; I regain all expended dice on a long rest"
			]),
			usages : levels.map(function (n) { return (n + 1) + "d6 per "; }),
			usagescalc : "event.value = !classes.known.warlock ? '' : (1 + classes.known.warlock.level) + 'd6';",
			recovery : "long rest",
			action : ["bonus action", ""]
		},
		"subclassfeature6" : {
			name : "Radiant Soul",
			source : [["X", 55]],
			minlevel : 6,
			description : desc([
				"I add my Cha modifier once to the fire or radiant damage of cantrips and spells I cast",
				"This bonus only applies to one target; Also, I have resistance to radiant damage"
			]),
			dmgres : ["Radiant"],
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (v.isSpell && (/fire|radiant/i).test(fields.Damage_Type)) {
							output.extraDmg += What('Cha Mod');
						};
					},
					"Cantrips and spells that fire or radiant damage get my Charisma modifier added to their damage to one target."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "fire|radiant", "Cha", true);
					},
					"Cantrips and spells that fire or radiant damage get my Charisma modifier added to their damage to one target."
				]
			}
		},
		"subclassfeature10" : {
			name : "Celestial Resilience",
			source : [["X", 55]],
			minlevel : 10,
			description : desc([
				"When I finish a short or long rest, I and up to five allies gain temporary hit points",
				"I get my warlock level + Cha mod, while my allies get half my warlock level + Cha mod"
			]),
			additional : levels.map(function (n) { return n < 10 ? "" : "Me: " + n + "+Cha mod; Allies: " + Math.floor(n / 2) + "+Cha mod"; })
		},
		"subclassfeature14" : {
			name : "Searing Vengeance",
			source : [["X", 55]],
			minlevel : 14,
			description : desc([
				"At the start of my turn when I would make a death save, I can instead spring back up",
				"I recover HP equal to half my current HP maximum, and can then stand up if I choose",
				"When I do, creatures of my choice within 30 ft take 2d8 + Cha mod in radiant damage",
				"Damaged creatures are blinded until the end of my current turn"
			]),
			usages : 1,
			recovery : "long rest"
		}
	}
});
AddSubClass("warlock", "the hexblade", { // this code includes contributions by SoilentBrad
	regExpSearch : /^(?=.*hexblade)(?=.*warlock).*$/i,
	subname : "the Hexblade",
	source : [["X", 55]],
	spellcastingExtra : ["shield", "wrathful smite", "blur", "branding smite", "blink", "elemental weapon", "phantasmal killer", "staggering smite", "banishing smite", "cone of cold"],
	features : {
		"subclassfeature1" : {
			name : "Hexblade's Curse",
			source : [["X", 55]],
			minlevel : 1,
			description : desc([
				"As a bonus action, I can curse a creature I can see within 30 ft of me for 1 minute",
				"\u2022 I add my proficiency bonus to damage rolls against the cursed target",
				"\u2022 My attack rolls against the curse target score a critical hit on a roll of 19 and 20",
				"\u2022 If the target dies while cursed, I regain HP equal to my warlock level + Cha mod",
				"The curse ends after 1 minute, when the target dies, I die, or I'm incapacitated"
			]),
			recovery : "short rest",
			usages : 1,
			action : ["bonus action", ""],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (!v.isDC && (/curse/i).test(v.WeaponTextName) && !v.CritChance) {
							v.CritChance = 19;
							fields.Description += (fields.Description ? '; ' : '') + 'Crit on 19-20';
						}
					},
					"If I include the word 'Curse' in the name of a weapon, the automation will treat the attack as being against a target of the Hexblade's Curse: adding my proficiency bonus to the damage and adding the increased chance of a critical hit to the description.",
					19
				],
				atkCalc : [
					function (fields, v, output) {
						if ((/curse/i).test(v.WeaponTextName)) output.extraDmg += output.prof;
					}, ""]
			}
		},
		"subclassfeature1.1" : {
			name : "Hex Warrior",
			source : [["X", 55]],
			minlevel : 1,
			description : desc([
				"I gain proficiency with medium armor, shields, and martial weapons",
				"When I finish a long rest, I can imbue one weapon I touch with my will",
				"Until my next long rest, I can use it with Charisma instead of Strength or Dexterity",
				"I have to be proficient with the weapon and it can't have the two-handed property",
				"This benefit also works with every weapon from Pact of the Blade, with no restriction"
			]),
			armorProfs : [false, true, false, true],
			weaponProfs : [false, true],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (What('Cha Mod') > What(AbilityScores.abbreviations[fields.Mod - 1] + ' Mod') && (v.pactWeapon || v.theWea.pactWeapon || /^(?=.*hexblade)(?!.*((^|[^+-]\b)2|\btwo).?hand(ed)?s?\b).*$/i.test(v.WeaponText))) {
							fields.Mod = 6;
						};
					},
					"If I include the word 'Hexblade' in the name of a weapon that is not two-handed, it gets treated as the weapon I imbued to use Charisma instead of Strength or Dexterity, if my Charisma modifier is higher than the ability it would otherwise use. Alternatively, if I have the Pact of the Blade feature, this will also work for any weapons set to be my Pact Weapon."
				]
			}
		},
		"subclassfeature6" : {
			name : "Accursed Specter",
			source : [["X", 56]],
			minlevel : 6,
			description : desc([
				"When I slay a humanoid, I can curse its soul and have it rise as a specter from its corpse",
				"It has the stats of a specter with temporary hit points equal to half my warlock level",
				"It rolls initiative and has its own turns, obeying my verbal commands",
				"It gains a bonus to attack rolls equal to my Charisma modifier (min +0)",
				"The specter remains until the end of my next long rest, at which point it vanishes"
			]),
			additional : levels.map( function(n) { return n < 6 ? "" : Math.floor(n/2) + " temp HP"; }),
			usages : 1,
			recovery : "long rest",
			creaturesAdd : [["Accursed Specter", true]],
			creatureOptions : [{
				name : "Accursed Specter",
				nameAlt : ["Accursed Spectre"],
				source : [["X", 56]],
				size : 3,
				type : "Undead",
				alignment : "Chaotic Evil",
				ac : 12,
				hp : 22,
				hd : [5, 8],
				speed : "fly 50 ft (hover)",
				scores : [1, 14, 11, 10, 10, 12],
				damage_resistances : "acid; cold; fire; lightning; thunder; bludgeoning, piercing, and slashing from nonmagical weapons",
				damage_immunities : "necrotic, poison",
				condition_immunities : "charmed, exhaustion, grappled, paralyzed, petrified, poisoned, prone, restrained, unconscious",
				senses : "Darkvision 60 ft; While in sunlight, disadv. on Wis (Perception) checks using sight",
				passivePerception : 10,
				languages : "all languages it knew in life, but can't speak",
				challengeRating : "1",
				proficiencyBonus : 2,
				attacksAction : 1,
				attacks : [{
					name : "Life Drain",
					ability : 2,
					damage : [3, 6, "necrotic"],
					range : "Melee (5 ft)",
					description : "DC 10 Con save or HP max reduced by same as damage taken until a long rest",
					modifiers : ["max(oCha|0)", ""],
					abilitytodamage : false,
					tooltip : "A target of the specter's life drain must succeed on a DC 10 Constitution saving throw or its hit point maximum is reduced by an amount equal to the damage taken. This reduction lasts until the creature finishes a long rest. The target dies if this effect reduces its hit point maximum to 0."
				}],
				traits : [{
					name : "Incorporeal Movement",
					description : "The specter can move through other creatures and objects as if they were difficult terrain. It takes 5 (1d10) force damage if it ends its turn inside an object."
				}, {
					name : "Sunlight Sensitivity",
					description : "While in sunlight, the specter has disadvantage on attack rolls, as well as on Wisdom (Perception) checks that rely on sight."
				}, {
					name : "Life Drain",
					description : "A target of the specter's life drain must succeed on a DC 10 Constitution saving throw or its hit point maximum is reduced by an amount equal to the damage taken. This reduction lasts until the creature finishes a long rest. The target dies if this effect reduces its hit point maximum to 0."
				}],
				features : [{
					name : "Bound Spirit",
					description : "The specter obeys my verbal commands and remains in my service until the end of my next long rest, at which point it vanishes to the afterlife. It acts on its own turn with its own initiative."
				}],
				header : "Bound Spirit",
				eval : function(prefix) {
					AddTooltip(prefix + 'Comp.Use.HP.Temp', "The accursed specter gains half my warlock level as temporary HP when created.");
				},
				removeeval : function(prefix) {
					AddTooltip(prefix + 'Comp.Use.HP.Temp', "");
				},
				changeeval : function (prefix, newLvl) {
					if (!classes.known.warlock) return;
					Value(prefix + 'Comp.Use.HP.Temp', Math.floor(classes.known.warlock.level / 2));
				}
			}]
		},
		"subclassfeature10" : {
			name : "Armor of Hexes",
			source : [["X", 56]],
			minlevel : 10,
			description : desc([
				"As a reaction when a Hexblade's Curse recipient hits me with an attack, I can roll a d6",
				"On a result of 4 or higher, the attacks misses me instead, regardless of its d20 roll"
			])
		},
		"subclassfeature14" : {
			name : "Master of Hexes",
			source : [["X", 56]],
			minlevel : 14,
			description : desc([
				"When the target of my Hexblade's Curse dies, I can curse another I can see within 30 ft",
				"I can't do this while incapacitated and I don't regain HP from the death of the previous"
			])
		}
	}
});

// Add Warlock Invocations
AddWarlockInvocation("Aspect of the Moon (prereq: Pact of the Tome)", {
	name : "Aspect of the Moon",
	description : "\n   " + "I don't need sleep nor can be forced to by any means; I can rest while doing light activity",
	source : [["X", 56], ["UA:RCO", 5]],
	submenu : "[improves Pact of the Tome]",
	prereqeval : function(v) { return GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the tome'; },
	savetxt : { text : ["Nothing can force me to sleep"] }
});
AddWarlockInvocation("Cloak of Flies (prereq: level 5 warlock)", {
	name : "Cloak of Flies",
	description : desc([
		"As a bonus action, I can surround myself with a 5-ft radius magical aura of buzzing flies",
		"It lasts until I'm incapacitated or dismiss it as a bonus action; Total cover block the aura",
		"The aura grants me adv. on Cha (Intimidation), but disadv. on all other Cha checks",
		"Creatures starting their turn in the aura take my Cha mod (min 0) in poison damage"
	]),
	source : [["X", 56], ["UA:RCO", 5]],
	submenu : "[warlock level  5+]",
	prereqeval : function(v) { return classes.known.warlock.level >= 5; },
	recovery : "short rest",
	usages : 1,
	action : ["bonus action", " (start/stop)"]
});
AddWarlockInvocation("Eldritch Smite (prereq: level 5 warlock, Pact of the Blade)", {
	name : "Eldritch Smite",
	description : desc([
		"Once per turn when I hit a creature with my pact weapon, I can empower the strike",
		"By expending a warlock spell slot, the creature takes extra damage and is knocked prone",
		"It takes 1d8 force damage and another 1d8 force damage per level of the spell slot",
		"The target is only knocked prone if it is Huge or smaller"
	]),
	source : [["X", 56]],
	submenu : "[improves Pact of the Blade]",
	prereqeval : function(v) { return classes.known.warlock.level >= 5 && GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the blade'; }
});
AddWarlockInvocation("Ghostly Gaze (prereq: level 7 warlock)", {
	name : "Ghostly Gaze",
	description : desc([
		"As an action, I can gain darkvision, and the ability to see through solid objects, out to 30 ft",
		"Objects appear ghostly to me; This lasts up to 1 minute, while I'm concentrating on this"
	]),
	source : [["X", 56]],
	submenu : "[warlock level  7+]",
	prereqeval : function(v) { return classes.known.warlock.level >= 7; },
	recovery : "short rest",
	usages : 1,
	action : ["action", ""]
});
AddWarlockInvocation("Gift of the Depths (prereq: level 5 warlock)", {
	name : "Gift of the Depths",
	description : desc([
		"I can breathe underwater and I have a swim speed equal to my walking speed",
		"Once per long rest, I can cast Water Breathing without using a spell slot (PHB 287)"
	]),
	source : [["X", 57], ["UA:RCO", 6]],
	submenu : "[warlock level  5+]",
	spellcastingBonus : {
		name : "Gift of the Depths",
		spells : ["water breathing"],
		selection : ["water breathing"],
		firstCol : 'oncelr'
	},
	prereqeval : function(v) { return classes.known.warlock.level >= 5; },
	speed : { swim : { spd : "walk", enc : "walk" } }
});
AddWarlockInvocation("Gift of the Ever-Living Ones (prereq: Pact of the Chain)", {
	name : "Gift of the Ever-Living Ones",
	description : "\n   " + "When I regain HP while my familiar is within 100 ft, I regain the max the dice can roll",
	source : [["X", 57], ["UA:RCO", 6]],
	submenu : "[improves Pact of the Chain]",
	prereqeval : function(v) { return GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the chain'; }
});
AddWarlockInvocation("Grasp of Hadar (prereq: Eldritch Blast cantrip)", {
	name : "Grasp of Hadar",
	description : desc("Once per turn when my Eldritch Blast hits a creature, I can move it 10 ft closer to me"),
	source : [["X", 57], ["UA:RCO", 6]],
	submenu : "[improves Eldritch Blast]",
	prereqeval : function(v) { return v.hasEldritchBlast; },
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == 'eldritch blast') fields.Description += '; Target moved 10 ft to me';
			},
			"When I hit a creature with my Eldritch Blast cantrip once or more times in a turn, I can move it in a straight line 10 ft closer to me."
		]
	}
});
AddWarlockInvocation("Improved Pact Weapon (prereq: Pact of the Blade)", {
	name : "Improved Pact Weapon",
	description : desc([
		"I can use any pact weapon I create as my spellcasting focus for warlock spells",
		"Any pact weapon I create is a +1 magic weapon, if it isn't already a +1 magic weapon",
		"I can now also conjure a shortbow, longbow, or light or heavy crossbow as my pact weapon"
	]),
	source : [["X", 57]],
	submenu : "[improves Pact of the Blade]",
	prereqeval : function(v) { return GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the blade'; },
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if ((/^(shortbow|longbow|light crossbow|heavy crossbow)$/).test(v.baseWeaponName) && (/\bpact\b/i).test(v.WeaponTextName)) {
					v.pactWeapon = true;
				}
				// Test if this is a pact weapon, has no + bonus from somewhere else, and doesn't already have a improved pact weapon bonus
				if (v.pactWeapon && !output.magic) {
					var bContinue = true;
					// Now test if this isn't a weaponOptions addition with a static + bonus set to the modifier fields
					if (v.theWea && v.theWea.isMagicWeapon && v.theWea.modifiers) {
						// Test the first two modifiers to see if both offer a +1 or more. Returns `true` if one contains no numbers or is less than the improved pact weapon bonus
						var bContinue = v.theWea.modifiers.slice(0, 2).some(function (n) {
							if (!n || !/\d/.test(n)) {
								var nmbr = 0;
							} else if (isNaN(n)) {
								var nmbr = n.match(/(^|\+|-)\d+\b/g);
								nmbr = !nmbr ? 0 : nmbr.reduce(function(a, b) {return Number(a) + Number(b)});
							} else {
								var nmbr = Number(n);
							}
							return nmbr < 1;
						});
					}
					// if the continue boolean wasn't set to false, we can proceed
					if (bContinue) {
						v.pactMag = 1;
						output.magic = 1;
					}
				};
			},
			"If I include the word 'Pact' in a the name of a melee weapon, shortbow, longbow, light crossbow, or heavy crossbow, it will be treated as my Pact Weapon.\n \u2022 If my Pact Weapon doesn't already include a magical bonus in its name and is not a magic weapon with at least a +1 bonus, the calculation will add +1 to its To Hit and Damage.",
			290
		],
		atkAdd : [
			function (fields, v) {
				if ((/^(shortbow|longbow|light crossbow|heavy crossbow)$/).test(v.baseWeaponName) && (/\bpact\b/i).test(v.WeaponTextName)) {
					v.pactWeapon = true;
				};
			}, "", 90]
	}
});
AddWarlockInvocation("Lance of Lethargy (prereq: Eldritch Blast cantrip)", {
	name : "Lance of Lethargy",
	description : desc([
		"Once per turn when my Eldritch Blast hits a creature, I can reduce its speed by 10 ft",
		"This speed reduction lasts until the end of my next turn"
	]),
	source : [["X", 57]],
	submenu : "[improves Eldritch Blast]",
	prereqeval : function(v) { return v.hasEldritchBlast; },
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == 'eldritch blast') fields.Description += '; 1 target -10 ft speed';
			},
			"Once on each of my turns when I hit a creature with my Eldritch Blast cantrip, I can reduce its speed by 10 ft until the end of my next turn."
		]
	}
});
AddWarlockInvocation("Maddening Hex (prereq: level 5 warlock, Hex spell or warlock feature that curses)", {
	name : "Maddening Hex",
	description : desc([
		"As a bonus action, I cause pain around a target hexed by me that I can see within 30 ft",
		"It and any of my choice I can see in 5 ft of it take my Cha mod (min 1) in psychic damage",
		"The Hex spell and all of my warlock features that curse are considered a hex for this"
	]),
	source : [["X", 57]],
	submenu : "[improves Hex spell or warlock feature that curses]",
	prereqeval : function(v) { return classes.known.warlock.level >= 5 && (isSpellUsed('hex', true) || (/hexblade/).test(classes.known.warlock.subclass)); },
	action : ["bonus action", ""]
});
AddWarlockInvocation("Relentless Hex (prereq: level 7 warlock, Hex spell or warlock feature that curses)", {
	name : "Relentless Hex",
	description : desc([
		"As a bonus action, I can teleport to a target hexed by me that I can see within 30 ft",
		"I teleport up to 30 ft to an unoccupied space that I can see within 5 ft of the target"
	]),
	source : [["X", 57]],
	submenu : "[improves Hex spell or warlock feature that curses]",
	prereqeval : function(v) { return classes.known.warlock.level >= 7 && (isSpellUsed('hex', true) || (/hexblade/).test(classes.known.warlock.subclass)); },
	action : ["bonus action", ""]
});
AddWarlockInvocation("Shroud of Shadow (prereq: level 15 warlock)", {
	name : "Shroud of Shadow",
	description : "\n   " + "I can cast Invisibility at will, without using spell slots (PHB 254)",
	source : [["X", 57], ["UA:RCO", 6]],
	submenu : "[warlock level 15+]",
	spellcastingBonus : {
		name : "Shroud of Shadow",
		spells : ["invisibility"],
		selection : ["invisibility"],
		firstCol : 'atwill'
	},
	prereqeval : function(v) { return classes.known.warlock.level >= 15; },
	spellChanges : {
		"invisibility" : {
			description : "1 crea invisible; attacking/casting makes the crea visible; anything worn/carried also invisible",
			changes : "With the Shroud of Shadow invocation I can cast Invisibility at will, but when I do so I am unable to cast it using a higher level spell slot."
		}
	}
});
AddWarlockInvocation("Tomb of Levistus (prereq: level 5 warlock)", {
	name : "Tomb of Levistus",
	description : desc([
		"As a reaction when I take damage, I can entomb myself in ice until the end of my turn",
		"During, I get 10 temp. HP per warlock level, which I use to absorb the triggering damage",
		"After, till the ice is gone, I also get vulnerability to fire, 0 speed, and am incapacitated"
	]),
	source : [["X", 57], ["UA:RCO", 6]],
	submenu : "[warlock level  5+]",
	prereqeval : function(v) { return classes.known.warlock.level >= 5; },
	recovery : "short rest",
	usages : 1,
	action : ["reaction", ""],
	additional : levels.map( function(n) { return (n * 10) + " temp HP"; })
});
AddWarlockInvocation("Trickster's Escape (prereq: level 7 warlock)", {
	name : "Trickster's Escape",
	description : "\n   " + "Once per long rest, I can cast Freedom of Movement on myself without using a spell slot",
	source : [["X", 57], ["UA:RCO", 7]],
	submenu : "[warlock level  7+]",
	spellcastingBonus : {
		name : "Trickster's Escape",
		spells : ["freedom of movement"],
		selection : ["freedom of movement"],
		firstCol : 'oncelr'
	},
	prereqeval : function(v) { return classes.known.warlock.level >= 7; },
	spellChanges : {
		"freedom of movement" : {
			range : "Self",
			description : "Magic can't reduce my speed, paralyze or restrain me; I can use 5 ft to escape nonmagical restrains",
			changes : "With the Trickster's Escape invocation I can cast Freedom of Movement, but only on myself."
		}
	}
});

// Add 1 subclass for the Wizard
AddSubClass("wizard", "war magic", {
	regExpSearch : /^(?=.*war)(?=.*(wizard|magic|mage)).*$/i,
	subname : "War Magic",
	source : [["X", 59]],
	fullname : "War Mage",
	features : {
		"subclassfeature2" : { //has to be identical to a feature named in the ClassList
			name : "Arcane Deflection",
			source : [["X", 59]],
			minlevel : 2,
			description : desc([
				"As a reaction when I'm hit by an attack, I can gain +2 to my AC against that attack",
				"As a reaction when I fail a save, I can gain +4 bonus to that saving throw",
				"After I do either, I can't cast spells other than cantrips until the end of my next turn"
			]),
			action : ["reaction", ""]
		},
		"subclassfeature2.1" : {
			name : "Tactical Wit",
			source : [["X", 60]],
			minlevel : 2,
			description : "\n   " + "I gain a bonus to my initiative rolls equal to my Intelligence modifier",
			addMod : { type : "skill", field : "Init", mod : "max(Int|0)", text : "I can add my Intelligence modifier to initiative rolls." }
		},
		"subclassfeature6" : {
			name : "Power Surge",
			source : [["X", 60]],
			minlevel : 6,
			description : desc([
				"I have a pool of stored power surges that I can use to empower my damaging spells",
				"I gain a power surge whenever I successfully end a spell with Dispel Magic or Counterspell",
				"This pool can store a number of power surges equal to my Intelligence modifier (min 1)",
				"It resets to 1 power surge after a long rest or when I have 0 surges left after a short rest",
				"When I deal damage with a wizard spell, I can spend a power surge to do extra damage",
				"One target takes half my wizard level in force damage; I can do this only once per turn"
			]),
			usages : "Resets to 1 after ",
			usagescalc : "event.value = !event.value || event.value == 'Resets to 1 after ' ? 1 : event.value;",
			recovery : "long rest",
			additional : levels.map( function(n) { return n < 6 ? "" : "+" + Math.floor(n/2) + " force damage"; })
		},
		"subclassfeature10" : {
			name : "Durable Magic",
			source : [["X", 60]],
			minlevel : 10,
			description : "\n   " + "While I'm maintaining concentration on a spell, I gain +2 to AC and all saving throws"
		},
		"subclassfeature14" : {
			name : "Deflecting Shroud",
			source : [["X", 60]],
			minlevel : 14,
			description : desc([
				"When I use my Arcane Deflection feature, magical energy arcs from me to creatures",
				"Up to 3 targets I can see within 60 ft of me take half my wizard level in force damage"
			]),
			additional : levels.map( function(n) { return n < 14 ? "" : Math.floor(n/2) + " force damage"; })
		}
	}
});

// Add feats
FeatsList["bountiful luck"] = {
	name : "Bountiful Luck",
	source : [["X", 73]],
	prerequisite : "Being a Halfling",
	prereqeval : function(v) { return CurrentRace.known.indexOf('halfling') !== -1; },
	descriptionFull : "Your people have extraordinary luck, which you have learned to mystically lend to your companions when you see them falter. You're not sure how you do it; you just wish it, and it happens. Surely a sign of fortune's favor!\n   When an ally you can see within 30 feet of you rolls a 1 on the d20 for an attack roll, an ability check, or a saving throw, you can use your reaction to let the ally reroll the die. The ally must use the new roll\n   When you use this ability, you can't use your Lucky racial trait before the end of your next turn.",
	description : "When an ally I can see within 30 ft of me rolls a 1 on an attack roll, an ability check, or a saving throw, I can use my reaction to let the ally reroll the die. The ally must use the new roll. When I use this, I can't use my racial Lucky trait until the end of my next turn.",
	action : ["reaction", ""]
};
FeatsList["dragon fear"] = {
	name : "Dragon Fear",
	source : [["X", 74]],
	prerequisite : "Being a Dragonborn",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dragonborn') !== -1; },
	descriptionFull : "When angered, you radiate menace. You gain the following benefits:\n \u2022 Increase your Strength, Constitution, or Charisma score by 1, to a maximum of 20.\n \u2022 Instead of exhaling destructive energy, you can expend a use of your Breath Weapon trait to roar, forcing each creature of your choice within 30 feet of you to make a Wisdom saving throw (DC 8 + your proficiency bonus + your Charisma modifier). A target automatically succeeds on the save if it can't hear or see you. On a failed save, a target becomes frightened of you for 1 minute. If the frightened target takes any damage, it can repeat the saving throw, ending the effect on itself on a success.",
	calculate : "event.value = 'I can use my Breath Weapon to roar instead. Chosen creatures within 30 ft that see and hear me must make a DC ' + (8 + Number(How('Proficiency Bonus')) + Number(What('Cha Mod'))) + ' Wis save (8 + Prof Bonus + Cha mod) or be frightened of me for 1 min. A target can repeat the save whenever it takes damage. [+1 Str, Con, or Cha]';",
	scorestxt : "+1 Strength, Constitution, or Charisma",
	action : [['action', 'Breath Weapon or Dragon Fear', 'Breath Weapon']]
};
FeatsList["dragon hide"] = {
	name : "Dragon Hide",
	source : [["X", 74]],
	prerequisite : "Being a Dragonborn",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dragonborn') !== -1; },
	descriptionFull : "You manifest scales and claws reminiscent of your draconic ancestors. You gain the following benefits:\n \u2022 Increase your Strength, Constitution, or Charisma score by 1, to a maximum of 20.\n \u2022 Your scales harden. While you aren't wearing armor, you can calculate your AC as 13 + your Dexterity modifier. You can use a shield and still gain this benefit.\n \u2022 You grow retractable claws from the tips of your fingers. Extending or retracting the claws requires no action. The claws are natural weapons, which you can use to make unarmed strikes. If you hit with them, you deal slashing damage equal to 1d4 + your Strength modifier, instead of the normal bludgeoning damage for an unarmed strike.",
	description : "I gain retractable claws that I can retract or extend, requiring no action. While extended, my unarmed strikes deal 1d4 slashing damage. My scales harden, giving me an AC of 13 + Dexterity modifier + shield when I'm not wearing armor. [+1 Str, Con, or Cha]",
	scorestxt : "+1 Strength, Constitution, or Charisma",
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*(retractable|dragon))(?=.*claw).*$/i,
		name : "Retractable Claws",
		source : [["X", 74]],
		damage : [1, 4, "slashing"],
		selectNow : true
	}],
	armorOptions : [{
		regExpSearch : /^(?=.*(dragon|draconic|scaly))(?=.*(hide|skin|scales|resilience)).*$/i,
		name : "Dragon Hide",
		source : [["X", 74]],
		ac : 13,
		selectNow : true
	}]
};
FeatsList["drow high magic"] = {
	name : "Drow High Magic",
	source : [["X", 74]],
	prerequisite : "Being a Drow (Dark Elf)",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dark elf') !== -1; },
	descriptionFull : "You learn more of the magic typical of dark elves. You learn the Detect Magic spell and can cast it at will, without expending a spell slot. You also learn Levitate and Dispel Magic, each of which you can cast once without expending a spell slot. You regain the ability to cast those two spells in this way when you finish a long rest. Charisma is your spellcasting ability for all three spells.",
	description : "I can cast Detect Magic at will, without expending a spell slot. I can also cast Levitate and Dispel Magic without expending a spell slot, but each only once per long rest. Charisma is my spellcasting ability for these three spells.",
	spellcastingBonus : [{
		name : "At will",
		spellcastingAbility : 6,
		spells : ["detect magic"],
		selection : ["detect magic"],
		firstCol : 'atwill'
	}, {
		name : "Once per long rest",
		spells : ["levitate"],
		selection : ["levitate"],
		firstCol : 'oncelr'
	}, {
		name : "Once per long rest",
		spells : ["dispel magic"],
		selection : ["dispel magic"],
		firstCol : 'oncelr'
	}]
};
FeatsList["dwarven fortitude"] = {
	name : "Dwarven Fortitude",
	source : [["X", 74]],
	prerequisite : "Being a Dwarf",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dwarf') !== -1; },
	descriptionFull : "You have the blood of dwarf heroes flowing through your veins. You gain the following benefits:\n \u2022 Increase your Constitution score by 1, to a maximum of 20.\n \u2022 Whenever you take the Dodge action in combat, you can spend one Hit Die to heal yourself. Roll the die, add your Constitution modifier, and regain a number of hit points equal to the total (minimum of 1).",
	description : "Whenever I take the Dodge action in combat, I can spend one Hit Die to heal myself. I roll the die, add my Constitution modifier, and regain a number of hit points equal to the total (minimum of 1). [+1 Constitution]",
	scores : [0, 0, 1, 0, 0, 0]
};
FeatsList["elven accuracy"] = {
	name : "Elven Accuracy",
	source : [["X", 74]],
	prerequisite : "Being an Elf or a Half-Elf",
	prereqeval : function(v) { return (/elf|eladrin|avariel|grugach|shadar-kai/i).test(CurrentRace.known); },
	descriptionFull : "The accuracy of elves is legendary, especially that of elf archers and spellcasters. You have uncanny aim with attacks that rely on precision rather than brute force. You gain the following benefits:\n \u2022 Increase your Dexterity, Intelligence, Wisdom, or Charisma score by 1, to a maximum of 20.\n \u2022 Whenever you have advantage on an attack roll using Dexterity, Intelligence, Wisdom, or Charisma, you can reroll one of the dice once.",
	description : "Whenever I have advantage on an attack roll that uses Dexterity, Intelligence, Wisdom, or Charisma, I can reroll one of the dice once. [+1 Dexterity, Intelligence, Wisdom, or Charisma]",
	scorestxt : "+1 Dexterity, Intelligence, Wisdom, or Charisma"
};
FeatsList["fade away"] = {
	name : "Fade Away",
	source : [["X", 74]],
	prerequisite : "Being a Gnome",
	prereqeval : function(v) { return CurrentRace.known.indexOf('gnome') !== -1; },
	descriptionFull : "Your people are clever, with a knack for illusion magic. You have learned a magical trick for fading away when you suffer harm. You gain the following benefits:\n \u2022 Increase your Dexterity or Intelligence score by 1, to a maximum of 20.\n \u2022 Immediately after you take damage, you can use a reaction to magically become invisible until the end of your next turn or until you attack, deal damage, or force someone to make a saving throw. Once you use this ability, you can't do so again until you finish a short or long rest.",
	description : "As a reaction when I take damage, I can magically become invisible until the end of my next turn or until I attack, deal damage, or force someone to make a saving throw. Once I do this, I can't do so again until I finish a short rest. [+1 Dexterity or Intelligence]",
	scorestxt : "+1 Dexterity or Intelligence",
	action : ["reaction", ""],
	usages : 1,
	recovery : "short rest"
};
FeatsList["fey teleportation"] = { // this code includes contributions by SoilentBrad
	name : "Fey Teleportation",
	source : [["X", 74]],
	prerequisite : "Being a High Elf",
	prereqeval : function(v) { return CurrentRace.known.indexOf('high elf') !== -1; },
	descriptionFull : "Your study of high elven lore has unlocked fey power that few other elves possess, except your eladrin cousins. Drawing on your fey ancestry, you can momentarily stride through the Feywild to shorten your path from one place to another. You gain the following benefits:\n \u2022 Increase your Intelligence or Charisma score by 1, to a maximum of 20.\n \u2022 You learn to speak, read, and write Sylvan.\n \u2022 You learn the Misty Step spell and can cast it once without expending a spell slot. You regain the ability to cast it in this way when you finish a short or long rest. Intelligence is your spellcasting ability for this spell.",
	description : "I can cast Misty Step without using a spell slot. I can do so once per short rest. Intelligence is my spellcasting ability for this spell. I also learn to speak, read, and write Sylvan. [+1 Intelligence or Charisma]",
	scorestxt : "+1 Intelligence or Charisma",
	spellcastingBonus : {
		name : "Once per short rest",
		spellcastingAbility : 4,
		spells : ["misty step"],
		selection : ["misty step"],
		firstCol : 'oncesr'
	},
	languageProfs : ["Sylvan"],
	usages : 1,
	recovery : "short rest"
};
FeatsList["flames of phlegethos"] = {
	name : "Flames of Phlegethos",
	source : [["X", 74]],
	prerequisite : "Being a Tiefling",
	prereqeval : function(v) { return CurrentRace.known.indexOf('tiefling') !== -1; },
	descriptionFull : "You learn to call on hellfire to serve your commands. You gain the following benefits:\n \u2022 Increase your Intelligence or Charisma score by 1, to a maximum of 20.\n \u2022 When you roll fire damage for a spell you cast, you can reroll any roll of 1 on the fire damage dice, but you must use the new roll, even if it is another 1.\n \u2022 Whenever you cast a spell that deals fire damage, you can cause flames to wreathe you until the end of your next turn. The flames don't harm you or your possessions, and they shed bright light out to 30 feet and dim light for an additional 30 feet. While the flames are present, any creature within 5 feet of you that hits you with a melee attack takes 1d4 fire damage.",
	description : "When I cast a fire damage spell, I can reroll any 1 on fire damage dice once. I then sheathe myself in flame until my next turn ends. These shed bright light in 30 ft, dim light in 30 ft and cause any within 5 ft that hit me in melee to take 1d4 fire damage. [+1 Int or Cha]",
	scorestxt : "+1 Intelligence or Charisma"	
};
FeatsList["infernal constitution"] = {
	name : "Infernal Constitution",
	source : [["X", 75]],
	prerequisite : "Being a Tiefling",
	prereqeval : function(v) { return CurrentRace.known.indexOf('tiefling') !== -1; },
	descriptionFull : "Fiendish blood runs strong in you, unlocking a resilience akin to that possessed by some fiends. You gain the following benefits:\n \u2022 Increase your Constitution score by 1, to a maximum of 20.\n \u2022 You have resistance to cold and poison damage.\n \u2022 You have advantage on saving throws against being poisoned.",
	description : "I have resistance to cold and poison damage and I have advantage on saving throws against being poisoned.\n[+1 Constitution]",
	scores : [0, 0, 1, 0, 0, 0],
	dmgres : ["Cold", "Poison"],
	savetxt : { adv_vs : ["poison"] }
};
FeatsList["orcish fury"] = {
	name : "Orcish Fury",
	source : [["X", 75]],
	prerequisite : "Being a Half-Orc",
	prereqeval : function(v) { return (/^(?=.*half)(?=.*orc).*$/i).test(CurrentRace.known); },
	descriptionFull : "Your fury burns tirelessly. You gain the following benefits:\n \u2022 Increase your Strength or Constitution score by 1, to a maximum of 20.\n \u2022 When you hit with an attack using a simple or martial weapon, you can roll one of the weapon's damage dice an additional time and add it as extra damage of the weapon's damage type. Once you use this ability, you can't use it again until you finish a short or long rest.\n \u2022 Immediately after you use your Relentless Endurance trait, you can use your reaction to make one weapon attack.",
	description : "Once per short rest, I can roll an extra damage die for an attack with a simple or martial weapon. In addition, Immediately after I use my Relentless Endurance trait, I can use my reaction to make one weapon attack. [+1 Strength or Constitution]",
	scorestxt : "+1 Strength or Constitution",
	action : ["reaction", " (after Relentless Endurance)"],
	usages : 1,
	recovery : "short rest",
	additional : "extra damage"
};
FeatsList["prodigy"] = {
	name : "Prodigy",
	source : [["X", 75]],
	prerequisite : "Being a Half-Elf, Half-Orc, or Human",
	prereqeval : function(v) { return (/human|^(?=.*half)(?=.*(elf|orc)).*$/i).test(CurrentRace.known); },
	descriptionFull : "You have a knack for learning new things. You gain the following benefits:\n \u2022 You gain one skill proficiency of your choice, one tool proficiency of your choice, and fluency in one language of your choice.\n \u2022 Choose one skill in which you have proficiency. You gain expertise with that skill, which means your proficiency bonus is doubled for any ability check you make with it. The skill you choose must be one that isn't already benefiting from a feature, such as Expertise, that doubles your proficiency bonus.",
	description : "I gain proficiency with one skill of my choice and expertise with it, or expertise with another skill of my choice that I'm already proficient with. I also gain proficiency with one tool of my choice and fluency in one language of my choice.",
	skillstxt : "Proficiency with any one skill and Expertise with any one skill that you are already proficient with",
	languageProfs : [1],
	toolProfs : [["Any tool", 1]]
};
FeatsList["second chance"] = {
	name : "Second Chance",
	source : [["X", 75]],
	prerequisite : "Being a Halfling",
	prereqeval : function(v) { return CurrentRace.known.indexOf('halfling') !== -1; },
	descriptionFull : "Fortune favors you when someone tries to strike you. You gain the following benefits:\n \u2022 Increase your Dexterity, Constitution, or Charisma score by 1, to a maximum of 20.\n \u2022 When a creature you can see hits you with an attack roll, you can use your reaction to force that creature to reroll. Once you use this ability, you can't use it again until you roll initiative at the start of combat or until you finish a short or long rest.",
	description : "When a creature I can see hits me with an attack roll, I can use my reaction to force that creature to reroll. Once I use this ability, I can't do so again until I roll initiative at the start of combat or I finish a short rest. [+1 Dexterity, Constitution, or Charisma]",
	scorestxt : "+1 Dexterity, Constitution, or Charisma",
	action : ["reaction", ""],
	usages : 1,
	recovery : "Combat"
};
FeatsList["squat nimbleness"] = {
	name : "Squat Nimbleness",
	source : [["X", 75]],
	prerequisite : "Being a Dwarf or a small race",
	prereqeval : function(v) { return (/dwarf/i).test(CurrentRace.known) || tDoc.getField('Size Category').currentValueIndices === 4; },
	descriptionFull : "You are uncommonly nimble for your race. You gain the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 Increase your walking speed by 5 feet.\n \u2022 You gain proficiency in the Acrobatics or Athletics skill (your choice).\n \u2022 You have advantage on any Strength (Athletics) or Dexterity (Acrobatics) check you make to escape from being grappled.",
	description : "My walking speed increases by 5 ft. I gain proficiency in either the Acrobatics or the Athletics skill. I have advantage on Dexterity (Acrobatics) and Strength (Athletics) checks I make to escape from being grappled. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity",
	skillstxt : "Acrobatics or Athletics",
	speed : { walk : {spd : "+5", enc : "+5" } }
};
FeatsList["wood elf magic"] = {
	name : "Wood Elf Magic",
	source : [["X", 75]],
	prerequisite : "Being a Wood Elf",
	prereqeval : function(v) { return CurrentRace.known.indexOf('wood elf') !== -1; },
	descriptionFull : "You learn the magic of the primeval woods, which are revered and protected by your people. You learn one druid cantrip of your choice. You also learn the Longstrider and Pass Without Trace spells, each of which you can cast once without expending a spell slot. You regain the ability to cast these two spells in this way when you finish a long rest. Wisdom is your spellcasting ability for all three spells.",
	description : "I learn a druid cantrip. In addition, I can cast Longstrider and Pass Without Trace, without expending a spell slot, but each only once per long rest. Wisdom is my spellcasting ability for these three spells.",
	spellcastingBonus : [{
		name : "Druid Cantrip",
		spellcastingAbility : 5,
		"class" : "druid",
		level : [0, 0],
		firstCol : 'atwill'
	}, {
		name : "Once per long rest",
		spells : ["longstrider"],
		selection : ["longstrider"],
		firstCol : 'oncelr'
	}, {
		name : "Once per long rest",
		spells : ["pass without trace"],
		selection : ["pass without trace"],
		firstCol : 'oncelr'
	}]
};

// Then add the new spells from XGtE (contains contributions by SoilentBrad)
SpellsList["catnap"] = {
	name : "Catnap",
	classes : ["artificer", "bard", "sorcerer", "wizard"],
	source : [["X", 151]],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "S,M",
	compMaterial : "A pinch of sand",
	duration : "10 min",
	description : "3+1/SL willing crea unconscious for 10 min to gain benefits of short rest; Ends if dmg or 1 a to wake",
	descriptionFull : "You make a calming gesture, and up to three willing creatures of your choice that you can see within range fall unconscious for the spell's duration. The spell ends on a target early if it takes damage or someone uses an action to shake or slap it awake. If a target remains unconscious for the full duration, that target gains the benefit of a short rest, and it can't be affected by this spell again until it finishes a long rest." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, you can target one additional willing creature for each slot level above 3rd."
};
SpellsList["cause fear"] = {
	name : "Cause Fear",
	classes : ["warlock", "wizard"],
	source : [["X", 151]],
	level : 1,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "1+1/SL crea (not construct/undead), each max 30 ft apart, save or frightened; save end of each turn",
	descriptionFull : "You awaken the sense of mortality in one creature you can see within range. A construct or an undead is immune to this effect. The target must succeed on a Wisdom saving throw or become frightened of you until the spell ends. The frightened target can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st. The creatures must be within 30 feet of each other when you target them."
};
SpellsList["ceremony"] = {
	name : "Ceremony",
	classes : ["cleric", "paladin"],
	source : [["X", 151]],
	ritual : true,
	level : 1,
	school : "Abjur",
	time : "1 h",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "25 gp worth of powdered silver, which the spell consumes",
	duration : "Instantaneous",
	description : "Perform religious ceremony on target(s) within 10 ft throughout the casting; see book (25gp cons.)",
	descriptionFull : "You perform a special religious ceremony that is infused with magic. When you cast the spell, choose one of the following rites, the target of which must be within 10 feet of you throughout the casting." + "\n   " + toUni("Atonement") + ": You touch one willing creature whose alignment has changed, and you make a DC 20 Wisdom (Insight) check. On a successful check, you restore the target to its original alignment." + "\n   " + toUni("Bless Water") + ": You touch one vial of water and cause it to become holy water." + "\n   " + toUni("Coming of Age") + ": You touch one humanoid who is a young adult. For the next 24 hours, whenever the target makes an ability check, it can roll a d4 and add the number rolled to the ability check. A creature can benefit from this rite only once." + "\n   " + toUni("Dedication") + ": You touch one humanoid who wishes to be dedicated to your god's service. For the next 24 hours, whenever the target makes a saving throw, it can roll a d4 and add the number rolled to the save. A creature can benefit from this rite only once." + "\n   " + toUni("Funeral Rite") + ": You touch one corpse, and for the next 7 days, the target can't become undead by any means short of a wish spell." + "\n   " + toUni("Wedding") + ": You touch adult humanoids willing to be bonded together in marriage. For the next 7 days, each target gains a +2 bonus to AC while they are within 30 feet of each other. A creature can benefit from this rite again only if widowed."
};
SpellsList["chaos bolt"] = {
	name : "Chaos Bolt",
	classes : ["sorcerer"],
	source : [["X", 151], ["G", 67]],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Instantaneous",
	description : "Spell atk 2d8+1d6+1d6/SL dmg, d8s set dmg type, see B; double on d8s: new atk vs. crea in 30 ft",
	descriptionShorter : "Spell atk 2d8+1d6+1d6/SL dmg, d8s set type, see B; double on d8s: new atk vs. crea in 30 ft",
	descriptionFull : "You hurl an undulating, warbling mass of chaotic energy at one creature in range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 + 1d6 damage. Choose one of the d8s. The number rolled on that die determines the attack's damage type, as shown below." + "\n\n" + toUni("d8") + "\t" + toUni("Damage Type") + "\n  1\tAcid" + "\n  2\tCold" + "\n  3\tFire" + "\n  4\tForce" + "\n  5\tLightning" + "\n  6\tPoison" + "\n  7\tPsychic" + "\n  8\tThunder" + "\n\n   " + "If you roll the same number on both d8s, the chaotic energy leaps from the target to a different creature of your choice within 30 feet of it. Make a new attack roll against the new target, and make a new damage roll, which could cause the chaotic energy to leap again." + "\n   " + "A creature can be targeted only once by each casting of this spell." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, each target takes 1d6 extra damage of the type rolled for each slot level above 1st.",
	dynamicDamageBonus : {
		multipleDmgTypes : {
			dmgTypes : ["acid", "cold", "fire", "force", "lightning", "poison", "psychic", "thunder"],
			inDescriptionAs : ''
		}
	}
};
SpellsList["charm monster"] = {
	name : "Charm Monster",
	classes : ["bard", "druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 151]],
	level : 4,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "V,S",
	duration : "1 h",
	save : "Wis",
	description : "1+1/SL creatures, each max 30 ft apart, save or charmed; adv. on save if me/ally is fighting it",
	descriptionFull : "You attempt to charm a creature you can see within range. It must make a Wisdom saving throw, and it does so with advantage if you or your companions are fighting it. If it fails the saving throw, it is charmed by you until the spell ends or until you or your companions do anything harmful to it. The charmed creature is friendly to you. When the spell ends, the creature knows it was charmed by you." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, you can target one additional creature for each slot level above 4th. The creatures must be within 30 feet of each other when you target them."
};
SpellsList["create homunculus"] = {
	name : "Create Homunculus",
	classes : ["wizard"],
	source : [["X", 152]],
	level : 6,
	school : "Trans",
	time : "1 h",
	range : "Touch",
	components : "V,S,M\u0192",
	compMaterial : "Clay, ash, and mandrake root, all of which the spell consumes, and a jewel-encrusted dagger worth at least 1,000 gp", 
	duration : "Instantaneous",
	description : "I take 2d4 piercing dmg to create a homunculus as my faithful companion; see book (1000gp)",
	descriptionFull : "While speaking an intricate incantation, you cut yourself with a jewel-encrusted dagger, taking 2d4 piercing damage that can't be reduced in any way. You then drip your blood on the spell's other components and touch them, transforming them into a special construct called a homunculus." + "\n   " + "The statistics of the homunculus are in the Monster Manual. It is your faithful companion, and it dies if you die. Whenever you finish a long rest, you can spend up to half your Hit Dice if the homunculus is on the same plane of existence as you. When you do so, roll each die and add your Constitution modifier to it. Your hit point maximum is reduced by the total, and the homunculus's hit point maximum and current hit points are both increased by it. This process can reduce you to no lower than 1 hit point, and the change to your and the homunculus's hit points ends when you finish your next long rest. The reduction to your hit point maximum can't be removed by any means before then, except by the homunculus's death." + "\n   " + "You can have only one homunculus at a time. If you cast this spell while your homunculus lives, the spell fails.",
	dynamicDamageBonus : { doNotProcess : true } // You don't want to do yourself more damage do you?
};
SpellsList["crown of stars"] = {
	name : "Crown of Stars",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 152]],
	level : 7,
	school : "Evoc",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "1 h",
	description : "7+2/SL motes shed 30-ft light; bonus action to fire one as 120 ft ranged atk for 4d12 Radiant dmg",
	descriptionShorter : "7+2/SL motes shed 30-ft light; bns a to fire one as 120 ft ranged atk for 4d12 Radiant dmg",
	descriptionFull : "Seven star-like motes of light appear and orbit your head until the spell ends. You can use a bonus action to send one of the motes streaking toward one creature or object within 120 feet of you. When you do so, make a ranged spell attack. On a hit, the target takes 4d12 radiant damage. Whether you hit or miss, the mote is expended. The spell ends early if you expend the last mote." + "\n   " + "If you have four or more motes remaining, they shed bright light in a 30-foot radius and dim light for an additional 30 feet. If you have one to three motes remaining, they shed dim light in a 30-foot radius." + AtHigherLevels + "When you cast this spell using a spell slot of 8th level or higher, the number of motes created increases by two for each slot level above 7th."
};
SpellsList["danse macabre"] = {
	name : "Danse Macabre",
	classes : ["warlock", "wizard"],
	source : [["X", 153]],
	level : 5,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "5+2/SL small/medium corpses as zombie/skeleton; spellc. mod to atk/dmg; bns a command in 60 ft",
	descriptionFull : "Threads of dark power leap from your fingers to pierce up to five Small or Medium corpses you can see within range. Each corpse immediately stands up and becomes undead. You decide whether it is a zombie or a skeleton (the statistics for zombies and skeletons are in the Monster Manual), and it gains a bonus to its attack and damage rolls equal to your spellcasting ability modifier." + "\n   " + "You can use a bonus action to mentally command the creatures you make with this spell, issuing the same command to all of them. To receive the command, a creature must be within 60 feet of you. You decide what action the creatures will take and where they will move during their next turn, or you can issue a general command, such as to guard a chamber or passageway against your foes. If you issue no commands, the creatures do nothing except defend themselves against hostile creatures. Once given an order, the creatures continue to follow it until their task is complete." + "\n   " + "The creatures are under your control until the spell ends, after which they become inanimate once more" + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, you animate up to two additional corpses for each slot level above 5th."
};
SpellsList["dawn"] = {
	name : "Dawn",
	classes : ["cleric", "wizard"],
	source : [["X", 153]],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M\u0192",
	compMaterial : "A sunburst pendant worth at least 100 gp", 
	duration : "Conc, 1 min",
	save : "Con",
	description : "30-ft rad 40-ft high all crea 4d10 Radiant dmg at cast/end turn; bns a move it 60 ft (100gp)",
	descriptionFull : "The light of dawn shines down on a location you specify within range. Until the spell ends, a 30-foot-radius, 40-foot-high cylinder of bright light glimmers there. This light is sunlight." + "\n   " + "When the cylinder appears, each creature in it must make a Constitution saving throw, taking 4d10 radiant damage on a failed save, or half as much damage on a successful one. A creature must also make this saving throw whenever it ends its turn in the cylinder." + "\n   " + "If you're within 60 feet of the cylinder, you can move it up to 60 feet as a bonus action on your turn."
};
SpellsList["dragon's breath"] = {
	name : "Dragon's Breath",
	classes : ["sorcerer", "wizard"],
	source : [["X", 154]],
	level : 2,
	school : "Trans",
	time : "1 bns",
	range : "Touch",
	components : "V,S,M",
	compMaterial : "A hot pepper",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "1 willing crea: 1 a breathe 15-ft cone all 3d6+1d6/SL Acid/Cold/Fire/Lightn./Poison dmg; save half",
	descriptionShorter : "1 willing crea: 1 a 15-ft cone 3d6+1d6/SL Acid/Cold/Fire/Lightn/Poison dmg; save half",
	descriptionFull : "You touch one willing creature and imbue it with the power to spew magical energy from its mouth, provided it has one. Choose acid, cold, fire, lightning, or poison. Until the spell ends, the creature can use an action to exhale energy of the chosen type in a 15-foot cone. Each creature in that area must make a Dexterity saving throw, taking 3d6 damage of the chosen type on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd.",
	dynamicDamageBonus : {
		multipleDmgTypes : {
			dmgTypes : ["acid", "cold", "fire", "lightning", "poison"],
			inDescriptionAs : "Acid/Cold/Fire/Lightn.?/Poison"
		}
	}
};
SpellsList["druid grove"] = {
	name : "Druid Grove",
	classes : ["druid"],
	source : [["X", 154]],
	level : 6,
	school : "Abjur",
	time : "10 min",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "Mistletoe, which the spell consumes, that was harvested with a golden sickle under the light of a full moon",
	duration : "24 h",
	description : "Protect 30-ft to 90-ft cube outdoors or underground; see book for effects",
	descriptionFull : "You invoke the spirits of nature to protect an area outdoors or underground. The area can be as small as a 30-foot cube or as large as a 90-foot cube. Buildings and other structures are excluded from the affected area. If you cast this spell in the same area every day for a year, the spell lasts until dispelled." + "\n   " + "The spell creates the following effects within the area. When you cast this spell, you can specify creatures as friends who are immune to the effects. You can also specify a password that, when spoken aloud, makes the speaker immune to these effects." + "\n   " + "The entire warded area radiates magic. A dispel magic cast on the area, if successful, removes only one of the following effects, not the entire area. That spell's caster chooses which effect to end. Only when all its effects are gone is this spell dispelled." + "\n   " + toUni("Solid Fog") + ": You can fill any number of 5-foot squares on the ground with thick fog, making them heavily obscured. The fog reaches 10 feet high. In addition, every foot of movement through the fog costs 2 extra feet. To a creature immune to this effect, the fog obscures nothing and looks like soft mist, with motes of green light floating in the air." + "\n   " + toUni("Grasping Undergrowth") + ": You can fill any number of 5-foot squares on the ground that aren't filled with fog with grasping weeds and vines, as if they were affected by an entangle spell. To a creature immune to this effect, the weeds and vines feel soft and reshape themselves to serve as temporary seats or beds." + "\n   " + toUni("Grove Guardians") + ": You can animate up to four trees in the area, causing them to uproot themselves from the ground. These trees have the same statistics as an awakened tree, which appears in the Monster Manual, except they can't speak, and their bark is covered with druidic symbols. If any creature not immune to this effect enters the warded area, the grove guardians fight until they have driven off or slain the intruders. The grove guardians also obey your spoken commands (no action required by you) that you issue while in the area. If you don't give them commands and no intruders are present, the grove guardians do nothing. The grove guardians can't leave the warded area. When the spell ends, the magic animating them disappears, and the trees take root again if possible." + "\n   " + toUni("Additional Spell Effects") + ": You can place your choice of one of the following magical effects within the warded area:" + "\n \u2022 " + "A constant gust of wind in two locations of your choice" + "\n \u2022 " + "Spike growth in one location of your choice" + "\n \u2022 " + "Wind wall in two locations of your choice" + "\n   " + "To a creature immune to this effect, the winds are a fragrant, gentle breeze, and the area of spike growth is harmless."
};
SpellsList["enemies abound"] = {
	name : "Enemies Abound",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["X", 155]],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Int",
	description : "1 crea save or regard all creatures it can see as enemies, random targeting; save when damaged to end",
	descriptionFull : "You reach into the mind of one creature you can see and force it to make an Intelligence saving throw. A creature automatically succeeds if it is immune to being frightened. On a failed save, the target loses the ability to distinguish friend from foe, regarding all creatures it can see as enemies until the spell ends. Each time the target takes damage, it can repeat the saving throw, ending the effect on itself on a success." + "\n   " + "Whenever the affected creature chooses another creature as a target, it must choose the target at random from among the creatures it can see within range of the attack, spell, or other ability it's using. If an enemy provokes an opportunity attack from the affected creature, the creature must make that attack if it is able to."
};
SpellsList["enervation"] = {
	name : "Enervation",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 155]],
	level : 5,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "1 crea 4d8+1d8/SL Necrotic dmg, action to repeat, I heal half; on save 2d8+1d8/SL dmg once; see B",
	descriptionShorter : "1 crea 4d8+1d8/SL Necro dmg, 1 a repeat, I heal half; saved 2d8+1d8/SL dmg once; see B",
	descriptionFull : "A tendril of inky darkness reaches out from you, touching a creature you can see within range to drain life from it. The target must make a Dexterity saving throw. On a successful save, the target takes 2d8 necrotic damage, and the spell ends. On a failed save, the target takes 4d8 necrotic damage, and until the spell ends, you can use your action on each of your turns to automatically deal 4d8 necrotic damage to the target. The spell ends if you use your action to do anything else, if the target is ever outside the spell's range, or if the target has total cover from you." + "\n   " + "Whenever the spell deals damage to a target, you regain hit points equal to half the amount of necrotic damage the target takes." + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, the damage increases by 1d8 for each slot level above 5th.",
	dynamicDamageBonus : {
		extraDmgGroupsSameType : /(saved? )((?:\+?\d+d?\d*)+)(\+1d8\/SL)/i
	}
};
SpellsList["far step"] = {
	name : "Far Step",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 155]],
	level : 5,
	school : "Conj",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	description : "At casting and as bonus action for duration, I can teleport 60 ft to a space I can see",
	descriptionFull : "You teleport up to 60 feet to an unoccupied space you can see. On each of your turns before the spell ends, you can use a bonus action to teleport in this way again."
};
SpellsList["find greater steed"] = {
	name : "Find Greater Steed",
		classes : ["paladin"],
		source : [["X", 156]],
		level : 4,
		school : "Conj",
		time : "10 min",
		range : "30 ft",
		components : "V,S",
		duration : "Instantaneous",
		description : "Gain the services of a steed; can communicate with it telepathically; can share spells with it; see book",
		descriptionFull : "You summon a spirit that assumes the form of a loyal, majestic mount. Appearing in an unoccupied space within range, the spirit takes on a form you choose: a griffon, a pegasus, a peryton, a dire wolf, a rhinoceros, or a saber-toothed tiger. The creature has the statistics provided in the Monster Manual for the chosen form, though it is a celestial, a fey, or a fiend (your choice) instead of its normal creature type. Additionally, if it has an Intelligence score of 5 or lower, its Intelligence becomes 6, and it gains the ability to understand one language of your choice that you speak." + "\n   " + "You control the mount in combat. While the mount is within 1 mile of you, you can communicate with it telepathically. While mounted on it, you can make any spell you cast that targets only you also target the mount." + "\n   " + "The mount disappears temporarily when it drops to 0 hit points or when you dismiss it as an action. Casting this spell again re-summons the bonded mount, with all its hit points restored and any conditions removed." + "\n   " + "You can't have more than one mount bonded by this spell or find steed at the same time. As an action, you can release a mount from its bond, causing it to disappear permanently." + "\n   " + "Whenever the mount disappears, it leaves behind any objects it was wearing or carrying."
};
SpellsList["guardian of nature"] = {
	name : "Guardian of Nature",
	classes : ["druid", "ranger"],
	source : [["X", 157]],
	level : 4,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	description : "I transform into a Primal Beast (offensive bonuses) or a Great Tree (defensive bonuses); see book",
	descriptionFull : "A nature spirit answers your call and transforms you into a powerful guardian. The transformation lasts until the spell ends. You choose one of the following forms to assume: Primal Beast or Great Tree." + "\n\n" + toUni("Primal Beast") + ": Bestial fur covers your body, your facial features become feral, and you gain the following benefits:" + "\n \u2022 " + "Your walking speed increases by 10 feet." + "\n \u2022 " + "You gain darkvision with a range of 120 feet." + "\n \u2022 " + "You make Strength-based attack rolls with advantage." + "\n \u2022 " + "Your melee weapon attacks deal an extra 1d6 force damage on a hit." + "\n\n" + toUni("Great Tree") + ": Your skin appears barky, leaves sprout from your hair, and you gain the following benefits:" + "\n \u2022 " + "You gain 10 temporary hit points." + "\n \u2022 " + "You make Constitution saving throws with advantage." + "\n \u2022 " + "You make Dexterity- and Wisdom-based attack rolls with advantage." + "\n \u2022 " + "While you are on the ground, the ground within 15 feet of you is difficult terrain for your enemies."
};
SpellsList["healing spirit"] = { // limited usages (https://media.wizards.com/2020/dnd/downloads/XGtE-Errata.pdf)
	name : "Healing Spirit",
	classes : ["druid", "ranger"],
	source : [["X", 157]],
	level : 2,
	school : "Conj",
	time : "1 bns",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "5-ft cube; any living crea I see start/enter heals 1d6+1d6/SL HP; 1+spell mod uses; bns a move it 30 ft",
	descriptionShorter : "5-ft cube; any living start/enter heals 1d6+1d6/SL HP; 1+spell mod uses; bns a move 30 ft",
	descriptionFull : "You call forth a nature spirit to soothe the wounded. The intangible spirit appears in a space that is a 5-foot cube you can see within range. The spirit looks like a transparent beast or fey (your choice)." + "\n   " + "Until the spell ends, whenever you or a creature you can see moves into the spirit's space for the first time on a turn or starts its turn there, you can cause the spirit to restore 1d6 hit points to that creature (no action required). The spirit can't heal constructs or undead. The spirit can heal a number of times equal to 1 + your spellcasting ability modifier (minimum of twice). After healing that number of times, the spirit disappears." + "\n   " + "As a bonus action on your turn, you can move the spirit up to 30 feet to a space you can see." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the healing increases by 1d6 for each slot level above 2nd."
};
SpellsList["holy weapon"] = { 
	name : "Holy Weapon",
	classes : ["cleric", "paladin"],
	source : [["X", 157]],
	level : 5,
	school : "Evoc",
	time : "1 bns",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	save : "Con",
	description : "Wea +2d8 Radiant dmg; bns a end spell: 30-ft rad all crea 4d8 Radiant dmg, blind; save half, no blind",
	descriptionShorter : "wea +2d8 Radiant dmg; bns a end: 30-ft rad all 4d8 Radiant dmg, blind; save half, no blind",
	descriptionFull : "You imbue a weapon you touch with holy power. Until the spell ends, the weapon emits bright light in a 30-foot radius and dim light for an additional 30 feet. In addition, weapon attacks made with it deal an extra 2d8 radiant damage on a hit. If the weapon isn't already a magic weapon, it becomes one for the duration." + "\n   " + "As a bonus action on your turn, you can dismiss this spell and cause the weapon to emit a burst of radiance. Each creature of your choice that you can see within 30 feet of the weapon must make a Constitution saving throw. On a failed save, a creature takes 4d8 radiant damage, and it is blinded for 1 minute. On a successful save, a creature takes half as much damage and isn't blinded. At the end of each of its turns, a blinded creature can make a Constitution saving throw, ending the effect on itself on a success.",
	dynamicDamageBonus : {
		multipleDmgMoments : false,
		skipDmgGroupIfNotMultiple : /(wea .*?radiant dmg.*?)/i
	}
};
SpellsList["illusory dragon"] = {
	name : "Illusory Dragon",
	classes : ["wizard"],
	source : [["X", 157]],
	level : 8,
	school : "Illus",
	time : "1 a",
	range : "120 ft",
	components : "S",
	duration : "Conc, 1 min",
	save : "W/I",
	description : "Huge shadowy dragon; see: Wis save or fright.; bns a move 60 ft \u0026 breath wea 7d6 dmg; Int save half",
	descriptionShorter : "Huge illus.; see: Wis save or fright.; bns a move 60 ft \u0026 breath wea 7d6 dmg; Int save half",
	descriptionFull : "By gathering threads of shadow material from the Shadowfell, you create a Huge shadowy dragon in an unoccupied space that you can see within range. The illusion lasts for the spell's duration and occupies its space, as if it were a creature." + "\n   " + "When the illusion appears, any of your enemies that can see it must succeed on a Wisdom saving throw or become frightened of it for 1 minute. If a frightened creature ends its turn in a location where it doesn't have line of sight to the illusion, it can repeat the saving throw, ending the effect on itself on a success." + "\n   " + "As a bonus action on your turn, you can move the illusion up to 60 feet. At any point during its movement, you can cause it to exhale a blast of energy in a 60-foot cone originating from its space. When you create the dragon, choose a damage type: acid, cold, fire, lightning, necrotic, or poison. Each creature in the cone must make an Intelligence saving throw, taking 7d6 damage of the chosen damage type on a failed save, or half as much damage on a successful one." + "\n   " + "The illusion is tangible because of the shadow stuff used to create it, but attacks miss it automatically, it succeeds on all saving throws, and it is immune to all damage and conditions. A creature that uses an action to examine the dragon can determine that it is an illusion by succeeding on an Intelligence (Investigation) check against your spell save DC. If a creature discerns the illusion for what it is, the creature can see through it and has advantage on saving throws against its breath.",
	dynamicDamageBonus : {
		multipleDmgTypes : {
			dmgTypes : ["radiant", "necrotic"],
			inDescriptionAs : ''
		}
	}
};
SpellsList["infernal calling"] = {
	name : "Infernal Calling",
	classes : ["warlock", "wizard"],
	source : [["X", 158]],
	level : 5,
	school : "Conj",
	time : "1 min",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A ruby worth at least 999 gp",
	duration : "Conc, 1 h",
	description : "Summon 1 devil of CR 6+1/SL; hostile to all, obeys my command if to its liking or Cha check; see B",
	descriptionFull : "Uttering a dark incantation, you summon a devil from the Nine Hells. You choose the devil's type, which must be one of challenge rating 6 or lower, such as a barbed devil or a bearded devil. The devil appears in an unoccupied space that you can see within range. The devil disappears when it drops to 0 hit points or when the spell ends." + "\n   " + "The devil is unfriendly toward you and your companions. Roll initiative for the devil, which has its own turns. It is under the Dungeon Master's control and acts according to its nature on each of its turns, which might result in its attacking you if it thinks it can prevail, or trying to tempt you to undertake an evil act in exchange for limited service. The DM has the creature's statistics." + "\n   " + "On each of your turns, you can try to issue a verbal command to the devil (no action required by you). It obeys the command if the likely outcome is in accordance with its desires, especially if the result would draw you toward evil. Otherwise, you must make a Charisma (Deception, Intimidation, or Persuasion) check contested by its Wisdom (Insight) check. You make the check with advantage if you say the devil's true name. If your check fails, the devil becomes immune to your verbal commands for the duration of the spell, though it can still carry out your commands if it chooses. If your check succeeds, the devil carries out your command \u2014 such as “attack my enemies,” “explore the room ahead,” or “bear this message to the queen” \u2014 until it completes the activity, at which point it returns to you to report having done so." + "\n   " + "If your concentration ends before the spell reaches its full duration, the devil doesn't disappear if it has become immune to your verbal commands. Instead, it acts in whatever manner it chooses for 3d6 minutes, and then it disappears." + "\n   " + "If you possess an individual devil's talisman, you can summon that devil if it is of the appropriate challenge rating plus 1, and it obeys all your commands, with no Charisma checks required." + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, the challenge rating increases by 1 for each slot level above 5th."
};
SpellsList["infestation"] = {
	name : "Infestation",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 158]],
	level : 0,
	school : "Conj",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "A living flea",
	duration : "Instantaneous",
	save : "Con",
	description : "1 crea save or 1d6 Poison dmg and moved 5 ft in random direction; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "1 crea save or `CD`d6 Poison dmg and moved 5 ft in random direction",
	descriptionFull : "You cause a cloud of mites, fleas, and other parasites to appear momentarily on one creature you can see within range. The target must succeed on a Constitution saving throw, or it takes 1d6 poison damage and moves 5 feet in a random direction if it can move and its speed is at least 5 feet. Roll a d4 for the direction:" + "\n\n" + toUni("d4") + "\t" + toUni("Direction") + "\n  1\tNorth" + "\n  2\tSouth" + "\n  3\tEast" + "\n  4\tWest" + "\n\n   " + "This movement doesn't provoke opportunity attacks, and if the direction rolled is blocked, the target doesn't move." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["invulnerability"] = {
	name : "Invulnerability",
	classes : ["wizard"],
	source : [["X", 160]],
	level : 9,
	school : "Abjur",
	time : "1 a",
	range : "Self",
	components : "V,S,M\u2020",
	compMaterial : "A small piece of adamantine worth at least 500 gp, which the spell consumes",
	duration : "Conc, 10 min",
	description : "Immune to all damage until the spell ends (500gp cons.)",
	descriptionFull : "You are immune to all damage until the spell ends."
};
SpellsList["life transference"] = { // can't reduce damage taken (https://media.wizards.com/2020/dnd/downloads/XGtE-Errata.pdf)
	name : "Life Transference",
	classes : ["cleric", "wizard"],
	source : [["X", 160]],
	level : 3,
	school : "Necro",
	time : "1 a",
	range : "30 ft",
	components : "V,S",
	duration : "Instantaneous",
	description : "I take 4d8+1d8/SL Necrotic dmg (in full) and 1 crea in range I can see heals twice that in HP",
	descriptionFull : "You sacrifice some of your health to mend another creature's injuries. You take 4d8 necrotic damage, which can't be reduced in any way, and one creature of your choice that you can see within range regains a number of hit points equal to twice the necrotic damage you take." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d8 for each slot level above 3rd."
};
SpellsList["maddening darkness"] = {
	name : "Maddening Darkness",
	classes : ["warlock", "wizard"],
	source : [["X", 160]],
	level : 8,
	school : "Evoc",
	time : "1 a",
	range : "150 ft",
	components : "V,M",
	compMaterial : "A drop of pitch mixed with a drop of mercury",
	duration : "Conc, 10 min",
	save : "Wis",
	description : "60-ft rad darkness; darkvision, no light works; all crea starting turn in 8d8 Psychic dmg, save halves",
	descriptionShorter : "60-ft rad darkness; darkvision, no light works; all start turn in 8d8 Psychic dmg, save half",
	descriptionFull : "Magical darkness spreads from a point you choose within range to fill a 60-foot-radius sphere until the spell ends. The darkness spreads around corners. A creature with darkvision can't see through this darkness. Nonmagical light, as well as light created by spells of 8th level or lower, can't illuminate the area." + "\n   " + "Shrieks, gibbering, and mad laughter can be heard within the sphere. Whenever a creature starts its turn in the sphere, it must make a Wisdom saving throw, taking 8d8 psychic damage on a failed save, or half as much damage on a successful one."
};
SpellsList["mass polymorph"] = {
	name : "Mass Polymorph",
	classes : ["bard", "sorcerer", "wizard"],
	source : [["X", 160]],
	level : 9,
	school : "Trans",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A caterpillar cocoon",
	duration : "Conc, 1 h",
	save : "Wis",
	description : "10 crea save or take chosen beast form of CR \u2264 its CR or half its char. level; can only act as beast; see B",
	descriptionFull : "You transform up to ten creatures of your choice that you can see within range. An unwilling target must succeed on a Wisdom saving throw to resist the transformation. An unwilling shapechanger automatically succeeds on the save." + "\n   " + "Each target assumes a beast form of your choice, and you can choose the same form or different ones for each target. The new form can be any beast you have seen whose challenge rating is equal to or less than the target's (or half the target's level, if the target doesn't have a challenge rating). The target's game statistics, including mental ability scores, are replaced by the statistics of the chosen beast, but the target retains its hit points, alignment, and personality." + "\n   " + "Each target gains a number of temporary hit points equal to the hit points of its new form. These temporary hit points can't be replaced by temporary hit points from another source. A target reverts to its normal form when it has no more temporary hit points or it dies. If the spell ends before then, the creature loses all its temporary hit points and reverts to its normal form." + "\n   " + "The creature is limited in the actions it can perform by the nature of its new form. It can't speak, cast spells, or do anything else that requires hands or speech." + "\n   " + "The target's gear melds into the new form. The target can't activate, use, wield, or otherwise benefit from any of its equipment."
};
SpellsList["mental prison"] = {
	name : "Mental Prison",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 161]],
	level : 6,
	school : "Illus",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "Conc, 1 min",
	save : "Int",
	description : "1 crea 5d10 Psychic dmg; save or restrained, blind, deaf, and if moved: 10d10 dmg, ends; charm effect",
	descriptionShorter : "1 crea 5d10 Psychic dmg; save or restrained, blind, deaf, if move: 10d10 dmg, ends; charm",
	descriptionFull : "You attempt to bind a creature within an illusory cell that only it perceives. One creature you can see within range must make an Intelligence saving throw. The target succeeds automatically if it is immune to being charmed. On a successful save, the target takes 5d10 psychic damage, and the spell ends. On a failed save, the target takes 5d10 psychic damage, and you make the area immediately around the target's space appear dangerous to it in some way. You might cause the target to perceive itself as being surrounded by fire, floating razors, or hideous maws filled with dripping teeth. Whatever form the illusion takes, the target can't see or hear anything beyond it and is restrained for the spell's duration. If the target is moved out of the illusion, makes a melee attack through it, or reaches any part of its body through it, the target takes 10d10 psychic damage, and the spell ends.",
	dynamicDamageBonus : {
		multipleDmgMoments : false,
		extraDmgGroupsSameType : /(if moved?: )((?:\+?\d+d?\d*)+)/i
	}
};
SpellsList["mighty fortress"] = {
	name : "Mighty Fortress",
	classes : ["wizard"],
	source : [["X", 161]],
	level : 8,
	school : "Conj",
	time : "1 min",
	range : "1 mile",
	components : "V,S,M\u2020",
	compMaterial : "A diamond worth at least 500 gp, which the spell consumes",
	duration : "Instantaneous",
	description : "Create a stone fortress 120 ft on a side for 7 days; see book for effects (500gp cons.)",
	descriptionFull : "A fortress of stone erupts from a square area of ground of your choice that you can see within range. The area is 120 feet on each side, and it must not have any buildings or other structures on it. Any creatures in the area are harmlessly lifted up as the fortress rises." + "\n   " + "The fortress has four turrets with square bases, each one 20 feet on a side and 30 feet tall, with one turret on each corner. The turrets are connected to each other by stone walls that are each 80 feet long, creating an enclosed area. Each wall is 1 foot thick and is composed of panels that are 10 feet wide and 20 feet tall. Each panel is contiguous with two other panels or one other panel and a turret. You can place up to four stone doors in the fortress's outer wall." + "\n   " + "A small keep stands inside the enclosed area. The keep has a square base that is 50 feet on each side, and it has three floors with 10-foot-high ceilings. Each of the floors can be divided into as many rooms as you like, provided each room is at least 5 feet on each side. The floors of the keep are connected by stone staircases, its walls are 6 inches thick, and interior rooms can have stone doors or open archways as you choose. The keep is furnished and decorated however you like, and it contains sufficient food to serve a nine-course banquet for up to 100 people each day. Furnishings, food, and other objects created by this spell crumble to dust if removed from the fortress." + "\n   " + "A staff of one hundred invisible servants obeys any command given to them by creatures you designate when you cast the spell. Each servant functions as if created by the unseen servant spell." + "\n   " + "The walls, turrets, and keep are all made of stone that can be damaged. Each 10-foot-by-10-foot section of stone has AC 15 and 30 hit points per inch of thickness. It is immune to poison and psychic damage. Reducing a section of stone to 0 hit points destroys it and might cause connected sections to buckle and collapse at the DM's discretion." + "\n   " + "After 7 days or when you cast this spell somewhere else, the fortress harmlessly crumbles and sinks back into the ground, leaving any creatures that were inside it safely on the ground." + "\n   " + "Casting this spell on the same spot once every 7 days for a year makes the fortress permanent."
};
SpellsList["mind spike"] = { // +1d8 at higher levels errata (https://media.wizards.com/2020/dnd/downloads/XGtE-Errata.pdf)
	name : "Mind Spike",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 162]],
	level : 2,
	school : "Div",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "Conc, 1 h",
	save : "Wis",
	description : "1 crea 3d8+1d8/SL Psychic dmg, know its location, can't be invis for me; save half, no other benefits",
	descriptionShorter : "1 crea 3d8+1d8/SL Psychic dmg, know its location, can't be invis for me; save half, not rest",
	descriptionFull : "You reach into the mind of one creature you can see within range. The target must make a Wisdom saving throw, taking 3d8 psychic damage on a failed save, or half as much damage on a successful one. On a failed save, you also always know the target's location until the spell ends, but only while the two of you are on the same plane of existence. While you have this knowledge, the target can't become hidden from you, and if it's invisible, it gains no benefit from that condition against you." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd.",
	dynamicDamageBonus : { multipleDmgMoments : false }
};
SpellsList["negative energy flood"] = {
	name : "Negative Energy Flood",
	classes : ["warlock", "wizard"],
	source : [["X", 163]],
	level : 5,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,M",
	compMaterial : "A broken bone and a square of black silk",
	duration : "Instantaneous",
	save : "Con",
	description : "1 crea: living 5d12 Necrotic dmg, save halves, rises as zombie if killed; undead 5d12/2 temp HP",
	descriptionFull : "You send ribbons of negative energy at one creature you can see within range. Unless the target is undead, it must make a Constitution saving throw, taking 5d12 necrotic damage on a failed save, or half as much damage on a successful one. A target killed by this damage rises up as a zombie at the start of your next turn. The zombie pursues whatever creature it can see that is closest to it. Statistics for the zombie are in the Monster Manual." + "\n   " + "If you target an undead with this spell, the target doesn't make a saving throw. Instead, roll 5d12. The target gains half the total as temporary hit points."
};
SpellsList["power word pain"] = {
	name : "Power Word Pain",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 163]],
	level : 7,
	school : "Ench",
	time : "1 a",
	range : "60 ft",
	components : "V",
	duration : "Instantaneous",
	description : "1 crea with 100 HP or less disadv. atk/check/save, conc. save to cast; save/rnd to end; charm effect",
	descriptionFull : "You speak a word of power that causes waves of intense pain to assail one creature you can see within range. If the target has 100 hit points or fewer, it is subject to crippling pain. Otherwise, the spell has no effect on it. A target is also unaffected if it is immune to being charmed." + "\n   " + "While the target is affected by crippling pain, any speed it has can be no higher than 10 feet. The target also has disadvantage on attack rolls, ability checks, and saving throws, other than Constitution saving throws. Finally, if the target tries to cast a spell, it must first succeed on a Constitution saving throw, or the casting fails and the spell is wasted." + "\n   " + "A target suffering this pain can make a Constitution saving throw at the end of each of its turns. On a successful save, the pain ends."
};
SpellsList["primal savagery"] = { 
	name : "Primal Savagery",
	classes : ["druid"],
	source : [["X", 163]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "S",
	duration : "Instantaneous",
	description : "Melee spell attack, 5 ft range, for 1d10 Acid dmg; +1d10 at CL 5, 11, and 17",
	descriptionCantripDie : "Melee spell attack, 5 ft range, for `CD`d10 Acid dmg",
	descriptionFull : "You channel primal magic to cause your teeth or fingernails to sharpen, ready to deliver a corrosive attack. Make a melee spell attack against one creature within 5 feet of you. On a hit, the target takes 1d10 acid damage. After you make the attack, your teeth or fingernails return to normal." + "\n   " + "The spell's damage increases by 1d10 when you reach 5th level (2d10), 11th level (3d10), and 17th level (4d10)."
};
SpellsList["psychic scream"] = {
	name : "Psychic Scream",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["X", 163]],
	level : 9,
	school : "Ench",
	time : "1 a",
	range : "90 ft",
	components : "S",
	duration : "Instantaneous",
	save : "Int",
	description : "10 crea Int>2 save or 14d6 Psychic dmg and stunned; save halves, no stun; end of turn save to stop",
	descriptionFull : "You unleash the power of your mind to blast the intellect of up to ten creatures of your choice that you can see within range. Creatures that have an Intelligence score of 2 or lower are unaffected." + "\n   " + "Each target must make an Intelligence saving throw. On a failed save, a target takes 14d6 psychic damage and is stunned. On a successful save, a target takes half as much damage and isn't stunned. If a target is killed by this damage, its head explodes, assuming it has one." + "\n   " + "A stunned target can make an Intelligence saving throw at the end of each of its turns. On a successful save, the stunning effect ends."
};
SpellsList["scatter"] = {
	name : "Scatter",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 164]],
	level : 6,
	school : "Conj",
	time : "1 a",
	range : "30 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Wis",
	description : "Up to 5 creatures in range, save or teleported 120 ft to a different space I can see on the ground",
	descriptionFull : "The air quivers around up to five creatures of your choice that you can see within range. An unwilling creature must succeed on a Wisdom saving throw to resist this spell. You teleport each affected target to an unoccupied space that you can see within 120 feet of you. That space must be on the ground or on a floor."
};
SpellsList["shadow blade"] = {
	name : "Shadow Blade",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 164]],
	level : 2,
	school : "Illus",
	time : "1 bns",
	range : "Self",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "Sword 2d8 Psychic dmg, finesse, light, thrown (20/60 ft), adv. if target in dim/dark; +1d8 at SL3/5/7",
	descriptionMetric : "Sword: 2d8 Psychic dmg, finesse, light, thrown (6/18 m), adv. if target in dim/dark; +1d8 at SL3/5/7",
	descriptionShorter : "Sword 2d8 Psychic dmg, finesse, light, thrown (20/60ft), adv. in dim/dark; +1d8 SL3/5/7",
	descriptionShorterMetric : "Sword 2d8 Psychic dmg, finesse, light, thrown (6/18 m), adv. in dim/dark; +1d8 SL3/5/7",
	descriptionFull : "You weave together threads of shadow to create a sword of solidified gloom in your hand. This magic sword lasts until the spell ends. It counts as a simple melee weapon with which you are proficient. It deals 2d8 psychic damage on a hit and has the finesse, light, and thrown properties (range 20/60). In addition, when you use the sword to attack a target that is in dim light or darkness, you make the attack roll with advantage." + "\n   " + "If you drop the weapon or throw it, it dissipates at the end of the turn. Thereafter, while the spell persists, you can use a bonus action to cause the sword to reappear in your hand." + AtHigherLevels + "When you cast this spell using a 3rd- or 4th-level spell slot, the damage increases to 3d8. When you cast it using a 5th- or 6th-level spell slot, the damage increases to 4d8. When you cast it using a spell slot of 7th level or higher, the damage increases to 5d8."
};
WeaponsList["shadow blade"] = {
	regExpSearch : /(?=.*shadow)(?=.*blade).*$/i,
	name : "Shadow Blade",
	source : [["X", 164]],
	list : "spell",
	ability : 1,
	type : "Simple",
	damage : [2, 8, "psychic"],
	range : "Melee, 20/60 ft",
	description : "Finesse, light, thrown; +1d8 at SL3/5/7; Adv. if target in dim light/darkness",
	abilitytodamage : true,
	isAlwaysProf : true,
	useSpellcastingAbility : false
};
SpellsList["shadow of moil"] = {
	name : "Shadow of Moil",
	classes : ["warlock"],
	source : [["X", 164]],
	level : 4,
	school : "Necro",
	time : "1 a",
	range : "Self",
	components : "V,S,M\u0192",
	compMaterial : "An undead eyeball encased in a gem worth at least 150 gp",
	duration : "Conc, 1 min",
	description : "Me: heavy obsc., Radiant resistance; 10-ft rad: 1 step darker, hit vs. me get 2d8 Necrotic dmg (150gp)",
	descriptionShorter : "Me: hvy obsc., Radiant resist; 10-ft rad: 1 step darker, hit vs. me 2d8 Necrotic dmg (150gp)",
	descriptionFull : "Flame-like shadows wreathe your body until the spell ends, causing you to become heavily obscured to others. The shadows turn dim light within 10 feet of you into darkness, and bright light in the same area to dim light." + "\n   " + "Until the spell ends, you have resistance to radiant damage. In addition, whenever a creature within 10 feet of you hits you with an attack, the shadows lash out at that creature, dealing it 2d8 necrotic damage."
};
SpellsList["sickening radiance"] = {
	name : "Sickening Radiance",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 164]],
	level : 4,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Con",
	description : "30-ft rad all enter/start turn save or 4d10 Radiant dmg, 1 level of exhaustion, and emit 5-ft rad light",
	descriptionShorter : "30-ft rad all enter/start turn save or 4d10 Radiant dmg, 1 lvl exhaust., emit 5-ft rad light",
	descriptionFull : "Dim, greenish light spreads within a 30-foot-radius sphere centered on a point you choose within range. The light spreads around corners, and it lasts until the spell ends." + "\n   " + "When a creature moves into the spell's area for the first time on a turn or starts its turn there, that creature must succeed on a Constitution saving throw or take 4d10 radiant damage, and it suffers one level of exhaustion and emits a dim, greenish light in a 5-foot radius. This light makes it impossible for the creature to benefit from being invisible. The light and any levels of exhaustion caused by this spell go away when the spell ends."
};
SpellsList["skill empowerment"] = {
	name : "Skill Empowerment",
	classes : ["artificer", "bard", "sorcerer", "wizard"],
	source : [["X", 165]],
	level : 5,
	school : "Trans",
	time : "1 a",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "1 willing creature gains expertise in one skill of my choice that it is proficient with for the duration",
	descriptionFull : "Your magic deepens a creature's understanding of its own talent. You touch one willing creature and give it expertise in one skill of your choice; until the spell ends, the creature doubles its proficiency bonus for ability checks it makes that use the chosen skill." + "\n   " + "You must choose a skill in which the target is proficient and that isn't already benefiting from an effect, such as Expertise, that doubles its proficiency bonus."
};
SpellsList["snare"] = {
	name : "Snare",
	classes : ["artificer", "druid", "ranger", "wizard"],
	source : [["X", 165]],
	level : 1,
	school : "Abjur",
	time : "1 min",
	range : "Touch",
	components : "S,M\u2020",
	compMaterial : "25 feet of rope, which the spell consumes",
	duration : "8 h, till trigger",
	save : "Dex",
	description : "5-ft rad trap; Investigation vs spell DC to see; save or restrained 3 ft in the air; save each rnd (5sp)",
	descriptionFull : "As you cast this spell, you use the rope to create a circle with a 5-foot radius on the ground or the floor. When you finish casting, the rope disappears and the circle becomes a magic trap." + "\n   " + "This trap is nearly invisible, requiring a successful Intelligence (Investigation) check against your spell save DC to be discerned." + "\n   " + "The trap triggers when a Small, Medium, or Large creature moves onto the ground or the floor in the spell's radius. That creature must succeed on a Dexterity saving throw or be magically hoisted into the air, leaving it hanging upside down 3 feet above the ground or the floor. The creature is restrained there until the spell ends." + "\n   " + "A restrained creature can make a Dexterity saving throw at the end of each of its turns, ending the effect on itself on a success. Alternatively, the creature or someone else who can reach it can use an action to make an Intelligence (Arcana) check against your spell save DC. On a success, the restrained effect ends." + "\n   " + "After the trap is triggered, the spell ends when no creature is restrained by it."
};
SpellsList["soul cage"] = {
	name : "Soul Cage",
	classes : ["warlock", "wizard"],
	source : [["X", 165]],
	level : 6,
	school : "Necro",
	time : "1 rea",
	timeFull : "1 reaction, which you take when a humanoid you can see within 60 feet of you dies",
	range : "60 ft",
	components : "V,S,M\u0192",
	compMaterial : "A tiny silver cage worth 100 gp",
	duration : "8 h",
	description : "As a reaction when humanoid in range dies, I capture their soul in a tiny cage; see book (100gp)",
	descriptionFull : "This spell snatches the soul of a humanoid as it dies and traps it inside the tiny cage you use for the material component. A stolen soul remains inside the cage until the spell ends or until you destroy the cage, which ends the spell. While you have a soul inside the cage, you can exploit it in any of the ways described below. You can use a trapped soul up to six times. Once you exploit a soul for the sixth time, it is released, and the spell ends. While a soul is trapped, the dead humanoid it came from can't be revived." + "\n   " + toUni("Steal Life") + ": You can use a bonus action to drain vigor from the soul and regain 2d8 hit points." + "\n   " + toUni("Query Soul") + ": You ask the soul a question (no action required) and receive a brief telepathic answer, which you can understand regardless of the language used. The soul knows only what it knew in life, but it must answer you truthfully and to the best of its ability. The answer is no more than a sentence or two and might be cryptic." + "\n   " + toUni("Borrow Experience") + ": You can use a bonus action to bolster yourself with the soul's life experience, making your next attack roll, ability check, or saving throw with advantage. If you don't use this benefit before the start of your next turn, it is lost." + "\n   " + toUni("Eyes of the Dead") + ": You can use an action to name a place the humanoid saw in life, which creates an invisible sensor somewhere in that place if it is on the plane of existence you're currently on. The sensor remains for as long as you concentrate, up to 10 minutes (as if you were concentrating on a spell). You receive visual and auditory information from the sensor as if you were in its space using your senses" + "\n   " + "A creature that can see the sensor (such as one using see invisibility or truesight) sees a translucent image of the tormented humanoid whose soul you caged."
};
SpellsList["steel wind strike"] = {
	name : "Steel Wind Strike",
	classes : ["ranger", "wizard"],
	source : [["X", 166]],
	level : 5,
	school : "Conj",
	time : "1 a",
	range : "30 ft",
	components : "S,M\u0192",
	compMaterial : "A melee weapon worth at least 1 sp",
	duration : "Instantaneous",
	description : "Melee spell attack vs. 5 crea in range; 6d10 Force dmg on hit; after, I teleport next to one target",
	descriptionFull : "You flourish the weapon used in the casting and then vanish to strike like the wind. Choose up to five creatures you can see within range. Make a melee spell attack against each target. On a hit, a target takes 6d10 force damage." + "\n   " + "You can then teleport to an unoccupied space you can see within 5 feet of one of the targets you hit or missed."
};
SpellsList["summon greater demon"] = {
	name : "Summon Greater Demon",
	classes : ["warlock", "wizard"],
	source : [["X", 166]],
	level : 4,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A vial of blood from a humanoid killed within the past 24 hours",
	duration : "Conc, 1 h",
	save : "Cha",
	description : "Summon 1 demon of CR 5+1/SL that obeys me; end of each of its turn, save to break free; see book",
	descriptionFull : "You utter foul words, summoning one demon from the chaos of the Abyss. You choose the demon's type, which must be one of challenge rating 5 or lower, such as a shadow demon or a barlgura. The demon appears in an unoccupied space you can see within range, and the demon disappears when it drops to 0 hit points or when the spell ends." + "\n   " + "Roll initiative for the demon, which has its own turns. When you summon it and on each of your turns thereafter, you can issue a verbal command to it (requiring no action on your part), telling it what it must do on its next turn. If you issue no command, it spends its turn attacking any creature within reach that has attacked it." + "\n   " + "At the end of each of the demon's turns, it makes a Charisma saving throw. The demon has disadvantage on this saving throw if you say its true name. On a failed save, the demon continues to obey you. On a successful save, your control of the demon ends for the rest of the duration, and the demon spends its turns pursuing and attacking the nearest non-demons to the best of its ability. If you stop concentrating on the spell before it reaches its full duration, an uncontrolled demon doesn't disappear for 1d6 rounds if it still has hit points." + "\n   " + "As part of casting the spell, you can form a circle on the ground with the blood used as a material component. The circle is large enough to encompass your space. While the spell lasts, the summoned demon can't cross the circle or harm it, and it can't target anyone within it. Using the material component in this manner consumes it when the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the challenge rating increases by 1 for each slot level above 4th."
};
SpellsList["summon lesser demons"] = {
	name : "Summon Lesser Demons",
	classes : ["warlock", "wizard"],
	source : [["X", 167]],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A vial of blood from a humanoid killed within the past 24 hours",
	duration : "Conc, 1 h",
	description : "Summon up to 8 (16 at SL6, 24 at SL8) CR \u22641 1 demons, DM choice; attack nearest non-demons",
	descriptionFull : "You utter foul words, summoning demons from the chaos of the Abyss. Roll on the following table to determine what appears." + "\n\n " + toUni("d6") + "\t" + toUni("Demons Summoned") + "\n  1-2\tTwo demons of challenge rating 1 or lower" + "\n  3-4\tFour demons of challenge rating 1/2 or lower" + "\n  5-6\tEight demons of challenge rating 1/4 or lower" + "\n\n   " + "The DM chooses the demons, such as manes or dretches, and you choose the unoccupied spaces you can see within range where they appear. A summoned demon disappears when it drops to 0 hit points or when the spell ends." + "\n   " + "The demons are hostile to all creatures, including you. Roll initiative for the summoned demons as a group, which has its own turns. The demons pursue and attack the nearest non-demons to the best of their ability." + "\n   " + "As part of casting the spell, you can form a circle on the ground with the blood used as a material component. The circle is large enough to encompass your space. While the spell lasts, the summoned demons can't cross the circle or harm it, and they can't target anyone within it. Using the material component in this manner consumes it when the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 6th or 7th level, you summon twice as many demons. If you cast it using a spell slot of 8th or 9th level, you summon three times as many demons."
};
SpellsList["synaptic static"] = {
	name : "Synaptic Static",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["X", 167]],
	level : 5,
	school : "Ench",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Instant, 1 min",
	save : "Int",
	description : "20-ft rad all crea Int>2 save or 8d6 Psychic dmg, -1d6 on atks/check/conc. save; save half, no -1d6",
	descriptionShorter : "20-ft rad all crea Int>2 save or 8d6 Psychic dmg, -1d6 on atk/chk/conc save; save half, no -1d6",
	descriptionFull : "You choose a point within range and cause psychic energy to explode there. Each creature in a 20-foot-radius sphere centered on that point must make an Intelligence saving throw. A creature with an Intelligence score of 2 or lower can't be affected by this spell. A target takes 8d6 psychic damage on a failed save, or half as much damage on a successful one." + "\n   " + "After a failed save, a target has muddled thoughts for 1 minute. During that time, it rolls a d6 and subtracts the number rolled from all its attack rolls and ability checks, as well as its Constitution saving throws to maintain concentration. The target can make an Intelligence saving throw at the end of each of its turns, ending the effect on itself on a success."
};
SpellsList["temple of the gods"] = {
	name : "Temple of the Gods",
	classes : ["cleric"],
	source : [["X", 167]],
	level : 7,
	school : "Conj",
	time : "1 h",
	range : "120 ft",
	components : "V,S,M\u0192",
	compMaterial : "A holy symbol worth at least 5 gp",
	duration : "24 h",
	description : "Create a temple 120 ft on a side to the deity of a holy symbol used; see book for effects",
	descriptionFull : "You cause a temple to shimmer into existence on ground you can see within range. The temple must fit within an unoccupied cube of space, up to 120 feet on each side. The temple remains until the spell ends. It is dedicated to whatever god, pantheon, or philosophy is represented by the holy symbol used in the casting." + "\n   " + "You make all decisions about the temple's appearance. The interior is enclosed by a floor, walls, and a roof, with one door granting access to the interior and as many windows as you wish. Only you and any creatures you designate when you cast the spell can open or close the door." + "\n   " + "The temple's interior is an open space with an idol or altar at one end. You decide whether the temple is illuminated and whether that illumination is bright light or dim light. The smell of burning incense fills the air within, and the temperature is mild." + "\n   " + "The temple opposes types of creatures you choose when you cast this spell. Choose one or more of the following: celestials, elementals, fey, fiends, or undead. If a creature of the chosen type attempts to enter the temple, that creature must make a Charisma saving throw. On a failed save, it can't enter the temple for 24 hours. Even if the creature can enter the temple, the magic there hinders it; whenever it makes an attack roll, an ability check, or a saving throw inside the temple, it must roll a d4 and subtract the number rolled from the d20 roll." + "\n   " + "In addition, the sensors created by divination spells can't appear inside the temple, and creatures within can't be targeted by divination spells." + "\n   " + "Finally, whenever any creature in the temple regains hit points from a spell of 1st level or higher, the creature regains additional hit points equal to your Wisdom modifier (minimum 1 hit point)." + "\n   " + "The temple is made from opaque magical force that extends into the Ethereal Plane, thus blocking ethereal travel into the temple's interior. Nothing can physically pass through the temple's exterior. It can't be dispelled by dispel magic, and antimagic field has no effect on it. A disintegrate spell destroys the temple instantly." + "\n   " + "Casting this spell on the same spot once every 7 days for a year makes this effect permanent."
};
SpellsList["tenser's transformation"] = {
	name : "Tenser's Transformation",
	classes : ["wizard"],
	source : [["X", 168]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S,M",
	compMaterial : "A few hairs from a bull",
	duration : "Conc, 10 min",
	description : "50 temp HP; prof Str/Con save, all wea/arm; extra atk; adv., wea atks +2d12 Force dmg; no spellc.",
	descriptionShorter : "50 temp HP; prof Str/Con save, wea/arm; +1 atk; adv, wea atks +2d12 Force dmg; no spellc",
	descriptionFull : "You endow yourself with endurance and martial prowess fueled by magic. Until the spell ends, you can't cast spells, and you gain the following benefits:" + "\n \u2022 " + "You gain 50 temporary hit points. If any of these remain when the spell ends, they are lost." + "\n \u2022 " + "You have advantage on attack rolls that you make with simple and martial weapons." + "\n \u2022 " + "When you hit a target with a weapon attack, that target takes an extra 2d12 force damage." + "\n \u2022 " + "You have proficiency with all armor, shields, simple weapons, and martial weapons." + "\n \u2022 " + "You have proficiency in Strength and Constitution saving throws." + "\n \u2022 " + "You can attack twice, instead of once, when you take the Attack action on your turn. You ignore this benefit if you already have a feature, like Extra Attack, that gives you extra attacks." + "\n   " + "Immediately after the spell ends, you must succeed on a DC 15 Constitution saving throw or suffer one level of exhaustion."
};
SpellsList["thunder step"] = {
	name : "Thunder Step",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 168]],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Con",
	description : "Me + 1 willing crea teleport 90 ft; all crea in 10 ft of origin 3d10+1d10/SL Thunder dmg; save half",
	descriptionShorter : "Me + 1 willing crea teleport 90 ft; all in 10 ft of origin 3d10+1d10/SL Thunder dmg; save half",
	descriptionFull : "You teleport yourself to an unoccupied space you can see within range. Immediately after you disappear, a thunderous boom sounds, and each creature within 10 feet of the space you left must make a Constitution saving throw, taking 3d10 thunder damage on a failed save, or half as much damage on a successful one. The thunder can be heard from up to 300 feet away." + "\n   " + "You can bring along objects as long as their weight doesn't exceed what you can carry. You can also teleport one willing creature of your size or smaller who is carrying gear up to its carrying capacity. The creature must be within 5 feet of you when you cast this spell, and there must be an unoccupied space within 5 feet of your destination space for the creature to appear in; otherwise, the creature is left behind." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d10 for each slot level above 3rd."
};
SpellsList["tiny servant"] = {
	name : "Tiny Servant",
	classes : ["artificer", "wizard"],
	source : [["X", 168]],
	level : 3,
	school : "Trans",
	time : "1 min",
	range : "Touch",
	components : "V,S",
	duration : "8 h",
	description : "Animate 1+2/SL Tiny, nonmagical, unattended obj as tiny servants; bns a to command telepathically",
	descriptionFull : "You touch one Tiny, nonmagical object that isn't attached to another object or a surface and isn't being carried by another creature. The target animates and sprouts little arms and legs, becoming a creature under your control until the spell ends or the creature drops to 0 hit points. See the Tiny Servant stat block for its statistics." + "\n   " + "As a bonus action, you can mentally command the creature if it is within 120 feet of you. (If you control multiple creatures with this spell, you can command any or all of them at the same time, issuing the same command to each one.) You decide what action the creature will take and where it will move during its next turn, or you can issue a simple, general command, such as to fetch a key, stand watch, or stack some books. If you issue no commands, the servant does nothing other than defend itself against hostile creatures. Once given an order, the servant continues to follow that order until its task is complete." + "\n   " + "When the creature drops to 0 hit points, it reverts to its original form, and any remaining damage carries over to that form." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, you can animate two additional objects for each slot level above 3rd."
};
SpellsList["toll the dead"] = {
	name : "Toll the Dead",
	classes : ["cleric", "warlock", "wizard"],
	source : [["X", 169], ["UA:SS", 4]],
	level : 0,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Wis",
	description : "1 crea save or 1d12 Necrotic dmg (d8 instead of d12 if at full HP); +1d12/1d8 at CL 5, 11, \u0026 17",
	descriptionCantripDie : "1 crea save or `CD`d12 Necrotic damage (d8 instead of d12 if at full HP)",
	descriptionFull : "You point at one creature you can see within range, and the sound of a dolorous bell fills the air around it for a moment. The target must succeed on a Wisdom saving throw or take 1d8 necrotic damage. If the target is missing any of its hit points, it instead takes 1d12 necrotic damage." + "\n   " + "The spell's damage increases by one die when you reach 5th level (2d8 or 2d12), 11th level (3d8 or 3d12), and 17th level (4d8 or 4d12)."
};
SpellsList["wall of light"] = {
	name : "Wall of Light",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["X", 170]],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A hand mirror",
	duration : "Conc, 10 min",
	save : "Con",
	description : "60\xD75\xD710ft (l\xD7w\xD7h) 4d8+1d8/SL Radiant dmg \u0026 blind; save half, not blind; 1 a rngd spell atk; see B",
	descriptionShorter : "60|5|10ft (l|w|h) 4d8+1d8/SL Radiant dmg, blind; save half, no blind; 1 a rngd atk; see B",
	descriptionMetric : "18\xD71,5\xD73m (l\xD7w\xD7h) 4d8+1d8/SL Radiant dmg \u0026 blind; save half, not blind; 1 a rngd spell atk; see B",
	descriptionShorterMetric : "18|1,5|3m (l|w|h) 4d8+1d8/SL Radiant dmg, blind; save half, no blind; 1 a rngd atk; see B",
	descriptionFull : "A shimmering wall of bright light appears at a point you choose within range. The wall appears in any orientation you choose: horizontally, vertically, or diagonally. It can be free floating, or it can rest on a solid surface. The wall can be up to 60 feet long, 10 feet high, and 5 feet thick. The wall blocks line of sight, but creatures and objects can pass through it. It emits bright light out to 120 feet and dim light for an additional 120 feet." + "\n   " + "When the wall appears, each creature in its area must make a Constitution saving throw. On a failed save, a creature takes 4d8 radiant damage, and it is blinded for 1 minute. On a successful save, it takes half as much damage and isn't blinded. A blinded creature can make a Constitution saving throw at the end of each of its turns, ending the effect on itself on a success." + "\n   " + "A creature that ends its turn in the wall's area takes 4d8 radiant damage." + "\n   " + "Until the spell ends, you can use an action to launch a beam of radiance from the wall at one creature you can see within 60 feet of it. Make a ranged spell attack. On a hit, the target takes 4d8 radiant damage. Whether you hit or miss, reduce the length of the wall by 10 feet. If the wall's length drops to 0 feet, the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, the damage increases by 1d8 for each slot level above 5th."
};
SpellsList["word of radiance"] = {
	name : "Word of Radiance",
	classes : ["cleric"],
	source : [["X", 171]],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "5 ft",
	components : "V,M",
	compMaterial : "A holy symbol",
	duration : "Instantaneous",
	save : "Con",
	description : "Any crea within range save or 1d6 Radiant damage; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "Any crea within range save or `CD`d6 Radiant damage",
	descriptionFull : "You utter a divine word, and burning radiance erupts from you. Each creature of your choice that you can see within range must succeed on a Constitution saving throw or take 1d6 radiant damage." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["wrath of nature"] = {
	name : "Wrath of Nature",
	classes : ["druid", "ranger"],
	source : [["X", 171]],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "60-ft cu dif. ter.; rock: rngd atk 3d8 Bludg. dmg; tree: Dex or 4d6 Slash. dmg; root: Str or restr.; see B",
	descriptionShorter : "60-ft cu dif. ter.; rock: atk 3d8 Bludg. dmg; tree: Dex or 4d6 Slash. dmg; root: Str or restrain",
	descriptionFull : "You call out to the spirits of nature to rouse them against your enemies. Choose a point you can see within range. The spirits cause trees, rocks, and grasses in a 60-foot cube centered on that point to become animated until the spell ends." + "\n   " + toUni("Grasses and Undergrowth") + ": Any area of ground in the cube that is covered by grass or undergrowth is difficult terrain for your enemies." + "\n   " + toUni("Trees") + ": At the start of each of your turns, each of your enemies within 10 feet of any tree in the cube must succeed on a Dexterity saving throw or take 4d6 slashing damage from whipping branches." + "\n   " + toUni("Roots and Vines") + ": At the end of each of your turns, one creature of your choice that is on the ground in the cube must succeed on a Strength saving throw or become restrained until the spell ends. A restrained creature can use an action to make a Strength (Athletics) check against your spell save DC, ending the effect on itself on a success." + "\n   " + toUni("Rocks") + ": As a bonus action on your turn, you can cause a loose rock in the cube to launch at a creature you can see in the cube. Make a ranged spell attack against the target. On a hit, the target takes 3d8 nonmagical bludgeoning damage, and it must succeed on a Strength saving throw or fall prone."
};
SpellsList["zephyr strike"] = { 
	name : "Zephyr Strike",
	classes : ["ranger"],
	source : [["X", 171]],
	level : 1,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	description : "Moving doesn't provoke opportunity atks; once: adv. on wea atk, +1d8 Force dmg, +30 ft spd for turn",
	descriptionShorter : "Moving doesn't provoke opport. atks; once: adv. on wea atk, +1d8 Force dmg, +30 ft spd for turn",
	descriptionFull : "You move like the wind. Until the spell ends, your movement doesn't provoke opportunity attacks." + "\n   " + "Once before the spell ends, you can give yourself advantage on one weapon attack roll on your turn. That attack deals an extra 1d8 force damage on a hit. Whether you hit or miss, your walking speed increases by 30 feet until the end of that turn.",
	dynamicDamageBonus : { multipleDmgMoments : false }
};

// Add weapons (attack cantrips)
WeaponsList["create bonfire"] = {
	regExpSearch : /^(?=.*create)(?=.*bonfire).*$/i,
	name : "Create Bonfire",
	source : [["X", 152], ["E", 16]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 8, "fire"],
	range : "60 ft",
	description : "5-ft cube; Dex save at casting or when moved into, success - no damage; Conc, 1 min",
	abilitytodamage : false,
	dc : true
};
WeaponsList["frostbite"] = {
	regExpSearch : /frostbite/i,
	name : "Frostbite",
	source : [["X", 156], ["E", 18]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "cold"],
	range : "60 ft",
	description : "Con save, success - no damage, fail - also disadv. on next weapon attack roll in next turn; 1 creature",
	abilitytodamage : false,
	dc : true
};
WeaponsList["infestation"] = {
	regExpSearch : /infestation/i,
	name : "Infestation",
	source : [["X", 158]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "poison"],
	range : "30 ft",
	description : "Con save, success - no damage, fail - target also moved 5 ft in random direction",
	abilitytodamage : false,
	dc : true
};
WeaponsList["magic stone"] = {
	regExpSearch : /^(?=.*magic)(?=.*stone).*$/i,
	name : "Magic Stone",
	source : [["X", 160], ["E", 20]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : [1, 6, "bludgeoning"],
	range : "60/120 ft",
	description : "Produces 3 stones that each can be thrown (60 ft) or hurled with a sling (120 ft) as a spell attack",
	abilitytodamage : true
};
WeaponsList["primal savagery"] = {
	regExpSearch : /^(?=.*primal)(?=.*savagery).*$/i,
	name : "Primal Savagery",
	source : [["X", 169]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 10, "acid"],
	range : "Melee (5 ft)",
	description : "",
	abilitytodamage : false
};
WeaponsList["thunderclap"] = {
	regExpSearch : /thunderclap/i,
	name : "Thunderclap",
	source : [["X", 168], ["E", 22]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "thunder"],
	range : "5-ft radius",
	description : "Con save, success - no damage; all creatures in area; audible in 100 ft",
	abilitytodamage : false,
	dc : true
};
WeaponsList["toll the dead"] = {
	regExpSearch : /^(?=.*toll)(?=.*the)(?=.*dead).*$/i,
	name : "Toll the Dead",
	source : [["X", 169], ["UA:SS", 4]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 12, "necrotic"],
	range : "60 ft",
	description : "Wis save, success - no damage; If target is at full HP, d8 instead of d12 damage",
	abilitytodamage : false,
	dc : true
};
WeaponsList["word of radiance"] = {
	regExpSearch : /^(?=.*word)(?=.*radiance).*$/i,
	name : "Word of Radiance",
	source : [["X", 171]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 6, "radiant"],
	range : "5-ft radius",
	description : "Con save, success - no damage; Only chosen creatures I can see are affected",
	abilitytodamage : false,
	dc : true
};

// Companion options (Find Greater Steed spell)
CompanionList.steed = {
	name : "Find Greater Steed",
	nameTooltip : "the Find Greater Steed spell",
	nameOrigin : "4th-level conjuration spell",
	nameMenu : "Greater steed (Find Greater Steed spell)",
	source : [["X", 156]],
	action : [["action", "Find Greater Steed (dismiss)"]],
	attributesAdd : {
		header : "Mount",
		type : ["Celestial", "Fey", "Fiend"],
		subtype : "",
		features : [{
			name : "Find Greater Steed",
			description : "If dropped to 0 HP, the steed disappears, leaving behind no physical form."
		}],
		languages : "understands one language its master speaks (master's choice)"
	},
	attributesChange : function(sCrea, objCrea) {
		if (objCrea.scores[3] < 6) objCrea.scores[3] = 6;
	},
	notes : function() {
		if (!CompanionList.mount) return;
		var a = newObj(CompanionList.mount.notes);
		a[0].description = a[0].description.replace(/It assumes a chosen form.*/i, "It has the chosen form: griffon, pegasus, peryton, dire wolf, rhinoceros, or saber-toothed tiger");
		return a;
	}()
};

// Add creatures
CreatureList["tiny servant"] = { // Stats for the Tiny Servant spell (contains contributions by SoilentBrad)
	name : "Tiny Servant",
	source : [["X", 169]],
	size : 5,
	type : "Construct",
	alignment : "Unaligned",
	ac : 15,
	hp : 10,
	hd : [4, 4],
	speed : "30 ft, climb 30 ft",
	scores : [4, 16, 10, 2, 10, 1],
	damage_immunities : "poison, psychic",
	condition_immunities : "blinded, charmed, deafened, exhaustion, frightened, paralyzed, petrified, poisoned",
	senses : "Blindsight 60 ft (blind beyond this radius)",
	passivePerception : 10,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Slam",
		ability : 2,
		damage : [1, 4, "bludgeoning"],
		range : "Melee (5 ft)",
		description : ""
	}]
};

// Magic Items
MagicItemsList["adamantine ammunition"] = {
	name : "Adamantine Ammunition",
	source : [["X", 78]],
	type : "weapon (any ammunition)",
	rarity : "unknown",
	description : "Whenever a ammunition made or coated with adamantine hits an object, the hit is a critical hit. The adamantine version of ten pieces of ammunition costs 500 gp more than the normal version, whether the ammunition is made of the metal or coated with it.",
	descriptionFull : "Ammunition made of or coated with adamantine is unusually effective when used to break objects. Whenever a piece of adamantine ammunition hits an object, the hit is a critical hit.\n   The adamantine version of ten pieces of ammunition costs 500 gp more than the normal version, whether the ammunition is made of the metal or coated with it.",
	allowDuplicates : true,
	chooseGear : {
		type : "ammo",
		prefixOrSuffix : "brackets",
		itemName1stPage : ["suffix", "Adamantine"],
		descriptionChange : ["replace", "ammunition"],
		excludeCheck : function (inObjKey, inObj) {
			return /vials|flasks/i.test(inObj.icon);
		}
	}
}
MagicItemsList["adamantine weapon"] = {
	name : "Adamantine Weapon",
	source : [["X", 78]],
	type : "weapon (any melee)",
	rarity : "unknown",
	description : "Whenever a weapon made or coated with adamantine hits an object, the hit is a critical hit. The adamantine version of a melee weapon costs 500 gp more than the normal version, whether the weapon is made of the metal or coated with it.",
	descriptionFull : "Melee weapons made of or coated with adamantine are unusually effective when used to break objects. Whenever an adamantine weapon hits an object, the hit is a critical hit.\n   The adamantine version of a melee weapon costs 500 gp more than the normal version, whether the weapon is made of the metal or coated with it.",
	allowDuplicates : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "brackets",
		itemName1stPage : ["suffix", "Adamantine"],
		descriptionChange : ["replace", "weapon"],
		excludeCheck : function (inObjKey, inObj) {
			return inObj.list != "melee";
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.list == "melee" && (/adamantine/i).test(v.WeaponTextName)) {
					fields.Description += (fields.Description ? '; ' : '') + 'Always critical hits on objects';
				}
			},
			'If I include the word "Adamantine" in the name of a melee weapon, it will be treated as the magic item Adamantine Weapon. Whenever it hits an object, it automatically scores a critical hit.'
		]
	}
}
MagicItemsList["armor of gleaming"] = {
	name : "Armor of Gleaming",
	nameTest : "of Gleaming",
	source : [["X", 136]],
	type : "armor (medium, or heavy)",
	rarity : "common",
	description : "This armor never gets dirty.",
	descriptionFull : "This armor never gets dirty.",
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "prefix",
		descriptionChange : ["prefix", "armor"],
		excludeCheck : function (inObjKey, inObj) {
			return !(/medium|heavy/i).test(inObj.type);
		}
	}
}
MagicItemsList["bead of nourishment"] = {
	name : "Bead of Nourishment",
	source : [["X", 136]],
	type : "wondrous item",
	rarity : "common",
	description : "Once I can eat this spongy, flavorless, gelatinous bead. It dissolves on my tongue and provides as much nourishment as 1 day of rations.",
	descriptionFull : "This spongy, flavorless, gelatinous bead dissolves on your tongue and provides as much nourishment as 1 day of rations."
}
MagicItemsList["bead of refreshment"] = {
	name : "Bead of Refreshment",
	source : [["X", 136]],
	type : "wondrous item",
	rarity : "common",
	description : "Once I can drop this spongy, flavorless, gelatinous bead in liquid. It dissolves in the liquid and transforms up to a pint of it into fresh, cold drinking water. The bead has no effect on magical liquids or harmful substances such as poison.",
	descriptionFull : "This spongy, flavorless, gelatinous bead dissolves in liquid, transforming up to a pint of the liquid into fresh, cold drinking water. The bead has no effect on magical liquids or harmful substances such as poison."
}
MagicItemsList["boots of false tracks"] = {
	name : "Boots of False Tracks",
	source : [["X", 136]],
	type : "wondrous item",
	rarity : "common",
	description : "Only humanoids can wear these boots. While wearing the boots, I can choose to have them leave tracks like those of another kind of humanoid of my size.",
	descriptionFull : "Only humanoids can wear these boots. While wearing the boots, you can choose to have them leave tracks like those of another kind of humanoid of your size."
}
MagicItemsList["candle of the deep"] = {
	name : "Candle of the Deep",
	source : [["X", 136]],
	type : "wondrous item",
	rarity : "common",
	description : "The flame of this candle is not extinguished when immersed in water. It gives off light and heat like a normal candle.",
	descriptionFull : "The flame of this candle is not extinguished when immersed in water. It gives off light and heat like a normal candle."
}
MagicItemsList["cast-off armor"] = {
	name : "Cast-Off Armor",
	nameTest : "Cast-Off",
	source : [["X", 136]],
	type : "armor (light, medium, or heavy)",
	rarity : "common",
	description : "As an action, I can doff this armor.",
	descriptionFull : "You can doff this armor as an action.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		descriptionChange : ["prefix", "armor"]
	},
	action : [["action", ""]]
}
MagicItemsList["charlatan's die"] = {
	name : "Charlatan's Die",
	source : [["X", 136]],
	type : "wondrous item",
	rarity : "common",
	description : "Whenever I roll this six-sided die, I can control which number it rolls.",
	descriptionFull : "Whenever you roll this six-sided die, you can control which number it rolls.",
	attunement : true
}
MagicItemsList["cloak of billowing"] = {
	name : "Cloak of Billowing",
	source : [["X", 136]],
	type : "wondrous item",
	rarity : "common",
	description : "As a bonus action while wearing this cloak, I can make it billow dramatically.",
	descriptionFull : "While wearing this cloak, you can use a bonus action to make it billow dramatically.",
	action : [["bonus action", ""]]
}
MagicItemsList["cloak of many fashions"] = {
	name : "Cloak of Many Fashions",
	source : [["X", 136], ["WBtW", 208]],
	type : "wondrous item",
	rarity : "common",
	description : "As a bonus action while wearing this cloak, I can change its style, color, and apparent qualities. The cloak's weight doesn't change. Regardless of its appearance, the cloak can't be anything but a cloak. Although it can duplicate the appearance of other magic cloaks, it doesn't gain their magical properties.",
	descriptionFull : "While wearing this cloak, you can use a bonus action to change the style, color, and apparent quality of the garment. The cloak's weight doesn't change. Regardless of its appearance, the cloak can't be anything but a cloak. Although it can duplicate the appearance of other magic cloaks, it doesn't gain their magical properties.",
	action : [["bonus action", ""]]
}
MagicItemsList["clockwork amulet"] = {
	name : "Clockwork Amulet",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "Once per dawn when I make an attack roll while wearing this copper amulet, I can forgo rolling the d20 to get a 10 on the die. The amulet contains tiny interlocking gears powered by magic from Mechanus, a plane of clockwork predictability. When I hold it up to my ear, I can hear faint ticking and whirring noises.",
	descriptionFull : "This copper amulet contains tiny interlocking gears and is powered by magic from Mechanus, a plane of clockwork predictability. A creature that puts an ear to the amulet can hear faint ticking and whirring noises coming from within.\n   When you make an attack roll while wearing the amulet, you can forgo rolling the d20 to get a 10 on the die. Once used. this property can't be used again until the next dawn.",
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["clothes of mending"] = {
	name : "Clothes of Mending",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "This elegant outfit of traveler's clothes magically mends itself to counteract daily wear and tear. Pieces of the outfit that are destroyed can't be repaired in this way.",
	descriptionFull : "This elegant outfit of traveler's clothes magically mends itself to counteract daily wear and tear. Pieces of the outfit that are destroyed can't be repaired in this way.",
	weight : 4
}
MagicItemsList["dark shard amulet"] = {
	name : "Dark Shard Amulet",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "I can use this amulet of extraplanar material from the realm of my warlock patron as a spellcasting focus for my warlock spells. Once per long rest, I can use it to cast a warlock cantrip that I don't know. To do so, I must make a DC 10 Intelligence (Arcana) check, wasting the attempt as well as my action if I fail.",
	descriptionFull : "This amulet is fashioned from a single shard of resilient extraplanar material originating from the realm of your warlock patron. While you are wearing it, you gain the following benefits:\n \u2022 You can use the amulet as a spellcasting focus for your warlock spells.\n \u2022 You can try to cast a cantrip that you don't know. The cantrip must be on the warlock spell list, and you must make a DC 10 Intelligence (Arcana) check. If the check succeeds, you cast the spell. If the check fails, so does the spell, and the action used to cast the spell is wasted. In either case, you can't use this property again until you finish a long rest.",
	attunement : true,
	prerequisite : "Requires attunement by a warlock",
	prereqeval : function (v) { return classes.known.warlock ? true : false; },
	usages : 1,
	recovery : "long rest",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Remove the already known cantrips, from any source except magic items
				if (spName === 'dark shard amulet') {
					var allSpellsKnown = [];
					for (var sCast in CurrentSpells) {
						if (sCast.refType === "item") continue;
						var oCast = CurrentSpells[sCast];
						if (oCast.selectCa) allSpellsKnown = allSpellsKnown.concat(oCast.selectCa);
						if (oCast.selectBo) allSpellsKnown = allSpellsKnown.concat(oCast.selectBo);
					}
					var knownCantrips = OrderSpells(allSpellsKnown, "single", false, false, 0);
					if (!spList.notspells) spList.notspells = [];
					spList.notspells = spList.notspells.concat(knownCantrips);
				}
			}
		],
		spellAdd : [
			function (spellKey, spellObj, spName, isDuplicate) {
				if (spName == 'warlock-dark shard amulet') {
					spellObj.firstCol = "";
				};
			}
		]
	},
	eval : function () {
		CurrentSpells['warlock-dark shard amulet'] = {
			name : 'Dark Shard Amulet (item)',
			ability : "warlock",
			list : { 'class' : 'warlock', level : [0, 0] },
			known : { cantrips : 0, spells : 'list' },
			bonus : {
				bon1 : {
					name : 'Just select "Full List"',
					spells : []
				},
				bon2 : {
					name : 'on the bottom left',
					spells : []
				}
			},
			typeList : 4,
			refType : "item",
			allowUpCasting : true,
			firstCol : ""
		};
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	removeeval : function () {
		delete CurrentSpells['dark shard amulet'];
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	}
}
MagicItemsList["dread helm"] = {
	name : "Dread Helm",
	source : [["X", 137], ["WBtW", 209]],
	type : "wondrous item",
	rarity : "common",
	description : "This fearsome steel helm makes my eyes glow red while I wear it.",
	descriptionFull : "This fearsome steel helm makes your eyes glow red while you wear it.",
	weight : 1
}
MagicItemsList["ear horn of hearing"] = {
	name : "Ear Horn of Hearing",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "While held up to my ear, this horn suppresses the effects of the deafened condition on me, allowing me to hear normally.",
	descriptionFull : "While held up to your ear, this horn suppresses the effects of the deafened condition on you, allowing you to hear normally.",
	savetxt : { immune : ["deafened"] },
	weight : 1
}
MagicItemsList["enduring spellbook"] = {
	name : "Enduring Spellbook",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "This spellbook, along with anything written on its pages, can't be damaged by fire or immersion in water. In addition, the spellbook doesn't deteriorate with age.",
	descriptionFull : "This spellbook, along with anything written on its pages, can't be damaged by fire or immersion in water. In addition, the spellbook doesn't deteriorate with age.",
	weight : 5
}
MagicItemsList["ersatz eye"] = {
	name : "Ersatz Eye",
	source : [["X", 137], ["W", 267]],
	type : "wondrous item",
	rarity : "common",
	description : "This artificial eye replaces a real one that was lost or removed. While the ersatz eye is embedded in my eye socket, it can't be removed by anyone other than me, and I can see through the tiny orb as though it were a normal eye.",
	descriptionFull : "This artificial eye replaces a real one that was lost or removed. While the ersatz eye is embedded in your eye socket, it can't be removed by anyone other than you, and you can see through the tiny orb as though it were a normal eye.",
	attunement : true
}
MagicItemsList["hat of vermin"] = {
	name : "Hat of Vermin",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "This hat has 3 charges, regaining all at dawn. As an action while holding it, I can expend 1 charge and speak a command word to have one bat, frog, or rat appear in the hat. The creature acts as an ordinary member of its kind and disappears after 1 hour or when it has 0 HP. It is not under my control.",
	descriptionFull : "This hat has 3 charges. While holding the hat, you can use an action to expend 1 of its charges and speak a command word that summons your choice of a bat, a frog, or a rat. The summoned creature magically appears in the hat and tries to get away from you as quickly as possible. The creature is neither friendly nor hostile, and it isn't under your control. It behaves as an ordinary creature of its kind and disappears after 1 hour or when it drops to 0 hit points. The hat regains all expended charges daily at dawn.",
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["hat of wizardry"] = {
	name : "Hat of Wizardry",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "I can use this antiquated, cone-shaped hat adorned with gold crescent moons and stars as a spellcasting focus for my wizard spells. Once per long rest, I can use it to cast a wizard cantrip that I don't know. To do so, I must make a DC 10 Intelligence (Arcana) check, wasting the attempt as well as my action if I fail.",
	descriptionFull : "This antiquated, cone-shaped hat is adorned with gold crescent moons and stars. While you are wearing it, you gain the following benefits:\n \u2022 You can use the hat as a spellcasting focus for your wizard spells.\n \u2022 You can try to cast a cantrip that you don't know. The cantrip must be on the wizard spell list, and you must make a DC 10 Intelligence (Arcana) check. If the check succeeds, you cast the spell. If the check fails, so does the spell, and the action used to cast the spell is wasted. In either case, you can't use this property again until you finish a long rest.",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function (v) { return classes.known.wizard ? true : false; },
	usages : 1,
	recovery : "long rest",
	eval : function () {
		CurrentSpells['hat of wizardry'] = {
			name : 'Hat of Wizardry (item)',
			ability : "wizard",
			list : { 'class' : 'wizard', level : [0, 0] },
			known : { cantrips : 0, spells : 'list' },
			bonus : {
				bon1 : {
					name : 'Just select "Full List"',
					spells : []
				},
				bon2 : {
					name : 'on the bottom left',
					spells : []
				}
			},
			typeList : 4,
			refType : "item",
			allowUpCasting : true,
			firstCol : ""
		};
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	removeeval : function () {
		delete CurrentSpells['hat of wizardry'];
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Remove the already known cantrips, from any source except magic items
				if (spName === 'hat of wizardry') {
					var allSpellsKnown = [];
					for (var sCast in CurrentSpells) {
						if (sCast.refType === "item") continue;
						var oCast = CurrentSpells[sCast];
						if (oCast.selectCa) allSpellsKnown = allSpellsKnown.concat(oCast.selectCa);
						if (oCast.selectBo) allSpellsKnown = allSpellsKnown.concat(oCast.selectBo);
					}
					var knownCantrips = OrderSpells(allSpellsKnown, "single", false, false, 0);
					if (!spList.notspells) spList.notspells = [];
					spList.notspells = spList.notspells.concat(knownCantrips);
				}
			}
		],
		spellAdd : [
			function (spellKey, spellObj, spName, isDuplicate) {
				if (spName === 'hat of wizardry') {
					spellObj.firstCol = "";
				};
			}
		]
	},
}
MagicItemsList["heward's handy spice pouch"] = {
	name : "Heward's Handy Spice Pouch",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "This belt pouch appears empty. It has 10 charges, regaining 1d6+4 expended charges at dawn. As an action while holding it, I can speak the name of any nonmagical food seasoning (e.g. salt, pepper, or saffron), and remove a pinch of the desired seasoning from the pouch. A pinch is enough to season a single meal.",
	descriptionFull : "This belt pouch appears empty and has 10 charges. While holding the pouch, you can use an action to expend 1 of its charges, speak the name of any nonmagical food seasoning (such as salt, pepper, saffron, or cilantro), and remove a pinch of the desired seasoning from the pouch. A pinch is enough to season a single meal. The pouch regains 1d6+4 expended charges daily at dawn.",
	weight : 1,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4"
}
MagicItemsList["horn of silent alarm"] = {
	name : "Horn of Silent Alarm",
	source : [["X", 137]],
	type : "wondrous item",
	rarity : "common",
	description : "This horn has 4 charges, regaining 1d4 expended charges daily at dawn. As an action, I can expend 1 charge and blow it, have only one creature within 600 ft of my choice hear the horn's blare, provided it isn't deafened. No other creature hears sound coming from the horn.",
	descriptionFull : "This horn has 4 charges. When you use an action to blow it, one creature of your choice can hear the horn's blare, provided the creature is within 600 feet of the horn and not deafened. No other creature hears sound coming from the horn. The horn regains 1d4 expended charges daily at dawn.",
	weight : 2,
	usages : 4,
	recovery : "dawn",
	additional : "regains 1d4",
	action : [["action", ""]]
}
MagicItemsList["instrument of illusions"] = { // contains contributions by AelarTheElFRogue
	name : "Instrument of Illusions",
	source : [["X", 137]],
	type : "wondrous item (instrument)",
	rarity : "common",
	description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 5-ft-radius (15-ft for bards) sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing.",
	descriptionFull : "While you are playing this musical instrument, you can create harmless, illusory visual effects within a 5-foot-radius sphere centered on the instrument. If you are a bard, the radius increases to 15 feet. Sample visual effects include luminous musical notes, a spectral dancer, butterflies, and gently falling snow. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when you stop playing.",
	attunement : true,
	weight : 3, // same as instrument of the bards
	choices : ["Bard (15-ft radius)", "Not a Bard (5-ft radius)"],
	selfChoosing : function () {
		return classes.known.bard ? "bard (15-ft radius)" : "not a bard (5-ft radius)";
	},
	"bard (15-ft radius)" : {
		name : "Instrument\u200A of Illusions",
		description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 15-ft-radius sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing."
	},
	"not a bard (5-ft radius)" : {
		name : "Instrument\u200A\u200A of Illusions",
		description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 5-ft-radius sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing."
	}
}
MagicItemsList["instrument of scribing"] = {
	name : "Instrument of Scribing",
	source : [["X", 138], ["WBtW", 212]],
	type : "wondrous item (instrument)",
	rarity : "common",
	description : "As an action while I'm playing this musical instrument, I can write a magical message on a nonmagical surface that I can see within 30 ft. The message can be up to 6 (or 7) words in a language I know and fades away after 24 hours or when Dispel Magic is cast on it. The instrument can be used like this 3 times per dawn.",
	descriptionFull : "This musical instrument has 3 charges. While you are playing it, you can use an action to expend 1 charge from the instrument and write a magical message on a nonmagical object or surface that you can see within 30 feet of you. The message can be up to six words long and is written in a language you know. If you are a bard, you can scribe an additional seven words and choose to make the message glow faintly, allowing it to be seen in nonmagical darkness. Casting Dispel Magic on the message erases it. Otherwise, the message fades away after 24 hours.\n   The instrument regains all expended charges daily at dawn.",
	attunement : true,
	weight : 3, // same as instrument of the bards
	choices : ["Bard (15-ft radius)", "Not a Bard (5-ft radius)"],
	selfChoosing : function () {
		return classes.known.bard ? "bard (15-ft radius)" : "not a bard (5-ft radius)";
	},
	"bard (15-ft radius)" : {
		name : "Instrument\u200A of Scribing",
		description : "As an action while I'm playing this musical instrument, I can write a magical message on a nonmagical surface that I can see within 30 ft. The message can be up to 7 words in a language I know and I can have it glow faintly. Dispel Magic erases it, otherwise it fades away after 24 hours. This can be used 3 times per dawn."
	},
	"not a bard (5-ft radius)" : {
		name : "Instrument\u200A\u200A of Scribing",
		description : "As an action while I'm playing this musical instrument, I can write a magical message on a nonmagical surface that I can see within 30 ft. The message can be up to 6 words in a language I know and fades away after 24 hours or when Dispel Magic is cast on it. The instrument can be used like this 3 times per dawn."
	}
}
MagicItemsList["lock of trickery"] = {
	name : "Lock of Trickery",
	source : [["X", 138]],
	type : "wondrous item",
	rarity : "common",
	description : "This lock appears to be an ordinary lock and comes with a single key. The tumblers in this lock magically adjust to thwart burglars. Without the key, a creature proficient with thieves' tools can pick this lock with a successful DC 15 Dexterity check, but has disadvantage on that check.",
	descriptionFull : "This lock appears to be an ordinary lock and comes with a single key. The tumblers in this lock magically adjust to thwart burglars. Dexterity checks made to pick the lock have disadvantage. Thus, without the key, a creature proficient with thieves' tools can pick this lock with a successful DC 15 Dexterity check, but has disadvantage on that check.",
	weight : 1
}
MagicItemsList["moon-touched sword"] = {
	name : "Moon-Touched Sword",
	nameTest : "Moon-Touched",
	source : [["X", 138]],
	type : "weapon (any sword)",
	rarity : "common",
	description : "In darkness, the unsheathed blade of this sword sheds moonlight, creating bright light in a 15-ft radius and dim light for an additional 15 ft.",
	descriptionFull : "In darkness, the unsheathed blade of this sword sheds moonlight, creating bright light in a 15-foot radius and dim light for an additional 15 feet.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/moon.touched/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
				}
			},
			'If I include the words "Moon-Touched" in the name of a sword, it will be treated as the magic weapon Moon-Touched Sword.'
		]
	}
}
MagicItemsList["mystery key"] = {
	name : "Mystery Key",
	source : [["X", 138]],
	type : "wondrous item",
	rarity : "common",
	description : "A question mark is worked into the head of this key. The key has a 5% chance of unlocking any lock into which it's inserted. Once it unlocks something, the key disappears.",
	descriptionFull : "A question mark is worked into the head of this key. The key has a 5% chance of unlocking any lock into which it's inserted. Once it unlocks something, the key disappears."
}
MagicItemsList["orb of direction"] = {
	name : "Orb of Direction",
	source : [["X", 138], ["WBtW", 212]],
	type : "wondrous item",
	rarity : "common",
	description : "As an action while holding this orb, I can determine which way is north. This property functions only on the Material Plane.",
	descriptionFull : "While holding this orb, you can use an action to determine which way is north. This property functions only on the Material Plane.",
	weight : 3,
	action : [["action", ""]]
}
MagicItemsList["orb of time"] = {
	name : "Orb of Time",
	source : [["X", 138]],
	type : "wondrous item",
	rarity : "common",
	description : "As an action while holding this orb, I can determine whether it is morning, afternoon, evening, or nighttime outside. This property functions only on the Material Plane.",
	descriptionFull : "While holding this orb, you can use an action to determine whether it is morning, afternoon, evening, or nighttime outside. This property functions only on the Material Plane.",
	weight : 3,
	action : [["action", ""]]
}
MagicItemsList["perfume of bewitching"] = {
	name : "Perfume of Bewitching",
	source : [["X", 138]],
	type : "wondrous item",
	rarity : "common",
	description : "Once as an action, I can apply the perfume in this tiny vial to myself and its effect lasts 1 hour. For the duration, I have advantage on all Charisma checks directed at humanoids of challenge rating 1 or lower. Those subjected to the perfume's effect are not aware that they've been influenced by magic.",
	descriptionFull : "This tiny vial contains magic perfume, enough for one use. You can use an action to apply the perfume to yourself, and its effect lasts 1 hour. For the duration, you have advantage on all Charisma checks directed at humanoids of challenge rating 1 or lower. Those subjected to the perfume's effect are not aware that they've been influenced by magic."
}
MagicItemsList["pipe of smoke monsters"] = {
	name : "Pipe of Smoke Monsters",
	source : [["X", 138], ["WBtW", 212]],
	type : "wondrous item",
	rarity : "common",
	description : "As an action while smoking this pipe, I can exhale a puff of smoke that takes the form of a single creature, such as a dragon, a flumph, or a froghemoth. The form must be small enough to fit in a 1-ft cube and loses its shape after a few seconds, becoming an ordinary puff of smoke.",
	descriptionFull : "While smoking this pipe, you can use an action to exhale a puff of smoke that takes the form of a single creature, such as a dragon, a flumph, or a froghemoth. The form must be small enough to fit in a 1-foot cube and loses its shape after a few seconds, becoming an ordinary puff of smoke."
}
MagicItemsList["pole of angling"] = {
	name : "Pole of Angling",
	source : [["X", 138]],
	type : "wondrous item",
	rarity : "common",
	description : "While holding this 10 ft pole, I can speak a command word and transform it into a fishing pole with a hook, a line, and a reel. Speaking the command word again changes the fishing pole back into a normal 10 ft pole.",
	descriptionFull : "While holding this 10-foot pole, you can speak a command word and transform it into a fishing pole with a hook, a line, and a reel. Speaking the command word again changes the fishing pole back into a normal 10-foot pole.",
	weight : 7
}
MagicItemsList["pole of collapsing"] = {
	name : "Pole of Collapsing",
	source : [["X", 138], ["WBtW", 212]],
	type : "wondrous item",
	rarity : "common",
	description : "As an action while holding this 10 ft pole, I can speak a command word to have it collapse into a 1-ft-long rod. The pole's weight doesn't change. As an action while holding the rod, I can speak a different command word to have it elongate back to a pole, but only as long as the surrounding space allows.",
	descriptionFull : "While holding this 10-foot pole, you can use an action to speak a command word and cause it to collapse into a 1-foot-long rod, for ease of storage. The pole's weight doesn't change. You can use an action to speak a different command word and cause the rod to revert to a pole; however, the rod will elongate only as far as the surrounding space allows.",
	weight : 7,
	action : [["action", ""]]
}
MagicItemsList["pot of awakening"] = {
	name : "Pot of Awakening",
	source : [["X", 138]],
	type : "wondrous item",
	rarity : "common",
	description : "If I plant an ordinary shrub in this 10 lb clay pot and let it grow for 30 days, the shrub magically transforms into an awakened shrub at the end of that time. When the shrub awakens, its roots break the pot, destroying it. The awakened shrub is friendly toward me. Absent commands from me, it does nothing.",
	descriptionFull : "If you plant an ordinary shrub in this 10-pound clay pot and let it grow for 30 days, the shrub magically transforms into an awakened shrub at the end of that time. When the shrub awakens, its roots break the pot, destroying it.\n   The awakened shrub is friendly toward you. Absent commands from you, it does nothing.",
	weight : 10
}
MagicItemsList["rope of mending"] = {
	name : "Rope of Mending",
	source : [["X", 138]],
	type : "wondrous item",
	rarity : "common",
	description : "I can cut this 50-foot coil of hempen rope into any number of smaller pieces, and then use an action to speak a command word and cause the pieces to knit back together. The pieces must be in contact with each other and not otherwise in use. A rope of mending is forever shortened if a section of it is lost.",
	descriptionFull : "You can cut this 50-foot coil of hempen rope into any number of smaller pieces, and then use an action to speak a command word and cause the pieces to knit back together. The pieces must be in contact with each other and not otherwise in use. A rope of mending is forever shortened if a section of it is lost or destroyed.",
	action : [["action", ""]],
	weight : 10
}
MagicItemsList["ruby of the war mage"] = {
	name : "Ruby of the War Mage",
	source : [["X", 138]],
	type : "wondrous item",
	rarity : "common",
	description : "By pressing this 1-inch-diameter ruby etched with eldritch runes to a simple or martial weapon for 10 minutes, it attaches itself to the weapon. I can then use that weapon as a spellcasting focus. Once attached, it can't be removed unless my attunement ends, I detach it as an action, or the weapon is destroyed.",
	descriptionFull : "Etched with eldritch runes, this 1-inch-diameter ruby allows you to use a simple or martial weapon as a spellcasting focus for your spells. For this property to work, you must attach the ruby to the weapon by pressing the ruby against it for at least 10 minutes. Thereafter, the ruby can't be removed unless you detach it as an action or the weapon is destroyed. Not even an Antimagic Field causes it to fall off. The ruby does fall off the weapon if your attunement to the ruby ends.",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; }
}
MagicItemsList["shield of expression"] = {
	name : "Shield of Expression",
	source : [["X", 139]],
	type : "shield",
	rarity : "common",
	description : "The front of this shield is shaped in the likeness of a face. As a bonus action while bearing the shield, I can have the shield alter the expression of the face.",
	descriptionFull : "The front of this shield is shaped in the likeness of a face. While bearing the shield, you can use a bonus action to alter the face's expression.",
	weight : 6,
	shieldAdd : "Shield of Expression",
	action : [["bonus action", ""]]
}
MagicItemsList["smoldering armor"] = {
	name : "Smoldering Armor",
	nameTest : "Smoldering",
	source : [["X", 139]],
	type : "armor (light, medium, or heavy)",
	rarity : "common",
	description : "Wisps of harmless, odorless smoke rise from this armor while it is worn.",
	descriptionFull : "Wisps of harmless, odorless smoke rise from this armor while it is worn.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		descriptionChange : ["prefix", "armor"]
	}
}
MagicItemsList["staff of adornment"] = {
	name : "Staff of Adornment",
	source : [["X", 139]],
	type : "staff",
	rarity : "common",
	description : "If I place an object up to 1 lb above the tip of the staff while holding it, the object floats 1 inch from its tip and remains there until it is removed or until I no longer possess the staff. It can have up to three objects floating over its tip at any given time and I can make one or more objects slowly spin or turn in place.",
	descriptionFull : "If you place an object weighing no more than 1 pound (such as a shard of crystal, an egg, or a stone) above the tip of the staff while holding it, the object floats an inch from the staff's tip and remains there until it is removed or until the staff is no longer in your possession. The staff can have up to three such objects floating over its tip at any given time. While holding the staff, you can make one or more of the objects slowly spin or turn in place.",
	weight : 4
}
MagicItemsList["staff of birdcalls"] = {
	name : "Staff of Birdcalls",
	source : [["X", 139]],
	type : "staff",
	rarity : "common",
	description : "This staff has 10 charges, regaining 1d6+4 at dawn, 5% chance it is destroyed when its last charge is used. As an action, I can use 1 charge to create a sound out to a range of 60 ft: a finch's chirp, raven's caw, duck's quack, chicken's cluck, goose's honk, loon's call, turkey's gobble, seagull's cry, owl's hoot, or eagle's shriek.",
	descriptionFull : "This wooden staff is decorated with bird carvings. It has 10 charges. While holding it, you can use an action to expend 1 charge from the staff and cause it to create one of the following sounds out to a range of 60 feet: a finch's chirp, a raven's caw, a duck's quack, a chicken's cluck, a goose's honk, a loon's call, a turkey's gobble, a seagull's cry, an owl's hoot, or an eagle's shriek.\n   The staff regains 1d6+4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff explodes in a harmless cloud of bird feathers and is lost forever.",
	weight : 4,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	action : [["action", ""]]
}
MagicItemsList["staff of flowers"] = {
	name : "Staff of Flowers",
	source : [["X", 139]],
	type : "staff",
	rarity : "common",
	description : "This staff has 10 charges, regaining 1d6+4 at dawn, 5% chance it is destroyed when its last charge is used. As an action, I can use 1 charge to cause a flower of my choice to sprout from a patch of earth or soil within 5 ft or from the staff itself. The flower is nonmagical and grows or withers as a normal flower would.",
	descriptionFull : "This wooden staff has 10 charges. While holding it, you can use an action to expend 1 charge from the staff and cause a flower to sprout from a patch of earth or soil within 5 feet of you, or from the staff itself. Unless you choose a specific kind of flower, the staff creates a mildscented daisy. The flower is harmless and nonmagical, and it grows or withers as a normal flower would. The staff regains 1d6+4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff turns into flower petals and is lost forever.",
	weight : 4,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	action : [["action", ""]]
}
MagicItemsList["talking doll"] = {
	name : "Talking Doll",
	source : [["X", 139], ["WBtW", 214]],
	type : "wondrous item",
	rarity : "common",
	attunement : true,
	description : "During a short rest with this doll within 5 ft of me, I can tell it to say up to 6 phrases of up to 6 words each, and set an observable condition under which the doll speaks each phrase. Conditions must happen within 5 ft of the doll. The doll can remember only 6 phrases that are lost when my attunement to it ends.",
	descriptionFull : "While this stuffed doll is within 5 feet of you, you can spend a short rest telling it to say up to six phrases, none of which can be more than six words long, and set an observable condition under which the doll speaks each phrase. You can also replace old phrases with new ones. Whatever the condition, it must occur within 5 feet of the doll to make it speak. For example, whenever someone picks up the doll, it might say, \"I want a piece of candy.\" The doll's phrases are lost when your attunement to the doll ends."
}
MagicItemsList["tankard of sobriety"] = {
	name : "Tankard of Sobriety",
	source : [["X", 139]],
	type : "wondrous item",
	rarity : "common",
	description : "This tankard has a stern face sculpted into one side. I can drink ale, wine, or any other nonmagical alcoholic beverage poured into it without becoming inebriated. The tankard has no effect on magical liquids or harmful substances such as poison.",
	descriptionFull : "This tankard has a stern face sculpted into one side. You can drink ale, wine, or any other nonmagical alcoholic beverage poured into it without becoming inebriated. The tankard has no effect on magical liquids or harmful substances such as poison.",
	weight : 1
}
MagicItemsList["unbreakable arrow"] = {
	name : "Unbreakable Arrow",
	source : [["X", 139]],
	type : "weapon (arrow)",
	rarity : "common",
	description : "This arrow can't be broken, except when it is within an Antimagic Field.",
	descriptionFull : "This arrow can't be broken, except when it is within an Antimagic Field.",
	weight : 0.05
}
MagicItemsList["veteran's cane"] = {
	name : "Veteran's Cane",
	source : [["X", 139]],
	type : "wondrous item",
	rarity : "common",
	description : "Once as a bonus action, I can grasp this walking cane and speak its command word to have it transform into an ordinary longsword. Once transformed, the longsword is nonmagical and can't revert back to a walking cane.",
	descriptionFull : "When you grasp this walking cane and use a bonus action to speak the command word, it transforms into an ordinary longsword and ceases to be magical.",
	weight : 4,
	action : [["bonus action", ""]]
}
MagicItemsList["walloping ammunition"] = {
	name : "Walloping Ammunition",
	nameTest : "Walloping",
	source : [["X", 139]],
	type : "weapon (any ammunition)",
	rarity : "common",
	description : "This magic ammunition packs a wallop. A creature hit by the ammunition must succeed on a DC 10 Strength saving throw or be knocked prone.",
	descriptionFull : "This ammunition packs a wallop. A creature hit by the ammunition must succeed on a DC 10 Strength saving throw or be knocked prone.",
	allowDuplicates : true,
	chooseGear : {
		type : "ammo",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "ammunition"],
		excludeCheck : function (inObjKey, inObj) {
			return /vials|flasks/i.test(inObj.icon);
		}
	}
}
MagicItemsList["wand of conducting"] = {
	name : "Wand of Conducting",
	source : [["X", 140]],
	type : "wand",
	rarity : "common",
	description : "This wand has 3 charges, regaining all at dawn. As an action, I can wave it around and expend 1 charge to create orchestral music that can be heard out to a range of 60 ft and ends when I stop waving the wand. If I use its last charge, roll a d20. On a 1, a sad tuba sound plays as the wand crumbles to dust.",
	descriptionFull : "This wand has 3 charges. While holding it, you can use an action to expend 1 of its charges and create orchestral music by waving it around. The music can be heard out to a range of 60 feet and ends when you stop waving the wand.\n   The wand regains all expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, a sad tuba sound plays as the wand crumbles to dust and is destroyed.",
	weight : 1,
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["wand of pyrotechnics"] = {
	name : "Wand of Pyrotechnics",
	source : [["X", 140]],
	type : "wand",
	rarity : "common",
	description : "This wand has 7 charges, regaining 1d6+1 at dawn, 5% chance it is destroyed when its last charge is used. As an action, I can expend 1 charge to create a harmless burst of sound light at a point I can see up to 60 ft away, with the noise travelling 300 ft. The light is as bright as a torch flame but lasts only a second.",
	descriptionFull : "This wand has 7 charges. While holding it, you can use an action to expend 1 of its charges and create a harmless burst of multicolored light at a point you can see up to 60 feet away. The burst of light is accompanied by a crackling noise that can be heard up to 300 feet away. The light is as bright as a torch flame but lasts only a second.\n   The wand regains 1d6+1 expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand erupts in a harmless pyrotechnic display and is destroyed.",
	weight : 1,
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d6+1"
}
MagicItemsList["wand of scowls"] = {
	name : "Wand of Scowls",
	source : [["X", 140], ["WBtW", 214]],
	type : "wand",
	rarity : "common",
	description : "This wand has 3 charges, regain all at dawn. As an action, I can expend 1 of its charges and target a humanoid I can see within 30 ft. The target must succeed on a DC 10 Charisma save or be forced to scowl for 1 minute. If I expend the wand's last charge, roll a d20. On a 1, the wand transforms into a wand of smiles.",
	descriptionFull : "This wand has 3 charges. While holding it, you can use an action to expend 1 of its charges and target a humanoid you can see within 30 feet of you. The target must succeed on a DC 10 Charisma saving throw or be forced to scowl for 1 minute.\n   The wand regains all expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand transforms into a wand of smiles.",
	weight : 1,
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["wand of smiles"] = {
	name : "Wand of Smiles",
	source : [["X", 140], ["WBtW", 214]],
	type : "wand",
	rarity : "common",
	description : "This wand has 3 charges, regain all at dawn. As an action, I can expend 1 of its charges and target a humanoid I can see within 30 ft. The target must succeed on a DC 10 Charisma save or be forced to smile for 1 minute. If I expend the wand's last charge, roll a d20. On a 1, the wand transforms into a wand of scowls.",
	descriptionFull : "This wand has 3 charges. While holding it, you can use an action to expend 1 of its charges and target a humanoid you can see within 30 feet of you. The target must succeed on a DC 10 Charisma saving throw or be forced to smile for 1 minute.\n   The wand regains all expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand transforms into a wand of scowls.",
	weight : 1,
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}

// pub_20180529_MToF.js
// This file adds all the player-material from Mordenkainen's Tome of Foes to MPMB's Character Record Sheet

// Define the source
SourceList.MToF={
	name : "Mordenkainen's Tome of Foes",
	abbreviation : "MToF",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/mordenkainens-tome-foes",
	date : "2018/05/29"
};

// Tiefling subraces
RaceList["baalzebul tiefling"] = {
	regExpSearch : /^(?=.*baalzebul)(?=.*tiefling|planetouched).*$/i,
	name : "Baalzebul tiefling",
	sortname : "Tiefling, Baalzebul",
	source : [["MToF", 21], ["UA:FO", 1]],
	plural : "Baalzebul tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 1, 0, 2],
	trait : "Baalzebul Tiefling (+1 Intelligence, +2 Charisma)\n\nLegacy of Maladomini:\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast Ray of Sickness once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Crown of Madness once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Maladomini (1)",
		spells : ["thaumaturgy"],
		selection : ["thaumaturgy"],
		firstCol : 'atwill'
	},
	features : {
		"ray of sickness" : {
			name : "Legacy of Maladomini (level 3)",
			limfeaname : "Ray of Sickness (3d8)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Maladomini (3)",
				spells : ["ray of sickness"],
				selection : ["ray of sickness"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"ray of sickness" : {
					description : "Spell attack for 3d8 Poison dmg; save or also poisoned until end of my next turn",
					changes : "Using Legacy of Maladomini, I cast Ray of Sickness as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"crown of madness" : {
			name : "Legacy of Maladomini (level 5)",
			limfeaname : "Crown of Madness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Maladomini (5)",
				spells : ["crown of madness"],
				selection : ["crown of madness"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["dispater tiefling"] = {
	regExpSearch : /^(?=.*dispater)(?=.*tiefling|planetouched).*$/i,
	name : "Dispater tiefling",
	sortname : "Tiefling, Dispater",
	source : [["MToF", 21]],
	plural : "Dispater tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 0, 0, 2],
	trait : "Dispater Tiefling (+1 Dexterity, +2 Charisma)\n\nLegacy of Dis:\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast Disguise Self once per long rest.\n   At 5th level, I can also cast Detect Thoughts once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Dis (level 1)",
		spells : ["thaumaturgy"],
		selection : ["thaumaturgy"],
		firstCol : 'atwill'
	},
	features : {
		"disguise self" : {
			name : "Legacy of Dis (level 3)",
			limfeaname : "Disguise Self",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Dis (level 3)",
				spells : ["disguise self"],
				selection : ["disguise self"],
				firstCol : 'oncelr'
			}
		},
		"detect thoughts" : {
			name : "Legacy of Dis (level 5)",
			limfeaname : "Detect Thoughts",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Dis (level 5)",
				spells : ["detect thoughts"],
				selection : ["detect thoughts"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["fierna tiefling"] = {
	regExpSearch : /^(?=.*fierna)(?=.*tiefling|planetouched).*$/i,
	name : "Fierna tiefling",
	sortname : "Tiefling, Fierna",
	source : [["MToF", 21], ["UA:FO", 1]],
	plural : "Fierna tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 0, 1, 2],
	trait : "Fierna Tiefling (+1 Wisdom, +2 Charisma)\n\nLegacy of Phlegethos:\n   I know the Friends cantrip.\n   At 3rd level, I can cast Charm Person once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Suggestion once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Phlegethos (1)",
		spells : ["friends"],
		selection : ["friends"],
		firstCol : 'atwill'
	},
	features : {
		"charm person" : {
			name : "Legacy of Phlegethos (level 3)",
			limfeaname : "Charm Person (2 targets)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Phlegethos (3)",
				spells : ["charm person"],
				selection : ["charm person"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"charm person" : {
					description : "2 humanoids, max 30 ft apart, save or charmed; adv. on save if me/ally is fighting it",
					changes : "Using Legacy of Phlegethos, I cast Charm Person as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"suggestion" : {
			name : "Legacy of Phlegethos (level 5)",
			limfeaname : "Suggestion",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Phlegethos (5)",
				spells : ["suggestion"],
				selection : ["suggestion"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["glasya tiefling"] = {
	regExpSearch : /^(?=.*glasya)(?=.*tiefling|planetouched).*$/i,
	name : "Glasya tiefling",
	sortname : "Tiefling, Glasya",
	source : [["MToF", 22], ["UA:FO", 2]],
	plural : "Glasya tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 0, 0, 2],
	trait : "Glasya Tiefling (+1 Dexterity, +2 Charisma)\n\nLegacy of Malbolge:\n   I know the Minor Illusion cantrip.\n   At 3rd level, I can cast Disguise Self once per long rest.\n   At 5th level, I can also cast Invisibility once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Malbolge (1)",
		spells : ["minor illusion"],
		selection : ["minor illusion"],
		firstCol : 'atwill'
	},
	features : {
		"disguise self" : {
			name : "Legacy of Malbolge (level 3)",
			limfeaname : "Disguise Self",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Malbolge (3)",
				spells : ["disguise self"],
				selection : ["disguise self"],
				firstCol : 'oncelr'
			}
		},
		"invisibility" : {
			name : "Legacy of Malbolge (level 5)",
			limfeaname : "Invisibility",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Malbolge (5)",
				spells : ["invisibility"],
				selection : ["invisibility"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["levistus tiefling"] = {
	regExpSearch : /^(?=.*levistus)(?=.*tiefling|planetouched).*$/i,
	name : "Levistus tiefling",
	sortname : "Tiefling, Levistus",
	source : [["MToF", 22], ["UA:FO", 2]],
	plural : "Levistus tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 1, 0, 0, 2],
	trait : "Levistus Tiefling (+1 Constitution, +2 Charisma)\n\nLegacy of Stygia:\n   I know the Ray of Frost cantrip.\n   At 3rd level, I can cast Armor of Agathys once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Darkness once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Stygia (1)",
		spells : ["ray of frost"],
		selection : ["ray of frost"],
		firstCol : 'atwill'
	},
	features : {
		"armor of agathys" : {
			name : "Legacy of Stygia (level 3)",
			limfeaname : "Armor of Agathys (2nd-level)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Stygia (3)",
				spells : ["armor of agathys"],
				selection : ["armor of agathys"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"armor of agathys" : {
					description : "10 temp HP; as long as temp HP last any crea that hits in melee takes 10 Cold dmg",
					changes : "Using Legacy of Stygia, I cast Armor of Agathys as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"darkness" : {
			name : "Legacy of Stygia (level 5)",
			limfeaname : "Darkness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Stygia (5)",
				spells : ["darkness"],
				selection : ["darkness"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["mammon tiefling"] = {
	regExpSearch : /^(?=.*mammon)(?=.*tiefling|planetouched).*$/i,
	name : "Mammon tiefling",
	sortname : "Tiefling, Mammon",
	source : [["MToF", 22], ["UA:FO", 2]],
	plural : "Mammon tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 1, 0, 2],
	trait : "Mammon Tiefling (+1 Intelligence, +2 Charisma)\nLegacy of Minauros:\n   I know the Mage Hand cantrip.\n   At 3rd level, I can cast Tenser's Floating Disk once per short rest.\n   At 5th level, I can also cast Arcane Lock without a material component once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Minauros (1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : 'atwill'
	},
	features : {
		"tenser's floating disk" : {
			name : "Legacy of Minauros (level 3)",
			limfeaname : "Tenser's Floating Disk",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Minauros (3)",
				spells : ["tenser's floating disk"],
				selection : ["tenser's floating disk"],
				firstCol : 'oncesr'
			}
		},
		"arcane lock" : {
			name : "Legacy of Minauros (level 5)",
			limfeaname : "Arcane Lock",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Minauros (5)",
				spells : ["arcane lock"],
				selection : ["arcane lock"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"arcane lock" : {
					components : "V,S",
					compMaterial : "",
					changes : "I can cast this spell once per long rest without requiring material components."
				}
			}
		}
	}
};
RaceList["mephistopheles tiefling"] = {
	regExpSearch : /^(?=.*mephistopheles)(?=.*tiefling|planetouched).*$/i,
	name : "Mephistopheles tiefling",
	sortname : "Tiefling, Mephistopheles",
	source : [["MToF", 23]],
	plural : "Mephistopheles tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 1, 0, 2],
	trait : "Mephistopheles Tiefling (+1 Intelligence, +2 Charisma)\n\nLegacy of Cania:\n   I know the Mage Hand cantrip.\n   At 3rd level, I can cast Burning Hands once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Flame Blade once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Cania (level 1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : 'atwill'
	},
	features : {
		"burning hands" : {
			name : "Legacy of Cania (level 3)",
			limfeaname : "Burning Hands (4d6)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Cania (level 3)",
				spells : ["burning hands"],
				selection : ["burning hands"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"burning hands" : {
					description : "All in area 4d6 Fire dmg; save halves; unattended flammable objects ignite",
					changes : "Using Legacy of Cania, I cast Burning Hands as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"flame blade" : {
			name : "Legacy of Cania (level 5)",
			limfeaname : "Flame Blade",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Cania (level 5)",
				spells : ["flame blade"],
				selection : ["flame blade"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["zariel tiefling"] = {
	regExpSearch : /^(?=.*zariel)(?=.*tiefling|planetouched).*$/i,
	name : "Zariel tiefling",
	sortname : "Tiefling, Zariel",
	source : [["MToF", 23], ["UA:FO", 2]],
	plural : "Zariel tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 0, 0, 0, 2],
	trait : "Zariel Tiefling (+1 Strength, +2 Charisma)\n\nLegacy of Avernus:\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast Searing Smite once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Branding Smite once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Avernus (1)",
		spells : ["thaumaturgy"],
		selection : ["thaumaturgy"],
		firstCol : 'atwill'
	},
	features : {
		"searing smite" : {
			name : "Legacy of Avernus (level 3)",
			limfeaname : "Searing Smite (2d6)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Avernus (3)",
				spells : ["searing smite"],
				selection : ["searing smite"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"searing smite" : {
					description : "Next melee weapon hit +2d6 Fire dmg and target ignites; save to end spell or 1d6 Fire dmg",
					changes : "Using Legacy of Avernus, I cast Searing Smite as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"branding smite" : {
			name : "Legacy of Avernus (level 5)",
			limfeaname : "Branding Smite",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Avernus (5)",
				spells : ["branding smite"],
				selection : ["branding smite"],
				firstCol : 'oncelr'
			}
		}
	}
};

// Elf subraces
RaceList["eladrin-mtof"] = {
	regExpSearch : /^(?!.*half)((?=.*eladrin)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(feys?|feywild)\b))).*$/i,
	name : "Eladrin",
	sortname : "Elf, Fey (Eladrin)",
	source : [["MToF", 61]],
	plural : "Eladrin",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d12\")",
	weight : " weigh around 115 lb (90 + 2d12 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (140 + 5d12 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d12 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	abilitySave : 6,
	trait : "Eladrin (+2 Dexterity, +1 Charisma)" + desc([
		"Trance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).",
		"Fey Step: Once per short rest, as a bonus action, I can magically teleport up to 30 ft to an unoccupied space I can see. Once I reach 3rd level, this gains an additional effect, based on the current season I'm aligned with. See the third page notes section for the effects.",
		"Shifting Seasons: After I finish a long rest, I can align myself with a season of my choice."
	]),
	features : {
		"fey step" : {
			name : "Fey Step",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		}
	},
	toNotesPage : [{
		name : "Eladrin Season Features",
		source : [["MToF", 62]],
		popupName : "Eladrin Shifting Season Features",
		additional : "save DC 8 + Cha mod + Prof Bonus",
		page3notes : true,
		note : "\n  \u2022 Autumn (Eladrin Season, MToF 62)" + desc([
			" After using Fey Step, up to 2 creatures I can see within 10 ft of me must make a Wis save",
			" If failed, a target is charmed by me for 1 minute, or until I or my allies damage it"
		]) + "\n  \u2022 Winter (Eladrin Season, MToF 62)" + desc([
			" When I use Fey Step, one target in 5 ft of where I teleported from must make a Wis save",
			" If failed, it is frightened of me until the end of my next turn"
		]) + "\n  \u2022 Spring (Eladrin Season, MToF 62)" + desc([
			" When I use Fey Step, I can instead teleport one willing creature I touch within 5 ft of me",
			" It teleports to an unoccupied space of my choice that I can see within 30 ft of me"
		]) + "\n  \u2022 Summer (Eladrin Season, MToF 62)" + desc([
			" After using Fey Step, each creature of my choice within 5 ft of me takes fire damage",
			" This fire damage is equal to my Charisma modifier (minimum 1)"
		])
	}]
};
RaceList["sea elf"] = {
	regExpSearch : /^(?!.*half)((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(seas?|oceans?|water)\b)).*$/i,
	name : "Sea elf",
	sortname : "Elf, Sea",
	source : [["MToF", 62], ["W", 163], ["UA:ES", 1]],
	plural : "Sea elves",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	weaponProfs : [false, false, ["spear", "trident", "light crossbow", "net"]],
	languageProfs : ["Common", "Elvish", "Aquan", "Friend of the Sea"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")",
	weight : " weigh around 115 lb (90 + 2d8 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to almost 1,8 metres tall (140 + 5d8 cm)",
	weightMetric : " weigh around 52 kg (40 + 5d8 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 1, 0, 0, 0],
	trait : "Sea Elf (+2 Dexterity, +1 Constitution)" + desc([
		"Trance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. While meditating, I can dream after a fashion. After resting in this way, I gain the same benefit that a human does from 8 hours of sleep, thus needing only 4 hours for a long rest.",
		"Child of the Sea. I have 30 ft swimming speed and can breathe air and water.",
		"Friend of the Sea: Through sounds and gestures, I can communicate simple ideas with any beast that has an inborn swimming speed."
	])
};
RaceList["shadar-kai elf"] = {
	regExpSearch : /^(?!.*half)((?=.*shadar-kai)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(shadows?|shadowfell)\b))).*$/i,
	name : "Shadar-kai",
	sortname : "Elf, Shadow (Shadar-kai)",
	source : [["MToF", 62]],
	plural : "Shadar-kai",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	dmgres : ["Necrotic"],
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'8\" + 2d8\")",
	weight : " weigh around 115 lb (90 + 2d8 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 52 kg (40 + 5d8 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 1, 0, 0, 0],
	trait : "Shadar-kai (+2 Dexterity, +1 Constitution)" + desc([
		"Trance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).",
		"Blessing of the Raven Queen: Once per long rest, as a bonus action, I can magically teleport up to 30 ft to an unoccupied space I can see.",
		"Once I reach 3rd level, after I use the Blessing of the Raven Queen, I appear translucent and have resistance to all damage until the start of my next turn."
	]),
	features : {
		"blessing of the raven queen" : {
			name : "Blessing of the Raven Queen",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			action : ["bonus action", ""]
		}
	}
};

// Gith and its two subraces
RaceList["githyanki-mtof"] = {
	regExpSearch : /githyanki/i,
	name : "Githyanki",
	source : [["MToF", 96]],
	plural : "Githyanki",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Gith", 1],
	armorProfs : [true, true, false, false],
	weaponProfs : [false, false, ["shortsword", "longsword", "greatsword"]],
	skillstxt : "Choose any one skill or tool",
	age : " reach adulthood in their late teens and live for about a century",
	height : " are more leaner and taller than humans, most are a slender 6 feet tall (5'0\" + 2d12\")",
	weight : " weigh around 135 lb (100 + 2d12 \xD7 2d4 lb)",
	heightMetric : " are more leaner and taller than humans, most are a slender 1,8 metres tall (150 + 5d12 cm)",
	weightMetric : " weigh around 61 kg (45 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [2, 0, 0, 1, 0, 0],
	trait : "Githyanki (+2 Strength, +1 Intelligence)\n" + (typePF ? "\n" : "") + "Githyanki Psionics:" + desc([
		"I know the Mage Hand cantrip, but the hand is invisible.",
		"At 3rd level, I can cast Jump once per long rest.",
		"At 5th level, I can also cast Misty Step once per long rest.",
		"Intelligence is my spellcasting ability for these spells.",
		"I don't require components to cast these spells."
	]),
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "Githyanki Psionics (1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : 'atwill'
	},
	spellChanges : {
		"mage hand" : {
			components : "",
			description : "Create invisible spectral hand for simple tasks or carry up to 10 lb; 1 a to control; can't have multiple",
			changes : "Using Githyanki Psionics, I can cast Mage Hand without requiring components and the spectral hand is invisible."
		}
	},
	features : {
		"jump" : {
			name : "Githyanki Psionics (level 3)",
			limfeaname : "Jump",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Githyanki Psionics (3)",
				spells : ["jump"],
				selection : ["jump"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"jump" : {
					components : "",
					compMaterial : "",
					changes : "Using Githyanki Psionics, I can cast Jump once per long rest without requiring components."
				}
			}
		},
		"misty step" : {
			name : "Githyanki Psionics (level 5)",
			limfeaname : "Misty Step",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Githyanki Psionics (5)",
				spells : ["misty step"],
				selection : ["misty step"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"misty step" : {
					components : SpellsList["misty step"].components + "*",
					changes : "Using Githyanki Psionics, I can cast Misty Step once per long rest without requiring components."
				}
			}
		}
	}
};
AddRacialVariant("githyanki-mtof", "tool proficiency", {
	regExpSearch : /tool proficiency/i,
	skillstxt : "",
	toolProfs : [["Any tool", 1]]
});
AddRacialVariant("githyanki-mtof", "skill proficiency", {
	regExpSearch : /skill proficiency/i,
	skillstxt : "Choose any one skill"
});
RaceList["githzerai-mtof"] = {
	regExpSearch : /githzerai/i,
	name : "Githzerai",
	source : [["MToF", 96]],
	plural : "Githzerai",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Gith"],
	age : " reach adulthood in their late teens and live for about a century",
	height : " are more leaner and taller than humans, most are a slender 6 feet tall (4'11\" + 2d12\")",
	weight : " weigh around 115 lb (90 + 2d12 \xD7 1d4 lb)",
	heightMetric : " are more leaner and taller than humans, most are a slender 1,8 metres tall (150 + 5d12 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 0, 0, 1, 2, 0],
	trait : "Githzerai (+1 Intelligence, +2 Wisdom)\n" + (typePF ? "\n" : "") + "Githzerai Psionics:" + desc([
		"I know the Mage Hand cantrip, but the hand is invisible.",
		"At 3rd level, I can cast Shield once per long rest.",
		"At 5th level, I can also cast Detect Thoughts once per long rest.",
		"Wisdom is my spellcasting ability for these spells.",
		"I don't require components to cast these spells."
	]),
	savetxt : { adv_vs : ["charmed", "frightened"] },
	spellcastingAbility : 5,
	spellcastingBonus : {
		name : "Githzerai Psionics (1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : 'atwill'
	},
	spellChanges : {
		"mage hand" : {
			components : "",
			description : "Create invisible spectral hand for simple tasks or carry up to 10 lb; 1 a to control; can't have multiple",
			changes : "Using Githzerai Psionics, I can cast Mage Hand without requiring components and the spectral hand is invisible."
		}
	},
	features : {
		"shield" : {
			name : "Githzerai Psionics (level 3)",
			limfeaname : "Shield",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Githzerai Psionics (3)",
				spells : ["shield"],
				selection : ["shield"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"shield" : {
					components : "",
					changes : "Using Githzerai Psionics, I can cast Shield once per long rest without requiring components."
				}
			}
		},
		"detect thoughts" : {
			name : "Githzerai Psionics (level 5)",
			limfeaname : "Detect Thoughts",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Githzerai Psionics (5)",
				spells : ["detect thoughts"],
				selection : ["detect thoughts"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"detect thoughts" : {
					components : "",
					compMaterial : "",
					changes : "Using Githzerai Psionics, I can cast Detect Thoughts once per long rest without requiring components."
				}
			}
		}
	}
};

// Magic Items
MagicItemsList["greater silver sword"] = {
	name : "Greater Silver Sword",
	source : [["MToF", 89]],
	type : "weapon (greatsword)",
	rarity : "legendary",
	description : "This magic greatsword gives +1 to hit and damage. While holding it, I have adv. on Int, Wis, and Cha saves, immunity to being charmed, and resistance to psychic damage. If I score a critical hit with it on a creature's astral body, I can cut the cord tethering it to its material body, instead of dealing damage.",
	descriptionFull : "This magic weapon grants a +3 bonus to attack and damage rolls made with it. While you hold the sword, you have advantage on Intelligence, Wisdom, and Charisma saving throws, you are immune to being charmed, and you have resistance to psychic damage. In addition, if you score a critical hit with it against a creature's astral body, you can cut the silvery cord that tethers the target to its material body, instead of dealing damage.",
	attunement : true,
	weight : 6,
	prerequisite : "Requires attunement by a creature that has psionic ability",
	prereqeval : function (v) {
		if (!v.isSpellcaster) return false;
		if ((/psion|mystic/i).test(What("Racial Traits"))) return true;
		for (var aCast in CurrentSpells) {
			var spCast = CurrentSpells[aCast];
			if ((/psion|mystic/i).test(spCast.name) || (spCast.list && spCast.list.psionic)) return true;
			if (!spCast.bonus) continue;
			for (var aBon in spCast.bonus) {
				if ((/psion|mystic/i).test(aBon) || (/psion|mystic/i).test(spCast.bonus[aBon].name)) return true;
			}
		}
	},
	weaponOptions : [{
		baseWeapon : "greatsword",
		regExpSearch : /^(?=.*greater)(?=.*silver)(?=.*sword).*$/i,
		name : "Greater Silver Sword",
		source : [["MToF", 89]],
		description : "Heavy, two-handed; On crit vs. astral body, cut cord instead of damage",
		modifiers : [3, 3],
		selectNow : true
	}],
	savetxt : { text : ["Adv. on Int, Wis, and Cha saves"], immune : ["charmed"] },
	advantages : [["Intelligence", true], ["Wisdom", true], ["Charisma", true]],
	dmgres : ["Psychic"]
}
MagicItemsList["infernal tack"] = {
	name : "Infernal Tack",
	source : [["MToF", 167], ["DiA", 224]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	description : "While wearing the spurs of this set, the nightmare equipped with the bridle, bit, reins, saddle, and stirrups is under my command. As an action, I can have it appear in 20 ft at the start of my next turn. It acts on as my ally on my initiative, remains for 1 day, until I or it dies, or I dismiss it as an action. If it dies, it reforms in 24 h.",
	descriptionLong : "This tack consists of a bridle, bit, reins, saddle, stirrups, and spurs. A nightmare equipped with the tack serves whoever wears the spurs until the wearer dies or the tack is removed. As an action, I can clash the spurs together or scrape them through blood, causing the nightmare to appear within 20 ft at the start of my next turn. It acts as my ally on my initiative count, remains for 1 day, until I or it dies, or until I dismiss it as an action. If it dies, it reforms within 24 hours, after which I can summon it again. The tack doesn't create a nightmare from thin air; one must first be subdued so the tack can be placed on it.",
	descriptionFull : "A narzugon binds a nightmare to its service with infernal tack, which consists of a bridle, bit, reins, saddle, stirrups, and spurs. A nightmare equipped with infernal tack must serve whoever wears the spurs until the wearer dies or the tack is removed.\n   You can use an action to call a nightmare equipped with infernal tack by clashing the spurs together or scraping them through blood. The nightmare appears at the start of your next turn, within 20 feet of you. It acts as your ally and takes its turn on your initiative count. It remains for 1 day, until you or it dies, or until you dismiss it as an action. If the nightmare dies, it reforms in the Nine Hells within 24 hours, after which you can summon it again.\n   The tack doesn't conjure a nightmare from thin air; one must first be subdued so the tack can be placed on it. No nightmare accepts this forced servitude willingly, but some eventually form strong loyalties to their masters and become true partners in evil.",
	attunement : true,
	weight : 26, // riding saddle (25) + bit and bridle (1)
	prerequisite : "Requires attunement by a creature of evil alignment",
	prereqeval : function(v) { return (/evil/i).test(What("Alignment")); },
	action : [["action", ""]],
	creaturesAdd : [["Nightmare", true,
	function (AddRemove, prefix) {
		if (!AddRemove) return;
		// Show equipment section
		MakeCompMenu_CompOptions(prefix, ["companion", "visible", "comp.eqp"], true);
		// Add equipment when added
		var equip = ["bit and bridle", "riding"];
		for (var i = 0; i < equip.length; i++) {
			var gear = GearList[equip[i]];
			if (!gear) continue;
			AddToInv(prefix + "comp", "l", gear.name, gear.amount, gear.weight, "", false, false, false, false);
		}
		// Add notes
		var note = "I can use an action to call a nightmare equipped with infernal tack by clashing the spurs together or scraping them through blood. The nightmare appears at the start of my next turn, within 20 ft of me.\nThe nightmare acts as my ally and takes its turn on my initiative count. It remains for 1 day, until I or it dies, or until I dismiss it as an action. If the nightmare dies, it reforms in the Nine Hells within 24 hours, after which I can summon it again.";
		Value(prefix + "Comp.eqp.Notes", What("Unit System") === "metric" ? ConvertToMetric(note, 0.5) : note);
	}]]
}

// pub_20180918_WDH.js
// This file adds the magic items from the Waterdeep: Dragon Heist adventure to MPMB's Character Record Sheet

// Define the source
SourceList["WDH"] = {
	name : "Waterdeep: Dragon Heist [items]",
	abbreviation : "WDH",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/waterdeep-dragon-heist",
	date : "2018/09/18"
};

// Mundane Items
WeaponsList["oversized longbow"] = {
	regExpSearch : /^(?=.*oversized?)(?=.*longbow).*$/i,
	name : "Oversized Longbow",
	source : [["WDH", 201]],
	list : "ranged",
	ability : 2,
	type : "Martial",
	damage : [2, 6, "piercing"],
	range : "150/600 ft",
	weight : 2,
	description : "Ammunition, heavy, two-handed; Damage uses Str; Requires Medium size and Str 18",
	abilitytodamage : false,
	modifiers : ["", "Str"],
	ammo : "oversized arrow",
	defaultExcluded : true
};
AmmoList["oversized arrow"] = {
	name : "Oversized Arrows",
	source : [["WDH", 201]],
	icon : "Arrows",
	weight : 0.10,
	defaultExcluded : true
};

// Magic Items
var WDH_azuredgeFullDescription = [
	"Forged by the archwizard Ahghairon, this intelligent battleaxe was crafted to defend Waterdeep. Its current wielder is a former member of Force Grey named Meloon Wardragon, but the weapon is searching for a new owner.",
	"Azuredge has a solid steel handle etched with tiny runes, wrapped in blue dragon hide with a star sapphire set into the pommel. The axe head is forged from silver, electrum, and steel alloys whose edges constantly shimmer with a deep blue luminescence.",
	"You gain a +3 bonus to attack and damage rolls made with this magic weapon. The Shield spell provides no defense against the axe, which passes through that spell's barrier of magical force.",
	"When you hit a fiend or an undead with the axe, cold blue flames erupt from its blade and deal an extra 2d6 radiant damage to the target.",
	">>Hurling<<. The battleaxe has 3 charges. You can expend 1 charge and make a ranged attack with the axe, hurling it as if it had the thrown property with a normal range of 60 feet and a long range of 180 feet. Whether it hits or misses, the axe flies back to you at the end of the current turn, landing in your open hand or at your feet in your space (as you choose). The axe regains all expended charges daily at dawn.",
	">>Illumination<<. While holding the axe, you can use an action to cause the axe to glow blue or to quench the glow. This glow sheds bright light in a 30-foot radius and dim light for an additional 30 feet.",
	">>Sentience<<. Azuredge is a sentient lawful neutral weapon with an Intelligence of 12, a Wisdom of 15, and a Charisma of 15. It has hearing and darkvision out to a range of 120 feet.",
	"The weapon communicates telepathically with its wielder and can speak, read, and understand Common. It has a calm, delicate voice. The weapon can sense the presence of non-lawful creatures within 120 feet of it.",
	">>Personality<<. Azuredge is sworn to protect Waterdeep, and it desires to be wielded by a law-abiding person willing to dedicate everything to the city's defense. The weapon is patient and takes its time finding its ideal wielder.",
	"If someone tries to use Azuredge against its will, the axe can become ten times heavier than normal, and can magically adhere to any Medium or larger object or surface it comes into contact with. Once it does so, the axe can't be wielded. Nothing short of a Wish spell can separate the axe from the item or surface to which it is adhered without destroying one or the other, though the axe can choose to end the effect at any time."
];
MagicItemsList["azuredge"] = {
	name : "Azuredge",
	source : [["WDH", 189]],
	type : "weapon (battleaxe)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This battleaxe is sentient, adds +3 to hit and damage, and deals +2d6 radiant damage vs. fiends/undead. As an action, I can stop or start its glow of bright light in a 30-ft radius and dim light for another 30 ft. It has 3 charges, regaining all at dawn, which can be used to throw it, after which it returns to my hand. See Notes.",
	descriptionFull : WDH_azuredgeFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	weight : 4,
	action : [["action", " (glow/end)"]],
	usages : 3,
	recovery : "dawn",
	additional : "throw",
	weaponOptions : [{
		baseWeapon : "battleaxe",
		regExpSearch : /azuredge/i,
		name : "Azuredge",
		source : [["WDH", 189]],
		range : "Melee, 60/180 ft",
		description : "Versatile (1d10), thrown (1 charge); Returning; Ignores Shield spell; +2d6 radiant damage vs. fiends/undead",
		modifiers : [3, 3],
		selectNow : true
	}],
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["crusader's mantle"],
		selection : ["protection from evil and good"],
		firstCol : "oncelr"
	},
	toNotesPage : [{
		name : "Features",
		note : "\n   " + WDH_azuredgeFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["badge of the watch"] = { // contains contributions by Pengsloth
	name : "Badge of the Watch",
	source : [["WDH", 189]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "F",
	description : "While wearing this badge and not using a shield, I gain +2 AC. If it is more than 5 ft away from me for over 1 minute, it vanishes and reappears within 5 ft of the Open Lord. While holding the badge, the Open Lord knows my location if we are both on the same plane and can, as an action end my attunement to it.",
	prerequisite : "Requires attunement by someone designated by the Open Lord of Waterdeep",
	prereqeval : function () { return false; },
	descriptionFull : "A badge of the Watch is given only to those who have earned the trust of the Open Lord of Waterdeep. The badge, signifying the rank of captain in Waterdeep's City Watch, bears the emblem of Waterdeep and is meant to be worn or carried.\n   While wearing the badge, you gain a +2 bonus to AC if you aren't using a shield.\n   If the badge is more than 5 feet away from you for more than 1 minute, it vanishes and harmlessly reappears on a surface within 5 feet of the Open Lord. While holding the badge, the Open Lord knows your location, provided the two of you are on the same plane of existence and your attunement to the badge hasn't ended.\n   As an action, the Open Lord can touch the badge and end your attunement to it.",
	attunement : true,
	extraAC : [{
		mod : 2,
		name : "Badge of the Watch",
		magic : true,
		text : "While wearing the badge, I gain a +2 bonus to AC if I'm not using a shield.",
		stopeval : function (v) {
			return v.usingShield;
		}
	}]
}
var WDH_blackstaffFullDescription = "The Blackstaff is a sentient, rune-carved staff set with thin silver veins. It is the symbol of office for the Blackstaff, the highest-ranking wizard in Waterdeep. As the rightful owner of the Blackstaff, Vajra Safahr is the only one who can become attuned to it. The staff can, however, choose a new owner (see \"Personality\" below).\n   This staff can be wielded as a magic quarterstaff that grants a +2 bonus to attack and damage rolls made with it. While holding it, you gain a +2 bonus to Armor Class, saving throws, and spell attack rolls.\n   The staff has 20 charges for the following properties. The staff regains 2d8+4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff retains its +2 bonus to attack and damage roll but loses all other properties. On a 20, the staff regain 1d8+2 charges.\n   >>Power Strike<<. When you hit with a melee attack using the staff, you can expend 1 charge to deal an extra 1d6 force damage to the target.\n   >>Spells<<. While holding this staff, you can use an action to expend 1 or more of its charges to cast one of the following spells from it, using your spell save DC and spell attack bonus: Cone of Cold (5 charges), Fireball (5th-level version, 5 charges), Globe of Invulnerability (6 charges), Hold Monster (5 charges), Levitate (2 charges). Lightning Bolt (5th-level version, 5 charges), Magic Missile (1 charge), Ray of Enfeeblement (1 charge), or Wall of Force (5 charges).\n   >>Retributive Strike<<. You can use an action to break the staff over your knee or against a solid surface, performing a retributive strike. The staff is destroyed and releases its remaining magic in an explosion that expands to fill a 30-foot-radius sphere centered on it.\n   You have a 50% chance to instantly travel to a random plane of existence, avoiding the explosion. If you fail to avoid the effect, you take force damage equal to 16 \xD7 the number of charges in the staff. Every other creature in the area must make a DC 17 Dexterity saving throw. On a failed save, a creature takes an amount of damage based on how far away it is from the point of origin, as shown in the following table. On a successful save, a creature takes half as much damage.\n\n>>Distance from Origin\tEffect<<\n10 ft. away or closer\t8 \xD7 the number of charges in the staff\n11 to 20 ft. away\t6 \xD7 the number of charges in the staff\n21 to 30 ft. away\t4 \xD7 the number of charges in the staff\n\n\n   >>Animate Walking Statues<<. You can expend 1 or more of the staff's charges as an action to animate or deactivate one or more of the walking statues of Waterdeep. You must be in the city to use this property, and you can animate or deactivate one statue for each charge expended. An animated statue obeys the telepathic commands of Khelben Arunsun's spirit, which is trapped inside the staff (see \"Personality\" below). A walking statue becomes inanimate if deactivated or if the staff is broken.\n   >>Dispel Magic<<. You can expend 1 of the staff's charges as a bonus action to cast Dispel Magic on a creature, an object, or a magical effect that you touch with the tip of the staff. If the target is an unwilling creature or an object in the possession of such a creature, you must hit the creature with a melee attack using the Blackstaff before you can expend the charge to cast the spell.\n   >>Drain Magic<<. This property affects only creatures that use spell slots. When you hit such a creature with a melee attack using the Blackstaff, you can expend 1 of the staff's charges as a bonus action, causing the target to expend one spell slot of the highest spell level it can cast without casting a spell. If the target has already expended all its spell slots, nothing happens. Spell slots that are expended in this fashion are regained when the target finishes a long rest, as normal.\n   >>Master of Enchantment<<. When you cast an enchantment spell of 1st level or higher while holding the staff, you can make an Intelligence (Arcana) check with a DC of 10 + the level of the spell. If the check succeeds, you cast the spell without expending a spell slot.\n   >>Sentience<<. The Blackstaff is a sentient staff of neutral alignment, with an Intelligence of 22, a Wisdom of 15, and a Charisma of 18. It has hearing and darkvision out to a range of 120 feet, and it can communicate telepathically with any creature that is holding it.\n   >>Personality<<. The staff has the spirits of all previous Blackstaffs trapped within it. Its creator, Khelben Arunsun, is the dominant personality among them. Like Khelben, the staff is extremely devious and manipulative. It prefers to counsel its owner without exerting outright control. The staff's primary goal is to protect Waterdeep and its Open Lord, currently Laeral Silverhand. Its secondary goal is to help its wielder become more powerful.\n   In the event that the holder of the office of the Blackstaff no longer serves the staff's wishes, the staff ceases to function until it finds a worthy inheritor\u2014someone whose loyalty to Waterdeep is beyond reproach.\n   >>Spirit Trap<<. When the Blackstaff dies, the spirit of that individual becomes trapped in the staff along with the spirits of the previous Blackstaffs. (A Blackstaff whose spirit is trapped in the staff can't be raised from the dead.)\n   Destroying the staff would release the spirits trapped inside it, but in that event, Khelben's spirit can lodge itself inside any one piece of the staff that remains. The piece containing Khelben's spirit has the staff's Sentience property but none of its other properties. As long as this piece of the staff exists, Khelben's spirit can make the staff whole again whenever he wishes. When the staff is remade, the spirits of the previous Blackstaffs become trapped inside it again.";
if (MagicItemsList["staff of power"]) {
	MagicItemsList["blackstaff"] = {
		name : "Blackstaff",
		source : [["WDH", 190]],
		type : "staff",
		rarity : "legendary",
		storyItemAL : true,
		description : "This +2 quarterstaff gives me a +2 bonus on saves, AC, and spell attacks. It has 20 charges, regaining 2d8+4 at dawn, which can be used to cast spells, deal +1d6 force damage in melee, drain magic from a target hit in melee, or animate walking statues. It is sentient and has more features, see Notes page.",
		descriptionFull : WDH_blackstaffFullDescription.replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
		attunement : true,
		weight : 4,
		prerequisite : "Requires attunement by the Blackstaff heir, who must be a wizard",
		prereqeval : function(v) { return classes.known.wizard ? true : false; },
		usages : 20,
		recovery : "dawn",
		additional : "regains 2d8+4",
		weaponOptions : [{
			baseWeapon : "quarterstaff",
			regExpSearch : /blackstaff/i,
			name : "Blackstaff",
			source : [["WDH", 190]],
			description : "Versatile (1d8); On hit, use 1 charge for: +1d6 force damage or, as a bonus action, Drain Magic or Dispel Magic",
			modifiers : [2, 2],
			selectNow : true
		}],
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type == "attack") return 2;
				},
				"While holding the Blackstaff, I have a +2 bonus to spell attack rolls."
			]
		},
		addMod : [{ type : "save", field : "all", mod : 2, text : "While holding the Blackstaff, I gain a +2 bonus to all my saving throws." }],
		extraAC : [{name : "Blackstaff", mod : 2, magic : true, text : "I gain a +2 bonus to AC while attuned."}],
		action : [
			["action"," (Animate Walking Statues)"],
			["action", " (Retributive Strike)"],
			["bonus action", " (Drain Magic)"]
		],
		spellcastingAbility : "class",
		spellFirstColTitle : "Ch",
		spellcastingBonus : MagicItemsList["staff of power"].spellcastingBonus.concat([{
			name : "1 charge",
			spells : ["dispel magic"],
			selection : ["dispel magic"],
			firstCol : 1
		}]),
		spellChanges : {
			"fireball" : MagicItemsList["staff of power"].spellChanges.fireball,
			"lightning bolt" : MagicItemsList["staff of power"].spellChanges["lightning bolt"],
			"dispel magic" : {
				time : "1 bns",
				range : "Melee atk",
				description : "Dispel all magic on crea or object hit with melee atk; DC 10+SL spellcasting ability check if level >3",
				changes : "Can cast as a bonus action, but only on something touched by the staff. It might first require an attack by the staff to be able to cast it on"
			}
		},
		toNotesPage : [{
			name : "Features",
			note : "\n   " + WDH_blackstaffFullDescription.replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you /ig, "I ")
		}, {
			name : "Sentient Item Features",
			note : sentientItemConflictTxt
		}]
	}
}
MagicItemsList["bracer of flying daggers"] = {
	name : "Bracer of Flying Daggers",
	source : [["WDH", 190]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This armband appears to have thin daggers strapped to it. As an action, I can pull up to two magic daggers from the bracer and immediately hurl them, making a ranged attack with each dagger. A dagger vanishes if I don't hurl it right away, and the daggers disappear right after they hit or miss.",
	descriptionFull : "This armband appears to have thin daggers strapped to it. As an action, you can pull up to two magic daggers from the bracer and immediately hurl them, making a ranged attack with each dagger. A dagger vanishes if you don't hurl it right away, and the daggers disappear right after they hit or miss. The bracer never runs out of daggers.",
	attunement : true,
	action : [["action", ""]],
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*bracer)(?=.*flying)(?=.*dagger).*$/i,
		name : "Bracer of Flying Daggers",
		source : [["WDH", 190]],
		range : "20/60 ft",
		description : "Finesse, light, thrown; As action, throw 2; Doesn't work with Attack action",
		selectNow : true
	}]
}
MagicItemsList["dragonstaff of ahghairon"] = { // contains contributions by Pengsloth
	name : "Dragonstaff of Ahghairon",
	source : [["WDH", 191]],
	type : "staff",
	rarity : "legendary",
	storyItemAL : true,
	description : "This staff has 10 charges, regaining 1d10 at dawn, which can be used to cast Command. Dragons have disadv. on their save against it. The staff gives me adv. on saves against the spells and breath weapons of dragons. I can touch a dragon with the staff, allowing it to ignore the effects of Ahghairon's Dragonward.",
	descriptionFull : "While holding the dragonstaff of Ahghairon, you have advantage on saving throws against the spells and breath weapons of dragons, as well as the breath weapons of other creatures of the dragon type (such as dragon turtles).\n   A creature of the dragon type that you touch with the staff can move through the city of Waterdeep, ignoring Ahghairon's dragonward (see \"Ahghairon's Dragonward,\" in the Introduction of Waterdeep: Dragon Heist). This effect lasts until the creature is touched again by the staff or until a time you proclaim when you confer the benefit.\n   The staff has 10 charges. While holding it, you can expend 1 charge as an action to cast the Command spell. If you target a dragon with this casting, the dragon has disadvantage on its saving throw. The staff regains 1d10 charges daily at dawn.",
	attunement : true,
	savetxt : { adv_vs : ["dragon breath weapons", "dragon spells"] },
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d10",
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["command"],
		selection : ["command"],
		firstCol : 1
	}],
	spellChanges : {
		"command" : {
			description : "1 crea, save or follow one word command, e.g. approach, drop, flee, halt; dragons disadv. on save",
			changes : "When this spell is cast on a dragon they have disadvantage on the saving throw."
		}
	}
}
MagicItemsList["feather of diatryma summoning"] = {
	name : "Feather of Diatryma Summoning",
	source : [["WDH", 191]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "As an action once per 7 days, I can speak the command word and throw this feather to an empty large space in 5 ft, where it becomes a diatryma (axe beak stats) for 6 hours, until I speak the command again, or it reaches 0 HP. It is friendly, understands my languages, obeys my commands, and can be used as a mount.",
	descriptionFull : "This bright plume is made from the feather of a diatryma (pronounced dee-ah-TRY-mah), a Large, colorful, flightless bird native to the Underdark. If you use an action to speak the command word and throw the feather into a Large unoccupied space on the ground within 5 feet of you, the feather becomes a living diatryma for up to 6 hours, after which it reverts to its feather form. It reverts to feather form early if it drops to 0 hit points or if you use an action to speak the command word again while touching the bird.\n   When the diatryma reverts to feather form, the magic of the feather can't be used again until 7 days have passed.\n   The diatryma uses the statistics of an axe beak, except that its beak deals piercing damage instead of slashing damage. The creature is friendly to you and your companions, and it can be used as a mount. It understands your languages and obeys your spoken commands. If you issue no commands, the diatryma defends itself but takes no other actions.",
	attunement : true,
	usages : 1,
	recovery : "7 days",
	action : [["action", ""]]
}
MagicItemsList["knave's eye patch"] = { // contains contributions by Pengsloth
	name : "Knave's Eye Patch",
	source : [["WDH", 191]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "While wearing this eye patch I have advantage on Perception checks that rely on sight, I am unaffected by Sunlight Sensitivity if I have it, and I am immune to magic that would read my thoughts or determine whether I'm lying. Creatures can communicate telepathically with me only if I allow it.",
	descriptionFull : "While wearing this eye patch, you gain these benefits:\n \u2022 You have advantage on Wisdom (Perception) checks that rely on sight.\n \u2022 If you have the Sunlight Sensitivity trait, you are unaffected by the trait.\n \u2022 You are immune to magic that allows other creatures to read your thoughts or determine whether you are lying. Creatures can communicate telepathically with you only if you allow it.",
	attunement : true,
	vision : [["Adv. on Perception checks relying on sight", 0]]
}
MagicItemsList["lord's ensemble"] = {
	name : "Lord's Ensemble",
	source : [["WDH", 191]],
	type : "wondrous item",
	rarity : "very rare",
	storyItemAL : true,
	prerequisite : "Requires attunement by a creature with a humanoid build",
	description : "While wearing this helm, amulet, and ring, my identity can't be determined. I move through difficult terrain as normal terrain. Magic can't be used to reduce my speed, paralyze me, restrain me, read my thoughts, or learn my alignment, creature type, or if I'm lying. I'm hidden from scrying and Divination magic.",
	descriptionLong : "This set of a helm, amulet, and ring can be worn and attuned to as a single magic item, but only while within Waterdeep. The helm magically alters my voice to sound genderless, and makes me immune to magic that reads my thoughts, determines if I'm lying, or reveals my alignment or creature type. Creatures can't speak telepathically with me unless I allow it. The amulet causes me to be hidden from Divination magic and magical scrying sensors. The robe makes me look nondescript, makes difficult terrain not cost me extra movement, and stops magic from reducing my speed or me to be paralyze or restrained.",
	descriptionFull : "The Masked Lords of Waterdeep don this ensemble when meeting with one another. This raiment renders each lord indistinguishable from the others. The ensemble consists of three pieces\u2014a helm, an amulet, and a robe\u2014that function as a single magic item when worn together, but only within the city of Waterdeep and its sewers. You become attuned to the ensemble as a single item.\n   " + toUni("Lord's Helm") + ". This bucket helm covers your head and conceals your face. Screens over the eyes help to shroud your identity without blinding you. While you wear the helm, your voice is magically altered to sound genderless, and you are immune to magic that allows other creatures to read your thoughts, to determine whether you are lying, to know your alignment, or to know your creature type. Creatures can communicate telepathically with you only if you allow it.\n   " + toUni("Lord's Amulet") + ". This amulet bears the crest of Waterdeep. It functions as an amulet of proof against detection and location.\n   " + toUni("Lord's Robe") + ". This elegant robe functions as a ring of free action, and it creates the illusion that you have a nondescript, androgynous humanoid build and stand 6 feet tall.",
	attunement : true,
	savetxt : { immune : ["paralyzed", "restrained"] }
}
MagicItemsList["paper bird"] = {
	name : "Paper Bird",
	source : [["WDH", 191]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "I can write up to 50 words on a sheet of the 1d6+3 in this box and speak a creature's name, causing the parchment to fold into a Tiny bird and fly to that creature on the same plane if it isn't stopped. It has 60 ft fly speed, 1 HP, AC 13, Dex 16, 1 in all other ability scores, and immunity to poison and psychic damage.",
	descriptionFull : "After you write a message of fifty words or fewer on this magic sheet of parchment and speak a creature's name, the parchment magically folds into a Tiny paper bird and flies to the recipient whose name you uttered. The recipient must be on the same plane of existence as you, otherwise the bird turns into ash as it takes flight.\n   The bird is an object that has 1 hit point, an Armor Class of 13, a flying speed of 60 feet, a Dexterity of 16 (+3), and a score of 1 (\u22125) in all other abilities, and it is immune to poison and psychic damage.\n   It travels to within 5 feet of its intended recipient by the most direct route, whereupon it turns into a nonmagical and inanimate sheet of parchment that can be unfolded only by the intended recipient. If the bird's hit points or speed is reduced to 0 or if it is otherwise immobilized, it turns into ash.\n   Paper birds usually come in small, flat boxes containing 1d6 + 3 sheets of the parchment.",
	usages : "1d6+3",
	recovery : "Never"
}
MagicItemsList["ring of truth telling"] = {
	name : "Ring of Truth Telling",
	source : [["WDH", 192]],
	type : "ring",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "While wearing this ring, I have advantage on Wisdom (Insight) checks to determine whether someone is lying to me.",
	descriptionFull : "While wearing this ring, you have advantage on Wisdom (Insight) checks to determine whether someone is lying to you.",
	attunement : true
}
MagicItemsList["smokepowder"] = {
	name : "Smokepowder",
	source : [["WDH", 192]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "",
	descriptionFull : "Smokepowder is a magical explosive chiefly used to propel a bullet out of the barrel of a firearm. It is stored in airtight wooden kegs or tiny, waterproof leather packets. A packet contains enough smokepowder for five shots, and a keg holds enough smokepowder for five hundred shots.\n   If smokepowder is set on fire, dropped, or otherwise handled roughly, it explodes and deals fire damage to each creature or object within 20 feet of it: 1d6 for a packet, 9d6 for a keg. A successful DC 12 Dexterity saving throw halves the damage.\n   Casting Dispel Magic on smokepowder renders it permanently inert.",
	allowDuplicates : true,
	choices : ["Keg (500 shots)", "Packet (5 shots)"],
	"packet (5 shots)" : {
		name : "Smokepowder Packet",
		description : "This magical explosive is used to propel a bullet out of a firearm. These tiny, waterproof leather packets contain enough for five shots. Casting dispel magic on it renders it permanently inert. If it is set on fire, dropped, or handled roughly, it explodes and deals 1d6 fire damage to all within 20 ft, DC 12 Dex save halves.",
		usages : 5,
		recovery : "Never",
		additional : "shots",
		weight : 0.1, // 7000 grains per lb, 100 grains per shot
		extraTooltip : "AL: can be purchased for 1 treasure checkpoint. Once found, this item goes on a character's evergreen list of available items.",
	},
	"keg (500 shots)" : {
		name : "Smokepowder Keg",
		description : "This magical explosive is used to propel a bullet out of a firearm. This airtight wooden kegs contain enough for five hundred shots. Casting dispel magic on it renders it permanently inert. If it is set on fire, dropped, or handled roughly, it explodes and deals 9d6 fire damage to all within 20 ft, DC 12 Dex save halves.",
		usages : 500,
		recovery : "Never",
		additional : "shots",
		weight : 12 // 7000 grains per lb, 100 grains per shot (+2 for the keg itself)
	}
}

// Beast
// Falcon is just a hawk under a different name, it has been added to the SRD code as a `nameAlt`

// pub_20181107_LLoK.js
// This file adds the magic items from the Lost Laboratory of Kwalish adventure to MPMB's Character Record Sheet

// Define the source
SourceList["LLoK"] = {
	name : "Lost Laboratory of Kwalish [items, spells]",
	abbreviation : "LLoK",
	group : "Extra Life",
	url : "https://www.dmsguild.com/product/258047/Lost-Laboratory-of-Kwalish-5e",
	date : "2018/11/07",
	defaultExcluded : true
};

// Magic Items
MagicItemsList["blade of the medusa"] = {
	name : "Blade of the Medusa",
	nameTest : "of the Medusa",
	source : [["LLoK", 53]],
	type : "weapon (any sword)",
	rarity : "very rare",
	magicItemTable : "H",
	description : "I'm unwilling to part with this magic blade. When I attack a creature with it and roll a 20 to hit, it must make a DC 15 Con save or be restrained, and on a roll of 1, I must make that save. At the end of each of the target's turns, it can save again, ending the effect with 3 successes, or petrified for 1 hour after 3 failures.",
	descriptionLong : "I'm unwilling to part with this magic sword. When I attack a creature with it and roll a 20 to hit, it must make a DC 15 Constitution save or be restrained. However, if I roll of 1 on the attack roll, I must make that same save. At the end of each of the effected target's turns, it can make the save again. If it successfully saves against this effect three times, the effect ends. However, if it failed three times, it is turned to stone and petrified for 1 hour. A creature is immune to this effect if it is immune to damage of the weapon's type, does not have a body made of flesh, or has legendary actions.",
	descriptionFull : "When you attack a creature with this magic weapon and roll a 20 on the attack roll, the creature must make a DC 15 Constitution saving throw in addition to suffering the attack's normal effects. On a failed save, the creature is restrained and must make another Constitution saving throw at the end of each of its turns. If it successfully saves against this effect three times, the effect ends. If it fails its saves three times, it is turned to stone and subjected to the petrified condition for 1 hour.\n   A creature is immune to this effect if it is immune to damage of the weapon's type, does not have a body made of flesh, or has legendary actions.\n   " + toUni("Curse") + ". This weapon is cursed, and becoming attuned to it extends the curse to you. Until the curse is broken with a remove curse spell or similar magic, you are unwilling to part with the weapon. Whenever you attack a creature with this weapon and roll a 1 on the attack roll, you must succeed on a DC 15 Constitution saving throw or be restrained and forced to make additional saves against being petrified, as above.",
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/of the medusa/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'On 20 to hit: DC 15 Con save or restrained, see item; On 1 to hit: I same save';
				}
			},
			'If I include the words "of the Medusa" in a the name of a sword, it will be treated as the magic weapon Blade of the Medusa.'
		]
	}
}
MagicItemsList["galder's bubble pipe"] = {
	name : "Galder's Bubble Pipe",
	source : [["LLoK", 55]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This finely carved pipe has 3 charges, regaining all at dawn, which I can use to cast spells. As an action, I can expend all 3 charges to summon a steam mephit. It acts on its own initiative, is friendly to me, obeys my verbal commands, and disappears after 1 minute or if it ends its turn more than 60 ft from the pipe.",
	descriptionFull : "This finely carved pipe blows odorless bubbles instead of smoke when used. The pipe has 3 charges, and it regains all spent charges daily at dawn. While you hold the pipe, you can expend charges to gain access to the following properties:\n \u2022 You can cast Fog Cloud as an action (1 charge).\n \u2022 You can cast Misty Step as a bonus action (2 charges).\n \u2022 You can summon a steam mephit as an action (3 charges). The mephit is friendly to you, obeys your verbal commands, and acts on its own turn in the initiative order. It disappears in a harmless puff of steam after 1 minute or if it ends its turn more than 60 feet from the pipe.",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["fog cloud"],
		selection : ["fog cloud"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["misty step"],
		selection : ["misty step"],
		firstCol : 2
	}]
}
MagicItemsList["gambler's blade"] = {
	name : "Gambler's Blade",
	nameTest : "Gambler's",
	source : [["LLoK", 55]],
	type : "weapon (any sword)",
	rarity : "rare",
	magicItemTable : "H",
	description : "I am unwilling to part with this sword until I'm freed of its curse. Each day at dawn, I can choose its magical bonus to attack and damage rolls of +1, +2, or +3. However, I take a corresponding penalty (-1, -2, or -3) to my death saving throws.",
	descriptionFull : "Choose a magical bonus of +1 to +3. This sword gains that bonus to its attack and damage rolls. For each point of bonus you choose for the sword, you take a corresponding penalty (-1 to -3) to your death saving throws. You can change this magical bonus each day at dawn.\n   " + toUni("Curse") + ". This weapon is cursed, and becoming attuned to it extends the curse to you. Until the curse is broken with a remove curse spell or similar magic, you are unwilling to part with the weapon.",
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/gambler's/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Choose its magic bonus (1-3), but equal penalty on death saves';
				}
			},
			"If I include the word \"Gambler's\" in a the name of a sword, it will be treated as the magic weapon Gambler's Blade."
		]
	}
}
MagicItemsList["heward's hireling armor"] = {
	name : "Heward's Hireling Armor",
	nameAlt : "Hireling Armor",
	source : [["LLoK", 55]],
	type : "armor (leather)",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This leather armor gives me a +1 bonus to AC and allows me to draw or stow two one-handed weapons when I would normally be able to draw or stow only one. It has 6 pockets that hold 20 lb (2 cu ft) each as they are extradimensional spaces. Retrieving an item from a pocket requires an action.",
	descriptionFull : "A number of Kwalish's experiments were attempts to research the works of the legendary mage Heward, who first crafted what he named hireling armor. While wearing this armor, you gain a +1 bonus to AC. In addition, the armor's animated straps can assist with the drawing and sheathing of weapons, such that you can draw or stow two one-handed weapons when you would normally be able to draw or stow only one.\n   This armor also has six pockets, each of which is an extradimensional space. Each pocket can hold up to 20 pounds of material, not exceeding a volume of 2 cubic feet. The armor always weighs 10 pounds, regardless of its pockets' contents. Placing an object into one of the armor's pockets follows the normal rules for interacting with objects. Retrieving an item from a pocket of the armor requires you to use an action. When you reach into a pocket for a specific item, the item is always magically on top.\n   Placing the armor inside an extradimensional space created by a bag of holding, a Heward's handy haversack, or a similar item instantly destroys both items and opens a gate to the Astral Plane. The gate originates where the one item was placed inside the other. Any creature within 10 feet of the gate is sucked through it and deposited in a random location on the Astral Plane. The gate then closes. The gate is one-way only and can't be reopened.",
	weight : 10,
	action : [["action", " (retrieve item)"]],
	armorOptions : [{
		regExpSearch : /^(?=.*heward)(?=.*hireling)(?=.*armor).*$/i,
		name : "Heward's Hireling Armor",
		source : [["LLoK", 55]],
		type : "light",
		ac : "11+1",
		weight : 10,
		selectNow : true
	}]
}
if (MagicItemsList["ioun stone"]) {
	MagicItemsList["ioun stone"].incrementSkill = function (aSkill, iType, forceRemove) {
		if (SkillsList.abbreviations.indexOf(aSkill) == -1) return;
		var aIndx = SkillsList.abbreviations.indexOf(aSkill);
		var aFld = (Who("Text.SkillsNames") === "alphabeta" ? aSkill : SkillsList.abbreviationsByAS[aIndx]) + " Bonus";
		var iSkill = SkillsList.names[aIndx];
		var iName = "Ioun Stone of " + iType;
		var iTxt = "While the " + iName + " orbits my head and I'm proficient with the " + iSkill + " skill, I gain a +1 bonus on checks with it.";
		var addIt = forceRemove ? false : CurrentProfs.skill[aSkill] && CurrentProfs.skill[aSkill].length > 1;
		var hasBonus = How(aFld).indexOf(iTxt) !== -1;
		if (hasBonus !== addIt) {
			processMods( addIt, iName + " (magic item)", [{ type : "skill", field : aSkill, mod : 1, text : iTxt }] );
		}
	}
	AddFeatureChoice(MagicItemsList["ioun stone"], false, "Supreme Intellect", {
		source : [["LLoK", 55]],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this faceted sphere orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has 10 HP and resistance to all damage. While it orbits my head, I gain a +1 bonus on Intelligence checks.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain a +1 bonus to Intelligence checks while this faceted sphere orbits your head.",
		addMod : [
			{ type : "skill", field : "Arcana", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." },
			{ type : "skill", field : "History", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." },
			{ type : "skill", field : "Investigation", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." },
			{ type : "skill", field : "Nature", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." },
			{ type : "skill", field : "Religion", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." }
		]
	});
	AddFeatureChoice(MagicItemsList["ioun stone"], false, "Historical Knowledge", {
		source : [["LLoK", 55]],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this polished, steely sphere orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has resistance to all damage and 10 HP. While it orbits my head, I gain proficiency in the History skill, or a +1 bonus with it if I'm already proficient.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain proficiency in the History skill, or a +1 bonus to checks with that skill if already proficient, while this polished, steely sphere orbits your head.",
		skills : ["History"],
		changeeval : function () { MagicItemsList["ioun stone"].incrementSkill("His", "Historical Knowledge"); },
		removeeval : function () { MagicItemsList["ioun stone"].incrementSkill("His", "Historical Knowledge", true); }
	});
	AddFeatureChoice(MagicItemsList["ioun stone"], false, "Natural Knowledge", {
		source : [["LLoK", 55]],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this burnished, brassy stone orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has resistance to all damage and 10 HP. While it orbits my head, I gain proficiency in the Nature skill, or a +1 bonus with it if I'm already proficient.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain proficiency in the Nature skill, or a +1 bonus to checks with that skill if already proficient, while this burnished, brassy stone orbits your head.",
		skills : ["Nature"],
		changeeval : function () { MagicItemsList["ioun stone"].incrementSkill("Nat", "Natural Knowledge"); },
		removeeval : function () { MagicItemsList["ioun stone"].incrementSkill("Nat", "Natural Knowledge", true); }
	});
	AddFeatureChoice(MagicItemsList["ioun stone"], false, "Religious Knowledge", {
		source : [["LLoK", 55]],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this tiny golden gem orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has resistance to all damage and 10 HP. While it orbits my head, I gain proficiency in the Religion skill, or a +1 bonus with it if I'm already proficient.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain proficiency in the Religion skill, or a +1 bonus to checks with that skill if already proficient, while this tiny golden gem orbits your head.",
		skills : ["Religion"],
		changeeval : function () { MagicItemsList["ioun stone"].incrementSkill("Rel", "Religious Knowledge"); },
		removeeval : function () { MagicItemsList["ioun stone"].incrementSkill("Rel", "Religious Knowledge", true); }
	});
	AddFeatureChoice(MagicItemsList["ioun stone"], false, "Language Knowledge", {
		source : [["LLoK", 55]],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this pulsating bit of red jeweled crystal orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has 10 HP and resistance to all damage. While it orbits my head, I am fluent in one additional language chosen by the DM.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You are fluent in one additional language while this pulsating bit of red jeweled crystal orbits your head. The DM chooses the language bestowed by the stone.",
		languageProfs : [1]
	});
	AddFeatureChoice(MagicItemsList["ioun stone"], false, "Self-Preservation", {
		source : [["LLoK", 55]],
		rarity : "rare",
		description : "As an action, I can make this silvery gem orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has 10 HP and resistance to all damage. While it orbits my head, I gain a +1 bonus to Intelligence saving throws.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain a +1 bonus to Intelligence saving throws while this silvery gem orbits your head.",
		addMod : [{ type : "save", field : "Int", mod : 1, text : "While the Ioun stone of Self-Preservation orbits my head, I gain a +1 bonus to Intelligence saving throws." }]
	}, false, true); // force sorting on the last one
}
var LLoK_leatherGolemArmorFullDescription = [
	"Strange rituals have repurposed the body of a flesh golem into this partially sentient suit of leather armor. While wearing this armor, you gain the following benefits:",
	"\u2022 You gain a +1 bonus to AC and to saving throws against spells and other magical effects.",
	"\u2022 >>Immutable Form<<. You are immune to any spell or effect that would alter your form.",
	"\u2022 >>Lightning Absorption<<. You gain resistance to lightning damage. Whenever you take lightning damage, you gain 5 temporary hit points.",
	">>Curse<<. This armor is cursed, and it extends to whomever becomes attuned to it. Until the curse is broken with a remove curse spell or similar magic, you are unwilling to part with the armor. In addition, while you wear the cursed armor, you gain the following properties:",
	"\u2022 >>Aversion of Fire<<. If you take fire damage, you have disadvantage on attack rolls and ability checks until the end of your next turn.",
	"\u2022 >>Berserk<<. Whenever you suffer a critical hit, roll a d6. On a 6, you go beserk because of the armor. On each of your turns while berserk, you attack the nearest creature you can see. If no creature is near enough to move to and attack, you attack an object, with preference for an object smaller than yourself. Once you go beserk because of the armor, it cannot be removed. You continue to attack until you are incapacitated or until another creature is able to change your state of mind with appropriate magic (such as a calm emotions spell) or a successful DC 15 Charisma (Persuasion) check."
];
MagicItemsList["leather golem armor"] = {
	name : "Leather Golem Armor",
	source : [["LLoK", 55]],
	type : "armor (leather)",
	rarity : "rare",
	magicItemTable : "G",
	description : "I am unwilling to part with this leather armor until its curse is lifted from me, see Notes page. The curse makes me go berserk and have an aversion to fire. It gives me a +1 bonus to AC and saves vs. spells and magical effects. I have resistance to lightning damage and when I suffer such damage, I gain 5 temporary HP.",
	descriptionFull : LLoK_leatherGolemArmorFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	weight : 10,
	dmgres : ["Lightning"],
	cursed : true,
	armorOptions : [{
		regExpSearch : /^(?=.*leather)(?=.*golem)(?=.*armor).*$/i,
		name : "Leather Golem Armor",
		source : [["LLoK", 55]],
		type : "light",
		ac : "11+1",
		weight : 10,
		selectNow : true
	}],
	savetxt : { text : ["+1 vs. spells and magical effects"] },
	toNotesPage : [{
		name : "Features",
		note : desc(LLoK_leatherGolemArmorFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/you /ig, "I ")
	}]
}
var LLoK_polymorphBladeFullDescription = [
	"When you attack a creature with this magic weapon and roll a 20 on the attack roll, the creature must make a DC 15 Wisdom saving throw in addition to suffering the attack's normal effects. On a failed save, the creature also suffers the effects of a polymorph spell. Roll a d20 and consult the following table to determine the form the target creature is transformed into.",
	">>d20\tNew Form   \td20\tNew Form<<",
	"  1\tTyrannosaurus\t 11\tWolf",
	"  2\tGiant ape    \t 12\tHorse",
	"  3\tElephant     \t 13\tOx",
	"  4\tGiant scorpion\t 14\tGiant frog",
	"  5\tRhinoceros   \t 15\tPoisonous snake",
	"  6\tPolar bear   \t 16\tHawk",
	"  7\tGiant toad   \t 17\tOctopus",
	"  8\tGiant eagle  \t 18\tCat",
	"  9\tBlack bear   \t 19\tRat",
	"10\tCrocodile     \t 20\tRabbit",
	"A creature is immune to this effect if it is immune to damage of the weapon's type, is a shapechanger, or has legendary actions.",
	">>Curse<<. This weapon is cursed, and it extends to whomever becomes attuned to it. Until the curse is broken with a Remove Curse spell or similar magic, you are unwilling to part with the weapon. Whenever you attack a creature with this weapon and roll a 1 on the attack roll, you suffer the effect of a polymorph spell for 1 hour, rolling on the table to determine your new form."
];
MagicItemsList["polymorph blade"] = {
	name : "Polymorph Blade",
	nameTest : "Polymorph",
	source : [["LLoK", 59]],
	type : "weapon (any sword)",
	rarity : "very rare",
	magicItemTable : "H",
	description : "I'm unwilling to part with this magic sword. When I attack a creature with it and roll a 20 to hit, the creature must make a DC 15 Wisdom save or be polymorphed for 1 hour into a random beast (see Notes page). However, on a roll of 1 to hit, I am the one being polymorphed for 1 hour without a save.",
	descriptionFull : LLoK_polymorphBladeFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/polymorph/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'On 20 to hit: DC 15 Wis save or polymorphed, see item; On 1 to hit: I polymorph';
				}
			},
			'If I include the word "Polymorph" in a the name of a sword, it will be treated as the magic weapon Polymorph Blade.'
		]
	},
	toNotesPage : [{
		name : "Features",
		note : desc(LLoK_polymorphBladeFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/you /ig, "I ")
	}]
}
var LLoK_poweredArmorFullDescription = [
	"Powered armor resembles a suit of unusual plate armor, with finely articulated joints connected by an oily, black, leather-like material. The armor has been worked to create the appearance of a heavily muscled warrior, and its great helm is unusual in that it has no openings\u2014only a broad glass plate in the front with a second piece of glass above it. Strange plates, tubing, and large metal bosses adorn the armor in seemingly random fashion. On the back of the armor's left gauntlet is a rectangular metal box, from which projects a short rod tipped with a cone-shaped red crystal.",
	"While wearing this armor, you gain the following benefits:",
	"\u2022 You have a +1 bonus to AC.",
	"\u2022 Your Strength score is 18 (this has no effect if your Strength is already 18 or higher).",
	"\u2022 You have advantage on death saving throws.",
	"The armor has further capabilities that can be powered either by energy cells or by your own life energy. You can use a bonus action to draw power from an energy cell or sacrifice hit points to gain one of the following benefits:",
	"\u2022 Emit a force field to gain 2d6 + 5 temporary hit points (1 charge or 5 hit points).",
	"\u2022 Activate boosters to gain a flying speed of 15 feet for 1 minute (1 charge or 5 hit points).",
	"\u2022 Fire arm-mounted laser: +8 to hit, range 120 feet, one target. 2d6 radiant damage (1 charge or 5 hit points).",
	"\u2022 Translate any writing you can see in any nonmagical language, to a total of one thousand words over 1 minute (1 charge or 5 hit points).",
	"\u2022 Fill the armor with air, so you can breathe normally in any environment for up to 1 hour (1 charge or 5 hit points).",
	"u2022 Gain darkvision to a range of 60 feet for up to 1 hour (1 charge or 5 hit points).",
	"The armor can accept only one energy cell at a time. It is found with one energy cell attached, containing 2d10 charges."
];
MagicItemsList["powered armor"] = {
	name : "Powered Armor",
	source : [["LLoK", 56]],
	type : "armor (plate)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This unusual plate armor looks like a heavily muscled warrior with a helm without openings. It gives me a +1 bonus to AC, increases my Strength to 18, and adv. on death saves. As a bonus action, I can use charges from its energy cell or expend my own HP to have it do various things, see Notes page.",
	descriptionFull : LLoK_poweredArmorFullDescription.join("\n   "),
	attunement : true,
	weight : 65,
	scoresOverride : [18, 0, 0, 0, 0, 0],
	savetxt : { text : ["Adv. on death saves"] },
	action : [["bonus action", " (use energy)"]],
	armorOptions : [{
		regExpSearch : /^(?=.*powered)(?=.*armor).*$/i,
		name : "Powered Armor",
		source : [["LLoK", 56]],
		type : "heavy",
		ac : "18+1",
		stealthdis : true,
		weight : 65,
		strReq : 15,
		selectNow : true
	}],
	usages : "2d10",
	recovery : "Never",
	additional : "energy cell",
	toNotesPage : [{
		name : "Features",
		note : desc(LLoK_poweredArmorFullDescription).replace(/your/g, "my").replace(/you /ig, "I ")
	}],
	weaponOptions : [{
		regExpSearch : /^(?=.*arm)(?=.*mounted)(?=.*laser).*$/i,
		name : "Arm-Mounted Laser",
		source : [["LLoK", 56]],
		ability : 0,
		type : "Magic Item",
		damage : [2, 6, "radiant"],
		range : "120 ft",
		description : "Bonus action; Uses 1 charge or 5 HP",
		abilitytodamage : false,
		modifiers : [8, ""],
		selectNow : true
	}]
}

// Spells (contain contributions by /u/KittenWithMittens)
SpellsList["flock of familiars"] = {
	name : "Flock of Familiars",
	classes : ["warlock", "wizard"],
	source : ["LLoK", 57],
	level : 2,
	school : "Conj",
	time : "1 min",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "Summon 3+1/SL familiars as Find Familiar; can see through their eyes and deliver touch spells; see B",
	descriptionFull : "You temporarily summon three familiars\u2014spirits that take animal forms of your choice. Each familiar uses the same rules and options for a familiar conjured by the find familiar spell. All the familiars conjured by this spell must be the same type of creature (celestials, fey, or fiends; your choice). If you already have a familiar conjured by the find familiar spell or similar means, then one fewer familiars are conjured by this spell.\n   Familiars summoned by this spell can telepathically communicate with you and share their visual or auditory senses while they are within 1 mile of you.\n   When you cast a spell with a range of touch, one of the familiars conjured by this spell can deliver the spell, as normal. However, you can cast a touch spell through only one familiar per turn." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, you conjure an additional familiar for each slot level above 2nd."
}
SpellsList["galder's speedy courier"] = {
	name : "Galder's Speedy Courier",
	classes : ["warlock", "wizard"],
	source : ["LLoK", 57],
	level : 4,
	school : "Conj",
	time : "1 a",
	range : "10 ft",
	components : "V,S,M\u2020",
	compMaterial : "25 gp, or mineral goods of equivalent value, which the spell consumes",
	duration : "10 min",
	description : "Send 3\xD73\xD73 ft chest of items I put in it to named crea on same plane; SL8: other plane (25gp cons.)",
	descriptionMetric : "Send 1\xD71\xD71 m chest of items I put in it to named crea on same plane; SL8: other plane (25gp cons.)",
	descriptionFull : "You summon a Small air elemental to a spot within range. The air elemental is formless, nearly transparent, immune to all damage, and cannot interact with other creatures or objects. It carries an open, empty chest whose interior dimensions are 3 feet on each side. While the spell lasts, you can deposit as many items inside the chest as will fit. You can then name a living creature you have met and seen at least once before, or any creature for which you possess a body part, lock of hair, clipping from a nail, or similar portion of the creature's body.\n   As soon as the lid of the chest is closed, the elemental and the chest disappear, then reappear adjacent to the target creature. If the target creature is on another plane, or if it is proofed against magical detection or location, the contents of the chest reappear on the ground at your feet.\n   The target creature is made aware of the chest's contents before it chooses whether or not to open it, and knows how much of the spell's duration remains in which it can retrieve them. No other creature can open the chest and retrieve its contents. When the spell expires or when all the contents of the chest have been removed, the elemental and the chest disappear. The elemental also disappears if the target creature orders it to return the items to you. When the elemental disappears, any items not taken from the chest reappear on the ground at your feet." + AtHigherLevels + "When you cast this spell using an 8th-level spell slot, you can send the chest to a creature on a different plane of existence from you."
}
SpellsList["galder's tower"] = {
	name : "Galder's Tower",
	classes : ["wizard"],
	source : ["LLoK", 57],
	level : 3,
	school : "Conj",
	time : "10 min",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "A fragment of stone, wood, or other building material",
	duration : "24 h",
	description : "Conjure round or square tower with 2+1/Sl stories, each 100 sq ft and 10 ft high; see book",
	descriptionFull : "You conjure a two-story tower made of stone, wood, or similar suitably sturdy materials. The tower can be round or square in shape. Each level of the tower is 10 feet tall and has an area of up to 100 square feet. Access between levels consists of a simple ladder and hatch. Each level takes one of the following forms, chosen by you when you cast the spell:" +
	"\n \u2022 A bedroom with a bed, chairs, chest, and magical fireplace" +
	"\n \u2022 A study with desks, books, bookshelves, parchments, ink, and ink pens" +
	"\n \u2022 A dining space with a table, chairs, magical fireplace, containers, and cooking utensils" +
	"\n \u2022 A lounge with couches, armchairs, side tables and footstools" +
	"\n \u2022 A washroom with toilets, washtubs, a magical brazier, and sauna benches" +
	"\n \u2022 An observatory with a telescope and maps of the night sky" +
	"\n \u2022 An unfurnished, empty room" +
	"\n\nThe interior of the tower is warm and dry, regardless of conditions outside. Any equipment or furnishings conjured with the tower dissipate into smoke if removed from it. At the end of the spell's duration, all creatures and objects within the tower that were not created by the spell appear safely outside on the ground, and all traces of the tower and its furnishings disappear." +
	"\n   You can cast this spell again while it is active to maintain the tower's existence for another 24 hours. You can create a permanent tower by casting this spell in the same location and with the same configuration every day for one year." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the tower can have one additional story for each slot level beyond 3rd."
}

// pub_20181120_GGtR.js
// This file adds all material from the Guildmasters' Guide to Ravnica to MPMB's Character Record Sheet

// Define the source
SourceList.G = {
	name : "Guildmasters' Guide to Ravnica",
	abbreviation : "GGtR",
	group : "Campaign Sourcebooks",
	campaignSetting : "Magic: The Gathering",
	url : "https://dnd.wizards.com/products/guildmasters-guide-ravnica",
	date : "2018/11/20"
};

// Add the Centaur race
RaceList["centaur"] = {
	regExpSearch : /centaur/i,
	name : "Centaur",
	sortname : "Centaur",
	source : [["G", 15], ["MOT", 19]],
	plural : "Centaurs",
	size : 3,
	speed : {
		walk : { spd : 40, enc : 30 }
	},
	languageProfs : ["Common", "Sylvan"],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /\b(hoofs?|hooves)\b/i,
		name : "Hooves",
		source : [["G", 15], ["MOT", 19]],
		damage : [1, 4, "bludgeoning"],
		description : "Use as bonus action after charge 30 ft",
		selectNow : true
	}],
	skillstxt : "Choose one from Animal Handling, Medicine, Nature, or Survival",
	age : " mature and age at about the same rate as humans",
	height : " stand between 6 and 7 feet tall, with their equine bodies reaching about 4 feet at the withers (6'0\" + 1d10\")",
	weight : " weigh around 670 lb (600 + 1d10 \xD7 2d12 lb)",
	heightMetric : " stand around 2 metres tall, with their equine bodies reaching about 1,5 metres at the withers (183 + 3d8 cm)",
	weightMetric : " weigh around 300 kg (270 + 3d8 \xD7 4d12 / 10 kg)",
	scores : [2, 0, 0, 0, 1, 0],
	trait : "Centaur (+2 Strength +1 Wisdom)" + desc([
		"Fey: My creature type is fey, rather than humanoid.",
		"Hooves: I can use my hooves for unarmed strikes that deal 1d4 bludgeoning damage.",
		"Charge: If I move 30 ft straight toward a creature and then hit it with a melee weapon attack on the same turn, I can make a hooves attack against it as a bonus action.",
		"Equine Build: I count as one size larger for my carrying capacity and the weight I can push, drag, or lift. Because of my hooves, 1 ft of movement while climbing costs me 4 ft."
	]),
	action : [["bonus action", "Hooves (after charge)"]],
	carryingCapacity : 2
};
// Add Loxodon
RaceList["loxodon"] = {
	regExpSearch : /loxodon/i,
	name : "Loxodon",
	source : [["G", 18]],
	plural : "Loxodons",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Loxodon"],
	savetxt : { adv_vs : ["charmed", "frightened"] },
	armorOptions : [{
		regExpSearch : /^(?=.*loxodon)(?=.*(natural|hide|skin)).*$/i,
		name : "Loxodon Natural Armor",
		source : [["G", 18]],
		ac : "12+Con",
		dex : -10,
		selectNow : true
	}],
	vision : [["Keen Smell", 0]],
	age : " physically mature at the same rate as humans, but are considered young until they reach the age of 60 and live about 450 years",
	height : " stand between 7 and 8 feet tall (6'7\" + 2d10\")",
	weight : " weigh between 300 and 400 pounds (295 + 2d10 \xD7 2d4 lb)",
	heightMetric : " stand between 2 and 2,5 metres tall (200 + 5d10 cm)",
	weightMetric : " weigh between 135 and 200 kg (133 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 0, 1, 0],
	trait : "Loxodon (+2 Constitution, +1 Wisdom)" +
		"\n  Powerful Build: I count as one size larger for my carrying capacity, push, drag, and lift." +
		"\n  Natural Armor: " + (typePF ? "I have an AC of" : "My thick, leathery skin gives me AC") + " 12 + Constitution modifier + shield." +
		"\n  Trunk: I can grasp things with my trunk or use it as a snorkel. It has a reach of 5 ft and can lift things up to 5\xD7 my Strength in pounds. I can also use it to make unarmed strikes, but I can't use it to wield weapons, shields, or anything that requires manual precision." +
		"\n  Keen Smell: I have " + (typePF ? "advantage on Wisdom (Perception), Wisdom (Survival), and Intelligence (Investigation) checks that involve smell." : "adv. on Perception, Survival, and Investigation checks involving smell."),
	carryingCapacity : 2
};

// Add the Minotaur race
RaceList["minotaur"] = {
	regExpSearch : /minotaur/i,
	name : "Minotaur",
	sortname : "Minotaur",
	source : [["G", 19], ["MOT", 22]],
	plural : "Minotaurs",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Minotaur"],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /\bhorns?\b/i,
		name : "Horns",
		source : [["G", 19], ["MOT", 23]],
		damage : [1, 6, "piercing"],
		description : "Attack as a bonus action after moving 20 ft with the Dash action",
		selectNow : true
	}],
	skillstxt : "Choose one from Intimidation or Persuasion",
	age : " reach adulthood around age 17 and live up to 150 years",
	height : " stand around 6 feet tall (5'4\" + 2d8\")",
	weight : " weigh around 300 pounds (175 + 2d8 \xD7 2d6 lb)",
	heightMetric : " stand around 175 cm tall (163 + 5d8 cm)",
	weightMetric : " weigh around 135 kg (80 + 5d8 \xD7 4d6 / 10 kg)",
	scores : [2, 0, 1, 0, 0, 0],
	abilitySave : 1,
	trait : "Minotaur (+2 Strength +1 Constitution)" + desc([
		"Horns: I can use my horns for unarmed strikes that deal 1d6 piercing damage.",
		"Goring Rush: When taking a Dash action and moving at least 20 ft, I can make a horns attack as a bonus action.",
		"Hammering Horns: As a bonus action after I hit a melee attack during my Attack action, I can shove that target with my horns, if it is up to than one size larger than me. It must make a Str save (DC 8 + Str mod + Prof Bonus) or be pushed up to 10 ft away from me."
	]),
	features : {
		"goring rush" : {
			name : "Goring Rush",
			minlevel : 1,
			action : ["bonus action", " (with Dash)"]
		},
		"hammering horns" : {
			name : "Hammering Horns",
			minlevel : 1,
			action : ["bonus action", " (after hit)"]
		}
	}
};

// Add Simic Hybrid
RaceList["simic hybrid"] = {
	regExpSearch : /^(?=.*(simic|elf|dwarf|human|orc))(?=.*hybrid).*$/i,
	name : "Simic hybrid",
	source : [["G", 20]],
	plural : "Simic hybrids",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", ["Elvish or Vedalken", 1]],
	vision : [["Darkvision", 60]],
	weaponOptionsSp : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*grappling)(?=.*(appendage|tentacle|claw)).*$/i,
		name : "Grappling Appendages",
		source : [["G", 20]],
		damage : [1, 6, "bludgeoning"],
		description : "After hitting, start grapple on target as a bonus action"
	}, {
		regExpSearch : /^(?=.*acid)(?=.*spit).*$/i,
		name : "Acid Spit",
		source : [["G", 21]],
		ability : 3,
		type : "Natural",
		damage : ["C", 10, "acid"],
		range : "30 ft",
		description : "Dex save, success - no damage",
		abilitytodamage : false,
		dc : true
	}],
	extraACSp : {
		name : "Carapace",
		mod : 1,
		text : "I gain a +1 bonus to AC while I'm not wearing heavy armor.",
		stopeval : function (v) { return v.heavyArmor; }
	},
	age : " age slightly faster than their base humanoid race and their maximum lifespan is somewhat reduced",
	height : " are of the same height as typical for their humanoid race",
	weight : " are of the same weight as typical for their humanoid race",
	scorestxt : "Simic Hybrid: +2 Constitution and +1 to one other ability score of my choice;",
	scores : [0, 0, 2, 0, 0, 0],
	trait : "Simic Hybrid (+2 Constitution and +1 to one other ability score of my choice)\n   Animal Enhancement (1st level): Choose one to three types of enhancement using the \"Racial Options\" button: Manta Glide, Nimble Climber, or Underwater Adaptation.\n   Animal Enhancement (5th level): At 5th level, I gain another animal enhancement. I can either choose one I didn't take at 1st level or choose Grappling Appendages, Carapace, or Acid Spit.",
	features : {
		"animal enhancement" : {
			name : "Animal Enhancement",
			minlevel : 5,
			eval : function() {
				var curChoice = ParseRace(What('Race Remember'))[1].capitalize();
				var AEoptions = ["Manta Glide", "Nimble Climber", "Underwater Adaptation", "Grappling Appendages", "Carapace", "Acid Spit"];
				if (curChoice && AEoptions.indexOf(curChoice) !== -1) AEoptions.splice(AEoptions.indexOf(curChoice), 1);
				var theChoice = AskUserOptions('Simic Hybrid 5th-level Animal Enhancement', 'The Simic Hybrid race offers a choice of animal enhancement at 5th-level. Make a selection to update the sheet accordingly. You can only change this selection by removing the Simic Hybrid race or changing its variant.', AEoptions, 'radio', true);
				var feaTxt = '';
				var rObjNm = "simic hybrid";
				var rObj = RaceList[rObjNm];
				var rNm = rObj.name;
				switch (theChoice) {
					case "Manta Glide":
						feaTxt = "Animal Enhancement (Manta Glide): I have manta ray-like wings that I can use to slow my fall. I subtract 100 ft when calculating falling damage and I can move 2 ft horizontally for every 1 ft I descend.";
						break;
					case "Nimble Climber":
						feaTxt = "Animal Enhancement (Nimble Climber): I have a climbing speed equal to my walking speed.";
						SetProf("speed", true, { climb : { spd : 'walk', enc : 'walk' } }, rNm + ": Animal Enhancement (Nimble Climber)");
						break;
					case "Underwater Adaptation":
						feaTxt = "Animal Enhancement (Underwater Adaptation): I can breathe air and water, and I have a swimming speed equal to my walking speed.";
						SetProf("speed", true, { swim : { spd : 'walk', enc : 'walk' } }, rNm + ": Animal Enhancement (Underwater Adaptation)");
						break;
					case "Grappling Appendages":
						feaTxt = "Animal Enhancement (Grappling Appendages): I have two extra appendages which I can use to make unarmed strikes for 1d6 bludgeoning damage. As a bonus action after hitting with them, I can try to grapple the target. I can't use these appendages to wield anything.";
						processWeaponOptions(true, rObjNm, rObj.weaponOptionsSp[0]);
						AddWeapon("Grappling Appendages");
						AddAction("bonus action", "Grappling Appendages (after hit)", rNm + ": Animal Enhancement (Grappling Appendages)");
						break;
					case "Carapace":
						feaTxt = "Animal Enhancement (Carapace): My skin is covered by a thick shell, giving my a +1 to AC whenever I'm not wearing heavy armor.";
						processExtraAC(true, rNm + ": Animal Enhancement (Carapace)", rObj.extraACSp, rNm);
						break;
					case "Acid Spit":
						feaTxt = "Animal Enhancement (Acid Spit): As an action, I can spit acid at a creature within 30 ft that I can see. It must make a Dex save (DC 8 + Con mod + Prof Bonus) or take 2d10 acid damage (+1d10 at 11th and 17th level). I can do this my Con mod times per long rest.";
						AddFeature("Acid Spit", "Con Mod", "", "long rest", rNm + ": Animal Enhancement (Acid Spit)", 0, "event.value = Math.max(1, What('Con Mod'));");
						processWeaponOptions(true, rObjNm, rObj.weaponOptionsSp[1]);
						AddWeapon("Acid Spit");
						break;
				};
				if (What("Unit System") !== "imperial") feaTxt = ConvertToMetric(feaTxt, 0.5);
				Value("Racial Traits", What("Racial Traits").replace(/Animal Enhancement \(5th level\):.*/, '') + feaTxt);
				Value("Race Remember", What("Race Remember") + "-*" + theChoice.replace(' ', '_') + "*");
			},
			removeeval : function() {
				var theRegex = /\*(Manta_Glide|Nimble_Climber|Underwater_Adaptation|Grappling_Appendages|Carapace|Acid_Spit)\*/i;
				var raceRem = What("Race Remember");
				if (!theRegex.test(raceRem)) return;
				var theChoice = raceRem.match(theRegex)[1].replace('_', ' ').capitalize();
				var rObjNm = "simic hybrid";
				var rObj = RaceList[rObjNm];
				var rNm = rObj.name;
				switch (theChoice) {
					case "Nimble Climber":
						SetProf("speed", false, { climb : { spd : 'walk', enc : 'walk' } }, rNm + ": Animal Enhancement (Nimble Climber)");
						break;
					case "Underwater Adaptation":
						SetProf("speed", false, { swim : { spd : 'walk', enc : 'walk' } }, rNm + ": Animal Enhancement (Underwater Adaptation)");
						break;
					case "Grappling Appendages":
						RemoveWeapon("Grappling Appendages");
						processWeaponOptions(false, rObjNm, rObj.weaponOptionsSp[0]);
						RemoveAction("bonus action", "Grappling Appendages (after hit)", rNm + ": Animal Enhancement (Grappling Appendages)");
						break;
					case "Carapace":
						processExtraAC(false, rNm + ": Animal Enhancement (Carapace)", rObj.extraACSp, rNm);
						break;
					case "Acid Spit":
						RemoveFeature("Acid Spit", "", "", "", "", "", "event.value = Math.max(1, What('Con Mod'));");
						RemoveWeapon("Acid Spit");
						processWeaponOptions(false, rObjNm, rObj.weaponOptionsSp[1]);
						break;
				};
				Value("Racial Traits", What("Unit System") === "imperial" ? CurrentRace.trait : ConvertToMetric(CurrentRace.trait, 0.5));
			}
		}
	}
};
AddRacialVariant("simic hybrid", "manta glide", {
	regExpSearch : /manta glide/i,
	source : [["G", 20]],
	trait : "Simic Hybrid (+2 Constitution and +1 to one other ability score of my choice)\n   Animal Enhancement (Manta Glide): I have manta ray-like wings that I can use to slow my fall. I subtract 100 ft when calculating falling damage and I can move 2 ft horizontally for every 1 ft I descend.\n   Animal Enhancement (5th level): At 5th level, I gain another animal enhancement. I can choose Nimble Climber, Underwater Adaptation, Grappling Appendages, Carapace, or Acid Spit."
});
AddRacialVariant("simic hybrid", "nimble climber", {
	regExpSearch : /nimble climber/i,
	source : [["G", 20]],
	speed : {
		walk : { spd : 30, enc : 20 },
		climb : { spd : 'walk', enc : 'walk' }
	},
	trait : "Simic Hybrid (+2 Constitution and +1 to one other ability score of my choice)\n   Animal Enhancement (Nimble Climber): I have a climbing speed equal to my walking speed.\n   Animal Enhancement (5th level): At 5th level, I gain another animal enhancement. I can choose Manta Glide, Underwater Adaptation, Grappling Appendages, Carapace, or Acid Spit."
});
AddRacialVariant("simic hybrid", "underwater adaptation", {
	regExpSearch : /underwater adaptation/i,
	source : [["G", 20]],
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 'walk', enc : 'walk' }
	},
	trait : "Simic Hybrid (+2 Constitution and +1 to one other ability score of my choice)\n   Animal Enhancement (Underwater Adaptation): I can breathe air and water, and I have a swimming speed equal to my walking speed.\n   Animal Enhancement (5th level): At 5th level, I gain another animal enhancement. I can choose Manta Glide, Nimble Climber, Grappling Appendages, Carapace, or Acid Split."
});

// Add Vedalken
RaceList["vedalken"] = {
	regExpSearch : /vedalken/i,
	name : "Vedalken",
	source : [["G", 21]],
	plural : "Vedalken",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	savetxt : { text : ["Adv. on Int/Wis/Cha saves"] },
	skillstxt : "Choose one from Arcana, History, Investigation, Medicine, Performance, or Sleight of Hand. I add 1d4 to a check with the chosen skill",
	languageProfs : ["Common", "Vedalken", 1],
	toolProfs : [["Any tool", 1]],
	age : " reach maturity around age 40 and typically live 350 years, with some living up to 500 years",
	height : " stand between 6 and 6 and a half feet tall (5'4\" + 2d10\")",
	weight : " are slender, weighing around 200 pounds (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " stand between 1,8 and 2 metres tall (163 + 5d10 cm)",
	weightMetric : " are slender, weighing around 100 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 2, 1, 0],
	trait : "Vedalken (+2 Intelligence, +1 Wisdom)" + desc([
		"Vedalken Dispassion: I have advantage on all Intelligence, Wisdom, and Charisma saves.",
		"Tireless Precision: I am proficient with any one tool and one skill of my choice: Arcana, History, Investigation, Medicine, Performance, or Sleight of Hand. Whenever I make an ability check with the chosen tool or skill, I can add 1d4 to the check's total.",
		"Partially Amphibious: Once per long rest, I can breathe underwater for 1 hour by absorbing oxygen through my skin."
	]),
	features : {
		"partially amphibious" : {
			name : "Partially Amphibious",
			minlevel : 1,
			usages : 1,
			recovery : "long rest"
		}
	},
	advantages : [["Int", true], ["Wis", true], ["Cha", true]]
};

// New Subclass for Cleric: Order Domain
AddSubClass("cleric", "order domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*order).*$/i,
	subname : "Order Domain",
	source : [["T", 31], ["G", 25]],
	spellcastingExtra : ["command", "heroism", "hold person", "zone of truth", "mass healing word", "slow", "compulsion", "locate creature", "commune", "dominate person"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : [["T", 32], ["G", 26]],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with heavy armor, and either the Intimidation or Persuasion skill",
			armorProfs : [false, false, true, false],
			skillstxt : "Choose one from Intimidation or Persuasion"
		},
		"subclassfeature1.1" : {
			name : "Voice of Authority",
			source : [["T", 32], ["G", 26]],
			minlevel : 1,
			description : desc([
				"Whenever I use a spell slot to cast a spell on an ally, it can use its reaction to attack",
				"The ally makes one weapon attack against a target of my choice that I can see",
				"If the spell targets multiple allies, I can choose which one can make the attack"
			])
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Order's Demand",
			source : [["T", 32], ["G", 26]],
			minlevel : 2,
			description : desc([
				"As an action, all chosen targets in 30 ft that can see or hear me must make a Wis save",
				"If failed, it is charmed by me until the end of my next turn or it takes any damage",
				"Also, I can choose to have a charmed target drop what its holding when it fails its save"
			]),
			action : [["action", ""]]
		},
		"subclassfeature6" : {
			name : "Embodiment of the Law",
			source : [["T", 32], ["G", 26]],
			minlevel : 6,
			description : desc([
				"When I cast an enchantment spell using a spell slot, I can reduce its casting time",
				"If the spell normally has a casting time of an action, I can now cast it as a bonus action"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (CurrentSpells[spName].refType == "class" && spellObj.school == "Ench" && spellObj.time == "1 a") {
							spellObj.time = "1a/bns"
							return true;
						};
					},
					"When I cast an enchantment spell using a spell slot that normally requires 1 action to cast, I can reduce its casting time to a bonus action."
				]
			}
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : [["T", 32], ["G", 26]],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 psychic damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && v.isWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 psychic damage' + (classes.known.cleric.level < 17 ? '' : ' \u0026 again if hit by ally before my next turn');
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra psychic damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Order's Wrath",
			source : [["T", 32], ["G", 26]],
			minlevel : 17,
			description : desc([
				"If I deal my Divine Strike damage to a creature, it is cursed until my next turn starts",
				"The next time it is hit by a weapon attack from my allies, it takes +2d8 psychic damage"
			])
		}
	}
});

// New Subclass for Druid: Circle of Spores (but add TCoE as main source, because it is more likely to be available at a table)
AddSubClass("druid", "circle of spores", {
	regExpSearch : /^(?=.*(druid|shaman))(?=.*spores).*$/i,
	subname : "Circle of Spores",
	source : [["T", 36], ["G", 26]],
	features : {
		"subclassfeature2" : {
			name : "Circle Spells",
			source : [["T", 36], ["G", 27]],
			minlevel : 2,
			description : desc([
				"I learn the Chill Touch cantrip and gain the ability to cast certain spells",
				"These are always prepared, but don't count against the number of spells I can prepare"
			]),
			spellcastingBonus : {
				name : "Circle Spells",
				spells : ["chill touch"],
				selection : ["chill touch"]
			},
			spellcastingExtra : ["blindness/deafness", "gentle repose", "animate dead", "gaseous form", "blight", "confusion", "cloudkill", "contagion"]
		},
		"subclassfeature2.1" : {
			name : "Halo of Spores",
			source : [["T", 36], ["G", 27]],
			minlevel : 2,
 			description : desc([
				"As a reaction when someone I can see in 10 ft starts its turn or moves, I can have it save",
				"It must succeed on a Constitution save or take necrotic damage from my cloud of spores"
			]),
			additional : levels.map(function (n) { return n < 2 ? "" : 'Con save or 1d' + (n < 6 ? 4 : n < 10 ? 6 : n < 14 ? 8 : 10) + " necrotic damage"; }),
			action : ["reaction", ""]
		},
		"subclassfeature2.2" : { // changed from poison to necrotic damage in TCoE
			name : "Symbiotic Entity",
			source : [["T", 37], ["G", 27]],
			minlevel : 2,
			description : desc([
				"As an action, I can expend a Wild Shape use to boost my spores instead of transforming",
				"I gain 4 temporary hit points per druid level and my Halo of Spores damage increases",
				"Also, my melee weapon attacks do +1d6 necrotic damage with every hit",
				"This lasts for 10 min, until these temporary HP run out, or until I use Wild Shape again"
			]),
			additional : levels.map(function (n) {
				return n < 2 ? "" : Math.floor(n*4) + " temp HP; Halo of Spores: 2d" + (n < 6 ? 4 : n < 10 ? 6 : n < 14 ? 8 : 10);
			}),
			action : ["action", ""],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.isMeleeWeapon && (/\b(spore|symbiotic)\b/i).test(v.WeaponTextName)) {
							fields.Description += (fields.Description ? '; ' : '') + '+1d6 necrotic damage';
						};
					},
					"If I include the word 'Spore' or 'Symbiotic' in a melee weapon's name, it gets treated as a weapon that is infused by my Symbiotic Entity feature, adding +1d6 necrotic damage in the description."
				]
			}
		},
		"subclassfeature6" : {
			name : "Fungal Infestation",
			source : [["T", 37], ["G", 27]],
			minlevel : 6,
			description : desc([
				"As a reaction when a Small/Medium beast/humanoid dies in 10 ft, I can animate it",
				"It rises as a zombie with 1 HP that follows my mental commands and dies after 1 hour",
				"It can only take the attack action for one melee attack; It takes its turns after mine"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["reaction", ""]
		},
		"subclassfeature10" : {
			name : "Spreading Spores",
			source : [["T", 37], ["G", 27]],
			minlevel : 10,
			description : " [only while Symbiotic Entity is active]" + desc([
				"As a bonus action, I create a 10-ft cube of fungal spores within 30 ft, lasting for 1 min",
				"Any creature moving into or starting its turn in it must save against my Halo of Spores",
				"The cube ends if I use this feature again; While it persists, I can't use my Halo of Spores"
			]),
			action : ["bonus action", " (start/end)"]
		},
		"subclassfeature14" : {
			name : "Fungal Body",
			source : [["T", 38], ["G", 27]],
			minlevel : 14,
			description : desc([
				"I'm immune to being blinded, deafened, frightened, poisoned, and critical hits"
			]),
			savetxt : { immune : ["blinded", "deafened", "frightened", "poisoned", "critical hits (unless incapacitated)"] }
		}
	}
});

BackgroundList["azorius functionary"] = {
	regExpSearch : /^(?=.*azorius)(?=.*functionary).*$/i,
	name : "Azorius Functionary",
	source : [["G", 33]],
	skills : ["Insight", "Intimidation"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["friends", "message", "command", "ensnaring strike", "arcane lock", "calm emotions", "hold person", "clairvoyance", "counterspell", "compulsion", "divination", "dominate person"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Friends, Message, Command, Ensnaring Strike, Arcane Lock, Calm Emotions, Hold Person, Clairvoyance, Counterspell, Compulsion, Divination, and Dominate Person."
		]
	},
	gold : 10,
	equipleft : [
		["Scroll with law text", "", ""],
		["Blue ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Azorius insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [2],
	feature : "Legal Authority",
	trait : [
		"I try never to let my judgment become clouded by emotion.",
		"I have infinite patience with the dolts and boors I'm forced to deal with every day.",
		"When I give an order, I expect it to be obeyed.",
		"I just want things the way I like them: neat, orderly, and clean.",
		"No wrongdoing can escape my watchful gaze.",
		"I always say exactly what I mean, no matter how many words it takes to communicate the particular nuance I am attempting to convey.",
		"I'm very literal and don't appreciate metaphor or sarcasm.",
		"I never change my mind once it's made up."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Order", "Order: The law is meant to ensure that the gears of society turn smoothly and quietly. (Lawful)"],
		["Peace", "Peace: The ultimate object of the law is to remove violence from society. (Good)"],
		["Compliance", "Compliance: Coercion is a fine way of ensuring that the laws are obeyed. (Lawful)"],
		["Legislation", "Legislation: The law embodies excellence in its precision and detail. (Lawful)"],
		["Punishment", "Punishment: A public display of consequences is an excellent deterrent for other criminals. (Evil)"]
	],
	bond : [
		"I am beholden to an Azorius arrester who captured the criminal who killed my parents, saving me from the same fate.",
		"I hope one day to write the laws, not just enforce them.",
		"I tried and failed to prevent a murder, and I have sworn to find and arrest the perpetrator.",
		"I successfully prevented a murder, and the would-be perpetrator wants me dead.",
		"One of my parents was prominent in the guild, and I resent constantly being compared to that standard.",
		"I've modeled my career after a highly respected lawmage or arrester, but I fear that my role model might be involved in something illegal."
	],
	flaw : [
		"I'm unable to distinguish between the letter and the spirit of the law.",
		"I seem like a harsh judge to others, but I judge myself most harshly of all.",
		"I have a secret, illegal vice.",
		"I was traumatized by witnessing a crime as a child.",
		"I'm incapable of deception.",
		"I wish I had joined the Boros, but I fear they'd never accept me."
	]
};
BackgroundFeatureList["legal authority"] = {
	description : "I have the authority to enforce the laws of Ravnica, inspiring respect and fear as a result. People mind their manners, avoid my attention, and assume I have a right to be wherever I am. My Azorius insignia gets me an audience with anyone I want, though it might work adversely with incorrigible lawbreakers. Abusing this privilege can get me in serious trouble.",
	source : [["G", 33]]
};

BackgroundList["boros legionnaire"] = {
	regExpSearch : /^(?=.*boros)(?=.*legionnaire).*$/i,
	name : "Boros Legionnaire",
	source : [["G", 40]],
	skills : ["Athletics", "Intimidation"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["fire bolt", "sacred flame", "guiding bolt", "heroism", "aid", "scorching ray", "beacon of hope", "blinding smite", "death ward", "wall of fire", "flame strike"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Fire Bolt, Sacred Flame, Guiding Bolt, Heroism, Aid, Scorching Ray, Beacon of Hope, Blinding Smite, Death Ward, Wall of Fire, and Flame Strike."
		]
	},
	gold : 2,
	equipleft : [
		["Feather from angel's wing", "", ""],
		["Tattered piece of Boros banner", 1, ""],
		["Ink pen (quill)", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Boros insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Celestial, Draconic, Goblin, or Minotaur", 1]],
	toolProfs : [["Gaming set", 1]],
	feature : "Legion Station",
	trait : [
		"I approach every task with the same high degree of military precision.",
		"I am always the first into the fray.",
		"I bear any injury or indignity with stoic discipline.",
		"My righteous wrath is easily inflamed by the slightest iniquity.",
		"My honor is more important to me than my life.",
		"Dangerous work is best accomplished by an orderly group working with common purpose.",
		"I treat my weapons, uniform, and insignia with reverence, for they are gifts of the angels.",
		"I pace when standing and fidget incessantly when forced to sit."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Justice", "Justice: Achieving justice requires establishing fair, equitable, and compassionate relationships within a community. (Good)"],
		["Protection", "Protection: It isn't right for innocents to suffer because of the arrogance of the powerful. (Good)"],
		["Solidarity", "Solidarity: It is most crucial to act with a single will, marching side by side in perfect accord. (Lawful)"],
		["Order", "Order: Society functions only if people do their duty and respect the chain of command. (Lawful)"],
		["Conviction", "Conviction: Anything worth doing is worth doing with your whole heart. (Lawful)"]
	],
	bond : [
		"I would lay down my life for Aurelia and the angels.",
		"I owe my life to the Boros captain who took me in when I was living on the streets.",
		"My fellow legionnaires are my family.",
		"I wield the same Boros weapon my grandparent did, for the honor of our family.",
		"I ran with the Rakdos in my youth, and I'm striving to atone for my past misdeeds.",
		"I do what I can to help out the spouse of a comrade who died in battle."
	],
	flaw : [
		"I act bravely when I'm in a group, but I'm a coward when I'm alone.",
		"I see everything in clear-cut black and white.",
		"I'm just a little fascinated by the ways of the Gruul.",
		"I trust the chain of command more than anything\u2014more even than my closest friends.",
		"I'm slow to trust members of other guilds.",
		"I've been known to turn a blind eye to injustice, with the help of a modest bribe."
	],
	lifestyle : "poor"
};
BackgroundFeatureList["legion station"] = {
	description : "I am established in the hierarchy of the Boros Legion. I can requisition simple equipment for temporary use. I have access to any Boros garrison in Ravnica where I can rest in safety and have access to medics. I'm paid 1 gp per week (a Boros-minted 1-zino coin), allowing me (together with the free garrison lodging) to have a poor lifestyle between adventures.",
	source : [["G", 40]]
};

BackgroundList["dimir operative"] = {
	regExpSearch : /^(?=.*dimir)(?=.*operative).*$/i,
	name : "Dimir Operative",
	source : [["G", 46]],
	skills : ["Deception", "Stealth"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["encode thoughts", "mage hand", "disguise self", "sleep", "detect thoughts", "pass without trace", "gaseous form", "meld into stone", "nondetection", "arcane eye", "freedom of movement", "modify memory"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Encode Thoughts, Mage Hand, Disguise Self, Sleep, Detect Thoughts, Pass Without Trace, Gaseous Form, Meld into Stone, Nondetection, Arcane Eye, Freedom of Movement, and Modify Memory."
		]
	},
	gold : 0,
	equipleft : [
		["Small knife", 3, 0.25],
		["Starting equipment of secondary guild", "", ""]
	],
	equipright : [
		["Dark-colored common clothes", "", 3],
		["Dimir insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : ["Disguise kit"],
	feature : "False Guild Identity",
	trait : [
		"I'm good at hiding my true thoughts and feelings.",
		"When I'm in doubt about revealing something, I assume it's a secret, and I don't share it.",
		"I like to sound mysterious, because wisdom hidden grows deeper with time.",
		"I have no patience with people who get in my way.",
		"I love hearing about other people's nightmares.",
		"Combat is meant to be quick, clean, and one-sided.",
		"I like to stick to the shadows.",
		"I never show my anger. I just plot my revenge."
	],
	ideal : [
		["Guild", "Guild: My true guild is all that really matters. (Any)"],
		["Control", "Control: I like pulling the strings. (Lawful)"],
		["Secrets", "Secrets: I collect secrets and never reveal them. (Any)"],
		["Knowledge", "Knowledge: I want to know as much as I can about this city and how it works. (Any)"],
		["Independence", "Independence: I value the freedom to pursue my own goals without interference. (Chaotic)"],
		["Nihilism", "Nihilism: I don't believe in anything, and anyone who does is a fool. (Neutral)"]
	],
	bond : [
		"I discovered a secret I can't let anyone else uncover\u2014including my guild superiors.",
		"I formed a close friendship or romance with someone in the guild I'm infiltrating.",
		"The Dimir agent who recruited me was unmasked and killed. My revenge on the killers will be thorough and painful.",
		"I spend as much time as I can in the Ismeri Library because I'm certain an information hub operates behind its facade. I want its secrets!",
		"I'm utterly loyal to my superior in the guild, more than to the guild or its guildmaster.",
		"Someone has discovered my true identity."
	],
	flaw : [
		"I like secrets so much that I'm reluctant to share details of a plan even with those who need to know.",
		"I would let my friends die rather than reveal my true identity.",
		"I have trouble trusting anyone but myself.",
		"I have a particular vice that puts all my secrets at risk if I'm not careful.",
		"I'm pretty sure I've done something horrible that I can't remember because of the guild's mind magic.",
		"I put too much trust in the people who give me orders."
	],
	extra : [
		"Select a Reason for Infiltration",
		"Parental link",
		"Track activities",
		"Spy on individual",
		"Recruit more spies",
		"Member before recruitment",
		"Destroy from within",
		"Secret wish to join",
		"Randomly chosen"
	]
};
BackgroundFeatureList["false guild identity"] = {
	description : "I have more than one identity. The one I wear most of the time makes me appear to be a member of a guild other than my own. I have documentation, established acquaintances, and disguises that allow me to assume that persona and fit into the secondary guild. Whenever I choose, I can drop this identity and blend into the guildless masses of the city.",
	source : [["G", 46]]
};

BackgroundList["golgari agent"] = {
	regExpSearch : /^(?=.*golgari)(?=.*agent).*$/i,
	name : "Golgari Agent",
	source : [["G", 53]],
	skills : ["Nature", "Survival"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["dancing lights", "spare the dying", "entangle", "ray of sickness", "protection from poison", "ray of enfeeblement", "spider climb", "animate dead", "plant growth", "giant insect", "grasping vine", "cloudkill", "insect plague"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Dancing Lights, Spare the Dying, Entangle, Ray of Sickness, Protection from Poison, Ray of Enfeeblement, Spider Climb, Animate Dead, Plant Growth, Giant Insect, Grasping Vine, Cloudkill, and Insect Plague."
		]
	},
	gold : 10,
	equipleft : [
		["Poisoner's kit", "", 2]
	],
	equipright : [
		["Common clothes", "", 3],
		["Golgari insignia", "", ""],
		["Pet beetle or spider", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Elvish, Giant, or Kraul", 1]],
	toolProfs : ["Poisoner's kit"],
	feature : "Undercity Paths",
	trait : [
		"Remember, I could kill you in your sleep. Or put centipedes in your bedroll.",
		"I like to remind people of their inevitable demise.",
		"Sometimes I give voice to the whispers of the rot, which I hear but no one else does.",
		"I do my best to discourage anyone from approaching or talking to me.",
		"I have accepted my death. Hence, I don't fear it.",
		"Like roots growing through stone, I am relentless and determined in my action.",
		"I put my knowledge of anatomy to use by narrating the injuries my enemies suffer in grisly detail.",
		"Like a wild animal, I lash out viciously when I'm provoked\u2014and I'm easily provoked."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Stoicism", "Stoicism: All of us are part of the cyclical march of nature, which will continue with or without us. (Neutral)"],
		["Nature", "Nature: The natural world is more important than the edifices of the city and civilization. (Neutral)"],
		["Interdependence", "Interdependence: We are all part of nature's web. (Lawful)"],
		["Ambition", "Ambition: The time of Golgari ascendance is at hand, and I intend to have a prominent place in the new world order. (Evil)"],
		["Live and Let Live", "Live and Let Live: Meddling in the affairs of other guilds is a great way to get squashed like a bug. (Neutral)"]
	],
	bond : [
		"I cherish the finger of a family member who was petrified by a medusa.",
		"I have an identical twin who is as different from me as any person could be.",
		"I want to lead one faction of the guild to a new position of dominance.",
		"I love spending time in the moss-covered building where I took part in my first reclamation mission.",
		"I found something in the sewer that must never come to light.",
		"I am forever grateful to the reclaimer who found me floating facedown in the sewer, moments from death."
	],
	flaw : [
		"Death comes for us all, so you can't expect me to take care of someone who can't fight it off.",
		"I assume that anyone outside the Golgari looks down on me.",
		"I feel a need for revenge against those who enjoy the privilege of living above ground.",
		"I don't bother to couch my opinions in flattering words.",
		"I can't help but pocket any trinket or coin I come across, no matter how worthless.",
		"I'm convinced that I'm better and stronger than members of other guilds, isolated as they are from the realities of life and death."
	]
};
BackgroundFeatureList["undercity paths"] = {
	description : "I know hidden, underground pathways that I can use to bypass crowds, obstacles, and observation as I move through the city. I can lead a group to travel between two locations in the city twice as fast as normally. The paths of the undercity are haunted by dangers that rarely brave the light of the surface world, so my journey isn't guaranteed to be safe.",
	source : [["G", 53]]
};

BackgroundList["gruul anarch"] = {
	regExpSearch : /^(?=.*gruul)(?=.*anarch).*$/i,
	name : "Gruul Anarch",
	source : [["G", 60]],
	skills : ["Animal Handling", "Athletics"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["fire bolt", "produce flame", "compelled duel", "speak with animals", "thunderwave", "beast sense", "shatter", "conjure animals", "conjure barrage", "dominate beast", "stoneskin", "destructive wave"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Fire Bolt, Produce Flame, Compelled Duel, Speak with Animals, Thunderwave, Beast Sense, Shatter, Conjure Animals, Conjure Barrage, Dominate Beast, Stoneskin, and Destructive Wave."
		]
	},
	gold : 10,
	equipleft : [
		["Herbalism kit", "", 3],
		["Skull of a boar", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Gruul insignia", "", ""],
		["Hunting trap", "", 25],
		["Beast-hide cloak", "", 1],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Draconic, Giant, Goblin, or Sylvan", 1]],
	toolProfs : ["Herbalism kit"],
	feature : "Rubblebelt Refuge",
	trait : [
		"Unlike people, the beasts of the wild are friends who won't stab me in the back.",
		"Go ahead and insult me\u2014I dare you.",
		"I scorn those who can't survive away from the comforts of the city.",
		"Don't tell me I'm not allowed to do something.",
		"Laws are for people who are afraid to face their inner beasts.",
		"I smear the blood of my enemies over my skin.",
		"I was, in fact, raised by maaka.",
		"HarrRRAAGGHH! [I rarely form a coherent sentence and prefer to express myself by breaking things.]"
	],
	ideal : [
		["Clan", "Clan: My clan is all that really matters. (Any)"],
		["Anarchy", "Anarchy: No person or law or custom can tell another what to do. (Chaotic)"],
		["Nature", "Nature: We weren't born tame or domesticated, so we shouldn't have to live that way. (Neutral)"],
		["Might", "Might: The strongest are meant to dominate the weak. (Evil)"],
		["Rage", "Rage: AAAAAARRRRggggh! [To live is to feel and express the rage burning in your belly.] (Chaotic)"],
		["Tradition", "Tradition: The Old Ways must be preserved and upheld. (Any)"]
	],
	bond : [
		"I am determined that one day I will lead my clan\u2014or a new one.",
		"I would give my life for my clan chieftain.",
		"The chieftain of another clan has a grudge against me.",
		"I am devoted to a sacred site in the midst of the rubblebelt.",
		"My weapon is made from the first raktusk I ever hunted.",
		"GrrrRRAAAAGGHH! [I will do anything to prove myself greater than my siblings or ancestors.]"
	],
	flaw : [
		"If you question my courage, I will never back down.",
		"HrrrGGGAAAARRuuuh! [My anger in battle led to the death of a loved one.]",
		"I'm as stubborn as a batterboar.",
		"I'm so convinced of my superiority over soft, civilized people that I'll take great risks to prove it.",
		"I'm easily manipulated by people I find attractive.",
		"I'm not actually all that angry."
	],
	extra : [
		"Select a Gruul Clan",
		"Burning Tree clan",
		"Ghor clan",
		"Scab clan",
		"Slitz clan",
		"Gravel Hide clan",
		"Zhur-Taa clan",
		"Minor or new clan",
		"Trog"
	]
};
BackgroundFeatureList["rubblebelt refuge"] = {
	description : "I'm very familiar with areas of the city that most people shun: neighborhoods ruined by wurms, overgrown parks gone untended for decades, and the vast, long abandoned rubblebelts of broken terrain. There, I can find a suitable place for me and my allies to hide or rest, as well as food and fresh water for myself and up to five other people each day.",
	source : [["G", 60]]	
};

BackgroundList["izzet engineer"] = {
	regExpSearch : /^(?=.*izzet)(?=.*engineer).*$/i,
	name : "Izzet Engineer",
	source : [["G", 66]],
	skills : ["Arcana", "Investigation"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["produce flame", "shocking grasp", "chaos bolt", "create or destroy water", "unseen servant", "heat metal", "rope trick", "call lightning", "elemental weapon", "glyph of warding", "conjure minor elementals", "divination", "otiluke's resilient sphere", "animate objects", "conjure elemental"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Produce Flame, Shocking Grasp, Chaos Bolt, Create or Destroy Water, Unseen Servant, Heat Metal, Rope Trick, Call Lightning, Elemental Weapon, Glyph of Warding, Conjure Minor Elementals, Divination, Otiluke's Resilient Sphere, Animate Objects, and Conjure Elemental."
		]
	},
	gold : 5,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Twisted remains of failed experiment", "", ""],
		["Hammer", "", 3],
		["Block and tackle", "", 5]
	],
	equipright : [
		["Common clothes", "", 3],
		["Izzet insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Draconic, Goblin, or Vedalken", 1]],
	toolProfs : [["Artisan's tools", 1]],
	feature : "Urban Infrastructure",
	trait : [
		"I have a hard time staying focused on ... oh, and my brain tends to jump from one ... did I mention focus?",
		"I get really excited about my ideas and I can't wait to talk about them and start putting them into practice and tinkering with them and I want to tell you about how exciting it all is!",
		"It's not magic\u2014or anything, really\u2014if you do it only halfway. Whatever I do, I give it all I've got.",
		"I do what my gut tells me.",
		"Life's an experiment, and I can't wait to see what happens.",
		"I pepper my speech with the incomprehensible jargon of my trade, like mizzium droplets inserted into a weird-field suspension.",
		"Great ideas are fine, but great results are what counts.",
		"If you can guess what I'm about to do, that means I've run out of imagination."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Creativity", "Creativity: Half the world's troubles come from stodgy thinking, stuck in the past. We need innovative solutions. (Chaotic)"],
		["Discovery", "Discovery: Every experiment has the potential to reveal more secrets of the multiverse. (Any)"],
		["Science", "Science: A rigorous application of logical principles and protocols will lead us toward progress more surely than any belief system. (Lawful)"],
		["Fun", "Fun: I love my job! Despite the dangerous working conditions, there's nothing I'd rather do. (Chaotic)"],
		["Power", "Power: Someday I'll find or create the magic that will make me the most powerful being in Ravnica. (Evil)"]
	],
	bond : [
		"I have dedicated my life to finding a solution to a scientific problem.",
		"I'll never forget the laboratory where I learned my skills, or the other attendants who learned alongside me.",
		"I'm convinced it was sabotage that destroyed my first laboratory and killed many of my friends, and I seek revenge against whoever did it.",
		"I have the schematics for an invention that I hope to build one day, once I have the necessary resources.",
		"A fellow student and I are racing to solve the same scientific puzzle.",
		"I would do anything the guildmaster told me to do."
	],
	flaw : [
		"If there's a plan, I'll probably forget it. If I don't forget it, I'll probably ignore it.",
		"I get bored easily, and if nothing is happening I'll make something happen.",
		"Nothing is ever simple, and if it seems simple, I'll find a way to make it complicated.",
		"I tend to ignore sleep for days when I'm conducting research, often at the expense of my own health and safety.",
		"I'm convinced there's not a soul in Ravnica, except maybe the great Niv-Mizzet, who can match my boundless intellect.",
		"I'm incapable of admitting a flaw in my logic."
	]
};
BackgroundFeatureList["urban infrastructure"] = {
	description : "Although the Izzet League is infamous for mad inventions it is also involved in construction of the city's infrastructure. I have a basic knowledge of the structure of buildings and what is behind its walls. I can find their blueprints showing entry points, secret spaces, structural weaknesses, or secret spaces. My guild won't protect me if I use this knowledge unlawfully.",
	source : [["G", 66]]
};

BackgroundList["orzhov representative"] = {
	regExpSearch : /^(?=.*orzhov)(?=.*representative).*$/i,
	name : "Orzhov Representative",
	source : [["G", 72]],
	skills : ["Intimidation", "Religion"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["friends", "guidance", "command", "illusory script", "enthrall", "ray of enfeeblement", "zone of truth", "bestow curse", "speak with dead", "spirit guardians", "blight", "death ward", "leomund's secret chest", "geas"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Friends, Guidance, Command, Illusory Script, Enthrall, Ray of Enfeeblement, Zone of Truth, Bestow Curse, Speak with Dead, Spirit Guardians, Blight, Death Ward, Leomund's Secret Chest, and Geas."
		]
	},
	gold : 10,
	equipright : [
		["Fine clothes", "", 6],
		["Orzhov insignia", "", ""],
		["Vestments", "", 4],
		["Chain of 10 golden coins", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [2],
	feature : "Leverage",
	trait : [
		"I am always willing to act in accordance with the financial incentive offered.",
		"Debts are never meant to be forgiven.",
		"I am accustomed to enjoying the finest pleasures money can buy.",
		"No one could doubt that I am a cut above the masses of pitiful peasants that infest the city.",
		"I can't stand to spend a zib more than necessary to purchase what I need.",
		"I hate it when people try to make light of a serious situation.",
		"I want to make sure everyone is aware of how wealthy, powerful, and important I am.",
		"I can't think of anything to look forward to."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Wealth", "Wealth: I will do whatever it takes to become as rich as the oligarchs. (Evil)"],
		["Power", "Power: One day, I will be the one giving orders. (Evil)"],
		["Prestige", "Prestige: I want to be admired, respected, feared, or even hated for my position and wealth. (Evil)"],
		["Stability", "Stability: The economy functions best when chaos is kept under control and everyone knows their place. (Lawful)"],
		["Eternity", "Eternity: I want to live forever\u2014in the flesh as long as possible, and as a spirit afterward. (Any)"]
	],
	bond : [
		"The unbearable weight of my debt has driven me to desperation.",
		"I'm duty-bound to obey the dictates of an ancestor on the Ghost Council.",
		"I value my worldly goods more highly than my mortal life.",
		"An oligarch publicly humiliated me, and I will exact revenge on that whole family.",
		"My faith in the Obzedat never wavers.",
		"I want to prove myself more worthy than an older sibling and thereby ensure that I inherit a greater share of my parents' wealth."
	],
	flaw : [
		"I hold a scandalous secret that could ruin my family forever\u2014but could also earn me the favor of the Ghost Council.",
		"I'm convinced that everyone I know is plotting against me.",
		"I'll brave any risk if the monetary reward is great enough.",
		"I am convinced that I am far more important than anyone else is willing to acknowledge.",
		"I have little respect for anyone who isn't wealthy.",
		"I'll take any opportunity to steal from wealthier people, even for worthless trinkets."
	]
};
BackgroundFeatureList["leverage"] = {
	description : "I can exert leverage over one or more below me in the guild's hierarchy and demand their help as needs warrant. For example, deliver a message, arrange a ride, or clean up a bloody mess. As my status in the guild improves, I gain influence over more people of higher station. The DM decides if the demands are reasonable and if subordinates are available.",
	source : [["G", 72]]
};

BackgroundList["rakdos cultist"] = {
	regExpSearch : /^(?=.*rakdos)(?=.*cultist).*$/i,
	name : "Rakdos Cultist",
	source : [["G", 79]],
	skills : ["Acrobatics", "Performance"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["fire bolt", "vicious mockery", "burning hands", "dissonant whispers", "hellish rebuke", "crown of madness", "enthrall", "flaming sphere", "fear", "haste", "confusion", "wall of fire", "dominate person"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Fire Bolt, Vicious Mockery, Burning Hands, Dissonant Whispers, Hellish Rebuke, Crown of Madness, Enthrall, Flaming Sphere, Fear, Haste, Confusion, Wall of Fire, and Dominate Person."
		]
	},
	gold : 10,
	equipleft : [
		["Musical instrument", "", ""],
		["Costume", "", 4],
		["Hooded lantern of wrought iron", "", 2],
		["Chain with spiked links, feet of", 10, 1],
		["Tinderbox", "", 1],
		["Torches", 10, 1],
		["Sweet, red juice, bottle of", "", 4]
	],
	equipright : [
		["Common clothes", "", 3],
		["Rakdos insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Abyssal or Giant", 1]],
	toolProfs : [["Musical instrument", 1]],
	feature : "Fearsome Reputation",
	trait : [
		"I revel in mayhem, the more destructive the better.",
		"When violence breaks out, I lose myself in rage, and it's sometimes hard to stop.",
		"Everything is funny to me, and the most hilarious and bloodiest things leave me cackling with sadistic glee.",
		"I derive genuine pleasure from the pain of others.",
		"I enjoy testing other people's patience.",
		"I can't stand it when things are predictable, so I like to add a little chaos to every situation.",
		"I throw my weight around to make sure I get my way.",
		"I enjoy breaking delicate works of art. And fingers, which are sort of the same."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Hedonism", "Hedonism: Death comes for everyone, so take as much pleasure as you can from every moment of life. (Neutral)"],
		["Creativity", "Creativity: I strive to find more ways to express my art through pain\u2014my own as well as others'. (Chaotic)"],
		["Freedom", "Freedom: No one tells me what to do. (Chaotic)"],
		["Equality", "Equality: I want to see Ravnica remade, with no guilds and no hierarchies. (Chaotic)"],
		["Spectacle", "Spectacle: People are inspired by the greatness they see in art. (Any)"]
	],
	bond : [
		"I have belonged to the same performance troupe for years, and these people mean everything to me.",
		"A blood witch told me I have a special destiny to fulfill, and I'm trying to figure out what it is.",
		"I'm secretly hoping that I can change the cult from the inside, using my influence to help rein in the wanton violence.",
		"I own something that Rakdos once touched (it's seared black at the spot), and I cherish it.",
		"I want to be better at my chosen form of performance than any other member of my troupe.",
		"I am devoted to Rakdos and live to impress him."
	],
	flaw : [
		"My family is prominent in another guild. I enjoy my wild life, but I don't want to embarrass them.",
		"I couldn't hide my emotions and opinions even if I wanted to.",
		"I throw caution to the wind.",
		"I resent the rich and powerful.",
		"When I'm angry, I lash out in violence.",
		"There's no such thing as too much pleasure."
	],
	extra : [
		"Select a Performance Style",
		"Spikewheel acrobat",
		"Lampooning satirist",
		"Fire juggler",
		"Marionette puppeteer",
		"Pain artist",
		"Noise musician",
		"Nightmare clown",
		"Master of ceremonies"
	]
};
BackgroundFeatureList["fearsome reputation"] = {
	description : "People recognize me as a member of the Cult of Rakdos, and they're careful not to draw my anger or ridicule. I can get away with minor criminal offenses, such as refusing to pay for food at a restaurant or breaking down a door at a local shop, if no legal authorities witness the crime. Most are too daunted by me to report my wrongdoing to the Azorius.",
	source : [["G", 79]]
};

BackgroundList["selesnya initiate"] = {
	regExpSearch : /^(?=.*selesnya)(?=.*initiate).*$/i,
	name : "Selesnya Initiate",
	source : [["G", 86]],
	skills : ["Nature", "Persuasion"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["druidcraft", "friends", "aid", "animal friendship", "charm person", "animal messenger", "calm emotions", "warding bond", "plant growth", "speak with plants", "aura of life", "conjure minor elementals", "awaken", "commune with nature"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Druidcraft, Friends, Aid, Animal Friendship, Charm Person, Animal Messenger, Calm Emotions, Warding Bond, Plant Growth, Speak with Plants, Aura of Life, Conjure Minor Elementals, Awaken, and Commune with Nature."
		]
	},
	gold : 5,
	equipleft : [
		["Healer's kit", "", 3]
	],
	equipright : [
		["Common clothes", "", 3],
		["Robes", "", 4],
		["Selesnya insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Elvish, Loxodon, or Sylvan", 1]],
	toolProfs : [["Artisan's tools or musical instrument", 1]],
	feature : "Conclave's Shelter",
	trait : [
		"I never raise my voice or lose my temper.",
		"I feel the pains and joys of everyone around me, friend or foe.",
		"I would rather make a friend than thwart an enemy.",
		"I'm always straining to peer into another reality that seems to be just beyond my senses.",
		"I'm uneasy if I can't see plants growing or feel soil beneath my feet.",
		"Seeing illness or injury in any creature saddens me.",
		"I have much to be proud of, but I am still just one strand in the grand, interwoven tapestry of life.",
		"Nature offers rich and abundant metaphors for understanding the complexities of life."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Harmony", "Harmony: Nothing is more beautiful than voices and actions aligned in common purpose. (Good)"],
		["Order", "Order: Like a well-pruned tree, society thrives when everything is kept in good order. (Lawful)"],
		["Life", "Life: Preserving life and nature is always a worthwhile endeavor. (Good)"],
		["Humility", "Humility: Ambition and pride are the roots of strife. (Good)"],
		["Evangelism", "Evangelism: When all have joined the Selesnya Conclave, Ravnica will finally know peace. (Any)"]
	],
	bond : [
		"I would give my life in the defense of the small enclave where I first encountered Mat'Selesnya.",
		"I love beasts and plants of all kinds, and am loath to harm them.",
		"A healer nursed me to recovery from a mortal illness.",
		"I'll sing the invitation of Mat'Selesnya with my dying breath.",
		"I cherish a leaf from Vitu-Ghazi that changes color with the seasons, even though it is no longer attached to the tree.",
		"Every member of the conclave is my kin, and I would fight for any one of them."
	],
	flaw : [
		"I'm terrified of getting into a fight where my side is outnumbered.",
		"I assume that people mean well until they prove otherwise.",
		"I enjoy comfort and quiet, and prefer to avoid extra effort.",
		"I have a fierce temper that doesn't reflect the inner calm I seek.",
		"I'm convinced that everyone else in the conclave has a deeper connection to the Worldsoul than I do.",
		"I'm trying to atone for the life of crime I led before I joined the Selesnya, but I find it hard to give up my bad habits."
	]
};
BackgroundFeatureList["conclave's shelter"] = {
	description : "My companions and I can find a place to hide or rest in any Selesnya enclave in the city, unless I have proven to be a danger to them. The members of the enclave will shield me from anyone searching for me, but will not risk their lives. I can receive free healing and care at a Selesnya enclave, though I must provide material components needed for spells.",
	source : [["G", 86]]
};

BackgroundList["simic scientist"] = {
	regExpSearch : /^(?=.*simic)(?=.*scientist).*$/i,
	name : "Simic Scientist",
	source : [["G", 93]],
	skills : ["Arcana", "Medicine"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["acid splash", "druidcraft", "detect poison and disease", "expeditious retreat", "jump", "alter self", "enhance ability", "enlarge/reduce", "gaseous form", "water breathing", "wind wall", "freedom of movement", "polymorph", "creation"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Acid Splash, Druidcraft, Detect Poison and Disease, Expeditious Retreat, Jump, Alter Self, Enhance Ability, Enlarge/reduce, Gaseous Form, Water Breathing, Wind Wall, Freedom of Movement, Polymorph, and Creation."
		]
	},
	gold : 10,
	equipleft : [
		["Book of research notes", "", 5],
		["Squid ink, 1 ounce bottle of", "", ""],
		["Ink pen", "", ""],
		["Blubber oil, flasks of", "", 1],
		["Acid, vials of", "", 1],
		["Fish scales, vial of", "", 1],
		["Seaweed, vial of", "", 1],
		["Jellyfish stingers, vial of", "", 1],
		["Unidentified slime, glass bottle of", "", 4]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [2],
	feature : "Simic Researcher",
	trait : [
		"I can't wait to see what I become next!",
		"I am convinced that everything inclines toward constant improvement.",
		"I'm eager to explain every detail of my most intricate experiments and theories to anyone who shows the least bit of interest.",
		"I assume that everyone needs even the most basic concepts explained to them.",
		"I describe everything that happens as if it were going into my research notes (and it often is).",
		"I am insatiably curious about the seemingly infinite forms and adaptations of life.",
		"I can't resist prying into anything forbidden, since it must be terribly interesting.",
		"I employ a highly technical vocabulary to avoid imprecision and ambiguity in my communication."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Change", "Change: All life is meant to progress toward perfection, and our work is to hurry it along\u2014no matter what must be upended along the way. (Chaotic)"],
		["Knowledge", "Knowledge: Understanding the world is more important than what you do with your knowledge. (Neutral)"],
		"Greater Good. I want to reshape the world into higher forms of life so that all can enjoy evolution. (Good)",
		["Logic", "Logic: It's foolish to let emotions and principles interfere with the conclusions of logic. (Lawful)"],
		["Superiority", "Superiority: My vast intellect and strength are directed toward increasing my sway over others. (Evil)"]
	],
	bond : [
		"I helped create a krasis that I love like a pet and would carry with me everywhere ... except it's the size of a building, and it might eat me.",
		"In my laboratory, I discovered something that I think could eliminate half the life on Ravnica.",
		"The other researchers in my clade are my family\u2014a big, eccentric family including members and parts of many species.",
		"The laboratory where I did my research contains everything that is precious to me.",
		"I will get revenge on the shortsighted fool who killed my precious krasis creation.",
		"Everything I do is an attempt to impress someone I love."
	],
	flaw : [
		"I have a rather embarrassing mutation that I do everything I can to keep hidden.",
		"I'm more interested in taking notes on monstrous anatomy than in fighting monsters.",
		"Every social situation I'm in seems to lead to my asking rude personal questions.",
		"I'm supremely confident in my ability to adapt to any situation and handle any danger.",
		"I'll take any risk to earn recognition for my scientific brilliance.",
		"I have a tendency to take shortcuts in my research and any other tasks I have to complete."
	],
	extra : [
		"Select a Clade or Research",
		"Hull Clade: protection/durability",
		"Fin Clade: movement",
		"Gyre Clade: patterns/metamagic",
		"Guardian Project: guard monsters/super soldiers",
		"Crypsis Project: (counter)intelligence",
		"Independent research in a new area"
	]
};
BackgroundFeatureList["simic researcher"] = {
	description : "I know where or from whom I can acquire scientific facts, usually from a Simic laboratory, or sometimes an Izzet facility, library, university, independent scholar, or creature. I might need to offer bribes, favors, or other incentives to induce people to reveal their secrets. The DM can rule that the knowledge is inaccessible place, can't be found, or requires a quest.",
	source : [["G", 93]]
};

// Spells
SpellsList["encode thoughts"] = {
	name : "Encode Thoughts",
	classes : [],
	source : [["G", 47]],
	level : 0,
	school : "Ench",
	time : "1 a",
	range : "Self",
	components : "S",
	duration : "Up to 8 h",
	description : "Make physical thought strand of memory or vice versa; works with detect thoughts \u0026 modify memory",
	descriptionFull : "Putting a finger to your head, you pull a memory, an idea, or a message from your mind and transform it into a tangible string of glowing energy called a thought strand, which persists for the duration or until you cast this spell again. The thought strand appears in an unoccupied space within 5 feet of you as a Tiny, weightless, semisolid object that can be held and carried like a ribbon. It is otherwise stationary." + "\n   " + "If you cast this spell while concentrating on a spell or an ability that allows you to read or manipulate the thoughts of others (such as detect thoughts or modify memory), you can transform the thoughts or memories you read, rather than your own, into a thought strand." + "\n   " + "Casting this spell while holding a thought strand allows you to instantly receive whatever memory, idea, or message the thought strand contains. (Casting detect thoughts on the strand has the same effect.)"
};
// Magic Items
MagicItemsList["guild keyrune"] = {
	name : "Guild Keyrune",
	source : [["G", 177]],
	type : "wondrous item",
	description : "As an action, I can speak this ceremonial key's command word to have it transforms into a creature. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for some hours, until it has 0 HP, or I dismiss it as an action.",
	descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a creature if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after some hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
	descriptionFull : "Associated with a particular guild, a guild keyrune is a ceremonial, stylized key, about 1 foot long, made from carved stone. Not a literal key, the item is a badge of authority that gives its bearer access to privileged places in its guild's headquarters and outposts. At the DM's discretion, a character might be given a keyrune upon attaining a renown score of 25 in their guild.\n    When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the key rune transforms into a creature. If there isn't enough space for the creature, the keyrune doesn't transform. See the Monster Manual for the creature's stat block- the name of which is given in bold in the keyrune's description- unless you're directed to chapter 6 of this book instead.\n    The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n    The creature exists for a duration specific to each keyrune. At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
	attunement : true,
	action : [["action", ""]],
	choices : ["Azorius", "Boros", "Dimir", "Golgari", "Gruul", "Izzet", "Orzhov", "Rakdos", "Selesnya", "Simic"],
	"azorius" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word and have it transform into a giant eagle for 1 hour with which I can talk telepathically if within 1 mile. It is friendly to me and my allies and obeys my spoken commands. As an action, I can see and hear what it does. I can have it revert back as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a a giant eagle for 1 hour. While within 1 mile, I can communicate telepathically with it. It is friendly to me and my allies and obeys my spoken commands, otherwise using only the Dodge action. It reverts back to its keyrune form when it drops to 0 HP or if I touch it and speak the command word as an action. Once it does, it can't transform again for 36 hours. As an action, I can see/hear through its senses as if I had keen sight until the start of my next turn, but I can't use my own senses during that time.",
		descriptionFull : "This keyrune is carved from white marble and lapis lazuli to resemble a noble bird of prey. It can become a giant eagle for up to 1 hour. While the transformed eagle is within 1 mile of you, you can communicate with it telepathically. As an action, you can see through the eagle's eyes and hear what it hears until the start of your next turn, and you gain the benefit of its keen sight. During this time, you are deaf and blind with regard to your own senses.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a giant eagle. If there isn't enough space for the eagle, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the eagle takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Azorius guild",
		prereqeval : function (v) {
			return (/azorius/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"boros" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word and place it on the ground to transforms into a human veteran. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 8 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a human veteran if there is enough space. The creature is friendly to me and my allies and gives tactical advice, but is easily revealed as an artificial human. It understands my languages and obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after some hours, when it drops to 0 HP, or if I dismiss it as an action by touching it and speaking the command word again. Once it does, it can't transform again until 36 hours have passed.",
		descriptionFull : "Carved from red sandstone with white granite elements to resemble a member of the Boros Legion, this keyrune can become a veteran (human) for up to 8 hours. In addition to fighting on your behalf, this veteran cheerfully offers tactical advice, which is usually sound. Anyone who talks with the transformed keyrune or examines it closely can easily recognize that it is an artificial human.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a veteran (human). If there isn't enough space for the veteran, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Boros guild",
		prereqeval : function (v) {
			return (/boros/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"dimir" : {
		rarity : "very rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transform into an intellect devourer. It is friendly to me and my allies. It lasts for 24 hours, until it has 0 HP, or I dismiss it as an action. I can command it to pursue only a single mission each times it transforms and it returns to me at the end of it.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into an intellect devourer if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It lasts for 24 hours, during which time it pursues a single mission set by me, like information gathering, returning to me afterwards to report and transform back to the keyrune. It also reverts back when it drops to 0 HP or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again for 36 hours.",
		descriptionFull : "This keyrune, carved from black stone accented with steel, resembles a stylized horror. On command, it transforms into an intellect devourer that resembles the Dimir guild symbol, with six bladelike legs. The creature exists for up to 24 hours. During that time, it pursues only a single mission you give it\u2014usually an assignment to take over someone's body, either to impersonate that person for a brief time or to extract secrets from their mind. When the mission is complete, the creature returns to you, reports its success, and reverts to its keyrune form.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a intellect devourer. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Dimir guild",
		prereqeval : function (v) {
			return (/dimir/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"golgari" : {
		rarity : "very rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a giant scorpion with which I can talk telepathically if in 60 ft. It is friendly to me and my allies and obeys my commands. It reverts back after 6 hours, if it drops to 0 HP, or I touch it and speak its command word as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a giant scorpion if there is enough space. While within 60 ft of it, I can communicate with it telepathically. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after some hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "Made from deep green jade with black veins, this keyrune has an insectile shape. It can transform into a giant scorpion for up to 6 hours. The scorpion has an Intelligence of 4 and can communicate with you telepathically while it is within 60 feet of you, though its messages are largely limited to describing the passage of potential prey.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a giant scorpion. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Golgari guild",
		prereqeval : function (v) {
			return (/golgari/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"gruul" : {
		type : "wondrous item",
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a ceratok (rhinoceros stats). It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 1 hour, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a ceratok (rhinoceros stats) if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 1 hour, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "This crude keyrune is cobbled together from bits of rubble, broken glass, bone, and animal hair. One end resembles a horned beast. On command, the keyrune transforms into a ceratok, a horned creature much like a rhinoceros (and with the same statistics). It remains in its ceratok form for 1 hour.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a ceratok. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Gruul guild",
		prereqeval : function (v) {
			return (/gruul/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"izzet" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a galvanice weird. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 3 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a galvanice weird if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 3 hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "Formed of carved and polished red and blue stone, the keyrune includes bits of cable and wire. One end resembles a humanlike head, suggesting the jagged elemental form of the galvanice weird that it can become for a duration of 3 hours. In this form, it will serve you as a bodyguard, lift and carry things for you, act as a test subject for your experiments, or aid you in any other way that its capabilities allow.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a galvanice weird. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Izzet guild",
		prereqeval : function (v) {
			return (/izzet/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"orzhov" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a winged thrull. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 2 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a winged thrull if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 2 hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "This keyrune is carved from white marble with veins of black. The end is shaped like a thrull's head, with a gold faceplate affixed. On command, the keyrune transforms into a winged thrull for up to 2 hours. If you don't come from an Orzhov oligarch family, it serves you grudgingly, clownishly aping your movements and mannerisms while carrying out your orders.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a winged thrull. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Orzhov guild",
		prereqeval : function (v) {
			return (/orzhov/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"rakdos" : {
		rarity : "uncommon",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a cackler. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 1 hour, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a cackler if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 1 hour, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "This dark granite keyrune is marbled with scarlet veins and carved with the leering visage of a mischievous demon. When activated, it transforms into a cackler for up to 1 hour.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a cackler. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Rakdos guild",
		prereqeval : function (v) {
			return (/rakdos/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"selesnya" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a wolf with Int 6 with which I can talk telepathically if within 1 mile. It is friendly to me and my allies. It obeys my commands, but only uses the Dodge action otherwise. It lasts for 8 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a wolf with Intelligence 6 if there is enough space. The creature is friendly to me and my allies, understands Elvish and Sylvan (but can't speak them), and obeys my commands. While within 1 mile, we can communicate telepathically. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 8 hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "Carved from white and green marble in the shape of a wolf's head, this keyrune transforms into a dire wolf. The wolf persists for 8 hours. Its Intelligence is 6, and it understands Elvish and Sylvan but can't speak those languages. While it is within 1 mile of you, you can communicate with each other telepathically.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a dire wolf. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Selesnya guild",
		prereqeval : function (v) {
			return (/selesnya/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"simic" : {
		rarity : "uncommon",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a krasis (cat. 2, Grabber and Stabilizing Legs). It is friendly to me and my allies. It obeys my commands, taking only the Dodge action if not commanded otherwise. It lasts for 5 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a category 2 krasis that has the Grabber and Stabilizing Legs adaptations if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 5 hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "This keyrune is assembled from coral, mother-of-pearl, and chrome and adorned with the spirals and curves characteristic of Simic ornamentation. The head resembles the shell of a sea creature. On command, the keyrune turns into a category 2 krasis that has the Grabber and Stabilizing Legs adaptations. The transformation lasts for up to 5 hours.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a category 2 krasis that has the Grabber and Stabilizing Legs adaptations. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Simic guild",
		prereqeval : function (v) {
			return (/simic/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	}
}
MagicItemsList["guild signet"] = {
	name : "Guild Signet",
	source : [["G", 178]],
	type : "ring",
	rarity : "uncommon",
	description : "This signet ring bears a symbol of its associated guild. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast the spell within (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
	descriptionFull : "This ring, adorned with the symbol of a guild, allows you to cast one spell closely associated with that guild, as shown in the table below. A guild signet is sometimes awarded to a guild member whose renown score in that guild is 5 or higher, as a reward for performing special services for the guild. Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.\n   A signet has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, you can expend 1 charge to cast the associated spell (save DC 13).\n\n" +
	toUni("Guild \tAssociated Spell") +
	"\nAzorius\tensnaring strike" +
	"\nBoros\theroism" +
	"\nDimir\tdisguise self" +
	"\nGolgari\tentangle" +
	"\nGruul\tcompelled duel" +
	"\nlzzet\tchaos bolt" +
	"\nOrzhov\tcommand" +
	"\nRakdos\thellish rebuke" +
	"\nSelesnya\tcharm person" +
	"\nSimic\texpeditious retreat",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	choices : ["Azorius", "Boros", "Dimir", "Golgari", "Gruul", "Izzet", "Orzhov", "Rakdos", "Selesnya", "Simic"],
	"azorius" : {
		description : "This signet ring bears a symbol of Azorius. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Ensnaring Strike (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["ensnaring strike"],
			selection : ["ensnaring strike"],
			firstCol : 1
		}
	},
	"boros" : {
		description : "This signet ring bears a symbol of Boros. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Heroism (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["heroism"],
			selection : ["heroism"],
			firstCol : 1
		}
	},
	"dimir" : {
		description : "This signet ring bears a symbol of Dimir. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Disguise Self (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["disguise self"],
			selection : ["disguise self"],
			firstCol : 1
		}
	},
	"golgari" : {
		description : "This signet ring bears a symbol of Golgari. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Entangle (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["entangle"],
			selection : ["entangle"],
			firstCol : 1
		}
	},
	"gruul" : {
		description : "This signet ring bears a symbol of Gruul. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Compelled Duel (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["compelled duel"],
			selection : ["compelled duel"],
			firstCol : 1
		}
	},
	"izzet" : {
		description : "This signet ring bears a symbol of lzzet. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Chaos Bolt (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["chaos bolt"],
			selection : ["chaos bolt"],
			firstCol : 1
		}
	},
	"orzhov" : {
		description : "This signet ring bears a symbol of Orzhov. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Command (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["command"],
			selection : ["command"],
			firstCol : 1
		}
	},
	"rakdos" : {
		description : "This signet ring bears a symbol of Rakdos. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Hellish Rebuke (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["hellish rebuke"],
			selection : ["hellish rebuke"],
			firstCol : 1
		}
	},
	"selesnya" : {
		description : "This signet ring bears a symbol of Selesnya. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Charm Person (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["charm person"],
			selection : ["charm person"],
			firstCol : 1
		}
	},
	"simic" : {
		description : "This signet ring bears a symbol of Simic. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Expeditious Retreat (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["expeditious retreat"],
			selection : ["expeditious retreat"],
			firstCol : 1
		}
	}
}
MagicItemsList["illusionist's bracers"] = {
	name : "Illusionist's Bracers",
	source : [["G", 178]],
	type : "wondrous item",
	rarity : "very rare",
	description : "While wearing the bracers, whenever I cast a cantrip, I can use a bonus action on the same turn to cast that cantrip a second time.",
	descriptionFull : "A powerful illusionist of House Dimir originally developed these bracers, which enabled her to create multiple minor illusions at once. The bracers' power, though, extends far beyond illusions.\n   While wearing the bracers, whenever you cast a cantrip, you can use a bonus action on the same turn to cast that cantrip a second time.",
	weight : 1,
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	action : [["bonus action", " (with cantrip)"]]
}
MagicItemsList["mizzium apparatus"] = {
	name : "Mizzium Apparatus",
	source : [["G", 179]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "I can use this harness as an arcane focus and to attempt to cast a spells that I do not know or have prepared but is on my class' spell list. This requires an Int (Arcana) check DC 10 + twice the spell slot level and components and a spell slot as appropriate for the spell. On a failure, I cast a random spell, see Notes page.",
	descriptionLong : "This apparatus is a collection of leather straps, flexible tubing, glass cylinders, and plates, bracers, and fittings made from a magic-infused metal alloy called mizzium, all assembled into a harness. I can use it as an arcane focus. In addition, I can use it to attempt to cast a spell that I do not know or have prepared but is on my class' spell list. I use components and a spell slot as appropriate for the spell as normal, but I must succeed on an Intelligence (Arcana) check DC 10 + twice the spell slot level. On a failure, I cast a random spell, see Notes page. The DC for cantrips is 10, and on a failure nothing happens.",
	descriptionFull : "Innovation is a dangerous pursuit, at least the way the mages of the Izzet League engage in it. As protection against the risk of an experiment going awry, they have developed a device to help channel and control their magic. This apparatus is a collection of leather straps, flexible tubing, glass cylinders, and plates, bracers, and fittings made from a magic-infused metal alloy called mizzium, all assembled into a harness. The item weighs 8 pounds.\n   While you are wearing the mizzium apparatus, you can use it as an arcane focus. In addition, you can attempt to cast a spell that you do not know or have prepared. The spell you choose must be on your class's spell list and of a level for which you have a spell slot, and you must provide the spell's components.\n   You expend a spell slot to cast the spell as normal, but before resolving it you must make an Intelligence (Arcana) check. The DC is 10 + twice the level of the spell slot you expend to cast the spell.\n   On a successful check, you cast the spell as normal, using your spell save DC and spellcasting ability modifier. On a failed check, you cast a different spell from the one you intended. Randomly determine the spell you cast by rolling on the table for the level of the spell slot you expended. If the slot is 6th level or higher, roll on the table for 5th-level spells.\n   If you try to cast a cantrip you don't know, the DC for the Intelligence (Arcana) check is 10, and on a failed check, there is no effect.\n\n" + [
		toUni("d6\t1st-level spell"),
		" 1\tBurning Hands",
		" 2\tChaos Bolt",
		" 3\tColor Spray",
		" 4\tFaerie Fire",
		" 5\tFog Cloud",
		" 6\tThunderwave\n",
		toUni("d6\t2nd-level spell"),
		" 1\tBlur",
		" 2\tGust of Wind",
		" 3\tHeat Metal",
		" 4\tMelf's Acid Arrow",
		" 5\tScorching Ray",
		" 6\tShatter\n",
		toUni("d6\t3rd-level spell"),
		" 1\tFear",
		" 2\tFeign Death",
		" 3\tFireball",
		" 4\tGaseous Form",
		" 5\tSleet Storm",
		" 6\tStinking Cloud\n",
		toUni("d4\t4th-level spell"),
		" 1\tConfusion",
		" 2\tConjure Minor Elementals",
		" 3\tEvard's Black Tentacles",
		" 4\tIce Storm\n",
		toUni("d4\t5th-level spell"),
		" 1\tAnimate Objects",
		" 2\tCloudkill",
		" 3\tCone of Cold",
		" 4\tFlame Strike"
	].join("\n"),
	weight : 8,
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer, warlock, or wizard",
	prereqeval : function(v) { return classes.known.sorcerer || classes.known.warlock || classes.known.wizard ? true : false; },
	toNotesPage : [{
		name : "Random Spells",
		note : [
			"This apparatus is a collection of leather straps, flexible tubing, glass cylinders, and plates, bracers, and fittings made from a magic-infused metal alloy called mizzium, all assembled into a harness.",
			"While I am wearing the mizzium apparatus, I can use it as an arcane focus. In addition, I can attempt to cast a spell that I do not know or have prepared. The spell I choose must be on my class's spell list and of a level for which I have a spell slot, and I must provide the spell's components.",
			"I expend a spell slot to cast the spell as normal, but before resolving it I must make an Intelligence (Arcana) check. The DC is 10 + twice the level of the spell slot I expend to cast the spell. On a successful check, I cast the spell as normal, using my spell save DC and spellcasting ability modifier. On a failed check, I cast a different spell from the one I intended, randomly determining the spell I cast by rolling on the table for the level of the spell slot expended. If the slot is 6th level or higher, I roll on the table for 5th-level spells. If I try to cast a cantrip I don't know, the DC for the Intelligence (Arcana) check is 10, and on a failed check, there is no effect.\n",
			"1D6\t1ST-LEVEL SPELL\t1D6\t2ND-LEVEL SPELL",
			"  1\tBurning Hands \t  1\tBlur",
			"  2\tChaos Bolt    \t  2\tGust of Wind",
			"  3\tColor Spray   \t  3\tHeat Metal",
			"  4\tFaerie Fire   \t  4\tMelf's Acid Arrow",
			"  5\tFog Cloud     \t  5\tScorching Ray",
			"  6\tThunderwave   \t  6\tShatter\n",
			"1D6\t3RD-LEVEL SPELL",
			"  1\tFear",
			"  2\tFeign Death",
			"  3\tFireball",
			"  4\tGaseous Form",
			"  5\tSleet Storm",
			"  6\tStinking Cloud\n",
			"1D4\t4TH-LEVEL SPELL\t1D4\t5TH-LEVEL SPELL (AND HIGHER)",
			"  1\tConfusion\t\t  1\tAnimate Objects",
			"  2\tConjure Minor Elem.\t  2\tCloudkill",
			"  3\tEvard's Black Tentacles\t  3\tCone of Cold",
			"  4\tIce Storm\t\t  4\tFlame Strike"
		]
	}]
}
MagicItemsList["mizzium armor"] = {
	name : "Mizzium Armor",
	nameTest : "Mizzium",
	source : [["G", 179]],
	type : "armor (medium or heavy)",
	rarity : "rare",
	description : "This armor is reinforced with a magically enhanced metal alloy called mizzium. While I'm wearing it, any critical hit against me becomes a normal hit. In addition, when I'm subjected to a magical effect that allows me to make a Str or Con save to take only half damage, I instead take no damage if I succeed on it.",
	descriptionFull : "This suit of armor is reinforced with a magically enhanced metal alloy called mizzium, which is made in Izzet foundries. While you're wearing the armor, any critical hit against you becomes a normal hit. In addition, when you are subjected to a magical effect that allows you to make a Strength or Constitution saving throw to take only half damage, you instead take no damage if you succeed on the saving throw.",
	savetxt : { text : ["No damage on success Str or Con save for half damage"] },
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		excludeCheck : function (inObjKey, inObj) {
			return !(/medium|heavy/i).test(inObj.type) || (/hide/i).test(inObj.name);
		},
		descriptionChange : ["prefix", "armor"]
	}
}
MagicItemsList["mizzium mortar"] = {
	name : "Mizzium Mortar",
	source : [["G", 179]],
	type : "wondrous item",
	rarity : "rare",
	description : "This 4-ft-long, 6-inch-diameter tube has 4 charges, regaining 1d4 at dawn. As an action, I can expend 1 charge to have all in a 30-ft cone take 5d4 fire damage. As an action, I can expend 3 charges to have all in a 20-ft radius, 40-ft high cylinder in 60 ft take 5d8 fire damage. For both effects DC 15 Dex save halves.",
	descriptionLong : "This 4-ft-long, 6-inch-diameter mizzium tube has 4 charges, regaining 1d4 expended charges at dawn. The end that's pointed toward a target is open, and a glowing ball of molten metal can be seen at the other end as long as the mortar has at least 1 charge remaining. As an action, I can expend 1 charge to create a spray of molten mizzium in a 30-ft cone. All within the cone take 5d4 fire damage, DC 15 Dexterity saving throw halves. As an action, I can expend 3 charges to create a 20-ft radius, 40-ft high cylinder within 60 ft of me that deals 5d8 fire damage to all within, DC 15 Dexterity saving throw halves.",
	descriptionFull : "This short tube, about 2 feet long and 6 inches in diameter, is made from mizzium, a magically enhanced metal alloy forged by the Izzet League. The end that's pointed toward a target is open, and a glowing ball of molten metal can be seen at the other end as long as the mortar has at least 1 charge remaining.\n   The mortar has 4 charges for the following properties. It regains 1d4 expended charges daily at dawn.\n   " + toUni("Molten Spray") + ". You can expend 1 charge as an action to loose a 30-foot cone of molten mizzium. Each creature in the area must make a DC 15 Dexterity saving throw, taking 5d4 fire damage on a failed save, or half as much damage on a successful one.\n   " + toUni("Mizzium Bombard") + ". You can expend 3 charges as an action to launch a hail of molten projectiles in a 20-foot-radius, 40-foot-high cylinder centered on a point you can see within 60 feet of you. Each creature in the area must make a DC 15 Dexterity saving throw. A creature takes 5d8 fire damage on a failed save, or half as much damage on a successful one.",
	weight : 1,
	usages : 4,
	recovery : "dawn",
	additional : "regains 1d4"
}
MagicItemsList["moodmark paint"] = {
	name : "Moodmark Paint",
	source : [["G", 180]],
	type : "wondrous item",
	rarity : "common",
	description : "Once, I can spend 1 minute to apply this thick black paint to a creature's face. For the next 8 hours, anyone seeing the target can make a DC 10 Wisdom (Insight) check to see if it is happy, sad, angry, disgusted, surprised, or afraid, as well as the main source of that emotion. Drows have advantage on this check.",
	descriptionFull : "This thick, black paint is stored in a small jar, containing enough paint to apply moodmarks to one creature. The paint is dabbed on the face in spots or markings that often resemble the eyes of insects or spiders. Applying the paint in this way takes 1 minute.\n   For the next 8 hours, the marks change to reflect your mental state. A creature that can see you and makes a successful DC 10 Wisdom (Insight) check can discern whether you are happy, sad, angry, disgusted, surprised, or afraid, as well as the main source of that emotion. For example, you might communicate fear caused by a monster you just saw around the corner, grief at the loss of a friend, or happiness derived from pride in your performance in combat. A dark elf has advantage on this check.",
	weight : 1
}
MagicItemsList["pariah's shield"] = {
	name : "Pariah's Shield",
	source : [["G", 180]],
	type : "shield",
	rarity : "rare",
	description : "While I wield this shield. I gain a +1 bonus to AC for every two allies within 5 ft of me on top of the shield's AC bonus, up to a +3 bonus. As a reaction when a creature I can see within 5 ft of me takes damage, I can take that damage instead, but the damage type for it changes to force.",
	descriptionFull : "Soldiers of the Boros Legion consider it an honor to bear this shield, even knowing that it might be the last honor they receive. The front of the shield is sculpted to depict a grieving human face.\n   You gain a +1 bonus to AC for every two allies within 5 feet of you (up to a maximum of +3) while you wield this shield. This bonus is in addition to the shield's normal bonus to AC.\n   When a creature you can see within 5 feet of you takes damage, you can use your reaction to take that damage, instead of the creature taking it. When you do so, the damage type changes to force.",
	attunement : true,
	weight : 6,
	shieldAdd : "Pariah's Shield",
	action : [["reaction", ""]]
}
MagicItemsList["peregrine mask"] = {
	name : "Peregrine Mask",
	source : [["G", 180]],
	type : "wondrous item",
	rarity : "very rare",
	description : "While wearing this winged helm, I have a flying speed of 60 ft and advantage on initiative rolls.",
	descriptionFull : "While wearing this winged helm, you have a flying speed of 60 feet. In addition, you have advantage on initiative rolls.",
	attunement : true,
	advantages : [["Initiative", true]],
	speed : { fly : { spd : "fixed60", enc : "fixed50" } }
}
MagicItemsList["pyroconverger"] = {
	name : "Pyroconverger",
	source : [["G", 180]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "As an action, I can use this flamethrower to deal 4d6 fire damage to all in a 10-ft cone, DC 13 Dex save halves. I must roll a d10 each time I use it and add the times it was used since my last long rest. If the total is 11 or higher, it malfunctions and I take 4d6 fire damage and I can't use it again until I finish a long rest.",
	descriptionFull : "A Pyroconverger is an Izzet-made flamethrower. It carries a risk of malfunction each time you use it.\n   As an action, you can cause the Pyroconverger to project fire in a 10-foot cone. Each creature in that area must make a DC 13 Dexterity saving throw, taking 4d6 fire damage on a failed save, or half as much damage on a successful one.\n   Each time you use the Pyroconverger, roll a d10 and add the number of times you have used it since your last long rest. If the total is 11 or higher, the Pyroconverger malfunctions: you take 4d6 fire damage, and you can't use the Pyroconverger again until you finish a long rest.",
	attunement : true,
	weight : 1,
	weaponOptions : [{
		regExpSearch : /pyroconverger/i,
		name : "Pyroconverger",
		source : [["G", 180]],
		ability : 0,
		type : "Magic Item",
		damage : [4, 6, "fire"],
		range : "10-ft cone",
		description : "Hits all in area; Dex save, success - half damage; Roll each time for malfunction, see item",
		abilitytodamage : false,
		dc : true,
		modifiers : [5, ""],
		selectNow : true
	}],
	usages : 1,
	recovery : "long rest",
	additional : "if malfunction"
}
MagicItemsList["rakdos riteknife"] = {
	name : "Rakdos Riteknife",
	source : [["G", 180]],
	type : "weapon (dagger)",
	rarity : "legendary",
	description : "This has +1 to hit/damage and imprisons souls of any killed with it, up to 5. It deals +1d4 necr. per stored soul. As a bonus action, I can release souls to regain 1d10 HP per soul. Once per long rest as a reaction after I deal damage with it, I can release 5 souls to have the target make a DC 15 Con save or die if below 75 HP.",
	descriptionLong : "This magical dagger has a +1 bonus on attack and damage rolls made with it. When used to slay a creature, it imprisons its soul. It can store up to five souls. While it holds souls, it deals +1d4 necrotic damage per stored soul. [Siphon Vitality] As a bonus action, I can release one or more soul to regain 1d10 HP per soul released. [Annihilation] As a reaction after I deal damage with it, I can release five souls to have the target of the attack make a DC 15 Constitution saving throw or die if below 75 HP. If the target dies, I can't use this property again until I finish a long rest.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic weapon. Its blade is cruelly serrated, and its hilt resembles a demonic head and wings. Whenever you slay a creature with an attack using the dagger, the creature's soul is imprisoned inside the dagger, and that creature can be restored to life only by a Wish spell. The dagger can hold a maximum of five souls.\n   For each soul imprisoned in the dagger, your attacks with it deal an extra 1d4 necrotic damage on a hit. While the dagger is within 5 feet of you, your dreams are haunted by whispers from the trapped souls.\n   The dagger has the following additional properties.\n   " + toUni("Siphon Vitality") + ". As a bonus action, you can release any number of stored souls from the dagger to regain 1d10 hit points per soul released.\n   " + toUni("Annihilation") + ". If the dagger holds five souls, you can use this property: As a reaction immediately after you hit a creature with the dagger and deal damage to that target, you can release all five souls. If the target now has fewer than 75 hit points, it must succeed on a DC 15 Constitution saving throw or die. If the target dies, you can't use this property again until you finish a long rest.",
	attunement : true,
	weight : 1,
	action : [["bonus action", " (Siphon Vitality)"], ["reaction", " (Annihilation)"]],
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*rakdos)(?=.*riteknife).*$/i,
		name : "Rakdos Riteknife",
		source : [["G", 180]],
		description : "Finesse, light, thrown; Imprisons soul on kill (max 5); +1d4 necrotic damage per stored soul",
		modifiers : [1, 1],
		selectNow : true
	}],
	usages : 1,
	recovery : "long rest",
	additional : "Annihilation"
}
MagicItemsList["skyblinder staff"] = {
	name : "Skyblinder Staff",
	source : [["G", 181]],
	type : "staff",
	rarity : "uncommon",
	description : "This +1 quarterstaff gives me a +1 bonus on spell attacks. As a reaction when a flying creature I can see within 30 ft makes an attack roll against me, I can cause the staff to flare with light. The attacker has disadvantage on the attack roll, and it must make a DC 15 Con save or be blinded until the start of its next turn.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic quarterstaff. While holding it, you gain a +1 bonus to spell attack rolls.\n   If a flying creature you can see within 30 feet of you makes an attack roll against you, you can use your reaction to hold the staff aloft and cause it to flare with light. The attacker has disadvantage on the attack roll, and it must succeed on a DC 15 Constitution saving throw or be blinded until the start of its next turn.",
	attunement : true,
	weight : 4,
	action : [["reaction", " (vs. flying)"]],
	weaponOptions : [{
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*skyblinder)(?=.*staff).*$/i,
		name : "Skyblinder Staff",
		source : [["G", 181]],
		modifiers : [1, 1],
		selectNow : true
	}],
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type == "attack") return 1;
			},
			"While holding the Skyblinder Staff, I have a +1 bonus to spell attack rolls."
		]
	}
}
MagicItemsList["spies' murmur"] = {
	name : "Spies' Murmur",
	source : [["G", 181]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "This dark metal headpiece is worn curved around the ear. I can communicate telepathically with others that I know within 1 mile who are also wearing a spies' murmur. As a bonus action, I can allow that creature to hear everything I hear for 1 hour. I can end this effect as a bonus action, and it ends if I am incapacitated.",
	descriptionFull : "This headpiece, crafted from dark metal, is worn curved around the ear. If you know a creature wearing another Spies' Murmur and that creature is within 1 mile of you, you can communicate telepathically with each other. As a bonus action, you can allow that creature to hear everything you hear for 1 hour. You can end this effect as a bonus action, and it ends if you're incapacitated.",
	attunement : true
}
MagicItemsList["sunforger"] = {
	name : "Sunforger",
	source : [["G", 181]],
	type : "weapon (warhammer)",
	rarity : "rare",
	description : "This warhammer adds +2 to attack and damage rolls made with it. As an action once per short rest, I can hurl it up to 120 ft to a point I can see where it explodes in a 20-ft radius, dealing 6d6 fire damage to all within, DC 15 Dex save halves. Within 24 hours afterward, I can have it reform in my hand as an action.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic weapon.\n   As an action, you can hurl the weapon up to 120 feet to a point you can see. When it reaches that point, the weapon vanishes in an explosion, and each creature in a 20-foot-radius sphere centered on that point must make a DC 15 Dexterity saving throw, taking 6d6 fire damage on a failed save, or half as much damage on a successful one. Afterward, you can use an action to cause the weapon to reappear in your empty hand. You can't cause it to explode again until you finish a short or long rest.\n   If you don't call the weapon back to your hand, it reappears at the point where it exploded when you are no longer attuned to it or when 24 hours have passed.",
	attunement : true,
	weight : 2,
	action : [["action", " (hurl/recall)"]],
	weaponOptions : [{
		baseWeapon : "warhammer",
		regExpSearch : /sunforger/i,
		name : "Sunforger",
		source : [["G", 181]],
		description : "Versatile (1d10); As action, hurl 120 ft for 20-ft rad 6d6 fire dmg, Dex DC 15 half",
		modifiers : [2, 2],
		selectNow : true
	}],
	usages : 1,
	recovery : "short rest",
	additional : "Hurl"
}
MagicItemsList["sword of the paruns"] = {
	name : "Sword of the Paruns",
	source : [["G", 181]],
	type : "weapon (longsword)",
	rarity : "very rare",
	description : "This longsword has a +1 to hit and damage. Once per round after I take an action while holding it, I can use it to have a creature within 60 ft use its reaction to do something based on the action I was taking: [Attack] make one weapon attack, [Dash] move its speed, or [Dodge] gain the benefits of a Dodge action.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic weapon. Additionally, once on each of your turns, you can use one of the following properties if you're holding the sword:\n \u2022 Immediately after you use the Attack action to attack with the sword, you can enable one creature within 60 feet of you to use its reaction to make one weapon attack.\n \u2022 Immediately after you take the Dash action, you can enable one creature within 60 feet of you to use its reaction to move up to its speed.\n \u2022 Immediately after you take the Dodge action, you can enable one creature within 60 feet of you to use its reaction to gain the benefits of the Dodge action.",
	attunement : true,
	weight : 3,
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /^(?=.*sword)(?=.*paruns).*$/i,
		name : "Sword of the Paruns",
		source : [["G", 181]],
		description : "Versatile (1d10); Have ally in 60 ft do something when I take the Attack, Dash, or Dodge action",
		modifiers : [1, 1],
		selectNow : true
	}]
}
MagicItemsList["voyager staff"] = {
	name : "Voyager Staff",
	source : [["G", 181]],
	type : "staff",
	rarity : "very rare",
	description : "This +1 quarterstaff gives me a +1 bonus on spell attacks. It has 10 charges, regaining 1d6+4 expended charges at dawn. If I expend its last charge, roll a d20. On a 1, it vanishes. I can use its charges to cast Banishment (4 ch), Blink (3 ch), Misty Step (2 ch), Passwall (5 ch), and Teleport (7 ch), using my spellcasting ability.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic quarterstaff. While you hold it, you gain a +1 bonus to spell attack rolls.\n   This staff has 10 charges. While holding it, you can use an action to expend 1 or more of the staff's charges to cast one of the following spells from it, using your spell save DC: Banishment (4 charges), Blink (3 charges), Misty Step (2 charges), Passwall (5 charges), or Teleport (7 charges).\n   The staff regains 1d6 + 4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff vanishes forever.",
	attunement : true,
	weight : 4,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	weaponOptions : [{
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*voyager)(?=.*staff).*$/i,
		name : "Voyager Staff",
		source : [["G", 181]],
		modifiers : [1, 1],
		selectNow : true
	}],
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type == "attack") return 1;
			},
			"While holding the Voyager Staff, I have a +1 bonus to spell attack rolls."
		]
	},
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["misty step"],
		selection : ["misty step"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["blink"],
		selection : ["blink"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["banishment"],
		selection : ["banishment"],
		firstCol : 4
	}, {
		name : "5 charges",
		spells : ["passwall"],
		selection : ["passwall"],
		firstCol : 5
	}, {
		name : "7 charges",
		spells : ["teleport"],
		selection : ["teleport"],
		firstCol : 7
	}]
}

// pub_20181120_WDotMM.js
// This file adds the magic items from the Waterdeep: Dungeon of the Mad Mage adventure to MPMB's Character Record Sheet

// Define the source
SourceList["WDotMM"] = {
	name : "Waterdeep: Dungeon of the Mad Mage [items]",
	abbreviation : "WDotMM",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/waterdeep-dungeon-of-the-mad-mage",
	date : "2018/11/20"
};

// Magic Items
MagicItemsList["potion of comprehension"] = {
	name : "Potion of Comprehension",
	source : [["WDotMM", 62]],
	type : "potion",
	rarity : "common",
	description : "Once as an action, I can drink this potion or administer it to another to gain the effect of the Comprehend Languages spell. The consumer understands the literal meaning of any spoken language heard or written text touched and read. This liquid is a clear concoction with bits of salt and soot swirling in it.",
	descriptionFull : "When you drink this potion, you gain the effect of a comprehend languages spell for 1 hour. This liquid is a clear concoction with bits of salt and soot swirling in it.",
	weight : 0.5
};
MagicItemsList["potion of watchful rest"] = { // contains contributions by Nod_Hero
	name : "Potion of Watchful Rest",
	source : [["WDotMM", 62]],
	type : "potion",
	rarity : "common",
	description : "Once as an action, I can drink this weet, amber-colored potion or administer it to another to gain the following benefits for the next 8 hours: magic can't put the consumer to sleep, and they can remain awake during a long rest and still gain its benefits. This brew has no effect on creatures that don't require sleep.",
	descriptionFull : "When you drink this potion, you gain the following benefits for the next 8 hours: magic can't put you to sleep, and you can remain awake during a long rest and still gain its benefits. This sweet, amber-colored brew has no effect on creatures that don't require sleep, such as elves.",
	weight : 0.5
};
MagicItemsList["dagger of blindsight"] = {
	name : "Dagger of Blindsight",
	source : [["WDotMM", 86]],
	type : "weapon (dagger)",
	rarity : "rare",
	magicItemTable : "G",
	description : "This magical dagger has a saw-toothed edge and a black pearl nested in its pommel. While I'm attuned to it, I have blindsight out to a range of 30 ft.",
	descriptionFull : "This rare magic item requires attunement. A creature attuned to it gains blindsight out to a range of 30 feet. The dagger has a saw-toothed edge and a black pearl nested in its pommel.",
	attunement : true,
	weight : 1,
	weaponsAdd : {
		select : ["Dagger of Blindsight"],
		options : ["Dagger of Blindsight"]
	},
	vision : [["Blindsight", 30]]
}
MagicItemsList["professor orb"] = { // contains contributions by Pengsloth
	name : "Professor Orb",
	source : [["WDotMM", 131], ["RotF", 315]],
	type : "wondrous item",
	rarity : "rare",
	storyItemAL : true,
	description : "This orb is sentient with the personality of a scholar, but no will of its own. It has Int 18, Wis and Cha of 3d6 each. It knows and reads 4 languages, can see/hear as a human out to 60 ft, and has extensive knowledge of 4 narrow academic subjects (+9 on checks). It knows Mage Hand, which it uses to move around.",
	descriptionFull : "Each professor orb takes the form of a smooth, solid, 5-pound sphere of smoky gray quartz about the size of a grapefruit. Close examination reveals two or more pinpricks of silver light deep inside the sphere.\n   A Professor Orb is sentient and has the personality of a scholar. Its alignment is determined by rolling on the alignment table in the \"Sentient Magic Items\" section in chapter 7 of the Dungeon Master's Guide. Regardless of its disposition, the orb has an Intelligence of 18, and Wisdom and Charisma scores determined by rolling 3d6 for each ability. The orb speaks, reads, and understands four languages, and can see and hear normally out to a range of 60 feet. Unlike most sentient items, the orb has no will of its own and can't initiate a conflict with the creature in possession of it.\n   A Professor Orb has extensive knowledge of four narrow academic subjects. When making an Intelligence check to recall lore from any of its areas of expertise, the orb has a +9 bonus to its roll (including its Intelligence modifier).\n   In addition to the knowledge it possesses, a professor orb can cast the Mage Hand cantrip at will. It uses the spell only to transport itself. Its spellcasting ability is Intelligence."
}
AddFeatureChoice(MagicItemsList["horn of valhalla"], false, "Endless Maze (rare; 3d4+3 berserkers; prereq: simple weapons prof.)", {
	name : "Horn of the Endless Maze",
	sortname : "Horn of Valhalla, Endless Maze",
	source : [["WDotMM", 163]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G", // interpretation, made it the same as Brass Horn of Valhalla,
	description : "As an action once per 7 days, I can blow this horn to summon 3d4+3 minotaurs (use berserker stats) from the Abyss in 60 ft. They return after 1 hour or when they drop to 0 HP. They follow my commands and are friendly to me and my companions if I'm proficient with all simple weapons. Otherwise, they attack me.",
	descriptionFull : "You can use an action to blow this horn. In response, 3d4+3 warrior spirits from the Abyss appear within 60 feet of you. They look like Minotaurs and use the statistics of a berserker. They return to the Abyss after 1 hour or when they drop to 0 hit points. Once you use the horn, it can't be used again until 7 days have passed.\n   If you blow the horn without having proficiency with all simple weapons, the summoned berserkers attack you. If you meet the requirement, they are friendly to you and your companions and follow your commands."
});
MagicItemsList["dodecahedron of doom"] = {
	name : "Dodecahedron of Doom",
	source : [["WDotMM", 174]],
	type : "wondrous item",
	rarity : "rare",
	notLegalAL : true,
	description : "This twelve-sided metal die is 1 ft across and bears the numbers 1 through 12 engraved on its pentagonal sides. As an action, I can hurl it up to 60 ft. A random magical effect occurs when the die comes to rest after rolling across the ground for at least 10 ft. See the Notes page for the table of effects.",
	descriptionFull : "This twelve-sided metal die is 12 inches across and bears the numbers 1 through 12 engraved on its pentagonal sides. The dodecahedron contains arcane clockwork mechanisms that whir and click whenever the die is cast.\n   The dodecahedron can be hurled up to 60 feet as an action. A random magical effect occurs when the die comes to rest after rolling across the ground for at least 10 feet. If an effect requires a target and no eligible target is within range, nothing happens. Spells cast by the dodecahedron require no components. Roll a d12 and consult the following table to determine the effect:\n\n" + toUni("d12\teffect") + "\n1-2\tThe dodecahedron explodes and is destroyed. Each creature within 20 feet of the exploding die must make a DC 13 Dexterity saving throw, taking 40 (9d8) force damage on a failed save, or half as much damage on a successful one.\n3-4\tThe dodecahedron casts Light on itself. The effect lasts until a creature touches the die.\n5-6\tThe dodecahedron casts Ray of Frost (+5 to hit), targeting a random creature within 60 feet of it that doesn't have total cover against the attack.\n7-8\tThe dodecahedron casts Shocking Grasp (+5 to hit) on the next creature that touches it.\n9-10\tThe dodecahedron casts Darkness on itself. The effect has a duration of 10 minutes.\n11-12\tThe next creature to touch the dodecahedron gains 1d10 temporary hit points that last for 1 hour.",
	weight : 2,
	toNotesPage : [{
		name : "Effect Table",
		note : [
			"This twelve-sided metal die is 12 inches across and bears the numbers 1 through 12 engraved on its pentagonal sides. The dodecahedron contains arcane clockwork mechanisms that whir and click whenever the die is cast.",
			"If an effect requires a target and no eligible target is within range, nothing happens.",
			"d12\tEFFECT",
			"1-2\tThe dodecahedron explodes and is destroyed. Each creature within 20 feet of the exploding die must make a DC 13 Dexterity saving throw, taking 40 (9d8) force damage on a failed save, or half as much damage on a successful one.",
			"3-4\tThe dodecahedron casts light on itself. The effect lasts until a creature touches the die.",
			"5-6\tThe dodecahedron casts ray of frost (+5 to hit), targeting a random creature within 60 feet of it that doesn't have total cover against the attack.",
			"7-8\tThe dodecahedron casts shocking grasp (+5 to hit) on the next creature that touches it.",
			"9-10\tThe dodecahedron casts darkness on itself. The effect has a duration of 10 minutes.",
			"11-12\tThe next creature to touch the dodecahedron gains 1d10 temporary hit points that last for 1 hour."
		]
	}]
}
MagicItemsList["orb of gonging"] = { // contains contributions by Pengsloth
	name : "Orb of Gonging",
	source : [["WDotMM", 174]],
	type : "wondrous item",
	rarity : "common",
	description : "This item is a hollow, 5-inch-diameter orb with notches along its outside bronze rings. As an action, I can align the notches, causing the orb to gong loudly until the notches are no longer aligned. The sounds are spaced 6 seconds apart and can be heard out to a range of 600 ft.",
	descriptionFull : "This common wondrous item is a hollow, 5-inch-diameter orb that weighs 5 pounds. Its outer shell is composed of notched bronze rings, which can be turned so that the notches line up. Aligning the notches requires an action, and doing so causes the orb to gong loudly until the notches are no longer aligned. The sounds are spaced 6 seconds apart and can be heard out to a range of 600 feet."
}
MagicItemsList["black crystal tablet"] = { // contains contributions by Pengsloth
	name : "Black Crystal Tablet",
	source : [["WDotMM", 284]],
	type : "wondrous item",
	rarity : "legendary",
	magicItemTable : "I",
	description : "As an action once per dawn, I can use the tablet to cast Eyebite or Gate, but the latter only links to the Far Realm. When attuning to it, I must make a DC 20 Wisdom saving throw or be afflicted by afflicted long-term madness (see table at SRD 201 or DMG 259).",
	descriptionFull : "Any creature that attunes to the tablet must make a DC 20 Wisdom saving throw at the end of its next long rest. On a failed save, the creature becomes afflicted with a random form of long-term madness (see \"Madness\" in chapter 8 of the Dungeon Master's Guide).\n   As an action, a creature attuned to the Black Crystal Tablet can use it to cast Eyebite or Gate (the portal created by this spell links to the Far Realm only). After the tablet is used to cast a spell, it cannot be used again until the next dawn.",
	attunement : true,
	prerequisite : "Requires attunement by a creature that has proficiency in the arcana skill",
	prereqeval : function(v) { return v.skillProfs.indexOf("Arcana") !== -1; },
	usages : 1,
	recovery : "dawn",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["eyebite", "gate"],
		selection : ["eyebite", "gate"],
		firstCol : 1,
		times : 2
	},
	spellChanges : {
		"gate" : {
			description : "Create a portal to a precise location in the far realm; can transport named crea to me",
			changes : "The spell can only connect to the Far Realm."
		}
	}
}
MagicItemsList["helm of the scavenger"] = {
	name : "Helm of the Scavenger",
	source : [["WDotMM", 297]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	description : "This ornate chair can be placed on a ship weighing up to 100 tons. It generates artificial gravity and an envelope of fresh air at 70 \u00B0F around the ship when in the void of space. While attuned to it and sitting in the chair, I can propel the ship, steer it, and see what is happening anywhere on it, but I can't use spell slots.",
	descriptionFull : "This ornate chair is designed to propel and maneuver a ship through space.\n   " + toUni("Passive Properties") + ". The following properties of the helm come into play even when no creature is attuned to it:\n \u2022 When placed aboard a vessel weighing between 1 and 100 tons, the helm generates an envelope of fresh air around the ship while it is in the void of space (but not underwater). This envelope extends out from the edges of the hull in all directions for a distance equal in length to the vessel's beam, so that creatures aboard and near the ship can breathe normally in space. The temperature within the air envelope is 70 degrees Fahrenheit.\n \u2022 When placed aboard a vessel weighing between 1 and 100 tons, the helm generates an artificial gravity field while the ship is in the void of space, so that creatures can walk on the ship's decks as they normally would. Creatures and objects that fall overboard bob in a gravity plane that extends out from the main deck for a distance equal in length to the vessel's beam.\n\n" + toUni("Active Properties") + ". The sensation of being attuned to the helm is akin to being immersed in warm water. While attuned to the helm, you gain the following abilities while you sit in it:\n \u2022 You can use the helm to propel the vessel across or through water and other liquids at a maximum speed in miles per hour equal to your highest-level unexpended spell slot.\n \u2022 You can use the helm to propel the vessel through air or space at a maximum speed in miles per hour equal to your highest-level unexpended spell slot \xD7 10.\n \u2022 Provided you have at least one unexpended spell slot, you can steer the vessel, albeit in a somewhat clumsy fashion, in much the same way that oars or a rudder can maneuver a seafaring ship.\n \u2022 Whenever you like, you can see what's happening on and around the vessel as though you were standing in a location of your choice aboard it.\n\n" + toUni("Drawback") + ". While attuned to the helm, you cannot expend your own spell slots.",
	attunement : true,
	toNotesPage : [{
		name : "Features",
		note : [
			"When placed aboard a vessel weighing between 1 and 100 tons, this ornate chair can propel and maneuver a ship through space.",
			"The following properties of the helm come into play even when no creature is attuned to it:",
			" \u2022 The helm generates an envelope of fresh air around the ship while it is in the void of space (but not underwater). This envelope extends out from the edges of the hull in all directions for a distance equal in length to the vessel's beam, so that creatures aboard and near the ship can breathe normally in space. The temperature within the air envelope is 70 degrees Fahrenheit.",
			" \u2022 The helm generates an artificial gravity field while the ship is in the void of space, so that creatures can walk on the ship's decks as they normally would. Creatures and objects that fall overboard bob in a gravity plane that extends out from the main deck for a distance equal in length to the vessel's beam.",
			"The sensation of being attuned to the helm is akin to being immersed in warm water. While attuned to the helm, I gain the following abilities while I sit in it:",
			" \u2022 I can use the helm to propel the vessel across or through water and other liquids at a maximum speed in miles per hour equal to my highest-level unexpended spell slot.",
			" \u2022 I can use the helm to propel the vessel through air or space at a maximum speed in miles per hour equal to my highest-level unexpended spell slot \xD7 10.",
			" \u2022 Provided I have at least one unexpended spell slot, I can steer the vessel, albeit in a somewhat clumsy fashion, in much the same way that oars or a rudder can maneuver a seafaring ship.",
			" \u2022 Whenever I like, I can see what's happening on and around the vessel as though I were standing in a location of my choice aboard it.",
			" \u2022 I cannot expend my own spell slots."
		]
	}]
}
MagicItemsList["shield of the uven rune"] = { // contains contributions by Pengsloth
	name : "Shield of the Uven Rune",
	source : [["WDotMM", 299]],
	storyItemAL : true,
	description : "I can use the shield as it is, or transfer its runic properties over to a weapon.",
	descriptionFull : "This shield is made from the scale of an ancient white dragon. It has a rune burned into its outward-facing side. A character who examines the rune and succeeds on a DC 20 Intelligence (History) check recognizes it as an uven (\"enemy\" in Giant) rune that confers great power.\n   While holding the shield, you benefit from the following properties.\n   " + toUni("Winter's Friend") + ". You are immune to cold damage.\n   " + toUni("Deadly Rebuke") + ". Immediately after a creature hits you with a melee attack, you can use your reaction to deal 3d6 necrotic damage to that creature.\n   " + toUni("Bane") + ". You can cast the Bane spell from the shield (save DC 17). The spell does not require concentration and lasts for 1 minute. Once you cast the spell from the shield, you can't do so again until you finish a short or long rest.\n   " + toUni("Gift of Vengeance") + ". You can transfer the shield's magic to a nonmagical weapon by tracing the uven rune on the weapon with one finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the shield is destroyed, and the rune is etched or burned into the chosen weapon. This weapon becomes a rare magic item that requires attunement. It has the properties of a +1 weapon. The bonus increases to +3 when the weapon is used against one of the following creature types, chosen by you at the time of the magic weapon's creation: aberrations, celestials, constructs, dragons, elementals, fey, fiends, giants, or undead.",
	attunement : true,
	choices : ["Shield", "Transferred to a weapon"],
	choicesNotInMenu : true,
	"shield" : {
		name : "Shield of the Uven Rune ",
		type : "shield",
		rarity : "very rare",
		description : "This shield made from the scale of a white dragon gives me cold damage immunity. As a reaction when I'm hit by a melee attack, I can deal 3d6 necrotic damage to the attacker. Once per short rest, I can cast Bane (DC 17) needing no concentration. I can do an 8 hour ritual to transfer the rune to a weapon, see book.",
		weight : 6,
		usages : 1,
		recovery : "short rest",
		additional : "Bane",
		shieldAdd : "Shield of the Uven Rune",
		action : [["reaction", ""]],
		savetxt : {	immune : ["cold"] },
		fixedDC : 17,
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["bane"],
			selection : ["bane"],
			firstCol : "oncesr"
		},
		spellChanges : {
			"bane" : {
				duration : "1 min",
				changes : "The spell does not require concentration."
			}
		}
	},
	"transferred to a weapon" : {
		name : "Uven Rune Weapon",
		type : "weapon (any)",
		rarity : "rare",
		description : "This magic weapon adds a +1 bonus to attack and damage rolls made with it. This bonus increases to +3 when it is used against the creature type, chosen at the time of the magic weapon's creation: aberrations, celestials, constructs, dragons, elementals, fey, fiends, giants, or undead.",
		chooseGear : {
			type : "weapon",
			prefixOrSuffix : "brackets",
			descriptionChange : ["replace", "weapon"],
			itemName1stPage : ["suffix", "Uven Rune"]
		},
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && (/^(?=.*\buven\b)(?=.*(rune|runic)).*$/i).test(v.WeaponTextName)) {
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + '+2 to hit/damage vs. chosen creature type';
					}
				},
				'If I include the words "Uven Rune" in a the name of a weapon, it will be treated as the magic weapon Uven Rune Weapon, which has a +1 bonus, or a +3 bonus against its chosen creature type.'
			],
			atkCalc : [
				function (fields, v, output) {
					if ((/^(?=.*\buven\b)(?=.*(rune|runic)).*$/i).test(v.WeaponTextName)) {
						output.magic = v.thisWeapon[1] + 1;
					}
				}, ''
			]
		}
	}
}
MagicItemsList["blast scepter"] = { // contains contributions by Pengsloth
	name : "Blast Scepter",
	source : [["WDotMM", 310]],
	type : "rod",
	rarity : "very rare",
	storyItemAL : true,
	description : "While attuned to the Blast Scepter, I gain resistance to fire and lightning damage and can, as an action, use it to cast Thunderwave as a 4th-level spell (save DC 16) without expending a spell slot. It can be used as an arcane focus.",
	descriptionFull : "The Blast Scepter can be used as an arcane focus.\n   Whoever is attuned to the Blast Scepter gains resistance to fire and lightning damage and can, as an action, use it to cast Thunderwave as a 4th-level spell (save DC 16) without expending a spell slot.",
	attunement : true,
	dmgres : ["Fire", "Lightning"],
	fixedDC : 16,
	spellcastingBonus : {
		name : "At will (4th level)",
		spells : ["thunderwave"],
		selection : ["thunderwave"],
		firstCol : "atwill"
	},
	spellChanges : {
		"thunderwave" : {
			nameShort : "Thunderwave (4th level)",
			description : "All crea/obj in area 5d8 Thunder dmg, pushed 10 ft away; save halves and not pushed",
			changes : "Cast as if using a 4th-level spell slot"
		}
	}
}
MagicItemsList["chest of preserving"] = {
	name : "Chest of Preserving",
	source : [["WDotMM", 139]],
	type : "wondrous item",
	rarity : "common",
	description : "Food and other perishable items do not age or decay while inside this chest. It is 2.5 ft long, 1.5 ft wide, and 1 ft tall with a half-barrel lid. The chest has a lock, which can be picked with thieves' tools and a successful DC 15 Dexterity check. Smashing the lock or any other part of the chest renders it nonmagical.",
	descriptionFull : "Food and other perishable items do not age or decay while inside a Chest of Preserving. The chest is 2\xBD feet long, 1\xBD feet wide, and 1 foot tall with a half-barrel lid. The chest has a lock, which can be picked with thieves' tools and a successful DC 15 Dexterity check. Smashing the lock or any other part of the chest renders it nonmagical.",
	weight : 25
}
MagicItemsList["circlet of human perfection"] = { // contains contributions by Pengsloth
	name : "Circlet of Human Perfection",
	source : [["WDotMM", 30]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	prerequisite : "Requires attunement by a humanoid",
	description : "Wearing this circlet transforms my appearance into an attractive human of average height and weight, but otherwise doesn't change anything. The circlet chooses the physical characteristics of the form, such as age, gender, skin color, hair color, and voice. Removing the circlet ends the effect.",
	descriptionFull : "The Circlet of Human Perfection transforms its attuned wearer into an attractive human of average height and weight. The circlet chooses the physical characteristics of the form, such as age, gender, skin color, hair color, and voice. Except for size, the wearer's statistics and racial traits don't change, nor do items worn or carried by the wearer. Removing the circlet ends the effect.",
	attunement : true
}
MagicItemsList["propeller helm"] = { // contains contributions by Pengsloth
	name : "Propeller Helm",
	source : [["WDotMM", 251]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	prerequisite : "Requires attunement by a Small humanoid",
	prereqeval : function () { return tDoc.getField("Size Category").currentValueIndices == 4; },
	description : "While worn, the helm allows me to use an action to cast Levitate, requiring no components. Each time the spell ends, there is a 50 percent chance that the helm loses its magic and becomes nonmagical.",
	descriptionFull : "While worn, the helm allows its wearer to use an action to cast the Levitate spell, requiring no components. The helm's propeller spins and whirs loudly until the spell ends. Each time the spell ends, there is a 50 percent chance that the helm loses its magic and becomes nonmagical.",
	attunement : true,
	spellcastingBonus : {
		name : "At will",
		spells : ["levitate"],
		selection : ["levitate"],
		firstCol : "atwill"
	}
}
MagicItemsList["tearulai"] = { // contains contributions by Pengsloth
	name : "Tearulai",
	source : [["WDotMM", 76]],
	type : "weapon (longsword)",
	rarity : "very rare",
	storyItemAL : true,
	description : "If I roll a 20 on an attack with this sword, it deals +14 slashing damage and there is a 5% chance its lobs off a limb. It deals max damage to objects and has 6 charges, regaining 1d4+2 at dawn, which it can use to cast spells. It can shed light on command and is a sentient weapon with a will of its own, see Notes page.",
	descriptionFull : [
		"The longsword, Tearulai, is a sentient, neutral good sword of sharpness with an emerald-colored blade and precious gemstones embedded in its hilt and pommel. The sword's magical properties are suppressed until it is removed from Valdemar's skull.",
		"Evil creatures can't attune to Tearulai; any evil creature that tries to do so takes 20 psychic damage. The weapon's emerald blade can't be damaged or dulled, and the sword can't be teleported anywhere without its wielder while the two are attuned to one another.",
		toUni("Sword of Sharpness") + ". When you attack an object with this magic sword and hit, maximize your weapon damage dice against the target.",
		"When you attack a creature with this weapon and roll a 20 on the attack roll, that target takes an extra 14 slashing damage. Then roll another d20. If you roll a 20, you lop off one of the target's limbs, with the effect of such loss determined by the DM. If the creature has no limb to sever, you lop off a portion of its body instead.",
		"In addition, you can speak the sword's command to cause the blade to shed bright light in a 10-foot radius and dim light for an additional 10 feet. Speaking the command word again or sheathing the sword puts out the light.\n\nNote: According to the SRD, it is an extra 4d6 slashing damage, although this is incorrect.",
		toUni("Spells") + ". The sword has 6 charges and regains 1d4 + 2 expended charges daily at dawn. A creature attuned to the sword can use an action and expend 1 or more charges to cast one of the following spells from it without material components: Fly (2 charges), Polymorph (3 charges), or Transport Via Plants (4 charges).",
		toUni("Sentience") + ". The sword has an Intelligence of 17, a Wisdom of 12, and a Charisma of 20. It has hearing and truesight out to a range of 120 feet. It communicates telepathically with its attuned wielder and can speak, read, and understand Common, Draconic, Elvish, and Sylvan. In addition, the sword can ascertain the true value of any gemstone brought within 5 feet of it.",
		toUni("Personality") + ". Tearulai admires great beauty, music, fine art, and poetry. Vain, the weapon strives to improve its appearance. It craves gemstones and seeks out better ones with which to adorn itself. Most of all, it longs to return to the forests around Myth Drannor, where it was created. If its wielder's goals run counter to its own, Tearulai attempts to take control of its wielder and escape Undermountain, whereupon it can use its Transport Via Plants spell to return whence it came."
	].join("\n   "),
	attunement : true,
	prerequisite : "Requires attunement by a creature of non-evil alignment",
	prereqeval : function(v) { return !(/evil/i).test(What("Alignment")); },
	weight : 3,
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /tearulai/i,
		name : "Tearulai",
		source : [["WDotMM", 76]],
		description : "Versatile (1d10); On 20 to hit: +14 damage \u0026 5% chance to sever limb; Max damage vs. objects",
		selectNow : true
	}],
	usages : 6,
	recovery : "dawn",
	additional : "regain 1d4+2",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["fly"],
		selection : ["fly"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["polymorph"],
		selection : ["polymorph"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["transport via plants"],
		selection : ["transport via plants"],
		firstCol : 4
	}],
	toNotesPage : [{
		name : "Traits and Personality",
		note : desc([
			"Tearulai has an emerald-colored blade and precious gemstones embedded in its hilt and pommel. Evil creatures can't attune to it and take 20 psychic damage if they try to do so. Its emerald blade can't be damaged or dulled, and the sword can't be teleported anywhere without its wielder while the two are attuned to one another.",
			"Objects hit by the sword take maximum damage from it. When I roll a 20 on the attack roll against a creature, that target takes an extra 14 slashing damage. Then roll another d20. If you roll a 20, you lop off one of the target's limbs, with the effect of such loss determined by the DM. If the creature has no limb to sever, you lop off a portion of its body instead.",
			"I can speak the sword's command to cause the blade to shed bright light in a 10-ft radius and dim light for another 10 ft. The light stops when I sheath the sword or speaking the command word again.",
			"The sword has 6 charges and regains 1d4 + 2 expended charges daily at dawn. I can use the charges to cast Fly (2 charges), Polymorph (3 charges), or Transport Via Plants (4 charges).",
			"Tearulai is sentient and has an Intelligence of 17, a Wisdom of 12, and a Charisma of 20. It has hearing and truesight out to a range of 120 ft. It communicates telepathically with its attuned wielder and can speak, read, and understand Common, Draconic, Elvish, and Sylvan. In addition, the sword can ascertain the true value of any gemstone brought within 5 ft of it.",
			"Tearulai admires great beauty, music, fine art, and poetry. Vain, the weapon strives to improve its appearance. It craves gemstones and seeks out better ones with which to adorn itself. Most of all, it longs to return to the forests around Myth Drannor, where it was created. If its wielder's goals run counter to its own, Tearulai attempts to take control of its wielder and uses Transport Via Plants to return whence it came."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["vial of stardust"] = {
	name : "Vial of Stardust",
	source : [["WDotMM", 251]],
	type : "potion",
	rarity : "unknown",
	description : "Once as an action, I can sprinkles the stardust contained in this vial over myself. After I do so, I gain the ability to cast Dream once as an action (spell save DC 15), requiring no components.",
	descriptionFull : "Any creature that sprinkles the contents of a Vial of Stardust over itself gains the ability to cast the Dream spell once as an action (spell save DC 15), requiring no components."
}

// Beast
// Crow is just a raven under a different name, it has been added to the SRD code as a `nameAlt`

// pub_20190521_GoS.js
// This file adds all material from the Ghosts of Saltmarsh adventure to MPMB's Character Record Sheet

// Define the source
SourceList["GoS"] = {
	name : "Ghosts of Saltmarsh [backgrounds, beasts, items]",
	abbreviation : "GoS",
	group : "Adventure Books",
	campaignSetting : "Anthology",
	url : "https://dnd.wizards.com/products/ghosts-saltmarsh",
	date : "2019/05/21"
};

BackgroundList["fisher"] = {
	regExpSearch : /fisher/i,
	name : "Fisher",
	source : [["GoS", 29], ["ALbackground", 0]],
	skills : ["History", "Survival"],
	gold : 10,
	equipleft : [
		["Fishing tackle", "", 4],
		["Net", "", 3]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Fishing lure or oiled leather boots", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	feature : "Harvest the Water",
	trait : [
		"I am unmoved by the wrath of nature.",
		"My friends are my crew; we sink or float together.",
		"I need long stretches of quiet to clear my head.",
		"Rich folk don't know the satisfaction of hard work.",
		"I laugh heartily, feel deeply, and fear nothing.",
		"I work hard; nature offers no handouts.",
		"I dislike bargaining; state your price and mean it.",
		"Luck favors me, and I take risks others might not."
	],
	ideal : [
		["Camaraderie", "Camaraderie. Good people make even the longest voyage bearable. (Good)"],
		["Luck", "Luck. Our luck depends on respecting its rules\u2014now throw this salt over your shoulder. (Lawful)"],
		["Daring", "Daring. The richest bounty goes to those who risk everything. (Chaotic)"],
		["Plunder", "Plunder. Take all that you can and leave nothing for the scavengers. (Evil)"],
		["Balance", "Balance. Do not fish the same spot twice in a row; suppress your greed, and nature will reward you. (Neutral)"],
		["Hard Work", "Hard Work. No wave can move a soul hard at work. (Any)"]
	],
	bond : [
		"I lost something important in the deep sea, and I intend to find it.",
		"Someone else's greed destroyed my livelihood, and I will be compensated.",
		"I will fish the many famous waters of this land.",
		"The gods saved me during a terrible storm, and I will honor their gift.",
		"My destiny awaits me at the bottom of a particular pond in the Feywild.",
		"I must repay my village's debt."
	],
	flaw : [
		"I am judgmental, especially of those I deem homebodies or otherwise lazy.",
		"I become depressed and anxious if I'm away from the sea too long.",
		"I have lived a hard life and find it difficult to empathize with others.",
		"I am inclined to tell long-winded stories at inopportune times.",
		"I work hard, but I play harder.",
		"I am obsessed with catching an elusive aquatic beast, often to the detriment of other pursuits."
	],
	extra : [
		"Select a Fishing Tale",
		"Lobster wrestling",
		"It dragged the boat",
		"Fins of pure gold",
		"Ghost fish",
		"Nemesis clam",
		"It swallowed the sun",
		"Dive into the abyss",
		"Love story"
	]
};
BackgroundFeatureList["harvest the water"] = {
	description : "I gain advantage on ability checks made using fishing tackle. If I have access to a body of water that sustains marine life, I can maintain a moderate lifestyle while working as a fisher, and I can catch enough food to feed myself and up to ten other people each day.",
	source : [["GoS", 29], ["ALbackground", 0]]
};

BackgroundList["marine"] = {
	regExpSearch : /marine/i,
	name : "Marine",
	source : [["GoS", 31], ["ALbackground", 0]],
	skills : ["Athletics", "Survival"],
	gold : 10,
	equipleft : [
		["Folded flag with company symbol", "", 1]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Dagger", "", 1],
		["Belt pouch (with coins)", "", 1]
	],
	toolProfs : ["Vehicles (water)", "Vehicles (land)"],
	feature : "Steady",
	trait : [
		"I speak rarely but mean every word I say.",
		"I laugh loudly and see the humor in stressful situations.",
		"I prefer to solve problems without violence, but I finish fights decisively.",
		"I enjoy being out in nature; poor weather never sours my mood.",
		"I am dependable.",
		"I am always working on some project or other.",
		"I become cantankerous and quiet in the rain.",
		"When the sea is within my sight, my mood is jovial and optimistic."
	],
	ideal : [
		["Teamwork", "Teamwork. Success depends on cooperation and communication. (Good)"],
		["Code", "Code. The marines' code provides a solution for every problem, and following it is imperative. (Lawful)"],
		["Embracing", "Embracing. Life is messy. Throwing yourself into the worst of it is necessary to get the job done. (Chaotic)"],
		["Might", "Might. The strong train so that they might rule those who are weak. (Evil)"],
		["Bravery", "Bravery. To act when others quake in fear\u2014this is the essence of the warrior. (Any)"],
		["Perseverance", "Perseverance. No injury or obstacle can turn me from my goal. (Any)"]
	],
	bond : [
		"I face danger and evil to offset an unredeemable act in my past.",
		"I. Will. Finish. The. Job.",
		"I must set an example of hope for those who have given up.",
		"I'm searching for a fellow marine captured by an elusive enemy.",
		"Fear leads to tyranny, and both must be eradicated.",
		"My commander betrayed my unit, and I will have revenge."
	],
	flaw : [
		"I grow combative and unpredictable when I drink.",
		"I find civilian life difficult and struggle to say the right thing in social situations.",
		"My intensity can drive others away.",
		"I hold grudges and have difficulty forgiving others.",
		"I become irrational when innocent people are hurt.",
		"I sometimes stay up all night listening to the ghosts of my fallen enemies."
	],
	extra : [
		"Select a Hardship Endured",
		"Nearly drowned",
		"Captured",
		"Sacrifice",
		"Juggernaut",
		"Stowaway",
		"Leave none behind"
	]
};
BackgroundFeatureList["steady"] = {
	description : "I can move twice the normal amount of time (up to 16 hours) each day before being subject to the effect of a forced march and need to make Constitution saves at the end of each extra hour to avoid gaining a level of exhaustion. Additionally, I can automatically find a safe route to land a boat on shore, provided such a route exists.",
	source : [["GoS", 31], ["ALbackground", 0]]
};

BackgroundList["shipwright"] = {
	regExpSearch : /shipwright/i,
	name : "Shipwright",
	source : [["GoS", 33], ["ALbackground", 0]],
	skills : ["History", "Perception"],
	gold : 10,
	equipleft : [
		["Blank book", "", 5],
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""],
		["Carpenter's tools", "", 8]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	toolProfs : ["Carpenter's tools", "Vehicles (water)"],
	feature : "I'll Patch It!",
	trait : [
		"I love talking and being heard more than I like to listen.",
		"I'm extremely fond of puzzles.",
		"I thrive under pressure.",
		"I love sketching and designing objects, especially boats.",
		"I'm not afraid of hard work\u2014in fact, I prefer it.",
		"A pipe, an ale, and the smell of the sea: paradise.",
		"I have an endless supply of cautionary tales related to the sea.",
		"I don't mind getting my hands dirty."
	],
	ideal : [
		["Crew", "Crew. If everyone on deck pitches in, we'll never sink. (Good)"],
		["Careful Lines", "Careful Lines. A ship must be balanced according to the laws of the universe. (Lawful)"],
		["Invention", "Invention. Make what you need out of whatever is at hand. (Chaotic)"],
		["Perfection", "Perfection. To measure a being and find it lacking is the greatest disappointment. (Evil)"],
		["Reflection", "Reflection. Muddied water always clears in time. (Any)"],
		["Hope", "Hope. The horizon at sea holds the greatest promise. (Any)"]
	],
	bond : [
		"I must visit all the oceans of the world and behold the ships that sail there.",
		"Much of the treasure I claim will be used to enrich my community.",
		"I must find a kind of wood rumored to possess magical qualities.",
		"I repair broken things to redeem what's broken in myself.",
		"I will craft a boat capable of sailing through the most dangerous of storms.",
		"A kraken destroyed my masterpiece; its teeth shall adorn my hearth."
	],
	flaw : [
		"I don't know when to throw something away. You never know when it might be useful again.",
		"I get frustrated to the point of distraction by shoddy craftsmanship.",
		"Though I am an excellent crafter, my work tends to look as though it belongs on a ship.",
		"I am so obsessed with sketching my ideas for elaborate inventions that I sometimes forget little thing like eating and sleeping.",
		"I'm judgmental of those who are not skilled with tools of some kind.",
		"I sometimes take things that don't belong to me, especially if they are very well made."
	],
	extra : [
		"Select a Sea's Influence",
		"Grand designs",
		"Solid and sound",
		"Favored",
		"Master of armaments",
		"Low places",
		"Mysteries of the deep"
	]
};
BackgroundFeatureList["i'll patch it!"] = {
	description : "Provided I have carpenter's tools and wood, I can perform repairs on a water vehicle. When I use this ability, I restore a number of hit points to the hull of a water vehicle equal to 5\xD7 my proficiency modifier. A vehicle cannot be patched by me in this way again until after it has been pulled ashore and fully repaired.",
	source : [["GoS", 33], ["ALbackground", 0]]
};

BackgroundList["smuggler"] = {
	regExpSearch : /smuggler/i,
	name : "Smuggler",
	source : [["GoS", 34], ["ALbackground", 0]],
	skills : ["Athletics", "Deception"],
	gold : 15,
	equipright : [
		["Common clothes", "", 3],
		["Leather boots or vest", "", 1],
		["Belt pouch (with coins)", "", 1]
	],
	toolProfs : ["Vehicles (water)"],
	feature : "Down Low",
	trait : [
		"I love being on the water but hate fishing.",
		"I think of everything in terms of monetary value.",
		"I never stop smiling.",
		"Nothing rattles me; I have a lie for every occasion.",
		"I love gold but won't cheat a friend.",
		"I enjoy doing things others believe to be impossible.",
		"I become wistful when I see the sun rise over the ocean.",
		"I am no common criminal; I am a mastermind."
	],
	ideal : [
		["Wealth", "Wealth. Heaps of coins in a secure vault is all I dream of. (Any)"],
		["Smuggler's Code", "Smuggler's Code. I uphold the unwritten rules of the smugglers, who do not cheat one another or directly harm innocents. (Lawful)"],
		["All for a Coin", "All for a Coin. I'll do nearly anything if it means I turn a profit. (Evil)"],
		["Peace and Prosperity", "Peace and Prosperity. I smuggle only to achieve a greater goal that benefits my community. (Good)"],
		["People", "People. For all my many lies, I place a high value on friendship. (Any)"],
		["Daring", "Daring. I am most happy when risking everything. (Any)"]
	],
	bond : [
		"My vessel was stolen from me, and I burn with the desire to recover it.",
		"I intend to become the leader of the network of smugglers that I belong to.",
		"I owe a debt that cannot be repaid in gold.",
		"After one last job, I will retire from the business.",
		"I was tricked by a fellow smuggler who stole something precious from me. I will find that thief.",
		"I give most of my profits to a charitable cause, and I don't like to brag about it."
	],
	flaw : [
		"Lying is reflexive, and I sometimes engage in it without realizing.",
		"I tend to assess my relationships in terms of profit and loss.",
		"I believe everyone has a price and am cynical toward those who present themselves as virtuous.",
		"I struggle to trust the words of others.",
		"Few people know the real me.",
		"Though I act charming, I feel nothing for others and don't know what friendship is."
	],
	extra : [
		"Select a Claim to Fame",
		"Spirit of the whale",
		"Cart and sword",
		"The recruit",
		"River of shadows",
		"Gold-hearted",
		"Playing both sides"
	]
};
BackgroundFeatureList["down low"] = {
	description : "I am acquainted with a network of smugglers who are willing to help me out of tight spots. While in a particular town, city, or other similarly sized community, my companions and I can stay for free in safe houses. Safe houses provide a poor lifestyle. While staying at a safe house, I can choose to keep my presence (and that of my companions) a secret.",
	source : [["GoS", 34], ["ALbackground", 0]]
};

MagicItemsList["charm of plant command"] = {
	name : "Charm of Plant Command",
	source : [["GoS", 229]],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "C",
	description : "This fist-sized charm is made from a bundle of dried plant stems wrapped in silver thread. It has 3 charges, regain all at dawn. As an action, I can expend 1 charge to cast Speak With Plants. While that spell lasts, I also have adv. on Charisma checks made to influence the behavior, demeanor, and attitude of plants.",
	descriptionFull : "This fist-sized charm is made from a bundle of dried plant stems wrapped in silver thread. Hung on a leather thong, it is typically worn around the neck or attached to a belt.\n   This charm has 3 charges. While you bear the charm, you can expend 1 charge as an action to cast the Speak With Plants spell. For the duration of the spell, you also have advantage on Charisma checks made to influence the behavior, demeanor, and attitude of plants. The charm regains all expended charges at dawn each day.",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["speak with plants"],
		selection : ["speak with plants"],
		firstCol : 1
	},
	spellChanges : {
		"speak with plants" : {
			description : "Talk with plants about previous 24h; plants to difficult terrain or vice versa; adv. Cha checks vs. plants",
			changes : "For the duration of the spell, I also have advantage on Charisma checks made to influence the behavior, demeanor, and attitude of plants."
		}
	}
}
MagicItemsList["cursed luckstone"] = {
	name : "Cursed Luckstone",
	source : [["GoS", 229]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "This flat, gray-and-black river stone is inscribed with an arcane symbol. It is cursed and attuning to it curses me. Once per dawn while it is on my person, I can gain adv. on one ability check of my choice, but disadv. on my next two ability checks. Discarding the stone will cause it to teleport back into my pocket.",
	descriptionFull : "This flat, gray-and-black river stone is inscribed with an unknown arcane symbol and feels cool to the touch. While carrying the stone, you can gain advantage on one ability check of your choice. The stone can't be used this way again until the next dawn.\n   " + toUni("Curse") + "This item is cursed. Attuning to it curses you until you are targeted by a remove curse spell or similar magic. As long as you remain cursed, you cannot discard the stone, which immediately teleports back into your pocket or pack. After you use the stone's magic, your next two ability checks are made with disadvantage.",
	attunement : true,
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["helm of underwater action"] = {
	name : "Helm of Underwater Action",
	source : [["GoS", 229]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "While wearing this brass helmet, I can breathe underwater, I gain darkvision with a range of 60 ft, and I gain a swimming speed of 30 ft.",
	descriptionFull : "While wearing this brass helmet, you can breathe underwater, you gain darkvision with a range of 60 feet, and you gain a swimming speed of 30 feet.",
	attunement : true,
	weight : 1,
	vision : [["Darkvision", "fixed 60"]],
	speed : { swim : { spd : 30, enc : 20 } }
}
MagicItemsList["pipe of remembrance"] = {
	name : "Pipe of Remembrance",
	source : [["GoS", 229]],
	type : "wondrous item",
	rarity : "common",
	description : "Smoke exhaled from this delicate wooden pipe with a river stone bowl does not dissipate, but lingers around. Once per dawn, I can have that smoke form moving shapes after 10 minutes. The shapes reenact my most impressive and heroic achievements realistically for 5 minutes, after which the smoke dissipates.",
	descriptionFull : "This long, delicate wooden pipe features a bowl made from smooth river stone. When the pipe is lit, smoke exhaled from it does not dissipate, instead lingering around the bearer. After 10 minutes, the smoke forms moving shapes that reenact the bearer's most impressive and heroic achievements for 5 minutes. When this realistic performance is complete, the smoke dissipates. The pipe can't be used this way again until the next dawn.",
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["pressure capsule"] = {
	name : "Pressure Capsule",
	source : [["GoS", 229]],
	type : "wondrous item",
	rarity : "common",
	description : "Consuming this capsule of beeswax, sand, and enchanted water plants will prevent the effects of swimming at depths greater than 100 ft for 1 hour. Thus, a creature without a swimming speed does not multiply the time spend swimming at depth for the purpose of determining exhaustion.",
	descriptionFull : "This small capsule is made of beeswax blended with sand and a variety of enchanted water plants. A creature who consumes a pressure capsule ignores the effects of swimming at depths greater than 100 feet for 1 hour (see \"Unusual Environments\" in chapter 5 of the Dungeon Master's Guide)." // addition of 1 hour duration from AL content catalogue v8.08
}
MagicItemsList["sekolahian worshiping statuette"] = {
	name : "Sekolahian Worshiping Statuette",
	source : [["GoS", 229]],
	type : "wondrous item",
	rarity : "common",
	description : "Skillfully carved from sandstone, this 1-ft-tall statuette depicts a shark twisting through the water with its mouth open. Once per hour when a Tiny sea-dwelling animal is within 1 inch of the statuette's mouth, the shark flashes to life and deals 1 piercing damage to it.",
	descriptionFull : "Skillfully carved from sandstone, this 1-foot-tall statuette depicts a shark twisting through the water with its mouth open. If any Tiny sea-dwelling animal is within 1 inch of the statuette's mouth, the shark flashes to life and deals 1 piercing damage to it. The shark can deal damage in this way no more than once per hour."
}

// Creatures [Sea Lion removed, because it was completely rewritten as a monstrosity according to 2020 errata https://media.wizards.com/2020/dnd/downloads/GoS-Errata.pdf ]
CreatureList["fish"] = {
	name : "Fish",
	source : [["GoS", 215]],
	size : 5,
	type : "Beast",
	companion : "familiar",
	alignment : "Unaligned",
	ac : 13,
	hp : 1,
	hd : [1, 4],
	speed : "swim 40 ft",
	scores : [2, 16, 9, 1, 7, 2],
	senses : "Darkvision 60 ft",
	passivePerception : 8,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [],
	traits : [{
		name : "Water Breathing",
		description : "The fish can breathe only underwater."
	}]
}
CreatureList["giant white moray eel"] = {
	name : "Giant White Moray Eel",
	nameAlt : ["Eel, Giant White Moray"],
	source : [["GoS", 216]],
	size : 1,
	type : "Beast",
	alignment : "Unaligned",
	ac : 12,
	hp : 60,
	hd : [8, 12],
	speed : "swim 40 ft",
	scores : [19, 14, 12, 1, 10, 3],
	skills : {
		"perception" : 2,
		"stealth" : 4
	},
	senses : "Blindsight 10 ft",
	passivePerception : 12,
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [2, 6, "piercing"],
		range : "Melee (10 ft)",
		description : ""
	}],
	traits : [{
		name : "Water Breathing",
		description : "The eel can breathe only underwater."
	}]
}
CreatureList["giant coral snake"] = {
	name : "Giant Coral Snake",
	nameAlt : ["Snake, Giant Coral"],
	source : [["GoS", 236]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 90,
	hd : [12, 10],
	speed : "30 ft, swim 30 ft",
	scores : [12, 16, 14, 2, 10, 3],
	skills : {
		"perception" : 2
	},
	senses : "Blindsight 10 ft",
	passivePerception : 12,
	challengeRating : "4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [2, 4, "piercing"],
		range : "Melee (5 ft)",
		description : "Target DC 12 Con save or stunned until end of its next turn and short-term madness for 10 min"
	}]
}
CreatureList["giant sea eel"] = {
	name : "Giant Sea Eel",
	nameAlt : ["Eel, Giant Sea"],
	source : [["GoS", 237]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 14,
	hp : 19,
	hd : [3, 10],
	speed : "swim 40 ft",
	scores : [11, 14, 12, 2, 10, 7],
	saves : ["", 4, "", "", "", ""],
	skills : {
		"perception" : 2,
		"stealth" : 4
	},
	senses : "Darkvision 60 ft",
	passivePerception : 12,
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [2, 10, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Water Breathing",
		description : "The eel can breathe only underwater."
	}]
}

// pub_20190618_AcqInc.js
// This file adds all material from the Acquisitions Incorporated book to MPMB's Character Record Sheet

// Define the source
SourceList["AcqInc"] = {
	name : "Acquisitions Incorporated",
	abbreviation : "AcqInc",
	abbreviationSpellsheet : "AI",
	group : "Campaign Sourcebooks",
	campaignSetting : "Penny Arcade",
	url : "https://dnd.wizards.com/products/acquisitions-incorporated",
	date : "2019/06/18"
};

BackgroundList["celebrity adventurer's scion"] = {
	regExpSearch : /^(?=.*celebrity)(?=.*adventurer)(?=.*scion).*$/i,
	name : "Celebrity Adventurer's Scion",
	source : [["AcqInc", 48]],
	skills : ["Perception", "Performance"],
	gold : 30,
	equipleft : [
		["Disguise kit", "", 3]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [2],
	toolProfs : ["Disguise kit"],
	feature : "Name Dropping",
	trait : [
		"I will never get out of my famous parent's shadow, and no one else will ever understand this burden.",
		"I've seen enough of the adventuring life to have realistic expectations and empathy for my peers.",
		"Living up to my legacy will be difficult, but I'm going to do it.",
		"I'm used to the very best in life, and that's a hard habit to break.",
		"My parent taught me a sense of duty. I strive to uphold it, even when the odds are against me.",
		"No one can fake a smile, a handshake, or an interested nod like I can.",
		"I've been part of the adventuring life since I was old enough to walk. Let me explain a few things to you.",
		"No risk is too great for the rewards of defeating my enemies... and taking their stuff."
	],
	ideal : [
		["Power", "Power. The only way to get ahead in this world is to attain power and hold onto it with all your might. (Evil)"],
		["Peace", "Peace. Those who can find or make peace in the chaotic world around them have everything. (Lawful)"],
		["Fame", "Fame. I've seen what fame can bring. And I'll do anything to get all that for myself. (Neutral)"],
		["Training", "Training. Hard work, sacrifice, and training lead to success\u2014and eventually to perfection. (Any)"],
		["Anonymity", "Anonymity. I want to be successful. And alone. With lots of guards and wards between me and everyone else in the world. (Any)"],
		["Wisdom", "Wisdom. Material wealth is an illusion. Wisdom is the real treasure. (Good)"]
	],
	bond : [
		"While my parent was out adventuring, a servant raised me, and I care about that person more than anyone.",
		"I consider every member of my parent's former adventuring party to be family.",
		"Despite their absences, my famous parent was kind and generous. I love them and want to make them proud.",
		"My parent once brought a cursed magic item home. It is my obsession.",
		"My childhood home holds all my best memories, and its upkeep is my primary concern.",
		"Growing up, I had an imaginary friend I could always count on. That friend is still with me."
	],
	flaw : [
		"You don't know what I'm going through. You never can.",
		"You. Fetch my cloak. And maybe rub my feet for a while.",
		"My comrades are brave, but I must defeat this threat alone to prove my worth.",
		"Oh, yeah, that spell? Named after my parent's best friend. Let me tell you about them.",
		"My best days are behind me. Ahead lies only toil, pain, and death.",
		"You have to look out for yourself. No one else will."
	]
};
BackgroundFeatureList["name dropping"] = {
	description : "I know and have met any number of powerful people across the land, and some might even remember me. I might be able to wrangle minor assistance from a major figure in the campaign, at the DM's discretion. Additionally, the common folk treat me with deference, and my heritage and the stories I tell might be good for a free meal or a place to sleep.",
	source : [["AcqInc", 48]]
};

BackgroundList["failed merchant"] = {
	regExpSearch : /^(?=.*failed)(?=.*merchant).*$/i,
	name : "Failed Merchant",
	source : [["AcqInc", 49]],
	skills : ["Investigation", "Persuasion"],
	gold : 10,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Merchant's scale", "", 3]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : [["Artisan's tools", 1]],
	feature : "Supply Chain",
	trait : [
		"I didn't have the cutthroat attitude necessary to succeed. I won't make that mistake again.",
		"Even my competitors said I was affable and talented. Those traits should serve me well.",
		"To prosper, you have to be in control.",
		"The customer is always right.",
		"I was cutting corners and breaking deals to maximize profit. That's why I failed.",
		"When I get an idea, I am single-minded in its execution\u2014even if it's a terrible idea.",
		"If I can be everyone's friend, I'll always have support.",
		"My heart wasn't in being a merchant, so I failed. I'm not all that keen on adventuring either, but I need the money."
	],
	ideal : [
		["Survival", "Survival. Where there's life, there's hope. If I remain alive and flexible, I can succeed. (Any)"],
		["Generosity", "Generosity. People helped me when I was down. Now that I'm back on my feet, I'll pay it forward. (Good)"],
		["Excitement", "Excitement. Caution got me nowhere in my previous business. I'm not going to let it hold me back now. (Chaotic)"],
		["Wealth", "Wealth. With enough coin, I can buy comfort, power, knowledge, and even eternal life. Nothing will stand between me and money. (Evil)"],
		["Stability", "Stability. The mercantile trade was too chaotic for me. I need a nice stable profession, like adventuring. (Lawful)"],
		["Redemption", "Redemption. Too many people consider me a failure. So I need to prove them wrong. (Any)"]
	],
	bond : [
		"My family means everything to me. I failed them before, and I must not do so again.",
		"My church provides a connection to my god, so I must ensure that it is protected and funded.",
		"My former business partner fell ill, and then our business failed. Part of my new venture involves earning enough to take care of their family.",
		"If I take care of my possessions, they'll take care of me. People come and go, but a weapon or a wand is something you can always rely on.",
		"Although my business failed, the people of my community were kind to me. I'll do everything in my power to protect them.",
		"I owe a dangerous person a lot of money. As long as they're happy, they let my debt rest unpaid."
	],
	flaw : [
		"Why spend gold here when you can buy the same thing for copper in the next town?",
		"I must have the best of everything. Like, right now.",
		"You haven't heard of me? I'm sure that's because of your ignorance and low breeding.",
		"I failed, but I'm awesome. So when anyone else is successful, it must be because of nepotism, dishonesty, or dumb luck.",
		"I find that most people are trustworthy. Hey, where's my belt pouch?",
		"Nothing gets between me and danger except my fellow adventurers. So I'll be sure to put them there."
	]
};
BackgroundFeatureList["supply chain"] = {
	description : "From my time as a merchant, I retain connections with wholesalers, suppliers, and other merchants and entrepreneurs. I can call upon these connections when looking for items or information.",
	source : [["AcqInc", 49]]
};

BackgroundList["gambler"] = {
	regExpSearch : /gambler/i,
	name : "Gambler",
	source : [["AcqInc", 49]],
	skills : ["Deception", "Insight"],
	gold : 15,
	equipleft : [
		["Type of gaming set", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Lucky charm", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : [["Gaming set", 1]],
	feature : "Never Tell Me the Odds",
	trait : [
		"I plan for every contingency. Leave nothing to chance!",
		"Every copper wants to be a silver. Each bet is an opportunity.",
		"I'm one of Lady Luck's favored. Anything I try is destined to succeed.",
		"I've lost so much to gambling that I refuse to spend money on anything anymore.",
		"Nothing is certain. Planning is a coward's act.",
		"I can't be sure who I've swindled, cheated, or defeated, so I keep a low profile in public.",
		"The perfect bet is out there somewhere. I just have to keep my eyes open.",
		"I have beaten my addiction, but all it takes is one weak moment and I'll be back at the card table."
	],
	ideal : [
		["Knowledge", "Knowledge. Knowledge is power, and knowing which horse to back is the key to success. (Any)"],
		["Fate", "Fate. Whatever happens is fated, regardless of any planning or striving. (Lawful)"],
		["Bravery", "Bravery. If you want to succeed, you have to take risks. (Chaotic)"],
		["Survival", "Survival. You can't win if you're dead. Live to fight another day\u2014when the odds might be more in your favor. (Any)"],
		["Reliability", "Reliability. When I was in need, I was able to rely on others. Now I want to be the one others rely on. (Good)"],
		["Victory", "Victory. Winning is the real measure of a person. In the end, the only thing that matters is the scoreboard. (Evil)"]
	],
	bond : [
		"One person in particular owes me a lot of money, and I need to keep them alive if I want to be repaid.",
		"I'm loyal to the friend or family member who taught me how to gamble.",
		"The person who saved me from my gambling addiction is the only reason I'm alive today.",
		"A patron once fronted me money in exchange for a percentage of my winnings. I owe them a debt of gratitude. And a lot of cash.",
		"A criminal syndicate I once played for isn't happy I left the game, and its enforcers are looking for me.",
		"Urchins once helped me find marks for my games. Now I'm driven to help them escape the streets."
	],
	flaw : [
		"I don't know when to quit. Especially when everyone else is telling me to.",
		"I save my sympathy for my friends, and I have no friends.",
		"You think we're in trouble now? Let me tell you how bad things are likely to get!",
		"You can loan me a little, right? I've got a sure thing. I'll double your money, guaranteed.",
		"I was once a terribly flawed person, like you. Let me tell you how you can save yourself.",
		"I'm a great gambler. I'm just bad at math and logic."
	]
};
BackgroundFeatureList["never tell me the odds"] = {
	description : "Odds and probability are my bread and butter. During downtime activities that involve games of chance or figuring odds on the best plan, I can get a solid sense of which choice is likely the best one and which opportunities seem too good to be true, at the DM's determination.",
	source : [["AcqInc", 50]]
};

BackgroundList["plaintiff"] = {
	regExpSearch : /plaintiff/i,
	name : "Plaintiff",
	source : [["AcqInc", 50]],
	skills : ["Medicine", "Persuasion"],
	gold : 20,
	equipleft : [
		["Set of artisan's tools", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : [["Artisan's tools", 1]],
	feature : "Legalese",
	trait : [
		"I can't believe I have a chance to join Acquisitions Incorporated! The fun I'm going to have!",
		"I've been wronged my entire life, and the world owes me.",
		"I have always tried to make the best of a bad situation.",
		"The law doesn't protect the honest and the hard working. I'm going to do whatever needs to be done to make things right.",
		"I'm always in the wrong place at the wrong time.",
		"My superiors are smarter and wiser than I am. I do what I'm told.",
		"Never pass up the opportunity to make an easy bit of coin. That's my motto.",
		"I'm beginning to feel like the gods are not on my side."
	],
	ideal : [
		["Justice", "Justice. Those who break the law need to answer for their crimes. (Lawful)"],
		["Freedom", "Freedom. People must have the freedom to do what they want and pursue their dreams. (Chaotic)"],
		["Greed", "Greed. Everyone I see is getting theirs, so I'm surely going to get mine. (Evil)"],
		["Chaos", "Chaos. You're out of order! And you're out of order! This whole realm is out of order! (Chaotic)"],
		["Humility", "Humility. I'm just a small part of a larger whole. So is everyone else. (Neutral)"],
		["Responsibility", "Responsibility. We all have our roles to play. I'll hold up my end of the bargain. (Any)"]
	],
	bond : [
		"Others hurt in the same accident that hurt me are my new family. I'll make sure they're taken care of.",
		"The rulers of this place were kind to me, and they have my lifelong devotion.",
		"My parents worry about me, but I'll make them proud.",
		"The only bond that matters is the one holding my money pouch to my belt.",
		"The other new hires at Acquisitions Incorporated are my allies. We have each other's backs.",
		"My legal counsel is my best friend. I owe all my forthcoming opportunities to their hard work."
	],
	flaw : [
		"The person who gains the most reward for the least effort wins.",
		"Three magic beans for just one cow? What a deal!",
		"I have only one vice, but it controls my life.",
		"Sleep is for the weak. We need to keep training more if we're going to be ready for the challenges ahead.",
		"Until my songs are sung in every tavern in this realm, I won't be satisfied.",
		"If people find me unpleasant, that's their problem."
	]
};
BackgroundFeatureList["legalese"] = {
	description : "My experience with the local legal system has given me a firm knowledge of its ins and outs. Even when the law is not on my side, I can use complex terms like \"ex injuria jus non oritur\" to frighten people into thinking I know what I'm talking about. I might be able to intimidate or deceive folks who don't know any better to get favors or special treatment.",
	source : [["AcqInc", 50]]
};

BackgroundList["rival intern"] = {
	regExpSearch : /^(?=.*rival)(?=.*intern).*$/i,
	name : "Rival Intern",
	source : [["AcqInc", 51]],
	skills : ["History", "Investigation"],
	gold : 10,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Ledger from prev. employer", "", 3]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : [["Artisan's tools", 1]],
	feature : "Inside Informant",
	trait : [
		"My previous employer didn't respect me, and now I'll do whatever I can to gain respect.",
		"The job is important, but the relationships I forge with my coworkers are even more so.",
		"The job is everything to me. Who needs relaxation, hobbies, and a social life?",
		"I know I'm not the best and brightest, but if I put my best self forward, I can overcome anything.",
		"My former boss was an idiot. So was my boss before that. And before that. I'm sure those were all coincidences.",
		"This company is so much better than my previous one. It will always be the best until they stop paying me.",
		"I know this dagger belongs to the company, but I'm sure they won't miss it. Or this flask. Or this armor.",
		"It's only a matter of time before I'll be upper management. I just have to kiss up to my superiors and kick down those beneath me."
	],
	ideal : [
		["Advancement", "Advancement. Money and power can be gained more easily within an organization. I plan to gain as much as possible. (Evil)"],
		["Structure", "Structure. Life goes much more smoothly when you follow the rules and work within a system. (Lawful)"],
		["Uncertainty", "Uncertainty. The more chaos that swirls around me, the more opportunities I can find to profit. (Chaotic)"],
		["Justice", "Justice. I can't stand people being treated unjustly. I do whatever it takes to stop injustice and those who flout the law. (Lawful)"],
		["Pleasure", "Pleasure. What's the use of working hard and making money if you can't enjoy the finer things in life? (Any)"],
		["Power", "Power. Money is fine, but real power means never having to say you're sorry. (Evil)"]
	],
	bond : [
		"I have a family member in need. I consider them in everything I do.",
		"My peers keep me grounded.",
		"My past mistakes cost someone else dearly. I have to rectify that.",
		"A childhood mentor put me on my current path. If I succeed, I want to repay that mentor in some way.",
		"I value an oath of loyalty I took to a group of friends over everything else in my life.",
		"Although I don't get along well with people, my pet means the world to me."
	],
	flaw : [
		"I know what's best. Trust me.",
		"Flaw? I have no flaws. I'm perfect.",
		"My loyalties are... fluid.",
		"If anything goes wrong, it must be someone else's fault. Let me explain that in detail.",
		"There's right and there's wrong, and there's no gray area in between.",
		"Our superiors might not like what you're doing. I'm going to have to put that in my report."
	]
};
BackgroundFeatureList["inside informant"] = {
	description : "I have connections to my previous employer or other groups I dealt with during my previous employment. I can communicate with my contacts, gaining information at the DM's discretion.",
	source : [["AcqInc", 51]]
};

RaceList["verdan"] = {
	regExpSearch : /verdan/i,
	name : "Verdan",
	source : [["AcqInc", 74]],
	plural : "Verdan",
	size : 4, // small at 1st level, but medium from level 5+
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin", 1],
	skills : ["Persuasion"],
	savetxt : { text : ["Adv. on Wis/Cha saves"] },
	age : " reach adulthood at around the age of 24, and it is thought that they might live to nearly 200 years old. However, because no verdan has died of old age since the race's initial creation, their upper age limits remain subject to speculation.",
	height : " are between 3 and a half and 4 feet tall, plus 2 feet from 5th level onwards",
	heightMetric : " are between 100 and 120 cm tall, plus 60 cm from 5th level onwards",
	scores : [0, 0, 1, 0, 0, 2],
	trait : "Verdan (+1 Constitution, +2 Charisma)\nSudden Growth Spurt: At 5th level, I grow 2 ft, increasing my size from Small to Medium.\nBlack Blood Healing: When I roll a 1 or 2 on any HD I spend at the end of short rest, I can reroll the die and must use the new roll.\nLimited Telepathy: I can telepathically communicate simple ideas and straightforward concepts to a creature I can see within 30 ft, if it can understand at least one language.\nTelepathic Insight: I have advantage on Wisdom and Charisma saving throws.",
	features : {
		"sudden growth spurt" : {
			name : "Sudden Growth Spurt",
			minlevel : 5,
			eval : function () { PickDropdown("Size Category", 3); },
			removeeval : function () { PickDropdown("Size Category", 4); }
		}
	},
	advantages : [
		["Wisdom", true],
		["Charisma", true]
	]
}

SpellsList["distort value"] = {
	name : "Distort Value",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["AcqInc", 75]],
	level : 1,
	school : "Illus",
	time : "1 min",
	range : "Touch",
	components : "V",
	duration : "8 hours",
	description : "1 obj up to 1+1/SL cu ft doubles/halves in perceived value; Investigation vs. spell DC to see true value",
	descriptionFull : "Do you need to squeeze a few more gold pieces out of a merchant as you try to sell that weird octopus statue you liberated from the chaos temple? Do you need to downplay the worth of some magical assets when the tax collector stops by? Distort value has you covered.\n   You cast this spell on an object no more than 1 foot on a side, doubling the object's perceived value by adding illusory flourishes or polish to it, or reducing its perceived value by half with the help of illusory scratches, dents, and other unsightly features. Anyone examining the object can ascertain its true value with a successful Intelligence (Investigation) check against your spell save DC." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the maximum size of the object increases by 1 foot for each slot level above 1st."
};
SpellsList["fast friends"] = {
	name : "Fast Friends",
	classes : ["bard", "cleric", "wizard"],
	source : [["AcqInc", 75]],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "V",
	duration : "Conc, 1 h",
	save : "Wis",
	description : "1+1/SL humanoid save or charmed and perform tasks I ask it to do; adv. save if me/ally is fighting it",
	descriptionFull : "When you need to make sure something gets done, you can't rely on vague promises, sworn oaths, or binding contracts of employment. When you cast this spell, choose one humanoid within range that can see and hear you, and that can understand you. The creature must succeed on a Wisdom saving throw or become charmed by you for the duration. While the creature is charmed in this way, it undertakes to perform any services or activities you ask of it in a friendly manner, to the best of its ability.\n   You can set the creature new tasks when a previous task is completed, or if you decide to end its current task. If the service or activity might cause harm to the creature, or if it conflicts with the creature's normal activities and desires, the creature can make another Wisdom saving throw to try to end the effect. This save is made with advantage if you or your companions are fighting the creature. If the activity would result in certain death for the creature, the spell ends.\n   When the spell ends, the creature knows it was charmed by you." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, you can target one additional creature for each slot level above 3rd."
};
SpellsList["gift of gab"] = {
	name : "Gift of Gab",
	classes : ["bard", "wizard"],
	source : [["AcqInc", 76]],
	level : 2,
	school : "Ench",
	time : "1 rea",
	timeFull : "1 reaction, which you take when you speak to another creature",
	range : "Self",
	components : "V,S,R\u2020",
	compMaterial : "2 gp royalty component",
	duration : "Instantaneous",
	description : "Cast when talking, any crea within 5 ft think what I said in the last 6 seconds was only to cast a spell",
	descriptionFull : "Jim Darkmagic is said to have invented this spell, originally calling it 'I said what?!'. Have you ever been talking to the local monarch and accidentally mentioned how their son looks like your favorite hog from when you were growing up on the family farm? We've all been there! But rather than being beheaded for an honest slip of the tongue, you can pretend it never happened\u2014by ensuring that no one knows it happened.\n   When you cast this spell, you skillfully reshape the memories of listeners in your immediate area, so that each creature of your choice within 5 feet of you forgets everything you said within the last 6 seconds. Those creatures then remember that you actually said the words you speak as the verbal component of the spell."
};
SpellsList["incite greed"] = {
	name : "Incite Greed",
	classes : ["cleric", "warlock", "wizard"],
	source : [["AcqInc", 76]],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M\u0192",
	compMaterial : "A gem worth at least 50 gp",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "Any crea that see me save or charmed, only move to me, if in 5 ft do nothing; save end of each turn",
	descriptionFull : "When you cast this spell, you present the gem used as the material component and choose any number of creatures within range that can see you. Each target must succeed on a Wisdom saving throw or be charmed by you until the spell ends, or until you or your companions do anything harmful to it. While charmed in this way, a creature can do nothing but use its movement to approach you in a safe manner. While an affected creature is within 5 feet of you, it cannot move, but simply stares greedily at the gem you present.\n   At the end of each of its turns, an affected target can make a Wisdom saving throw. If it succeeds, this effect ends for that target."
};
SpellsList["jim's glowing coin"] = {
	name : "Jim's Glowing Coin",
	classes : ["wizard"],
	source : [["AcqInc", 76]],
	level : 2,
	school : "Ench",
	time : "1 a",
	range : "60 ft",
	components : "V,M,R\u2020",
	compMaterial : "A coin, and 2 gp royalty component",
	duration : "1 min",
	save : "Wis",
	description : "30-ft radius any creature I can see save or disadvantage on Perception and Initiative for duration",
	descriptionFull : "Of the many tactics employed by master magician and renowned adventurer Jim Darkmagic, the old glowing coin trick is a time-honored classic. When you cast the spell, you hurl the coin that is the spell's material component to any spot within range. The coin lights up as if under the effect of a light spell. Each creature of your choice that you can see within 30 feet of the coin must succeed on a Wisdom saving throw or be distracted for the duration. While distracted, a creature has disadvantage on Wisdom (Perception) checks and initiative rolls."
};
SpellsList["jim's magic missile"] = {
	name : "Jim's Magic Missile",
	classes : ["wizard"],
	source : [["AcqInc", 76]],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S,R\u2020",
	compMaterial : "1 gp royalty component per spell slot level used",
	duration : "Instantaneous",
	description : "3+1/SL darts, each spell atk for 2d4 Force dmg, 5d4 crit; any 1 to hit, all dmg me 1 (1+1/SL gp cons.)",
	descriptionShorter : "3+1/SL darts, atk 2d4 Force dmg, 5d4 crit; any 1 to hit, all dmg me 1 (1+1/SL gp cons.)",
	descriptionFull : "Any apprentice wizard can cast a boring old magic missile. Sure, it always strikes its target. Yawn. Do away with the drudgery of your grandfather's magic with this improved version of the spell, as used by Jim Darkmagic!\n   You create three twisting, whistling, hypoallergenic, gluten-free darts of magical force. Each dart targets a creature of your choice that you can see within range. Make a ranged spell attack for each missile. On a hit, a missile deals 2d4 force damage to its target.\n   If the attack roll scores a critical hit, the target of that missile takes 5d4 force damage instead of you rolling damage twice for a critical hit. If the attack roll for any missile is a 1, all missiles miss their targets and blow up in your face, dealing 1 force damage per missile to you." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the spell creates one more dart, and the royalty component increases by 1 gp, for each slot level above 1st.",
	dynamicDamageBonus : {
		multipleDmgMoments : true,
		extraDmgGroupsSameType : /((?:\+?\d+d?\d*)+)( crit)/i
	}
};
SpellsList["motivational speech"] = {
	name : "Motivational Speech",
	classes : ["bard", "cleric"],
	source : [["AcqInc", 77]],
	level : 3,
	school : "Ench",
	time : "1 min",
	range : "60 ft",
	components : "V",
	duration : "1 h",
	description : "5 crea that hear me 5+5/SL temp HP, adv. Wis saves, if hit adv. on next atk; stops when temp HP gone",
	descriptionFull : "You address allies, staff, or innocent bystanders to exhort and inspire them to greatness, whether they have anything to get excited about or not. Choose up to five creatures within range that can hear you. For the duration, each affected creature gains 5 temporary hit points and has advantage on Wisdom saving throws. If an affected creature is hit by an attack, it has advantage on the next attack roll it makes. Once an affected creature loses the temporary hit points granted by this spell, the spell ends for that creature." + AtHigherLevels + "At Higher Levels. When you cast this spell using a spell slot of 4th level or higher, the temporary hit points increase by 5 for each slot level above 3rd."
};

// Magic Item from the adventure
MagicItemsList["piercer"] = {
	name : "Piercer",
	source : [["AcqInc", 121]],
	type : "weapon (shortsword)",
	rarity : "rare",
	description : "I gain a +1 bonus to attack and damage rolls made with this magical shortsword. I regain the maximum possible number of hit points from expended Hit Dice. However, I must eat twice as much food each day to avoid exhaustion, a minimum of 2 lb.",
	descriptionFull : "You have a +1 bonus to attack and damage rolls made with this magic weapon.\n   A character attuned to the sword regains the maximum possible number of hit points from expended Hit Dice. However, the attuned character must eat twice as much food each day (a minimum of 2 pounds) to avoid exhaustion (see \"The Environment\" in chapter 8 of the Player's Handbook.)",
	attunement : true,
	weight : 3,
	weaponOptions : [{
		baseWeapon : "shortsword",
		regExpSearch : /piercer/i,
		name : "Piercer",
		source : [["AcqInc", 121]],
		modifiers : [1, 1],
		selectNow : true
	}]
};

// pub_20190917_DiA.js
// This file adds all material from the Baldur's Gate: Descent into Avernus adventure to MPMB's Character Record Sheet

// Define the source
SourceList["DiA"] = {
	name : "Baldur's Gate: Descent into Avernus [background, items]",
	abbreviation : "DiA",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/baldurs-gate-descent-into-avernus",
	date : "2019/09/17"
};

BackgroundList["faceless"] = {
	regExpSearch : /faceless/i,
	name : "Faceless",
	source : [["DiA", 203]],
	skills : ["Deception", "Intimidation"],
	gold : 10,
	languageProfs : [1],
	toolProfs : ["Disguise kit"],
	equipleft : [
		["Disguise kit", "", 3]
	],
	equipright : [
		["Costume", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Dual Personalities",
	trait : [
		"I'm earnest and uncommonly direct.",
		"I strive to have no personality\u2014it's easier to forget what's hardly there.",
		"I treasure a memento of the person or instance that set me upon my path.",
		"I sleep just as much as I need to and on an unusual schedule.",
		"I think far ahead, a detachedness often mistaken for daydreaming.",
		"I cultivate a single obscure hobby or study and eagerly discuss it at length.",
		"I am ever learning how to be among others\u2014when to stay quiet, when to laugh.",
		"I behave like an extreme opposite of my persona."
	],
	ideal : [
		["Justice",
			"Justice. Place in society shouldn't determine one's access to what is right. (Good)"
		],
		["Security",
			"Security. Doing what must be done can't bring the innocent to harm. (Lawful)"
		],
		["Confusion",
			"Confusion. Deception is a weapon. Strike from where your foes won't expect. (Chaotic)"
		],
		["Infamy",
			"Infamy. My name will be a malediction, a curse that fulfills my will. (Evil)"
		],
		["Incorruptibility",
			"Incorruptibility. Be a symbol, and leave your flawed being behind. (Any)"
		],
		["Anonymity",
			"Anonymity. It's my deeds that should be remembered, not their instrument. (Any)"
		]
	],
	bond : [
		"I do everything for my family. My first thought is keeping them safe.",
		"What I do, I do for the world. The people don't realize how much they need me.",
		"I've seen too many in need. I must not fail them as everyone else has.",
		"I stand in opposition, lest the wicked go unopposed.",
		"I am exceptional. I do this because no one else can, and no one can stop me.",
		"I do everything for those who were taken from me."
	],
	flaw : [
		"I am callous about death. It comes to us all eventually.",
		"I never make eye contact or hold it unflinchingly.",
		"I have no sense of humor. Laughing is uncomfortable and embarrassing.",
		"I overexert myself, sometimes needing to recuperate for a day or more.",
		"I think far ahead, a detachedness often mistaken for daydreaming.",
		"I see morality entirely in black and white."
	],
	extra : [
		"Select a Faceless Persona",
		"Flamboyant spy or brigand",
		"Incarnation of nation or people",
		"Scoundrel with masked guise",
		"Vengeful spirit",
		"Manifestation of deity or faith",
		"Beauty accented with makeup",
		"Impersonation of another hero",
		"Embodiment of a school of magic",
		"Warrior with distinctive armor",
		"Fear-inspiring monstrous disguise"
	]
};
BackgroundFeatureList["religious community"] = {
	description : "I'm tightly connected with the religious community of the city. I know if a deity has a following in the city, any places that faith openly congregates, and the neighborhoods those faithful typically inhabit. While this isn't remarkable for most of the city's larger faiths, keeping track of the hundreds of religions newcomers bring with them is no mean feat.",
	source : [["DiA", 202], ["ALbackground", 0]]
};
BackgroundFeatureList["long-lost heir"] = {
	description : "I can pose as the long-lost heir to some imaginary or dead lineage. I'm well-versed in the mannerisms and idiosyncrasies of nobility, imitating them smoothly enough to convince anybody of my authenticity. However, any true test is likely to reveal my deception. I can enter places that only nobility can and might be able to bluff other through with me.",
	source : [["DiA", 202], ["ALbackground", 0]]
};
BackgroundFeatureList["criminal connections"] = {
	description : "In a big city, crime is just another business. As a result, I can arrange a meeting with a low-ranking operative of nearly any business, noble family, crew, government institution, or guild. This operative will hear me out and, at their discretion, take my information or request up their chain of command. These meetings almost always occur in shady venues.",
	source : [["DiA", 202], ["ALbackground", 0]]
};
BackgroundFeatureList["backstage pass"] = {
	description : "I know that most of the real business, in entertainment or otherwise, happens behind the scenes. It's easy for me to case what sorts of audiences attend a venue. After a successful performance, I may meet an enthusiastic member of the crowd\u2014someone of an occupation or social class that frequents the venue, who is delighted to talk with me, and to listen.",
	source : [["DiA", 202], ["ALbackground", 0]]
};
BackgroundFeatureList["dual personalities"] = {
	description : "The world knows me as my persona and those who seek to learn more about me find themselves stymied by my disguise. I'm unidentifiable as my true self while disguised and behaving as my persona, allowing me to change appearances between my two personalities as I wish. My deception might lose its effectiveness if someone realize the connection.",
	source : [["DiA", 204], ["ALbackground", 0]]
};
BackgroundFeatureList["social vengeance"] = {
	description : "I've lived my whole life amongst the lower class of the city, seeing the upper class flaunt their wealth while my hardworking neighbors struggled. I know their eagerness to give the wealthy their comeuppance. I can convince 1d6 commoners in a busy area in 2d10 min" + (typePF ? "utes" : "") + " to perform a non-illegal act that inconveniences a guard, noble, or wealthy looking individual.",
	source : [["DiA", 204], ["ALbackground", 0]]
};
BackgroundFeatureList["professional courtesy"] = {
	description : "I conduct my business in one of the city's districts and I'm familiar with its local crews, their territories, and inter-crew politics. When I need information about something in my district, I can learn the local gossip from crew members. Within my district, I can gain entry to nearly any bank, guild hall, place of business, workhouse, or crew meeting place.",
	source : [["DiA", 205], ["ALbackground", 0]]
};
BackgroundFeatureList["the real city"] = {
	description : "I know the city that most of its inhabitants ignore, the dog-eat-dog world of the homeless and unfortunate. I know where to go for anonymity. In these slums and alley camps, I can get a damp bed and a bad meal, but also a degree of privacy and no questions asked. Living here isn't comfortable, but it's unlikely any will find me\u2014and I can stay as long as I want.",
	source : [["DiA", 205], ["ALbackground", 0]]
};
BackgroundFeatureList["patriar"] = {
	description : "As a member of an elite family of the city, I may pass through without paying tolls, enter the better part of town and stay there after dark, mingle among the nobility unquestioned, and impress those looking for wealthy patrons. My word is accepted over others' without question, and any corruption among guards or officials tends to work in my favor.",
	source : [["DiA", 206], ["ALbackground", 0]]
};
BackgroundFeatureList["immigrant experience"] = {
	description : "Even after my short time in the city, I've learned it holds more walls and gates than those the guards patrol. I'm known within the city's immigrant communities. Should I ever need to learn about a foreign land, people, tradition, or history, I know where to find someone with firsthand experience\u2014likely somewhere in the poorer part of town.",
	source : [["DiA", 206], ["ALbackground", 0]]
};
BackgroundFeatureList["rumor monger"] = {
	description : "Via my personal rumor mill and published articles, I can surmise a great deal about the secrets of the city's inhabitants\u2014necromancy, spying, smuggling, dealing in magical wares. Whenever a noteworthy crime or happening occurs in the city, I immediately have a list of 1d4 suspects who, if they aren't involved, have a strong chance of knowing who is.",
	source : [["DiA", 206], ["ALbackground", 0]]
};
BackgroundFeatureList["smuggler's sense"] = {
	description : "I'm familiar with the docks of the city, the movement of inspectors and tax collectors, the way cargo and coin flows, the movements of the harbor guards, and how to operate the port's machinery for moving wares. As a result, it's easy for me to hustle a load of cargo ashore or see such a cargo onto a cooperative ship without attracting suspicion or taxation.",
	source : [["DiA", 207], ["ALbackground", 0]]
};
BackgroundFeatureList["city guard: lower city (the flaming fists)"] = {
	description : "I'm required to take a regular shift patrolling the lower or outer city and I must report for training once every ten days. In return, I have access to the guard's fortresses and a direct line of communication with officers and other soldiers. I can also pass through the city's gates and go to the upper city without question, but can't bring guests to the upper city.",
	source : [["DiA", 207], ["ALbackground", 0]]
};
BackgroundFeatureList["city guard: upper city (the watch)"] = {
	description : "I'm required to take a regular shift patrolling the upper city or its gates and I must report for training once every ten days. In return, I have access to the citadel and a direct line of communication with officers and officials. My word carries considerable weight. I can escort people into the upper city unimpeded, but I'm regarded with suspicion in the lower city.",
	source : [["DiA", 207], ["ALbackground", 0]]
};
BackgroundFeatureList["loyalty test"] = {
	description : "I can spot the behaviors common to corrupt guards and military officers a mile away. While this doesn't equate to evidence, and my sense isn't foolproof, my instinct proves a starting point to determine who might take a bribe, who might turn a blind eye to a crime, who might have criminal connections, or who might fulfill their duties strictly by the book.",
	source : [["DiA", 207], ["ALbackground", 0]]
};
BackgroundFeatureList["gateguide connection"] = {
	description : "I've associated with enough of the Gateguides crew that I know their torch-based code. From the lighting, placement, and type of torch arranged on or near a structure, I can gather information about those who live or do business there\u2014if they deal fairly with strangers, have guild or government connections, or their standing with the Gateguides.",
	source : [["DiA", 207], ["ALbackground", 0]]
};

// Creatures
// Peacock is just a vulture under a different name, it has been added to the SRD code as a `nameAlt`
CreatureList["abyssal chicken"] = {
	name : "Abyssal Chicken",
	nameAlt : ["Chicken, Abyssal"],
	source : [["DiA", 97]],
	size : 5,
	type : "Fiend",
	subtype : "demon",
	companion : "familiar_not_al",
	alignment : "Chaotic Evil",
	ac : 13,
	hp : 10,
	hd : [3, 4],
	speed : "30 ft, fly 30 ft",
	scores : [6, 14, 13, 4, 9, 5],
	damage_resistances : "cold, fire, lightning",
	damage_immunities : "poison",
	condition_immunities : "blinded, poisoned",
	senses : "Blindsight 30 ft (blind beyond this radius)",
	passivePerception : 9,
	languages : "understands Abyssal but can't speak",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)",
		description : "One bite and one claws attack as an Attack action"
	}, {
		name : "Claws",
		ability : 2,
		damage : [1, 6, "piercing"],
		range : "Melee (5 ft)",
		description : "One claws and one bite attack as an Attack action"
	}],
	actions : [{
		name : "Multiattack",
		description : "The abyssal chicken makes two attacks: one with its bite and one with its claws."
	}],
	traits : [{
		name : "Bad Flier",
		description : "The abyssal chicken falls at the end of a turn if it's airborne and the only thing holding it aloft is its flying speed."
	}]
}

MagicItemsList["candle mace"] = { // contributed by Nod_Hero
	name : "Candle Mace",
	source : [["DiA", 39]],
	type : "weapon (mace)",
	rarity : "uncommon",
	description : "This mace adds a +1 bonus to attack and damage rolls made with it. The head of this mace sheds bright light in a 5-ft radius and dim light for an additional 5 ft. As an action when I wield this mace, I can extinguish or ignite its light.",
	descriptionFull : "This +1 mace was made for a cleric of Lathander, the god of dawn. The head of this mace sheds bright light in a 5-foot-radius and dim light for an additional 5 feet. When you wield this mace, you can extinguish or ignite its light as an action.",
	weight : 4,
	action : [["action", " (on/off)"]],
	weaponOptions : [{
		baseWeapon : "mace",
		regExpSearch : /^(?=.*candle)(?=.*mace).*$/i,
		name : "Candle Mace",
		source : [["DiA", 39]],
		modifiers : [1, 1],
		selectNow : true
	}]
}
MagicItemsList["battle standard of infernal power"] = {
	name : "Battle Standard of Infernal Power",
	source : [["DiA", 223]],
	type : "wondrous item",
	rarity : "very rare",
	description : "While holding the banner, my weapon attacks and those of my allies within 300 ft of me count as magical for the purposes of overcoming damage immunities and resistances. The standard has a small unopenable cage with an incapacitated quasit within. It turns to smoke if killed or released and a new one appears.",
	descriptionLong : "While holding the banner, my weapon attacks and those of my allies within 300 ft of me count as magical for the purposes of overcoming damage immunities and resistances.\nThis hell-forged battle standard is made of infernal iron and fitted with a small, unopenable cage containing a quasit. The trapped quasit is incapacitated, and its cage has AC 19, 10 hit points, and immunity to all types of damage except force damage. If killed or somehow released, the quasit disappears in a cloud of smoke, and a new one appears in the cage, provided the cage is intact.",
	descriptionFull : "This hell-forged battle standard is made of infernal iron and fitted with a small, unopenable cage containing a quasit. The trapped quasit is incapacitated, and its cage has AC 19, 10 hit points, and immunity to all types of damage except force damage. If killed or somehow released, the quasit disappears in a cloud of smoke, and a new one appears in the cage, provided the cage is intact.\n   While you hold the banner, your weapon attacks and those of all allied creatures within 300 feet of you count as magical for the purposes of overcoming damage immunities and resistances.",
	attunement : true,
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.isSpell && !v.thisWeapon[1] && !v.theWea.isMagicWeapon && !(/counts as( a)? magical/i).test(fields.Description)) {
					fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
				};
			},
			"My weapon attacks count as magical for overcoming resistances and immunities."
		]
	}
}
MagicItemsList["gauntlets of flaming fury"] = {
	name : "Gauntlets of Flaming Fury",
	source : [["DiA", 223]],
	type : "wondrous item",
	rarity : "rare",
	description : "While wearing both these steel gauntlets, any weapons I grasp with them count as magical. As a bonus action once per dawn, I can use them to envelop one or two melee weapons in my grasp with magical flames, causing them to deal an extra 1d6 fire damage on a hit. This lasts until I sheathe or let go of a weapon.",
	descriptionFull : "While you wear both of these steel gauntlets, any non- magical weapon you grasp with either gauntlet is treated as a magic weapon. As a bonus action, you can use the gauntlets to cause magical flames to envelop one or two melee weapons in your grasp. Each flaming weapon deals an extra 1d6 fire damage on a hit. The flames last until you sheathe or let go of either weapon. Once used, this property can't be used again until the next dawn.",
	attunement : true,
	action : [["bonus action", ""]],
	usages : 1,
	recovery : "dawn",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.isSpell && !v.isNaturalWeapon && !v.thisWeapon[1] && !v.theWea.isMagicWeapon && !(/dancing|counts as( a)? magical/i).test(fields.Description)) {
					fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
				};
			},
			"Any nonmagical weapons that I grasp with my Gauntlets of Flaming Fury count as magical for overcoming resistances and immunities."
		]
	}
}
MagicItemsList["fane-eater"] = {
	name : "Fane-Eater",
	source : [["DiA", 223]],
	type : "weapon (battleaxe)",
	rarity : "legendary",
	description : "This battleaxe adds a +3 bonus to attack and damage rolls made with it. When I use it to attack a creature and roll a 20 on the attack roll, the creature takes an extra 2d8 necrotic damage, and I regain a number of hit points equal to the necrotic damage taken.",
	descriptionFull : "Fane-Eater is a battleaxe belonging to Arkhan the Cruel.\n   You gain a +3 bonus to attack and damage rolls with Fane-Eater. If you attack a creature with this weapon and roll a 20 on the attack roll, the creature takes an extra 2d8 necrotic damage, and you regain a number of hit points equal to the necrotic damage taken.",
	attunement : true,
	prerequisite : "Requires attunement by an evil cleric or paladin",
	prereqeval : function(v) { return (classes.known.paladin || classes.known.cleric) && (/evil/i).test(What("Alignment")); },
	weight : 4,
	weaponOptions : [{
		baseWeapon : "battleaxe",
		regExpSearch : /fane-eater/i,
		name : "Fane-Eater",
		source : [["DiA", 223]],
		description : "Versatile (1d10); On 20 to hit: +2d8 necrotic damage and I heal same amount",
		selectNow : true
	}]
}
MagicItemsList["hellfire weapon"] = {
	name : "Hellfire Weapon",
	nameTest : "Hellfire",
	source : [["DiA", 223]],
	type : "weapon (any)",
	rarity : "uncommon",
	description : "This weapon is fashioned from infernal iron and traced with veins of hellfire that shed dim light in a 5-ft radius. Any humanoid killed by an attack made with this weapon has its soul funneled into the River Styx, where it's reborn instantly as a lemure devil.",
	descriptionFull : "This weapon is fashioned from infernal iron and traced with veins of hellfire that shed dim light in a 5-foot-radius.\n   Any humanoid killed by an attack made with this weapon has its soul funneled into the River Styx, where it's reborn instantly as a lemure devil.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "weapon"]
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && (/hellfire/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Humanoids killed lose their soul';
				}
			},
			'If I include the word "Hellfire" in a the name of a weapon, it will be treated as the magic weapon Hellfire Weapon. Any humanoid killed by the weapon has its soul funneled into the River Styx, and are instantly reborn as a lemure devil.'
		]
	}
}
MagicItemsList["helm of devil command"] = {
	name : "Helm of Devil Command",
	source : [["DiA", 223]],
	type : "wondrous item",
	rarity : "very rare",
	description : "This helm has 3 charges, regaining all 24 h after using the last. I can use 1 charge to cast Dominate Monster on a devil, but it knows I tried to charm it. It allows me to know the exact location of all devils within 1000 ft and I can telepathically communicate with one of them at a time, or broadcast my thoughts to all.",
	descriptionLong : "This bulky, eyeless helmet resizes to fit my head and allows me to see out of it as if I was not wearing it. It has 3 charges, regaining all 24 hours after using the last charge. I can use 1 charge to cast Dominate Monster on a devil, but if it can see me do so, the devil knows I tried to charm it. The helm also allows me to know the exact location of all devils within 1000 ft and I can telepathically communicate with one of them at a time, or broadcast my thoughts to all within range, but they have no special means of replying. If I use its dominating power while I'm on the Nine Hells, there is a chance it attracts a narzugon.",
	descriptionFull : "This bulky, eyeless helmet is made for a pit fiend but magically resizes to fit the heads of other wearers.\n   While wearing the helm, you can see out of it as though you weren't wearing it. In addition, you know the exact location and type of all devils within 1,000 feet of you. You can telepathically communicate with a devil within range, or you can broadcast your thoughts to all devils within range. The devils receiving your broadcasted thoughts have no special means of replying to them.\n   The helm has 3 charges. As an action, you can expend 1 charge to cast dominate monster (save DC 21), which affects devils only. (The spell fails and the charge is wasted if you target any creature that's not a devil.) If a devil can see you when you cast this spell on it, the devil knows you tried to charm it. The helm regains all its charges 24 hours after its last charge is expended.\n   If you are not a devil, using the helm's dominate monster property in the Nine Hells has a 20 percent chance of attracting a narzugon, which arrives on the back of a nightmare mount in 1d4 hours. The narzugon tries to recover the helm, killing you if necessary to obtain it. If it gets the helm, the narzugon tries to deliver it to its infernal master.",
	attunement : true,
	prerequisite : "Requires attunement by a creature that can speak infernal",
	prereqeval : function(v) { return (/infernal/i).test(v.languageProfs); },
	usages : 3,
	recovery : "Special",
	fixedDC : 21,
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : 1
	},
	spellChanges : {
		"dominate monster" : {
			description : "Devil save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect a devil."
		}
	}
}
MagicItemsList["infernal puzzle box"] = {
	name : "Infernal Puzzle Box",
	source : [["DiA", 224]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "This cube-shaped container is around 15 cm on a side and is composed of airtight, interlocking parts. It can't be magically opened and is immune to all damage. I can figure out how to open it in 1 hour with a DC 30 Investigation check. If failed by 5 or more, I take 12d6 psychic damage, Wis DC 18 halves.",
	descriptionLong : "This cube-shaped container is around 15 cm on a side and is composed of airtight, interlocking parts made from materials found in the Nine Hells. It can't be magically opened and is immune to all damage while shut. Every infernal puzzle box has an unique mundane way of opening it. I can figure out how to open this box in 1 hour with a DC 30 Investigation check, but if I fail this check by 5 or more, I take 12d6 psychic damage, Wisdom save DC 18 halves. Once I figure out the trick or sequence of steps needed to open this box, I can open it as an action, allowing access to the box's contents.",
	descriptionFull : "An infernal puzzle box is a cube-shaped container 5 to 6 inches on a side, composed of airtight, interlocking parts made from materials found in the Nine Hells. Most of these boxes are made of infernal iron, though some are carved from bone or horn. Infernal puzzle boxes are used to safeguard diabolical contracts signed between devils and mortals, even after the terms of these contracts are fulfilled. An empty infernal puzzle box weighs 3 pounds regardless of the materials used to fashion it.\n   When an object small enough to fit inside an infernal puzzle box is placed in it, the container magically seals shut around the object, and no magic can force the box open. The sealed box becomes immune to all damage as well. Every infernal puzzle box is constructed with a unique means of opening it. The trick to solving the puzzle is always mundane, never magical. Once a creature figures out the trick or sequence of steps needed to open a particular infernal puzzle box, that creature can open the box as an action, allowing access to the box's contents.\n   A creature that spends 1 hour holding an infernal puzzle box while trying to open it can make a DC 30 Intelligence (Investigation) check. If the check succeeds, the creature figures out the trick or sequence of steps needed to open the box. If the check fails by 5 or more, the creature must make a DC 18 Wisdom saving throw, taking 42 (12d6) psychic damage on a failed save, or half as much damage on a successful one.",
	weight : 3
}
MagicItemsList["matalotok"] = {
	name : "Matalotok",
	source : [["DiA", 224]],
	type : "weapon (warhammer)",
	rarity : "legendary",
	description : "This ancient warhammer, the Frost Father, was fashioned by Thrym. It is frigid to the touch and wreathed in mist. I'm immune to cold damage while holding it. Whenever I deal damage to a creature with it, it radiates a burst of intense cold in a 30-ft radius sphere, dealing 3d6 cold damage to all creatures within.",
	descriptionFull : "Matalotok, the Frost Father, is an ancient hammer fashioned by Thrym, the god of frost giants. The favored weapon of the demon lord Kostchtchie, Matalotok is frigid to the touch and wreathed in mist.\n   You are immune to cold damage while holding Matalotok. Whenever it deals damage to a creature, the hammer radiates a burst of intense cold in a 30-foot-radius sphere. Each creature in that area takes 10 (3d6) cold damage.",
	attunement : true,
	weight : 2,
	weaponOptions : [{
		baseWeapon : "warhammer",
		regExpSearch : /matalotok/i,
		name : "Matalotok",
		source : [["DiA", 224]],
		description : "Versatile (1d10); On hit: all in 30-ft radius take 3d6 cold damage",
		selectNow : true
	}],
	savetxt : { immune : ["cold"] }
}
MagicItemsList["obsidian flint dragon plate"] = {
	name : "Obsidian Flint Dragon Plate",
	source : [["DiA", 224]],
	type : "armor (plate)",
	rarity : "legendary",
	description : "I gain a +2 bonus to AC and resistance to poison damage while I wear this plate armor. In addition, I gain advantage on ability checks and saving throws made to avoid or end the grappled condition on myself.",
	descriptionFull : "You gain a +2 bonus to AC and resistance to poison damage while you wear this armor. In addition, you gain advantage on ability checks and saving throws made to avoid or end the grappled condition on yourself.",
	armorOptions : [{
		regExpSearch : /^(?=.*obsidian)(?=.*flint)(?=.*dragon)(?=.*plate).*$/i,
		name : "Obsidian Flint Dragon Plate",
		source : [["DiA", 224]],
		type : "heavy",
		ac : "18+2",
		stealthdis : true,
		weight : 65,
		strReq : 15,
		selectNow : true
	}],
	dmgres : ["Poison"],
	savetxt : { adv_vs : ["grappled"] },
	weight : 65
}
var DiA_shieldOfTheHiddenLordFullDescription = [
	"The Shield of the Hidden Lord is of celestial origin and serves as a prison for the pit fiend Gargauth, whose mortal followers revere it as a god. Over time, Gargauth's evil has warped the shield's appearance, so that its celestial motif and designs have become twisted into a fiendish face that subtly moves in disturbing ways.",
	"While holding this shield, you gain a +2 bonus to AC and resistance to fire damage.",
	">>Sentience<<. The Shield of the Hidden Lord is sentient as long as it imprisons Gargauth. While sentient, the shield has the following properties:",
	"\u2022 The shield has an Intelligence of 22, a Wisdom of 18, and a Charisma of 24, as well as hearing and truesight out to a range of 120 feet.",
	"\u2022 The shield can speak, read, and understand Common and Infernal, and it can communicate telepathically with any creature it can sense within 120 feet of it. Its voice is a deep, hollow whisper.",
	"\u2022 The shield has 3 charges. You can use an action to expend 1 charge to cast Fireball or 2 charges to cast Wall of Fire from the shield (save DC 21 for each). The Wall of Fire spell lasts for 1 minute (no concentration required). The shield regains all expended charges daily at dawn.",
	"\u2022 Anytime during your turn, the shield can choose to radiate an aura of dread for 1 minute. (This is not a power of the shield that you control.) Any creature hostile to you that starts its turn within 20 feet of the shield must make a DC 18 Wisdom saving throw. On a failed save, the creature is frightened until the start of its next turn. On a successful save, the creature is immune to this power of the shield for the next 24 hours. Once the shield uses this power, it can't use it again until the next dawn.\n",
	">>Gargauth's Personality<<. Gargauth desperately seeks freedom but can't escape on its own. The pit fiend won't reveal its true nature, referring to itself only as the Hidden Lord. It drops hints and subtle suggestions that it is an angel trapped in an unholy prison. If released from the shield, the pit fiend honors the terms of whatever bargain it struck to facilitate its escape.",
	"While trapped in the shield, Gargauth carefully steers the shield's current owner toward committing acts of cruelty and domination, hoping to condemn the individual's soul to the Nine Hells. Conflict occurs if the shield's owner does anything that would make it more difficult for Gargauth to escape its prison, such as leaving the shield in a place where others are unlikely to find it.",
	"Gargauth doesn't know how to escape from the shield. The pit fiend believes (incorrectly) that it can break free of the shield if it's brought to the Nine Hells, for it's convinced that the shield's powers are weaker there.",
	">>Freeing Gargauth<<. Casting dispel evil and good on the shield has a 1 percent chance of freeing the pit fiend, or automatically succeeds if the spell is cast by a solar, a planetar, or an archdevil. A god can release the pit fiend by touching the shield and speaking Gargauth's name. When released, Gargauth appears in a random, unoccupied space as close to the shield as possible."
];
MagicItemsList["shield of the hidden lord"] = {
	name : "Shield of the Hidden Lord",
	source : [["DiA", 225]],
	type : "shield",
	rarity : "legendary",
	storyItemAL : true,
	description : "This shield grants me +2 bonus to AC and resistance to fire damage. It has 3 charges, regaining all at dawn. I can expend 1 charge to cast Fireball or 2 charges to cast Wall of Fire from it at DC 21. The shield is sentient and can communicate telepathically with any creature within 120 ft of it. See \"Notes\" page for more.",
	descriptionFull : DiA_shieldOfTheHiddenLordFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	toNotesPage : [{
		name : "Features",
		note : desc(DiA_shieldOfTheHiddenLordFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(to) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	weight : 6,
	shieldAdd : ["Shield of the Hidden Lord", 4, 6],
	usages : 3,
	recovery : "Dawn",
	fixedDC : 21,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["fireball"],
		selection : ["fireball"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["wall of fire"],
		selection : ["wall of fire"],
		firstCol : 2
	}],
	spellChanges : {
		"wall of fire" : {
			duration : "1 min",
			changes : "The Wall of Fire lasts for 1 minute and does not require concentration."
		}
	}
}
var DiA_soulCoinFullDescription = [
	"Soul coins are about 5 inches across and about 1 inch thick, minted from infernal iron. Each coin weighs one-third of a pound, and is inscribed with Infernal writing and a spell that magically binds a single soul to the coin. Because each soul coin has a unique soul trapped within it, each has a story. A creature might have been imprisoned as a result of defaulting on a deal, while another might be the victim of a night hag's curse.",
	">>Carrying Soul Coins<<. To hold a soul coin is to feel the soul bound within it\u2014overcome with rage or fraught with despair.",
	"An evil creature can carry as many soul coins as it wishes (up to its maximum weight allowance). A non-evil creature can carry a number of soul coins equal to or less than its Constitution modifier without penalty. A non-evil creature carrying a number of soul coins greater than its Constitution modifier has disadvantage on its attack rolls, ability checks, and saving throws.",
	">>Using a Soul Coin<<. A soul coin has 3 charges. A creature carrying the coin can use its action to expend 1 charge from a soul coin and use it to do one of the following:",
	"\u2022 >>Drain Life<<. You siphon away some of the soul's essence and gain 1d10 temporary hit points.",
	"\u2022 >>Query<<. You telepathically ask the soul a question and receive a brief telepathic response, which you can understand. The soul knows only what it knew in life, but it must answer you truthfully and to the best of its ability. The answer is no more than a sentence or two and might be cryptic.\n",
	">>Freeing a Soul<<. Casting a spell that removes a curse on a soul coin frees the soul trapped within it, as does expending all of the coin's charges. The coin itself rusts from within and is destroyed once the soul is released. A freed soul travels to the realm of the god it served or the outer plane most closely tied to its alignment (DM's choice). The souls of lawful evil creatures released from soul coins typically emerge from the River Styx as lemure devils.",
	"A soul can also be freed by destroying the coin that contains it. A soul coin has AC 19, 1 hit point for each charge it has remaining, and immunity to all damage except that which is dealt by a hellfire weapon or an infernal war machine's furnace.",
	"Freeing a soul from a soul coin is considered a good act, even if the soul belongs to an evil creature.",
	">>Hellish Currency<<. Soul coins are a currency of the Nine Hells and are highly valued by devils. The coins are used among the infernal hierarchy to barter for favors, bribe the unwilling, and reward the faithful for services rendered.",
	"Soul coins are created by Mammon and his greater devils on Minauros, the third layer of the Nine Hells, in a vast chamber where the captured souls of evil mortals are bound into the coins. These coins are then distributed throughout the Nine Hells to be used for goods and services, infernal deals, dark bargains, and bribes."
];
MagicItemsList["soul coin"] = {
	name : "Soul Coin",
	source : [["DiA", 225], ["CoA", 269]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "Each coin traps a unique soul, whose rage or despair is felt by me while I hold it. A coin has 3 charges. As an action, I can expend 1 charge to either siphon the soul's essence to grant me 1d10 temporary HP or telepathically ask the soul a question which it must answer truthfully. See \"Notes\" page for more.",
	descriptionFull : DiA_soulCoinFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : desc(DiA_soulCoinFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(answer) you/ig, "$1 me").replace(/you /ig, "I ")
	}],
	weight : 0.3,
	usages : 3,
	recovery : "Never",
	action : [["action", ""]]
}

// pub_20190919_LR.js
// This file adds the Locathah from the Locathah Rising adventure from Extra Life to MPMB's Character Record Sheet

SourceList.LR = {
	name : "Locathah Rising",
	abbreviation : "LR",
	group : "Extra Life",
	url : "https://www.dmsguild.com/product/289261/Locathah-Rising-5e",
	date : "2019/09/19",
	defaultExcluded : true
};

RaceList.locathah = {
	source : [["LR", 24]],
	regExpSearch : /locathah/i,
	name : "Locathah",
	plural : "Locathah",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 },
	},
	languageProfs : ["Common", "Aquan"],
	savetxt : {
		adv_vs : ["charmed", "frightened", "paralyzed", "poisoned", "stunned", "sleep"],
	},
	skills : ["athletics", "perception"],
	scores : [2, 1, 0, 0, 0, 0],
	armorOptions : [{
		regExpSearch : /^(?=.*natural)(?=.*armou?r).*$/i,
		name : "Natural Armor",
		source : [["LR", 24]],
		ac : 12,
		selectNow : true
	}],
	age : " mature to adulthood by the age of 10 but have been known to live up to 80 years",
	height : " stand between 5 and 6 feet tall",
	weight : " average about 150 pounds",
	heightMetric : " stand between 1,5 and 1,8 metres tall",
	weightMetric : " weigh around 70 kg",
	trait : "Locathah (+2 Strength, +1 Dexterity)\n   Limited Amphibiousness: I can breathe air and water, but need to be submerged at least once every 4 hours to avoid suffocating.\n   Leviathan Will: I have advantage on saving throws against being charmed, frightened, paralyzed, poisoned, stunned, or put to sleep.\n   Natural Armor: I have an AC of 12 + Dexterity modifier + shield.\n   Observant & Athletic: I have proficiency in the Athletics and Perception skills."
};

// pub_20191112_Adventure-with-Muk.js
// This file adds the Dankwood Goblin race from the Adventure with Muk from Extra Life to MPMB's Character Record Sheet
// Be aware that this race is not legal in adventurers league!

SourceList["AwM"] = {
	name : "Adventure with Muk",
	abbreviation : "AwM",
	group : "Extra Life",
	url : "https://www.dmsguild.com/product/294712/Adventure-with-Muk-5e",
	date : "2019/11/12",
	defaultExcluded : true
};

RaceList["dankwood goblin"] = {
	regExpSearch : /^(?=.*dankwood)(?=.*\bgoblins?\b)(?!.*(hobgoblin|bugbear)).*$/i,
	name : "Dankwood goblin",
	sortname : "Goblin, Dankwood",
	source : [["AwM", 35]],
	plural : "Dankwood goblins",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	age : " reach adulthood at age 8 and live up to 60 years",
	height : " are between 3 and a half and 4 feet tall (3'5\" + 2d4\")",
	weight : " weigh between 40 and 70 lb (35 + 2d4 \xD7 1 lb)",
	heightMetric : " are between 100 and 120 cm tall (100 + 5d4 cm)",
	weightMetric : " weigh between 20 and 30 kg (17 + 5d4 \xD7 2 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	action : [["bonus action", "Nimble Escape (disengage/hide)"]],
	trait : "Dankwood Goblin (+2 Dexterity, +1 Wisdom)"+
	"\n   Speak with Small Beasts: Through sounds and gestures, I can communicate simple ideas with Small or smaller beasts. Dankwood goblins love animals and often keep squirrels, badgers, rabbits, moles, woodpeckers, and other creatures as beloved pets."+
	"\n   Nimble Escape: As a bonus action, I can take the Disengage or Hide action."
};

// pub_20191119_ERftLW.js
// This file adds the content from Eberron: Rising from the Last War to MPMB's Character Record Sheet

// Define the source
SourceList["E:RLW"] = {
	name : "Eberron: Rising from the Last War",
	abbreviation : "E:RLW",
	group : "Campaign Sourcebooks",
	campaignSetting : "Eberron",
	url : "https://dnd.wizards.com/products/eberron",
	date : "2019/11/19"
};

// The changeling
RaceList["changeling"] = {
	regExpSearch : /changeling/i,
	name : "Changeling",
	source : [["E:RLW", 18]],
	plural : "Changelings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose two from Deception, Intimidation, Insight, and Persuasion",
	languageProfs : ["Common", 2],
	age : " mature slightly faster than humans but share a similar lifespan, typically a century or less. While a changeling can transform to conceal their age, the effects of aging affect them similarly to humans",
	height : " stand between 5 and 6 feet tall (5'1\" + 2d4\")",
	weight : " weigh around 140 lb (115 + 2d4 \xD7 2d4 lb)",
	heightMetric : " stand between 1,5 to over 1,8 metres tall (155 + 5d4 cm)",
	weightMetric : " weigh around 65 kg (52 + 5d4 \xD7 4d4 / 10 kg)",
	scorestxt : "+2 Charisma and +1 to one other ability score of my choice",
	scores : [0, 0, 0, 0, 0, 2],
	trait : "Changeling (+2 Charisma and +1 to one other ability score of my choice)\nShapechanger: As an action, I can change my appearance and voice to or from a humanoid-shaped form I have seen, not changing my equipment. I determine the specifics of the form like hair length, eye color, and sex. I can adjust my height and weight, but not so much that my size changes. I revert back when I die. I can make myself appear as a member of another race, though none of my game statistics change.",
	action : [["action", "Shapechanger"]]
};

// Double bladed scimitar
WeaponsList["double-bladed scimitar"] = {
	regExpSearch : /^(?=.*double)(?=.*scimitar).*$/i,
	name : "Double-bladed scimitar",
	source : [["E:RLW", 22], ["WGtE", 74]],
	list : "melee",
	ability : 1,
	type : "Martial",
	damage : [2, 4, "slashing"],
	range : "Melee",
	weight : 6,
	description : "Two-handed; With Attack action, one attack as bonus action for 1d4",
	special : true,
	abilitytodamage : true
};

// Revenant blade feat
FeatsList["revenant blade"] = {
	name : "Revenant Blade",
	source : [["E:RLW", 22]],
	prerequisite : "Being an Elf",
	prereqeval : function(v) { return (/^(?!.*half)(?=.*(elf|eladrin|avariel|grugach|shadar-kai)).*$/i).test(CurrentRace.known); },
	descriptionFull : "You are descended from a master of the double blade and their skills have passed on to you. You gain the following benefits:\n \u2022 Increase your Dexterity or Strength score by 1, to a maximum of 20.\n \u2022 While you are holding a double-bladed scimitar with two hands, you gain a + 1 bonus to Armor Class.\n \u2022 A double-bladed scimitar has the finesse property when you wield it.",
	description : "My mastery with the double bladed scimitar allows me to treat it as having the finesse trait. In addition, I gain +1 AC while wielding it with two hands. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == 'double-bladed scimitar' && fields.Proficiency) {
					if (!/finesse/i.test(fields.Description)) fields.Description = 'Finesse, ' + fields.Description.substr(0,1).toLowerCase() + fields.Description.substr(1);
					fields.Mod = v.StrDex;
				};
			},
			"Double-bladed scimitars count as having finesse for me.",
			1
		]
	},
	extraAC : {
		mod : 1,
		text : "I gain a +1 bonus to AC while I'm wielding a double-bladed weapon in two hands.",
		stopeval : function (v) { return v.usingShield && !(/animated/i).test(What("AC Shield Bonus Description")) || !CurrentWeapons.known.some(function (n) { return n[0] == "double-bladed scimitar" || (WeaponsList[n[0]] && WeaponsList[n[0]].baseWeapon == "double-bladed scimitar"); }); }
	}
};
// The kalashtar
RaceList["kalashtar"] = {
	regExpSearch : /kalashtar/i,
	name : "Kalashtar",
	source : [["E:RLW", 30]],
	plural : "Kalashtar",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Quori", 1],
	savetxt : { immune : ["effects that require me to dream"], text : ["Adv. on all Wis saves"] },
	advantages : [ ["Wisdom", true] ],
	dmgres : ["Psychic"],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from 5 and a half to well over 6 feet tall (5'4\" + 2d6\")",
	weight : " weigh around 145 lb (110 + 2d6 \xD7 1d6 lb)",
	heightMetric : " range from 1,7 to 1,9 metres tall (160 + 5d6 cm)",
	weightMetric : " weigh around 65 kg (50 + 5d6 \xD7 2d6 / 10 kg)",
	scores : [0, 0, 0, 0, 2, 1],
	trait : "Kalashtar (+2 Wisdom, +1 Charisma)\n   Dual Mind: I have advantage on Wisdom saving throws.\n   Mind Link: I can speak telepathically to any creature I can see within 10 ft \xD7 my level, as long as it can speak at least one language. As an action, I can give that creature the ability to speak telepathically back to me while it can see me and is within range. This lasts for 1 hour, until I use this ability on another creature, or until I end it as an action.\n   Severed from Dreams: I don't dream and thus immune to spells that affect dreams.",
	action : [['action', 'Mind Link (start/stop)']]
};

// The four subraces of the shifter
RaceList["beasthide shifter"] = {
	regExpSearch : /^(?!.*(multiverse|motm\b))(?=.*shifter)(?=.*beast)(?=.*hide).*$/i,
	name : "Beasthide shifter",
	sortname : "Shifter, Beasthide",
	source : [["E:RLW", 34]],
	plural : "Beasthide shifters",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common"],
	vision : [["Darkvision", 60]],
	skills : ["Athletics"],
	age : " reach young adulthood at age 10 and rarely live over 70",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")",
	weight : " weigh around 135 lb (90 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from under 1,5 to 1,8 metres tall (4'6\" + 5d8 cm)",
	weightMetric : " weigh around 65 kg (40 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 2, 0, 0, 0],
	trait : "Beasthide Shifter (+1 Strength, +2 Constitution)\n\nShifting: As a bonus action once per short rest, I can assume a more bestial appearance.\nThis transformation lasts for 1 minute, until I die, or until I revert back as a bonus action.\nWhen I shift, I gain temporary HP equal to 1d6 + my level + my Constitution modifier (minimum 1 temporary hit point).\nWhile transformed like this, I have a +1 bonus to AC.",
	features : {
		"shift" : {
			name : "Shift",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", " (start/end)"],
			additional : levels.map(function (n) { return "1d6 + " + n + " + Con mod temp HP"; })
		}
	}
};
RaceList["longtooth shifter"] = {
	regExpSearch : /^(?!.*(multiverse|motm\b))(?=.*shifter)(?=.*long)(?=.*(tooth|teeth)).*$/i,
	name : "Longtooth shifter",
	sortname : "Shifter, Longtooth",
	source : [["E:RLW", 34]],
	plural : "Longtooth shifters",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common"],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*fangs?)(?=.*long)(?=.*(tooth|teeth)).*$/i,
		name : "Longtooth Fangs",
		source : [["E:RLW", 34]],
		damage : [1, 6, "piercing"],
		description : "Only while shifted; One attack as bonus action",
		selectNow : true
	}],
	vision : [["Darkvision", 60]],
	skills : ["Intimidation"],
	age : " reach young adulthood at age 10 and rarely live over 70",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")",
	weight : " weigh around 135 lb (90 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from under 1,5 to 1,8 metres tall (4'6\" + 5d8 cm)",
	weightMetric : " weigh around 65 kg (40 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [2, 1, 0, 0, 0, 0],
	trait : "Longtooth Shifter (+2 Strength, +1 Dexterity)\nShifting: As a bonus action once per short rest, I can assume a more bestial appearance.\nThis transformation lasts for 1 minute, until I die, or until I revert back as a bonus action.\nWhen I shift, I gain temporary HP equal to my level + my Constitution modifier (minimum 1 temporary hit point).\nWhile transformed like this, I use my elongated fangs to make unarmed strikes, dealing 1d6 piercing damage. As a bonus action, I can maken one attack with my fangs.",
	action : [['bonus action', 'Longtooth Fangs attack (while shifted)']],
	features : {
		"shift" : {
			name : "Shift",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", " (start/end)"],
			additional : levels.map(function (n) { return n + " + Con mod temp HP"; })
		}
	}
};
RaceList["swiftstride shifter"] = {
	regExpSearch : /^(?!.*(multiverse|motm\b))(?=.*shifter)(?=.*swift)(?=.*stride).*$/i,
	name : "Swiftstride shifter",
	sortname : "Shifter, Swiftstride",
	source : [["E:RLW", 34]],
	plural : "Swiftstride shifters",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common"],
	vision : [["Darkvision", 60]],
	skills : ["Acrobatics"],
	age : " reach young adulthood at age 10 and rarely live over 70",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")",
	weight : " weigh around 135 lb (90 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from under 1,5 to 1,8 metres tall (4'6\" + 5d8 cm)",
	weightMetric : " weigh around 65 kg (40 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	trait : "Swiftstride Shifter (+2 Dexterity, +1 Charisma)\nShifting: As a bonus action once per short rest, I can assume a more bestial appearance.\nThis transformation lasts for 1 minute, until I die, or until I revert back as a bonus action.\nWhen I shift, I gain temporary HP equal to my level + my Con" + (typePF ? "stitution modifier (minimum 1 temporary hit point" : " mod (minimum 1 temp HP") + ").\nWhile transformed like this, my walking speed increases with 10 ft.\nAs a reaction when an enemy ends its turn within 5 ft of me while I'm shifted, I can move 10 ft without provoking opportunity attacks.",
	action : [['reaction', 'Stride (while shifted)']],
	features : {
		"shift" : {
			name : "Shift",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", " (start/end)"],
			additional : levels.map(function (n) { return n + " + Con mod temp HP"; })
		}
	}
};
RaceList["wildhunt shifter"] = {
	regExpSearch : /^(?!.*(multiverse|motm\b))(?=.*shifter)(?=.*wild)(?=.*hunt).*$/i,
	name : "Wildhunt shifter",
	sortname : "Shifter, Wildhunt",
	source : [["E:RLW", 34]],
	plural : "Wildhunt shifters",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common"],
	vision : [["Darkvision", 60]],
	skills : ["Survival"],
	age : " reach young adulthood at age 10 and rarely live over 70",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")",
	weight : " weigh around 135 lb (90 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from under 1,5 to 1,8 metres tall (4'6\" + 5d8 cm)",
	weightMetric : " weigh around 65 kg (40 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 0, 2, 0],
	trait : "Wildhunt Shifter (+1 Dexterity, +2 Wisdom)\nShifting: As a bonus action once per short rest, I can assume a more bestial appearance.\nThis transformation lasts for 1 minute, until I die, or until I revert back as a bonus action.\nWhen I shift, I gain temporary HP equal to my level + my Constitution modifier (minimum 1 temporary hit point).\nWhile transformed like this, I have advantage on Wisdom checks and no creature within 30 ft can make an attack roll with advantage against me, unless I'm incapacitated.",
	features : {
		"shift" : {
			name : "Shift",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", " (start/end)"],
			additional : levels.map(function (n) { return n + " + Con mod temp HP"; })
		}
	}
};

// The warforged
RaceList["warforged"] = {
	regExpSearch : /warforged/i,
	name : "Warforged",
	source : [["E:RLW", 36]],
	plural : "Warforged",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	toolProfs : [["Any tool", 1]],
	skillstxt : "Choose any one skill and any one tool",
	savetxt : {
		text : ["Magic can't put me to sleep"],
		immune : ["disease", "magical aging effects"],
		adv_vs : ["poison"]
	},
	dmgres : ["Poison"],
	age : " typical are between two and thirty years old. The maximum warforged lifespan remains a mystery; so far, warforged have shown no signs of deterioration due to age. Warforged are immune to magical aging effects.",
	height : " stand between 6 and 7 feet tall (5'10\" + 2d6\")",
	weight : " weigh around 300 lb (270 + 2d6 \xD7 4 lb)",
	heightMetric : " stand between 1,8 and 2,1 metres tall (178 + 5d6 cm)",
	weightMetric : " weigh around 135 kg (125 + 5d6 \xD7 8 / 10 kg)",
	scorestxt : "+2 Constitution and +1 to one other ability score of my choice",
	scores : [0, 0, 2, 0, 0, 0],
	trait : "Warforged (+2 Constitution and +1 to one other ability score" + (typePF ? "" : " of my choice") + ")\nWarforged Resilience: I do not need to sleep, eat, drink, or breathe.\nSentry's Rest: To benefit from a long rest, I need to enter an inactive state for 6 hours, during which I am not rendered unconscious and can see and hear as normal.\nIntegrated Protection: I gain +1 AC and I can don only armor with which I'm proficient. To don or doff armor, I must (un)incorporate it into my body over the course of 1 hour, which can be done during resting. Donned armor can't be removed against my will while I'm alive.",
	extraAC : {
		name : "Integrated Protection",
		mod : 1,
		text : "I gain a +1 bonus to AC."
	}
};

// Dragonmarks subraces
RaceList["dragonmark detection half-elf"] = {
	regExpSearch : /^((?=.*mark)(?=.*detection)|(?=.*house)(?=.*medani)).*$/i,
	name : "Half-elf (dragonmark)",
	sortname : "Dragonmark, Detection (Half-Elf)",
	source : [["E:RLW", 40]],
	plural : "Half-elves (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish", 1],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	age : " reach adulthood around age 20 and often live over 180 years",
	height : " range from 5 to 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scorestxt : "+2 Wisdom and +1 to one other ability score of my choice",
	scores : [0, 0, 0, 0, 2, 0],
	trait : "Half-Elf, Dragonmark of Detection (+2 Wisdom \u0026 +1 to one other ability of my choice)\n   Deductive Intuition: I can add +1d4 to my Intelligence (Investigation) and Wisdom (Insight) checks.\n   Magical Detection: I can cast Detect Magic and Detect Poison and Disease each once per long rest. At 3rd level, I can also cast See Invisibility once per long rest. Wisdom is my spellcasting ability for these and none of them require material components.\n   Spells of the Mark: I add several spells to the spell list of my spellcasting class(es).",
	spellcastingAbility : 5, // changed from Int to Wis by errata
	features : {
		"magical detection" : {
			name : "Magical Detection (level 1)",
			limfeaname : "Detect Magic",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Magical Detection (level 1)",
				spells : ["detect magic", "detect poison and disease"],
				selection : ["detect magic", "detect poison and disease"],
				firstCol : "oncelr",
				times : 2
			},
			extraLimitedFeatures : [{
				name : "Detect Poison and Disease",
				usages : 1,
				recovery : "long rest"
			}],
			spellChanges : {
				"detect poison and disease" : {
					components : "V,S",
					compMaterial : "",
					changes : "I can cast this spell once per long rest without requiring material components."
				}
			}
		},
		"see invisibility" : {
			name : "Magical Detection (level 3)",
			limfeaname : "See Invisibility",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Magical Detection (level 3)",
				spells : ["see invisibility"],
				selection : ["see invisibility"],
				firstCol : "oncelr"
			},
			spellChanges : {
				"see invisibility" : {
					components : "V,S",
					compMaterial : "",
					changes : "I can cast this spell once per long rest without requiring material components."
				}
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["detect evil and good", "detect poison and disease", "detect thoughts", "find traps", "clairvoyance", "nondetection", "arcane eye", "divination", "legend lore"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Detect Evil and Good, Detect Poison and Disease, Detect Thoughts, Find Traps, Clairvoyance, Nondetection, Arcane Eye, Divination, and Legend Lore."
		]
	}
};
RaceList["dragonmark finding half-orc"] = {
	regExpSearch : /^((?=.*half)(?=.*\bor(c|k))((?=.*mark)(?=.*finding)|(?=.*house)(?=.*tharashk))).*$/i,
	name : "Half-orc (dragonmark)",
	sortname : "Dragonmark, Finding (Half-Orc)",
	source : [["E:RLW", 41]],
	plural : "Half-orcs (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	age : " reach adulthood around age 14 and rarely live longer than 75 years",
	height : " range from 5 to well over 6 feet tall (4'10\" + 2d10\")",
	weight : " weigh around 215 lb (140 + 2d10 \xD7 2d6 lb)",
	heightMetric : " range from 1,5 to well over 1,8 metres tall (150 + 5d10 cm)",
	weightMetric : " weigh around 100 kg (65 + 5d10 \xD7 4d6 / 10 kg)",
	scores : [0, 0, 1, 0, 2, 0],
	trait : "Half-Orc, Dragonmark of Finding (+1 Constitution, +2 Wisdom)\n   Hunter's Intuition: I can add +1d4 to my Wisdom (Perception) and Wisdom (Survival) checks.\n   Finder's Magic: I can cast Hunter's Mark once per long rest. At 3rd level, I can also cast Locate Object once per long rest. Wisdom is my spellcasting ability for these.\n   Spells of the Mark: I add several spells to the spell list of my spellcasting class(es).",
	spellcastingAbility : 5,
	features : {
		"finder's magic" : {
			name : "Finder's Magic (level 1)",
			limfeaname : "Hunter's Mark",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Finder's Magic (level 1)",
				spells : ["hunter's mark"],
				selection : ["hunter's mark"],
				firstCol : "oncelr"
			}
		},
		"locate object" : {
			name : "Finder's Magic (level 3)",
			limfeaname : "Locate Object",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Finder's Magic (level 3)",
				spells : ["locate object"],
				selection : ["locate object"],
				firstCol : "oncelr"
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["faerie fire", "longstrider", "locate animals or plants", "locate object", "clairvoyance", "speak with plants", "divination", "locate creature", "commune with nature"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Faerie Fire, Longstrider, Locate Animals or Plants, Locate Object, Clairvoyance, Speak with Plants, Divination, Locate Creature, and Commune with Nature."
		]
	}
};
RaceList["dragonmark finding human"] = {
	regExpSearch : /^((?=.*human)((?=.*mark)(?=.*finding)|(?=.*house)(?=.*tharashk))).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Finding (Human)",
	source : [["E:RLW", 41]],
	plural : "Human (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 1, 0, 2, 0],
	trait : "Human, Dragonmark of Finding (+1 Constitution, +2 Wisdom)\n   Hunter's Intuition: I can add +1d4 to my Wisdom (Perception) and Wisdom (Survival) checks.\n   Finder's Magic: I can cast Hunter's Mark once per long rest. At 3rd level, I can also cast Locate Object once per long rest. Wisdom is my spellcasting ability for these.\n   Spells of the Mark: I add several spells to the spell list of my spellcasting class(es).",
	spellcastingAbility : 5,
	features : {
		"finder's magic" : {
			name : "Finder's Magic (level 1)",
			limfeaname : "Hunter's Mark",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Finder's Magic (level 1)",
				spells : ["hunter's mark"],
				selection : ["hunter's mark"],
				firstCol : "oncelr"
			}
		},
		"locate object" : {
			name : "Finder's Magic (level 3)",
			limfeaname : "Locate Object",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Finder's Magic (level 3)",
				spells : ["locate object"],
				selection : ["locate object"],
				firstCol : "oncelr"
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["faerie fire", "longstrider", "locate animals or plants", "locate object", "clairvoyance", "speak with plants", "divination", "locate creature", "commune with nature"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Faerie Fire, Longstrider, Locate Animals or Plants, Locate Object, Clairvoyance, Speak with Plants, Divination, Locate Creature, and Commune with Nature."
		]
	}
};
RaceList["dragonmark handling human"] = {
	regExpSearch : /^((?=.*mark)(?=.*handling)|(?=.*house)(?=.*vadalis)).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Handling (Human)",
	source : [["E:RLW", 42]],
	plural : "Humans (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scorestxt : "+2 Wisdom and +1 to one other ability score of my choice",
	scores : [0, 0, 0, 0, 2, 0],
	trait : "Human, Dragonmark of Handling (+2 Wisdom, +1 to one other ability score of my choice)\n   Wild Intuition: I can add +1d4 to my Wisdom (Animal Handling) and Intelligence (Nature) checks.\n   Primal Connection: I can cast Animal Friendship and Speak with Animals each once per short rest. Wisdom is my spellcasting ability for these.\n   The Bigger They Are: When I cast Animal Friendship or Speak with Animals, I can target a monstrosity with an Intelligence of 3 or lower instead of a beast.",
	spellcastingAbility : 5,
	features : {
		"primal connection" : {
			name : "Primal Connection",
			limfeaname : "Animal Friendship",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			extraLimitedFeatures : [{
				name : "Speak with Animals",
				usages : 1,
				recovery : "short rest"
			}],
			spellcastingBonus : {
				name : "Primal Connection",
				spells : ["animal friendship", "speak with animals"],
				selection : ["animal friendship", "speak with animals"],
				firstCol : 'oncesr',
				times : 2
			},
		}
	},
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				switch (spellKey) {
					case "animal friendship" :
						spellObj.description = spellObj.description.replace("beasts", "beasts/monstrosities");
						return true;
					case "speak with animals" :
						spellObj.description = "Communicate verbally with monstrosities Int<4 or beasts for duration; interactions limited by their Int";
						return true;
				}
			},
			"When I cast Animal Friendship or Speak with Animals, I can target a monstrosity with an Intelligence of 3 or lower instead of a beast."
		],
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["animal friendship", "speak with animals", "beast sense", "calm emotions", "beacon of hope", "conjure animals", "aura of life", "dominate beast", "awaken"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Animal Friendship, Speak with Animals, Beast Sense, Calm Emotions, Beacon of Hope, Conjure Animals, Aura of Life, Dominate Beast, and Awaken."
		]
	}
};
RaceList["dragonmark healing halfling"] = {
	regExpSearch : /^((?=.*mark)(?=.*healing)|(?=.*house)(?=.*jorasco)).*$/i,
	name : "Halfling (dragonmark)",
	sortname : "Dragonmark, Healing (Halfling)",
	source : [["E:RLW", 43]],
	plural : "Halflings (dragonmark)",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened"] },
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Halfling, Dragonmark of Healing (+2 Dexterity, +1 Wisdom)\nLucky: When I roll a 1 on an attack, check, or save, I can reroll it but must use the result." + (typePF ? " " : "\n") + "Halfling Nimbleness: I can move through the space of Medium and larger creatures.\nMedical Intuition: I can add +1d4 to my Wisdom (Medicine) and herbalism kit checks.\nHealing Touch: I can cast Cure Wounds each once per long rest. At 3rd level, I can also cast Lesser Restoration once per long rest. Wisdom is my spellcasting ability for these.\nSpells of the Mark: I add several spells to " + (typePF ? "my class' spell list." : "the spell list of my spellcasting class(es)."),
	spellcastingAbility : 5,
	features : {
		"healing touch" : {
			name : "Healing Touch (level 1)",
			limfeaname : "Cure Wounds",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Healing Touch (level 1)",
				spells : ["cure wounds"],
				selection : ["cure wounds"],
				firstCol : "oncelr"
			}
		},
		"lesser restoration" : {
			name : "Healing Touch (level 3)",
			limfeaname : "Lesser Restoration",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Healing Touch (level 3)",
				spells : ["lesser restoration"],
				selection : ["lesser restoration"],
				firstCol : "oncelr"
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["cure wounds", "healing word", "lesser restoration", "prayer of healing", "aura of vitality", "mass healing word", "aura of purity", "aura of life", "greater restoration"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Cure Wounds, Healing Word, Lesser Restoration, Prayer of Healing, Aura of Vitality, Mass Healing Word, Aura of Purity, Aura of Life, and Greater Restoration."
		]
	}
};
RaceList["dragonmark hospitality halfling"] = {
	regExpSearch : /^((?=.*mark)(?=.*hospitality)|(?=.*house)(?=.*ghallanda)).*$/i,
	name : "Halfling (dragonmark)",
	sortname : "Dragonmark, Hospitality (Halfling)",
	source : [["E:RLW", 44]],
	plural : "Halflings (dragonmark)",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened"] },
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	trait : "Halfling, Dragonmark of Hospitality (+2 Dexterity, +1 Charisma)\nLucky: When I roll a 1 on an attack, check, or save, I can reroll it but must use the result." + (typePF ? " " : "\n") + "Halfling Nimbleness: I can move through the space of Medium and larger creatures.\nEver Hospitable: I can add +1d4 to my Charisma (Persuasion), brewer's supplies, and cook's utensils checks." + (typePF ? "\n" : " ") + "Innkeeper's Magic: I know the Prestidigitation cantrip and I can cast Purify Food and Drink and Unseen Servant each once per long rest. Charisma as my spellcasting ability for these. Spells of the Mark: I add several spells to my class' spell list.",
	spellcastingAbility : 6,
	features : {
		"innkeeper's magic" : {
			name : "Innkeeper's Magic",
			limfeaname : "Purify Food and Drink",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : [{
				name : "Innkeeper's Magic",
				spells : ["prestidigitation"],
				selection : ["prestidigitation"],
				firstCol : 'atwill'
			}, {
				name : "Innkeeper's Magic",
				spells : ["purify food and drink", "unseen servant"],
				selection : ["purify food and drink", "unseen servant"],
				firstCol : "oncelr",
				times : 2
			}],
			extraLimitedFeatures : [{
				name : "Unseen Servant",
				usages : 1,
				recovery : "long rest"
			}]
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["goodberry", "sleep", "aid", "calm emotions", "create food and water", "leomund's tiny hut", "aura of purity", "mordenkainen's private sanctum", "hallow"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Goodberry, Sleep, Aid, Calm Emotions, Create Food and Water, Leomund's Tiny Hut, Aura of Purity, Mordenkainen's Private Sanctum, and Hallow."
		]
	}
};
RaceList["dragonmark making human"] = {
	regExpSearch : /^((?=.*mark)(?=.*making)|(?=.*house)(?=.*cannith)).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Making (Human)",
	source : [["E:RLW", 45]],
	plural : "Humans (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	toolProfs : [["Artisan's tools", 1]],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scorestxt : "+2 Intelligence and +1 to one other ability score of my choice",
	scores : [0, 0, 0, 2, 0, 0],
	trait : "Human, Dragonmark of Making (+2 Intelligence, +1 to one other ability score of my choice)\n   Artisan's Intuition: I can add +1d4 to Arcana checks and checks with artisan's tools.\n   Spellsmith: I know the Mending cantrip. I can cast Magic Weapon once per long rest and when I do so, it doesn't require concentration and lasts for 1 hour. Intelligence is my spellcasting ability for these.\n   Spells of the Mark: I add several spells to the spell list of my spellcasting class(es)." + (typePF ? "" : "\n   Maker's Gift: I gain proficiency with one type of artisan's tools of my choice."),
	spellcastingAbility : 4,
	features : {
		"spellsmith" : {
			name : "Spellsmith",
			limfeaname : "Magic Weapon",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : [{
				name : "Spellsmith",
				spells : ["mending"],
				selection : ["mending"],
				firstCol : "atwill"
			}, {
				name : "Spellsmith",
				spells : ["magic weapon"],
				selection : ["magic weapon"],
				firstCol : "oncelr"
			}],
			spellChanges : {
				"magic weapon" : {
					duration : "1 h",
					description : "1 nonmagical weapon becomes magical with an +1 bonus to attack and damage",
					changes : "When using my Spellsmith racial trait, this spell doesn't require concentration and lasts for 1 hour."
				}
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["identify", "tenser's floating disk", "continual flame", "magic weapon", "conjure barrage", "elemental weapon", "fabricate", "stone shape", "creation"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Identify, Tenser's Floating Disk, Continual Flame, Magic Weapon, Conjure Barrage, Elemental Weapon, Fabricate, Stone Shape, and Creation."
		]
	}
};
RaceList["dragonmark passage human"] = {
	regExpSearch : /^((?=.*mark)(?=.*passage)|(?=.*house)(?=.*orien)).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Passage (Human)",
	source : [["E:RLW", 46]],
	plural : "Humans (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	languageProfs : ["Common", 1],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scorestxt : "+2 Dexterity and +1 to one other ability score of my choice",
	scores : [0, 2, 0, 0, 0, 0],
	trait : "Human, Dragonmark of Passage (+2 Dexterity, +1 to one other ability score of my choice)\n   Intuitive Motion: I can add +1d4 to my Dexterity (Acrobatics) checks and any ability checks involving operating or maintaining a land vehicle.\n   Magical Passage: I can cast Misty Step once per long rest, using Dexterity as my spellcasting ability.\n   Spells of the Mark: I add several spells to the spell list of my spellcasting class(es).\n   Courier's Speed: My base walking speed is 35 ft.",
	spellcastingAbility : 2,
	features : {
		"magical passage" : {
			name : "Magical Passage",
			limfeaname : "Misty Step",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Magical Passage",
				spells : ["misty step"],
				selection : ["misty step"],
				firstCol : "oncelr"
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["expeditious retreat", "jump", "misty step", "pass without trace", "blink", "phantom steed", "dimension door", "freedom of movement", "teleportation circle"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Expeditious Retreat, Jump, Misty Step, Pass Without Trace, Blink, Phantom Steed, Dimension Door, Freedom of Movement, and Teleportation Circle."
		]
	}
};
RaceList["dragonmark scribing gnome"] = {
	regExpSearch : /^((?=.*mark)(?=.*scribing)|(?=.*house)(?=.*sivis)).*$/i,
	name : "Gnome (dragonmark)",
	sortname : "Dragonmark, Scribing (Gnome)",
	source : [["E:RLW", 47]],
	plural : "Gnomes (dragonmark)",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Gnomish"],
	vision : [["Darkvision", 60]],
	savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. magic"] },
	age : " start adult life around age 40 and can live 350 to almost 500 years",
	height : " are 3 to 4 feet tall (2'11\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " are 90 to 120 cm tall (2'11\" + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 0, 0, 2, 0, 1],
	trait : "Gnome, Dragonmark of Scribing (+2 Intelligence, +1 Charisma)\n   Gifted Scribe: I can add +1d4 to my Intelligence (History) checks and ability checks with calligrapher's supplies.\n   Scribe's Insight: I know the Message cantrip. I can cast Comprehend Languages once per long rest. At 3rd level, I can also cast Magic Mouth once per long rest. Intelligence is my spellcasting ability for these spells.\n   Spells of the Mark: I add several spells to the spell list of my spellcasting class(es).",
	spellcastingAbility : 4,
	features : {
		"scribe's insight" : {
			name : "Scribe's Insight (level 1)",
			limfeaname : "Comprehend Languages",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : [{
				name : "Scribe's Insight (level 1)",
				spells : ["message"],
				selection : ["message"],
				firstCol : "atwill"
			}, {
				name : "Scribe's Insight (level 1)",
				spells : ["comprehend languages"],
				selection : ["comprehend languages"],
				firstCol : "oncelr"
			}]
		},
		"magic mouth" : {
			name : "Scribe's Insight (level 3)",
			limfeaname : "Magic Mouth",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Scribe's Insight (level 3)",
				spells : ["magic mouth"],
				selection : ["magic mouth"],
				firstCol : "oncelr"
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["comprehend languages", "illusory script", "animal messenger", "silence", "sending", "tongues", "arcane eye", "confusion", "dream"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Comprehend Languages, Illusory Script, Animal Messenger, Silence, Sending, Tongues, Arcane Eye, Confusion, and Dream."
		]
	}
};
RaceList["dragonmark sentinel human"] = {
	regExpSearch : /^((?=.*mark)(?=.*sentinel)|(?=.*house)(?=.*deneith)).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Sentinel (Human)",
	source : [["E:RLW", 48]],
	plural : "Humans (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 0, 1, 0],
	trait : "Human, Dragonmark of Sentinel (+2 Constitution, +1 Wisdom)\n  Sentinel's Intuition: I can add +1d4 my Wisdom (Insight) and Wisdom (Perception) checks.\n  Guardian's Shield: I can cast Shield once per long rest, using Wisdom as my spellcasting ability.\n  Vigilant Guardian: Once per long rest as a reaction when a creature I can see within 5 ft is hit by an attack roll, I can swap places with it and I'm hit by the attack instead.\n  Spells of the Mark: I add several spells to the spell list of my spellcasting class(es).",
	spellcastingAbility : 5,
	features : {
		"vigilant guardian" : {
			name : "Vigilant Guardian",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			action : [['reaction', '']]
		},
		"guardian's shield" : {
			name : "Guardian's Shield",
			limfeaname : "Shield",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Guardian's Shield",
				spells : ["shield"],
				selection : ["shield"],
				firstCol : 'oncelr'
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["compelled duel", "shield of faith", "warding bond", "zone of truth", "counterspell", "protection from energy", "death ward", "guardian of faith", "bigby's hand"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Compelled Duel, Shield of Faith, Warding Bond, Zone of Truth, Counterspell, Protection from Energy, Death Ward, Guardian of Faith, and Bigby's Hand."
		]
	}
};
RaceList["dragonmark shadow elf"] = {
	regExpSearch : /^((?=.*mark)(?=.*shadow)|(?=.*house)(?=.*(phiarlan|thuranni))).*$/i,
	name : "Elf (dragonmark)",
	sortname : "Dragonmark, Shadow (Elf)",
	source : [["E:RLW", 49]],
	plural : "Elves (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d10\")",
	weight : " weigh around 115 lb (90 + 2d10 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (140 + 5d10 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	trait : "Elf, Dragonmark of Shadow (+2 Dexterity, +1 Charisma)\n   Trance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).\n   Cunning Intuition: I can add +1d4 to my Cha" + (typePF ? "risma" : "") + " (Performance) and Dex" + (typePF ? "terity" : "") + " (Stealth) checks.\n   Shape Shadows: I know the Minor Illusion cantrip. At 3rd level, I can cast Invisibility once per long rest. Charisma is my spellcasting ability for these.\n   Spells of the Mark: I add several spells to " + (typePF ? "my class' spell list." : "the spell list of my spellcasting class(es)."),
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Shape Shadows (level 1)",
		spells : ["minor illusion"],
		selection : ["minor illusion"],
		firstCol : 'atwill'
	},
	features : {
		"shape shadows" : {
			name : "Shape Shadows (level 3)",
			limfeaname : "Invisibility",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Shape Shadows (level 3)",
				spells : ["invisibility"],
				selection : ["invisibility"],
				firstCol : "oncelr"
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["disguise self", "silent image", "darkness", "pass without trace", "clairvoyance", "major image", "greater invisibility", "hallucinatory terrain", "mislead"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Disguise Self, Silent Image, Darkness, Pass Without Trace, Clairvoyance, Major Image, Greater Invisibility, Hallucinatory Terrain, and Mislead."
		]
	}
};
RaceList["dragonmark storm half-elf"] = {
	regExpSearch : /^((?=.*mark)(?=.*storm)|(?=.*house)(?=.*lyrandar)).*$/i,
	name : "Half-elf (dragonmark)",
	sortname : "Dragonmark, Storm (Half-Elf)",
	source : [["E:RLW", 50]],
	plural : "Half-elves (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish", 1],
	vision : [["Darkvision", 60]],
	dmgres : ["Lightning"],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	age : " reach adulthood around age 20 and often live over 180 years",
	height : " range from 5 to 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 0, 0, 2],
	trait : "Half-Elf, Dragonmark of Storm (+1 Dexterity, +2 Charisma)\n   Windwright's Intuition: I can add +1d4 to my Dexterity (Acrobatics) checks and any ability checks involving operating or maintaining a water or air vehicle.\n   Headwinds: I know the Gust cantrip. Once I reach 3rd level, I can cast Gust of Wind once per long rest. Charisma is my spellcasting ability for these spells.\n   Spells of the Mark: I add several spells to the spell list of my spellcasting class(es).",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Headwinds (level 1)",
		spells : ["gust"],
		selection : ["gust"],
		firstCol : 'atwill'
	},
	features : {
		"gust of wind" : {
			name : "Headwinds (level 3)",
			limfeaname : "Gust of Wind",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Headwinds (level 3)",
				spells : ["gust of wind"],
				selection : ["gust of wind"],
				firstCol : 'oncelr'
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["feather fall", "fog cloud", "gust of wind", "levitate", "sleet storm", "wind wall", "conjure minor elementals", "control water", "conjure elemental"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Feather Fall, Fog Cloud, Gust of Wind, Levitate, Sleet Storm, Wind Wall, Conjure Minor Elementals, Control Water, and Conjure Elemental."
		]
	}
};
RaceList["dragonmark warding dwarf"] = {
	regExpSearch : /^((?=.*mark)(?=.*warding)|(?=.*house)(?=.*kundarak)).*$/i,
	name : "Dwarf (dragonmark)",
	sortname : "Dragonmark, Warding (Dwarf)",
	source : [["E:RLW", 51]],
	plural : "Dwarves (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 25, enc : 25 }
	},
	languageProfs : ["Common", "Dwarvish"],
	vision : [["Darkvision", 60]],
	savetxt : { adv_vs : ["poison"] },
	dmgres : ["Poison"],
	weaponProfs : [false, false, ["battleaxe", "handaxe", "warhammer", "light hammer"]],
	toolProfs : [["Smith, brewer, or mason tools", 1]],
	age : " are considered young until they are 50 and live about 350 years",
	height : " stand between 4 and 5 feet tall (4' + 2d4\")",
	weight : " weigh around 150 lb (130 + 2d4 \xD7 2d6 lb)",
	heightMetric : " stand between 1,2 and 1,5 metres tall (120 + 5d4 cm)",
	weightMetric : " weigh around 75 kg (60 + 5d4 \xD7 4d6 / 10 kg)",
	scores : [0, 0, 2, 1, 0, 0],
	trait : "Dwarf, Dragonmark of Warding (+2 Constitution, +1 Intelligence)\n" + (typePF ? "   " : "- ") + "Warder's Intuition: I can add +1d4 to my Intelligence (Investigation) checks and ability checks with thieves' tools." + (typePF ? "\n   Stonecunning: When I make an Int (History) check related to origin of stonework, I am considered having expertise in the History skill.\n   " : " - Stonecunning: Expertise in History when concerning stonework.\n- ") + "Wards and Seals: I can cast Alarm and Mage Armor each once per long rest. At 3rd level, I can also cast Arcane Lock once per long rest. Intelligence is my spellcasting ability for these and none of them require material components.\n" + (typePF ? "   " : "- ") + "Spells of the Mark: I add several spells to my class' spell list(s).",
	spellcastingAbility : 4,
	features : {
		"wards and seals" : {
			name : "Wards and Seals (level 1)",
			limfeaname : "Alarm",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Wards and Seals (level 1)",
				spells : ["alarm", "mage armor"],
				selection : ["alarm", "mage armor"],
				firstCol : "oncelr",
				times : 2
			},
			extraLimitedFeatures : [{
				name : "Mage Armor",
				usages : 1,
				recovery : "long rest"
			}],
			spellChanges : {
				"alarm" : {
					components : "V,S",
					compMaterial : "",
					changes : "I can cast this spell once per long rest without requiring material components."
				},
				"mage armor" : {
					components : "V,S",
					compMaterial : "",
					changes : "I can cast this spell once per long rest without requiring material components."
				}
			}
		},
		"arcane lock" : {
			name : "Wards and Seals (level 3)",
			limfeaname : "Arcane Lock",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Wards and Seals (level 3)",
				spells : ["arcane lock"],
				selection : ["arcane lock"],
				firstCol : 'oncelr'
			}
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["alarm", "armor of agathys", "arcane lock", "knock", "glyph of warding", "magic circle", "leomund's secret chest", "mordenkainen's faithful hound", "antilife shell"]);
			},
			"My race adds extra spells to the spell list(s) of my spellcasting class(es): Alarm, Armor of Agathys, Arcane Lock, Knock, Glyph of Warding, Magic Circle, Leomund's Secret Chest, Mordenkainen's Faithful Hound, and Antilife Shell."
		]
	}
};

// Aberrant Dragonmark feat
FeatsList["aberrant dragonmark"] = {
	name : "Aberrant Dragonmark",
	source : [["E:RLW", 52]],
	prerequisite : "No other dragonmark",
	prereqeval : function(v) { return !(/dragonmark/i).test(CurrentRace.known); },
	descriptionFull : "You have manifested an aberrant dragonmark. Determine its appearance and the flaw associated with it. You gain the following benefits:\n \u2022 Increase your Constitution score by 1, to a maximum of 20.\n \u2022 You learn a cantrip of your choice from the sorcerer spell list. In addition, choose a 1st-level spell from the sorcerer spell list. You learn that spell and can cast it through your mark. Once you cast it, you must finish a short or long rest before you can cast it again through the mark. Constitution is your spellcasting ability for these spells.\n \u2022 When you cast the 1st-level spell through your mark, you can expend one of your Hit Dice and roll it. If you roll an even number, you gain a number of temporary hit points equal to the number rolled. If you roll an odd number, one random creature within 30 feet of you (not including you) takes force damage equal to the number rolled. If no other creatures are in range, you take the damage.\n\nYou also develop a random flaw from the Aberrant Dragonmark Flaws table.\n\n" + toUni("d8\tFlaw") + "\n  1\tYour mark is a source of constant physical pain.\n  2\tYour mark whispers to you. Its meaning can be unclear.\n  3\tWhen you're stressed, the mark hisses audibly.\n  4\tThe skin around the mark is burned, scaly, or withered.\n  5\tAnimals are uneasy around you.\n  6\tYou have a mood swing any time you use your mark.\n  7\tYour looks change slightly whenever you use the mark.\n  8\tYou have horrific nightmares after you use your mark.",
	description : "I learn a sorcerer cantrip, and a 1st-level spell that I can cast once per short rest. They use Con as spellcasting ability. I can expend and roll an HD when I cast the level 1 spell. If even, I gain it in temp HP. If odd, a random target in 30 ft takes it in force damage. [+1 Con]",
	scores : [0, 0, 1, 0, 0, 0],
	spellcastingAbility : 3,
	spellcastingBonus : [{
		name : "Sorcerer cantrip",
		'class' : 'sorcerer',
		level : [0, 0],
		firstCol : 'atwill'
	}, {
		name : "Sorcerer 1st-level spell",
		'class' : 'sorcerer',
		level : [1, 1],
		firstCol : 'oncesr'
	}]
};

// House Agent backgrounds
BackgroundList["house agent"] = { // the default is House Cannith
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*(noble|cannith)).*$/i,
	name : "Agent of House Cannith",
	source : [["E:RLW", 53], ["WGtE", 94]],
	skills : ["Investigation", "Persuasion"],
	gold : 20,
	equipleft : [["Signet ring of house Cannith", "", ""]],
	equipright : [
		["Fine clothes", "", 6],
		["ID papers", "", ""],
		["Purse (with coins)", "", 1]
	],
	feature : "House Connections",
	trait : [
		"I never let emotion complicate work.",
		"I'm always looking to improve efficiency.",
		"I share trivia about my house's business (medicine, ships, warforged).",
		"I hold myself and anyone I work with to extremely high standards.",
		"I never forget an insult made against myself or my house.",
		"I'm very excited and enthusiastic about everything my house does.",
		"I'm representing my house and take great pride in my personal appearance.",
		"I'm critical of monarchies and opposed to any restrictions on the houses."
	],
	ideal : [
		["Common Good",
			"Common Good: My house serves a vital function, and its prosperity will help everyone. (Good)"
		],
		["Tradition",
			"Tradition: I uphold traditions of my house and bring honor to my family. (Lawful)"
		],
		["Innovation",
			"Innovation: Abandon old traditions and find better ways to do things. (Chaotic)"
		],
		["Power",
			"Power: I want to ensure the prosperity of my house and wield its power myself. (Evil)"
		],
		["Discovery",
			"Discovery: I want to learn all I can, both for my house and for my own curiosity. (Any)"
		],
		["Comfort",
			"Comfort: I want to ensure that me and friends of mine enjoy the best things in life. (Any)"
		]
	],
	bond : [
		"My house is my family, and I would do anything for my family.",
		"I love someone from another house, but the relationship is forbidden.",
		"Someone I love was killed by a rival faction within my house, and I will have revenge.",
		"I don't care about the house as a whole, but I would do anything for my old mentor.",
		"I believe my house needs to evolve to survive, and I need to lead that change.",
		"I'm determined to impress the leaders of my house, and to become a leader myself."
	],
	flaw : [
		"I'm overly concerned with following established procedures and protocols.",
		"I'm obsessed with conspiracy theories and worried about secret societies and hidden demons.",
		"I believe that my house and bloodline makes me better than everyone else.",
		"I'm concealing a secret that could get me driven from my house.",
		"I have strong religious beliefs that aren't widespread in my house.",
		"I'm working for a hidden faction in my house that gives me secret assignments."
	],
	extra : [
		"Select an House Agent Role",
		"Acquisition",
		"Investigation",
		"Research \u0026 Development",
		"Security",
		"Intimidation",
		"Exploration",
		"Negotiation",
		"Covert Operations"
	],
	toolProfs : ["Alchemist's supplies", "Tinker's tools"]
};
AddBackgroundVariant("house agent", "deneith", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*deneith).*$/i,
	name : "Agent of House Deneith",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Deneith", "", ""]],
	toolProfs : [["Gaming set", 1], "Vehicles (land)"]
});
AddBackgroundVariant("house agent", "ghallanda", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*ghallanda).*$/i,
	name : "Agent of House Ghallanda",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Ghallanda", "", ""]],
	toolProfs : ["Brewer's supplies", "Cook's utensils"]
});
AddBackgroundVariant("house agent", "jorasco", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*jorasco).*$/i,
	name : "Agent of House Jorasco",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Jorasco", "", ""]],
	toolProfs : ["Alchemist's supplies", "Herbalism kit"]
});
AddBackgroundVariant("house agent", "kundarak", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*kundarak).*$/i,
	name : "Agent of House Kundarak",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Kundarak", "", ""]],
	toolProfs : [["Thieves' tools", "Dex"], "Tinker's tools"]
});
AddBackgroundVariant("house agent", "lyrandar", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*lyrandar).*$/i,
	name : "Agent of House Lyrandar",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Lyrandar", "", ""]],
	toolProfs : ["Navigator's tools", "Vehicles (sea/air)"]
});
AddBackgroundVariant("house agent", "medani", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*medani).*$/i,
	name : "Agent of House Medani",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Medani", "", ""]],
	toolProfs : ["Disguise kit", ["Thieves' tools", "Dex"]]
});
AddBackgroundVariant("house agent", "orien", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*orien).*$/i,
	name : "Agent of House Orien",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Orien", "", ""]],
	toolProfs : [["Gaming set", 1], "Vehicles (land)"]
});
AddBackgroundVariant("house agent", "phiarlan", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*phiarlan).*$/i,
	name : "Agent of House Phiarlan",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Phiarlan", "", ""]],
	toolProfs : ["Disguise kit", ["Musical instrument", 1]]
});
AddBackgroundVariant("house agent", "sivis", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*sivis).*$/i,
	name : "Agent of House Sivis",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Sivis", "", ""]],
	toolProfs : ["Calligrapher's tools", "Forgery kit"]
});
AddBackgroundVariant("house agent", "tharashk", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*tharashk).*$/i,
	name : "Agent of House Tharashk",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Tharashk", "", ""]],
	toolProfs : [["Gaming set", 1], ["Thieves' tools", "Dex"]]
});
AddBackgroundVariant("house agent", "thuranni", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*thuranni).*$/i,
	name : "Agent of House Thuranni",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Thuranni", "", ""]],
	toolProfs : [["Musical instrument", 1], "Poisoner's kit"]
});
AddBackgroundVariant("house agent", "vadalis", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*vadalis).*$/i,
	name : "Agent of House Vadalis",
	source : [["E:RLW", 53], ["WGtE", 94]],
	equipleft : [["Signet ring of house Vadalis", "", ""]],
	toolProfs : ["Herbalism kit", "Vehicles (land)"]
});
BackgroundFeatureList["house connections"] = {
	description : "As an agent of my house, I can always get food and lodging for my friends at a house enclave. My house usually provides me with necessary supplies and transportation if it assigns me a mission. I have many old friends, mentors, and rivals in my house that I might run into and be willing to help me depending on my current standing in the house.",
	source : [["E:RLW", 53], ["WGtE", 95]]
};

// Artificer class
ClassList.artificer = {
	regExpSearch : /^(?=.*artificer)(?!.*wizard).*$/i,
	name : "Artificer",
	source : [["E:RLW", 54], ["T", 9]],
	primaryAbility : "Intelligence",
	abilitySave : 4,
	prereqs : "Intelligence 13",
	improvements : [0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 5, 5],
	die : 8,
	saves : ["Con", "Int"],
	skillstxt : {
		primary : "Choose two from Arcana, History, Investigation, Medicine, Nature, Perception, and Sleight of Hand"
	},
	toolProfs : {
		primary : [["Thieves' tools", "Dex"], "Tinker's tools", ["Artisan's tools", 1]],
		secondary : [["Thieves' tools", "Dex"], "Tinker's tools"]
	},
	armorProfs : {
		primary : [true, true, false, true],
		secondary : [true, true, false, true]
	},
	weaponProfs : {
		primary : [true, false, ["Firearms"]]
	},
	equipment : "Artificer starting equipment:" +
		"\n \u2022 Any two simple weapons;" +
		"\n \u2022 A light crossbow and 20 bolts;" +
		"\n \u2022 Studded leather armor -or- scale mail;" +
		"\n \u2022 Thieves' tools and a dungeoneer's pack;" +
		"\n\nAlternatively, choose 5d4 \xD7 10 gp worth of starting equipment instead of both the class' and the background's starting equipment.",
	subclasses : ["Artificer Specialist", []],
	attacks : [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
	spellcastingFactor : 2,
	spellcastingFactorRoundupMulti : true,
	spellcastingTable : [[0, 0, 0, 0, 0, 0, 0, 0, 0]].concat(levels.map(function (n) {
		return defaultSpellTable[Math.ceil(n / 2)];
	})),
	spellcastingKnown : {
		cantrips : [2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4],
		spells : "list",
		prepared : true
	},
	features : {
		"magical tinkering" : {
			name : "Magical Tinkering",
			source : [["E:RLW", 55], ["T", 11]],
			minlevel : 1,
			description : desc([
				"As an action, I use thieves/artisan's tools to give 1 property to a nonmagical tiny object:",
				" \u2022 Emit light (5-ft radius bright light, equal dim), an odor, or a nonverbal sound",
				" \u2022 Static visual effect on one surface, or emit a 6-second recorded message when tapped",
				"If I instill a property in more objects than I can have active, the oldest loses its property"
			]),
			additional : "Intelligence modifier of active objects",
			action : [["action", " (add/remove)"]],
			"infuse item" : {
				name : "Infuse Item",
				extraname : "Artificer 2",
				source : [["E:RLW", 57]],
				description : desc([
					"When I finish a long rest, I can turn nonmagical objects into magic items using my infusions",
					"I can attune to it immediately; If I infuse too many items, the oldest loses its magic",
					"The infusion lasts until my death + my Int mod in days, but ends if I unlearn the infusion",
					"Each infusion can only be used in one item at a time and only in appropriate items",
					"Whenever I gain an artificer level, I can replace an infusion I know with another",
					"I can use an infused item as a spellcasting focus"
				]),
				additional : levels.map(function (n) {
					return n < 2 ? "" : (n < 6 ? 4 : n < 10 ? 6 : n < 14 ? 8 : n < 18 ? 10 : 12) + " infusions known; max " + (n < 6 ? 2 : n < 10 ? 3 : n < 14 ? 4 : n < 18 ? 5 : 6) + " infused items";
				})
			},
			autoSelectExtrachoices : [{
				extrachoice : "infuse item",
				minlevel : 2
			}]
		},
		"spellcasting" : {
			name : "Spellcasting",
			source : [["E:RLW", 55], ["T", 11]],
			minlevel : 1,
			description : desc([
				"I can cast prepared artificer cantrips/spells, using Intelligence as my spellcasting ability",
				"To cast, I must use thieves' or artisan's tools I'm proficient with as a spellcasting focus",
				"I can cast my prepared artificer spells as rituals if they have the ritual tag",
				"Whenever I gain an artificer level, I can swap one artificer cantrip I know for another"
			]),
			additional : levels.map(function (n, idx) {
				return [2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4][idx] + " cantrips known";
			}),
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (!spellObj.psionic && spName == "artificer" && spellObj.compMaterial === SpellsList[spellKey].compMaterial) {
							var extraFocus = classes.known.artificer.subclass.indexOf("artillerist") !== -1 && classes.known.artificer.level > 4 ? "my arcane firearm, " : classes.known.artificer.subclass.indexOf("armorer") !== -1 && classes.known.artificer.level > 2 ? "my arcane armor, " : "";
							spellObj.compMaterial = (spellObj.compMaterial ? spellObj.compMaterial + ".\n\nAlso a" : "A") + "lways requires my artificer spellcasting focus: thieves' tools, any set of artisan's tools I'm proficient with, " + extraFocus + "or an item infused by me.";
							if (GetFeatureChoice("classes", "artificer", "spellcasting", true).indexOf("don't change component column on spell sheet") != -1) {
								// do nothing if set to do so
							} else if (!spellObj.components) {
								spellObj.components = "M\u0192";
							} else if (spellObj.components.indexOf("M") == -1) {
								spellObj.components += ",M\u0192";
							} else if ((/M([^\u0192\u2020]|$)/).test(spellObj.components)) {
								spellObj.components = spellObj.components.replace("M", "M\u0192");
							}
							return true;
						}
						return false;
					},
					"My artificer spells always require me to use a spellcasting focus: thieves' tools, artisan's tools I'm proficient with, or an item infused by me."
				]
			},
			extrachoices : ["Don't change component column on spell sheet"],
			extraname : "Artificer Spellcasting",
			"don't change component column on spell sheet" : {
				name : "[Meta] Don't alter spell sheets",
				source : [["E:RLW", 55], ["T", 11]],
				description : "\n   The automation will not add M\u0192 to each artificer spell on the generated spell sheets"
			}
		},
		"infuse item" : {
			name : "Infuse Item",
			source : [["E:RLW", 57], ["T", 12]],
			minlevel : 2,
			description : '\n   Use the "Choose Feature" button above to add Artificer Infusions to the third page',
			additional : levels.map(function (n) {
				return n < 2 ? "" : (n < 6 ? 4 : n < 10 ? 6 : n < 14 ? 8 : n < 18 ? 10 : 12) + " infusions known; max " + (n < 6 ? 2 : n < 10 ? 3 : n < 14 ? 4 : n < 18 ? 5 : 6) + " infused items";
			}),
			extraname : "Artificer Infusion",
			extrachoices : ["Boots of the Winding Path (prereq: level 6 artificer)", "Enhanced Arcane Focus", "Enhanced Defense (armor)", "Enhanced Defense (shield)", "Enhanced Weapon", "Homunculus Servant", "Radiant Weapon (prereq: level 6 artificer)", "Repeating Shot", "Repulsion Shield (prereq: level 6 artificer)", "Resistant Armor (prereq: level 6 artificer)", "Returning Weapon"],
			extraTimes : levels.map(function (n) {
				return n < 2 ? 0 : n < 6 ? 4 : n < 10 ? 6 : n < 14 ? 8 : n < 18 ? 10 : 12;
			}),
			"boots of the winding path (prereq: level 6 artificer)" : {
				name : "Boots of the Winding Path",
				source : [["E:RLW", 62], ["T", 21]],
				description : desc([
					"The wearer can use a bonus action to teleport up to 15 ft to an unoccupied space it can see",
					"It must be a space that the wearer had occupied some time during the current turn"
				]),
				additional : "pair of boots; requires attunement",
				prereqeval : function(v) { return classes.known.artificer.level >= 6; },
				magicitemsAdd : ["Boots of the Winding Path"]
			},
			"enhanced arcane focus" : {
				name : "Enhanced Arcane Focus",
				source : [["E:RLW", 62], ["T", 21]],
				description : "\n   The holder has a bonus to spell attack rolls and ignores half cover with spell attacks",
				additional : levels.map(function (n) {
					return "rod/staff/wand; attunement; +" + (n < 10 ? 1 : 2);
				}),
				eval : function (lvl, chc) {
					AddMagicItem("Enhanced Arcane Focus +" + (classes.known.artificer.level < 10 ? 1 : 2));
				},
				removeeval : function (lvl, chc) {
					RemoveMagicItem("enhanced arcane focus, +1 or +2");
				}
			},
			"enhanced defense (armor)" : {
				name : "Enhanced Defense",
				source : [["E:RLW", 62], ["T", 21]],
				description : "",
				additional : levels.map(function (n) {
					return "armor/shield; +" + (n < 10 ? 1 : 2) + " magical";
				}),
				prereqeval : function(v) {
					return GetFeatureChoice("classes", "artificer", "infuse item", true).indexOf("enhanced defense (shield)") == -1;
				},
				eval : function (lvl, chc) {
					AddMagicItem("Armor +" + (classes.known.artificer.level < 10 ? 1 : 2));
				},
				removeeval : function (lvl, chc) {
					RemoveMagicItem("armor, +1, +2, or +3");
				}
			},
			"enhanced defense (shield)" : {
				name : "Enhanced Defense",
				source : [["E:RLW", 62], ["T", 21]],
				description : "",
				additional : levels.map(function (n) {
					return "armor/shield; +" + (n < 10 ? 1 : 2) + " magical";
				}),
				prereqeval : function(v) {
					return GetFeatureChoice("classes", "artificer", "infuse item", true).indexOf("enhanced defense (armor)") == -1;
				},
				eval : function (lvl, chc) {
					AddMagicItem("Shield +" + (classes.known.artificer.level < 10 ? 1 : 2));
				},
				removeeval : function (lvl, chc) {
					RemoveMagicItem("shield, +1, +2, or +3");
				}
			},
			"enhanced weapon" : {
				name : "Enhanced Weapon",
				source : [["E:RLW", 62], ["T", 21]],
				description : "",
				additional : levels.map(function (n) {
					return "simple/martial weapon; +" + (n < 10 ? 1 : 2) + " magical";
				}),
				eval : function (lvl, chc) {
					AddMagicItem("Weapon +" + (classes.known.artificer.level < 10 ? 1 : 2));
				},
				removeeval : function (lvl, chc) {
					RemoveMagicItem("weapon, +1, +2, or +3");
				}
			},
			"homunculus servant" : {
				name : "Homunculus Servant",
				source : [["E:RLW", 62], ["T", 21]],
				description : desc([
					"The item I infuse becomes the heart of a homunculus that immediately forms around it",
					"I determine its appearance; It is friendly to me and my allies and obeys my commands",
					'See "Homunculus Servant" on a companion page to see its game statistics'
				]),
				additional : "gem or crystal of 100+ gp",
				action : [["bonus action", " (command)"]],
				creaturesAdd : [["Homunculus Servant"]],
				creatureOptions : [{
					name : "Homunculus Servant",
					source : [["E:RLW", 62], ["T", 22]],
					size : 5,
					type : "Construct",
					alignment : "Neutral",
					ac : 13,
					hp : 3,
					hd : [2, 4],
					hdLinked : ["artificer"],
					speed : "20 ft, fly 30 ft",
					scores : [4, 15, 12, 10, 10, 7],
					saves : ["", 4, "", "", "", ""],
					skills : {
						"perception" : 4,
						"stealth" : 4
					},
					damage_immunities : "poison",
					condition_immunities : "exhaustion, poisoned",
					senses : "Darkvision 60 ft",
					passivePerception : 14,
					languages : "understands the languages of its creator but can't speak",
					challengeRating : "0",
					proficiencyBonus : 2,
					proficiencyBonusLinked : true,
					attacksAction : 1,
					attacks : [{
						name : "Force Strike",
						ability : 4,
						damage : [1, 4, "force"],
						range : "30 ft",
						description : "",
						modifiers : ["", "Prof"],
						abilitytodamage : false,
						useSpellMod : "artificer"
					}],
					features : [{
						name : "Creator",
						description : "The homunculus obeys the commands of its creator and has the same proficiency bonus. It takes its turn immediately after its creator, on the same initiative count. It can move and take reactions on its own, but only takes the Dodge action on its turn unless its creator takes a bonus action to command it to take another action. If its creator is incapacitated, it can take any action, not just Dodge."
					}],
					traits : [{
						name : "Healing",
						description : "The homunculus regains 2d6 hit points whenever the Mending spell is cast on it. Its HP total is equal to 1 + its creator's artificer level + its creator's Intelligence modifier. If it or its creator dies, the homunculus vanishes, leaving its heart in its space."
					}, {
						name : "Evasion",
						description : "If the homunculus is subjected to an effect that allows it to make a Dexterity saving throw to take only half damage, it instead takes no damage if it succeeds on the saving throw, and only half damage if it fails. It can't use this trait if it's incapacitated."
					}],
					actions : [{
						name : "Channel Magic",
						description : "As a reaction, the homunculus delivers a spell cast by its creator that has a range of touch. The homunculus must be within 120 ft of its creator to do so."
					}],
					header : "Construct",
					calcChanges : {
						hp : function (totalHD, HDobj, prefix) {
							if (!classes.known.artificer) return;
							var intMod = Number(What('Int Mod'));
							var artLvl = classes.known.artificer.level;
							HDobj.alt.push(1 + intMod + artLvl);
							HDobj.altStr.push(" = 1 as a base\n + " + intMod + " from its creator's Intelligence modifier\n + " + artLvl + " from its creator's artificer level");
						},
						setAltHp : true,
						hpForceRecalc : true
					}
				}]
			},
			"radiant weapon (prereq: level 6 artificer)" : {
				name : "Radiant Weapon",
				source : [["E:RLW", 62], ["T", 22]],
				description : desc([
					"The weapon has a +1 bonus to attack and damage rolls made with it and it sheds light",
					"As a bonus action, its wielder can start/stop the light, 30-ft radius bright + 30 ft dim light",
					"The weapon has 4 charges, regaining 1d4 expended charges daily at dawn",
					"As a reaction when hit by an attack, the wielder can expend 1 charge to blind its attacker",
					"The attacker makes a Con save (my spell save DC) or is blinded until its next turn ends"
				]),
				additional : "simple/martial weapon; requires attunement",
				prereqeval : function(v) { return classes.known.artificer.level >= 6; },
				magicitemsAdd : ["Radiant Weapon"]
			},
			"repeating shot" : {
				name : "Repeating Shot",
				source : [["E:RLW", 62], ["T", 22]],
				description : desc([
					"The weapon requiring ammunition has a +1 bonus to attack and damage rolls made with it",
					"It magically produces one piece of ammunition whenever it is used to make a ranged attack",
					"Thus, it doesn't require ammunition and ignores the loading property if it has it"
				]),
				additional : "weapon with ammo; requires attunement",
				magicitemsAdd : ["Repeating Shot"]
			},
			"repulsion shield (prereq: level 6 artificer)" : {
				name : "Repulsion Shield",
				source : [["E:RLW", 63], ["T", 23]],
				description : desc([
					"The shield gives its wearer an extra +1 bonus to AC; It has 4 charges, regaining 1d4 daily",
					"As a reaction when hit in melee, the wearer can use 1 charge to push the attacker 15 ft"
				]),
				additional : "shield; requires attunement",
				prereqeval : function(v) { return classes.known.artificer.level >= 6; },
				magicitemsAdd : ["Repulsion Shield"]
			},
			"resistant armor (prereq: level 6 artificer)" : {
				name : "Resistant Armor",
				source : [["E:RLW", 63], ["T", 23]],
				description : desc([
					"The armor gives its wearer resistance to one type of damage, chosen at the time of infusion",
					"Choose from: acid,	cold, fire, force, lightning, necrotic, poison, psychic, radiant, or thunder"
				]),
				additional : "suit of armor; requires attunement",
				prereqeval : function(v) { return classes.known.artificer.level >= 6; },
				magicitemsAdd : ["Armor of Resistance"]
			},
			"returning weapon" : {
				name : "Returning Weapon",
				source : [["E:RLW", 63], ["T", 23]],
				description : "After being used for a ranged attack, the weapon returns immediately; +1 magical bonus",
				additional : "weapon with the thrown property",
				magicitemsAdd : ["Returning Weapon"]
			}
		},
		"the right tool for the job" : {
			name : "The Right Tool for the Job",
			source : [["E:RLW", 57], ["T", 13]],
			minlevel : 3,
			description : "\n   In 1 hour (during a rest) I can create a set of artisan's tools that last until I do so again",
			additional : "using thieves' or artisan's tools"
		},
		"subclassfeature3" : {
			name : "Artificer Specialist",
			source : [["E:RLW", 57], ["T", 13]],
			minlevel : 3,
			description : desc([
				'Choose a specialism and put it in the "Class" field on the first page',
				"Choose either alchemist, artillerist, or battle smith"
			])
		},
		"tool expertise" : {
			name : "Tool Expertise",
			source : [["E:RLW", 57], ["T", 13]],
			minlevel : 6,
			description : " [expertise with all tools I'm proficient with]",
			skillstxt : "Expertise with all tools I'm proficient with",
			eval : function () { Checkbox('Too Exp', true); },
			removeeval : function () { Checkbox('Too Exp', false); }
		},
		"flash of genius" : {
			name : "Flash of Genius",
			source : [["E:RLW", 57], ["T", 13]],
			minlevel : 7,
			description : "\n   As a reaction when I or another in 30 ft make a check/save, I can add my Int mod to it",
			action : [["reaction", ""]],
			usages : "Intelligence modifier per ",
			usagescalc : "event.value = Math.max(1, What('Int Mod'));",
			recovery : "long rest"
		},
		"magic item adept" : {
			name : "Magic Item Adept",
			source : [["E:RLW", 57], ["T", 13]],
			minlevel : 10,
			description : "\n   It takes me half the normal time and gold to craft common and uncommon magic items",
			additional : levels.map(function (n) {
				return n < 10 ? "" : "attune to " + (n < 14 ? 4 : n < 18 ? 5 : 6) + " magic items";
			})
		},
		"spell-storing item" : {
			name : "Spell-Storing Item",
			source : [["E:RLW", 58], ["T", 13]],
			minlevel : 11,
			description : desc([
				"When I finish a long rest, I can infuse a 1st-/2nd-level artificer spell into an item I touch",
				"It has to be a weapon or spellcasting focus for me; Stored spells are lost if I do this again",
				"The spell must have a casting time of 1 action, but I need not have it prepared",
				"A creature holding an infused item can use an action to cast the spell, using my abilities"
			]),
			additional : "cast stored spell",
			usages : "2\xD7 Int mod per ",
			usagescalc : "event.value = Math.max(2, Number(What('Int Mod')) * 2);",
			recovery : "long rest"
		},
		"magic item savant" : {
			name : "Magic Item Savant",
			source : [["E:RLW", 58], ["T", 14]],
			minlevel : 14,
			description : " [ignore class/race/spell/level attune require.]"
		},
		"soul of artifice" : {
			name : "Soul of Artifice",
			source : [["E:RLW", 58], ["T", 14]],
			minlevel : 20,
			description : " [+1 on all saves per attuned magic item]\n   As a reaction when I'm reduced to 0 HP, I can end one infusion to drop to 1 HP instead",
			action : [["reaction", ""]],
			savetxt : {
				text : ["+1 to all saves per attuned magic item"]
			}
		}
	},
	prereqLvl6 : function(v) { return classes.known.artificer.level >= 6; },
	prereqLvl10 : function(v) { return classes.known.artificer.level >= 10; },
	prereqLvl14 : function(v) { return classes.known.artificer.level >= 14; },
};

// Set the Artificer infusion list for Replicate Magic Item
RunFunctionAtEnd(function() {
	var artMi = [
		// 2nd-level artificer
		["alchemy jug", 2],
		["bag of holding", 2],
		["cap of water breathing", 2],
		["goggles of night", 2],
		["rope of climbing", 2],
		["sending stones", 2],
		["wand of magic detection", 2],
		["wand of secrets", 2],
		// 6th-level artificer
		["boots of elvenkind", 6],
		["cloak of elvenkind", 6],
		["cloak of the manta ray", 6],
		["eyes of charming", 6],
		["gloves of thievery", 6],
		["lantern of revealing", 6],
		["pipes of haunting", 6],
		["ring of water walking", 6],
		// 10th-level artificer
		["boots of striding and springing", 10],
		["boots of the winterlands", 10],
		["bracers of archery", 10],
		["brooch of shielding", 10],
		["cloak of protection", 10],
		["eyes of the eagle", 10],
		["gauntlets of ogre power", 10],
		["gloves of missile snaring", 10],
		["gloves of swimming and climbing", 10],
		["hat of disguise", 10],
		["headband of intellect", 10],
		["helm of telepathy", 10],
		["medallion of thoughts", 10],
		["necklace of adaptation", 10], // TCoE addition
		["periapt of wound closure", 10],
		["pipes of the sewers", 10],
		["quiver of ehlonna", 10],
		["ring of jumping", 10],
		["ring of mind shielding", 10],
		["slippers of spider climbing", 10],
		["ventilating lung", 10],
		["winged boots", 10],
		// 14th-level artificer
		["amulet of health", 14],
		["arcane propulsion arm", 14],
		["belt of giant strength", 14, "hill (str 21, rare)"],
		["boots of levitation", 14],
		["boots of speed", 14],
		["bracers of defense", 14],
		["cloak of the bat", 14],
		["dimensional shackles", 14],
		["gem of seeing", 14],
		["horn of blasting", 14],
		["ring of free action", 14],
		["ring of protection", 14],
		["ring of the ram", 14]
	];
	// add all common items (except potions and scrolls)
	for (var mi in MagicItemsList) {
		var aMI = MagicItemsList[mi];
		if (aMI.type && !(/potion|scroll/i).test(aMI.type) &&
			( (!aMI.rarity && aMI.choices) || (aMI.rarity && aMI.rarity.toLowerCase() === "common") )
		) {
			// only look at choices if the main object has no rarity (i.e. the choices have different rarities)
			if (!aMI.rarity && aMI.choices) {
				for (var c = 0; c < aMI.choices.length; c++) {
					var choiceNmLC = aMI.choices[c].toLowerCase();
					var aMIchoice = aMI[choiceNmLC];
					// skip if not common rarity or a potion or a scroll
					if (!aMIchoice || !aMIchoice.rarity || aMIchoice.rarity.toLowerCase() !== "common" || (/potion|scroll/i).test(aMIchoice.type)) continue;
					artMi.push([mi, 0, choiceNmLC]);
				}
			} else {
				// the main object has rarity "common", so add it as a whole
				artMi.push([mi]);
			}
		}
	}
	var theObj = ClassList.artificer.features["infuse item"];
	for (var a = 0; a < artMi.length; a++) {
		var MI0 = artMi[a][0];
		var MI1 = artMi[a][1];
		var MI2 = artMi[a][2];
		var anArtMi = MagicItemsList[MI0];
		if (!anArtMi) continue;
		if (MI2 && anArtMi[MI2]) {
			anArtMi = {
				name : anArtMi[MI2].name ? anArtMi[MI2].name : anArtMi.name + " [" + MI2.capitalize() + "]",
				rarity : anArtMi[MI2].rarity ? anArtMi[MI2].rarity : anArtMi.rarity,
				source : anArtMi[MI2].source ? anArtMi[MI2].source : anArtMi.source,
				attunement : anArtMi[MI2].attunement !== undefined ? anArtMi[MI2].attunement : anArtMi.attunement
			}
		}
		var theI = anArtMi.name + (MI1 ? " (prereq: level " + MI1 + " artificer)" : "");
		var theILC = theI.toLowerCase();
		if (theObj[theILC]) continue;
		theObj[theILC] = {
			name : anArtMi.name,
			description : "",
			source : anArtMi.source,
			magicitemsAdd : [anArtMi.name],
			additional : anArtMi.attunement ? "requires attunement" : undefined,
			prereqeval : MI1 && MI1 > 2 ? ClassList.artificer["prereqLvl" + MI1] : undefined,
			submenu : "Replicate Magic Item" + (MI1 ? " (prereq: level " + (" "+MI1).slice(-2) + " artificer)" : " (common magic items) [" + getLetterRange(anArtMi.name, ["A-F", "G-Q", "R-Z"]) + "]")
		};
		theObj.extrachoices.push(theI);
	};
});

// Add the Alchemist specialism
AddSubClass("artificer", "alchemist", {
	regExpSearch : /^(?=.*alchemist)(?!.*wizard).*$/i,
	subname : "Alchemist",
	fullname : "Alchemist",
	source : [["E:RLW", 58], ["T", 14]],
	features : {
		"subclassfeature3" : {
			name : "Tools Proficiency",
			source : [["E:RLW", 58], ["T", 14]],
			minlevel : 3,
			description : " [proficient with alchemist's supplies]",
			toolProfs : ["Alchemist's supplies"],
			spellcastingExtra : ["healing word", "ray of sickness", "flaming sphere", "melf's acid arrow", "gaseous form", "mass healing word", "blight", "death ward", "cloudkill", "raise dead"]
		},
		"subclassfeature3.1" : {
			name : "Experimental Elixir",
			source : [["E:RLW", 58], ["T", 14]],
			minlevel : 3,
			description : desc([
				"When I finish a long rest I can produce a number of elixirs in empty flasks I touch",
				"Also, as an action, I can expend a spell slot to create one elixir in a touched empty flask",
				"I need alchemist supplies on my person to do this; An elixir lasts until my next long rest",
				"For their effects, see the experimental elixir table on a Notes page; They work like potions"
			]),
			additional : levels.map(function (n) {
				return n < 3 ? "" : "create " + (n < 6 ? 1 : n < 15 ? 2 : 3) + " elixir" + (n < 6 ? "" : "s") + " after finishing a long rest";
			}),
			action : [["action", ""]],
			toNotesPage : [{
				name : "Experimental Elixir Table",
				note : [
					"Whenever I finish a long rest, I can magically produce a number of experimental elixir in empty flasks I touch. I can create one at 3rd level, two at 6th level, and three at 15th level.",
					"Creating an experimental elixir requires me to have alchemist's supplies on my person, and any elixir created like this lasts until it is drunk or until the end of my next long rest.",
					"I can create additional experimental elixirs by expending a spell slot of 1st level or higher for each one. When I do so, I use my action to create the elixir in an empty flask I touch.",
					"As an action, a creature can drink the elixir or administer it to an incapacitated creature.",
					"The effect of an elixir when someone drinks it is found on the table below. Roll to determine the effect for each elixir I create when finishing a long rest. I can choose the effect from the table for those created by expending a spell slot.",
					"\n  D6\tEFFECT",
					"1\tHealing: The drinker regains a number of hit points equal to 2d4 + my Intelligence modifier.",
					"2\tSwiftness: The drinker's walking speed increases by 10 ft for 1 hour.",
					"3\tResilience: The drinker gains a +1 bonus to AC for 10 minutes.",
					"4\tBoldness: The drinker can roll a d4 and add the number rolled to every attack roll and saving throw they make for the next minute.",
					"5\tFlight: The drinker gains a flying speed of 10 ft for 10 minutes.",
					"6\tTransformation: The drinker's body is transformed as if by the alter self spell. The drinker determines the transformation caused by the spell, the effects of which last for 10 minutes."
				]
			}]
		},
		"subclassfeature5" : {
			name : "Alchemical Savant",
			source : [["E:RLW", 58], ["T", 15]],
			minlevel : 5,
			description : desc([
				"When I cast spells using alchemist's supplies as my spellcasting focus, I can enhance them",
				"I add my Int mod to one roll of acid, fire, necrotic, or poison damage, or restoring HP"
			]),
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (v.thisWeapon[3] && v.thisWeapon[4].indexOf("artificer") !== -1 && (/acid|fire|necrotic|poison/i).test(fields.Damage_Type)) {
							output.extraDmg += Math.max(Number(What("Int Mod")), 1);
						}
					},
					"Artificer spells that deal acid, fire, necrotic, or poison damage which I cast while using alchemist's supplies as my spellcasting focus, have my Intelligence modifier (min 1) added to one damage die roll."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellObj.psionic || spName !== "artificer") return;
						var toAdd = Math.max(Number(What("Int Mod")), 1);
						if (genericSpellDmgEdit(spellKey, spellObj, "acid|fire|necro\\.?|necrotic|poison", toAdd, true, true) || genericSpellDmgEdit(spellKey, spellObj, "heal", toAdd, true, true)) {
							return true;
						}
					},
					"Artificer spells I cast using alchemist's supplies as my spellcasting focus, have my Intelligence modifier (min 1) added to one die rolled for dealing acid, fire, necrotic, or poison damage, or when restoring hit points."
				]
			}
		},
		"subclassfeature9" : {
			name : "Restorative Reagents",
			source : [["E:RLW", 59], ["T", 15]],
			minlevel : 9,
			description : desc([
				"Drinking my experimental elixirs now also grants 2d6 + my Int mod in temp HP (min 1)",
				"I can cast Lesser Restoration with alchemist's supplies without a spell slot (Int mod times)"
			]),
			usages : "Int mod per ",
			usagescalc : "event.value = Math.max(1, What('Int Mod'));",
			recovery : "long rest",
			limfeaname : "Restorative Reagents: Lesser Restoration",
			spellcastingBonus : {
				name : "Restorative Reagents",
				spells : ["lesser restoration"],
				selection : ["lesser restoration"],
				firstCol : "Sp"
			},
			spellChanges : {
				"lesser restoration" : {
					components : "V,S,M\u0192",
					compMaterial : "Alchemist's supplies",
					changes : "When using my Restorative Reagents class feature, I can cast Lesser Restoration a number of times per long rest equal to my Intelligence modifier. To do so, I have to use alchemist's supplies as my spellcasting focus."
				}
			}
		},
		"subclassfeature15" : {
			name : "Chemical Mastery",
			source : [["E:RLW", 59], ["T", 15]],
			minlevel : 15,
			description : " [each spell 1\xD7 per long rest]" + desc([
				"I have resistance to acid and poison damage and immunity to being poisoned",
				"I can cast Greater Restoration and Heal each once per long rest without a spell slot",
				"I need alchemist's supplies as a focus for it, but the spells require no material components"
			]),
			dmgres : ["Acid", "Poison"],
			savetxt : { immune : ["poisoned condition"] },
			extraLimitedFeatures : [{
				name : "Chemical Mastery: Greater Restoration",
				usages : 1,
				recovery : "long rest"
			}, {
				name : "Chemical Mastery: Heal",
				usages : 1,
				recovery : "long rest"
			}],
			spellcastingBonus : {
				name : "Chemical Mastery",
				spells : ["greater restoration", "heal"],
				selection : ["greater restoration", "heal"],
				firstCol : "oncelr",
				times : 2
			},
			spellChanges : {
				"greater restoration" : {
					components : "V,S,M\u0192",
					compMaterial : "Alchemist's supplies",
					description : "Reduce exhaustion 1 lvl or end charm, petrify, curse, one ability score reduction, or max HP reduction",
					changes : "When using my Chemical Mastery class feature and alchemist's supplies as my spellcasting focus, I can cast Greater Restoration once per long rest without using a spell slot or requiring other material components."
				},
				"heal" : {
					components : "V,S,M\u0192",
					compMaterial : "Alchemist's supplies",
					allowUpCasting : false,
					changes : "When using my Chemical Mastery class feature and alchemist's supplies as my spellcasting focus, I can cast Heal once per long rest without using a spell slot."
				}
			}
		}
	}
});

// Add the Artillerist specialism
AddSubClass("artificer", "artillerist", {
	regExpSearch : /^(?=.*artillerist)(?!.*wizard).*$/i,
	subname : "Artillerist",
	fullname : "Artillerist",
	source : [["E:RLW", 59], ["T", 17]],
	features : {
		"subclassfeature3" : {
			name : "Tools Proficiency",
			source : [["E:RLW", 59], ["T", 17]],
			minlevel : 3,
			description : " [proficient with woodcarver's tools]",
			toolProfs : ["Woodcarver's tools"],
			spellcastingExtra : ["shield", "thunderwave", "scorching ray", "shatter", "fireball", "wind wall", "ice storm", "wall of fire", "cone of cold", "wall of force"]
		},
		"subclassfeature3.1" : {
			name : "Eldritch Cannon",
			source : [["E:RLW", 59], ["T", 17]],
			minlevel : 3,
			description : desc([
				"As an action, I can use woodcarver's or smith's tools to create an eldritch cannon in 5 ft",
				"I can do this once per long rest, or by expending a spell slot (SS 1+) to create one cannon",
				"I decide its size (Small/Tiny), appearance, type: flamethrower, force ballista, or protector",
				"It disappears after 1 hour, when reduced to 0 HP, or if I dismiss it as an action",
				"As a bonus action when within 60 ft of it, I can activate it to move and do its action",
				"I can't have multiple cannons; Select \"Eldritch Cannon\" on a companion page for its stats"
			]),
			usages : 1,
			recovery : "long rest",
			altResource : "SS 1+",
			additional : levels.map(function(n) {
				return n < 3 ? "" : n < 15 ? "create 1 cannon" : "create 2 cannons";
			}),
			action : [["action", " (summon/dismiss)"], ["bonus action", " (activate)"]],
			creaturesAdd : [["Eldritch Cannon"]],
			creatureOptions : [{
				name : "Eldritch Cannon",
				source : [["E:RLW", 59], ["T", 17]],
				size : [4, 5],
				type : "Object",
				alignment : "",
				ac : 18,
				hp : 5,
				hd : ["", ""],
				speed : "15 ft, climb 15 ft",
				scores : [10, 10, 10, 10, 10, 10],
				damage_immunities : "poison, psychic",
				passivePerception : 10,
				senses : "",
				challengeRating : "1",
				proficiencyBonus : 2,
				proficiencyBonusLinked : true,
				attacksAction : 0,
				attacks : [{
					name : "Flamethrower",
					ability : 4,
					damage : [2, 8, "fire"],
					range : "15-ft cone",
					description : "Dex save, success - half damage; Unattended flammable objects ignite",
					dc : true,
					useSpellMod : "artificer",
					abilitytodamage : false,
					tooltip : "The cannon exhales fire in an adjacent 15-ft cone that its creator designates. Each creature in that area must make a Dexterity saving throw against its creator's artificer spell save DC, taking 2d8 fire damage on a failed save or half as much damage on a successful one. The fire ignites any flammable objects in the area that aren't being worn or carried."
				}, {
					name : "Force Ballista",
					ability : 4,
					damage : [2, 8, "force"],
					range : "120 ft",
					description : "Creature hit is pushed 5 ft away",
					useSpellMod : "artificer",
					abilitytodamage : false,
					tooltip : "The cannon's creator makes a ranged spell attack, originating from the cannon, at one creature or object within 120 ft of it. On a hit, the target takes 2d8 force damage, and if the target is a creature, it is pushed up to 5 ft away from the cannon."
				}, {
					name : "Detonate",
					ability : 4,
					damage : [3, 8, "force"],
					range : "20-ft radius",
					description : "Dex save, success - half damage; Destroys cannon",
					dc : true,
					useSpellMod : "artificer",
					abilitytodamage : false,
					tooltip : "As an action, its creator can command the cannon to deto­nate if its creator is within 60 ft of it. Doing so destroys the cannon and forces each creature within 20 ft of it to make a Dexterity saving throw against its creator's artificer spell save DC, taking 3d8 force damage on a failed save or half as much damage on a successful one."
				}],
				features : [{
					name : "Healing",
					description : "The cannon regains 2d6 HP whenever Mending is cast on it."
				}, {
					name : "Cannon Type",
					description : "Upon creation, the creator decides what type of cannon it is: Flamethrower, Force Ballista, or Protector. What feature/attack it can use depends on its type."
				}, {
					name : "Protector",
					description : "The cannon emits a burst of positive energy that grants itself and each creature of its creator's choice within 10 ft of it a number of temporary hit points equal to 1d8 + its creator's Intelligence modifier (minimum of +1)."
				}],
				traits : [{
					name : "Creator",
					description : "As an object, the cannon only acts when activated by its creator, uses its creator's artificer spell attack and save DC, and has five times the artificer level in HP. It disappears after 1 hour, when reduced to 0 HP, or when its creator dismisses it as an action."
				}, {
					name : "Activation",
					description : "The creator of the cannon can activate it as a bonus action while within 60 ft of it. Once activated, the cannon does as instructed, moves and uses the action associated with its type: flamethrower attack, force ballista attack, or protector feature."
				}, {
					name : "Detonate (Artillerist 9)",
					minlevel : 9,
					description : "The creator of the cannon, can use an action to detonate the cannon when within 60 ft of it, see the attack section. The cannon's attacks now deal 3d8 damage.",
					eval : function(prefix, lvl) {
						// add the Detonate attack entry
						Value(prefix + "Comp.Use.Attack.3.Weapon Selection", "Detonate");
						// Upgrade the damage for the attacks
						for (var i = 1; i <= 2; i++) {
							Value(prefix + "BlueText.Comp.Use.Attack." + i + ".Damage Die", "3d8");
						}
					},
					removeeval : function(prefix, lvl) {
						// remove the Detonate attack entry
						Value(prefix + "Comp.Use.Attack.3.Weapon Selection", "");
						// Reset the damage for the attacks
						for (var i = 1; i <= 2; i++) {
							Value(prefix + "BlueText.Comp.Use.Attack." + i + ".Damage Die", "2d8");
						}
					}
				}, {
					name : "Shimmering Field (Artillerist 15)",
					minlevel : 15,
					description : "The creator of the cannon and their allies have half cover while within 10 ft of the cannon."
				}],
				minlevelLinked : ["artificer"],
				header : "Object",
				calcChanges : {
					hp : function (totalHD, HDobj, prefix) {
						if (!classes.known.artificer) return;
						var artLvl = classes.known.artificer.level;
						HDobj.alt.push(5 * artLvl);
						HDobj.altStr.push(" = 5 \xD7 " + artLvl + " from five times its creator's artificer level");
					},
					setAltHp : true
				},
				eval : function(prefix, lvl) {
					// remove the Detonate attack if adding this creature before artificer level 9
					if (lvl[0] < 9) Value(prefix + "Comp.Use.Attack.3.Weapon Selection", "");
				}
			}]
		},
		"subclassfeature5" : {
			name : "Arcane Firearm",
			source : [["E:RLW", 59], ["T", 18]],
			minlevel : 5,
			description : " [lasts until I use this feature again]" + desc([
				"After a long rest, I can use woodcarver's tools to enhance a wand, staff, or rod",
				"If I use this as my spellcasting focus for an artificer spell, I add +1d8 to one damage"
			]),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.thisWeapon[3] && v.thisWeapon[4].indexOf("artificer") !== -1) {
							fields.Damage_Die = fields.Damage_Die.replace(/D/g, 'd');
							var d8Regex = /(\d+)d8/;
							if (fields.Damage_Die.indexOf('Bd8') != -1) {
								fields.Damage_Die = fields.Damage_Die.replace('Bd8', 'Cd8');
							} else if (fields.Damage_Die.indexOf('Cd8') != -1) {
								fields.Damage_Die = fields.Damage_Die.replace('Cd8', 'Qd8');
							} else if (d8Regex.test(fields.Damage_Die)) {
								fields.Damage_Die = fields.Damage_Die.replace(d8Regex, Number(fields.Damage_Die.replace(d8Regex, '$1')) + 1 + 'd8');
							} else if (v.thisWeapon[3] == "eldritch blast") {
								fields.Description += (fields.Description ? '; ' : '') + "One ray +1d8 dmg";
							} else {
								fields.Damage_Die += '+1d8';
							}
						}
					},
					"If I use my arcane firearm as a spellcasting focus for an artificer spell, I can add +1d8 to one of the spell's damage rolls.",
					10
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellObj.psionic || spName !== "artificer") return;
						return genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", "1d8", true, true);
					},
					"If I use my arcane firearm as a spellcasting focus for an artificer spell, I can add +1d8 to one of the spell's damage rolls."
				]
			}
		},
		"subclassfeature9" : {
			name : "Explosive Cannon",
			source : [["E:RLW", 60], ["T", 18]],
			minlevel : 9,
			description : "\n   My eldritch cannons deal +1d8 damage; As an action, I can detonate a cannon in 60 ft",
			action : [["action", "Eldritch Cannon (detonate)"]]
		},
		"subclassfeature15" : {
			name : "Fortified Position",
			source : [["E:RLW", 60], ["T", 18]],
			minlevel : 15,
			description : " [cannons grant half cover in 10 ft to allies]" + desc([
				"I can now have two cannons at the same time and activate both with one bonus action",
				"I can create 2 eldritch cannons with the same action (still only one with a spell slot)"
			])
		}
	}
});

// Add the Battle Smith specialism
AddSubClass("artificer", "battle smith", {
	regExpSearch : /^(?=.*battle)(?=.*smith)(?!.*wizard).*$/i,
	subname : "Battle Smith",
	fullname : "Battle Smith",
	source : [["E:RLW", 60], ["T", 18]],
	attacks : [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	features : {
		"subclassfeature3" : {
			name : "Battle Ready \u0026 Tool Proficiency",
			source : [["E:RLW", 61], ["T", 19]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with martial weapons and smith's tools",
				"I can use my Intelligence modifier instead of Strength or Dexterity for magic weapons"
			]),
			toolProfs : ["Smith's tools"],
			spellcastingExtra : ["heroism", "shield", "branding smite", "warding bond", "aura of vitality", "conjure barrage", "aura of purity", "fire shield", "banishing smite", "mass cure wounds"],
			weaponProfs : [false, true],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (!v.isSpell && (v.theWea.isMagicWeapon || v.thisWeapon[1]) && (fields.Mod === 1 || fields.Mod === 2) && Number(What("Int")) > Number(What(fields.Mod === 1 ? "Str" : "Dex"))) {
							fields.Mod = 4;
						}
					},
					'I can use my Intelligence modifier instead of Strength or Dexterity for the attack and damage rolls of magic weapons.'
				]
			}
		},
		"subclassfeature3.1" : {
			name : "Steel Defender",
			source : [["E:RLW", 61], ["T", 19]],
			minlevel : 3,
			description : desc([
				"When I end a long rest, I can use smith's tools to create a steel defender",
				"I determine its appearance; It obeys my commands and it acts on my initiative, after me",
				"Unless I use a bonus action to command it, it only takes the Dodge action on its turn",
				"It can take reactions and move on its turn even if I don't command it",
				"I can't have multiple at once; Select \"Steel Defender\" on a companion page for its stats"
			]),
			action : [["bonus action", " (command)"], ["action", " (restore)"]],
			creaturesAdd : [["Steel Defender"]],
			creatureOptions : [{
				name : "Steel Defender",
				source : [["E:RLW", 61], ["T", 19]],
				size : 3,
				type : "Construct",
				alignment : "Neutral",
				ac : 15,
				hp : 12,
				hd : [2, 8],
				hdLinked : ["artificer"],
				speed : "40 ft",
				scores : [14, 12, 14, 4, 10, 6],
				saves : ["", 3, 4, "", "", ""],
				skills : {
					"athletics" : 4,
					"perception" : 4
				},
				damage_immunities : "poison",
				condition_immunities : "charmed, exhaustion, poisoned",
				passivePerception : 14,
				senses : "Darkvision 60 ft",
				languages : "understands the languages of its creator but can't speak",
				challengeRating : "1",
				proficiencyBonus : 2,
				proficiencyBonusLinked : true,
				attacksAction : 1,
				attacks : [{
					name : "Force-Empowered Rend",
					ability : 4,
					damage : [1, 8, "piercing"],
					range : "Melee (5 ft)",
					description : "",
					modifiers : ["", "Prof"],
					abilitytodamage : false,
					useSpellMod : "artificer"
				}, {
					name : "Deflect Attack (reaction)",
					ability : 0,
					damage : [1, 4, "force"],
					range : "Melee (5 ft)",
					description : "After using the reaction, the attacker takes this damage, no attack roll required",
					modifiers : ["-Prof", "oInt"],
					abilitytodamage : false
				}],
				features : [{
					name : "Creator",
					description : "The steel defender obeys the commands of its creator and shares its proficiency bonus. It takes its turn immediately after its creator, on the same initiative count. It can move and take reactions on its own, but only takes the Dodge action on its turn unless its creator takes a bonus action to command it to take another action. If its creator is incapacitated, it can take any action, not just Dodge."
				}, {
					name : "Vigilant",
					description : "The " + (typePF ? "" : "steel ") + "defender can't be surprised."
				}],
				traits : [{
					name : "Healing",
					description : "The steel defender regains 2d6 HP whenever the Mending spell is cast on it. Its HP total is equal to 2 + its creator's artificer level times five + its creator's Int mod. Within an hour of its death, while within 5 ft, its creator can take an action to use smith's tools and expend a spell slot to have it return to full HP after 1 minute. If its creator dies, " + (typePF ? "the steel defender also perishes" : "so does it") + "."
				}],
				actions : [{
					name : "Repair (3/Day)",
					description : "As an action, the " + (typePF ? "" : "magical mechanisms inside the ") + "steel defender restore" + (typePF ? "s" : "") + " 2d8 + its proficiency bonus in HP to itself or to one construct or object within 5 ft of it."
				}, {
					name : "Deflect Attack (reaction)",
					description : typePF ? "As a reaction, the steel defender imposes disadvantage on the attack roll of one creature it can see that is within 5 ft of it, provided the attack roll is against a creature other than the defender." : "As a reaction, the defender imposes disadv. on the attack roll of one creature it can see within 5 ft, provided the creature attacks another than the defender."
				}, {
					name : "Arcane Jolt (Battle Smith 9)",
					minlevel : 9,
					eval : function(prefix, lvl) {
						Value(prefix + "Comp.Use.Attack.1.Description", "Arcane Jolt (1d6): On hit, deal force damage or heal target in 30 ft");
					},
					removeeval : function(prefix, lvl) {
						Value(prefix + "Comp.Use.Attack.1.Description", "");
					}
				}, {
					name : "Improved Defender (Battle Smith 15)",
					minlevel : 15,
					description : "The steel defender's Deflect Attack now deals 1d4 + its creator's Intelligence modifier in force damage to the attacker.",
					addMod : [{ type : "", field : "Comp.Use.AC", mod : 2, text : "The steel defender gains a +2 bonus to its AC (base AC of 15)." }],
					eval : function(prefix, lvl) {
						Value(prefix + "Comp.Use.Attack.1.Description", What(prefix + "Comp.Use.Attack.1.Description").replace("Arcane Jolt (1d6)", "Arcane Jolt (2d6)"));
						Value(prefix + "Comp.Use.Attack.2.Weapon Selection", "Deflect Attack (reaction)");
					},
					removeeval : function(prefix, lvl) {
						Value(prefix + "Comp.Use.Attack.1.Description", What(prefix + "Comp.Use.Attack.1.Description").replace("Arcane Jolt (2d6)", "Arcane Jolt (1d6)"));
						Value(prefix + "Comp.Use.Attack.2.Weapon Selection", "");
					}
				}],
				minlevelLinked : ["artificer"],
				header : "Construct",
				calcChanges : {
					hp : function (totalHD, HDobj, prefix) {
						if (!classes.known.artificer) return;
						var intMod = Number(What('Int Mod'));
						var artLvl = classes.known.artificer.level;
						var artLvl5 = 5 * artLvl;
						HDobj.alt.push(2 + intMod + artLvl5);
						HDobj.altStr.push(" = 2 as a base\n + " + intMod + " from its creator's Intelligence modifier\n + 5 \xD7 " + artLvl + " from five times its creator's artificer level (" + artLvl5 + ")");
					},
					setAltHp : true,
					hpForceRecalc : true
				},
				eval : function(prefix, lvl) {
					// remove the Deflect Attack (reaction) attack if adding this creature before artificer level 15
					if (lvl[0] < 15) Value(prefix + "Comp.Use.Attack.2.Weapon Selection", "");
				}
			}]
		},
		"subclassfeature9" : {
			name : "Arcane Jolt",
			source : [["E:RLW", 61], ["T", 20]],
			minlevel : 9,
			description : function () {
				var descr9 = desc([
					"Once per turn when my steel defender or magic weapon hits a target, I can have it:",
					" \u2022 Deal an extra +2d6 force damage to the target",
					" \u2022 Restore 2d6 HP to another target within 30 ft of the one that was hit"
				]);
				var descr15 = descr9.replace(/2d6/g, '4d6');
				return levels.map(function (n) {
					return n < 9 ? "" : n < 15 ? descr9 : descr15;
				});
			}(),
			usages : "Intelligence modifier per ",
			usagescalc : "event.value = Math.max(1, What('Int Mod'));",
			recovery : "long rest",
			additional : levels.map(function (n) {
				return n < 9 ? "" : (n < 15 ? 2 : 4) + "d6";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.theWea.isMagicWeapon || v.thisWeapon[1]) {
							fields.Description += (fields.Description ? '; ' : '') + 'Arcane Jolt (' + (classes.known.artificer && classes.known.artificer.level >= 15 ? 4 : 2) + 'd6)';
						}
					},
					"Once per turn when I hit with a magic weapon or my steel defender hits with its attack, I can use my Arcane Jolt class feature to have the hit either deal extra force damage or heal somebody within 30 ft of the target hit."
				]
			}
		},
		"subclassfeature15" : {
			name : "Improved Defender",
			source : [["E:RLW", 61], ["T", 20]],
			minlevel : 15,
			description : desc([
				"My defender's Deflect Attack now deals its attacker 1d4 + my Int mod force damage",
				"My arcane jolt damage/healing increases to 4d6; My steel defender gains +2 AC"
			])
		}
	}
});

// Add the new special magic items for the artificer class (infusions)
MagicItemsList["boots of the winding path"] = {
	name : "Boots of the Winding Path",
	source : [["E:RLW", 62], ["T", 21], ["UA:A2", 9], ["UA:A3", 12]],
	type : "wondrous item",
	description : "While wearing these boots, I can teleport up to 15 ft as a bonus action to an unoccupied space I can see, as long as I occupied that space at some point during the current turn.",
	descriptionFull : "While wearing these boots, a creature can teleport up to 15 feet as a bonus action to an unoccupied space the creature can see. The creature must have occupied that space at some point during the current turn.",
	attunement : true,
	action : [["bonus action", ""]]
}
MagicItemsList["enhanced arcane focus, +1 or +2"] = {
	name : "Enhanced Arcane Focus, +1 or +2",
	nameTest : /^(?=.*enhanced)(?=.*(arcane focus|rod|wand|staff)).*$/i,
	source : [["E:RLW", 62], ["T", 21]],
	type : "wondrous item",
	description : "While I am holding this arcane focus (rod, staff, or wand), I gain a +1 bonus to spell attack rolls (or +2 if the artificer that created it is level 10 or higher). In addition, I ignore half cover when making a spell attack.",
	descriptionFull : "While holding this rod, staff, or wand, a creature gains a +1 bonus to spell attack rolls. In addition, the creature ignores half cover when making a spell attack.\n   The bonus increases to +2 when it is created by someone with 10 levels or more in the artificer class.",
	attunement : true,
	weight : 1,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	choices : ["+1 to spell attacks", "+2 to spell attacks (artificer level 10+)"],
	"+1 to spell attacks" : {
		name : "Enhanced Arcane Focus +1",
		nameTest : /^(?=.*enhanced)(?=.*(arcane focus|rod|wand|staff))(?=.*\+1)(?!.*\+2).*$/i,
		description : "While I am holding this arcane focus (rod, staff, or wand), I gain a +1 bonus to spell attack rolls and I ignore half cover when making a spell attack.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type == "attack") return 1;
				},
				"I gain a +1 bonus to spell attack rolls."
			]
		}
	},
	"+2 to spell attacks (artificer level 10+)" : {
		name : "Enhanced Arcane Focus +2",
		nameTest : /^(?=.*enhanced)(?=.*(arcane focus|rod|wand|staff))(?!.*\+1)(?=.*\+2).*$/i,
		description : "While I am holding this arcane focus (rod, staff, or wand), I gain a +2 bonus to spell attack rolls and I ignore half cover when making a spell attack.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type == "attack") return 2;
				},
				"I gain a +2 bonus to spell attack rolls."
			]
		}
	}
}
MagicItemsList["radiant weapon"] = {
	name : "Radiant Weapon",
	nameTest : "Radiant",
	source : [["E:RLW", 62], ["T", 22]],
	type : "weapon (any)",
	description : "This item adds a +1 on its to hit and damage, has 4 charges, and regains 1d4 at dawn. As a bonus action, I can have it start/stop shedding light, bright in 30 ft, dim in another 30 ft. As a reaction if hit by an attack, I can use 1 charge to blind the attacker until the end of its next turn unless it makes a Con save (my spell DC).",
	descriptionFull : "This magic weapon grants a +1 bonus to attack and damage rolls made with it. While holding it, the wielder can take a bonus action to cause it to shed bright light in a 30-foot radius and dim light for an additional 30 feet. The wielder can extinguish the light as a bonus action.\n   The weapon has 4 charges. As a reaction immediately after being hit by an attack, the wielder can expend 1 charge and cause the attacker to be blinded until the end of the attacker's next turn, unless the attacker succeeds on a Constitution saving throw against your spell save DC. The weapon regains 1d4 expended charges daily at dawn.",
	attunement : true,
	usages : 4,
	recovery : "dawn",
	additional : "blind attacker; regains 1d4",
	action : [["bonus action", " (start/stop light)"], ["reaction", " (1 charge; after hit)"]],
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "weapon"]
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && !v.isSpell && (/radiant/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Reaction to blind attacker';
				}
			},
			'If I include the word "Radiant" in the name of a weapon, it will be treated as the magic weapon Radiant Weapon. It has +1 to hit and damage and can be used to shed light and to blind an attacker.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isMeleeWeapon && !v.isSpell && (/radiant/i).test(v.WeaponTextName)) {
					output.magic = v.thisWeapon[1] + 1;
				}
			}
		]
	}
}
MagicItemsList["repeating shot"] = {
	name : "Repeating Shot",
	source : [["E:RLW", 62], ["T", 22], ["UA:A3", 13]],
	type : "weapon (any with ammunition)",
	description : "When I use this magic weapon to make a ranged attack, it magically produces one piece of ammunition and grants a +1 bonus to its attack and damage rolls. Thus, it doesn't require ammunition and ignores the loading property if it has it. The produced ammunition vanishes once it hits or misses a target.",
	descriptionFull : "This magic weapon grants a +1 bonus to attack and damage rolls made with it when it's used to make a ranged attack, and it ignores the loading property if it has it.\n   If you load no ammunition in the weapon, it produces its own, automatically creating one piece of magic ammunition when you make a ranged attack with it. The ammunition created by the weapon vanishes the instant after it hits or misses a target.",
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "weapon"],
		excludeCheck : function (inObjKey, inObj) {
			return !(/ammunition/i).test(inObj.description);
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && !v.isSpell && (/^(?=.*repeating shot)(?=.*ammunition).*$/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '').replace(/(;|,)? ?loading/i, '');
				}
			},
			'If I include the words "Repeating Shot" in the name of a weapon with the ammunition property, it will be treated as the magic weapon Repeating Shot. It has +1 to hit and damage and produces its own ammunition, thus its loading property is removed if it has it.'
		],
		atkCalc : [
			function (fields, v, output) {
				if ((/^(?=.*repeating shot)(?=.*ammunition).*$/i).test(v.WeaponText) && !v.isSpell) {
					output.magic = v.thisWeapon[1] + 1;
				}
			}, ''
		]
	}
}
MagicItemsList["repulsion shield"] = {
	name : "Repulsion Shield",
	source : [["E:RLW", 63], ["T", 23]],
	type : "shield",
	description : "I gain an additional +1 bonus to Armor Class while wielding this shield. The shield has 4 charges and regains 1d4 expended charges daily at dawn. As a reaction immediately after being hit by a melee attack, I can expend 1 charge to push the attacker up to 15 ft away.",
	descriptionFull : "A creature gains a +1 bonus to Armor Class while wielding this shield.\n   The shield has 4 charges. While holding it, the wielder can use a reaction immediately after being hit by a melee attack to expend 1 of the shield's charges and push the attacker up to 15 feet away. The shield regains 1d4 expended charges daily at dawn.",
	weight : 6,
	attunement : true,
	usages : 4,
	additional : "regains 1d4",
	recovery : "dawn",
	action : [["reaction", " (1 charge)"]],
	shieldAdd : ["Repulsion Shield", 3, 6]
}
MagicItemsList["returning weapon"] = {
	name : "Returning Weapon",
	nameTest : "Returning",
	source : [["E:RLW", 63], ["T", 23], ["UA:A3", 14], ["UA:A2", 10]],
	type : "weapon (any thrown)",
	description : "This magic weapon grants a +1 bonus to attack and damage rolls I make with it. It returns to my hand immediately after I use it to make a ranged attack.",
	descriptionFull : "This magic weapon grants a +1 bonus to attack and damage rolls made with it, and it returns to the wielder's hand immediately after it is used to make a ranged attack.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "weapon"],
		excludeCheck : function (inObjKey, inObj) {
			return !/\bthrown\b/i.test(inObj.description);
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isThrownWeapon && /returning/i.test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Returns immediately after ranged attack';
				}
			},
			'If I include the word "Returning" in the name of a thrown weapon, it will be treated as the magic weapon Returning Weapon. It has +1 to hit and damage and returns to my hand immediately after I use it to make a ranged attack.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isThrownWeapon && /returning/i.test(v.WeaponText)) {
					output.magic = v.thisWeapon[1] + 1;
				}
			}, ''
		]
	}
}

// Magic Items
MagicItemsList["arcane propulsion arm"] = {
	name : "Arcane Propulsion Arm",
	source : [["E:RLW", 276]],
	type : "wondrous item",
	rarity : "very rare",
	description : "Once attached to my wrist, elbow, or shoulder, this prosthetic magically forms a copy of the appendage it's replacing. It can't be removed against my will, but I can as an action. I can use it as a proficient melee weapon with the thrown property. After a throwing attack with it, it returns and reattaches immediately.",
	descriptionFull : "This prosthetic appendage was developed by artificers of House Cannith. To attune to this item, you must attach it to your arm at the wrist, elbow, or shoulder, at which point the prosthetic magically forms a copy of the appendage it's replacing.\n\nWhile attached, the prosthetic provides these benefits:\n \u2022 The prosthetic is a fully capable part of your body.\n \u2022 You can take an action to remove the prosthetic, and it removes itself if your attunement to it ends. It can't be removed against your will.\n \u2022 The prosthetic is a magic melee weapon with which you're proficient. It deals 1d8 force damage on a hit and has the thrown property, with a normal range of 20 feet and a long range of 60 feet. When thrown, the prosthetic detaches and flies at the target of the attack, then immediately returns to you and reattaches.",
	attunement : true,
	prerequisite : "Requires attunement by a creature missing a hand or an arm",
	prereqeval : function (v) { return false; },
	weaponOptions : [{
		regExpSearch : /^(?=.*arcane)(?=.*propulsion)(?=.*arm).*$/i,
		name : "Arcane Propulsion Arm",
		source : [["E:RLW", 276]],
		ability : 1,
		type : "AlwaysProf",
		damage : [1, 8, "force"],
		range : "Melee, 20/60 ft",
		description : "Thrown; Returns immediately after thrown",
		abilitytodamage : true,
		selectNow : true
	}]
}
MagicItemsList["armblade"] = {
	name : "Armblade",
	source : [["E:RLW", 276]],
	type : "weapon (any one-handed melee weapon)",
	rarity : "common",
	description : "While attuned to it, this magic weapon is attached to my arm and inseparable from me. As a bonus action, I can retract it into my forearm or extend it from there. While it is extended, I can use the weapon as if I was holding it, and I can't use that hand for other purposes.",
	descriptionFull : "An armblade is a magic weapon that attaches to your arm, becoming inseparable from you as long as you're attuned to it. To attune to this item, you must hold it against your forearm for the entire attunement period.\n   As a bonus action, you can retract the armblade into your forearm or extend it from there. While it is extended, you can use the weapon as if you were holding it, and you can't use that hand for other purposes.",
	attunement : true,
	prerequisite : "Requires attunement by a warforged",
	prereqeval : function (v) { return (/warforged/i).test(CurrentRace.known); },
	allowDuplicates : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "brackets",
		descriptionChange : ["replace", "weapon"],
		excludeCheck : function (inObjKey, inObj) {
			return (!inObj.description || (/two.{0,3}handed/i).test(inObj.description)) || (!inObj.range || !(/melee/i).test(inObj.range));
		}
	}
}
MagicItemsList["belashyrra's beholder crown"] = {
	name : "Belashyrra's Beholder Crown",
	nameAlt : "Beholder Crown",
	source : [["E:RLW", 276]],
	type : "wondrous item",
	rarity : "legendary",
	description : "This symbiotic crown of dark purple and mauve stone attaches to my skull and removing it requires ending a curse. It allows me to see normally in magical and normal darkness (devil's sight) out to 120 ft. It has 10 charges, regaining 1d6+3 at dawn, which I can use to cast several spells with spell save DC 16.",
	descriptionLong : "This symbiotic crown of dark purple and mauve stone attaches to my skull once I attune to it and removing it requires ending a curse. It allows me to see normally in magical and normal darkness (devil's sight) out to 120 ft. It has 10 charges, regaining 1d6+3 at dawn, which I can use to cast several spells with spell save DC 16. These are: Charm Person (1 charge), Disintegrate (6 charges), Fear (3 charges), Finger of Death (7 charges), Flesh to Stone (6 charges), Hold Person (2 charges), Ray of Enfeeblement (2 charges), Sleep (1 charge), Slow (3 charges), and Telekinesis (5 charges).",
	descriptionFull : "This symbiotic crown is carved from dark purple and mauve stone, with ten points like stalks set with gemstones resembling the eyestalks of a beholder. To attune to this item, you must wear it on your head for the entire attunement period, during which the crown's hidden tendrils burrow into your scalp to bond with your skull.\n   While wearing the crown, you can see normally in darkness, both magical and nonmagical, to a distance of 120 feet.\n   " + toUni("Spells") + ". The crown has 10 charges. While wearing it, you can use an action to expend some of its charges to cast one of the following spells from it (spell save DC 16): charm person (1 charge), disintegrate (6 charges), fear (3 charges), finger of death (7 charges), flesh to stone (6 charges), hold person (2 charges), ray of enfeeblement (2 charges), sleep (1 charge), slow (3 charges), telekinesis (5 charges).\n   The crown regains 1d6 + 3 expended charges daily at dawn.\n   " + toUni("Symbiotic Nature") + ". The crown can't be removed from you while you're attuned to it, and you can't voluntarily end your attunement to it. If you're targeted by a spell that ends a curse, your attunement to the crown ends, and it detaches from you.\n   The daelkyr Belashyrra made these crowns. While on the same plane of existence as the crown, Belashyrra can see through its eyestalks.",
	attunement : true,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+3",
	fixedDC : 16,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["charm person", "sleep"],
		selection : ["charm person", "sleep"],
		firstCol : 1,
		times : 2
	}, {
		name : "2 charges",
		spells : ["hold person", "ray of enfeeblement"],
		selection : ["hold person", "ray of enfeeblement"],
		firstCol : 2,
		times : 2
	}, {
		name : "3 charges",
		spells : ["fear", "slow"],
		selection : ["fear", "slow"],
		firstCol : 3,
		times : 2
	}, {
		name : "5 charges",
		spells : ["telekinesis"],
		selection : ["telekinesis"],
		firstCol : 5
	}, {
		name : "6 charges",
		spells : ["disintegrate", "flesh to stone"],
		selection : ["disintegrate", "flesh to stone"],
		firstCol : 6,
		times : 2
	}, {
		name : "7 charges",
		spells : ["finger of death"],
		selection : ["finger of death"],
		firstCol : 7
	}]
}
MagicItemsList["cleansing stone"] = {
	name : "Cleansing Stone",
	source : [["E:RLW", 276], ["WGtE", 115], ["UA:MIoE", 2]],
	type : "wondrous item",
	rarity : "common",
	description : "This stone sphere is 1 ft in diameter and engraved with mystic sigils. As an action while touching it, I can activate it to remove dirt and grime from my garments and my person.",
	descriptionFull : "A cleansing stone is a sphere 1 foot in diameter, engraved with mystic sigils. When touching the stone, you can use an action to activate it and remove dirt and grime from your garments and your person.\n   Such stones are often embedded in pedestals in public squares in Aundair or in high-end Ghallanda inns.",
	action : [["action", ""]],
	weight : 88 // using average marble/limestone density of 2.711 g/cm3
}
var ERftLW_docentFullDescription = [
	"A docent is a small metal sphere, about 2 inches across, studded with dragonshards. To attune to a docent, you must embed the item somewhere on your body, such as your chest or your eye socket.",
	'>>Sentience<<. A docent is a sentient item of any alignment with an Intelligence of 16, a Wisdom of 14, and a Charisma of 14. It perceives the world through your senses. It communicates telepathically with you and can speak, read, and understand any language it knows (see "Random Properties" below).',
	">>Life Support<<. Whenever you end your turn with 0 hit points, the docent can make a Wisdom (Medicine) check with a +6 bonus. If this check succeeds, the docent stabilizes you.",
	">>Random Properties<<. A docent has the following properties:",
	" \u2022 >>Languages<<. The docent knows Common, Giant, and 1d4 additional languages chosen by the DM. If a docent knows fewer than six languages, it can learn a new language after it hears or reads the language through your senses.",
	" \u2022 >>Skills<<. The docent has a +7 bonus to one of the following skills (roll a d4): (1) Arcana, (2) History, (3) Investigation, or (4) Nature.",
	" \u2022 >>Spells<<. The docent knows one of the following spells and can cast it at will, requiring no components (roll a d6): (1–2) detect evil and good or (3–6) detect magic. The docent decides when to cast the spell.",
	">>Personality<<. A docent is designed to advise and assist the warforged it's attached to. One of the simple functions of a docent is to serve as a translator. The docent's properties are under its control, and if you have a bad relationship with your docent, it might refuse to assist you."
];
MagicItemsList["docent"] = {
	name : "Docent",
	source : [["E:RLW", 276]],
	type : "wondrous item",
	rarity : "rare",
	description : "I can embed this sentient small metal sphere studded with dragonshards into my chest or eye socket. I can communicate telepathically with it and it uses my senses. It can serve me as an advisor and a translator. It knowns 6 languages, a spells, an Intelligence skill, and can stabilize me. See Notes page.",
	descriptionFull : ERftLW_docentFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	prerequisite : "Requires attunement by a warforged",
	prereqeval : function (v) { return (/warforged/i).test(CurrentRace.known); },
	toNotesPage : [{
		name : "Features",
		note : desc(ERftLW_docentFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/(with|stabilizes|assist) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["dyrrn's tentacle whip"] = {
	name : "Dyrrn's Tentacle Whip",
	nameAlt : "Tentacle Whip",
	source : [["E:RLW", 276]],
	type : "weapon (whip)",
	rarity : "very rare",
	description : "This magic whip embeds itself in my arm once I attune to it and removing it requires ending a curse. It has a +2 bonus to attack and damage rolls, deals +1d6 psychic damage, but has disadv. vs. aberrations. On a roll of 20 to hit, the target is stunned until it next turn ends. As a bonus action, I can draw/sheath it in my arm",
	descriptionFull : "This long, whip-like strand of tough muscle bears a sharp stinger at one end. To attune to this symbiotic weapon, you wrap the whip around your wrist for the entire attunement period, during which time the whip painfully embeds its tendrils into your arm.\n   You gain a +2 bonus to attack and damage rolls made with this magic whip, but attack rolls made against aberrations with this weapon have disadvantage. A creature hit by this weapon takes an extra 1d6 psychic damage. When you roll a 20 on the d20 for an attack roll with this weapon, the target is stunned until the end of its next turn.\n   As a bonus action, you can sheathe the whip by causing it to retract into your arm, or draw the whip out of your arm again.\n   " + toUni("Symbiotic Nature") + ". The whip can't be removed from you while you're attuned to it, and you can't voluntarily end your attunement to it. If you're targeted by a spell that ends a curse, your attunement to the whip ends, and it detaches from you.",
	attunement : true,
	weight : 3,
	action : [["bonus action", "Tentacle Whip (draw/sheath)"]],
	weaponOptions : [{
		baseWeapon : "whip",
		regExpSearch : /^(?=.*tentacle)(?=.*whip).*$/i,
		name : "Dyrrn's Tentacle Whip",
		source : [["E:RLW", 276]],
		description : "Finesse, reach; +1d6 psychic dmg; On 20 to hit: stun until its next turn ends; Disadv. vs. aberrations",
		modifiers : [2, 2],
		selectNow : true
	}]
}
MagicItemsList["earworm"] = {
	name : "Earworm",
	source : [["E:RLW", 277]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "This symbiont bonds to my skull once I attune to it and removing it to end the attunement requires ending a curse. It has 4 charges, regaining 1d4 at dawn, which I can use to cast Detect Thoughts (2 charges) or Dissonant Whispers (1 charge) with DC 15. It allows me to speak, read, and write deep speech.",
	descriptionFull : "To attune to this symbiont, you must hold it against the skin behind your ear for the entire attunement period, whereupon it burrows into your head and bonds to your skull. While the earworm is inside you, you can speak, read, and write Deep Speech.\n   " + toUni("Spells") + ". The earworm has 4 charges. You can cast the following spells from it, expending the necessary number of charges (spell save DC 15): detect thoughts (2 charges) or dissonant whispers (1 charge). Each time you use the earworm to cast the detect thoughts spell, it sends the information gleaned to the nearest daelkyr, or to the next nearest earworm until it reaches a daelkyr.\n   The earworm regains 1d4 expended charges daily at dawn.\n   " + toUni("Symbiotic Nature") + ". The earworm can't be removed from you while you're attuned to it, and you can't voluntarily end your attunement to it. If you're targeted by a spell that ends a curse, your attunement to the earworm ends, and it exits your body.",
	attunement : true,
	languageProfs : ["Deep Speech"],
	usages : 4,
	recovery : "dawn",
	additional : "regains 1d4",
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["dissonant whispers"],
		selection : ["dissonant whispers"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["detect thoughts"],
		selection : ["detect thoughts"],
		firstCol : 2
	}]
}
MagicItemsList["everbright lantern"] = {
	name : "Everbright Lantern",
	source : [["E:RLW", 277], ["WGtE", 115], ["UA:MIoE", 2]],
	type : "wondrous item",
	rarity : "common",
	description : "This bullseye lantern is powered by a dragonshard that sheds light comparable to that produced by a Continual Flame spell. The light never goes out, but it can be shuttered off. It sheds light in a 120-ft cone; the closest 60 ft is bright light, and the farthest 60 ft is dim light.",
	descriptionFull : "This bullseye lantern contains an Eberron dragonshard that sheds light comparable to that produced by a continual flame spell. An everbright lantern sheds light in a 120-foot cone; the closest 60 feet is bright light, and the farthest 60 feet is dim light.",
	weight : 2
}
MagicItemsList["feather token"] = {
	name : "Feather Token",
	source : [["E:RLW", 277]],
	type : "wondrous item",
	rarity : "common",
	description : "This small metal disk is inscribed with the image of a feather. When I fall at least 20 ft while the token is on my person, I descend 60 ft per round and take no damage from falling. The token's magic is expended after landing, whereupon the disk becomes nonmagical.",
	descriptionFull : "This small metal disk is inscribed with the image of a feather. When you fall at least 20 feet while the token is on your person, you descend 60 feet per round and take no damage from falling. The token's magic is expended after you land, whereupon the disk becomes nonmagical."
}
MagicItemsList["finder's goggles"] = {
	name : "Finder's Goggles",
	source : [["E:RLW", 277]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "These goggles with dragonshard lenses grant me +1d4 on Wis (Insight) checks. As an action once per dawn, I can use them to find the last creature to touch an object with a Wis (Insight) check DC 13 + days since last contact. I learn the creature's type and can immediately cast Locate Creature to find the creature.",
	descriptionFull : "The lenses of these garish goggles are carved from Siberys dragonshards. While wearing these lenses, you gain the following benefits:\n \u2022 When you make a Wisdom (Insight) check, you can roll a d4 and add the number rolled to the check.\n \u2022 As an action, you can use the goggles to examine an object to identify the aura of the last creature that touched it. Make a Wisdom (Insight) check against a DC of 13 + the number of days since the last contact occurred. On a success, you learn the creature's type and can immediately use the goggles to cast locate creature to find that creature. This property can't be used again until the next dawn.",
	action : [["action", ""]],
	attunement : true,
	prerequisite : "Requires attunement by a creature with the Dragonmark of Finding",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*finding).*$/i).test(CurrentRace.known);
	},
	action : [["action", " (examine object)"]],
	usages : 1,
	recovery : "dawn",
	additional : "examine object",
	spellcastingBonus : {
		name : "After examining object",
		spells : ["locate creature"],
		selection : ["locate creature"],
		firstCol : "Sp"
	}
}
MagicItemsList["glamerweave"] = {
	name : "Glamerweave",
	source : [["E:RLW", 277]],
	type : "wondrous item",
	description : "Glamerweave is clothing imbued with harmless illusory magic. As a bonus action while wearing these clothes, I can turn the pattern within the cloth into a moving illusory pattern. For the uncommon version, this pattern extends beyond the cloth and gives me +1d4 on a Performance or Persuasion check.",
	descriptionFull : "Glamerweave is clothing imbued with harmless illusory magic. While wearing the common version of these clothes, you can use a bonus action to create a moving illusory pattern within the cloth.\n   Uncommon glamerweave can have the pattern rise from the cloth. For example, a glamerweave gown might be wreathed in harmless, illusory flames, while a glam­erweave hat might have illusory butterflies fluttering around it.\n   When you make a Charisma (Performance) or Cha­risma (Persuasion) check while wearing the uncommon version of glamerweave, you can roll a d4 and add the number rolled to the check. Once you use this property, it can't be used again until the next dawn. ",
	action : [["bonus action", ""]],
	choices : ["Common (moving illusory pattern)", "Uncommon (pattern rises from the cloth)"],
	"common (moving illusory pattern)" : {
		name : "Glamerweave ",
		rarity : "common",
		description : "Glamerweave is clothing imbued with harmless illusory magic. As a bonus action while wearing these clothes, I can create a moving illusory pattern within the cloth.",
		descriptionFull : "Glamerweave is clothing imbued with harmless illusory magic. While wearing the common version of these clothes, you can use a bonus action to create a moving illusory pattern within the cloth."
	},
	"uncommon (pattern rises from the cloth)" : {
		name : "Uncommon Glamerweave",
		rarity : "uncommon",
		description : "Glamerweave is clothing imbued with harmless illusory magic. As a bonus action while wearing these clothes, I can have the pattern within them rise as an illusory visage (e.g. wreathed in flames). Once per dawn, I can use this to gives me +1d4 on a Charisma (Performance) or Charisma (Persuasion) check.",
		descriptionFull : "Glamerweave is clothing imbued with harmless illusory magic. While wearing these clothes, you can use a bonus action to create a moving illusory pattern within the cloth.\n   You can have the pattern rise from the cloth. For example, a glamerweave gown might be wreathed in harmless, illusory flames, while a glamerweave hat might have illusory butterflies fluttering around it.\n   When you make a Charisma (Performance) or Charisma (Persuasion) check while wearing the glamerweave, you can roll a d4 and add the number rolled to the check. Once you use this property, it can't be used again until the next dawn.",
		usages : 1,
		recovery : "dawn"
	}
}
MagicItemsList["imbued wood focus"] = {
	// Note that this item is implemented here against RAW,
	// because according to PHB page 203 a spellcasting focus can only be used for
	// spells with a material component that is neither costly nor consumed.
	// See also https://dnd.wizards.com/articles/sage-advice/rules-spellcasting
	// This would mean that the Imbued Wood Focus in only useful for a limited number of spells.
	// Instead, this code just applies the damage bonus to all damage spells that roll for their damage.
	name : "Imbued Wood Focus",
	source : [["E:RLW", 277], ["WGtE", 114], ["UA:MIoE", 1]],
	type : "wondrous item",
	rarity : "common",
	description : "This rod, wand, or staff is cut from a tree infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal the associated damage type add a +1 bonus to one of their damage rolls.",
	descriptionFull : "An imbued wood focus is a rod, staff, or wand cut from a tree infused with extraplanar energy. If you're a spell­caster, you can use this orb as a spellcasting focus.\n   When you cast a damage-dealing spell using this item as your spellcasting focus, you gain a +1 bonus to one damage roll of the spell, provided the damage is of the type associated with the item's wood. The types of wood and their associated damage types are listed in the table below.\n\n" + toUni("Wood\t\t\tDamage Type") + "\nFernian Ash\t\tFire\nIrian Rosewood\t\tRadiant\nKythrian Manchineel  \tAcid or Poison\nLamannian Oak\t\tLightning or Thunder\nMabaran Ebony\t\tNecrotic\nRisian Pine\t\tCold\nShavarran Birch\t\tForce\nXorian Wenge\t\tPsychic",
	attunement : true,
	allowDuplicates : true,
	weight : 2,
	choices : ["Fernian Ash (fire)", "Irian Rosewood (radiant)", "Kythrian Manchineel (acid and poison)", "Lamannian Oak (lightning and thunder)", "Mabaran Ebony (necrotic)", "Risian Pine (cold)", "Shavarran Birch (force)", "Xorian Wenge (psychic)"],
	"fernian ash (fire)" : {
		name : "Fernian Ash Rod, Wand, or Staff",
		sortname : "Imbued Wood Focus, Fernian Ash (fire)",
		nameTest : /^(?=.*fernian)(?=.*ash)(?=.*(rod|wand|staff)).*$/i,
		description : "This rod, wand, or staff made of Fernian ash, wood infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal fire damage add a +1 bonus to one of their damage rolls.",
		calcChanges : {
			atkCalc : [
				function (fields, v, output) {
					if (v.thisWeapon[3] && (/fire/i).test(fields.Damage_Type)) output.extraDmg += 1;
				},
				"When I use this as my spellcasting focus, spells I cast that deal fire damage get a +1 bonus added to one of their damage rolls."
			],
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "fire", 1, true, true);
				},
				"When I use this as my spellcasting focus, spells I cast that deal fire damage get a +1 bonus added to one of their damage rolls."
			]
		}
	},
	"irian rosewood (radiant)" : {
		name : "Irian Rosewood Rod, Wand, or Staff",
		sortname : "Imbued Wood Focus, Irian Rosewood (radiant)",
		nameTest : /^(?=.*irian)(?=.*rosewood)(?=.*(rod|wand|staff)).*$/i,
		description : "This rod, wand, or staff made of Irian rosewood, wood infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal radiant damage add a +1 bonus to one of their damage rolls.",
		calcChanges : {
			atkCalc : [
				function (fields, v, output) {
					if (v.thisWeapon[3] && (/radiant/i).test(fields.Damage_Type)) output.extraDmg += 1;
				},
				"When I use this as my spellcasting focus, spells I cast that deal radiant damage get a +1 bonus added to one of their damage rolls."
			],
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "radiant", 1, true, true);
				},
				"When I use this as my spellcasting focus, spells I cast that deal radiant damage get a +1 bonus added to one of their damage rolls."
			]
		}
	},
	"kythrian manchineel (acid and poison)" : {
		name : "Kythrian Manchineel Rod, Wand, or Staff",
		sortname : "Imbued Wood Focus, Kythrian Manchineel (acid and poison)",
		nameTest : /^(?=.*kythrian)(?=.*manchineel)(?=.*(rod|wand|staff)).*$/i,
		description : "This rod, wand, or staff made of Kythrian manchineel, wood infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal acid or poison damage add a +1 bonus to one of their damage rolls.",
		calcChanges : {
			atkCalc : [
				function (fields, v, output) {
					if (v.thisWeapon[3] && (/acid|poison/i).test(fields.Damage_Type)) output.extraDmg += 1;
				},
				"When I use this as my spellcasting focus, spells I cast that deal acid or poison damage get a +1 bonus added to one of their damage rolls."
			],
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "acid|poison", 1, true, true);
				},
				"When I use this as my spellcasting focus, spells I cast that deal acid or poison damage get a +1 bonus added to one of their damage rolls."
			]
		}
	},
	"lamannian oak (lightning and thunder)" : {
		name : "Lamannian Oak Rod, Wand, or Staff",
		sortname : "Imbued Wood Focus, Lamannian Oak (lightning and thunder)",
		nameTest : /^(?=.*lamannian)(?=.*oak)(?=.*(rod|wand|staff)).*$/i,
		description : "This rod, wand, or staff made of Lamannian oak, wood infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal lightning or thunder damage add a +1 bonus to one of their damage rolls.",
		calcChanges : {
			atkCalc : [
				function (fields, v, output) {
					if (v.thisWeapon[3] && (/lightning|thunder/i).test(fields.Damage_Type)) output.extraDmg += 1;
				},
				"When I use this as my spellcasting focus, spells I cast that deal lightning or thunder damage get a +1 bonus added to one of their damage rolls."
			],
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "lightning|thunder", 1, true, true);
				},
				"When I use this as my spellcasting focus, spells I cast that deal lightning or thunder damage get a +1 bonus added to one of their damage rolls."
			]
		}
	},
	"mabaran ebony (necrotic)" : {
		name : "Mabaran Ebony Rod, Wand, or Staff",
		sortname : "Imbued Wood Focus, Mabaran Ebony (necrotic)",
		nameTest : /^(?=.*mabaran)(?=.*ebony)(?=.*(rod|wand|staff)).*$/i,
		description : "This rod, wand, or staff made of Mabaran ebony, wood infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal necrotic damage add a +1 bonus to one of their damage rolls.",
		calcChanges : {
			atkCalc : [
				function (fields, v, output) {
					if (v.thisWeapon[3] && (/necrotic/i).test(fields.Damage_Type)) output.extraDmg += 1;
				},
				"When I use this as my spellcasting focus, spells I cast that deal necrotic damage get a +1 bonus added to one of their damage rolls."
			],
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "necro\\.?|necrotic", 1, true, true);
				},
				"When I use this as my spellcasting focus, spells I cast that deal necrotic damage get a +1 bonus added to one of their damage rolls."
			]
		}
	},
	"risian pine (cold)" : {
		name : "Risian Pine Rod, Wand, or Staff",
		sortname : "Imbued Wood Focus, Risian Pine (cold)",
		nameTest : /^(?=.*risian)(?=.*pine)(?=.*(rod|wand|staff)).*$/i,
		description : "This rod, wand, or staff made of Risian pine, wood infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal cold damage add a +1 bonus to one of their damage rolls.",
		calcChanges : {
			atkCalc : [
				function (fields, v, output) {
					if (v.thisWeapon[3] && (/cold/i).test(fields.Damage_Type)) output.extraDmg += 1;
				},
				"When I use this as my spellcasting focus, spells I cast that deal cold damage get a +1 bonus added to one of their damage rolls."
			],
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "cold", 1, true, true);
				},
				"When I use this as my spellcasting focus, spells I cast that deal cold damage get a +1 bonus added to one of their damage rolls."
			]
		}
	},
	"shavarran birch (force)" : {
		name : "Shavarran Birch Rod, Wand, or Staff",
		sortname : "Imbued Wood Focus, Shavarran Birch (force)",
		nameTest : /^(?=.*shavarran)(?=.*birch)(?=.*(rod|wand|staff)).*$/i,
		description : "This rod, wand, or staff made of Shavarran birch, wood infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal force damage add a +1 bonus to one of their damage rolls.",
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (v.thisWeapon[3] && v.thisWeapon[3] == "eldritch blast") {
						fields.Description += (fields.Description ? '; ' : '') + "One ray +1 dmg";
					}
				},
				"When I use this as my spellcasting focus, spells I cast that deal force damage get a +1 bonus added to one of their damage rolls."
			],
			atkCalc : [
				function (fields, v, output) {
					if (v.thisWeapon[3] && v.thisWeapon[3] != "eldritch blast" && (/force/i).test(fields.Damage_Type)) output.extraDmg += 1;
				}
			],
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "force", 1, true, true);
				},
				"When I use this as my spellcasting focus, spells I cast that deal force damage get a +1 bonus added to one of their damage rolls."
			]
		}
	},
	"xorian wenge (psychic)" : {
		name : "Xorian Wenge Rod, Wand, or Staff",
		sortname : "Imbued Wood Focus, Xorian Wenge (psychic)",
		nameTest : /^(?=.*xorian)(?=.*wenge)(?=.*(rod|wand|staff)).*$/i,
		description : "This rod, wand, or staff made of Xorian wenge, wood infused with extraplanar energy. I can use it as spellcasting focus for all my spells. If I do so, spells I cast that deal psychic damage add a +1 bonus to one of their damage rolls.",
		calcChanges : {
			atkCalc : [
				function (fields, v, output) {
					if (v.thisWeapon[3] && (/psychic/i).test(fields.Damage_Type)) output.extraDmg += 1;
				},
				"When I use this as my spellcasting focus, spells I cast that deal psychic damage get a +1 bonus added to one of their damage rolls."
			],
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "psychic", 1, true, true);
				},
				"When I use this as my spellcasting focus, spells I cast that deal psychic damage get a +1 bonus added to one of their damage rolls."
			]
		}
	}
}
MagicItemsList["keycharm"] = {
	name : "Keycharm",
	source : [["E:RLW", 277]],
	type : "wondrous item",
	rarity : "common",
	description : "When I cast Alarm, Arcane Lock, or Glyph of Warding, I can tie the effect to the keycharm. Its holder receives the notification from Alarm, bypasses the Arcane Lock, or avoids triggering the Glyph of Warding. It can have up to 3 tied spells at one time. As an action, the holder can speak the command to end a tied spell.",
	descriptionFull : "This small stylized key plays a vital role in the work of House Kundarak. If you cast the alarm, arcane lock, or glyph of warding spell, you can tie the effect to the keycharm so that whoever holds it receives the notification from the alarm spell, bypasses the lock of the arcane lock spell, or avoids triggering the glyph placed by the glyph of warding spell. In addition, the holder (who needn't be attuned to the item) can take an action to end any one spell tied to it, provided the holder knows the command word you set for ending the tied spells. The keycharm can have up to three tied spells at one time.",
	attunement : true,
	prerequisite : "Requires attunement by a creature with the Dragonmark of Warding",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*warding).*$/i).test(CurrentRace.known);
	}
}
MagicItemsList["kyrzin's ooze"] = {
	name : "Kyrzin's Ooze",
	source : [["E:RLW", 278]],
	type : "wondrous item",
	rarity : "very rare",
	description : "Once I attune to this opalescent goo by drinking it, it can only be removed by ending a curse. It gives me resistance to acid and poison damage and immunity to the poisoned condition. Each as an action once per short rest, I can exhale acid breath or become amorphous for 1 minute along with my equipment.",
	descriptionLong : "I can only attune to this opalescent, symbiotic goo by drinking it. I can't remove it or end the attunement voluntarily, but it seeps out of me if the curse is removed. It gives me resistance to acid and poison damage and immunity to the poisoned condition. As an action once per dawn, I can become amorphous for 1 minute along with my equipment and can move through a space as narrow as 1 inch wide. As an action once per dawn, I can exhale a 30-ft line, 5-ft wide acid breath that deals 8d8 acid damage (Dexterity save DC 15 halves). If I die while it is inside me, it turns my corpse into a black pudding.",
	descriptionFull : "This opalescent, symbiotic goo comes sealed in a jar and slowly shifts and moves, as if endlessly exploring the jar's interior. To attune to this item, you must first drink the contents of the jar, unlocking the following properties.\n   " + toUni("Resistant") + ". While attuned to Kyrzin's ooze, you have resistance to poison and acid damage, and you're immune to the poisoned condition.\n   " + toUni("Amorphous") + ". As an action, you can speak a command word and cause your body to assume the amorphous qualities of an ooze. For the next minute, you (along with any equipment you're wearing or carrying) can move through a space as narrow as 1 inch wide without squeezing. Once you use this property, it can't be used again until the next dawn.\n   " + toUni("Acid Breath") + ". As an action, you can exhale acid in a 30-foot line that is 5 feet wide. Each creature in that line must make a DC 15 Dexterity saving throw, taking 36 (8d8) acid damage on a failed save, or half as much damage on a successful one. Once you use this property, it can't be used again until the next dawn.\n   " + toUni("Symbiotic Nature") + ". The ooze can't be removed from you while you're attuned to it, and you can't voluntarily end your attunement to it. If you're targeted by a spell that ends a curse, your attunement to the ooze ends, as it seeps out of you.\n   If you die while the ooze is inside you, it bursts out and engulfs you, turning your corpse into a black pudding allied with the daelkyr.",
	attunement : true,
	dmgres : ["Acid", "Poison"],
	savetxt : { immune : ["poisoned condition"] },
	action : [["action", " (amorphous/acid breath)"]],
	extraLimitedFeatures : [{
		name : "Kyrzin's Ooze [Amorphous]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Kyrzin's Ooze [Acid Breath]",
		usages : 1,
		recovery : "dawn"
	}],
	weaponOptions : [{
		regExpSearch : /^(?=.*ooze)(?=.*acid)(?=.*breath).*$/i,
		name : "Kyrzin's Ooze Acid Breath",
		source : [["E:RLW", 278]],
		ability : 0,
		type : "Magic Item",
		damage : [8, 8, "acid"],
		range : '5-ft \xD7 30-ft line',
		description : "Hits all in area; Dex save, success - half damage; Usable only once per dawn",
		abilitytodamage : false,
		dc : true,
		modifiers : [7, ""],
		selectNow : true
	}]
}
MagicItemsList["living armor"] = {
	name : "Living Armor",
	source : [["E:RLW", 278]],
	type : "armor (any)",
	rarity : "very rare",
	description : "This armor of black chitin attaches itself to me once I attune to it and removing it requires ending a curse. It gives me +1 AC and resistance to necrotic, poison, and psychic damage. Whenever I finish a long rest, I must either feed it half my remaining HD (rounding up) or take 1 level of exhaustion.",
	descriptionFull : "This hideous armor is formed from black chitin, beneath which veins pulse and red sinews glisten. To attune to this item, you must wear it for the entire attunement period, during which tendrils on the inside burrow into you.\n   While wearing this armor, you have a +1 bonus to Armor Class, and you have resistance to the following damage types: necrotic, poison, and psychic.\n   " + toUni("Symbiotic Nature") + ". The armor can't be removed from you while you're attuned to it, and you can't voluntarily end your attunement to it. If you're targeted by a spell that ends a curse, your attunement to the armor ends, and it detaches from you.\n   The armor requires fresh blood be fed to it. Immediately after you finish any long rest, you must either feed half of your remaining Hit Dice to the armor (round up) or take 1 level of exhaustion.",
	attunement : true,
	dmgres : ["Necrotic", "Poison", "Psychic"],
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["suffix", "+1 Living"]
	}
}
MagicItemsList["living gloves"] = {
	name : "Living Gloves",
	source : [["E:RLW", 278]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "These gloves made of thin chitin and sinew bond with my skin once I attune to them and removing them requires ending a curse. Once I attune to them, I can choose to become proficient and gain expertise with either sleight of hand, thieves' tools, or an artisan's tools or musical instrument of my choice.",
	descriptionFull : "These symbiotic gloves\u2014made of thin chitin and sinew\u2014pulse with a life of their own. To attune to them, you must wear them for the entire attunement period, during which the gloves bond with your skin.\n   While attuned to these gloves, you gain one of the following proficiencies (your choice when you attune to the gloves):\n \u2022 Sleight of Hand\n \u2022 Thieves' tools\n \u2022 One kind of artisan's tools of your choice\n \u2022 One kind of musical instrument of your choice\n\nWhen you make an ability check using the chosen proficiency, you add double your proficiency bonus to the check, instead of your normal proficiency bonus.\n   " + toUni("Symbiotic Nature") + ". The gloves can't be removed from you while you're attuned to them, and you can't voluntarily end your attunement to them. If you're targeted by a spell that ends a curse, your attunement to the gloves ends, and they can be removed.",
	attunement : true,
	choices : ["Proficiency and expertise with Sleight of Hand", "Proficiency and expertise with Thieves' Tools", "Proficiency and expertise with chosen artisan's tools", "Proficiency and expertise with chosen musical instrument"],
	choicesNotInMenu : true,
	"proficiency and expertise with sleight of hand" : {
		name : "Living Gloves [Sleight of Hand]",
		description : "These symbiotic gloves made of thin chitin and sinew bond with my skin once I attune to them. Removing them requires ending a curse, I can't do so or end the attunement voluntarily. They give me proficiency and expertise with sleight of hand.",
		skills : [["Sleight of Hand", "full"]]
	},
	"proficiency and expertise with thieves' tools" : {
		name : "Living Gloves [Thieves' Tools]",
		description : "These symbiotic gloves made of thin chitin and sinew bond with my skin once I attune to them. Removing them requires ending a curse, I can't do so or end the attunement voluntarily. They give me proficiency and expertise with thieves' tools.",
		toolProfs : [["Thieves' tools", "Dex"]],
		eval : function () {
			if ((/thieve.?s.*tools/i).test(What('Too Text'))) {
				Checkbox('Too Exp', true);
			};
		},
		removeeval : function () {
			if ((/thieve.?s.*tools/i).test(What('Too Text'))) {
				Checkbox('Too Exp', false);
			};
		}
	},
	"proficiency and expertise with chosen artisan's tools" : {
		name : "Living Gloves [Artisan's Tools]",
		description : "These symbiotic gloves made of thin chitin and sinew bond with my skin once I attune to them. Removing them requires ending a curse, I can't do so or end the attunement voluntarily. They give me proficiency and expertise with a set of artisan's tools of my choice (chosen when I attune to them).",
		toolProfs : [["Artisan's tools", 1]],
	},
	"proficiency and expertise with chosen musical instrument" : {
		name : "Living Gloves [Musical Instrument]",
		description : "These symbiotic gloves made of thin chitin and sinew bond with my skin once I attune to them. Removing them requires ending a curse, I can't do so or end the attunement voluntarily. They give me proficiency and expertise with a musical instrument of my choice (chosen when I attune to them).",
		toolProfs : [["Musical instrument", 1]],
	}
}
MagicItemsList["orb of shielding"] = {
	name : "Orb of Shielding",
	source : [["E:RLW", 278], ["WGtE", 114], ["UA:MIoE", 1]],
	type : "wondrous item",
	rarity : "common",
	description : "An orb of shielding is made from crystal or stone aligned to one of the planes. I can use it as my spellcasting focus. While I am holding the orb and take damage of the type associated with the material the orb is made from, I can use my reaction to reduce the damage by 1d4 (to a minimum of 0).",
	descriptionFull : "An orb of shielding is a polished, spherical chunk of crystal or stone aligned to one of the planes of existence. If you're a spellcaster, you can use this orb as a spellcasting focus.\n   If you're holding the orb when you take damage of the type associated with the orb's material, you can use your reaction to reduce the damage by 1d4 (to a minimum of 0). The materials and their associated damage types are listed in the Orb of Shielding table.\n\n" + toUni("Planar Material\t\tDamage Type") + "\nFernian Basalt\t\tFire\nIrian Quartz\t\tRadiant\nKythrian Skarn\t\tAcid or Poison\nLamannian Flint\t\tLightning or Thunder\nMabaran Obsidian      \tNecrotic\nRisian Shale\t\tCold\nShavarran Chert\t\tForce\nXorian Marble\t\tPsychic",
	attunement : true,
	allowDuplicates : true,
	weight : 3,
	action : [["reaction", ""]],
	choices : ["Fernian Basalt (fire)", "Irian Quartz (radiant)", "Kythrian Skarn (acid or poison)", "Lamannian Flint (lightning or thunder)", "Mabaran Obsidian (necrotic)", "Risian Shale (cold)", "Shavaran Chert (force)", "Xorian Marble (psychic)"],
	"fernian basalt (fire)" : {
		name : "Orb of Shielding [Fernian Basalt]",
		description : "This stone orb is made from fernian basalt. I can use it as my spellcasting focus. As a reaction while I am holding the orb and take fire damage, I can reduce the damage by 1d4 (to a minimum of 0)."
	},
	"irian quartz (radiant)" : {
		name : "Orb of Shielding [Irian Quartz]",
		description : "This crystal orb is made from irian quartz. I can use it as my spellcasting focus. As a reaction while I am holding the orb and take radiant damage, I can reduce the damage by 1d4 (to a minimum of 0)."
	},
	"kythrian skarn (acid or poison)" : {
		name : "Orb of Shielding [Kythrian Skarn]",
		description : "This stone orb is made from kythrian skarn. I can use it as my spellcasting focus. As a reaction while I am holding the orb and take acid or poison damage, I can reduce the damage by 1d4 (to a minimum of 0)."
	},
	"lamannian flint (lightning or thunder)" : {
		name : "Orb of Shielding [Lamannian Flint]",
		description : "This stone orb is made from lamannian flint. I can use it as my spellcasting focus. As a reaction while I am holding the orb and take lightning or thunder damage, I can reduce the damage by 1d4 (to a minimum of 0)."
	},
	"mabaran obsidian (necrotic)" : {
		name : "Orb of Shielding [Mabaran Obsidian]",
		description : "This crystal orb is made from mabaran obsidian. I can use it as my spellcasting focus. As a reaction while I am holding the orb and take necrotic damage, I can reduce the damage by 1d4 (to a minimum of 0)."
	},
	"risian shale (cold)" : {
		name : "Orb of Shielding [Risian Shale]",
		description : "This stone orb is made from risian shale. I can use it as my spellcasting focus. As a reaction while I am holding the orb and take cold damage, I can reduce the damage by 1d4 (to a minimum of 0)."
	},
	"shavaran chert (force)" : {
		name : "Orb of Shielding [Shavaran Chert]",
		description : "This stone orb is made from shavaran chert. I can use it as my spellcasting focus. As a reaction while I am holding the orb and take force damage, I can reduce the damage by 1d4 (to a minimum of 0)."
	},
	"xorian marble (psychic)" : {
		name : "Orb of Shielding [Xorian Marble]",
		description : "This stone orb is made from xorian marble. I can use it as my spellcasting focus. As a reaction while I am holding the orb and take psychic damage, I can reduce the damage by 1d4 (to a minimum of 0)."
	}
}
MagicItemsList["prosthetic limb"] = { // no attument as per errata
	name : "Prosthetic Limb",
	source : [["E:RLW", 278], ["W", 268], ["T", 134]],
	type : "wondrous item",
	rarity : "common",
	description : "This artificial limb replaces a lost limb, like a hand, an arm, a foot, a leg, or a similar body part. While the prosthetic is attached, it functions identically to the part it replaces. As an action, I can detach or reattach it. It can't be removed against my will. It detaches if I die.",
	descriptionFull : "This item replaces a lost limb\u2014a hand, an arm, a foot, a leg, or a similar body part. While the prosthetic is attached, it functions identically to the part it replaces. You can detach or reattach it as an action, and it can't be removed against your will. It detaches if you die.",
	action : [["action", " (attach/detach)"]]
}
MagicItemsList["scribe's pen"] = {
	name : "Scribe's Pen",
	source : [["E:RLW", 278]],
	type : "wondrous item",
	rarity : "common",
	description : "I can use this pen to write on any surface. I decide whether the writing is visible or invisible, but it is always visible to creatures with the Mark of Scribing. As an action, I or others with the Mark of Scribing can touch the writing and make it visible to all. Writing on creatures other than constructs fades after 7 days.",
	descriptionFull : "You can use this pen to write on any surface. You decide whether the writing is visible or invisible, but the writing is always visible to a person with the Mark of Scribing.\n   Any creature with the Mark of Scribing can use an action to touch the invisible writing, making it visible to all.\n   If you use the pen to write on a creature that isn't a construct, the writing fades after 7 days.",
	attunement : true,
	prerequisite : "Requires attunement by a creature with the Dragonmark of Scribing",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*scribing).*$/i).test(CurrentRace.known);
	}
}
MagicItemsList["shiftweave"] = {
	name : "Shiftweave",
	source : [["E:RLW", 279]],
	type : "wondrous item",
	rarity : "common",
	description : "Up to five different outfits are embedded into these clothes. As a bonus action, I can speak its command word to transform the outfit into one of the other designs contained within. Regardless of its appearance, the outfit can't be anything but clothing or gain properties of other magical clothing.",
	descriptionFull : "When a suit of shiftweave is created, up to five different outfits can be embedded into the cloth. While wearing the clothing, you can speak its command word as a bonus action to transform your outfit into your choice of one of the other designs contained within it. Regardless of its appearance, the outfit can't be anything but clothing. Although it can duplicate the look of other magical clothing, it doesn't gain their magical properties.",
	action : [["bonus action", ""]]
}
MagicItemsList["speaking stone"] = {
	name : "Speaking Stone",
	source : [["E:RLW", 279]],
	type : "wondrous item",
	rarity : "very rare",
	description : "This dragonshard is inscribed with arcane symbols that uniquely identify it. By touching it, I can cast Sending to any other speaking stone whose location or unique sequence of symbols I know. A creature within 5 ft of the receiving speaking stone hears the message as if they were the target of the Sending.",
	descriptionFull : "The key to long-distance, virtually instantaneous communication across Khorvaire is House Sivis's network of message stations. Each station contains at least one speaking stone, which is carved from a Siberys dragonshard and inscribed with arcane symbols that uniquely identify it. If you're a gnome with the Mark of Scribing, you can touch the stone and use an action to cast the sending spell from it. The target is any other speaking stone whose location or unique sequence of symbols you know. A creature within 5 feet of the stone hears the message as if they were the target.\n   In a Sivis message station, a gnome is always on duty by the speaking stone, listening for messages that might come in and transcribing them for delivery to their intended recipients.",
	prerequisite : "Can only be used by a gnome with the Dragonmark of Scribing",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*scribing).*$/i).test(CurrentRace.known);
	},
	spellcastingBonus : {
		name : "At will",
		spells : ["sending"],
		selection : ["sending"],
		firstCol : "atwill"
	}
}
MagicItemsList["spellshard"] = {
	name : "Spellshard",
	source : [["E:RLW", 279], ["WGtE", 115], ["UA:MIoE", 3]],
	type : "wondrous item",
	rarity : "common",
	description : "This dragonshard can store up to 320 pages of text or spells. As an action while holding it (and speaking its passphrase if it has one), I can open my mind to its content and concentrate on it to subsequently read from and write to it in the same amount of time as a normal book (same cost as a normal spellbook).",
	descriptionFull : 'This polished Eberron dragonshard fits in the hand and stores information similar to a book. The shard can hold the equivalent of one book that\'s no more than 320 pages long. A shard can be created blank or already filled with information. When the shard is created, the creator can set a passphrase that must be spoken to access the information stored within.\n   While holding the shard, you can use an action to open your mind to the shard, seeing its content in your mind. On subsequent rounds, reading the text or scribing new text on blank "pages" in the shard requires concentration (as if concentrating on a spell) and takes the same amount of time it takes you to read and write normally. Thinking of a particular phrase or topic draws you to the first section in the shard that addresses it.\n   A wizard can use a spellshard as a spellbook, with the usual cost in gold and time to "scribe" a spell into the shard.',
	action : [["action", ""]]
}
MagicItemsList["ventilating lungs"] = {
	name : "Ventilating Lungs",
	source : [["E:RLW", 279]],
	type : "wondrous item",
	rarity : "very rare",
	description : "These lungs replace those in my chest while I'm attuned to them. Their function can't be suppressed by (anti)magic. They allow me to breath normally in any environment and give me advantage on saves against harmful gases and vapors. Once per dawn, I can use them to cast Gust of Wind (save DC 15) by exhaling.",
	descriptionFull : "These metallic nodules were created in response to the poisonous gases used on the battlefields of the Last War. When you attune to these lungs, they replace the lungs in your chest, which disappear. The lungs allow you to breathe normally, even in an antimagic field, and their breathing function can't be suppressed by magic.\n   Outside an antimagic field or any other effect that suppresses magic, these lungs allow you to breathe normally in any environment (including a vacuum), and you have advantage on saving throws against harmful gases such as those created by a cloudkill spell, a stinking cloud spell, inhaled poisons, and gaseous breath weapons.\n   As an action, you can use these lungs to exhale a gust of wind, as if you had cast the gust of wind spell (spell save DC 15) with no components. This property of the lungs can't be used again until the next dawn.\n   If your attunement to the lungs ends, your original lungs reappear.",
	attunement : true,
	usages : 1,
	recovery : "dawn",
	additional : "Gust of Wind",
	fixedDC : 15,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["gust of wind"],
		selection : ["gust of wind"],
		firstCol : "oncelr"
	},
	savetxt : { adv_vs : ["gases", "vapors"] }
}
MagicItemsList["wand sheath"] = {
	name : "Wand Sheath",
	source : [["E:RLW", 279]],
	type : "wondrous item",
	rarity : "common",
	description : "This sheath clamps unto my arm and can't be removed while I'm attuned to it. As an action, I can insert a wand in it, which then doesn't count to the number of items I can attune to. As a bonus action, I can then retract the wand or extend the wand and use it as if holding it, while keeping my hand free.",
	descriptionFull : "A wand sheath clamps onto your arm and imparts the following benefits:\n \u2022 The wand sheath can't be removed from you while you're attuned to it.\n \u2022 You can insert a wand into the sheath as an action. The sheath can hold only one wand at a time.\n \u2022 You can retract or extend a wand from the sheath as a bonus action. While the wand is extended, you can use it as if you were holding it, but your hand remains free.\n\nIf a sheathed wand requires attunement, you must attune to the wand before you can use it. However, the wand sheath and the attached wand count as a single magic item with regard to the number of magic items you can attune to. If you remove the wand from the sheath, your attunement to the wand ends.",
	attunement : true,
	prerequisite : "Requires attunement by a warforged",
	prereqeval : function (v) { return (/warforged/i).test(CurrentRace.known); },
	action : [["action", " (insert)"], ["bonus action", " (extend/retract)"]]
}
MagicItemsList["wheel of wind and water"] = {
	name : "Wheel of Wind and Water",
	source : [["E:RLW", 280], ["WGtE", 115]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "I can telepathically control the elemental bound into the elemental galleon or airship that has this wheel mounted at its helm. If I use a wheel of wind and water that is mounted on a mundane sailing ship, I can create an area of ideal conditions around the vessel, increasing its speed by 5 miles per hour.",
	descriptionFull : "When mounted at the helm of an elemental galleon or airship, this wheel allows a creature that possesses the Mark of Storm to telepathically control the elemental bound inside the vessel.\n   If a wheel of wind and water is mounted on a mundane sailing ship, a creature with the Mark of Storm who is using the wheel can create an area of ideal conditions around the vessel, increasing its speed by 5 miles per hour.",
	prerequisite : "Can only be used by a creature with the Dragonmark of Storm",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*storm).*$/i).test(CurrentRace.known);
	}
}

// Beasts
CreatureList["clawfoot"] = {
	name : "Clawfoot",
	source : [["E:RLW", 289]],
	size : 3,
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 19,
	hd : [3, 8],
	speed : "40 ft",
	scores : [12, 16, 14, 4, 12, 6],
	skills : {
		"perception" : 3,
		"stealth" : 5
	},
	senses : "",
	passivePerception : 13,
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 8, "piercing"],
		range : "Melee (5 ft)",
		description : "Both bite \u0026 claws attack as Attack action"
	}, {
		name : "Claws",
		ability : 2,
		damage : [1, 8, "slashing"],
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, see Pounce trait; Both bite \u0026 claws attack as Attack action"
	}],
	traits : [{
		name : "Pack Tactics",
		description : "The clawfoot has advantage on an attack roll against a creature if at least one of the clawfoot's allies is within 5 ft of the creature and the ally isn't incapacitated."
	}, {
		name : "Pounce",
		description : "If the clawfoot moves at least 20 ft straight toward a creature and then hits it with a claw attack on the same turn, that target must succeed on a DC 11 Strength saving throw or be knocked prone. If the target is prone, the clawfoot can make one bite attack against it as a bonus action."
	}, {
		name : "Multiattack",
		description : "The clawfoot makes two attacks: one with its bite and one with its claws."
	}]
};
CreatureList["fastieth"] = {
	name : "Fastieth",
	source : [["E:RLW", 289]],
	size : 3,
	type : "Beast",
	alignment : "Unaligned",
	ac : 14,
	hp : 9,
	hd : [2, 8],
	speed : "50 ft",
	scores : [12, 18, 10, 4, 11, 4],
	senses : "",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 8, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Quickness (Recharge 5-6)",
		description : "The fastieth can take the Dodge action as a bonus action."
	}]
};
ERftLW_Valenar_Ancestral_Traits = [
	"\u25C6 [Variant] Ancestral Traits: Each Valenar animal can be customized with an ancestral gift, a supernatural trait granted by its ancestral spirit. Choose a trait or roll on the table below for each Valenar animal.",
	" d8\tTrait",
	"  1\tBestow Luck (1/day): As a bonus action, the animal chooses one creature it can see",
		"\twithin 30 ft of it. The next ability check, attack roll, or saving throw the target",
		"\tmakes in the next hour has advantage.",
	"  2\tBurst of Speed (recharge 6): The animal can take the Dash action as a bonus action.",
	"  3\tCamouflage: The animal has advantage on Dexterity (Stealth) checks it makes while",
		"\toutdoors.",
	"  4\tLie Detector: The animal knows when a creature within 15 ft of it tells a lie.",
	"  5\tFey Ancestry: The animal has advantage on saving throws against being charmed or",
		"\tfrightened, and magic can't put it to sleep.",
	"  6\tFey Step (1/day): The animal, along with anything it is wearing or carrying,",
		"\tteleports up to 30 ft to an unoccupied space it can see.",
	"  7\tQuickness (recharge 6): The animal can take the Dodge action as a bonus action.",
	"  8\tShrouded Step. The animal can't be tracked except by magical means, and it leaves",
		"\tbehind no tracks or other traces of its passage."
].join("\n");
CreatureList["valenar hawk"] = { // contributed by Nod_Hero
	name : "Valenar Hawk",
	source : [["E:RLW", 312]],
	size : 5,
	type : "Fey",
	alignment : "Neutral",
	ac : 14,
	hp : 10,
	hd : [4, 4],
	speed : "10 ft, fly 60 ft",
	scores : [8, 18, 10, 9, 16, 11],
	skills : {
		"perception" : 5
	},
	senses : "Adv. on Wis (Perception) checks using sight",
	passivePerception : 15,
	languages : "understands Common, Elvish, and Sylvan but can't speak",
	challengeRating : "1/8",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Talons",
		ability : 2,
		damage : [1, 4, "slashing"],
		range : "Melee (5 ft)"
	}],
	traits : [{
		name : "Keen Sight",
		description : "The hawk has advantage on Wisdom (Perception) checks that rely on sight."
	}, {
		name : "Bonding",
		description : "The hawk can magically bond with one creature it can see, immediately after spending at least 1 hour observing that creature while within 30 ft of it. The bond lasts until the hawk bonds with a different creature or until the bonded creature dies. While bonded, the hawk and the bonded creature can communicate telepathically with each other at a distance of up to 100 ft."
	}],
	eval : function(prefix, lvl) {
		AddString(prefix + 'Cnote.Left', ERftLW_Valenar_Ancestral_Traits, true);
	},
	removeeval : function(prefix, lvl) {
		RemoveString(prefix + 'Cnote.Left', ERftLW_Valenar_Ancestral_Traits, true);
	}
};
CreatureList["valenar hound"] = { // contributed by Nod_Hero
	name : "Valenar Hound",
	source : [["E:RLW", 312]],
	size : 3,
	type : "Fey",
	alignment : "Neutral",
	ac : 14,
	hp : 19,
	hd : [3, 8],
	speed : "40 ft",
	scores : [17, 15, 14, 10, 15, 11],
	skills : {
		"perception" : 4
	},
	senses : "Adv. on Wis (Perception) checks using hearing/smell",
	passivePerception : 14,
	languages : "understands Common, Elvish, and Sylvan but can't speak",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 6, "piercing"],
		range : "Melee (5 ft)",
		description : "Target must succeed on a DC 13 Strength saving throw or be knocked prone"
	}],
	traits : [{
		name : "Keen Hearing and Smell",
		description : "The hound has advantage on Wisdom (Perception) checks that rely on hearing or smell."
	}, {
		name : "Bonding",
		description : "The hound can magically bond with one creature it can see, immediately after spending at least 1 hour observing that creature while within 30 ft of it. The bond lasts until the hound bonds with a different creature or until the bonded creature dies. While bonded, the hound and the bonded creature can communicate telepathically with each other at a distance of up to 100 ft."
	}],
	eval : function(prefix, lvl) {
		AddString(prefix + 'Cnote.Left', ERftLW_Valenar_Ancestral_Traits, true);
	},
	removeeval : function(prefix, lvl) {
		RemoveString(prefix + 'Cnote.Left', ERftLW_Valenar_Ancestral_Traits, true);
	}
};
CreatureList["valenar steed"] = { // contributed by Nod_Hero
	name : "Valenar Steed",
	source : [["E:RLW", 313]],
	size : 2,
	type : "Fey",
	alignment : "Neutral",
	ac : 13,
	hp : 22,
	hd : [3, 10],
	speed : "60 ft",
	scores : [14, 16, 14, 10, 15, 11],
	skills : {
		"perception" : 4
	},
	passivePerception : 14,
	languages : "understands Common, Elvish, and Sylvan but can't speak",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Hooves",
		ability : 2,
		damage : [2, 6, "bludgeoning"],
		range : "Melee (5 ft)"
	}],
	traits : [{
		name : "Bonding",
		description : "The steed can magically bond with one creature it can see, immediately after spending at least 1 hour observing that creature while within 30 ft of it. The bond lasts until the steed bonds with a different creature or until the bonded creature dies. While bonded, the steed and the bonded creature can communicate telepathically with each other at a distance of up to 100 ft."
	}],
	eval : function(prefix, lvl) {
		AddString(prefix + 'Cnote.Left', ERftLW_Valenar_Ancestral_Traits, true);
	},
	removeeval : function(prefix, lvl) {
		RemoveString(prefix + 'Cnote.Left', ERftLW_Valenar_Ancestral_Traits, true);
	}
};

// pub_20200317_EGtW.js
// This file adds the content from Explorer's Guide to Wildemount to MPMB's Character Record Sheet

// Define the source
SourceList.W = {
	name : "Explorer's Guide to Wildemount",
	abbreviation : "EGtW",
	abbreviationSpellsheet : "W",
	group : "Campaign Sourcebooks",
	campaignSetting : "Critical Role",
	url : "https://dnd.wizards.com/products/wildemount",
	date : "2020/03/17"
};

// Races
RaceList["pallid elf"] = { // contains contributions by Smashman
	regExpSearch : /^(?!.*half)((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(pallid|pale)\b)).*$/i,
	name : "Pallid Elf",
	sortname : "Elf, Pallid",
	source : [["W", 163]],
	plural : "Pallid Elves",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [
		["Darkvision", 60],
		["Adv. on Int (Investigation) and Wis (Insight) checks", ""]
	],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	advantages : [ ["Insight", true], ["Investigation", true] ],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d10\")",
	weight : " weigh around 110 lb (90 + 2d10 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to 1,7 metres tall (137 + 5d10 cm)",
	weightMetric : " weigh around 50 kg (40 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Pallid Elf (+2 Dexterity, +1 Wisdom)\nTrance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).\nIncisive Sense: I have advantage on Intelligence (Investigation) and Wisdom (Insight) checks.\nBlessing of the Moonweaver: I know the Light cantrip. At 3rd level, I can cast Sleep once per long rest. At 5th level, I can also cast Invisibility on myself once per long rest. Spells cast using this trait require no material components and use Wisdom as spellcasting ability.",
	spellcastingAbility : 5,
	spellcastingBonus : {
		name : "Blessing of the Moonweaver (level 1)",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	spellChanges : {
		"light" : {
			components : "V",
			compMaterial : "",
			changes : "Using Blessing of the Moonweaver, I can cast Light without requiring a material component."
		}
	},
	features : {
		"sleep" : {
			name : "Blessing of the Moonweaver (level 3)",
			limfeaname : "Sleep",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Blessing of the Moonweaver (level 3)",
				spells : ["sleep"],
				selection : ["sleep"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"sleep" : {
					components : "V,S",
					compMaterial : "",
					changes : "Using Blessing of the Moonweaver, I can cast Sleep once per long rest without requiring a material component."
				}
			}
		},
		"invisibility" : {
			name : "Blessing of the Moonweaver (level 5)",
			limfeaname : "Invisibility (self only)",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Blessing of the Moonweaver (level 5)",
				spells : ["invisibility"],
				selection : ["invisibility"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"invisibility" : {
					range : "Self",
					components : "V,S",
					compMaterial : "",
					description : "Me and my worn/carried invisible until I attack or cast; Can't cast this spell in direct sunlight",
					changes : "Using Blessing of the Moonweaver, I can cast Invisibility once per long rest without requiring a material component, but only on myself."
				}
			}
		}
	}
};
RaceList["lotusden halfling"] = { // contains contributions by Metacomet10
	regExpSearch : /^(?=.*\b(halflings?|hobbits?)\b)(?=.*lotusden).*$/i,
	name : "Lotusden Halfling",
	sortname : "Halfling, Lotusden",
	source : [["W", 164]],
	plural : "Lotusden Halflings",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened"] },
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Lotusden Halfling (+2 Dexterity, +1 Wisdom)" + (typePF ?
		"\n- Lucky: When I roll a 1 on an attack roll, ability check, or saving throw, I can reroll the die and must use the new roll."+
		"\n- Child of the Wood: I know the Druidcraft cantrip. At 3rd level, I can cast Entangle once per long rest. At 5th level, I can cast Spike Growth once per long rest without a material component. Wisdom is my spellcasting ability for these."+
		" - Halfling Nimbleness: I can move through the space of any creature that is of a size larger than me."+
		"\n- Timberwalk: Checks to track me have disadv. I need not expend extra movement to move over difficult terrain of nonmagical plants." :
		"\nChild of the Wood: I know the Druidcraft cantrip, at 3rd level: Entangle, at 5th level: Spike Growth. I can use both spells once per long rest and without material components. Wisdom is my spellcasting ability. "+
		"|Lucky: When I roll a 1 on an attack roll, ability check, or saving throw, I can reroll the die and must use the new roll. "+
		"|Halfling Nimbleness: I can move through the space of any creature that is of a size larger than me. "+
		"|Timberwalk: Disadv. on checks to track me. I require no extra movement for difficult terrain of nonmagical plants."),
	spellcastingAbility : 5,
	spellcastingBonus : {
		name : "Child of the Wood (level 1)",
		spells : ["druidcraft"],
		selection : ["druidcraft"],
		firstCol : 'atwill'
	},
	features : {
		"entangle" : {
			name : "Child of the Wood (level 3)",
			limfeaname : "Entangle",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Child of the Wood (level 3)",
				spells : ["entangle"],
				selection : ["entangle"],
				firstCol : 'oncelr'
			}
		},
		"spike growth" : {
			name : "Child of the Wood (level 5)",
			limfeaname : "Spike Growth",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Child of the Wood (level 5)",
				spells : ["spike growth"],
				selection : ["spike growth"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"spike growth" : {
					components : "V,S",
					compMaterial : "",
					changes : "Using Child of the Wood, I can cast Spike Growth once per long rest without requiring a material component."
				}
			}
		}
	}
};
{ // Dragonborn variants (almost completely made by Smashman)
	var EGtW_breathWeaponDesc = function (dmgType, shape) {
		var shapeStr = shape === "line" ? "5-ft by 30-ft line" : "15-ft cone";
		var capitailzedDmgType = dmgType.charAt(0).toUpperCase() + dmgType.slice(1);
		var saveStat = ["cold", "poison"].indexOf(dmgType) >= 0 ? "Con" : "Dex";
		return capitailzedDmgType + " Breath Weapon: As an action once per short rest, I can deal 2d6 " + dmgType + " damage to all in a " + shapeStr + ", " + saveStat + " save halves (DC 8 + Con mod + Prof Bonus).\nThis damage increases to 3d6 at level 6, 4d6 at level 11, and 5d6 at level 16.";
	};
	var EGtW_draconicAncestryFeature = {
		name : "Draconic Ancestry",
		limfeaname : "Breath Weapon",
		minlevel : 1,
		usages : 1,
		additional : levels.map(function (n) {
			return (n < 6 ? 2 : n < 11 ? 3 : n < 16 ? 4 : 5) + 'd6';
		}),
		recovery : "short rest",
		action : [['action', ""]],
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (v.theWea.dbBreathWeapon && (/dragonborn/i).test(CurrentRace.known)) {
						fields.Damage_Die = (CurrentRace.level < 6 ? 2 : CurrentRace.level < 11 ? 3 : CurrentRace.level < 16 ? 4 : 5) + 'd6';
						if (CurrentRace.variant) {
							fields.Damage_Type = CurrentRace.breathDmgType;
							fields.Description = fields.Description.replace(/(dex|con) save/i, ((/cold|poison/i).test(CurrentRace.breathDmgType) ? 'Con' : 'Dex') + ' save');
							fields.Range = (/black|blue|brass|bronze|copper/i).test(CurrentRace.variant) ? '5-ft \xD7 30-ft line' : '15-ft cone';
						}
					}
				},
				'',
				1
			]
		}
	};
	var EGtW_breathWeaponObj = {
		regExpSearch : /^(?=.*breath)(?=.*weapon).*$/i,
		name : "Breath weapon",
		source : [["W", 168]],
		ability : 3,
		type : 'Natural',
		damage : [2, 6, 'fire'],
		range : "15-ft cone",
		description : "Hits all in area; Dex save, success - half damage; Usable only once per short rest",
		abilitytodamage : false,
		dc : true,
		dbBreathWeapon : true,
		selectNow : true
	};
	var EGtW_acidBreath = EGtW_breathWeaponDesc("acid", "line");
	var EGtW_fireBreathCone = EGtW_breathWeaponDesc("fire", "cone");
	var EGtW_fireBreathLine = EGtW_breathWeaponDesc("fire", "cone");
	var EGtW_coldBreath = EGtW_breathWeaponDesc("cold", "cone");
	var EGtW_lightningBreath = EGtW_breathWeaponDesc("lightning", "line");
	var EGtW_poisonBreath = EGtW_breathWeaponDesc("poison", "cone");
	var EGtW_forcefulPresenceStr = "Forceful Presence: Once per short rest, I can give myself adv. on an Intimidation or Persuasion check.";
	var EGtW_vengefulAssaultStr = "Vengeful Assault: As a reaction when I take damage from a creature in range of a weapon that I'm holding, I can use the weapon to make an attack against the creature. I can do this once per short rest.";

	// Draconblood
	RaceList["draconblood dragonborn"] = {
		regExpSearch : /draconblood/i,
		name : "Draconblood Dragonborn",
		sortname : "Dragonborn, Draconblood",
		source : [["W", 168]],
		plural : "Draconblood Dragonborn",
		size : 3,
		speed : {
			walk : { spd : 30, enc : 20 }
		},
		languageProfs : ["Common", "Draconic"],
		vision : [["Darkvision", 60]],
		weaponOptions : [EGtW_breathWeaponObj],
		age : " reach adulthood by 15 and live around 80 years",
		height : " stand well over 6 feet tall (5'6\" + 2d8\")",
		weight : " weigh around 240 lb (175 + 2d8 \xD7 2d6 lb)",
		heightMetric : " stand well over 1,8 metres tall (170 + 5d8 cm)",
		weightMetric : " weigh around 110 kg (80 + 5d8 \xD7 4d6 / 10 kg)",
		scores : [0, 0, 0, 2, 0, 1],
		trait : "Draconblood Dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			"Draconic Ancestry: Choose one type of dragon using the \"Racial Options\" button. I gain a breath weapon as determined by the dragon type chosen.",
			EGtW_forcefulPresenceStr
		]),
		features : {
			"draconic ancestry" : EGtW_draconicAncestryFeature,
			"forceful presence" : {
				name : "Forceful Presence",
				source : [["W", 168]],
				minlevel : 1,
				usages : 1,
				recovery : "short rest"
			}
		},
		variants : []
	};
	AddRacialVariant("draconblood dragonborn", "black", {
		regExpSearch : /black/i,
		name : "Black draconblood dragonborn",
		trait : "Black draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_acidBreath,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "acid"
	});
	AddRacialVariant("draconblood dragonborn", "blue", {
		regExpSearch : /blue/i,
		name : "Blue draconblood dragonborn",
		trait : "Blue draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_lightningBreath,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "lightning"
	});
	AddRacialVariant("draconblood dragonborn", "brass", {
		regExpSearch : /brass/i,
		name : "Brass draconblood dragonborn",
		trait : "Brass draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_fireBreathLine,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "fire"
	});
	AddRacialVariant("draconblood dragonborn", "bronze", {
		regExpSearch : /bronze/i,
		name : "Bronze draconblood dragonborn",
		trait : "Bronze draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_lightningBreath,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "lightning"
	});
	AddRacialVariant("draconblood dragonborn", "copper", {
		regExpSearch : /copper/i,
		name : "Copper draconblood dragonborn",
		trait : "Copper draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_acidBreath,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "acid"
	});
	AddRacialVariant("draconblood dragonborn", "gold", {
		regExpSearch : /gold/i,
		name : "Gold draconblood dragonborn",
		trait : "Gold draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_fireBreathCone,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "fire"
	});
	AddRacialVariant("draconblood dragonborn", "green", {
		regExpSearch : /green/i,
		name : "Green draconblood dragonborn",
		trait : "Green draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_poisonBreath,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "poison"
	});
	AddRacialVariant("draconblood dragonborn", "red", {
		regExpSearch : /red/i,
		name : "Red draconblood dragonborn",
		trait : "Red draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_fireBreathCone,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "fire"
	});
	AddRacialVariant("draconblood dragonborn", "silver", {
		regExpSearch : /silver/i,
		name : "Silver draconblood dragonborn",
		trait : "Silver draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_coldBreath,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "cold"
	});
	AddRacialVariant("draconblood dragonborn", "white", {
		regExpSearch : /white/i,
		name : "White draconblood dragonborn",
		trait : "White draconblood dragonborn (+2 Intelligence, +1 Charisma)" + desc([
			EGtW_coldBreath,
			EGtW_forcefulPresenceStr
		]),
		breathDmgType : "cold"
	});

	// Ravenite
	RaceList["ravenite dragonborn"] = {
		regExpSearch : /ravenite/i,
		name : "Ravenite Dragonborn",
		sortname : "Dragonborn, Ravenite",
		source : [["W", 169]],
		plural : "Ravenite Dragonborn",
		size : 3,
		speed : {
			walk : { spd : 30, enc : 20 }
		},
		languageProfs : ["Common", "Draconic"],
		vision : [["Darkvision", 60]],
		weaponOptions : [EGtW_breathWeaponObj],
		age : " reach adulthood by 15 and live around 80 years",
		height : " stand well over 6 feet tall (5'6\" + 2d8\")",
		weight : " weigh around 240 lb (175 + 2d8 \xD7 2d6 lb)",
		heightMetric : " stand well over 1,8 metres tall (170 + 5d8 cm)",
		weightMetric : " weigh around 110 kg (80 + 5d8 \xD7 4d6 / 10 kg)",
		scores : [2, 1, 0, 0, 0, 0],
		trait : "Ravenite Dragonborn (+2 Strength, +1 Constitution)" + desc([
			"Draconic Ancestry: Choose one type of dragon using the \"Racial Options\" button. I gain a breath weapon as determined by the dragon type chosen.",
			EGtW_vengefulAssaultStr
		]),
		features : {
			"draconic ancestry" : EGtW_draconicAncestryFeature,
			"vengeful assault" : {
				name : "Vengeful Assault",
				source : [["W", 168]],
				minlevel : 1,
				usages : 1,
				action : [['reaction', ""]],
				recovery : "short rest"
			}
		},
		variants : []
	};
	AddRacialVariant("ravenite dragonborn", "black", {
		regExpSearch : /black/i,
		name : "Black ravenite dragonborn",
		trait : "Black ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_acidBreath,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "acid"
	});
	AddRacialVariant("ravenite dragonborn", "blue", {
		regExpSearch : /blue/i,
		name : "Blue ravenite dragonborn",
		trait : "Blue ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_lightningBreath,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "lightning"
	});
	AddRacialVariant("ravenite dragonborn", "brass", {
		regExpSearch : /brass/i,
		name : "Brass ravenite dragonborn",
		trait : "Brass ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_fireBreathLine,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "fire"
	});
	AddRacialVariant("ravenite dragonborn", "bronze", {
		regExpSearch : /bronze/i,
		name : "Bronze ravenite dragonborn",
		trait : "Bronze ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_lightningBreath,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "lightning"
	});
	AddRacialVariant("ravenite dragonborn", "copper", {
		regExpSearch : /copper/i,
		name : "Copper ravenite dragonborn",
		trait : "Copper ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_acidBreath,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "acid"
	});
	AddRacialVariant("ravenite dragonborn", "gold", {
		regExpSearch : /gold/i,
		name : "Gold ravenite dragonborn",
		trait : "Gold ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_fireBreathCone,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "fire"
	});
	AddRacialVariant("ravenite dragonborn", "green", {
		regExpSearch : /green/i,
		name : "Green ravenite dragonborn",
		trait : "Green ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_poisonBreath,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "poison"
	});
	AddRacialVariant("ravenite dragonborn", "red", {
		regExpSearch : /red/i,
		name : "Red ravenite dragonborn",
		trait : "Red ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_fireBreathCone,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "fire"
	});
	AddRacialVariant("ravenite dragonborn", "silver", {
		regExpSearch : /silver/i,
		name : "Silver ravenite dragonborn",
		trait : "Silver ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_coldBreath,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "cold"
	});
	AddRacialVariant("ravenite dragonborn", "white", {
		regExpSearch : /white/i,
		name : "White ravenite dragonborn",
		trait : "White ravenite dragonborn (+2 Strength, +1 Constitution)" + desc([
			EGtW_coldBreath,
			EGtW_vengefulAssaultStr
		]),
		breathDmgType : "cold"
	});
}

// Subclasses
AddSubClass("fighter", "echo knight", { // contains contributions by Smashman, @Nod_Hero#2046 (Discord), BraabHimself, and TysonJouglet
	regExpSearch : /^(?!.*(exalted|sacred|holy|divine|nature|natural|purple.*dragon|green))(?=.*(knight|fighter|warrior|militant|warlord|phalanx|gladiator|trooper))(?=.*(echo|mirror|mirage|reflection)).*$/i,
	subname : "Echo Knight",
	source : [["W", 183]],
	fullname : "Echo Knight",
	features : {
		"subclassfeature3" : {
			name : "Manifest Echo",
			source : [["W", 183]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can magically manifest a translucent image of myself within 15 ft",
				"My echo lasts until I dismiss it as a bonus action, I manifest another, or I'm incapacitated",
				"It is also destroyed if it is more than 30 ft away from me at the end of my turn",
				"It has 1 HP, immunity to all conditions, uses my save bonuses, and AC 14 + Prof Bonus",
				"On my turn as a free action, I can command it to move up to 30 ft in any direction",
				"As a bonus action, I can teleport to swap places with it, at a cost of 15 ft movement",
				"When I use the Attack action on my turn, I can have any attack originate from my echo",
				"I can also make opportunity attacks from the echo's location as if I were in its space"
			]),
			action : [["bonus action", " (summon/dismiss)"], ["bonus action", "Swap Location with Echo"]],
			creaturesAdd : [["Echo"]],
			creatureOptions : [{
				name : "Echo",
				source : [["W", 183]],
				size : 3,
				type : "Echo",
				alignment : "",
				ac : "14+oProf",
				hp : 1,
				hd : [],
				speed : "fly 30 ft (hover)",
				scores : ["", "", "", "", "", ""],
				savesLinked : true,
				condition_immunities : "all conditions",
				passivePerception : 0,
				languages : "",
				senses : "",
				challengeRating : "0",
				proficiencyBonus : 0,
				attacksAction : 0,
				attacks : [],
				features : [{
					name : "Echo",
					description : "The echo is a magical, translucent, gray image of its creator that doesn't act and has no turn in combat. It lasts until it is destroyed, dismissed, another is manifested, or its creator is incapacitated. The echo is also destroyed if it is ever more than 30 ft away from its creator at the end of its creator's turn."
				}],
				traits : [{
					name : "Swap Place",
					description : "The echo's creator can, as a bonus action, teleport, magically swapping places with the echo at a cost of 15 feet of the creator's movement, regardless of the distance between the two."
				}, {
					name : "Attack Origin",
					description : "When the echo's creator takes the Attack action on their turn, any attack they make with that action can originate from the echo's space. This choice is made for each attack separately.\n   In addition, when a creature that the echo's creator can see within 5 ft of the echo moves at least 5 ft away from it, its creator can use their reaction to make an opportunity attack against that creature as if its creator was in the echo's space."
				}],
				header : "Echo",
				eval : function(prefix, lvl) {
					// Same size as character
					PickDropdown(prefix + "Comp.Desc.Size", tDoc.getField("Size Category").currentValueIndices);
					Value(prefix + "Comp.Desc.Age", What("Age"));
					Value(prefix + "Comp.Desc.Sex", What("Sex"));
					Value(prefix + "Comp.Desc.Height", What("Height"));
					Value(prefix + "Comp.Desc.Alignment", What("Alignment"));
				}
			}]
		},
		"subclassfeature3.1" : {
			name : "Unleash Incarnation",
			source : [["W", 183]],
			minlevel : 3,
			description : desc([
				"When I use the Attack action, I can make one extra melee attack from my echo's position"
			]),
			usages : "Constitution modifier per ",
			usagescalc : "event.value = Math.max(1, What('Con Mod'));",
			recovery : "long rest"
		},
		"subclassfeature7" : {
			name : "Echo Avatar",
			source : [["W", 183]],
			minlevel : 7,
			description : desc([
				"As an action, I can temporarily transfer my consciousness to my echo for up to 10 min",
				"During this time, I see and hear through its eyes and ears, but not my own eyes and ears",
				"While I use my echo this way, it can be up to 1000 ft away from me without issue",
				"I can end this at any time, requiring no action"
			]),
			action : [["action", ""]]
		},
		"subclassfeature10" : {
			name : "Shadow Martyr",
			source : [["W", 183]],
			minlevel : 10,
			description : desc([
				"As a reaction when a creature I can see is attacked, I can make my echo the target",
				"Before the attack roll, the echo teleports to an empty space within 5 ft of the creature",
				"The attack roll of the triggering attack is then made against the echo instead"
			]),
			action : [["reaction", ""]],
			usages : 1,
			recovery : "short rest"
		},
		"subclassfeature15" : {
			name : "Reclaim Potential",
			source : [["W", 184]],
			minlevel : 15,
			description : desc([
				"When my echo is destroyed by taking damage, I gain 2d6 + my Con mod in temp HP",
				"I can only gain these temporary hit points if I don't already have temporary hit points"
			]),
			usages : "Constitution modifier per ",
			usagescalc : "event.value = Math.max(1, What('Con Mod'));",
			recovery : "long rest"
		},
		"subclassfeature18" : {
			name : "Legion of One",
			source : [["W", 184]],
			minlevel : 18,
			description : desc([
				"I can now manifest two echoes instead of one with the same bonus action",
				"These two can coexist, but if I manifest a third, the previous two are destroyed",
				"Anything I can do from one echo's position can be done from the other's instead",
				"I regain one use of Unleash Incarnation if I have no more remaining when I roll initiative"
			])
		}
	}
});
AddSubClass("wizard", "chronurgy magic", { // contains contributions by bassbogan on GitHub and @Nod_Hero#2046 on Discord
	regExpSearch : /chronurgy|chronomancer|chronurgist/i,
	subname : "Chronurgy Magic",
	source : [["W", 184]],
	fullname : "Chronurgist",
	features : {
		"subclassfeature2" : {
			name : "Chronal Shift",
			source : [["W", 184]],
			minlevel : 2,
			description : desc([
				"As a reaction after I or a creature I see rolls a check, save, or attack, I can force a reroll",
				"I can do this after I see if the roll fails or succeeds; The target must use the second roll."
			]),
			action : [["reaction", ""]],
			usages : 2,
			recovery : "long rest",
			eval : function() {
				// Always have access to dunamancy spells enabled
				if (GetFeatureChoice("classes", "wizard", "spellcasting", true).indexOf("access to dunamancy spells") === -1) {
					ClassFeatureOptions(["wizard", "spellcasting", "access to dunamancy spells", true]);
				}
			},
			removeeval : function() {
				// Remove access to dunamancy spells when removing subclass
				if (GetFeatureChoice("classes", "wizard", "spellcasting", true).indexOf("access to dunamancy spells") !== -1) {
					ClassFeatureOptions(["wizard", "spellcasting", "access to dunamancy spells", true], "remove");
				}
			}
		},
		"subclassfeature2.1" : {
			name : "Temporal Awareness",
			source : [["W", 184]],
			minlevel : 2,
			description : desc([
				"I gain a bonus to my initiative rolls equal to my Intelligence modifier"
			]),
			addMod : { type : "skill", field : "Init", mod : "max(Int|0)", text : "I can add my Intelligence modifier to initiative rolls." }
		},
		"subclassfeature6" : {
			name : "Momentary Stasis",
			source : [["W", 184]],
			minlevel : 6,
			description : desc([
				"As an action, I can have a Large or smaller creature I can see in 60 ft make a Con save",
				"If failed, it is encased in a field of magical energy, incapacitated and has a speed of 0",
				"This lasts until the end of my next turn or until the creature takes any damage"
			]),
			action : [["action", ""]],
			usages : "Intelligence modifier per ",
			usagescalc : "event.value = Math.max(1, What('Int Mod'));",
			recovery : "long rest"
		},
		"subclassfeature10" : {
			name : "Arcane Abeyance",
			source : [["W", 184]],
			minlevel : 10,
			description : desc([
				"When I use a spell slot to cast a 4th-level or lower spell, I can condense it into a mote",
				"The spell is frozen in time at the moment of casting and held within a grey bead",
				"The bead is a Tiny object with 1 HP, AC 15, and immune to poison and psychic damage",
				"After 1 hour or if it is destroyed, it vanishes with a flash of light and the spell is lost",
				"As an action, a creature holding the bead can release the spell within as if they cast it",
				"The spell still uses my spell attack bonus and save DC; The bead vanishes once used"
			]),
			usages : 1,
			recovery : "short rest"
		},
		"subclassfeature14" : {
			name : "Convergent Future",
			source : [["W", 185]],
			minlevel : 14,
			description : desc([
				"As a reaction after I or a creature I see rolls a check, save, or attack, I can choose the roll",
				"I decide the number rolled, if it is the minimum needed to succeed or 1 less than that",
				"When I use this feature, I gain a level of exhaustion which only a long rest can remove"
			]),
			action : [["reaction", ""]]
		}
	}
});
AddSubClass("wizard", "graviturgy magic", { // contains contributions by bassbogan on GitHub and @Nod_Hero#2046 on Discord
	regExpSearch : /^((?=.*graviturgy)(?=.*(wizard|magic|mage))|gravimancer|graviturgist).*$/i,
	subname : "Graviturgy Magic",
	source : [["W", 185]],
	fullname : "Graviturgist",
	features : {
		"subclassfeature2" : {
			name : "Adjust Density",
			source : [["W", 185]],
			minlevel : 2,
			description : desc([
				"As an action, I can magically double or halve the weight of a creature I can see in 30 ft",
				"If doubled, it has -10 ft speed and advantage on Strength checks and Strength saves",
				"If halved, it has +10 ft speed, can jump twice as far, and disadv. on Str checks and saves",
				"This lasts for 1 minute or until my concentration ends (like concentrating on a spell)"
			]),
			action : [["action", ""]],
			additional : levels.map(function (n) {
				return n < 2 ? "" : (n < 10 ? "Large" : "Huge") + " or smaller creatures";
			}),
			eval : function() {
				// Always have access to dunamancy spells enabled
				if (GetFeatureChoice("classes", "wizard", "spellcasting", true).indexOf("access to dunamancy spells") === -1) {
					ClassFeatureOptions(["wizard", "spellcasting", "access to dunamancy spells", true]);
				}
			},
			removeeval : function() {
				// Remove access to dunamancy spells when removing subclass
				if (GetFeatureChoice("classes", "wizard", "spellcasting", true).indexOf("access to dunamancy spells") !== -1) {
					ClassFeatureOptions(["wizard", "spellcasting", "access to dunamancy spells", true], "remove");
				}
			}
		},
		"subclassfeature6" : {
			name : "Gravity Well",
			source : [["W", 185]],
			minlevel : 6,
			description : desc([
				"Whenever I cast a spell on a creature, I can move it 5 ft to an empty space of my choice",
				"This only works if the target is willing, fails its save vs. the spell, or the spell attack hits it"
			]),
		},
		"subclassfeature10" : {
			name : "Violent Attraction",
			source : [["W", 185]],
			minlevel : 10,
			description : desc([
				"As a reaction when I or a creature I see in 60 ft hits a weapon attack, I can improve it",
				"I increase the weapon's velocity, causing it to deal an extra 1d10 damage",
				"As a reaction if a creature within 60 ft is damaged by a fall, I can increase it by 2d10"
			]),
			action : [["reaction", ""]],
			usages : "Intelligence modifier per ",
			usagescalc : "event.value = Math.max(1, What('Int Mod'));",
			recovery : "long rest"
		},
		"subclassfeature14" : {
			name : "Event Horizon",
			source : [["W", 185]],
			minlevel : 14,
			description : desc([
				"As an action, I can magically emit powerful gravitational magic that pulls on hostiles",
				"Whenever a creature hostile to me starts it turn within 30 ft, it must make Str save",
				"If failed, it takes 2d10 force damage and its speed is 0 until the start of its next turn",
				"If successful, it takes half the damage and every foot it moves this turn costs 2 extra feet",
				"This lasts for 1 minute or until my concentration ends (like concentrating on a spell)",
				"I can do this once per long rest, or by expending a 3rd-level or higher spell slot (SS 3+)"
			]),
			action : [["action", ""]],
			usages : 1,
			recovery : "long rest",
			altResource : "SS 3+",
		}
	}
});

// Add option to allow Dunamancy spells for the other spellcastingclasses
AddFeatureChoice(ClassList.bard.features.spellcasting, true, "Access to Dunamancy Spells", {
	name : "Dunamancy Spells",
	extraname : "Optional Bard 1",
	source : [["W", 186]],
	description : desc([
		"All dunamancy spells are added to the bard spell list, each still pending DM's approval"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "bard" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["sapping sting", "gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt", "gravity fissure", "tether essence", "dark star", "reality break", "ravenous void", "time ravage"]);
			},
			"This optional class feature expands the spell list of the bard class with all dunamancy spells (spell level in brackets): Sapping Sting (cantrip), Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), Temporal Shunt (5), Gravity Fissure (6), Tether Essence (7), Dark Star (8), Reality Break (8),Ravenous Void (9), and Time Ravage (9)."
		]
	}
}, "Optional 1st-level bard features");
AddFeatureChoice(ClassList.cleric.features.spellcasting, true, "Access to Dunamancy Spells", {
	name : "Dunamancy Spells",
	extraname : "Optional Cleric 1",
	source : [["W", 186]],
	description : desc([
		"All dunamancy spells are added to the cleric spell list, each still pending DM's approval"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "cleric" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["sapping sting", "gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt", "gravity fissure", "tether essence", "dark star", "reality break", "ravenous void", "time ravage"]);
			},
			"This optional class feature expands the spell list of the cleric class with all dunamancy spells (spell level in brackets): Sapping Sting (cantrip), Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), Temporal Shunt (5), Gravity Fissure (6), Tether Essence (7), Dark Star (8), Reality Break (8),Ravenous Void (9), and Time Ravage (9)."
		]
	}
}, "Optional 1st-level cleric features");
AddFeatureChoice(ClassList.druid.features.spellcasting, true, "Access to Dunamancy Spells", {
	name : "Dunamancy Spells",
	extraname : "Optional Druid 1",
	source : [["W", 186]],
	description : desc([
		"All dunamancy spells are added to the druid spell list, each still pending DM's approval"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "druid" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["sapping sting", "gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt", "gravity fissure", "tether essence", "dark star", "reality break", "ravenous void", "time ravage"]);
			},
			"This optional class feature expands the spell list of the druid class with all dunamancy spells (spell level in brackets): Sapping Sting (cantrip), Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), Temporal Shunt (5), Gravity Fissure (6), Tether Essence (7), Dark Star (8), Reality Break (8),Ravenous Void (9), and Time Ravage (9)."
		]
	}
}, "Optional 1st-level druid features");
AddFeatureChoice(ClassList.paladin.features.spellcasting, true, "Access to Dunamancy Spells", {
	name : "Dunamancy Spells",
	extraname : "Optional Paladin 2",
	source : [["W", 186]],
	description : desc([
		"All dunamancy spells are added to the paladin spell list, each still pending DM's approval"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "paladin" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt"]);
			},
			"This optional class feature expands the spell list of the paladin class with all dunamancy spells (spell level in brackets): Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), and Temporal Shunt (5)."
		]
	}
}, "Optional 2nd-level paladin features");
var EGtW_Ranger_Dunamancy_Spells = {
	name : "Dunamancy Spells",
	extraname : "Optional Ranger 2",
	source : [["W", 186]],
	description : desc([
		"All dunamancy spells are added to the ranger spell list, each still pending DM's approval"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if ((spName !== "ranger" && spName !== "rangerua") || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt"]);
			},
			"This optional class feature expands the spell list of the ranger class with all dunamancy spells (spell level in brackets): Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), and Temporal Shunt (5)."
		]
	}
};
AddFeatureChoice(ClassList.ranger.features.spellcasting, true, "Access to Dunamancy Spells", EGtW_Ranger_Dunamancy_Spells, "Optional 2nd-level ranger features");
RunFunctionAtEnd(function() {
	if (!ClassList["rangerua"]) return;
	AddFeatureChoice(ClassList.rangerua.features.spellcasting, true, "Access to Dunamancy Spells", EGtW_Ranger_Dunamancy_Spells, "Optional 2nd-level ranger features");
});
AddFeatureChoice(ClassList.sorcerer.features.spellcasting, true, "Access to Dunamancy Spells", {
	name : "Dunamancy Spells",
	extraname : "Optional Sorcerer 1",
	source : [["W", 186]],
	description : desc([
		"All dunamancy spells are added to the sorcerer spell list, each still pending DM's approval"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "sorcerer" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["sapping sting", "gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt", "gravity fissure", "tether essence", "dark star", "reality break", "ravenous void", "time ravage"]);
			},
			"This optional class feature expands the spell list of the sorcerer class with all dunamancy spells (spell level in brackets): Sapping Sting (cantrip), Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), Temporal Shunt (5), Gravity Fissure (6), Tether Essence (7), Dark Star (8), Reality Break (8),Ravenous Void (9), and Time Ravage (9)."
		]
	}
}, "Optional sorcerer features");
AddFeatureChoice(ClassList.warlock.features["pact magic"], true, "Access to Dunamancy Spells", {
	name : "Dunamancy Spells",
	extraname : "Optional Warlock 1",
	source : [["W", 186]],
	description : desc([
		"All dunamancy spells are added to the warlock spell list, each still pending DM's approval"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "warlock" || (spType.indexOf("bonus") !== -1 && (!spList["class"] || spList["class"] !== "warlock"))) return;
				spList.extraspells = spList.extraspells.concat(["sapping sting", "gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt", "gravity fissure", "tether essence", "dark star", "reality break", "ravenous void", "time ravage"]);
			},
			"This optional class feature expands the spell list of the warlock class with all dunamancy spells (spell level in brackets): Sapping Sting (cantrip), Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), Temporal Shunt (5), Gravity Fissure (6), Tether Essence (7), Dark Star (8), Reality Break (8),Ravenous Void (9), and Time Ravage (9)."
		]
	}
}, "Optional 1st-level warlock features");
AddFeatureChoice(ClassList.wizard.features.spellcasting, true, "Access to Dunamancy Spells", {
	name : "Dunamancy Spells",
	extraname : "Optional Wizard 1",
	source : [["W", 186]],
	description : desc([
		"All dunamancy spells are added to the wizard spell list, each still pending DM's approval"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "wizard" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["sapping sting", "gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt", "gravity fissure", "tether essence", "dark star", "reality break", "ravenous void", "time ravage"]);
			},
			"This optional class feature expands the spell list of the wizard class with all dunamancy spells (spell level in brackets): Sapping Sting (cantrip), Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), Temporal Shunt (5), Gravity Fissure (6), Tether Essence (7), Dark Star (8), Reality Break (8),Ravenous Void (9), and Time Ravage (9)."
		]
	}
}, "Optional 1st-level wizard features");
RunFunctionAtEnd(function() {
	if (!ClassList.artificer) return;
	AddFeatureChoice(ClassList.artificer.features.spellcasting, true, "Access to Dunamancy Spells", {
		name : "Dunamancy Spells",
		extraname : "Optional Artificer 1",
		source : [["W", 186]],
		description : desc([
			"All dunamancy spells are added to the artificer spell list, each still pending DM's approval"
		]),
		calcChanges : {
			spellList : [
				function(spList, spName, spType) {
					if (spName !== "artificer" || spType.indexOf("bonus") !== -1) return;
					spList.extraspells = spList.extraspells.concat(["sapping sting", "gift of alacrity", "magnify gravity", "fortune's favor", "immovable object", "wristpocket", "pulse wave", "gravity sinkhole", "temporal shunt"]);
				},
				"This optional class feature expands the spell list of the artificer class with all dunamancy spells (spell level in brackets): Sapping Sting (cantrip), Gift of Alacrity (1), Magnify Gravity (1), Fortune's Favor (2), Immovable Object (2), Wristpocket (2), Pulse Wave (3), Gravity Sinkhole (4), Temporal Shunt (5)."
			]
		}
	}, "Optional 1st-level artificer features");
});

// Backgrounds (includes contributions by remcovandalen)
BackgroundList["grinner"] = {
	regExpSearch : /grinner/i,
	name : "Grinner",
	source : [["W", 200]],
	skills : ["Deception", "Performance"],
	toolProfs : [["Thieves' tools", "Dex"], ["Musical instrument", 1]],
	gold : 15,
	equipleft : [
		["Disguise kit", "", 3],
		["Musical instrument", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Gold-plated ring with smiling face", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Ballad of the Grinning Fool",
	trait : [
		"I love the spotlight. Everyone, look at me!",
		"Give me a drink and I'm your friend.",
		"Talk to me about yourself. I'm a hell of a listener.",
		"I hate to start fights, but I love to finish them.",
		"I can't sit still.",
		"I'm always humming an old tune from my past.",
		"When I don't have a reason to smile, I'm miserable.",
		"I'm lucky like you wouldn't believe."
	],
	ideal : [
		["Revolution",
			"Revolution: Tyrants must fall, no matter the cost. (Chaotic)"
		],
		["Compassion",
			"Compassion: The only way to make a better world is to perform small kindnesses. (Good)"
		],
		["Justice",
			"Justice: A nation built upon just foundations will uphold freedom for all. (Law)"
		],
		["Expression",
			"Expression: Music, joy, and laughter are the keys to freedom. (Good)"
		],
		["Self-Determination",
			"Self-Determination: People should be free to do as they please. (Chaotic)"
		],
		["Vigilance",
			"Vigilance: A free people must be carefully taught, lest they be misled. (Neutral)"
		]
	],
	bond : [
		"I lost someone important to an agent of the empire. That regime will fall.",
		"The first people to be hurt by this war will be the common folk. I need to protect them.",
		"Music helped me through a dark time in my life. Now, I'll use music to change the world.",
		"I will be known as the greatest spy who ever lived.",
		"All life is precious to me. I know I can change the world without taking a humanoid life.",
		"The elite in their ivory towers don't understand how we suffer. I intend to show them."
	],
	flaw : [
		"I've never lied once in my life. What? No, I'm not crossing my fingers!",
		"I do everything big! Subtlety? I don't know the meaning of subtlety! Oh, that's a problem?",
		"Being a spy in wartime is painful. I've seen so much suffering, I think I'm losing my mind.",
		"I can't focus on my mission. I just want to carouse and sing and play!",
		"Yeah, that's my name. Yeah, I'm a Grinner spy. Who cares about staying undercover?",
		"I can't afford to trust anyone. Not. Anyone."
	],
	extra : [
		"Select Your Favorite Code-Song",
		"Zan's Coming Back",
		"Blow Fire Down the Coast",
		"Hush! Onward Come the Dragons",
		"Let the Sword Grow Rust",
		"Drink Deep, Li'l Hummingbird",
		"Dirge for the Emerald Fire"
	]
};
BackgroundFeatureList["ballad of the grinning fool"] = {
	description : "A member of the Golden Grin will find me and give shelter to me and my companions if I play the Ballad of the Grinning Fool in a major tavern or inn in a large city. This shelter might be discontinued if it becomes too dangerous to hide me. I must use the ballad with caution, for those who know the ballad can be traitors, counterspies, or agents of tyranny.",
	source : [["W", 200]]
};
BackgroundList["volstrucker agent"] = {
	regExpSearch : /^(?=.*volstrucker)(?=.*agent).*$/i,
	name : "Volstrucker Agent",
	source : [["W", 202]],
	skills : ["Deception", "Stealth"],
	toolProfs : ["Poisoner's kit"],
	languageProfs : [1],
	gold : 10,
	equipleft : [
		["Poisoner's kit", "", 2]
	],
	equipright : [
		["Common clothes", "", 3],
		["Black cloak with a hood", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Shadow Network",
	trait : [
		"I prefer to keep my thoughts to myself.",
		"I indulge vice in excess to quiet my conscience.",
		"I've left emotion behind me. I'm now perfectly placid.",
		"Some event from the past keeps worming its way into my mind, making me restless.",
		"I always keep my word\u2014except when I'm commanded to break it.",
		"I laugh off insults and never take them personally."
	],
	ideal : [
		["Order",
			"Order: The will of the crown is absolute. (Law)"
		],
		["True Loyalty",
			"True Loyalty: The Cerberus Assembly is greater than any power, even the crown. (Any)"
		],
		["Death",
			"Death: The penalty for disloyalty is death. (Evil)"
		],
		["Determination",
			"Determination: I cannot fail. Not ever. (Neutral)"
		],
		["Fear",
			"Fear: People should not respect power. They should fear it. (Evil)"
		],
		["Escape",
			"Escape: The Volstrucker are pure evil! I can't atone for what I've done for them, but I can escape with my life. (Any)"
		]
	],
	bond : [
		"The job is all that matters. I will see it through.",
		"My orders are important, but my comrades are worth more than anything. I would die for them.",
		"Everything I've done, I've done to protect someone close to me.",
		"If the empire falls, all of civilization falls with it. I will hold back chaos and barbarism at any cost."
	],
	flaw : [
		"I drink to dull the pain in the back of my head.",
		"I go a bit mad when I see blood.",
		"I can hear the voices of everyone I've killed. I see their faces. I can't be free of these ghosts.",
		"Fear is a powerful motivator. I will do whatever it takes to prevent those who know what I am from seeing me fail, and from those I care about from knowing what I am."
	],
	extra : [
		"Select Your Tragedy",
		"Familicide",
		"Amnesia",
		"Capture",
		"Starvation",
		"Disfigurement",
		"Vicissitude"
	]
};
BackgroundFeatureList["shadow network"] = {
	description : "I can use the Volstrucker shadow network to communicate with other members over long distances. I can write a letter in special arcane ink (10 gp per page), address it to another member of the Volstrucker, and cast it into a fire. It will burn and materialize whole again on the person of the addressee. This special ink is the same as used for a wizard's spellbook.",
	source : [["W", 202]]
};
AddBackgroundVariant("acolyte", "luxonborn", {
	regExpSearch : /luxonborn/i,
	name : "Luxonborn",
	source : [["W", 203]]
});
AddBackgroundVariant("criminal", "myriad operative", {
	regExpSearch : /^(?=.*myriad)(?=.*operative).*$/i,
	name : "Myriad Operative",
	source : [["W", 203]],
	extra : ""
});
AddBackgroundVariant("sailor", "revelry pirate", {
	regExpSearch : /^(?=.*revelry)(?=.*pirate).*$/i,
	name : "Revelry Pirate",
	source : [["W", 203]]
});
AddBackgroundVariant("sage", "cobalt scholar", {
	regExpSearch : /^(?=.*cobalt)(?=.*scholar).*$/i,
	name : "Cobalt Scholar",
	source : [["W", 203]],
	extra : [
		"Select Specific Role",
		"Rank-and-file",
		"Expositors",
		"Archivists"
	]
});
AddBackgroundVariant("criminal", "augen trust", {
	regExpSearch : /^(?=.*augen)(?=.*trust).*$/i,
	name : "Augen Trust",
	source : [["W", 203]],
	extra : ""
});

// Spells (contains contributions by Biggoron144)
SpellsList["sapping sting"] = {
	name : "Sapping Sting",
	classes : [],
	source : [["W", 189]],
	level : 0,
	school : "Necro",
	time : "1 a",
	range : "30 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "1 creature that I can see save or 1d4 Necrotic dmg and fall prone; +1d4 at CL 5, 11, and 17",
	descriptionCantripDie : "1 creature that I can see save or `CD`d4 Necrotic dmg and fall prone",
	descriptionFull : "You sap the vitality of one creature you can see in range. The target must succeed on a Constitution saving throw or take 1d4 necrotic damage and fall prone.\n   This spell's damage increases by 1d4 when you reach 5th level (2d4), 11th level (3d4), and 17th level (4d4)."
};
WeaponsList["sapping sting"] = {
	regExpSearch : /^(?=.*sapping)(?=.*sting).*$/i,
	name : "Sapping Sting",
	source : [["W", 189]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 4, "necrotic"],
	range : "30 ft",
	description : "Con save, success - no damage, fail - also fall prone",
	abilitytodamage : false,
	dc : true
};
SpellsList["gift of alacrity"] = {
	name : "Gift of Alacrity",
	classes : [],
	source : [["W", 186]],
	level : 1,
	school : "Div",
	time : "1 min",
	range : "Touch",
	components : "V,S",
	duration : "8 h",
	description : "1 willing creature can add 1d8 to its initiative rolls for the duration",
	descriptionFull : "You touch a willing creature. For the duration, the target can add 1d8 to its initiative rolls."
};
SpellsList["magnify gravity"] = {
	name : "Magnify Gravity",
	classes : [],
	source : [["W", 188]],
	level : 1,
	school : "Trans",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "1 rnd",
	save : "Con",
	description : "10-ft rad all crea 2d8+1d8/SL Force dmg, half spd; Save halves \u0026 no spd reduce; Str check to move obj",
	descriptionShorter : "10-ft rad all 2d8+1d8/SL Force dmg, half spd; Save half, no spd reduce; Str check to move obj",
	descriptionFull : "The gravity in a 10-foot-radius sphere centered on a point you can see within range increases for a moment. Each creature in the sphere on the turn when you cast the spell must make a Constitution saving throw. On a failed save, a creature takes 2d8 force damage, and its speed is halved until the end of its next turn. On a successful save, a creature takes half as much damage and suffers no reduction to its speed.\n   Until the start of your next turn, any object that isn't being worn or carried in the sphere requires a successful Strength check against your spell save DC to pick up or move." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st."
};
SpellsList["fortune's favor"] = {
	name : "Fortune's Favor",
	classes : [],
	source : [["W", 186]],
	level : 2,
	school : "Div",
	time : "1 min",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "A white pearl worth at least 100 gp, which the spell consumes",
	duration : "1 h",
	description : "1+1/SL crea once roll extra d20 and select which to use for atk, check, save, or atk vs. it (100gp cons.)",
	descriptionFull : "You impart latent luck to yourself or one willing creature you can see within range. When the chosen creature makes an attack roll, an ability check, or a saving throw before the spell ends, it can dismiss this spell on itself to roll an additional d20 and choose which of the d20s to use. Alternatively, when an attack roll is made against the chosen creature, it can dismiss this spell on itself to roll a d20 and choose which of the d20s to use, the one it rolled or the one the attacker rolled.\n   If the original d20 roll has advantage or disadvantage, the creature rolls the additional d20 after advantage or disadvantage has been applied to the original roll." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, you can target one additional creature for each slot level above 2nd."
};
SpellsList["immovable object"] = {
	name : "Immovable Object",
	classes : [],
	source : [["W", 187]],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "Gold dust worth at least 25 gp, which the spell consumes",
	duration : "1 h",
	description : "1 obj <10 lb fixed in place; holds 4k lb; Str check move, except chosen/password; See B (25gp cons.)",
	descriptionMetric : "1 obj <5 kg fixed in place; holds 2k kg; Str check move, except chosen/password; See B (25gp cons.)",
	descriptionFull : "You touch an object that weighs no more than 10 pounds and cause it to become magically fixed in place. You and the creatures you designate when you cast this spell can move the object normally. You can also set a password that, when spoken within 5 feet of the object, suppresses this spell for 1 minute.\n   If the object is fixed in the air, it can hold up to 4,000 pounds of weight. More weight causes the object to fall. Otherwise, a creature can use an action to make a Strength check against your spell save DC. On a success, the creature can move the object up to 10 feet." + AtHigherLevels + "If you cast this spell using a spell slot of 4th or 5th level, the DC to move the object increases by 5, it can carry up to 8,000 pounds of weight, and the duration increases to 24 hours. If you cast this spell using a spell slot of 6th level or higher, the DC to move the object increases by 10, it can carry up to 20,000 pounds of weight, and the effect is permanent until dispelled."
};
SpellsList["wristpocket"] = {
	name : "Wristpocket",
	classes : [],
	source : [["W", 190]],
	ritual : true,
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "Self",
	components : "S",
	duration : "Conc, 1 h",
	description : "Store 1 held obj <5 lb in extradim. space; 1 a to summon obj in free hand or return; reappears at end",
	descriptionMetric : "Store 1 held obj <2,5 kg in extradim. space; 1 a summon obj in free hand or return; reappears at end",
	descriptionFull : "You flick your wrist, causing one object in your hand to vanish. The object, which only you can be holding and can weigh no more than 5 pounds, is transported to an extradimensional space, where it remains for the duration.\n   Until the spell ends, you can use your action to summon the object to your free hand, and you can use your action to return the object to the extradimensional space. An object still in the pocket plane when the spell ends appears in your space, at your feet."
};
SpellsList["pulse wave"] = {
	name : "Pulse Wave",
	classes : [],
	source : [["W", 188]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "S:30" + (typePF ? "-" : "") + "ft cone",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "6d6+1d6/SL Force dmg, pulled/pushed 15+5/SL ft from me (also free obj); save halves, no move",
	descriptionMetric : "6d6+1d6/SL Force dmg, pull/push 4,5+1,5/SL m from me (also free obj); save halves, no move",
	descriptionShorter : "6d6+1d6/SL Force dmg, pull/push 15+5/SL ft from me (also free obj); save half, no move",
	descriptionFull : "You create intense pressure, unleash it in a 30-foot cone, and decide whether the pressure pulls or pushes creatures and objects. Each creature in that cone must make a Constitution saving throw. A creature takes 6d6 force damage on a failed save, or half as much damage on a successful one. And every creature that fails the save is either pulled 15 feet toward you or pushed 15 feet away from you, depending on the choice you made for the spell.\n   In addition, unsecured objects that are completely within the cone are likewise pulled or pushed 15 feet." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d6 and the distance pulled or pushed increases by 5 feet for each slot level above 3rd."
};
SpellsList["gravity sinkhole"] = {
	name : "Gravity Sinkhole",
	classes : [],
	source : [["W", 187]],
	level : 4,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A black marble",
	duration : "Instantaneous",
	save : "Con",
	description : "20-ft rad all crea 5d10+1d10/SL Force dmg, pulled to center of radius; save halves and not pulled",
	descriptionFull : "A 20-foot-radius sphere of crushing force forms at a point you can see within range and tugs at the creatures there. Each creature in the sphere must make a Constitution saving throw. On a failed save, the creature takes 5d10 force damage and is pulled in a straight line toward the center of the sphere, ending in an unoccupied space as close to the center as possible (even if that space is in the air). On a successful save, the creature takes half as much damage and isn't pulled." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the damage increases by 1d10 for each slot level above 4th."
};
SpellsList["temporal shunt"] = {
	name : "Temporal Shunt",
	classes : [],
	source : [["W", 189]],
	level : 5,
	school : "Trans",
	time : "1 rea",
	timeFull : "1 reaction, taken when a creature you can see makes an attack roll or starts to cast a spell",
	range : "120 ft",
	components : "V,S",
	duration : "1 rnd",
	save : "Wis",
	description : "Cast if see atk/cast, 1+1/SL crea, each max 30 ft apart, save or vanish until next turn, atk/cast wasted",
	descriptionFull : "You target the triggering creature, which must succeed on a Wisdom saving throw or vanish, being thrown to another point in time and causing the attack to miss or the spell to be wasted. At the start of its next turn, the target reappears where it was or in the closest unoccupied space. The target doesn't remember you casting the spell or being affected by it." + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, you can target one additional creature for each slot level above 5th. All targets must be within 30 feet of each other."
};
SpellsList["gravity fissure"] = {
	name : "Gravity Fissure",
	source : [["W", 187]],
	level : 6,
	school : "Evoc",
	time : "1 a",
	range : "S:100" + (typePF ? "-" : "") + "ft line",
	components : "V,S,M",
	compMaterial : "A fistful of iron filings",
	duration : "Instantaneous",
	save : "Con",
	description : "100-ft long 5-ft wide all 8d8+1d8/SL Force dmg, save half; all in 10 ft of line save or dmg \u0026 pull to it",
	descriptionShorter : "100-ft long 5-ft wide all 8d8+1d8/SL Force dmg, save half; all in 10 ft of it save or dmg \u0026 pulled",
	descriptionFull : "You manifest a ravine of gravitational energy in a line originating from you that is 100 feet long and 5 feet wide. Each creature in that line must make a Constitution saving throw, taking 8d8 force damage on a failed save, or half as much damage on a successful one.\n   Each creature within 10 feet of the line but not in it must succeed on a Constitution saving throw or take 8d8 force damage and be pulled toward the line until the creature is in its area." + AtHigherLevels + "When you cast this spell using a spell slot of 7th level or higher, the damage increases by 1d8 for each slot level above 6th."
};
SpellsList["tether essence"] = {
	name : "Tether Essence",
	classes : [],
	source : [["W", 189]],
	level : 7,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M\u2020",
	compMaterial : "A spool of platinum cord worth at least 250 gp, which the spell consumes",
	duration : "Conc, 1 h",
	save : "Con",
	description : "2 crea save (dis. if in 30 ft) or if both fail take same dmg and same healing; ends if 0 hp (250gp cons.)",
	descriptionFull : "Two creatures you can see within range must make a Constitution saving throw, with disadvantage if they are within 30 feet of each other. Either creature can willingly fail the save. If either save succeeds, the spell has no effect. If both saves fail, the creatures are magically linked for the duration, regardless of the distance between them. When damage is dealt to one of them, the same damage is dealt to the other one. If hit points are restored to one of them, the same number of hit points are restored to the other one. If either of the tethered creatures is reduced to 0 hit points, the spell ends on both. If the spell ends on one creature, it ends on both."
};
SpellsList["dark star"] = {
	name : "Dark Star",
	classes : [],
	source : [["W", 186]],
	level : 8,
	school : "Evoc",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "A shard of onyx and a drop of the caster's blood, both of which the spell consumes",
	duration : "Conc, 1 min",
	save : "Con",
	description : "Up to 40-ft rad as Darkness spell, as Silence spell, dif. ter.; enter/start turn 8d10 Force dmg, save half",
	descriptionShorter : "Up to 40-ft rad as Darkness \u0026 Silence, dif. ter.; enter/start turn 8d10 Force dmg, save half",
	descriptionFull : "This spell creates a sphere centered on a point you choose within range. The sphere can have a radius of up to 40 feet. The area within this sphere is filled with magical darkness and crushing gravitational force.\n   For the duration, the spell's area is difficult terrain. A creature with darkvision can't see through the magical darkness, and nonmagical light can't illuminate it. No sound can be created within or pass through the area. Any creature or object entirely inside the sphere is immune to thunder damage, and creatures are deafened while entirely inside it. Casting a spell that includes a verbal component is impossible there.\n   Any creature that enters the spell's area for the first time on a turn or starts its turn there must make a Constitution saving throw. The creature takes 8d10 force damage on a failed save, or half as much damage on a successful one. A creature reduced to 0 hit points by this damage is disintegrated. A disintegrated creature and everything it is wearing and carrying, except magic items, are reduced to a pile of fine gray dust."
};
SpellsList["reality break"] = {
	name : "Reality Break",
	classes : [],
	source : [["W", 189]],
	level : 8,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A crystal prism",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "1 crea save or can't take reactions, random effect each turn, see book; extra save at end of every turn",
	descriptionFull : "You shatter the barriers between realities and timelines, thrusting a creature into turmoil and madness. The target must succeed on a Wisdom saving throw, or it can't take reactions until the spell ends. The affected target must also roll a d10 at the start of each of its turns; the number rolled determines what happens to the target, as shown on the Reality Break Effects table."+
	"\n   At the end of each of its turns, the affected target can repeat the Wisdom saving throw, ending the spell on itself on a success."+
	"\n\n d10 \tEffect"+
	"\n 1-2 \tVision of the Far Realm: The target takes 6d12 psychic damage, and it is stunned until the end of the turn."+
	"\n 3-5 \tRending Rift: The target must make a Dexterity saving throw, taking 8d12 force damage on a failed save, or half as much damage on a successful one."+
	"\n 6-8 \tWormhole: The target is teleported, along with everything it is wearing and carrying, up to 30 feet to an unoccupied space of your choice that you can see. The target also takes 10d12 force damage and is knocked prone."+
	"\n 9-10\tChill of the Dark Void: The target takes 10d12 cold damage, and it is blinded until the end of the turn."
};
SpellsList["ravenous void"] = {
	name : "Ravenous Void",
	classes : [],
	source : [["W", 188]],
	level : 9,
	school : "Evoc",
	time : "1 a",
	range : "1000 ft",
	components : "V,S,M",
	compMaterial : "A small, nine-pointed star made of iron",
	duration : "Conc, 1 min",
	save : "Str",
	description : "20-ft rad all enter/start 5d10 Force dmg, restrained; all enter/start in 100 ft save or pulled in; see B",
	descriptionShorter : "20-ft rad all enter/start 5d10 Force dmg, restrained; all start in 100 ft save or pull in; see B",
	descriptionFull : "You create a 20-foot-radius sphere of destructive gravitational force centered on a point you can see within range. For the spell's duration, the sphere and any space within 100 feet of it are difficult terrain, and nonmagical objects fully inside the sphere are destroyed if they aren't being worn or carried.\n   When the sphere appears and at the start of each of your turns until the spell ends, unsecured objects within 100 feet of the sphere are pulled toward the sphere's center, ending in an unoccupied space as close to the center as possible.\n   A creature that starts its turn within 100 feet of the sphere must succeed on a Strength saving throw or be pulled straight toward the sphere's center, ending in an unoccupied space as close to the center as possible. A creature that enters the sphere for the first time on a turn or starts its turn there takes 5d10 force damage and is restrained until it is no longer in the sphere. If the sphere is in the air, the restrained creature hovers inside the sphere. A creature can use its action to make a Strength check against your spell save DC, ending this restrained condition on itself or another creature in the sphere that it can reach. A creature reduced to 0 hit points by this spell is annihilated, along with any nonmagical items it is wearing or carrying."
};
SpellsList["time ravage"] = {
	name : "Time Ravage",
	classes : [],
	source : [["W", 189]],
	level : 9,
	school : "Necro",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u2020",
	compMaterial : "An hourglass filled with diamond dust worth at least 5,000 gp, which the spell consumes",
	duration : "Instantaneous",
	save : "Con",
	description : "1 crea 10d12 Necrotic dmg \u0026 aged: dis. atk/chk/save, die in 30 days; save half, not aged (5k gp cons.)",
	descriptionShorter : "1 crea 10d12 Necro. dmg, aged: dis. atk/chk/save, die in 30 days; save hlf, no aged (5k gp cons)",
	descriptionFull : "You target a creature you can see within range, putting its physical form through the devastation of rapid aging. The target must make a Constitution saving throw, taking 10d12 necrotic damage on a failed save, or half as much damage on a successful one. If the save fails, the target also ages to the point where it has only 30 days left before it dies of old age. In this aged state, the target has disadvantage on attack rolls, ability checks, and saving throws, and its walking speed is halved. Only the wish spell or the greater restoration cast with a 9th-level spell slot can end these effects and restore the target to its previous age."
};

// Creatures - new beasts
CreatureList["moorbounder"] = {
	name : "Moorbounder",
	source : [["W", 295]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 30,
	hd : [4, 10],
	speed : "70 ft",
	scores : [18, 14, 14, 2, 13, 5],
	senses : "Darkvision 60 ft",
	passivePerception : 11,
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Claws",
		ability : 1,
		damage : [4, 4, "slashing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Standing Leap",
		description : "The moorbounder's long jump is up to 40 ft and its high jump is up to 20 ft, with or without a running start."
	}]
};
CreatureList["bristled moorbounder"] = {
	name : "Bristled Moorbounder",
	source : [["W", 295]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 15,
	hp : 52,
	hd : [7, 10],
	speed : "70 ft",
	scores : [18, 14, 14, 2, 13, 5],
	senses : "Darkvision 60 ft",
	passivePerception : 11,
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Blades",
		ability : 1,
		damage : [2, 6, "slashing"],
		range : "Melee (5 ft)",
		description : "One blades and one claws attack as an Attack action"
	}, {
		name : "Claws",
		ability : 1,
		damage : [4, 4, "slashing"],
		range : "Melee (5 ft)",
		description : "One blades and one claws attack as an Attack action"
	}],
	actions : [{
		name : "Multiattack",
		description : "The moorbounder makes two attacks: one with its blades and one with its claws."
	}],
	traits : [{
		name : "Bladed Hide",
		description : "At the start of each of its turns, the moorbounder deals 2d4 piercing damage to any creature grappling it."
	}, {
		name : "Standing Leap",
		description : "The moorbounder's long jump is up to 40 ft and its high jump is up to 20 ft, with or without a running start."
	}]
};

// Magic Items (each contain contributions by kat9137 [Discord] aka sophiechiabatta [GitHub])
MagicItemsList["acheron blade"] = {
	name : "Acheron Blade",
	nameTest : "Acheron",
	source : [["W", 265]],
	type : "weapon (any sword)",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "This sword gives a +1 to hit and damage rolls. While I'm holding it, I'm immune to effects that turn undead. As an action, once per dusk, I can use it to gain 1d4+4 temporary HP. Once per dusk, I can give a creature hit with it disadvantage on their next save until the end of my next turn (frighten effect).",
	descriptionFull : "The black blade of this sword is crafted from a mysterious arcane alloy. You gain a +1 bonus to attack and damage rolls made with this magic weapon. While the sword is on your person, you are immune to effects that turn undead."+
	"\n   " + toUni("Dark Blessing") + ". While holding the sword, you can use an action to give yourself 1d4 + 4 temporary hit points. This property can't be used again until the next dusk."+
	"\n   " + toUni("Disheartening Strike") + ". When you hit a creature with an attack using this weapon, you can fill the target with unsettling dread: the target has disadvantage on the next saving throw it makes before the end of your next turn. The creature ignores this effect if it's immune to the frightened condition. Once you use this property, you can't do so again until the next dusk",
	action : [["action", " (Dark Blessing)"]],
	savetxt : { immune : ["Effects that turn undead"] },
	extraLimitedFeatures : [{
		name : "Acheron Blade (Dark Blessing)",
		usages : 1,
		recovery : "Dusk"
	}, {
		name : "Acheron Blade (Disheartening Strike)",
		usages : 1,
		recovery : "Dusk"
	}],
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/acheron/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Once per dusk, target disadv. on next save until my next turn ends';
				}
			},
			'If I include the words "Acheron" in a the name of a sword, it will be treated as the magic weapon Acheron Blade.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/acheron/i).test(v.WeaponTextName)) {
					output.magic = v.thisWeapon[1] + 1;
				}
			},
			''
		]
	}
};

MagicItemsList["amulet of the drunkard"] = {
	name : "Amulet of the Drunkard",
	source : [["W", 266]],
	type : "wondrous item",
	rarity : "uncommon",
	notLegalAL : true,
	description : "This amulet smells of old, ale-stained wood. While wearing it, I can regain 4d4 + 4 hit points when I drink a pint of beer, ale, mead, or wine. Once the amulet has restored hit points, it can't do so again until the next dawn.",
	descriptionFull : "This amulet smells of old, ale-stained wood. While wearing it, you can regain 4d4 + 4 hit points when you drink a pint of beer, ale, mead, or wine. Once the amulet has restored hit points, it can't do so again until the next dawn.",
	usages : 1,
	recovery : "dawn"
};
var EGtW_ArcaneCannonFullDescription = [
	"This Large cannon is imbued with magic. It requires no ammunition and doesn't need to be loaded. It takes one action to aim the cannon and one action to fire it. After the cannon has fired, it must recharge for 5 minutes before it can be fired again. The creature firing the cannon chooses the effect from the following options:",
	">>Acid Jet<<. The cannon discharges acid in a line 300 feet long and 5 feet wide. Each creature in that line must make a DC 15 Dexterity saving throw, taking 4d10 acid damage on a failed save, or half as much damage on a successful one. In addition, a creature that fails its saving throw takes 2d10 acid damage at the start of each of its turns; a creature can end this damage by using its action to wash off the acid with a pint or more of water.",
	">>Fire Jet<<. The cannon discharges fire in a line 300 feet long and 5 feet wide. Each creature in the area must make a DC 15 Dexterity saving throw, taking 6d10 fire damage on a failed save, or half as much damage on a successful one. The fire ignites any flammable objects in the area that aren't being worn or carried.",
	">>Frost Shot<<. The cannon shoots a ball of frost to a point you can see within 1200 feet of the cannon. The ball then expands to form a 30-foot-radius sphere centered on that point. Each creature in that area must make a DC 15 Constitution saving throw. On a failed save, a creature takes 4d10 cold damage, and its speed is reduced by 10 feet for 1 minute. On a successful save, the creature takes half as much damage, and its speed isn't reduced. A creature whose speed is reduced by this effect can repeat the save at the end of each of its turns, ending the effect on itself on a success.",
	">>Lightning Shot<<. The cannon shoots a ball of lightning to a point you can see within 1200 feet of the cannon. The lightning then expands to form a 20-foot-radius sphere centered on that point. Each creature in that area must make a DC 15 Dexterity saving throw, taking 6d10 lightning damage on a failed save, or half as much damage on a successful one. Creatures wearing metal armor have disadvantage on the save.",
	">>Poison Spray<<. The cannon expels poison gas in a 60-foot cone. Each creature in that area must make a DC 15 Constitution saving throw. On a failed save, the creature takes 4d10 poison damage and is poisoned for 1 minute. On a successful save, the creature takes half as much damage and isn't poisoned. A creature poisoned in this way can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success."
];
MagicItemsList["arcane cannon"] = {
	name : "Arcane Cannon",
	source : [["W", 265]],
	type : "wondrous item",
	rarity : "very rare",
	notLegalAL : true,
	description : "This Large magical cannon requires no ammunition and doesn't need to be loaded, but takes 5 minutes to recharge once fired. It takes one action to aim it and another action to fire it. When I fire it, I can choose the effect, an acid jet, fire jet, frost shot, lightning shot, or poison spray. See Notes page.",
	descriptionFull : EGtW_ArcaneCannonFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	action : [["action", " (Aim or Fire)"]],
	toNotesPage : [{
		name : "Effects",
		note : "\n" + EGtW_ArcaneCannonFullDescription.join("\n \u2022 ").replace(/>>(.*?)<<\./g, function(a, match) { return match.toUpperCase() + ":"; }).replace(/\byou\b/ig, "I").replace(/\bf(oo|ee)t\b/ig, "ft")
	}]
};
MagicItemsList["battering shield"] = {
	name : "Battering Shield",
	source : [["W", 266]],
	type : "shield",
	rarity : "uncommon",
	notLegalAL : true,
	attunement : true,
	description : "This iron tower shield gives me a +1 bonus to AC, in addition to the shield's normal bonus to AC. It has 3 charges, regaining 1d3 expended charges daily at dawn. When I am holding the shield and push a creature 5 ft away, I can expend 1 charge to push that creature an additional 10 ft, knock it prone, or both.",
	descriptionFull : "While holding this iron tower shield, you gain a +1 bonus to AC. This bonus is in addition to the shield's normal bonus to AC.\n   Additionally, the shield has 3 charges, and it regains 1d3 expended charges daily at dawn. If you are holding the shield and push a creature within your reach at least 5 feet away, you can expend 1 charge to push that creature an additional 10 feet, knock it prone, or both.",
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	shieldAdd : ["Battering Shield", 3],
	weight : 6
};
MagicItemsList["bloodaxe"] = {
	name : "Bloodaxe",
	source : [["W", 266]],
	type : "weapon (greataxe)",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	description : "This rust-colored magical greataxe grants a +2 bonus to attack and damage rolls made with it. The axe deals an additional 1d6 necrotic damage to creature's that aren't constructs or undead. If I reduce a creature to 0 hit points with this axe, I gain 10 temporary hit points.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic axe. The axe deals an extra 1d6 necrotic damage to creatures that aren't constructs or undead. If you reduce such a creature to 0 hit points with an attack using this axe, you gain 10 temporary hit points.\n   This axe is forged from a dark, rust-colored metal and once belonged to the goliath barbarian Grog Strongjaw of Vox Machina.",
	weaponOptions : [{
		baseWeapon : "greataxe",
		regExpSearch : /bloodaxe/i,
		name : "Bloodaxe",
		source : [["W", 266]],
		description : "Heavy, two-handed; +1d6 necrotic damage to living targets",
		modifiers : [2, 2],
		selectNow : true
	}],
	weight : 7
};
MagicItemsList["breathing bubble"] = {
	name : "Breathing Bubble",
	source : [["W", 266], ["CotN", 212]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "This translucent, bubble-like sphere has a slightly tacky outer surface. I gain its benefits only while wearing it over my head like a helmet. The bubble contains 1 hour of breathable air. The bubble regains all its expended air daily at dawn.",
	descriptionFull : "This translucent, bubble-like sphere has a slightly tacky outer surface, and you gain the item's benefits only while wearing it over your head like a helmet. The bubble contains 1 hour of breathable air. The bubble regains all its expended air daily at dawn.",
	usages : 1,
	recovery : "dawn"
};
MagicItemsList["brooch of living essence"] = {
	name : "Brooch of Living Essence",
	source : [["W", 266]],
	type : "wondrous item",
	rarity : "uncommon",
	notLegalAL : true,
	attunement : true,
	description : "While wearing this nondescript brooch, spells and anything else that would detect or reveal my creature type treat me as humanoid, and those that would reveal my alignment treat it as neutral.",
	descriptionFull : "While wearing this nondescript brooch, spells and anything else that would detect or reveal your creature type treat you as humanoid, and those that would reveal your alignment treat it as neutral."
};
MagicItemsList["butcher's bib"] = {
	name : "Butcher's Bib",
	source : [["W", 266]],
	type : "wondrous item",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "This black leather apron is perpetually covered by blood. Once per turn when I roll damage for a melee attack with a weapon, I can use it to reroll the weapon's damage dice, but must use the new roll. While wearing the bib, my weapon attacks that deal slashing damage score a critical hit on a roll of 19 or 20.",
	descriptionFull : "This black leather apron is perpetually covered by blood, even after being washed off. You gain the following benefits while wearing the apron:"+
	"\n \u2022 Once per turn when you roll damage for a melee attack with a weapon, you can reroll the weapon's damage dice. If you do so, you must use the second total."+
	"\n \u2022 Your weapon attacks that deal slashing damage score a critical hit on a roll of 19 or 20 on the d20.",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.isSpell && !v.CritChance && /slash/i.test(v.theWea.damage[2])) {
					fields.Description += (fields.Description ? '; ' : '') + 'Crit on 19-20';
					v.CritChance = 19;
				}
				if (!v.isSpell && v.isMeleeWeapon) {
					fields.Description += (fields.Description ? '; ' : '') + 'Reroll damage once per turn';
				}
			},
			"My weapon attacks that deal slashing damage score a critical on a to hit roll of both 19 and 20. Once per turn, I can reroll the damage of a melee weapon attack and must use the second result.",
			19
		]
	}
};
MagicItemsList["coin of delving"] = {
	name : "Coin of Delving",
	source : [["W", 266]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "This scintillating copper coin sheds dim light in a 5-ft radius. If dropped a distance greater than 5 ft, the coin issues a melodious ringing sound when it hits a surface. Any creature that can hear the chime can determine the distance the coin dropped based on the tone.",
	descriptionFull : "This scintillating copper coin sheds dim light in a 5-foot radius. If dropped a distance greater than 5 feet, the coin issues a melodious ringing sound when it hits a surface. Any creature that can hear the chime can determine the distance the coin dropped based on the tone."
};
MagicItemsList["corpse slayer"] = {
	name : "Corpse Slayer",
	nameTest : "Corpse Slaying",
	source : [["W", 266]],
	type : "weapon (any)",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "I gain a +1 bonus to attack and damage rolls made with this magic weapon. Undead hit by it take an additional 1d8 damage and gain disadvantage on saving throws against effects that turn undead until the start of my next turn.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic weapon.\n   When you hit an undead creature with an attack using this weapon, the attack deals an extra 1d8 damage of the weapon's type, and the creature has disadvantage on saving throws against effects that turn undead until the start of your next turn.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "brackets",
		itemName1stPage : ["suffix", "Corpse Slaying"],
		descriptionChange : ["replace", "weapon"]
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.isSpell && !v.theWea.isMagicWeapon && (/corpse slay(er|ing)/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + '+1d8 damage vs. undead; Target disadv. vs. turn undead';
				}
			},
			'If I include the words "Corpse Slayer" or "Corpse Slaying" in a the name of a weapon, it will be treated as the magic weapon Corpse Slayer, which has a +1 to hit and damage and deals +1d8 damage vs. undead.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (!v.isSpell && (/corpse slay(er|ing)/i).test(v.WeaponTextName)) {
					output.magic = v.thisWeapon[1] + 1;
				}
			}, ''
		]
	}
};
MagicItemsList["dispelling stone"] = {
	name : "Dispelling Stone",
	source : [["W", 266]],
	type : "wondrous item",
	rarity : "very rare",
	notLegalAL : true,
	description : "This smooth, rainbow-colored, egg-shaped stone can be thrown up to 30 ft and explodes in a 10-ft-radius sphere of magical energy on impact, destroying the stone. Any active spell of 5th level or lower in the sphere ends.",
	descriptionFull : "This smooth, rainbow-colored, egg-shaped stone can be thrown up to 30 feet and explodes in a 10-foot-radius sphere of magical energy on impact, destroying the stone. Any active spell of 5th level or lower in the sphere ends.",
	usages : 1,
	recovery : "Never"
};
MagicItemsList["duskcrusher"] = {
	name : "Duskcrusher",
	source : [["W", 266]],
	type : "weapon (warhammer)",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	description : "This rod caries the symbol of Pelor. As a bonus action, I can activate its crackling head of sunlight, that shines bright light in 15 ft and dim for another 15 ft. While active, I can use it as a +2 warhammer that deals radiant damage and +1d8 damage to undead. Once per dawn, I can cast Sunbeam with it (DC 15).",
	descriptionLong : "This leather-wrapped metal rod caries the symbol of Pelor on top. As a bonus action, I can cause a warhammer head of crackling radiance to spring into existence. It emits emits bright light in a 15-foot radius and dim light for an additional 15 feet. The light is sunlight. While the radiant head is active, the rod functions as a +2 warhammer that deals radiant damage and +1d8 damage to undead. Once per dawn while its radiant head is active, I can use it to cast Sunbeam (DC 15). I can deactivate the head as an action.",
	descriptionFull : "This item takes the form of a leather-wrapped metal rod emblazoned with the symbol of Pelor, the Dawn Father. While grasping the rod, you can use a bonus action to cause a warhammer head of crackling radiance to spring into existence. The warhammer's radiant head emits bright light in a 15-foot radius and dim light for an additional 15 feet. The light is sunlight. You can use an action to make the radiant head disappear."+
	"\n   While the radiant head is active, you gain a +2 bonus to attack and damage rolls made with this magic weapon, and attacks with the weapon deal radiant damage instead of bludgeoning damage. An undead creature hit by the weapon takes an extra 1d8 radiant damage."+
	"\n   While you are holding Duskcrusher and its radiant head is active, you can use an action to cast the sunbeam spell (save DC 15) from the weapon, and this action can't be used again until the next dawn.",
	action : [ ["bonus action", " (activate)"], ["action", " (deactivate)"] ],
	extraLimitedFeatures : [{
		name : "Duskcrusher (Sunbeam)",
		usages : 1,
		recovery : "dawn"
	}],
	weaponOptions : [{
		baseWeapon : "warhammer",
		regExpSearch : /duskcrusher/i,
		name : "Duskcrusher",
		source : [["W", 266]],
		damage : [1, 8, "radiant"],
		description : "Versatile (1d10); +1d8 damage vs. undead",
		modifiers : [2, 2],
		selectNow : true
	}],
	weight : 2,
	fixedDC : 15,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["sunbeam"],
		selection : ["sunbeam"],
		firstCol : 'oncelr'
	}
};
MagicItemsList["dust of deliciousness"] = {
	name : "Dust of Deliciousness",
	source : [["W", 267]],
	type : "wondrous item",
	rarity : "uncommon",
	notLegalAL : true,
	description : "This reddish brown dust can be sprinkled over any edible substance to greatly improve the flavor. The dust also dulls the eater's senses: anyone eating food treated with this dust has disadvantage on Wisdom ability checks and Wisdom saving throws for 1 hour. There is enough dust to flavor six servings.",
	descriptionFull : "This reddish brown dust can be sprinkled over any edible substance to greatly improve the flavor. The dust also dulls the eater's senses: anyone eating food treated with this dust has disadvantage on Wisdom ability checks and Wisdom saving throws for 1 hour. There is enough dust to flavor six servings.",
	usages : 6,
	recovery : "Never"
};
MagicItemsList["goggles of object reading"] = {
	name : "Goggles of Object Reading",
	source : [["W", 267]],
	type : "wondrous item",
	rarity : "uncommon",
	notLegalAL : true,
	attunement : true,
	description : "While wearing these leather-framed goggles feature purple crystal lenses, I have advantage on Intelligence (Arcana) checks made to reveal information about a creature or object I can see. Once per dawn, I can cast Identify using the goggles.",
	descriptionFull : "These leather-framed goggles feature purple crystal lenses. While wearing the goggles, you have advantage on Intelligence (Arcana) checks made to reveal information about a creature or object you can see. In addition, you can cast the identify spell using the goggles. Once you do so, you can't do so again until the next dawn.", // Changed googles to goggles, as this is clearly a typo in the book
	additional : "Identify",
	usages : 1,
	recovery : "dawn",
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["identify"],
		selection : ["identify"],
		firstCol : 'oncelr'
	}
};
MagicItemsList["hunter's coat"] = {
	name : "Hunter's Coat",
	source : [["W", 267]],
	type : "armor (leather)",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	description : "I have a +1 bonus to AC while wearing this leather armor. The coat has 3 charges. When I hit a creature with an attack and that creature doesn't have all its hit points, I can expend 1 charge to deal an extra 1d10 necrotic damage to the target. The coat regains 1d3 expended charges at dawn.",
	descriptionFull : "You have a +1 bonus to AC while wearing this armor. The coat has 3 charges. When you hit a creature with an attack and that creature doesn't have all its hit points, you can expend 1 charge to deal an extra 1d10 necrotic damage to the target. The coat regains 1d3 expended charges daily at dawn.",
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	armorOptions : [{
		regExpSearch : /^(?=.*hunter)(?=.*coat).*$/i,
		name : "Hunter's Coat",
		source : [["W", 267]],
		type : "light",
		ac : "11+1",
		weight : 10,
		selectNow : true
	}],
	weight : 10
};
MagicItemsList["last stand armor"] = {
	name : "Last Stand Armor",
	source : [["W", 267]],
	type : "armor (any)",
	rarity : "very rare",
	notLegalAL : true,
	description : "I have a +1 bonus to AC while wearing this magic armor. If I die while wearing this armor, it is destroyed, and each celestial, fey, and fiend with 30 ft of me must succeed on a DC 15 Charisma saving throw or be banished to their home plane of existence, unless they are already there.",
	descriptionFull : "You have a +1 bonus to AC while wearing this armor, which shimmers softly. If you die while wearing the armor, it is destroyed, and each celestial, fey, and fiend with 30 feet of you must succeed on a DC 15 Charisma saving throw or be banished to its home plane of existence, unless it is already there.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["suffix", "+1 Last Stand"]
	},
	extraLimitedFeatures : [{
		name : "Last Stand Armor",
		usages : 1,
		recovery : "Never"
	}]
};

var EGtW_LuxonBeaconFullDescription = [
	"This dodecahedron of faintly glowing crystal is heavier than it appears. A set of handles are affixed to its sides, and it pulsates and thrums when touched.",
	">>Fragment of Possibility<<. A creature that touches the beacon and concentrates for 1 minute receives a Fragment of Possibility, which looks like a Tiny, grayish bead of energy that follows the creature around, staying within 1 foot of it at all times. The fragment lasts for 8 hours or until used. Once the beacon grants a Fragment of Possibility, it can't grant another until the next dawn. A creature with a Fragment of Possibility from a Luxon Beacon can't gain another Fragment of Possibility from any source.",
	"When a creature with a Fragment of Possibility makes an attack roll, an ability check, or a saving throw, it can expend its fragment to roll an additional d20 and choose which of the d20s to use. Alternatively, when an attack roll is made against the creature, it can expend its fragment to roll a d20 and choose which of the d20s to use, the one it rolled or the one the attacker rolled.",
	"If the original d20 roll has advantage or disadvantage, the creature rolls its d20 after advantage or disadvantage has been applied to the original roll.",
	">>Soul Snare<<. If a follower of the Luxon who has undergone a ritual of consecution dies within 100 miles of a Luxon Beacon, their soul is ensnared by it. This soul will be reincarnated within the body of a random humanoid baby developing within 100 miles of the beacon."
];
MagicItemsList["luxon beacon"] = {
	name : "Luxon Beacon",
	source : [["W", 268]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	description : "Once per dawn, a creature can touch this crystal for 1 minute to gain a Fragment of Possibility. Once for the next 8 hours, it can roll an extra d20 for an attack, check, save, or being attacked, before the outcome is determined. Creatures consecuted to the Luxon that die within 100 miles of it are reincarnated. See notes.",
	descriptionFull : EGtW_LuxonBeaconFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	extraLimitedFeatures : [{
		name : "Luxon Beacon (Fragment of Possibility)",
		usages : 1,
		recovery : "dawn"
	}],
	toNotesPage : [{
		name : "Features",
		note : desc(EGtW_LuxonBeaconFullDescription).replace(/   >>(.*?)<<\. /g, function(a, match) { return match.toUpperCase() + "\n   "; })
	}]
};
MagicItemsList["needle of mending"] = {
	name : "Needle of Mending",
	source : [["W", 268]],
	type : "weapon (dagger)",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "This weapon is a magic dagger disguised as a sewing needle. As a bonus action, I can speak its command word to transform it into a dagger or back into a needle. I gain a +1 bonus to attack and damage rolls made with the dagger. As an action while holding it, I can cast the mending cantrip from it.",
	descriptionFull : "This weapon is a magic dagger disguised as a sewing needle. When you hold it and use a bonus action to speak its command word, it transforms into a dagger or back into a needle.\n   You gain a +1 bonus to attack and damage rolls made with the dagger. While holding it, you can use an action to cast the mending cantrip from it.",
	action : [["bonus action", " (transform)"]],
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*needle)(?=.*mending).*$/i,
		name : "Needle of Mending",
		source : [["W", 268]],
		modifiers : [1, 1],
		selectNow : true
	}],
	spellcastingBonus : {
		name : "At will",
		spells : ["mending"],
		selection : ["mending"],
		firstCol : 'atwill'
	},
	spellChanges : {
		"mending" : {
			time : "1 a",
			changes : "Using the Needle of Mending, I can cast Mending as an action."
		}
	},
	weight : 1
};
MagicItemsList["nightfall pearl"] = {
	name : "Nightfall Pearl",
	source : [["W", 268]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "I can spend 10 minutes to activate this his 6-inch-diameter, jet-black orb, causing the area within 10 miles of it to become night even if it is daytime. This night lasts for 24 hours, until I cancel it as an action, or until my attunement to the pearl ends. Once used, the pearl can't be used again for 24 hours.",
	descriptionFull : "Used to summon night, this 6-inch-diameter, jet-black orb is cold to the touch. You can spend 10 minutes to activate it, causing the area within 10 miles of it at the moment of activation to become night even if it is daytime. This night lasts for 24 hours, until you cancel it as an action, or until your attunement to the pearl ends. Once used, the pearl can't be used again for 24 hours.",
	action : [["action", " (end)"]],
	usages : 1,
	recovery : "24 hrs"
};
MagicItemsList["orb of the veil"] = { // no automation for halving the fire damage, because it is very complex, error prone, and the curse could (and will) be removed
	name : "Orb of the Veil",
	source : [["W", 268]],
	type : "wondrous item",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	description : "This orb increases my Wisdom and maximum by 2, grants me +60 ft darkvision, and adv. on Wisdom checks to find hidden doors and paths. It is cursed and once attuned to it, I become unwilling to part with it, nonmagical flames within 30 ft of me extinguish, and fire damage I deal is halved (not automated).",
	descriptionFull : "This onyx sphere bears deep, spiraling grooves and dangles from an iron chain. While the orb is on your person, you gain the following benefits:\n Your Wisdom score increases by 2, as does your maximum for that score.\n You gain darkvision out to a range of 60 feet. If you already have darkvision, the orb increases its range by 60 feet.\n You have advantage on Wisdom checks to find hidden doors and paths.\n   " + toUni("Curse") + ". The orb is cursed, and becoming attuned to it extends the curse to you. As long as you remain cursed, you are unwilling to part with the orb, keeping it on your person at all times. All nonmagical flames within 30 feet of you automatically extinguish, and fire damage dealt by you is halved.",
	vision : [["Darkvision", "fixed 60"], ["Darkvision", "+60"]],
	scores : [0, 0, 0, 0, 2, 0],
	scoresMaximum : [0, 0, 0, 0, "+2", 0],
	weight : 3
};
MagicItemsList["potion of maximum power"] = {
	name : "Potion of Maximum Power",
	source : [["W", 268]],
	type : "potion",
	rarity : "rare",
	notLegalAL : true,
	description : "Once as an action, I can drink this potion of glowing purple liquid that smells of sugar and plum or administer it to another. The next time the recipient casts a damage-dealing spell of 4th-level or lower within 1 minute, instead of rolling the damage die, the highest number possible for each die is used.",
	descriptionFull : "The first time you cast a damage-dealing spell of 4th level or lower within 1 minute after drinking the potion, instead of rolling dice to determine the damage dealt, you can instead use the highest number possible for each die.\n This glowing purple liquid smells of sugar and plum, but it has a muddy taste.",
	weight : 0.5
};
MagicItemsList["potion of possibility"] = {
	name : "Potion of Possibility",
	source : [["W", 268]],
	type : "potion",
	rarity : "very rare",
	notLegalAL : true,
	description : "Once as an action, I can drink this potion of glowing purple liquid that smells of sugar and plum or administer it to another. Twice for the next 8 hours, the consumer can roll an extra d20 for an attack, check, save, or being attacked, before the outcome is determined.",
	descriptionFull : "When you drink this clear potion, you gain two Fragments of Possibility, each of which looks like a Tiny, grayish bead of energy that follows you around, staying within 1 foot of you at all times. Each fragment lasts for 8 hours or until used."+
	"\n   When you make an attack roll, an ability check, or a saving throw, you can expend your fragment to roll an additional d20 and choose which of the d20s to use. Alternatively, when an attack roll is made against you, you can expend your fragment to roll a d20 and choose which of the d20s to use, the one you rolled or the one the attacker rolled."+
	"\n   If the original d20 roll has advantage or disadvantage, you roll your d20 after advantage or disadvantage has been applied to the original roll."+
	"\n   While you have one or more Fragments of Possibility from this potion, you can't gain another Fragment of Possibility from any source.",
	weight : 0.5
};
MagicItemsList["reincarnation dust"] = {
	name : "Reincarnation Dust",
	source : [["W", 268]],
	type : "wondrous item",
	rarity : "very rare",
	notLegalAL : true,
	usages : 1,
	recovery : "Never",
	description : "Once I can sprinkle the purple dust in this small pouch on a dead humanoid or a piece of a dead humanoid. The dust is absorbed by the remains. If willing, the dead creature returns to life with a new body as if the reincarnate spell had been cast on the remains.",
	descriptionFull : "When this small pouch of purple dust is sprinkled on a dead humanoid or a piece of a dead humanoid, the dust is absorbed by the remains. If willing, the dead creature returns to life with a new body as if the reincarnate spell had been cast on the remains.",
	spellcastingBonus : {
		name : "Use once",
		spells : ["reincarnate"],
		selection : ["reincarnate"]
	}
};
MagicItemsList["ring of obscuring"] = {
	name : "Ring of Obscuring",
	source : [["W", 269]],
	type : "ring",
	rarity : "uncommon",
	notLegalAL : true,
	attunement : true,
	description : "This band of iron resembling a skull has 3 charges, regaining 1d3 expended charges at dawn. As an action, I can expend 1 charge to cast Fog Cloud from it, with the following changes: the cloud is centered on me when it first appears, the spell lasts for 1 minute, and the spell requires no concentration.",
	descriptionFull : "This band of iron resembles a skull and is cold to the touch. It has 3 charges and regains 1d3 expended charges daily at dawn. As an action while wearing the ring, you can expend 1 of its charges to cast the fog cloud spell from it, with the following changes: the cloud is centered on you when it first appears, and the spell lasts for 1 minute (no concentration required).",
	extraLimitedFeatures : [{
		name : "Ring of Obscuring",
		usages : 3,
		recovery : "Dawn"
	}],
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["fog cloud"],
		selection : ["fog cloud"],
		firstCol : '1'
	},
	spellChanges : {
		"fog cloud" : {
			range : "Self",
			duration : "1 min",
			changes : "When I cast fog cloud with the Ring of Obscuring, the spell is centered on me, lasts for 1 minute, and the requires no concentration."
		}
	}
};
MagicItemsList["ring of temporal salvation"] = {
	name : "Ring of Temporal Salvation",
	source : [["W", 269]],
	type : "ring",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "If I die while wearing this gray crystal ring, I vanish and reappear in an empty space within 5 ft, with 3d6 + my Con mod in HP, and 1 less level of exhaustion (if any). If my maximum HP is less than the amount rolled, my max rises to a similar amount. Once this ring is used, it turns to dust and is destroyed.",
	descriptionFull : "If you die while wearing this gray crystal ring, you vanish and reappear in an unoccupied space within 5 feet of the space you left (or the nearest unoccupied space). You have a number of hit points equal to 3d6 + your Constitution modifier. If your hit point maximum is lower than the number of hit points you regain, your hit point maximum rises to a similar amount. If you have any levels of exhaustion, reduce your level of exhaustion by 1. Once the ring is used, it turns to dust and is destroyed."
};
MagicItemsList["rod of retribution"] = {
	name : "Rod of Retribution",
	source : [["W", 269]],
	type : "rod",
	rarity : "uncommon",
	notLegalAL : true,
	attunement : true,
	description : "This adamantine rod with a glowing crystalline tip has 3 charges, regaining all daily at dawn. As a reaction when a creature I can see within 60 ft damages me, I can expend a charge to force it to make a DC 13 Dexterity save. It takes a 2d10 lightning damage on a failed save, or half as much on a successful one.",
	descriptionFull : "This adamantine rod is tipped with a glowing crystalline eye. The rod has 3 charges and regains all its expended charges daily at dawn.\n   When a creature you can see within 60 feet of you damages you while you are holding this rod, you can use your reaction to expend 1 of the rod's charges to force the creature to make a DC 13 Dexterity saving throw. The creature takes 2d10 lightning damage on a failed save, or half as much damage on a successful one.",
	usages : 3,
	recovery : "dawn",
	action : [["reaction", " (if damaged)"]],
	weight : 2
};
MagicItemsList["spell bottle"] = {
	name : "Spell Bottle",
	source : [["W", 269]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "While holding this bottle, I can cast a 5th-level or lower spell into it if empty, or cast the stored spell from it (slot level, DC, and spell attack as original casting). As a reaction when I see a spell being cast in 60 ft, I can try to store it in the empty bottle. Works if 3rd-level or lower, otherwise Int check DC 10 + spell level.",
	descriptionFull : "This glass bottle can store one spell of up to 5th level at a time. When found, roll a d6 and subtract 1; the total determines the level of spell in the bottle (the DM chooses the spell, and 0 means the bottle is empty). A swirling blue vapor fills the bottle while it contains a spell."+
	"\n   When the bottle is empty, any creature can cast a spell of 1st through 5th level into it by touching it while casting. The spell has no effect other than to be stored in the bottle."+
	"\n   While holding the bottle, you can cast the spell stored in it. The spell uses the slot level, spell save DC, spell attack bonus, and spellcasting ability of the original caster, but is otherwise treated as if you cast the spell. The bottle becomes empty once the spell is cast."+
	"\n   If you're holding the empty bottle when you see a creature casting a spell within 60 feet of you, you can open the bottle as a reaction in an attempt to interrupt the spell. If the creature is casting a spell of 3rd level or lower, the spell has no effect, and it is stored in the bottle. If it is casting a spell of 4th level or higher, make an Intelligence check. The DC equals 10 + the spell's level. On a success, the spell has no effect, and it is stored in the bottle."
};
MagicItemsList["staff of dunamancy"] = {
	name : "Staff of Dunamancy",
	source : [["W", 270]],
	type : "staff",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function (v) { return classes.known.wizard ? true : false; },
	description : "This staff has 10 charges, regains 1d6+4 at dawn. If I use its last charge, roll a d20. On a 1, it is destroyed. As an action, I can use its charges to cast Fortune's Favor (2), Pulse Wave (3), or Gravity Sinkhole (4), using my spellcasting ability. Once per dawn, I can turn a failed save vs. a spell that targets only me into a success.",
	descriptionFull : "This staff of polished gray wood bears numerous runes carved along its length. The staff has 10 charges and regains 1d6 + 4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff turns into dust and is destroyed."+
	"\n   While holding the staff, you can use an action to expend 2 or more of its charges to cast one of the following spells from it, using your spell save DC and spell attack bonus: fortune's favor (2 charges), pulse wave (3 charges), or gravity sinkhole (4 charges)."+
	"\n   " + toUni("New Possibility") + ". If you are holding the staff and fail a saving throw against a spell that targets only you, you can turn your failed save into a successful one. This property can't be used again until the next dawn.",
	extraLimitedFeatures : [{
		name : "Staff of Dunamancy (regains 1d6+4)",
		usages : 10,
		recovery : "dawn"
	}, {
		name : "Staff of Dunamancy (New Possibility)",
		usages : 1,
		recovery : "dawn"
	}],
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["fortune's favor"],
		selection : ["fortune's favor"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["pulse wave"],
		selection : ["pulse wave"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["gravity sinkhole"],
		selection : ["gravity sinkhole"],
		firstCol : 4
	}],
	spellChanges : {
		"fortune's favor" : {
			time : "1 a",
			changes : "Using the Staff of Dunamancy, I can cast Fortune's Favor as an action."
		}
	},
	weight : 4
};
MagicItemsList["staff of the ivory claw"] = {
	name : "Staff of the Ivory Claw",
	source : [["W", 270]],
	type : "staff",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "This gray-and-cerulean staff is topped with a small dragon claw carved from ivory. While holding the staff, I gain a +1 bonus to spell attack rolls. Whenever you score a critical hit with a spell attack, the target takes an extra 3d6 radiant damage.",
	descriptionFull : "This gray-and-cerulean staff is topped with a small dragon claw carved from ivory. While holding the staff, you gain a +1 bonus to spell attack rolls. Whenever you score a critical hit with a spell attack, the target takes an extra 3d6 radiant damage.",
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type == "attack") return 1;
			},
			"While holding the Staff of the Ivory Claw, I have a +1 bonus to spell attack rolls."
		],
		atkAdd : [
			function (fields, v) {
				if (v.isSpell && !v.theWea.dc) {
					fields.Description += (fields.Description ? '; ' : '') + 'On crit, +3d6 radiant damage';
				}
			},
			"While holding the Staff of the Ivory Claw whenever I score a critical hit with a spell attack, the target takes an extra 3d6 radiant damage."
		]
	},
	weight : 4
};
MagicItemsList["vox seeker"] = {
	name : "Vox Seeker",
	source : [["W", 270]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "This clockwork device resembles a metal crab the size of a dinner plate. Every action used to wind up this clockwork device allows it to operate for 1 minute, to a maximum of 10 minutes. See the vox seeker on a companion page. This creature is under the DM's control. If reduced to 0 HP, it is destroyed.",
	descriptionFull : "This clockwork device resembles a metal crab the size of a dinner plate. Every action used to wind up the device allows it to operate for 1 minute, to a maximum of 10 minutes. While operational, the item uses the accompanying Vox Seeker stat block. This automaton is under the DM's control. A vox seeker reduced to 0 hit points is destroyed.",
	action : [["action", " (wind up)"]],
	creaturesAdd : [["Vox Seeker"]],
	creatureOptions : [{
		name : "Vox Seeker",
		source : [["W", 270]],
		size : 5,
		type : "Construct",
		alignment : "",
		ac : 14,
		hp : 7,
		hd : [2, 4],
		speed : "20 ft, climb 20 ft",
		scores : [2, 10, 12, 1, 10, 1],
		damage_immunities : "poison, psychic",
		condition_immunities : "blinded, charmed, deafened, exhaustion, frightened, paralyzed, petrified, poisoned",
		senses : "Blindsight 60 ft (blind beyond this radius",
		passivePerception : 10,
		languages : "",
		challengeRating : "0",
		proficiencyBonus : 2,
		attacksAction : 1,
		attacks : [{
			name : "Pincer",
			ability : 2,
			damage : [1, 4, "piercing"],
			range : "Melee (5 ft)",
			description : "+3 lightning damage",
			abilitytodamage : false
		}],
		features : [{
			name : "Creator",
			description : "The homunculus obeys the commands of its creator and has the same proficiency bonus. It takes its turn immediately after its creator, on the same initiative count. It can move and take reactions on its own, but only takes the Dodge action on its turn unless its creator takes a bonus action to command it to take another action. If its creator is incapacitated, it can take any action, not just Dodge."
		}],
		traits : [{
			name : "Spider Climb",
			description : "The vox seeker can climb difficult surfaces, including upside down on ceilings, without needing to make an ability check."
		}, {
			name : "Voice Lock",
			description : "The vox seeker must move toward and attack the source of the nearest voice within 60 ft of it, to the exclusion of all other targets, for as long as it remains operational."
		}]
	}]
};
MagicItemsList["weapon of certain death"] = {
	name : "Weapon of Certain Death",
	nameTest : "of Certain Death",
	source : [["W", 270]],
	type : "weapon (any)",
	rarity : "rare",
	notLegalAL : true,
	description : "When I damage a creature with an attack using this magic weapon, the target can't regain hit points until the start of my next turn.",
	descriptionFull : "When you damage a creature with an attack using this magic weapon, the target can't regain hit points until the start of your next turn.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "weapon"]
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && (/of certain death/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + "On hit, target can't heal until my next turn starts";
				}
			},
			'If I include the words "of Certain Death" in a the name of a weapon, it will be treated as the magic weapon "Weapon of Certain Death". On a hit, the target can\'t regain hit points until the start of my next turn.'
		]
	}
};

// Vestiges of Divergence (contains contributions by kat9137 [Discord] aka sophiechiabatta [GitHub])
var EGtW_Vestiges_Replace = function (sDescr) {
	return desc(sDescr).replace(/\bf(oo|ee)t\b/ig, "ft")
		.replace(/you are/ig, "I am").replace(/\byou\b/ig, "I")
		.replace(/(by|giving|grants|of|to|for) I\b/ig, "$1 me")
		.replace(/your/g, "my").replace(/Your/g, "My")
		.replace(/   >>(.*?)<<\. /g, function(a, match) { return "\n" + match.toUpperCase() + "\n   "; });
}
var EGtW_DanothsVisorFullDescription = [
	"These mithral-frame goggles with clear diamond lenses were used by the evoker Danoth Oro to spot invisible enemies and scout areas from afar.",
	">>Dormant<<. While wearing the goggles in their dormant state, you can see normally in darkness, both magical and nonmagical, to a distance of 60 feet. Additionally, you have advantage on Intelligence (Investigation) and Wisdom (Perception) checks that rely on sight.",
	">>Awakened<<. When Danoth's Visor reaches an awakened state, it gains the following properties:",
	"\u2022 You see invisible creatures and objects within 60 feet of you as if they were visible, and you can see into the Ethereal Plane. Ethereal creatures and objects appear ghostly and translucent.",
	"\u2022 As a bonus action, you can speak a command word and use the goggles to see into and through solid matter. This vision has a radius of 60 feet and lasts for 1 minute. To you, solid objects within that radius appear transparent. The vision can penetrate 1 foot of stone, 1 inch of common metal, or up to 3 feet of wood or dirt. Thicker substances block the vision, as does a thin sheet of lead. This property can't be used again until the next dawn.",
	"\u2022 As a bonus action, you can speak a command word to switch the goggles into spyglass mode. While in this mode, creatures and objects viewed through the goggles are magnified to twice their size. Speaking the command word again reverts the goggles to their normal operation.",
	">>Exalted<<.",
	"When Danoth's Visor reaches an exalted state, it gains the following properties:",
	"\u2022 You automatically detect illusions you can see and automatically succeed on saving throws against them. In addition, you see a bright aura around any creature that isn't in its true form.",
	"\u2022 As an action, you can cast the antimagic field spell from the visor. This property can't be used again until the next dawn."
];
MagicItemsList["danoth's visor"] = {
	name : "Danoth's Visor",
	source : [["W", 270]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "These mithral-frame goggles with clear diamond lenses were used by the evoker Danoth Oro to spot invisible enemies and scout areas from afar. See notes page for more information.",
	descriptionFull : EGtW_DanothsVisorFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : EGtW_Vestiges_Replace(EGtW_DanothsVisorFullDescription)
	}],
	vision : [["Devil's Sight", "fixed 60"], ["Adv. on Investigation and Perception check that rely on sight", 0]],
	choices : ["Dormant", "Awakened", "Exalted"],
	choicesNotInMenu : true,
	"dormant" : {
		name : "Danoth's Visor [dormant]",
		description : "These mithral-frame goggles with clear diamond lenses grant me the ability to see in normally in nonmagical and magical darkness out to 60 ft. Also, they grant me advantage on Intelligence (Investigation) and Wisdom (Perception) checks that rely on sight."
	},
	"awakened" : {
		name : "Danoth's Visor [awakened]",
		description : "These mithral-frame goggles with clear diamond lenses grant me the ability to see, out to 60 ft, in nonmagical and magical darkness, invisible creatures and objects, and into the Ethereal plane. They give me adv. on Investigation and Perception checks that rely on sight. I can active them to see more, see Notes page.",
		action : [
			["bonus action", "Danoth's Visor (see through matter)"]
			["bonus action", "Danoth's Visor (spyglass mode)"],
		],
		extraLimitedFeatures : [{
			name : "Danoth's Visor (see through matter)",
			usages : 1,
			recovery : "dawn"
		}]
	},
	"exalted" : {
		name : "Danoth's Visor [exalted]",
		description : "These goggles grant me the ability to see, out to 60 ft, in normal and magical darkness, invisible creatures and objects, and into the Ethereal plane. They allow me to automatically detect illusions for what they are, succeed on saves against them, and see if creatures aren't in their true form. See Notes for more.",
		action : [
			["bonus action", "Danoth's Visor (see through matter)"]
			["bonus action", "Danoth's Visor (spyglass mode)"],
		],
		extraLimitedFeatures : [{
			name : "Danoth's Visor (see through matter)",
			usages : 1,
			recovery : "dawn"
		}, {
			name : "Danoth's Visor (Antimagic Field)",
			usages : 1,
			recovery : "dawn"
		}],
		spellcastingAbility : "class",
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["antimagic field"],
			selection : ["antimagic field"],
			firstCol : 'oncelr'
		},
		savetxt : { immune : ["illusions"] },
	}
};
var EGtW_GrimoireInfinitusFullDescription = [
	"Several of these spellbooks with gilded pages and silver-plated covers were created during the Age of Arcanum, but only one has been found since the Calamity ended. The book has an infinite number of pages, is three inches thick, eight inches wide, twelve inches long, and weighs three pounds.",
	">>Dormant<<. Most of the book is blank, but the following spells are recorded in the first pages of the tome: alarm, antimagic field, Bigby's hand, blight, charm person, confusion, control weather, create undead, detect thoughts, enlarge/reduce, fear, foresight, gaseous form, glyph of warding, legend lore, Leomund's tiny hut, mass suggestion, mislead, misty step, Mordenkainen's faithful hound, prismatic spray, ray of enfeeblement, silent image, teleport, and thunderwave.",
	"You can use the grimoire as your spellbook, and you can scribe new spells into it as normal. When you prepare wizard spells using the grimoire, the number of wizard spells you can prepare increases by 1.",
	">>Awakened<<. When the Grimoire Infinitus reaches an awakened state, it gains the following properties:",
	"\u2022 While you carry the spellbook, you have advantage on saving throws against spells and magical effects.",
	"\u2022 When you prepare wizard spells using the grimoire as your spellbook, the number of spells you can prepare increases by 1 again.",
	">>Exalted<<. When the Grimoire Infinitus reaches an exalted state, it gains the following properties:",
	"\u2022 You can now use your Arcane Recovery feature twice between long rests, rather than once.",
	"\u2022 When you prepare wizard spells using the grimoire as your spellbook, the number of spells you can prepare increases by 1 again."
];
MagicItemsList["grimoire infinitus"] = {
	name : "Grimoire Infinitus",
	source : [["W", 271]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "This spellbook with unlimited gilded pages and silver-plated covers can be used by a wizard to prepare and store spells. It holds several spells already. When I use to prepare wizards spells, I can prepare 1 additional spell.",
	descriptionFull : EGtW_GrimoireInfinitusFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	weight : 3,
	toNotesPage : [{
		name : "Features",
		note : EGtW_Vestiges_Replace(EGtW_GrimoireInfinitusFullDescription)
	}],
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function (v) { return classes.known.wizard ? true : false; },
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		addToKnown : ["alarm", "antimagic field", "bigby's hand", "blight", "charm person", "confusion", "control weather", "create undead", "detect thoughts", "enlarge/reduce", "fear", "foresight", "gaseous form", "glyph of warding", "legend lore", "leomund's tiny hut", "mass suggestion", "mislead", "misty step", "mordenkainen's faithful hound", "prismatic spray", "ray of enfeeblement", "silent image", "teleport", "thunderwave"]
	},
	choices : ["Dormant", "Awakened", "Exalted"],
	choicesNotInMenu : true,
	"dormant" : {
		name : "Grimoire Infinitus [dormant]",
		description : "This spellbook with unlimited gilded pages and silver-plated covers can be used by a wizard to prepare and store spells. It holds several spells already. When I use to prepare wizard spells, I can prepare 1 additional spell. See Notes page for more information.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type === "prepare" && spellcasters.indexOf("wizard") !== -1) return 1;
				},
				"When I prepare wizard spells using the grimoire, the number of wizard spells I can prepare increases by 1."
			]
		}
	},
	"awakened" : {
		name : "Grimoire Infinitus [awakened]",
		description : "This spellbook with unlimited gilded pages and silver-plated covers can be used by a wizard to prepare and store spells. It holds several spells already. When I use it to prepare wizard spells, I can prepare 2 extra spells. It also grants me advantage on saves against spells and magical effects. See Notes page.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type === "prepare" && spellcasters.indexOf("wizard") !== -1) return 2;
				},
				"When I prepare wizard spells using the grimoire, the number of wizard spells I can prepare increases by 2."
			]
		},
		savetxt : { adv_vs : ["magic"] }
	},
	"exalted" : {
		name : "Grimoire Infinitus [exalted]",
		description : "This spellbook with unlimited pages can be used by a wizard to prepare and store spells. When I use it to prepare wizard spells, I can prepare 3 more. It also grants me adv. on saves vs. spells and magical effects and allows me to use Arcane Recovery an extra time per long rest. See Notes page for more information.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type === "prepare" && spellcasters.indexOf("wizard") !== -1) return 3;
				},
				"When I prepare wizard spells using the grimoire, the number of wizard spells I can prepare increases by 3."
			]
		},
		savetxt : { adv_vs : ["magic"] },
		extraLimitedFeatures : [{
			name : "Arcane Recovery",
			usages : 1,
			recovery : "long rest",
			addToExisting : true
		}]
	}
};
var EGtW_HideFeralGuardianFullDescription = [
	"It is believed that this polished and beautifully detailed leather armor was a gift from Melora, bestowed on a long-forgotten archdruid and champion of the natural world before the terrors of the Calamity.",
	">>Dormant<<. While wearing the armor in its dormant state, you gain the following benefits:",
	"\u2022 The armor grants you a +1 bonus to AC.",
	"\u2022 While you are transformed by an effect that replaces any of your game statistics with those of another creature, you have a +1 bonus to melee attack and damage rolls, and you retain the benefits of this armor.",
	"\u2022 As an action, you can use the armor to cast polymorph on yourself, transforming into a giant owl while retaining your Intelligence, Wisdom, and Charisma scores. This property can't be used again until the next dawn.",
	">>Awakened<<. When the armor reaches an awakened state, it gains the following properties:",
	"\u2022 The AC bonus of the armor increases to +2.",
	"\u2022 While you are transformed by an effect that replaces any of your game statistics with those of another creature, your bonus to melee attack and damage rolls increases by 1 (to +2).",
	"\u2022 When you cast the polymorph spell using this armor, you can transform into a cave bear.",
	">>Exalted<<. When the armor reaches an exalted state, it gains the following properties:",
	"\u2022 The AC bonus of the armor increases to +3.",
	"\u2022 While you are transformed by an effect that replaces any of your game statistics with those of another creature, your bonus to melee attack and damage rolls increases by 1 (to +3).",
	"\u2022 When you cast the polymorph spell using this armor, you can transform into a guardian wolf."
];
MagicItemsList["hide of the feral guardian"] = {
	name : "Hide of the Feral Guardian",
	source : [["W", 271]],
	type : "armor (studded leather)",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "This magic studded leather armor retains it benefits even when I'm transformed by an effect that replaces any of my game statistics with those of another creature and then also grants me a bonus to melee attack and damage rolls. Once per dawn, I can use it to cast Polymorph on myself.",
	descriptionFull : EGtW_HideFeralGuardianFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	weight : 13,
	toNotesPage : [{
		name : "Features",
		note : EGtW_Vestiges_Replace(EGtW_HideFeralGuardianFullDescription) + "\n\nNOTE\n   Be aware that the bonus to melee attacks and damage in wild shape are not automated."
	}],
	extraLimitedFeatures : [{
		name : "Hide of the Feral Guardian (Polymorph)",
		usages : 1,
		recovery : "dawn"
	}],
	spellcastingAbility : "class",
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["polymorph"],
		selection : ["polymorph"],
		firstCol : "oncelr"
	},
	choices : ["Dormant", "Awakened", "Exalted"],
	choicesNotInMenu : true,
	"dormant" : {
		name : "Hide of the Feral Guardian [dormant]",
		description : "This +1 studded leather armor retains it benefits even when I'm transformed by an effect that replaces any of my game statistics with those of another creature and then also grants me a +1 bonus to melee attack and damage rolls. Once per dawn, I can cast Polymorph on myself to transform into a giant owl.",
		armorOptions : [{
			regExpSearch : /^(?=.*hide)(?=.*feral guardian).*$/i,
			name : "Hide of the Feral Guardian",
			source : [["W", 271]],
			type : "light",
			ac : "12+1",
			weight : 13,
			selectNow : true
		}],
		spellChanges : {
			"polymorph" : {
				name : "Polymorph (special)",
				range : "Self",
				description : "I transform into a giant owl; I retain my Int, Wis, Cha",
				changes : "Using the Hide of the Feral Guardian, I can cast Polymorph on myself once per dawn to transform myself into a giant owl, while retaining my Intelligence, Wisdom, and Charisma scores as well as the benefits of the armor."
			}
		}
	},
	"awakened" : {
		name : "Hide of the Feral Guardian [awakened]",
		description : "This +2 studded leather armor retains it benefits even when I'm transformed by an effect that replaces any of my game statistics with those of another creature and then also grants me a +2 bonus to melee attack and damage rolls. Once per dawn, I can cast Polymorph on myself to become a giant owl or cave bear.",
		armorOptions : [{
			regExpSearch : /^(?=.*hide)(?=.*feral guardian).*$/i,
			name : "Hide of the Feral Guardian",
			source : [["W", 271]],
			type : "light",
			ac : "12+2",
			weight : 13,
			selectNow : true
		}],
		spellChanges : {
			"polymorph" : {
				name : "Polymorph (special)",
				range : "Self",
				description : "I transform into a giant owl or cave bear; I retain my Int, Wis, Cha",
				changes : "Using the Hide of the Feral Guardian, I can cast Polymorph on myself once per dawn to transform myself into a giant owl or a cave bear, while retaining my Intelligence, Wisdom, and Charisma scores as well as the benefits of the armor."
			}
		}
	},
	"exalted" : {
		name : "Hide of the Feral Guardian [exalted]",
		description : "This +3 studded leather armor retains it benefits even when I'm transformed by an effect that replaces any of my game statistics with those of another creature and then grants a +2 to melee attack and damage rolls. Once per dawn, I can cast Polymorph on myself to become a giant owl, cave bear or guardian wolf.",
		armorOptions : [{
			regExpSearch : /^(?=.*hide)(?=.*feral guardian).*$/i,
			name : "Hide of the Feral Guardian",
			source : [["W", 271]],
			type : "light",
			ac : "12+3",
			weight : 13,
			selectNow : true
		}],
		spellChanges : {
			"polymorph" : {
				name : "Polymorph (special)",
				range : "Self",
				description : "I transform into a giant owl, cave bear, or guardian wolf; I retain my Int, Wis, Cha",
				changes : "Using the Hide of the Feral Guardian, I can cast Polymorph on myself once per dawn to transform myself into a giant owl, cave bear, or guardian wolf, while retaining my Intelligence, Wisdom, and Charisma scores as well as the benefits of the armor."
			}
		},
		creatureOptions : [{
			name : "Guardian Wolf",
			source : [["W", 272]],
			size : 1,
			type : "Monstrosity",
			alignment : "",
			ac : 14,
			hp : 66,
			hd : [7, 12],
			speed : "60 ft",
			scores : [22, 14, 16, 5, 12, 8],
			skills : {
				"perception" : 3
			},
			senses : "Adv. on Wis (Perception) checks using hearing/smell",
			passivePerception : 15,
			languages : "Common, Elvish",
			challengeRating : "4",
			proficiencyBonus : 2,
			attacksAction : 2,
			attacks : [{
				name : "Bite",
				ability : 1,
				damage : [1, 10, "piercing"],
				range : "Melee (5 ft)",
				description : "Target DC 16 Str save or knocked prone; One bite and one claw attack as an Attack action"
			}, {
				name : "Claws",
				ability : 1,
				damage : [2, 8, "slashing"],
				range : "Melee (5 ft)",
				description : "One bite and one claw attack as an Attack action"
			}],
			actions : [{
				name : "Multiattack",
				description : "The wolf makes two attacks: one with its bite and one with its claws."
			}],
			traits : [{
				name : "Keen Hearing and Smell",
				description : "The wolf has advantage on Wisdom (Perception) checks that rely on hearing or smell."
			}, {
				name : "Pack Tactics",
				description : "The wolf has advantage on an attack roll against a creature if at least one of the wolf's allies is within 5 ft of the creature and the ally isn't incapacitated."
			}]
		}]
	}
};
var EGtW_InfiltratorsKeyFullDescription = [
	"This mithral skeleton key was forged using the blood of twelve master thieves executed for trying to steal magic items during the Age of Arcanum.",
	">>Dormant<<. The Infiltrator's Key grants the following benefits in its dormant state:",
	"\u2022 The key can be used as thieves' tools for the purpose of opening locks. When using the key, you are considered proficient in thieves' tools and you have advantage on ability checks made to open locks.",
	"\u2022 While holding the key, your steps are muffled, giving you advantage on Dexterity (Stealth) checks made to move silently.",
	">>Awakened<<. When the Infiltrator's Key reaches an awakened state, it gains the following properties:",
	"\u2022 While holding the key, you can use a bonus action to transform the key into a magic dagger or back into a key. While the key is in the form of a dagger, you gain a +1 bonus to attack and damage rolls made with it, and it returns to your hand immediately after it is used to make a ranged attack.",
	"\u2022 While holding the key, you can use an action to cast one of the following spells from it: alter self, invisibility, knock, or pass without trace. Once a spell has been cast using the key, it can't be used to cast that spell again until the next dawn.",
	">>Exalted<<. When the Infiltrator's Key reaches an exalted state, it gains the following properties:",
	"\u2022 As a bonus action, you can touch the key to a floor, wall, or ceiling that is no more than 5 feet thick and cause a magical opening to appear in the surface. When you create the opening, you choose its length and width, up to 10 feet for each dimension. The opening lasts until the key passes through it to the other side, at which point it disappears (if a creature is in the opening when the doorway closes, the creature is safely shunted to the nearest unoccupied space). The key can't be used to create another opening until the next dawn.",
	"\u2022 While holding the key, you can use an action to cast one of the following spells from it: dimension door, gaseous form, or mislead. Once a spell has been cast using the key, it can't be used to cast that spell again until the next dawn."
];
MagicItemsList["infiltrator's key"] = {
	name : "Infiltrator's Key",
	source : [["W", 273]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "This mithral skeleton key was forged using the blood of twelve master thieves executed for trying to steal magic items during the Age of Arcanum. See notes page for more information.",
	descriptionFull : EGtW_InfiltratorsKeyFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : EGtW_Vestiges_Replace(EGtW_InfiltratorsKeyFullDescription)
	}],
	toolProfs : [["Thieves' tools", "Dex"]],
	choices : ["Dormant", "Awakened", "Exalted"],
	choicesNotInMenu : true,
	"dormant" : {
		name : "Infiltrator's Key [dormant]",
		description : "This mithral skeleton key was forged using the blood of twelve master thieves executed for trying to steal magic items. It can be used as thieves' tools for the purpose of opening locks. I'm considered proficient when I do so with this key and gain adv. While holding it, I have adv. on Stealth checks to move silently."
	},
	"awakened" : {
		name : "Infiltrator's Key [awakened]",
		description : "I can use this mithral skeleton key as thieves' tools to open locks. I'm proficient with it and gain adv. on the roll. While holding it, I have adv. on Stealth checks to move silently. As a bonus action, I can transform it into a +1 dagger that returns immediately when thrown. I can use it to cast several spells, each once per dawn.",
		action : [["bonus action", "Infiltrator's Key (transform dagger)"]],
		weaponOptions : [{
			baseWeapon : "dagger",
			regExpSearch : /infiltrator's key|key of the infiltrator/i,
			name : "Infiltrator's Key",
			source : [["W", 273]],
			description : "Finesse, light, thrown; Returns when thrown",
			modifiers : [1, 1],
			selectNow : true
		}],
		spellcastingAbility : "class",
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["alter self", "invisibility", "knock", "pass without trace"],
			selection : ["alter self", "invisibility", "knock", "pass without trace"],
			firstCol : 'oncelr',
			times : 4
		}
	},
	"exalted" : {
		name : "Infiltrator's Key [exalted]",
		description : "I can use this mithral skeleton key as thieves' tools to open locks. I'm proficient with it and gain adv. on the roll. While holding it, I have adv. on Stealth checks to move silently. As a bonus action, I can transform it into a +1 dagger that returns when thrown. I can use it to cast several spells, each once per dawn. See Notes.",
		action : [
			["bonus action", "Infiltrator's Key (transform dagger)"],
			["bonus action", "Infiltrator's Key (create opening)"]
		],
		weaponOptions : [{
			baseWeapon : "dagger",
			regExpSearch : /infiltrator's key|key of the infiltrator/i,
			name : "Infiltrator's Key",
			source : [["W", 273]],
			description : "Finesse, light, thrown; Returns when thrown",
			modifiers : [1, 1],
			selectNow : true
		}],
		spellcastingAbility : "class",
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["alter self", "invisibility", "knock", "pass without trace", "dimension door", "gaseous form", "mislead"],
			selection : ["alter self", "invisibility", "knock", "pass without trace", "dimension door", "gaseous form", "mislead"],
			firstCol : 'oncelr',
			times : 7
		},
		extraLimitedFeatures : [{
			name : "Infiltrator's Key (create opening)",
			usages : 1,
			recovery : "dawn"
		}]
	}
};
var EGtW_StormgirdleFullDescription = [
	"A Stormgirdle is a wide belt made of thick leather branded with the symbol of Kord. The girdle's clasps are made from dragon ivory.",
	">>Dormant<<. While wearing the Stormgirdle in its dormant state, you have resistance to lightning damage and thunder damage, and your Strength score becomes 21 if it isn't already 21 or higher. In addition, you can use an action to become a Storm Avatar for 1 minute, gaining the following benefits for the duration:",
	"\u2022 You have immunity to lightning damage and thunder damage.",
	"\u2022 When you hit with a weapon attack that normally deals bludgeoning damage, it deals thunder damage instead. When you hit with a weapon attack that normally deals piercing or slashing damage, it deals lightning damage instead.",
	"\u2022 As a bonus action, you can choose one creature you can see within 30 feet of you to be struck by lightning. The target must make a DC 15 Dexterity saving throw, taking 3d6 lightning damage on a failed save, or half as much damage on a successful one.",
	"Once you use the girdle's Storm Avatar property, that property can't be used again until the next dawn.",
	">>Awakened<<. While wearing the Stormgirdle in its awakened state, you gain the following benefits:",
	"\u2022 Your Strength score becomes 23 if it isn't already 23 or higher.",
	"\u2022 Your Storm Avatar's lightning strike deals 4d6 lightning damage (instead of 3d6).",
	"\u2022 While transformed into a Storm Avatar, you gain a flying speed of 30 feet and can hover.",
	">>Exalted<<. While wearing the Stormgirdle in its exalted state, you gain the following benefits:",
	"\u2022 Your Strength score becomes 25 if it isn't already 25 or higher.",
	"\u2022 Your Storm Avatar's lightning strike deals 5d6 lightning damage (instead of 3d6).",
	"\u2022 You can cast the control weather spell from the girdle. This property can't be used again until the next dawn."
];
MagicItemsList["stormgirdle"] = {
	name : "Stormgirdle",
	source : [["W", 273]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "A wide belt of leather branded with the symbol of Kord. While attuned to and wearing this belt, I am resistant to lightning and thunder damage. My Strength score becomes 21, provided my Strength is not already 21 or higher. As an action, I can become a Storm Avatar for 1 minute. See notes page for more info.",
	descriptionFull : EGtW_StormgirdleFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : EGtW_Vestiges_Replace(EGtW_StormgirdleFullDescription)
	}],
	dmgres : ["Lightning", "Thunder"],
	action : [["action", " (Storm Avatar)"]],
	extraLimitedFeatures : [{
		name : "Storm Girdle (Storm Avatar)",
		usages : 1,
		recovery : "dawn"
	}],
	weaponOptions : [{
		regExpSearch : /^(?=.*storm avatar)(?=.*lightning strike).*$/i,
		name : "Storm Avatar's Lightning Strike",
		source : [["W", 273]],
		ability : 0,
		type : "Magic Item",
		damage : [3, 6, "lightning"],
		range : '30 ft',
		description : "Bonus action; Dex save, success - half damage",
		modifiers : [7, ""],
		dc : true,
		stormAvatarLightningStrike : true
	}],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.stormAvatarLightningStrike && CurrentMagicItems.known.indexOf('stormgirdle') !== -1) {
					var stormgirdleType = CurrentMagicItems.choices[CurrentMagicItems.known.indexOf('stormgirdle')];
					fields.Damage_Die = (stormgirdleType === "exalted" ? 5 : stormgirdleType === "awakened" ? 4 : 3) + 'd6';
				};
			},
			"",
			1
		]
	},
	choices : ["Dormant", "Awakened", "Exalted"],
	choicesNotInMenu : true,
	"dormant" : {
		name : "Stormgirdle [dormant]",
		description : "This wide belt of thick leather branded with the symbol of Kord grants me resistance to lightning and thunder damage and increases my Strength to 21. As an action once per dawn, I can use it to become a Storm Avatar for 1 minute. See Notes page for more information.",
		scoresOverride : [21, 0, 0, 0, 0, 0]
	},
	"awakened" : {
		name : "Stormgirdle [awakened]",
		description : "This wide belt of thick leather branded with the symbol of Kord grants me resistance to lightning and thunder damage and increases my Strength to 23. As an action once per dawn, I can use it to become a Storm Avatar for 1 minute. See Notes page for more information.",
		scoresOverride : [23, 0, 0, 0, 0, 0]
	},
	"exalted" : {
		name : "Stormgirdle [exalted]",
		description : "This wide belt of thick leather branded with the symbol of Kord grants me resistance to lightning and thunder damage and increases my Strength to 25. As an action once per dawn, I can use it to become a Storm Avatar for 1 minute. Once per dawn, I can cast Control Weather. See Notes page for more information.",
		scoresOverride : [25, 0, 0, 0, 0, 0],
		spellcastingAbility : "class",
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["control weather"],
			selection : ["control weather"],
			firstCol : 'oncelr'
		}
	}
};
var EGtW_VerminshroudFullDescription = [
	"This patchy cloak was pieced together from the pelts of rats found feasting on the dead in Blightshore and is dotted with the bloated corpses of magically preserved insects along its seams.",
	">>Dormant<<. While wearing the Verminshroud in its dormant state, you gain the following benefits:",
	"\u2022 You have advantage on Wisdom (Perception) checks that rely on smell, you are immune to disease, and you have darkvision out to a range of 60 feet. If you already have darkvision, wearing the cloak increases the range of your darkvision by 60 feet.",
	"\u2022 As an action, you can use the Verminshroud to cast polymorph on yourself, transforming into a giant rat or rat while retaining your Intelligence, Wisdom, and Charisma scores, as well as the properties of the cloak. This property can't be used again until the next dawn.",
	">>Awakened<<. While wearing the Verminshroud in its awakened state, you gain the following benefits:",
	"\u2022 You have resistance to poison damage.",
	"\u2022 You can use an action to cast the insect plague spell (save DC 15) from the Verminshroud, requiring no material components. This property can't be used again until the next dawn.",
	"\u2022 When you cast the polymorph spell using the Verminshroud, you can transform into a giant wasp.",
	">>Exalted<<. While wearing the Verminshroud in its exalted state, you gain the following benefits:",
	"\u2022 You gain a climbing speed equal to your walking speed.",
	"\u2022 Your teeth become razor-sharp natural weapons, which you can use to make unarmed strikes. If you hit with them, you deal piercing damage equal to 1d6 + your Strength modifier, instead of the bludgeoning damage normal for an unarmed strike. You can make this attack as a bonus action. When you bite a creature and deal damage to it, the creature must succeed on a DC 17 Constitution saving throw or be poisoned for 1 minute. The target can repeat the saving throw at the end of each of its turns, ending the condition on itself on a success.",
	"\u2022 When you cast the polymorph spell using the Verminshroud, you can transform into a giant scorpion."
];
MagicItemsList["verminshroud"] = {
	name : "Verminshroud",
	source : [["W", 273]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "This patchy cloak was pieced together from the pelts of rats found feasting on the dead in Blightshore and is dotted with the bloated corpses of magically preserved insects along its seams. See notes page for more info.",
	descriptionFull : EGtW_VerminshroudFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : EGtW_Vestiges_Replace(EGtW_VerminshroudFullDescription)
	}],
	savetxt : { immune : ["disease"] },
	vision : [["Darkvision", "fixed 60"], ["Darkvision", "+60"], ["Adv. on Perception check that rely on smell", 0]],
	extraLimitedFeatures : [{
		name : "Verminshroud (Polymorph)",
		usages : 1,
		recovery : "dawn"
	}],
	choices : ["Dormant", "Awakened", "Exalted"],
	choicesNotInMenu : true,
	"dormant" : {
		name : "Verminshroud [dormant]",
		description : "This patchy cloak of rat pelts grants me immunity to disease, darkvision out to 60 ft, or extends it by 60 ft, and advantage on Perception checks that rely on smell. Once per dawn, I can use it to cast Polymorph on myself to become a rat or a giant rat, but I retain my Int, Wis, and Cha, as well as the benefits of this cloak.",
		spellcastingAbility : "class",
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["polymorph"],
			selection : ["polymorph"],
			firstCol : "oncelr"
		},
		spellChanges : {
			"polymorph" : {
				name : "Polymorph (special)",
				range : "Self",
				description : "I transform into a rat or giant rat; I retain my Int, Wis, Cha",
				changes : "Using Verminshroud, I can cast Polymorph on myself once per dawn to transform myself into a rat or giant rat, while retaining my Intelligence, Wisdom, and Charisma scores as well as the benefits of the cloak."
			}
		}
	},
	"awakened" : {
		name : "Verminshroud [awakened]",
		description : "This patchy cloak of rat pelts grants me immunity to disease, darkvision out to 60 ft, or extends it by 60 ft, adv. on Perception checks that rely on smell, and resistance to poison. Once per dawn, I can use it to cast Polymorph on myself to become a rat, giant rat, or giant wasp. I can cast Insect Plague. See Notes page",
		dmgres : ["Poison"],
		extraLimitedFeatures : [{
			name : "Verminshroud (Insect Plague)",
			usages : 1,
			recovery : "dawn"
		}],
		fixedDC : 15,
		spellcastingBonus :[{
			name : "Once per dawn",
			spells : ["polymorph", "insect plague"],
			selection : ["polymorph", "insect plague"],
			firstCol : "oncelr",
			times : 2
		}],
		spellChanges : {
			"polymorph" : {
				name : "Polymorph (special)",
				range : "Self",
				description : "I transform into a rat, giant rat, or giant wasp; I retain my Int, Wis, Cha",
				changes : "Using Verminshroud, I can cast Polymorph on myself once per dawn to transform myself into a rat, giant rat, or giant wasp, while retaining my Intelligence, Wisdom, and Charisma scores as well as the benefits of the cloak."
			}
		}
	},
	"exalted" : {
		name : "Verminshroud [exalted]",
		description : "This patchy cloak grants me immunity to disease, darkvision out to 60 ft, or extends it by 60 ft, adv. on Perception checks that rely on smell, resistance to poison, and a climbing speed. Once per dawn, I can use it to cast Polymorph on myself to become a rat, giant rat, giant wasp, or giant scorpion. See Notes page.",
		dmgres : ["Poison"],
		extraLimitedFeatures : [{
			name : "Verminshroud (Insect Plague)",
			usages : 1,
			recovery : "dawn"
		}],
		fixedDC : 15,
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["polymorph", "insect plague"],
			selection : ["polymorph", "insect plague"],
			firstCol : "oncelr",
			times : 2
		},
		spellChanges : {
			"polymorph" : {
				name : "Polymorph (special)",
				range : "Self",
				description : "I transform into a rat, giant rat, giant wasp, or giant scorpion; I retain my Int, Wis, Cha",
				changes : "Using Verminshroud, I can cast Polymorph on myself once per dawn to transform myself into a rat, giant rat, giant wasp, or giant scorpion, while retaining my Intelligence, Wisdom, and Charisma scores as well as the benefits of the cloak."
			}
		},
		speed : { climb : { spd : "walk", enc : "walk" } },
		action : [["bonus action", "Verminshroud: Bite"]],
		weaponOptions : [{
			baseWeapon : "unarmed strike",
			regExpSearch : /^(?=.*verminshroud)(?=.*bite).*$/i,
			name : "Verminshroud: Bite",
			source : [["W", 273]],
			damage : [1, 6, "piercing"],
			description : "Bonus action; DC17 Con save or poisoned 1 min, repeat save end of their turns",
			abilitytodamage : true,
			selectNow : true
		}]
	}
};
var EGtW_WreathPrismFullDescription = [
	"This loop of golden thorns is inset with dozens of gems representing the five colors of Tiamat.",
	">>Dormant<<. While wearing the wreath in its dormant state, you have darkvision out to a range of 60 feet. If you already have darkvision, wearing the wreath increases the range of your darkvision by 60 feet.",
	"When you hit a beast, dragon, or monstrosity of challenge rating 5 or lower with an attack, or when you grapple it, you can use the wreath to cast dominate monster on the creature (save DC 13). On a successful save, the target is immune to the power of the wreath for 24 hours. On a failure, a shimmering, golden image of the wreath appears as a collar around the target's neck or as a crown on its head (your choice) until it is no longer charmed by the spell. If you use the wreath to charm a second creature, the first spell immediately ends. When the spell ends, the target knows it was charmed by you.",
	">>Awakened<<. Once the Wreath of the Prism reaches an awakened state, it gains the following benefits:",
	"\u2022 You can affect creatures of challenge rating 10 or lower with the wreath.",
	"\u2022 The save DC of the wreath's spell increases to 15.",
	">>Exalted<<. Once the Wreath of the Prism reaches an exalted state, it gains the following benefits:",
	"\u2022 You can affect creatures of challenge rating 15 or lower with the wreath.",
	"\u2022 The save DC of the wreath's spell increases to 17."
];
MagicItemsList["wreath of the prism"] = {
	name : "Wreath of the Prism",
	source : [["W", 274]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "This loop of golden thorns is inset with dozens of gems that represent the five colors of Tiamat. I gain darkvision to 60 ft, or extend my darkvision by 60 ft. When I hit a beast, dragon, or monstrosity with an attack, I can cast dominate monster on that creature, depending on its CR. See notes page for info.",
	descriptionFull : EGtW_WreathPrismFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : EGtW_Vestiges_Replace(EGtW_WreathPrismFullDescription)
	}],
	vision : [["Darkvision", "fixed 60"], ["Darkvision", "+60"]],
	choices : ["Dormant", "Awakened", "Exalted"],
	choicesNotInMenu : true,
	"dormant" : {
		name : "Wreath of the Prism [dormant]",
		description : "This loop of golden thorns is inset with dozens of gems that represent the five colors of Tiamat. I gain darkvision out to 60 ft, or extend it by 60 ft. When I hit a beast, dragon, or monstrosity of CR 5 or lower with an attack, I can cast dominate monster on that creature (save DC 13). See notes page for more information.",
		fixedDC : 13,
		spellcastingBonus : {
			name : "CR 5 or lower, DC 13",
			spells : ["dominate monster"],
			selection : ["dominate monster"]
		},
		spellChanges : {
			"dominate monster" : {
				name : "Dominate Monster (special)",
				description : "Cast on attack hit on CR 5 or lower beast, dragon, or monstrosity; spell ends if I do this again",
				changes : "I can cast dominate monster on a beast, dragon, or monstrosity of CR 5 when I hit it with an attack (save DC 13). If I use the wreath to charm a second creature, the first spell immediately ends. When the spell ends, the target knows it was charmed by me."
			}
		}
	},
	"awakened" : {
		name : "Wreath of the Prism [awakened]",
		description : "This loop of golden thorns is inset with dozens of gems that represent the five colors of Tiamat. I gain darkvision out to 60 ft, or extend it by 60 ft. When I hit a beast, dragon, or monstrosity of CR 10 or lower with an attack, I can cast dominate monster on that creature (save DC 15). See notes page for more information.",
		fixedDC : 15,
		spellcastingBonus : {
			name : "CR 10 or lower, DC 15",
			spells : ["dominate monster"],
			selection : ["dominate monster"]
		},
		spellChanges : {
			"dominate monster" : {
				name : "Dominate Monster (special)",
				description : "Cast on attack hit on CR 10 or lower beast, dragon, or monstrosity; spell ends if I do this again",
				changes : "I can cast dominate monster on a beast, dragon, or monstrosity of CR 10 when I hit it with an attack (save DC 15). If I use the wreath to charm a second creature, the first spell immediately ends. When the spell ends, the target knows it was charmed by me."
			}
		}
	},
	"exalted" : {
		name : "Wreath of the Prism [exalted]",
		description : "This loop of golden thorns is inset with dozens of gems that represent the five colors of Tiamat. I gain darkvision out to 60 ft, or extend it by 60 ft. When I hit a beast, dragon, or monstrosity of CR 15 or lower with an attack, I can cast dominate monster on that creature (save DC 17). See notes page for more information.",
		fixedDC : 17,
		spellcastingBonus : {
			name : "CR 15 or lower, DC 17",
			spells : ["dominate monster"],
			selection : ["dominate monster"]
		},
		spellChanges : {
			"dominate monster" : {
				name : "Dominate Monster (special)",
				description : "Cast on attack hit on CR 15 or lower beast, dragon, or monstrosity; spell ends if I do this again",
				changes : "I can cast dominate monster on a beast, dragon, or monstrosity of CR 15 when I hit it with an attack (save DC 17). If I use the wreath to charm a second creature, the first spell immediately ends. When the spell ends, the target knows it was charmed by me."
			}
		}
	}
};

/* Supernatural gift

MagicItemsList["hollow one"] = {
	name : "Hollow One",
	source : [["W", 182]],
	type : "supernatural gift",
	rarity : "",
	notLegalAL : true,
	description : "I don't age and aging effects don't work on me. When I roll a 16 or higher on a death save, I regain 1 HP. I register as undead for spells and other effects. As an action once per long rest, I can unsettle a creature I can see within 15 ft, giving it disadv. on the next save it makes in the next minute (frightening effect).",
	descriptionLong : "The void left behind by my departed soul is filled with the strange magic of Blightshore.\nI don't age and aging effects don't work on me. When I roll a 16 or higher on a death save, I regain 1 HP. Although my creature type is unchanged, I register as undead for spells and other effects. As an action once per long rest, I can unsettle a creature I can see within 15 ft, giving it disadvantage on the next save it makes in the next minute. Constructs, undead, and creatures that can't be frightened are immune to this feature.",
	descriptionFull : "As a Hollow One, the void left behind by your departed soul is filled with the strange magic of Blightshore. Becoming a Hollow One is a supernatural gift that bestows upon you the following traits.\n"+
	toUni("Ageless") + ". You don't age, and effects that would cause you to age don't work on you.\n"+
	toUni("Cling to Life") + ". When you make a death saving throw and roll 16 or higher, you regain 1 hit point.\n"+
	toUni("Revenance") + ". You retain your creature type, yet you register as undead to spells and other effects that detect the presence of the undead creature type.\n"+
	toUni("Unsettling Presence") + ". As an action, you can unsettle a creature you can see within 15 feet of you. The target has disadvantage on the next saving throw it makes within the next minute. Constructs, undead, and creatures that can't be frightened are immune to this feature. Once you use this feature, you can't use it again until you finish a long rest.",
	savetxt : { text : ["Can't be aged", "Regain 1 HP on 16+ death save"] },
	action : [["action", "Unsettling Presence"]],
	extraLimitedFeatures : [{
		name : "Unsettling Presence",
		usages : 1,
		recovery : "long rest"
	}]
};
FeatsList["hollow one"] = MagicItemsList["hollow one"];

*/
// pub_20200721_MOT.js
// This file adds the content from Mythic Odysseys of Theros to MPMB's Character Record Sheet

// Define the source
SourceList.MOT = {
	name : "Mythic Odysseys of Theros",
	abbreviation : "MOT",
	group : "Campaign Sourcebooks",
	campaignSetting : "Magic: The Gathering",
	url : "https://dnd.wizards.com/products/mythic-odysseys-theros",
	date : "2020/07/21"
};

RaceList["leonin"] = { // includes contributions by BraabHimself
	regExpSearch : /leonin/i,
	name : "Leonin",
	source : [["MOT", 20]],
	plural : "Leonin",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	skillstxt : "Choose one from Athletics, Intimidation, Perception, or Survival",
	languageProfs : ["Common", "Leonin"],
	vision : [["Darkvision", 60]],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*(leonin|\bcats?\b))(?=.*claw).*$/i,
		name : "Leonin Claws",
		source : [["MoT", 21]],
		damage : [1, 4, "slashing"],
		selectNow : true
	}],
	abilitySave : 3,
	age : " mature and age at about the same rate as humans",
	height : " are typically over 6 feet tall, with some standing over 7 feet (5'6\" + 2d10\")",
	weight : " weigh around 250 lb (180 + 2d10 \xD7 2d6 lb)",
	heightMetric : " are typically over 1,8 metres tall, with some standing over 2,1 metres (167 + 5d10 cm)",
	weightMetric : " weigh around 120 kg (80 + 5d10 \xD7 4d6 / 10 kg)",
	scores : [1, 0, 2, 0, 0, 0],
	features : {
		"daunting roar" : {
			name : "Daunting Roar",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : [["bonus action", ""]]
		}
	},
	trait : "Leonin (+2 Constitution +1 Strength)" + desc([
		"Claws: I can use my claws to make unarmed strikes that deal 1d4 slashing damage.",
		"Daunting Roar: As a bonus action once per short rest, I can let out a menacing roar. Creatures of my choice within 10 ft of me that can hear me must make a Wisdom saving throw (DC 8 + Constitution modifier + Proficiency Bonus) or become frightened of me until the end of my next turn.",
		"Hunter's Instincts: I'm proficient in either Athletics, Intimidation, Perception, or Survival."
	])
};
RaceList["satyr"] = { // includes contributions by BraabHimself
	regExpSearch : /satyr|goat\s*(wo)?man/i,
	name : "Satyr",
	source : [["MOT", 24]],
	plural : "Satyr",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	savetxt : { adv_vs : ["magic"] },
	languageProfs : ["Common", "Sylvan"],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*(satyr|\bram\b))(?=.*headbutt).*$/i,
		name : "Satyr Headbutt",
		source : [["MOT", 25]],
		damage : [1, 4, "bludgeoning"],
		selectNow : true
	}],
	toolProfs : [["Musical instrument", 1]],
	age : " mature and age at about the same rate as humans",
	height : " range from just under 5 feet to about 6 feet in height, with generally slender builds (4'8\" + 2d8\")",
	weight : " weigh around 145 lbs (100 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from just under 1,5 metres to about 1,8 metres in height, with generally slender builds (145 + 5d8 cm)",
	weightMetric : " weigh around 66 kg (45 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 0, 0, 2],
	skills : ["Performance", "Persuasion"],
	toolProfs : [["Musical instrument", 1]],
	trait : "Satyr (+1 Dexterity, +2 Charisma)" + desc([
		"Fey: My creature type is fey, rather than humanoid.",
		"Ram: I can use my head for unarmed strikes that deal 1d4 bludgeoning damage.",
		"Magic Resistance: I have advantage on saves against spells and other magical effects.",
		"Mirthful Leaps: Whenever I make a long or high jump, I can roll a d8 and add the number rolled to the number of feet I cover, even when making a standing jump. This extra distance costs movement as normal."
	])
};
// Subclasses (but add TCoE as main source, because it is more likely to be available at a table)
AddSubClass("bard", "college of eloquence", { // includes contributions by /u/Holynight6
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*eloquence).*$/i,
	subname : "College of Eloquence",
	source : [["T", 29], ["MOT", 28]],
	features : {
		"subclassfeature3" : {
			name : "Silver Tongue",
			source : [["T", 30], ["MOT", 28]],
			minlevel : 3,
			description : "\n   When I make a Persuasion or Deception check, I can treat a roll of 9 or lower as a 10"
		},
		"subclassfeature3.1" : {
			name : "Unsettling Words",
			source : [["T", 30], ["MOT", 28]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I expend a Bardic Inspiration use & choose a target I can see in 60 ft",
				"It subtracts my inspiration die from the next save it makes before my next turn starts"
			]),
			action : [["bonus action", ""]]
		},
		"subclassfeature6" : {
			name : "Unfailing Inspiration",
			source : [["T", 30], ["MOT", 28]],
			minlevel : 6,
			description : "\n   When a creature adds my Bardic Inspiration die to a roll but fails, they can keep the die"
		},
		"subclassfeature6.1" : {
			name : "Universal Speech",
			source : [["T", 30], ["MOT", 28]],
			minlevel : 6,
			description : desc([
				"As an action, I can choose up to my Charisma modifier (min 1) creatures within 60 ft",
				"Those creatures magically understand any language I speak for an hour",
				"I can do this once per long rest, or by expending a 1st-level or higher spell slot (SS 1+)"
			]),
			recovery : "long rest",
			usages : 1,
			altResource : "SS 1+",
			action : [["action", ""]]
		},
		"subclassfeature14" : {
			name : "Infectious Inspiration",
			source : [["T", 30], ["MOT", 28]],
			minlevel : 14,
			description : desc([
				"As a reaction when a creature uses my inspiration die and succeeds, I can inspire another",
				"I give a creature within 60 ft that can hear me an inspiration die without expending any"
			]),
			action : [["reaction", ""]],
			usages : "Charisma mod per ",
			usagescalc : "event.value = Math.max(1, What('Cha Mod'));",
			recovery : "long rest"
		}
	}
});
AddSubClass("paladin", "oath of glory", { // includes contributions by BraabHimself
	regExpSearch : /^(((?=.*glory)(((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper))))))).*$/i,
	subname : "Oath of Glory",
	source : [["T", 53], ["MOT", 29]],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Peerless Athlete",
			source : [["T", 54], ["MOT", 29]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can get adv. on Str (Athletics) \u0026 Dex (Acrobatics) checks for 10 min",
				"In that time, I also add +10 ft to jumps, and double what I can carry, push, drag, \u0026 lift"
			]),
			action : [["bonus action", ""]],
			spellcastingExtra : ["guiding bolt", "heroism", "enhance ability", "magic weapon", "haste", "protection from energy", "compulsion", "freedom of movement", "commune", "flame strike"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Inspiring Smite",
			source : [["T", 54], ["MOT", 29]],
			minlevel : 3,
			description : desc([
				"As a bonus action after dealing damage with Divine Smite, I can grant temporary HP",
				"I distribute the temporary HP how I choose across creatures within 30 ft, including me"
			]),
			additional : levels.map(function (n) {
				return n < 3 ? "" : "2d8 + " + n + " temporary HP";
			}),
			action : [["bonus action", ""]]
		},
		"subclassfeature7" : {
			name : "Aura of Alacrity",
			source : [["T", 54], ["MOT", 29]],
			minlevel : 7,
			description : "\n   If I'm not incapacitated, allies starting their turn in range gain bonus speed for that turn",
			speed : { walk : { spd : "+10", enc : "+10" } },
			additional : levels.map(function (n) {
				return n < 7 ? "" : (n < 18 ? 5 : 10) + "-foot aura; +10 ft walking speed";
			})
		},
		"subclassfeature15" : {
			name : "Glorious Defense",
			source : [["T", 54], ["MOT", 29]],
			minlevel : 15,
			description : desc([
				"As a reaction when I or another in 10 ft is hit with an attack roll, I can grant bonus AC",
				"I must be able to see the attacker; I add my Cha mod (min 1) to the AC for that attack",
				"If it misses, I can do a weapon attack vs. the attacker, if in reach, as part of this reaction"
			]),
			usages : "Charisma modifier per ",
			usagescalc : "event.value = Math.max(1, What('Cha Mod'));",
			recovery : "long rest",
			action : [["reaction", ""]]
		},
		"subclassfeature20" : {
			name : "Living Legend",
			source : [["T", 54], ["MOT", 29]],
			minlevel : 20,
			description : desc([
				"As a bonus action, I can empower myself with legends, gaining the following for 1 min:",
				" \u2022 My otherworldly presence grants me advantage on Charisma checks",
				" \u2022 Once on each of my turns when I miss with a weapon attack, I can have it hit instead",
				" \u2022 As a reaction when I fail a saving throw, I can reroll it, but must use the new roll",
				"I can do this once per long rest, or by expending a 5th-level or higher spell slot (SS 5+)"
			]),
			recovery : "long rest",
			usages : 1,
			altResource : "SS 5+",
			action : [["bonus action", ""]]
		}
	}
});

// Background
BackgroundList["athlete"] = { // includes contributions by Smashman
	regExpSearch : /athlete/i,
	name : "Athlete",
	source : [["MOT", 31]],
	skills : ["Acrobatics", "Athletics"],
	languageProfs : [1],
	toolProfs : ["Vehicles (land)"],
	gold : 10,
	equipleft : [
		["A bronze discus or leather ball", "", ""],
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["A lucky charm or past trophy", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Echoes of Victory",
	trait : [
		"I feel most at peace during physical exertion, be it exercise or battle.",
		"I don't like to sit idle.",
		"I have a daily exercise routine that I refuse to break.",
		"Obstacles exist to be overcome.",
		"When I see others struggling, I offer to help.",
		"I love to trade banter and gibes.",
		"Anything worth doing is worth doing best.",
		"I get irritated if people praise someone else and not me.",
	],
	ideal : [
		["Competition", "Competition: I strive to test myself in all things. (Chaotic)"],
		["Triumph", "Triumph: The best part of winning is seeing my rivals brought low. (Evil)"],
		["Camaraderie", "Camaraderie: The strongest bonds are forged through struggle. (Good)"],
		["People", "People: I strive to inspire my spectators. (Neutral)"],
		["Tradition", "Tradition: Every game has rules, and the playing field must be level. (Lawful)"],
		["Growth", "Growth: Lessons hide in victory and defeat. (Any)"],
	],
	bond : [
		"My teammates are my family.",
		"I will overcome a rival and prove myself their better.",
		"My mistake got someone hurt. I'll never make that mistake again.",
		"I will be the best for the honor and glory of my home.",
		"The person who trained me is the most important person in my world.",
		"I strive to live up to a specific hero's example.",
	],
	flaw : [
		"I indulge in a habit that threatens my reputation or my health.",
		"I'll do absolutely anything to win.",
		"I ignore anyone who doesn't compete and anyone who loses to me.",
		"I have lingering pain from old injuries.",
		"Any defeat or failure on my part is because my opponent cheated.",
		"I must be the captain of any group I join.",
	]
};
BackgroundFeatureList["echoes of victory"] = { // includes contributions by Smashman
	description : "I have attracted admiration among spectators, fellow athletes, and trainers in the region that hosted my past athletic victories. When visiting any settlement within 100 miles of where I grew up, there is a 50 percent change that I can find someone there who admires me and is willing to provide information or temporary shelter.",
	source : [["MOT", 31]]
};

// Creature: possible familiar
CreatureList["anvilwrought raptor"] = {
	name : "Anvilwrought Raptor",
	source : [["MOT", 209]],
	size : 5,
	type : "Construct",
	companion : "familiar_not_al",
	alignment : "Unaligned",
	ac : 14,
	hp : 18,
	hd : [4, 4],
	speed : "10 ft, fly 60 ft",
	scores : [12, 16, 14, 3, 14, 1],
	skills : {
		"perception" : 4
	},
	damage_immunities : "fire, poison",
	condition_immunities : "charmed, exhaustion, paralyzed, petrified, poisoned",
	senses : "Darkvision 120 ft; Adv. on Wis (Perception) checks using sight",
	passivePerception : 14,
	languages : "understands one language of its creator but can't speak",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Beak",
		ability : 2,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)",
		description : "Two beak attacks as one Attack action"
	}],
	traits : [{
		name : "Keen Sight",
		description : "The raptor has advantage on Wisdom (Perception) checks that rely on sight."
	}, {
		name : "Recorded Mimicry",
		description : "The raptor can mimic any sound, including voices, it has heard in the last 24 hours. A creature that hears the sounds can tell they are imitations with a successful DC 12 Wisdom (Insight) check."
	}],
	actions : [{
		name : "Multiattack",
		description : "The raptor makes two attacks with its beak."
	}],
	variant : [{
		name : "Variant: Familiar",
		description : "The anvilwrought can serve another creature as a familiar, forming a magical, telepathic bond with its willing master. While the two are bonded, the master can sense what the anvilwrought senses, as long as they are within 1 mile of each other."
	}]
};

// Magic Items (each contain contributions by BraabHimself)
MagicItemsList["flying chariot"] = {
	name : "Flying Chariot",
	source : [["MOT", 196]],
	type : "wondrous item",
	rarity : "rare",
	notLegalAL : true,
	description : "I gain +1 AC while riding this chariot, as do any passengers and the creatures pulling it. If this chariot is pulled by one or more flying creatures, they too can fly.\n(The AC bonus is not added to the automation, as it is too situational.)",
	descriptionFull : "The chariot's riders and creatures pulling the chariot gain a + 1 bonus to their AC."+
	"\n   If this magic chariot is pulled by one or more flying creatures, it too can fly.",
	weight : 100
};
MagicItemsList["helm of the gods"] = {
	name : "Helm of the Gods",
	source : [["MOT", 196]],
	type : "wondrous item",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "While wearing this helm, I know the location of all celestials and fiends within 30 ft, provided they aren't behind total cover. The helm has 3 charges, regaining 1d3 charges at dawn. I can use 1 charge to cast the spell stored in the helm (DC 13). After I finish a long rest, I can pray to a god to change the stored spell.",
	descriptionLong : "While wearing this helm, I know the location of all celestials/fiends within 30 ft not behind total cover. The helm has 3 charges, regaining 1d3 at dawn. I can use 1 charge to cast the spell stored in it (DC 13). After a long rest, I can pray to a god to change the stored spell: Athreos: Protection from Evil/Good, Ephara: Sanctuary, Erebos: Inflict Wounds, Heliod: Guiding Bolt, Iroas: Heroism, Karametra: Goodberry, Keranos: Thunderous Smite, Klothys: Entangle, Kruphix: Dissonant Whispers, Mogis: Hellish Rebuke, Nylea: Faerie Fire, Pharika: Lesser Restoration, Phenax: Charm Person, Purphoros: Searing Smite, Thassa: Identify",
	descriptionFull : "While wearing this helm, you know whether there is a celestial or fiend within 30 feet of you, as well as where the creature is located, provided the creature isn't behind total cover."+
	"\n   Whenever you finish a long rest while wearing the helm, you can pray to one of the gods listed on the Helm of the Gods table and store the listed spell in the helm, replacing any spell that is already stored there. The save DC for the spell is 13."+
	"\n   The helm has 3 charges. To cast a spell from the helm, you must expend 1 charge, and the helm regains 1d3 charges daily at dawn."+
	toUni("\n God\t\tSpell")+
	"\n Athreos\t\tprotection from evil and good"+
	"\n Ephara\t\tsanctuary"+
	"\n Erebos\t\tinflict wounds"+
	"\n Heliod\t\tguiding bolt"+
	"\n Iroas\t\theroism"+
	"\n Karametra\tgoodberry"+
	"\n Keranos\t\tthunderous smite"+
	"\n Klothys\t\tentagle"+
	"\n Kruphix\t\tdissonant whispers"+
	"\n Mogis\t\thellish rebuke"+
	"\n Nylea\t\tfaerie fire"+
	"\n Pharika\t\tlesser restoration"+
	"\n Phenax\t\tcharm person"+
	"\n Purphoros\tsearing smite"+
	"\n Thassa\t\tidentify",
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	fixedDC : 13,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "Athreos",
		spells : ["protection from evil and good"],
		selection : ["protection from evil and good"],
		firstCol : 1
	}, {
		name : "Ephara",
		spells : ["sanctuary"],
		selection : ["sanctuary"],
		firstCol : 1
	}, {
		name : "Erebos",
		spells : ["inflict wounds"],
		selection : ["inflict wounds"],
		firstCol : 1
	}, {
		name : "Heliod",
		spells : ["guiding bolt"],
		selection : ["guiding bolt"],
		firstCol : 1
	}, {
		name : "Iroas",
		spells : ["heroism"],
		selection : ["heroism"],
		firstCol : 1
	}, {
		name : "Karametra",
		spells : ["goodberry"],
		selection : ["goodberry"],
		firstCol : 1
	}, {
		name : "Keranos",
		spells : ["thunderous smite"],
		selection : ["thunderous smite"],
		firstCol : 1
	}, {
		name : "Klothys",
		spells : ["entangle"],
		selection : ["entangle"],
		firstCol : 1
	}, {
		name : "Kruphix",
		spells : ["dissonant whispers"],
		selection : ["dissonant whispers"],
		firstCol : 1
	}, {
		name : "Mogis",
		spells : ["hellish rebuke"],
		selection : ["hellish rebuke"],
		firstCol : 1
	}, {
		name : "Nylea",
		spells : ["faerie fire"],
		selection : ["faerie fire"],
		firstCol : 1
	}, {
		name : "Pharika",
		spells : ["lesser restoration"],
		selection : ["lesser restoration"],
		firstCol : 1
	}, {
		name : "Phenax",
		spells : ["charm person"],
		selection : ["charm person"],
		firstCol : 1
	}, {
		name : "Purphoros",
		spells : ["searing smite"],
		selection : ["searing smite"],
		firstCol : 1
	}, {
		name : "Thassa",
		spells : ["identify"],
		selection : ["identify"],
		firstCol : 1
	}],
	spellChanges : {
		"protection from evil and good" : {
			changes : "I can cast this spell if I prayed to Athreos after a long rest and expend 1 charge."
		},
		"sanctuary" : {
			changes : "I can cast this spell if I prayed to Ephara after a long rest and expend 1 charge."
		},
		"inflict wounds" : {
			changes : "I can cast this spell if I prayed to Erebos after a long rest and expend 1 charge."
		},
		"guiding bolt" : {
			changes : "I can cast this spell if I prayed to Heliod after a long rest and expend 1 charge."
		},
		"heroism" : {
			changes : "I can cast this spell if I prayed to Iroas after a long rest and expend 1 charge."
		},
		"goodberry" : {
			changes : "I can cast this spell if I prayed to Karametra after a long rest and expend 1 charge."
		},
		"thunderous smite" : {
			changes : "I can cast this spell if I prayed to Keranos after a long rest and expend 1 charge."
		},
		"entangle" : {
			changes : "I can cast this spell if I prayed to Klothys after a long rest and expend 1 charge."
		},
		"dissonant whispers" : {
			changes : "I can cast this spell if I prayed to Kruphix after a long rest and expend 1 charge."
		},
		"hellish rebuke" : {
			changes : "I can cast this spell if I prayed to Mogis after a long rest and expend 1 charge."
		},
		"faerie fire" : {
			changes : "I can cast this spell if I prayed to Nylea after a long rest and expend 1 charge."
		},
		"lesser restoration" : {
			changes : "I can cast this spell if I prayed to Pharika after a long rest and expend 1 charge."
		},
		"charm person" : {
			changes : "I can cast this spell if I prayed to Phenax after a long rest and expend 1 charge."
		},
		"searing smite" : {
			changes : "I can cast this spell if I prayed to Purphoros after a long rest and expend 1 charge."
		},
		"identify" : {
			ritual : false,
			changes : "I can cast this spell if I prayed to Thassa after a long rest and expend 1 charge."
		}
	}
};
MagicItemsList["molten bronze skin"] = {
	name : "Molten Bronze Skin",
	source : [["MOT", 197]],
	type : "armor (breastplate, half plate, or plate)",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "This armor appears as a jug of molten bronze. When I attune to it, it adheres and contours to my skin. It can be worn under clothes and doesn't impede bodily functions. This armor can't be removed unless I choose to do so. It grants me resistance to fire damage, and doesn't impose disadv. on Dex (Stealth) checks.",
	descriptionFull : "This magical armor appears as a jug of molten bronze. When you attune to it, the bronze adheres and contours to your skin. The armor can be worn under normal clothes, but it doesn't impede bodily functions. Once you put it on, it can't be removed unless you choose to do so."+
	"\n   While wearing the armor, you have resistance to fire damage. The armor also doesn't impose disadvantage on Dexterity (Stealth) checks.",
	dmgres : ["Fire"],
	choices : ["Breastplate", "Half Plate", "Plate"],
	choicesNotInMenu : true,
	"breastplate" : {
		description : "This breastplate appears as a jug of molten bronze. When I attune to it, it adheres and contours to my skin. It can be worn under clothes and doesn't impede bodily functions. It can't be removed unless I choose to do so, grants me resistance to fire damage, and doesn't impose disadv. on Dex (Stealth) checks.",
		armorOptions : [{
			regExpSearch : /^(?=.*molten)(?=.*bronze)(?=.*skin).*$/i,
			name : "Molten Bronze Skin",
			source : [["MOT", 197]],
			type : "medium",
			ac : 14,
			weight : 20,
			selectNow : true
		}]
	},
	"half plate" : {
		description : "This half plate armor appears as a jug of molten bronze. When I attune to it, it adheres and contours to my skin. It can be worn under clothes and doesn't impede bodily functions. It can't be removed unless I choose to do so, grants me resistance to fire damage, and doesn't impose disadv. on Dex (Stealth) checks.",
		armorOptions : [{
			regExpSearch : /^(?=.*molten)(?=.*bronze)(?=.*skin).*$/i,
			name : "Molten Bronze Skin",
			source : [["MOT", 197]],
			type : "medium",
			ac : 15,
			weight : 40,
			selectNow : true
		}]
	},
	"plate" : {
		description : "This plate armor appears as a jug of molten bronze. When I attune to it, it adheres and contours to my skin. It can be worn under clothes and doesn't impede bodily functions. It can't be removed unless I choose to do so, grants me resistance to fire damage, and doesn't impose disadv. on Dex (Stealth) checks.",
		armorOptions : [{
			regExpSearch : /^(?=.*molten)(?=.*bronze)(?=.*skin).*$/i,
			name : "Molten Bronze Skin",
			source : [["MOT", 197]],
			type : "heavy",
			ac : 18,
			weight : 65,
			strReq : 15,
			selectNow : true
		}]
	}
};
MagicItemsList["potion of aqueous form"] = {
	name : "Potion of Aqueous Form",
	source : [["MOT", 197]],
	type : "potion",
	rarity : "rare",
	notLegalAL : true,
	description : "Once as an action, I can drink this potion or administer it to another. The consumer of the potion turns into a pool of water and gains several benefits and limitations while in this form. They revert back to their true form after 10 minutes, if they become incapacitated, or if they die. See Notes page.",
	descriptionFull : "When you drink this potion, you transform into a pool of water. You return to your true form after 10 minutes or if you are incapacitated or die."+
	"\n   You're under the following effects while in this form:"+
	"\n\n" + toUni("Liquid Movement") + ". You have a swimming speed of 30 feet. You can move over or through other liquids. You can enter and occupy the space of another creature. You can rise up to your normal height, and you can pass through even Tiny openings. You extinguish nonmagical flames in any space you enter."+
	"\n\n" + toUni("Watery Resilience") + ". You have resistance to nonmagical damage. You also have advantage on Strength, Dexterity, and Constitution saving throws."+
	"\n\n" + toUni("Limitations") + ". You can't talk, attack, cast spells, or activate magic items. Any objects you were carrying or wearing meld into your new form and are inaccessible, though you continue to be affected by anything you're wearing, such as armor.",
	toNotesPage : [{
		name : "Effects",
		popupName : "Potion of Aqueous Form Effects",
		note : [
			"The consumer of the potion is under the following effects:",
			"\u2022 They have a swimming speed of 30 ft",
			"\u2022 They can move over or through other liquids",
			"\u2022 They can enter and occupy the space of another creature",
			"\u2022 They can rise up to their normal height and pass through tiny openings",
			"\u2022 They extinguish nonmagical flames in any space they enter",
			"\u2022 They have resistance to nonmagical damage",
			"\u2022 They have advantage on Strength, Dexterity, and Constitution saving throws",
			"\u2022 They can't talk, attack, cast spells, or activate magic items",
			"\u2022 Their equipment merges into their new form, but still gain their benefits"
		]
	}],
	weight : 0.5
};
var MOT_PyxisOfPandemoniumFullDescription = [
	"A creature that touches this ornate wooden vessel for 1 minute gains the benefits of a short rest. That creature also gains the effects of the bless spell until the creature finishes a short or long rest. The creature can't gain these benefits again until it finishes a long rest.",
	"If the vessel is opened, roll on the Pyxis of Pandemonium table to determine what happens. Any spells cast by the vessel have a spell save DC of 17. One minute after the vessel is opened, it disappears. It reappears, sealed, in a random location on the same plane of existence 24 hours later.",
	">>Curse<<. Any creature that gains the benefit of a short rest from the vessel hears cloying telepathic whispers emanating it. That creature must make a DC 17 Wisdom saving throw. On a failed save, the creature is charmed by the vessel for 1 hour. The charmed creature does everything it can to open the vessel as soon as possible. On a successful save, the creature is immune to the vessel's whispers for 24 hours.\n",
	toUni("d8\tCalamity"),
	" 1\t>>Androphagia<<. Each creature within 60 feet of the vessel must succeed on a DC 17 Wisdom saving throw or go berserk for l minute. The berserk creature must begin its turn using the Attack action to make one melee or ranged attack (its choice) against the creature nearest to it. The berserk creature can repeat the save at the end of its turn, ending the effect on itself on a success.",
	" 2\t>>Bile Blight<<. The vessel casts the harm spell on each creature within 30 feet of it.",
	" 3\t>>Flood<<. The vessel casts the tsunami spell at a point of the DM's choice within 120 feet of it.",
	" 4\t>>Medusa's Gaze<<. The vessel casts the flesh to stone spell on each creature within 30 feet of it.",
	" 5\t>>Labyrinth<<. The vessel casts the maze spell on each creature within 30 feet of it.",
	" 6\t>>Nightmare<<. Tendrils of shadow seep from the vessel and form into 1d4 shadow demons (see the Monster Manual for their stat block), which appear in unoccupied spaces within 30 feet of it and are hostile.",
	" 7\t>>Swarming Insects<<. The vessel casts the insect plague spell, centered on itself and with a radius of 30 feet.",
	" 8\t>>Unbridled Revel<<. The vessel casts the Otto's irresistible dance spell on each creature within 30 feet of it."
];
MagicItemsList["pyxis of pandemonium"] = {
	name : "Pyxis of Pandemonium",
	source : [["MOT", 197]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	description : "Once per long rest, I gain the benefits of a short rest by touching this ornate vessel for 1 minute. I also gain the benefit of Bless until I finish my next rest. After benefiting from this vessel, I have to make a DC 17 Wis save or become charmed by the vessel for 1 hour. If charmed, I must do everything to open it. See Notes.",
	descriptionLong : "Once per long rest, I can touch this ornate wooden vessel for 1 minute to gain the benefits of a short rest. I then also gain the benefit of the Bless spell until I finish my next rest. After I gain the benefits of a short rest from this vessel, I must make a DC 17 Wisdom save or become charmed by it for 1 hour. On a success, I am immune to its charm for 24 hours. If charmed, I will do everything I can to open the vessel as soon as possible. Once opened, the vessel causes a random effect to occur, then it disappears after 1 minute and reappears, sealed, in random location on the same plane. See Notes.",
	descriptionFull : MOT_PyxisOfPandemoniumFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Effects",
		source : [["MOT", 197]],
		note : desc(MOT_PyxisOfPandemoniumFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/\bf(oo|ee)t\b/ig, "ft")
	}],
	usages : 1,
	recovery : "long rest"
};
MagicItemsList["siren song lyre"] = {
	name : "Siren Song Lyre",
	source : [["MOT", 198]],
	type : "wondrous item (instrument)",
	rarity : "rare",
	notLegalAL : true,
	attunement : true,
	description : "As an action, I can play this lyre and cast one of the following spells from it: Animal Friendship, Charm Person, Enthrall, or Suggestion. The DC for these spells is 13. Once I cast a spell, I can't use the lyre to cast that spell again until the next dawn.",
	descriptionFull : "You can use an action to play this lyre and cast one of the following spells from it: animal friendship, charm person, enthrall, suggestion. If the spell requires a saving throw, the spell save DC is 13.\n   Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn.",
	weight : 2,
	fixedDC : 13,
	extraLimitedFeatures : [{
		name : "Siren's Song Lyre [Animal Friendship]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Siren's Song Lyre [Charm Person]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Siren's Song Lyre [Enthrall]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Siren's Song Lyre [Suggestion]",
		usages : 1,
		recovery : "dawn"
	}],
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["animal friendship", "charm person", "enthrall", "suggestion"],
		selection : ["animal friendship", "charm person", "enthrall", "suggestion"],
		firstCol : "oncelr",
		times : 4
	}
};
var MOT_SlingBulletsOfAlthemoneFullDescription = [
	"The sling bullets come in a pouch, which contains 1d4 + 4 bullets. Roll on the Magic Sling Bullets table for each bullet to determine its magical property.",
	"You have a +2 bonus to attack and damage rolls made with each of these bullets. If a bullet misses its target, the bullet teleports back into the pouch. Once a bullet hits a target, the bullet loses its magic.\n",
	">>d4  Bullet<<",
	"1   >>Banishment<<. A creature that takes damage from this bullet must succeed on a DC 15 Charisma saving throw or be banished as though affected by the banishment spell.",
	"2   >>Fulguration<<. On a hit, this bullet deals an extra 2d8 lightning damage to its target. All other creatures within 10 feet of the target must each succeed on a DC 15 Constitution saving throw or take 1d8 thunder damage.",
	"3   >>Stunning<<. On a hit, this bullet deals an extra ldlO force damage, and the target is stunned until the end of your next turn.",
	"4   >>Tracking<<. A creature that takes damage from this bullet is marked with a glowing rune where the bullet hit. The mark lasts 24 hours. While the creature is marked, you always know the direction to it.",
];
MagicItemsList["sling bullets of althemone"] = {
	name : "Sling Bullets of Althemone",
	source : [["MOT", 198]],
	type : "weapon (sling bullet)",
	rarity : "very rare",
	notLegalAL : true,
	description : "These bullets come in a pouch containing 1d4 + 4 bullets. Attacks made with these sling bullets add +2 to hit and damage. If a bullet misses, it teleports back to its pouch. On a hit, the bullet's effect happens and the bullet loses its magic. I roll on the table to determine each bullet's magical effect, see Notes.",
	descriptionFull : MOT_SlingBulletsOfAlthemoneFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == "sling" && (/althemone/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description += (fields.Description ? '; ' : '') + 'Bullets return on a miss, special effect on hit';
				}
			},
			'If I include the word "Althemone" in the name of a sling, it will be treated as using the Sling Bullets of Althemone. It has +2 to hit and damage, bullets return on a miss, and cause a magical effect on a hit.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.baseWeaponName == "sling" && (/althemone/i).test(v.WeaponTextName)) {
					output.magic = v.thisWeapon[1] + 2;
				}
			}
		]
	},
	toNotesPage : [{
		name : "Magic Sling Bullets Table",
		source : [["MOT", 198]],
		note : desc(MOT_SlingBulletsOfAlthemoneFullDescription.slice(2)).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/\bf(oo|ee)t\b/ig, "ft").replace(/\byou\b/ig, "I").replace(/your/g, "my")
	}],
	weight : 1.5 // assuming an averyage of 6,5 bullets (0.4875) and a pouch (1)
};
MagicItemsList["two-birds sling"] = {
	name : "Two-Birds Sling",
	source : [["MOT", 198]],
	type : "weapon (sling)",
	rarity : "rare",
	notLegalAL : true,
	description : "This sling adds +1 to hit and damage rolls made with it. On a hit, I can cause the ammunition to ricochet towards a second target within 10 ft of the first, rolling a ranged attack against the second target as well.",
	descriptionFull : "You have a +l bonus to attack and damage rolls made with this weapon."+
	"\n   When you make a ranged attack with this sling and hit a target, you can cause the ammunition to ricochet toward a second target within 10 feet of the first, and then make a ranged attack against the second target.",
	weaponOptions : [{
		baseWeapon : "sling",
		regExpSearch : /^(?=.*two-birds)(?=.*sling).*$/i,
		name : "Two-Birds Sling",
		source : [["MOT", 198]],
		description : "Ammunition; On hit ricochet to another in 10 ft",
		modifiers : [1, 1],
		selectNow : true
	}]
};

// pub_20200915_RotF.js
// This file adds the content from the Icewind Dale: Rime of the Frostmaiden adventure to MPMB's Character Record Sheet

// Define the source
SourceList["RotF"] = {
	name : "Icewind Dale: Rime of the Frostmaiden [creatures, items, spells]",
	abbreviation : "RotF",
	abbreviationSpellsheet : "RF",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/icewind-dale-rime-frostmaiden",
	date : "2020/09/15"
};

// Winter Survival Gear (contains contributions by Nod_Hero on Discord)
GearList["cold weather"] = {
	infoname : "Cold Weather [10 gp]",
	name : "Cold weather clothes",
	source : [["RotF", 20]],
	amount : "",
	weight : 5,
	type : "clothes"
};
GearList["crampons (2)"] = {
	infoname : "Crampons (2) [2 gp]",
	name : "Crampons",
	source : [["RotF", 20]],
	amount : 2,
	weight : 0.125
};    
GearList["snowshoes"] = {
	infoname : "Snowshoes [2 gp]",
	name : "Snowshoes",
	source : [["RotF", 20]],
	amount : "",
	weight : 4
};

// Creatures - new beasts (each contain contributions by BraabHimself)
// Reindeer is just an elk under a different name and a moose uses the giant goat stat block. They have been added to the SRD code as a `nameAlt`
CreatureList["awakened white moose"] = {
	name : "Awakened White Moose",
	nameAlt : ["Moose, Awakened White"],
	source : [["RotF", 82]],
	size : 2,
	type : "Beast",
	alignment : "Neutral Evil",
	ac : 11,
	hp : 68,
	hd : [8, 10],
	speed : "40 ft",
	scores : [19, 11, 16, 10, 12, 6],
	senses : "",
	passivePerception : 11,
	languages : "Druidic",
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Antlers",
		ability : 1,
		damage : [2, 8, "piercing"],
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, see Charge trait"
	}, {
		name : "Hooves",
		ability : 1,
		damage : [2, 4, "bludgeoning"],
		range : "Melee (5 ft)",
		description : "One antlers and one hooves attack as an Attack action"
	}],
	traits : [{
		name : "Charge",
		description : "If the moose moves at least 20 ft straight toward a target and then hits it with an antlers attack on the same turn, the target takes an extra 9 (2d8) bludgeoning damage. If the target is a creature, it must succeed on a DC 14 Strength saving throw or be knocked prone."
	}, {
		name : "Sure-Footed",
		description : "The moose has advantage on Strength and Dexterity saving throws made against effects that would knock it prone."
	}],
	actions : [{
		name : "Multiattack",
		description : "The moose makes two attacks: one with its antlers and one with its hooves."
	}],
	wildshapeString : "\u25C6 Multiattack: Makes two attacks: one with its antlers and one with its hooves."+
	"\n\u25C6 Charge: After moving 20 ft straight toward a target and then hitting it with an antlers attack on the same turn, the target takes an extra 2d8 bludgeoning damage and must make a DC 14 Str save or be knocked prone."+
	"\n\u25C6 Sure-Footed: Advantage on Str and Dex saves against effects that would knock it prone."
};
CreatureList["fox"] = {
	name : "Fox",
	companion : "familiar_not_al",
	source : [["RotF", 288]],
	size : 5,
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 2,
	hd : [1, 4],
	speed : "30 ft, burrow 5 ft",
	scores : [2, 16, 11, 3, 12, 6],
	skills : {
		"perception" : 3,
		"stealth" : 5
	},
	senses : "Darkvision 60 ft; Adv. on Wis (Perception) checks using hearing",
	passivePerception : 13,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, "", "piercing"],
		range : "Melee (5 ft)",
		description : "",
		abilitytodamage : false
	}],
	traits : [{
		name : "Keen Hearing",
		description : "The fox has advantage on Wisdom (Perception) checks that rely on hearing."
	}]
};
CreatureList["hare"] = {
	name : "Hare",
	source : [["RotF", 294]],
	companion : "familiar_not_al",
	size : 5,
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 1,
	hd : [1, 4],
	speed : "20 ft, burrow 5 ft",
	scores : [1, 17, 9, 2, 11, 4],
	skills : {
		"perception" : 2,
		"stealth" : 5
	},
	senses : "",
	passivePerception : 12,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 0,
	attacks : [],
	traits : [{
		name : "Escape",
		description : "The hare can take the Dash, Disengage, or Hide action as a bonus action on each of its turns."
	}]
};
CreatureList["knucklehead trout"] = {
	name : "Knucklehead Trout",
	source : [["RotF", 295]],
	size : 4,
	type : "Beast",
	alignment : "Unaligned",
	ac : 12,
	hp : 7,
	hd : [2, 6],
	speed : "0 ft, swim 30 ft",
	scores : [14, 14, 11, 1, 6, 1],
	senses : "Darkvision 60 ft",
	passivePerception : 8,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}, {
		name : "Tail",
		ability : 1,
		damage : [1, 4, "bludgeoning"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Water Breathing",
		description : "The trout can breathe only underwater."
	}]
};
CreatureList["mountain goat"] = {
	name : "Mountain Goat",
	nameAlt : ["Goat, Mountain"],
	source : [["RotF", 304]],
	size : 3,
	type : "Beast",
	alignment : "Unaligned",
	ac : 11,
	hp : 13,
	hd : [2, 8],
	speed : "40 ft, climb 30 ft",
	scores : [14, 12, 14, 2, 10, 5],
	senses : "",
	passivePerception : 10,
	challengeRating : "1/8",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Ram",
		ability : 1,
		damage : [1, 6, "bludgeoning"],
		range : "Melee (5 ft)",
		description : "If used after moving 20 ft straight in the same round, see Charge trait"
	}],
	traits : [{
		name : "Charge",
		description : "If the goat moves at least 20 ft straight toward a target and then hits it with a ram attack on the same turn, the target takes an extra 3 (1d6) bludgeoning damage. If the target is a creature, it must succeed on a DC 12 Strength saving throw or be knocked prone."
	}, {
		name : "Sure-Footed",
		description : "The goat has advantage on Strength and Dexterity saving throws made against effects that would knock it prone."
	}],
	wildshapeString : "\u25C6 Charge: After moving 20 ft straight toward a target and then hitting it with a ram attack on the same turn, the target takes an extra 1d6 bludgeoning damage and must make a DC 12 Strength save or be knocked prone."+
	"\n\u25C6 Sure-Footed: Advantage on Strength and Dexterity saves against effects that would knock it prone."
};
CreatureList["seal"] = {
	name : "Seal",
	source : [["RotF", 308]],
	size : 3,
	type : "Beast",
	alignment : "Unaligned",
	ac : 11,
	hp : 9,
	hd : [2, 8],
	speed : "20 ft, swim 40 ft",
	scores : [10, 12, 11, 3, 12, 5],
	senses : "Darkvision 60 ft; Adv. on Wis (Perception) checks using smell",
	passivePerception : 11,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, "", "piercing"],
		range : "Melee (5 ft)",
		description : "",
		abilitytodamage : false
	}],
	traits : [{
		name : "Hold Breath",
		description : "The seal can hold its breath for 15 minutes."
	}, {
		name : "Keen Smell",
		description : "The seal has advantage on Wisdom (Perception) checks that rely on smell."
	}]
};
CreatureList["sperm whale"] = {
	name : "Sperm Whale",
	nameAlt : ["Whale, Sperm"],
	source : [["RotF", 309]],
	size : 0,
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 189,
	hd : [14, 20],
	speed : "0 ft, swim 60 ft",
	scores : [26, 8, 17, 3, 12, 5],
	senses : "Blindsight 120 ft; Adv. on Wis (Perception) checks using hearing",
	passivePerception : 11,
	challengeRating : "8",
	proficiencyBonus : 3,
	attacksAction : 2,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [3, 8, "piercing"],
		range : "Melee (5 ft)",
		description : "1 bite \u0026 1 tail attack as Attack action; See Swallow feature",
		tooltip : "If the target is a Large or smaller creature, it must succeed on a DC 14 Dexterity saving throw or be swallowed by the whale. A swallowed creature has total cover against attacks and other effects outside the whale, and it takes 3 (1d6) acid damage at the start of each of the whale's turns. If the whale takes 30 damage or more on a single turn from a creature inside it, the whale must succeed on a DC 16 Constitution saving throw at the end of that turn or regurgitate all swallowed creatures, which fall prone in a space within 10 feet of the whale. If the whale dies, a swallowed creature can escape from the corpse by using 20 feet of movement, exiting prone."
	}, {
		name : "Tail",
		ability : 1,
		damage : [3, 6, "bludgeoning"],
		range : "Melee (15 ft)",
		description : "1 bite \u0026 1 tail attack as Attack action; Double damage vs. objects",
		tooltip : "If the target is an object, the tail attack deal 6d6 + twice the Strength modifier bludgeoning damage."
	}],
	features : [{
		name : "Swallow",
		description : "A Large or smaller creature hit by the whale's bite attack must make a DC 14 Dexterity saving throw or be swallowed whole. A swallowed creature has total cover against attacks and other effects outside the whale, and it takes 3 (1d6) acid damage at the start of each of the whale's turns. If the whale takes 30 damage or more on a single turn from a creature inside it, the whale must succeed on a DC 16 Constitution saving throw at the end of that turn or regurgitate all swallowed creatures, which fall prone in a space within 10 ft of the whale. If the whale dies, a swallowed creature can escape from the corpse by using 20 ft of movement, exiting prone."
	}],
	traits : [{
		name : "Echolocation",
		description : "The whale can't use its blindsight while deafened."
	}, {
		name : "Hold Breath",
		description : "The whale can hold its breath for 90 minutes."
	}, {
		name : "Keen Hearing",
		description : "The whale has advantage on Wisdom (Perception) checks that rely on hearing."
	}],
	actions : [{
		name : "Multiattack",
		description : "The whale makes two attacks: one with its bite and one with its tail."
	}],
	wildshapeString : "\u25C6 Senses: Blindsight 120 ft (unless deafened); Adv. on Wis (Perception) checks using hearing."+
	"\n\u25C6 Hold Breath: Can hold its breath for 90 minutes."+
	"\n\u25C6 Swallow: Large or smaller hit with bite DC 14 Dex save or swallowed. Swallowed: total cover from outside whale, 1d6 acid damage at start of each turn. If whale takes 30 or more damage in a turn from inside, it DC 16 Con save or spit out creature prone in 10 ft at end of turn."
};
CreatureList["walrus"] = {
	name : "Walrus",
	source : [["RotF", 312]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 9,
	hp : 22,
	hd : [3, 10],
	speed : "20 ft, swim 40 ft",
	scores : [15, 9, 14, 3, 11, 4],
	senses : "",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Tusks",
		ability : 1,
		damage : [2, 4, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Hold Breath",
		description : "The walrus can hold its breath for 10 minutes."
	}]
};
CreatureList["giant walrus"] = {
	name : "Giant Walrus",
	nameAlt : ["Walrus, Giant"],
	source : [["RotF", 312]],
	size : 1,
	type : "Beast",
	alignment : "Unaligned",
	ac : 9,
	hp : 85,
	hd : [9, 12],
	speed : "20 ft, swim 40 ft",
	scores : [22, 9, 16, 3, 11, 4],
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	challengeRating : "4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Body Flop",
		ability : 1,
		damage : [2, 8, "bludgeoning"],
		range : "Melee (5 ft)",
		description : "One body flop and one tusks attack as an Attack action"
	}, {
		name : "Tusks",
		ability : 1,
		damage : [3, 6, "piercing"],
		range : "Melee (5 ft)",
		description : "One body flop and one tusks attack as an Attack action"
	}],
	traits : [{
		name : "Hold Breath",
		description : "The walrus can hold its breath for 30 minutes."
	}],
	actions : [{
		name : "Multiattack",
		description : "The walrus makes two attacks: one with its body flop and one with its tusks."
	}]
};

// Creatures - for the Create Magos spell (each contain contributions by BraabHimself)
CreatureList["demos magen"] = {
	name : "Demos Magen",
	nameAlt : ["Magen, Demos"],
	source : [["RotF", 300]],
	size : 3,
	type : "Construct",
	alignment : "Unaligned",
	ac : 16,
	hp : 51,
	hd : [6, 8],
	speed : "30 ft",
	scores : [14, 14, 18, 10, 10, 7],
	senses : "",
	damage_immunities : "poison",
	condition_immunities : "charmed, exhaustion, frightened, paralyzed, poisoned",
	passivePerception : 10,
	languages : "understands the languages of its creator but can't speak",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Greatsword",
		ability : 1,
		damage : [2, 6, "slashing"],
		range : "Melee (5 ft)",
		description : "Two greatsword attacks as an Attack action"
	}, {
		name : "Light Crossbow",
		ability : 2,
		damage : [1, 8, "piercing"],
		range : "80/320 ft",
		description : ""
	}],
	actions : [{
		name : "Multiattack",
		description : "The magen makes two melee attacks."
	}],
	traits : [{
		name : "Fiery End",
		description : "If the magen dies, its body disintegrates in a harmless burst of fire and smoke, leaving behind anything it was wearing or carrying."
	}, {
		name : "Magic Resistance",
		description : "The magen has advantage on saving throws against spells and other magical effects."
	}, {
		name : "Unusual Nature",
		description : "The magen doesn't require air, food, drink, or sleep."
	}],
	features : [{
		name : "Magical Servants",
		description : "Magen make ideal servants. At creation, each is instilled with an instinct to protect itself and its creator, and it follows its creator's instructions without hesitation. When its taks is complete, a magen stands immobile and silent until its creator gives it new orders."
	}]
};
CreatureList["galvan magen"] = {
	name : "Galvan Magen",
	nameAlt : ["Magen, Galvan"],
	source : [["RotF", 301]],
	size : 3,
	type : "Construct",
	alignment : "Unaligned",
	ac : 14,
	hp : 68,
	hd : [8, 8],
	speed : "30 ft, fly 30 ft (hover)",
	scores : [10, 18, 18, 12, 10, 7],
	senses : "",
	damage_immunities : "lightning, poison",
	condition_immunities : "charmed, exhaustion, frightened, paralyzed, poisoned",
	passivePerception : 10,
	languages : "understands the languages of its creator but can't speak",
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Shocking Touch",
		ability : 2,
		damage : [1, 6, "lightning"],
		range : "Melee (5 ft)",
		description : "Two shocking touch attacks as an Attack action; Adv. if target wears metal armor"
	}, {
		name : "Static Discharge (Recharge 5-6)",
		ability : 3,
		damage : [4, 10, "lightning"],
		range : "5-ft \xD7 30-ft line",
		description : "Hits all in area; Dex save, success\u2015 half damage; Disadv. if wearing metal armor",
		abilitytodamage : false,
		dc : true,
		tooltip : "The magen discharges a lightning bolt in a 60-foot line that is 5 feet wide. Each creature in that line must make a DC 14 Dexterity saving throw (with disadvantage if the creature is wearing armor made of metal), taking 22 (4d10) lightning damage on a failed save, or half as much damage on a successful one."
	}],
	traits : [{
		name : "Fiery End",
		description : "If the magen dies, its body disintegrates in a harmless burst of fire and smoke, leaving behind anything it was wearing or carrying."
	}, {
		name : "Magic Resistance",
		description : "The magen has advantage on saving throws against spells and other magical effects."
	}, {
		name : "Unusual Nature",
		description : "The magen doesn't require air, food, drink, or sleep."
	}],
	features : [{
		name : "Magical Servants",
		description : "Magen make ideal servants. At creation, each is instilled with an instinct to protect itself and its creator, and it follows its creator's instructions without hesitation. When its taks is complete, a magen stands immobile and silent until its creator gives it new orders."
	}],
	actions : [{
		name : "Multiattack",
		description : "The magen makes two Shocking Touch attacks."
	}, {
		name : "Static Discharge (Recharge 5-6)",
		description : "See Attack. The magen discharges a lightning bolt in a 60-ft line that is 5 ft wide. Each creature in that line must make a DC 14 Dexterity saving throw (with disadvantage if the creature is wearing armor made of metal), taking 4d12 lightning damage on a failed save, or half as much damage on a successful one."
	}]
};
CreatureList["hypnos magen"] = {
	name : "Hypnos Magen",
	nameAlt : ["Magen, Hypnos"],
	source : [["RotF", 301]],
	size : 3,
	type : "Construct",
	alignment : "Unaligned",
	ac : 12,
	hp : 34,
	hd : [4, 8],
	speed : "30 ft",
	scores : [10, 14, 18, 14, 10, 7],
	senses : "",
	damage_immunities : "poison",
	condition_immunities : "charmed, exhaustion, frightened, paralyzed, poisoned",
	passivePerception : 10,
	languages : "telepathy 30 ft, understands the languages of its creator but can't speak",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Psychic Lash",
		ability : 4,
		damage : [2, 10, "psychic"],
		range : "60 ft",
		description : "One creature in sight; Wis save: success\u2015 no damage",
		abilitytodamage : false,
		dc : true
	}],
	traits : [{
		name : "Fiery End",
		description : "If the magen dies, its body disintegrates in a harmless burst of fire and smoke, leaving behind anything it was wearing or carrying."
	}, {
		name : "Magic Resistance",
		description : "The magen has advantage on saving throws against spells and other magical effects."
	}, {
		name : "Unusual Nature",
		description : "The magen doesn't require air, food, drink, or sleep."
	}],
	features : [{
		name : "Magical Servants",
		description : "Magen make ideal servants. At creation, each is instilled with an instinct to protect itself and its creator, and it follows its creator's instructions without hesitation. When its taks is complete, a magen stands immobile and silent until its creator gives it new orders."
	}],
	actions : [{
		name : "Suggestion",
		description : "The magen casts the Suggestion spell (save DC 12), requiring no material components. The target must be a creature that the magen can communicate with telepathically. If it succeeds on its saving throw, the target is immune to this magen's suggestion spell for the next 24 hours. The magen's spellcasting ability is Intelligence."
	}]
};

// Magic Items
MagicItemsList["abracadabrus"] = { // contains contributions by BraabHimself
	name : "Abracadabrus",
	source : [["RotF", 314]],
	type : "wondrous item",
	rarity : "very rare",
	description : "This gemstone-studded wooden chest with a volume of 1.5 cu ft has 20 charges, regaining 1d20 charges at dawn. I roll a d20 if I use its last charge. On a 1, it loses its magic and gems. As an action, I can touch it and expend 1 charge to have up to 1 gp of nonmagical objects form inside, provided they fit and it's empty.",
	descriptionLong : "This ornate, gemstone-studded wooden chest has a volume of 1.5 cu ft and weighs 25 lb. It has 20 charges and regains 1d20 expended charges daily at dawn. I roll a d20 if I use its last charge. On a 1, it loses its magic and gems. As an action, I can touch it and expend 1 charge to have up to 1 gp of nonmagical objects form inside (including raw materials, foodstuffs, and liquids), provided they fit inside and the chest is empty. Food and drink produced by the chest is delicious and spoils if not consumed after 24 hours. Gems and precious metals produced by the chest disappear after 1 minute.",
	descriptionFull : "An abracadabrus is an ornate, gemstone-studded wooden chest that weighs 25 pounds while empty. Its interior compartment is a cube measuring 1\u00BD feet on a side."+
	"\n   The chest has 20 charges. A creature can use an action to touch the closed lid of the chest and expend 1 of the chest's charges while naming one or more nonmagical objects (including raw materials, foodstuffs, and liquids) worth a total of 1 gp or less. The named objects magically appear in the chest, provided they can all fit inside it and the chest doesn't contain anything else. For example, the chest can conjure a plate of strawberries, a bowl of hot soup, a flagon of water, a stuffed animal, or a bag of twenty caltrops. Food and drink conjured by the chest are delicious, and they spoil if not consumed after 24 hours. Gems and precious metals created by the chest disappear after 1 minute."+
	"\n   The chest regains 1d20 expended charges daily at dawn. If the item's last charge is expended, roll a d20. On a 1, the chest loses its magic (becoming an ordinary chest), and its gemstones turn to dust.",
	weight : 25,
	usages : 20,
	recovery : "dawn",
	additional : "regains 1d20",
	action : [["action", ""]]
};
MagicItemsList["cauldron of plenty"] = { // contains contributions by BraabHimself
	name : "Cauldron of Plenty",
	source : [["RotF", 314]],
	type : "wondrous item",
	rarity : "rare",
	description : "This copper cauldron is 4 ft wide, 3.5 ft in diameter, and holds 30 gal. It has a lid, handles, and 5 clawed feet. Water stirred in it for 1 min becomes hot stew for 4 people per 1 gal. Stew stays hot in the cauldron, cools if removed, but cauldron's surface remains cool. Can be used 3 times per day, regaining all uses at dawn.",
	descriptionLong : "This thick copper cauldron has turned green with age. It is 4ft wide, has a 3.5 ft diameter mouth, and holds 30 gallons. It has a lid, handles, and 5 clawed feet. If water is poured into the cauldron and stirred for 1 minute, it transforms into a hearty, hot stew, which can provide one nourishing meal for up to four people per 1 gallon. The stew remains hot while in the cauldron, then cools naturally after it is removed. The outside of the cauldron remains safe to touch despite the heat of the stew. The cauldron can create stew three times. It then ceases to function until the next dawn, when it regains all its uses.",
	descriptionFull : "This cauldron is made of thick copper that has turned green with age. It is 4 feet wide, has a mouth 3\u00BD feet in diameter, weighs 50 pounds, and can hold up to 30 gallons of liquid. Embossed on its bulging sides are images of satyrs and nymphs in repose, holding ladles. The cauldron comes with a lid and has side handles. It sits on five little clawed feet that keep it from tipping."+
	"\n   If water is poured into the cauldron and stirred for 1 minute, it transforms into a hearty, hot stew, which can provide one nourishing meal for up to four people per gallon. The stew remains hot while in the cauldron, then cools naturally after it is removed. The outside of the cauldron remains safe to touch despite the heat of the stew."+
	"\n   The cauldron can create stew three times. It then ceases to function until the next dawn, when it regains all its uses.",
	weight : 50,
	usages : 3,
	recovery : "dawn"
};
var IDRotF_HookOfFishersDelightFullDescription = [
	"This tiny silver fishhook has a little gold feather attached to it. For it to function, the feathered hook must be tied to the end of a fishing line and immersed in enough water to fill at least a 10-foot cube. At the end of each uninterrupted hour of immersion, roll a d6. On a 6, a floppy, 6-inch-long magical fish appears on the end of the hook. The color and properties of the conjured fish are determined by rolling on the table below. Once the hook conjures a fish, it can't do so again until the next dawn.\n",
	">>d20\tFish color and result<<",
	"1-10\t>>Green with copper bands<<. This tasty fish provides a day's worth of nourishment to one creature that eats it. The fish loses this property and rots if it's not eaten within 24 hours of being caught.",
	"11-14\t>>Yellow with black stripes<<. Once removed from the hook, this awful-tasting fish can be thrown up to 120 feet, targeting a creature the thrower can see. The target must succeed on a DC 15 Strength saving throw or be knocked prone. The fish then disappears.",
	"15-18\t>>Blue with white bands<<. When released from the hook, this fish squirms free, sprouts wings, follows you around, and sings a beautiful tune in Aquan. It disappears after 2d4 hours or when reduced to 0 hit points. The fish uses the quipper stat block, except that it can breathe air and has a flying speed of 30 feet.",
	"19-20\t>>Gold with silver stripes<<. This tasty fish provides a day's worth of nourishment to one creature that eats it and grants 2d10 temporary hit points to that creature. The fish loses these properties and rots if it's not eaten within 24 hours of being caught."
];
MagicItemsList["hook of fisher's delight"] = { // contains contributions by BraabHimself
	name : "Hook of Fisher's Delight",
	source : [["RotF", 314]],
	type : "wondrous item",
	rarity : "rare",
	description : "For this tiny silver fishhook to work, I must attach it to the end of a fishing line and immerse it in at least 10 cu ft of water. Then, at the end of each uninterrupted hour of immersion, I roll a d6. On a 6, a magical fish appears on the hook; roll a d20 to determine the fish's properties on the table on the Notes page.",
	descriptionFull : IDRotF_HookOfFishersDelightFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Fish Properties Table",
		note : desc(IDRotF_HookOfFishersDelightFullDescription).replace(/>>|<</g, "").replace(/\byou\b/ig, "I").replace(/\bf(oo|ee)t\b/ig, "ft")
	}],
	usages : 1,
	recovery : "dawn"
};
MagicItemsList["lantern of tracking"] = function () { // contains contributions by BraabHimself
	var oObj = {
		name : "Lantern of Tracking",
		source : [["RotF", 314]],
		type : "wondrous item",
		rarity : "common",
		descriptionFull : [
			"This hooded lantern burns for 6 hours on 1 pint of oil, shedding bright light in a 30-foot radius and dim light for an additional 30 feet."+
			"\n   Each lantern of tracking is designed to track down a certain type of creature, which is determined by rolling on the Lantern of Tracking table. Once determined, this creature type can't be changed. While the lantern is within 300 feet of any creature of that type, its flame turns bright green. The lantern doesn't pinpoint the creature's exact location, however.\n",
			toUni("d10\tCreature Type"),
			"  1\tAberrations",
			"  2\tCelestials",
			"  3\tConstructs",
			"  4\tDragons",
			"  5\tElementals",
			"  6\tFey",
			"  7\tFiends",
			"  8\tGiants",
			"  9\tMonstrosities",
			"10\tUndead"
		].join("\n   "),
		allowDuplicates : true,
		weight : 2,
		choices : ["Aberrations", "Celestials", "Constructs", "Dragons", "Elementals", "Fey", "Fiends", "Giants", "Monstrosities", "Undead"],
		choicesNotInMenu : true
	};
	var sDescr = "This hooded lantern burns for 6 hours on 1 pint of oil, shedding bright light in a 30-ft radius and dim light for an additional 30 ft. While this lantern is within 300 ft of any CREATURE TYPE, its flame turns bright green. The lantern doesn't pinpoint the creature's exact location, however.";
	oObj.description = sDescr.replace("any CREATURE TYPE", "a specified creature type");
	for (var i = 0; i < oObj.choices.length; i++) {
		var sChoice = oObj.choices[i].toLowerCase();
		oObj[sChoice] = {
			name : "Lantern of " + oObj.choices[i] + " Tracking",
			sortname : "Lantern of Tracking, " + oObj.choices[i],
			description : sDescr.replace("CREATURE TYPE", sChoice)
		}
	}
	return oObj;
}();
MagicItemsList["professor skant"] = { // contains contributions by Pengsloth
	name : "Professor Skant",
	source : [["RotF", 315]],
	type : "wondrous item",
	rarity : "rare",
	description : "This sentient orb with the personality of a scholar has Int 18, Wis 11, Cha 9, and no will of its own. It can hear and see out to 60 ft. It knows and reads Common, Draconic, Elvish, and Loross. It has+9 on checks regarding history of Netheril, vampirism, tarrasque, and Elverquisst. It moves itself around using Mage Hand.",
	descriptionLong : "This sentient orb, which calls itself Professor Skant, has the personality of a scholar, but no will of its own to cause conflicts. It's a smooth, solid, 5 lb sphere of smoky gray quartz about the size of a grapefruit with two or more pinpricks of silver light deep inside. It's alignment is lawful good and it has Intelligence 18, Wisdom 11, and Charisma 9. It knows and reads Common, Draconic, Elvish, and Loross. It has expertise in the following academic topics (+9 on checks): history of Netheril, vampirism and the traits of vampires, rituals surrounding the making, bottling, and drinking of Elverquisst, and the tarrasque.",
	descriptionFull : "The professor orb owned by Vellynne Harpell and stolen by Nass Lantomir calls itself Professor Skant. It is lawful good, and it has a Wisdom of 11 and a Charisma of 9 (as a professor orb, it has an Intelligence of 18). It speaks and reads Common, Draconic, Elvish, and Loross (the dead language of the Empire of Netheril). Professor Skant is a chatterbox and assumes all humanoids are dunderheads. When elaborating on its areas of expertise, it adopts an unintentionally patronizing tone. It has the following four areas of expertise:"+
	"\n \u2022 The history of Netheril (see the \"Fate of Netheril\" sidebar)"+
	"\n \u2022 Vampirism and the traits of vampires"+
	"\n \u2022 Rituals surrounding the making, bottling, and drinking of Elverquisst (a rare, ruby-colored elven liquor distilled from sunshine and rare summer fruits)"+
	"\n \u2022 The tarrasque (see the Monster Manual)"+
	"When making an Intelligence check to recall lore from any of its areas of expertise, the orb has a +9 bonus to its roll (including its Intelligence modifier)."+
	"\n   Professor Skant takes the form of a smooth, solid, 5-pound sphere of smoky gray quartz about the size of a grapefruit. Close examination reveals two or more pinpricks of silver light deep inside the sphere."+
	"\n   Professor Skant can see and hear normally out to a range of 60 feet. Unlike most sentient items, the orb has no will of its own and can't initiate a conflict with the creature in possession of it."+
	"\n   In addition to the knowledge it possesses, Professor Skant can cast the mage hand cantrip at will. It uses the spell only to transport itself. Its spellcasting ability is Intelligence."
};
MagicItemsList["psi crystal"] = { // contains contributions by BraabHimself
	name : "Psi Crystal",
	source : [["RotF", 315]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a creature with an intelligence score of 3 or higher",
	prereqeval : function(v) { return Number(What("Int")) >= 3; },
	description : "While attuned to this orb, it glows with an inner purplish light and gives me telepathy. The range of telepathy and intensity of light are determined by my Intelligence score.",
	descriptionFull : "This crystal grants you telepathy for as long as you remain attuned to it. See the introduction of the Monster Manual for rules on how this telepathy works."+
	"\n   The crystal also glows with a purplish inner light while you are attuned to it."+
	"\n   The higher your intelligence, the greater the light's intensity and the greater the range of the telepathy (see the table below)."+
	toUni("\n\nIntelligence\tRange of   \tLight"+
	"\n    Score\t\tTelepathy  \tIntensity")+
	"\n      3-7\t\t  15 feet\t\tDim light out to a range of 5 ft"+
	"\n      8-11\t\t  30 feet\t\tBright light in a 5-ft radius and dim light for an additional 5 ft"+
	"\n    12-15\t\t  60 feet\t\tBright light in a 10-ft radius and dim light for an additional 10 ft"+
	"\n    16 or higher\t 120 feet\t\tBright light in a 15-ft radius and dim light for an additional 15 ft",
	weight : 3,
	choices : ["Intelligence   3-7", "Intelligence   8-11", "Intelligence 12-15", "Intelligence 16 or higher"],
	selfChoosing : function () {
		var iInt = Number(What("Int"));
		return iInt >= 16 ? "intelligence 16 or higher" : iInt >= 12 ? "intelligence 12-15" : iInt >= 8 ? "intelligence   8-11" : "intelligence   3-7";
	},
	"intelligence   3-7" : {
		name : "Psi Crystal (Int 3-7)",
		description : "While attuned to this orb, it glows with an inner purplish light, dim light out to a range of 5 ft. It also grants me telepathy out to a range of 15 ft. The range of telepathy and intensity of light are determined by my Intelligence score."
	},
	"intelligence   8-11" : {
		name : "Psi Crystal (Int 8-11)",
		description : "While attuned to this orb, it glows with an inner purplish light, bright light in a 5-ft radius and dim light for an additional 5 ft. It also grants me telepathy out to a range of 30 ft. The range of telepathy and intensity of light are determined by my Intelligence score."
	},
	"intelligence 12-15" : {
		name : "Psi Crystal (Int 12-15)",
		description : "While attuned to this orb, it glows with an inner purplish light, bright light in a 10-ft radius and dim light for an additional 10 ft. It also grants me telepathy out to a range of 60 ft. The range of telepathy and intensity of light are determined by my Intelligence score."
	},
	"intelligence 16 or higher" : {
		name : "Psi Crystal (Int 16+)",
		description : "While attuned to this orb, it glows with an inner purplish light, bright light in a 15-ft radius and dim light for an additional 15 ft. It also grants me telepathy out to a range of 120 ft. The range of telepathy and intensity of light are determined by my Intelligence score."
	}
};
MagicItemsList["scroll of tarrasque summoning"] = { // contains contributions by BraabHimself
	name : "Scroll of Tarrasque Summoning",
	source : [["RotF", 315]],
	type : "scroll",
	rarity : "legendary",
	description : "Once as an action, I can use this to cause the tarrasque to appear in an unoccupied space I can see within 1 mile. The tarrasque disappears when it drops to 0 hit points and is hostile toward all creatures other than itself.",
	descriptionFull : "Using an action to read the scroll causes the tarrasque (see the creature's entry in the Monster Manual) to appear in an unoccupied space you can see within 1 mile of you. The tarrasque disappears when it drops to 0 hit points and is hostile toward all creatures other than itself."
};
MagicItemsList["scroll of the comet"] = { // contains contributions by BraabHimself
	name : "Scroll of the Comet",
	source : [["RotF", 315]],
	type : "scroll",
	rarity : "legendary",
	description : "Once as an action outdoors, I can use this to cause a comet to fall on a point I can see within 1 mile, creating a 50-ft deep, 500-ft radius crater. All creatures in the radius take 30d10 force damage and can make a DC 20 Dex save to halve this damage. It destroys all nonmagical objects and structures within the area.",
	descriptionFull : "By using an action to read the scroll, you cause a comet to fall from the sky and crash to the ground at a point you can see up to 1 mile away from you. You must be outdoors when you use the scroll, or nothing happens and the scroll is wasted."+
	"\n   The comet creates a 50-foot-deep, 500-foot-radius crater on impact. Any creature in that radius must make a DC 20 Dexterity saving throw, taking 30d10 force damage on a failed saving throw, or half as much damage on a successful one. All structures in the crater are destroyed, as are all nonmagical objects that aren't being worn or held."
};
MagicItemsList["thermal cube"] = { // contains contributions by BraabHimself
	name : "Thermal Cube",
	source : [["RotF", 316]],
	type : "wondrous item",
	rarity : "common",
	description : "This 3-inch cube of solid brimstone generates enough dry heat to keep the temperature within 15 ft of it at 95 degrees Fahrenheit.",
	descriptionFull : "This 3-inch cube of solid brimstone generates enough dry heat to keep the temperature within 15 feet of it at 95 degrees Fahrenheit (35 degrees Celsius)."
};
MagicItemsList["ythryn mythallar"] = { // contains contributions by BraabHimself
	name : "Ythryn Mythallar",
	source : [["RotF", 316]],
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "This 50 ft diameter crystal ball sheds light in a 300 ft radius and dim light for an additional 300 ft. Up to 8 creatures can attune to it at one time, a 9th creature's attunement fails. All those attuned to it can sense when it is used and they all must agree to any properties being used. See Notes page.",
	descriptionFull : "A mythallar looks like an enormous crystal ball held in an ornate cradle. The globe sheds bright light in a 300-foot radius and dim light for an additional 300 feet. The globe draws magic from the Weave that can be harnessed for various purposes. For example, Netherese mages used mythallars to keep their cities aloft and empower their magic items. The bigger the mythallar, the more magic it can hold. The largest mythallars are 150 feet in diameter."+
	"\n   The Ythryn mythallar is a relatively small device\u2014a mere 50 feet in diameter. To attune to this mythallar, a creature must finish a short rest within 30 feet of it, meditating on the mythallar. Up to eight creatures can be attuned to it at one time; otherwise, the Ythryn mythallar follows the attunement rules in the Dungeon Master's Guide. If a ninth creature tries to attune to the mythallar, nothing happens."+
	"\n   All creatures attuned to the Ythryn mythallar can sense when the device is being used. A creature attuned to the device can use any of its properties, but only if all other creatures attuned to the device agree to allow it. The Ythryn mythallar's properties are as follows:"+
	"\n    \u2022 While you're on the same plane of existence as the Ythryn mythallar, you can use an action to cause it to fly in any direction you choose at a speed of 30 feet. All matter within 500 feet of the device moves with it. The Ythryn mythallar and all structures held aloft by it hover in place when not in motion."+
	"\n   \u2022 As an action, you can cause one magic item you are holding within 30 feet of the Ythryn mythallar to immediately regain all its expended charges or uses. A magic item recharged in this manner can't be recharged by the Ythryn mythallar again until after the item regains expended charges or uses on its own."+
	"\n   \u2022 You can use the Ythryn mythallar to cast the control weather spell without requiring any components and without the need for you to be outdoors. This casting of the spell has a 50-mile radius. For the duration of the spell's casting time, you must be within 30 feet of the Ythryn mythallar or the spell fails."+
	"\n" + toUni("Touching the Mythallar") + ". Any creature that touches the globe of the mythallar must make a DC 22 Constitution saving throw, taking 180 (20d10 + 70) radiant damage on a failed save, or half as much damage on a successful one. Undead have disadvantage on this saving throw. Any object that touches the globe, other than an artifact or the mythallar's cradle, is disintegrated instantly (no save).",
	toNotesPage : [{
		name : "Properties",
		note : [
			"The Ythryn Mythallar is a 50 ft diameter crystal ball that sits on a cradle",
			"It has the following properties:",
			"\u2022 Sheds light in a 300 ft radius and dim light for an additional 300 ft",
			"\u2022 Up to 8 creatures can attune to it, a 9th attunement fails",
			"\u2022 To attune, a creature must short rest within 30 ft of it",
			"\u2022 All those attuned to it can sense when sense when it is being used",
			"\u2022 All those attuned must agree to allow any properties to be used",
			"\u2022 You can use an action to use the Ythryn Mythallar in the following ways:",
			"  \u25E6 While on the same plane, give it a flying speed of 30 ft",
			"    All matter within 500 ft of it moves with it",
			"    The ball and all structures held aloft by it hover in place when not in motion",
			"  \u25E6 Cause one magic item to regain all charges/uses",
			"    I must be within 30 ft of the ball and holding the item",
			"    It cannot be recharged again until all charges/uses are expended",
			"  \u25E6 Cast the control weather spell without components or spell slots",
			"    It has a radius of 50 miles and can be cast inside",
			"    I must be within 30 ft of the ball for the casting time, or it will fail",
			"\nTOUCHING THE MYTHALLAR",
			"Any creature that touches the ball must make a DC 22 Constitution save",
			"On a failure, they take 20d10 + 70 radiant damage, or half that on a success",
			"Undead have disadvantage on this saving throw",
			"Objects touching the ball, except artifacts or the cradle, disintegrate instantly"
		]
	}]
};
MagicItemsList["the codicil of white"] = {
	name : "The Codicil of White",
	source : [["RotF", 317]],
	type : "wondrous item",
	rarity : "",
	notLegalAL : true,
	description : 'This volume bound in white fur, sealed with a silver lock, containing velum pages with silver edges is cold to the touch. While I have this tome in my possession, I gain resistance to cold damage. It contains the Frost Fingers spell which a wizard can learn and a poem incantation "Rime of the Frostmaiden".',
	descriptionFull : "The Codicil of White is a tall, thin volume bound in white ermine fur over seasoned boards of white pine and sealed with a clasp and lock of tarnished silver. The book is cold to the touch, and the fur is worn about the edges from use. The twenty-seven pages within are of vellum painted with silver gilt on the outer edges. The whole is sewn to a leather binding with strips of sinews, making it quite durable."+
	"\n   A creature with the codicil in its possession has resistance to cold damage."+
	"\n   The codicil was written by followers of Auril as a primer on her worship. The first page is a title page with the snowflake symbol of Auril on it. The remaining pages describe various priestly rituals and ceremonies in chilling detail. Nestled among these descriptions is a spell that wizards can learn (frost fingers, and a poem called \"Rime of the Frostmaiden\", see appendix E of Icewind Dale: Rime of the Frostmaiden). The poem is an incantation, the power of which can be used to split a glacier (see chapter 6 of Icewind Dale: Rime of the Frostmaiden). The poem might have other capabilities, at the DM's discretion",
	dmgres : ["Cold"],
	weight : 3
};
// Spells
SpellsList["blade of disaster"] = {
	name : "Blade of Disaster",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["T", 106], ["RotF", 318]],
	level : 9,
	school : "Conj",
	time : "1 bns",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "Create weapon; 2 spell atks 4d12 Force dmg; crit on 18+, triple dmg; bns a to move 30 ft \u0026 do 2 atks",
	descriptionShorter : "Create wea; 2 spell atks 4d12 Force dmg; crit 18+, triple dmg; bns a to move 30 ft \u0026 2 atks",
	descriptionFull : "You create a blade-shaped planar rift about 3 feet long in an unoccupied space you can see within range. The blade lasts for the duration. When you cast this spell, you can make up to two melee spell attacks with the blade, each one against a creature, loose object, or structure within 5 feet of the blade. On a hit, the target takes 4d12 force damage. This attack scores a critical hit if the number on the d20 is 18 or higher. On a critical hit, the blade deals an extra 8d12 force damage (for a total of 12d12 force damage)."+
	"\n   As a bonus action on your turn, you can move the blade up to 30 feet to an unoccupied space you can see and then make up to two melee spell attacks with it again."+
	"\n   The blade can harmlessly pass through any barrier, including a wall of force."
};
SpellsList["create magen"] = { // contains contributions by BraabHimself
	name : "Create Magen",
	source : [["RotF", 318]],
	classes : ["wizard"],
	level : 7,
	school : "Trans",
	time : "1 h",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "A vial of quicksilver worth 500 gp and a life-sized human doll, both of which the spell consumes, and an intricate crystal rod worth at least 1,500 gp that is not consumed",
	duration : "Instantaneous",
	description : "Transform doll into magen (500gp cons.); obeys me; my HP max reduced by its CR; see book (1.5k gp)",
	descriptionFull : "While casting the spell, you place a vial of quicksilver in the chest of a life-sized human doll stuffed with ash or dust. You then stitch up the doll and drip your blood on it. At the end of the casting, you tap the doll with a crystal rod, transforming it into a magen clothed in whatever the doll was wearing. The type of magen is chosen by you during the casting of the spell. See appendix C for different kinds of magen and their statistics."+
	"\n   When the magen appears, your hit point maximum decreases by an amount equal to the magen's challenge rating (minimum reduction of 1). Only a wish spell can undo this reduction to your hit point maximum."+
	"\n   Any magen you create with this spell obeys your commands without question."
};
SpellsList["frost fingers"] = { // contains contributions by BraabHimself
	name : "Frost Fingers",
	source : [["RotF", 318]],
	classes : ["wizard"],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "S:15" + (typePF ? "-" : "") + "ft cone",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "All in area 2d8+1d8/SL Cold dmg; save halves; unattended nonmagical liquids freeze",
	descriptionFull : "Freezing cold blasts from your fingertips in a 15-foot cone. Each creature in that area must make a Constitution saving throw, taking 2d8 cold damage on a failed save, or half as much damage on a successful one."+
	"\n   The cold freezes nonmagical liquids in the area that aren't being worn or carried."+
	AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st."
};

// pub_20201117-2_TCoE-sidekicks.js
// This file adds the sidekick classes from Tasha's Cauldron of Everything (p142-147) to MPMB's Character Record Sheet

/* - NOTICE -
	These sidekick classes are available as normal classes because the sheet doesn't support classes for the companion page

	These classes are excluded by default so that they aren't confused with normal classes

	The base 1/2 CR creature will have to be added manually
	It would be too complex and messy to add them all as racial options
*/

// Define the source, if it doesn't yet exist
if (!SourceList.T) {
	SourceList.T = {
		name : "Tasha's Cauldron of Everything",
		abbreviation : "TCoE",
		abbreviationSpellsheet : "T",
		group : "Primary Sources",
		url : "https://dnd.wizards.com/products/tashas-cauldron-everything",
		date : "2020/11/17"
	};
}

// Define some functions here, so we an use them for all sidekick classes without duplication
global_TCoE_Sidekick_fn = {
	// prereqeval runs before any of the other class stuff is added, so we can even modify the ClassList object with it to set the HD
	prereqeval : function(v) {
		var sClass = v['class'];
		var sSubclass = v.subclass;
		var sClassOld = CurrentVars.sidekickDialogShown === undefined ? false : CurrentVars.sidekickDialogShown[0];
		// If we already did this function for this (sub)class, stop now
		if (CurrentVars.sidekickDialogShown && CurrentVars.sidekickDialogShown[0] === sClass && (!CurrentVars.sidekickDialogShown[1] || CurrentVars.sidekickDialogShown[1] === sSubclass)) {
			// if no subclass was defined when previously calling this, but now there is one selected, add that to the CurrentVars
			if (!CurrentVars.sidekickDialogShown[1] && sSubclass) {
				CurrentVars.sidekickDialogShown[1] = sSubclass;
				SetStringifieds("vars");
			}
			return true;
		}
		// Tell the player what is about to happen and give an option to opt-out
		var sClassName = ClassList[sClass].name.replace(/\(?sidekick\)?/i, '').trim();
		var warningMsg = {
			nIcon : 3, // Status
			nType : 2, // Yes,No
			cTitle : "Creating a Sidekick Works Differently",
			cMsg : "You are about to create a character with a " + sClassName + " sidekick class. Sidekick classes use the rules as described in Tasha's Cauldron of Everything, page 142. As this character sheet is intended for regular, non-sidekick classes, some changes will be made that you need to be aware off:"
		};
		var lineNo = 1;
		[
			"A sidekick class is added to a creature of CR 1/2 or lower. Before continuing, lookup the stat block of the base creature you would like to use. You will have to manually enter its:"+
				"\n   \u2022 Ability scores"+
				"\n   \u2022 Proficiencies for: skills, saving throws, weapons, armor, languages, and tools"+
				"\n   \u2022 Attacks (tip: use Modifier fields for attacks that aren't weapons/cantrips)"+
				"\n   \u2022 Hit dice (you will be prompted to enter)",
				sClass.indexOf('warrior') !== -1 ? false : 'To gain either the Expert of Spellcaster sidekick class, a creature must have at least one language in its stat block that it can speak.',
			'If you continue, the race and background automation will be turned off and the respective fields emptied. You can use these fields to enter the name and type of the base creature.'+
				'\nFor example. when using the bandit stat block, you could enter:'+
				'\n   \u2022 Race: Elf'+
				'\n   \u2022 Background: Bandit'+
				'\nYou can turn the automation back on with the "Auto/Manual" bookmark.',
			"Sidekicks don't use experience points, but gain levels as the average level of the group goes up. Thus, simply ignore the experience points box and change the level when needed.",
			"Sidekick classes can't multiclass and haven't been tested to work that way."
		].forEach(function (line) {
			if (!line) return;
			warningMsg.cMsg += "\n\n" + lineNo + ". " + line;
			lineNo++;
		});
		warningMsg.cMsg += "\n\n\n>>> Do you want to continue making a sidekick? <<<";
		warningMsg.cMsg += "\n\nIf you select 'No', the " + v.classlevel + " level(s) of this class will be counted towards the total character level, but none of its features will be added.";
		if (app.alert(warningMsg) !== 4) return 'skip';
		// Save that this dialog has been shown
		CurrentVars.sidekickDialogShown = [sClass, sSubclass];
		// Remove race and background, and set them to manual
		global_TCoE_Sidekick_fn.manualRaceBackground();
		// if the sidekick HD is already defined, delete those HD first before applying the new one
		if (CurrentVars.sidekickHD && sClassOld && classes.old[sClassOld]) {
			global_TCoE_Sidekick_fn.eval([classes.old[sClassOld].classlevel, 0], false, false, true);
		};
		// Ask the player to enter the number and type of HD the creature has in its stat block
		CurrentVars.sidekickHD = AskUserOptions(
			"Set Base Creature Hit Dice", // title
			"Enter the number and type of hit dice that the chosen base creature has in its stat block (i.e. without bonuses from sidekick levels).\nThe sidekick will gain 1 extra HD for each level it gains after the first.", // top explanation
			['Number of hit dice, for example "2"', 'Size of the hit dice, for example "d8"'],
			false, true,
			"Be aware that you *can't* change the *size* of the hit die (e.g. d8) at a later time. To do that, you will have to first remove the sidekick class completely.\n\nHowever, you *can* change the *number* of hit dice manually by editing the appropriate field." // bottom explanation
		).map(function (n, idx) {
			var a = n.replace(/.*?(\d+).*/, "$1");
			return !isNaN(a) ? Number(a) : idx === 0 ? 2 : 8;
		});
		ClassList[sClass].die = CurrentVars.sidekickHD[1];
		CurrentClasses[sClass].die = CurrentVars.sidekickHD[1];
		SetStringifieds("vars");
	},
	// Change the race and background to manual or auto
	manualRaceBackground : function(bAuto) {
		if (bAuto && (CurrentVars.manual.background || CurrentVars.manual.race)) {
			// set to automatic
			if (CurrentVars.manual.background) {
				Value("Background", "");
				SetToManual_Dialog.mBac = false;
			}
			if (CurrentVars.manual.race) {
				Value("Race", "");
				SetToManual_Dialog.mRac = false;
			}
			SetToManual_Button(true);
		} else if (!bAuto) {
			// set to manual
			if (CurrentVars.manual.race || CurrentVars.manual.background || CurrentVars.manual.backgroundFeature) {
				// if currently already set to manual, set to auto before emptying the fields
				IsNotImport = false;
				ignorePrereqs = true;
				SetToManual_Dialog.mBac = false;
				SetToManual_Dialog.mBFe = false;
				SetToManual_Dialog.mRac = false;
				SetToManual_Button(true);
				IsNotImport = true;
				ignorePrereqs = false;
			};
			// Remove the race and background
			if (CurrentRace.known) Value("Race", "");
			if (CurrentBackground.known) Value("Background", "");
			// Set race and background to manual
			SetToManual_Dialog.mRac = true;
			SetToManual_Dialog.mBac = true;
			SetToManual_Button(true);
		}
	},
	// When removing a sidekick class, return some stuff to normal
	removeeval : function(lvl) {
		// This could be called after the dialog was shown for another sidekick, so check if there is actually something to do
		var sClass = CurrentVars.sidekickDialogShown ? CurrentVars.sidekickDialogShown[0] : false;
		var sSubclass = CurrentVars.sidekickDialogShown ? CurrentVars.sidekickDialogShown[1] : false;
		if (!sClass || !classes.known[sClass] || classes.known[sClass].level ||
			(classes.old[sClass] && classes.old[sClass].subclass && classes.old[sClass].subclass !== sSubclass)
			) return;
		// Remove the extra sidekickHD and delete it from the CurrentVars
		global_TCoE_Sidekick_fn.eval(lvl, false, false, true);
		delete CurrentVars.sidekickHD;
		delete CurrentVars.sidekickDialogShown;
		SetStringifieds("vars");
		// Reset race and background to auto (if not already)
		global_TCoE_Sidekick_fn.manualRaceBackground(true);
	},
	// After the HD has been set, we still need to enter the bonus HD, if any (this can't be done with the prereqeval)
	eval : function(lvl, chc, undef, bRemove) {
		var hd = CurrentVars.sidekickHD;
		var extraHD = hd[0] - 1;
		if (isNaN(extraHD) || extraHD < 1) return;
		var totalHD = bRemove ? lvl[0] : lvl[1] + extraHD;
		var expectedHD = bRemove ? lvl[0] + extraHD : lvl[1];
		// Add the extra HD to the field
		for (var i = 1; i <= 3; i++) {
			var dieFld = "HD" + i + " Die";
			var lvlFld = "HD" + i + " Level";
			if (What(dieFld) == hd[1] && What(lvlFld) == expectedHD) {
				Value(lvlFld, totalHD);
				CurrentUpdates.types.push("hp");
				break;
			}
		}
	},
	calcChanges_hp : function (totalHD, HDobj) {
		// remove 1st level max (and change its average and fixed value to reflect this change)
		var hd = CurrentVars.sidekickHD[1];
		var matchRegex = RegExp('(\\d+)(d' + hd + ' \\()(\\d+\\.?\\d+?)\\)');
		var match = HDobj.dieStr[1] ? HDobj.dieStr[1].match(matchRegex) : false;
		if (!match) return;
		var hdAverage = hd / 2 + 0.5;
		var hdFixed = Math.ceil(hdAverage);
		HDobj.dieStr.shift();
		HDobj.average += hdAverage - hd;
		HDobj.fixed += hdFixed - hd;
		HDobj.dieStr[0] = HDobj.dieStr[0].replace(matchRegex, (Number(match[1]) + 1) + match[2] + (Number(match[3]) + hdAverage) + ") [sidekicks don't get max for 1st level]");
	},
	spellcasting_additional : levels.map(function (n, idx) {
		var cantr = [2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4][idx];
		var splls = [1, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9,10,10,11,11][idx];
		return cantr + " cantrips \u0026 " + splls + " spells known";
	})
}

// Add the three classes
ClassList["sidekick-expert-tcoe"] = {
	defaultExcluded : true,
	prereqeval : global_TCoE_Sidekick_fn.prereqeval,
	regExpSearch : /^(?=.*expert)(?=.*sidekick).*$/i,
	name : "Expert (sidekick)",
	source : [["T", 143]],
	primaryAbility : "Dexterity, Intelligence, or Charisma",
	prereqs : "Can't multiclass",
	improvements : levels.map(function (n) {
		return n < 4 ? 0 : n < 8 ? 1 : n < 10 ? 2 : n < 12 ? 3 : n < 16 ? 4 : n < 19 ? 5 : 6;
	}),
	die : CurrentVars.sidekickHD ? CurrentVars.sidekickHD[1] : 8,
	skillstxt : {
		primary : "Choose any five skills"
	},
	armorProfs : {
		primary : [true, false, false, false]
	},
	equipment : "",
	subclasses : ["", []],
	attacks : [1],
	features : {
		"a sidekick" : {
			name : "A Sidekick",
			source : [["T", 142]],
			minlevel : 1,
			description : desc([
				"A sidekick can be any creature with challenge rating of 1/2 or lower",
				"The Spellcaster and Expert classes can only apply to creatures that can speak a language",
				"Fill out the stats block into the character sheet manually, the class adds to it",
				"The sidekick's level is the same as the average level of the group",
				"The hit dice of a sidekick are the same as those of the base creature, gaining +1 per level",
				"A sidekick does not get the benefits of a background, nor can it take feats or multiclass"
			]),
			calcChanges : {
				hp : global_TCoE_Sidekick_fn.calcChanges_hp
			},
			eval : global_TCoE_Sidekick_fn.eval,
			removeeval : global_TCoE_Sidekick_fn.removeeval
		},
		"bonus proficiencies: saving throws" : {
			name : "Bonus Proficiencies: Saving Throws",
			source : [["T", 143]],
			minlevel : 1,
			description : desc('Choose Dex, Int, or Cha save proficiency, using the "Choose Feature" button above'),
			choices : ["Dexterity", "Intelligence", "Charisma"],
			"dexterity" : {
				name : "Bonus Proficiencies: Dexterity Saving Throws",
				description : desc("I am proficient in Dexterity saving throws"),
				saves : ["Dex"]
			},
			"intelligence" : {
				name : "Bonus Proficiencies: Intelligence Saving Throws",
				description : desc("I am proficient in Intelligence saving throws"),
				saves : ["Int"]
			},
			"charisma" : {
				name : "Bonus Proficiencies: Charisma Saving Throws",
				description : desc("I am proficient in Charisma saving throws"),
				saves : ["Cha"]
			}
		},
		"bonus proficiencies" : {
			name : "Bonus Proficiencies",
			source : [["T", 143]],
			minlevel : 1,
			description : desc([
				"I gain proficiency with light armor and in five skills of my choice",
				'If the base creature is a Humanoid or has a simple or martial weapon in its stat block,',
				'select it using the "Choose Feature" button above, so I gain more bonus proficiencies'
			]),
			choices : ["Base creature is a Humanoid or has a simple or martial weapon in its stat block", "Other base creatures"],
			"base creature is a humanoid or has a simple or martial weapon in its stat block" : {
				name : "Bonus Proficiencies: Humanoid",
				description : desc([
					"I gain proficiency with light armor and in five skills of my choice",
					"Additionally, I gain proficiency with two tools of my choice and with all simple weapons"
				]),
				weaponProfs : [true, false],
				toolProfs : [["Tool of my choice", 2]]
			},
			"other base creatures" : {
				name : "Bonus Proficiencies: Non-humanoid",
				description : desc("I gain proficiency with light armor and in five skills of my choice")
			}
		},
		"helpful" : {
			name : "Helpful",
			source : [["T", 143]],
			minlevel : 1,
			description : desc("I can use a bonus action to take the Help action"),
			action : [["bonus action", ""]]
		},
		"cunning action" : {
			name : "Cunning Action",
			source : [["T", 143]],
			minlevel : 2,
			description : desc("I can use a bonus action to take the Dash, Disengage, or Hide action"),
			action : [["bonus action", ""]]
		},
		"expertise" : function() {
			var a = {
				name : "Expertise",
				source : [["T", 143]],
				minlevel : 3,
				description : desc([
					"I gain expertise with two skills I am proficient with",
					"At level 15th, I gain expertise with two more skills I am proficient with"
				]),
				skillstxt : "Expertise with any two skill proficiencies, two more at level 15th",
				extraname : "Expertise",
				extrachoices : ["Acrobatics", "Animal Handling", "Arcana", "Athletics", "Deception", "History", "Insight", "Intimidation", "Investigation", "Medicine", "Nature", "Perception", "Performance", "Persuasion", "Religion", "Sleight of Hand", "Stealth", "Survival"],
				extraTimes : levels.map(function (n) { return n < 3 ? 0 : n < 15 ? 2 : 4; })
			}
			for (var i = 0; i < a.extrachoices.length; i++) {
				var attr = a.extrachoices[i].toLowerCase();
				a[attr] = {
					name : a.extrachoices[i] + " Expertise",
					description : "",
					source : a.source,
					skills : [[a.extrachoices[i], "only"]],
					prereqeval : function(v) {
						return v.skillProfsLC.indexOf(v.choice) === -1 ? false : v.skillExpertiseLC.indexOf(v.choice) === -1 ? true : "markButDisable";
					}
				}
			}
			return a;
		}(),
		"ability score improvement" : {
			name : "Ability Score Improvement",
			source : [["T", 144]],
			minlevel : 4,
			description : desc([
				"Increase one ability score by 2, or two ability scores by 1, up to a maximum of 20",
				"I gain this at 4th level and again at 8th, 10th, 12th, 16th, and 19th level"
			]),
			additional : levels.map(function (n) {
				return n < 4 ? "" : (n < 8 ? 1 : n < 10 ? 2 : n < 12 ? 3 : n < 16 ? 4 : n < 19 ? 5 : 6) + "\xD7 2 points increase";
			})
		},
		"coordinated strike" : {
			name : "Coordinated Strike",
			source : [["T", 144]],
			minlevel : 6,
			description : desc([
				"I can use Helpful to aid an ally to attack a creature up to 30 ft away from me",
				"If I do so, I add +2d6 damage on my next attack to that creature in the current turn"
			])
		},
		"evasion" : {
			name : "Evasion",
			source : [["T", 144]],
			minlevel : 7,
			description : desc([
				"If an effect allows me to make a Dex save for half damage, I take no damage on a success",
				"Also, I only take half damage on a failed save; I can't do this while incapacitated"
			]),
			savetxt : { text : ["Dex save vs. area effects: fail \u2015 half dmg, success \u2015 no dmg"] }
		},
		"inspiring help" : {
			name : "Inspiring Help",
			source : [["T", 144]],
			minlevel : 11,
			description : desc([
				"When I use the Help action, the creature that receives the help adds +1d6 to its d20 roll",
				"If it was an attack roll that hits without the +1d6, it can add it to the damage instead",
				"At 20th level, this bonus increases to 2d6"
			]),
			additional : levels.map(function (n) {
				return n < 11 ? "" : "+" + (n < 20 ? 1 : 2) + "d6 bonus";
			})
		},
		"reliable talent" : {
			name : "Reliable Talent",
			source : [["T", 144]],
			minlevel : 14,
			description : desc("If I make an ability check where I add my proficiency bonus, rolls of 9 or lower are 10")
		},
		"sharp mind" : {
			name : "Sharp Mind",
			source : [["T", 144]],
			minlevel : 18,
			description : desc('Choose Int, Wis, or Cha save proficiency, using the "Choose Feature" button above'),
			choices : ["Intelligence", "Wisdom", "Charisma"],
			"intelligence" : {
				name : "Sharp Mind: Intelligence",
				description : desc("I gain proficiency in Intelligence saving throws"),
				saves : ["Int"],
				prereqeval : function(v) { return tDoc.getField("Int ST Prof").isBoxChecked(0) ? false : true; }
			},
			"wisdom" : {
				name : "Sharp Mind: Wisdom",
				description : desc("I gain proficiency in Wisdom saving throws"),
				saves : ["Wis"],
				prereqeval : function(v) { return tDoc.getField("Wis ST Prof").isBoxChecked(0) ? false : true; }
			},
			"charisma" : {
				name : "Sharp Mind: Charisma",
				description : desc("I gain proficiency in Charisma saving throws"),
				saves : ["Cha"],
				prereqeval : function(v) { return tDoc.getField("Cha ST Prof").isBoxChecked(0) ? false : true; }
			}
		}
	}
}
ClassList["sidekick-spellcaster-tcoe"] = {
	defaultExcluded : true,
	prereqeval : global_TCoE_Sidekick_fn.prereqeval,
	regExpSearch : /^(?=.*(spellcaster|mage|healer|prodigy))(?=.*sidekick).*$/i,
	name : "Spellcaster (sidekick)",
	source : [["T", 144]],
	primaryAbility : "Intelligence, Wisdom, or Charisma",
	prereqs : "Can't multiclass",
	improvements : levels.map(function (n) {
		return n < 4 ? 0 : n < 8 ? 1 : n < 12 ? 2 : n < 16 ? 3 : n < 18 ? 4 : 5;
	}),
	die : CurrentVars.sidekickHD ? CurrentVars.sidekickHD[1] : 8,
	skillstxt : {
		primary : "Choose two from Arcana, History, Insight, Investigation, Medicine, Performance, Persuasion, and Religion"
	},
	armorProfs : {
		primary : [true, false, false, false]
	},
	equipment : "",
	subclasses : ["Spellcaster's Role", []],
	attacks : [1],
	abilitySave : 4,
	spellcastingFactor : 2,
	spellcastingTable : ClassList.artificer && ClassList.artificer.spellcastingTable ? ClassList.artificer.spellcastingTable : [[0, 0, 0, 0, 0, 0, 0, 0, 0]].concat(levels.map(function (n) {
		return defaultSpellTable[Math.ceil(n / 2)];
	})),
	spellcastingList : {
		"class" : "wizard",
		level : [0, 5]
	},
	spellcastingKnown : {
		cantrips : [2, 2, 2, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
		spells :   [1, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9,10,10,11,11]
	},
	features : {
		"a sidekick" : {
			name : "A Sidekick",
			source : [["T", 142]],
			minlevel : 1,
			description : desc([
				"A sidekick can be any creature with challenge rating of 1/2 or lower",
				"The Spellcaster and Expert classes can only apply to creatures that can speak a language",
				"Fill out the stats block into the character sheet manually, the class adds to it",
				"The sidekick's level is the same as the average level of the group",
				"The hit dice of a sidekick are the same as those of the base creature, gaining +1 per level",
				"A sidekick does not get the benefits of a background, nor can it take feats or multiclass"
			]),
			calcChanges : {
				hp : global_TCoE_Sidekick_fn.calcChanges_hp
			},
			eval : global_TCoE_Sidekick_fn.eval,
			removeeval : global_TCoE_Sidekick_fn.removeeval
		},
		"bonus proficiencies: saving throws" : {
			name : "Bonus Proficiencies: Saving Throws",
			source : [["T", 144]],
			minlevel : 1,
			description : desc('Choose Int, Wis, or Cha save proficiency, using the "Choose Feature" button above'),
			choices : ["Intelligence", "Wisdom", "Charisma"],
			"intelligence" : {
				name : "Bonus Proficiencies: Intelligence Saving Throws",
				description : desc("I am proficient in Intelligence saving throws"),
				saves : ["Int"]
			},
			"wisdom" : {
				name : "Bonus Proficiencies: Wisdom Saving Throws",
				description : desc("I am proficient in Wisdom saving throws"),
				saves : ["Wis"]
			},
			"charisma" : {
				name : "Bonus Proficiencies: Charisma Saving Throws",
				description : desc("I am proficient in Charisma saving throws"),
				saves : ["Cha"]
			}
		},
		"bonus proficiencies" : {
			name : "Bonus Proficiencies",
			source : [["T", 144]],
			minlevel : 1,
			description : desc([
				"I gain proficiency with light armor and two skills of my choice from the following list:",
				"Arcana, History, Insight, Investigation, Medicine, Performance, Persuasion, and Religion",
				'If the base creature is a Humanoid or has a simple or martial weapon in its stat block,',
				'select it using the "Choose Feature" button above, so I gain more bonus proficiencies'
			]),
			choices : ["Base creature is a Humanoid or has a simple or martial weapon in its stat block", "Other base creatures"],
			"base creature is a humanoid or has a simple or martial weapon in its stat block" : {
				name : "Bonus Proficiencies: Humanoid",
				description : desc([
					"I gain proficiency with light armor and two skills of my choice from the following list:",
					"Arcana, History, Insight, Investigation, Medicine, Performance, Persuasion, and Religion",
					"Additionally, I gain proficiency with all simple weapons"
				]),
				weaponProfs : [true, false]
			},
			"other base creatures" : {
				name : "Bonus Proficiencies: Non-humanoid",
				description : desc([
					"I gain proficiency with light armor and two skills of my choice from the following list:",
					"Arcana, History, Insight, Investigation, Medicine, Performance, Persuasion, and Religion"
				])
			}
		},
		"subclassfeature1" : {
			name : "Spellcaster's Role",
			source : [["T", 144]],
			minlevel : 1,
			description : desc('Choose the role of the sidekick, mage, healer, or prodigy, and put it in the "Class" field')
		},
		"ability score improvement" : {
			name : "Ability Score Improvement",
			source : [["T", 146]],
			minlevel : 4,
			description : desc([
				"Increase one ability score by 2, or two ability scores by 1, up to a maximum of 20",
				"I gain this at 4th level and again at 8th, 12th, 16th, and 18th level"
			]),
			additional : levels.map(function (n) {
				return n < 4 ? "" : (n < 8 ? 1 : n < 12 ? 2 : n < 16 ? 3 : n < 18 ? 4 : 5) + "\xD7 2 points increase";
			})
		},
		"potent cantrips" : {
			name : "Potent Cantrips",
			source : [["T", 146]],
			minlevel : 6,
			description : desc("I add my spellcasting ability modifier to the damage I deal with any cantrip"),
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						var subclass = classes.known["sidekick-spellcaster-tcoe"].subclass;
						if (!subclass || !ClassSubList[subclass].abilitySave) return;
						var spAbiMod = Number(What(AbilityScores.abbreviations[ClassSubList[subclass].abilitySave - 1] + ' Mod'));
						if (spAbiMod > 0 && v.thisWeapon[3] && SpellsList[v.thisWeapon[3]].level === 0) {
							output.extraDmg += spAbiMod;
						};
					},
					"My cantrips get my spellcasting ability modifier added to their damage."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						var subclass = classes.known["sidekick-spellcaster-tcoe"].subclass;
						if (!subclass || !ClassSubList[subclass].abilitySave || spellObj.psionic || spellObj.level !== 0) return;
						var spAbi = AbilityScores.abbreviations[ClassSubList[subclass].abilitySave - 1];
						var spAbiMod = Number(What(spAbi + ' Mod'));
						if (spAbiMod < 1) return;
						return genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", spAbi);
					},
					"My cantrips get my spellcasting ability modifier added to their damage."
				]
			}
		},
		"empowered spells" : {
			name : "Empowered Spells",
			source : [["T", 146]],
			minlevel : 14,
			description : desc([
				'Select one of the eight schools of magic using the "Choose Feature" button above',
				"Whenever I cast a spell from the selected school by expending a spell slot, I empower it",
				"I add my spellcasting ability modifier to the damage or healing I roll for that spell"
			]),
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						var subclass = classes.known["sidekick-spellcaster-tcoe"].subclass;
						var spSchool = GetFeatureChoice("classes", "sidekick-spellcaster-tcoe", "empowered spells");
						if (!subclass || !ClassSubList[subclass].abilitySave || !spSchool || spellObj.psionic || !spellObj.level) return;
						for (var aSchl in spellSchoolList) {
							if (spellSchoolList[aSchl] == spSchool) {
								spSchool = aSchl;
								break;
							}
						}
						if (spellObj.school !== spSchool) return;
						var spAbi = AbilityScores.abbreviations[ClassSubList[subclass].abilitySave - 1];
						var spAbiMod = Number(What(spAbi + ' Mod'));
						if (spAbiMod < 1) return;
						if (genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", spAbiMod, true, true) || genericSpellDmgEdit(spellKey, spellObj, "heal", spAbiMod, true, true)) {
							return true;
						}
					},
					"Spells from my selected school cast by expending a spell slot get my spellcasting ability modifier added to their damage or healing rolls."
				]
			},
			choices : ["Abjuration", "Conjuration", "Divination", "Enchantment", "Evocation", "Illusion", "Necromancy", "Transmutation"],
			"abjuration" : {
				name : "Empowered Abjurations",
				description : desc([
					"Whenever I cast an abjuration spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I roll for that spell"
				])
			},
			"conjuration" : {
				name : "Empowered Conjurations",
				description : desc([
					"Whenever I cast a conjuration spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I roll for that spell"
				])
			},
			"divination" : {
				name : "Empowered Divinations",
				description : desc([
					"Whenever I cast a divination spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I roll for that spell"
				])
			},
			"enchantment" : {
				name : "Empowered Enchantments",
				description : desc([
					"Whenever I cast a enchantment spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I roll for that spell"
				])
			},
			"evocation" : {
				name : "Empowered Evocations",
				description : desc([
					"Whenever I cast a evocation spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I roll for that spell"
				])
			},
			"illusion" : {
				name : "Empowered Illusions",
				description : desc([
					"Whenever I cast an illusion spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I roll for that spell"
				])
			},
			"necromancy" : {
				name : "Empowered Necromancy",
				description : desc([
					"Whenever I cast a necromancy spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I roll for that spell"
				])
			},
			"transmutation" : {
				name : "Empowered Transmutations",
				description : desc([
					"Whenever I cast a transmutation spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I roll for that spell"
				])
			}
		},
		"focused casting" : {
			name : "Focused Casting",
			source : [["T", 146]],
			minlevel : 20,
			description : desc("Taking damage can't break my concentration on a spell")
		}
	}
}
ClassList["sidekick-warrior-tcoe"] = {
	defaultExcluded : true,
	prereqeval : global_TCoE_Sidekick_fn.prereqeval,
	regExpSearch : /^(?=.*warrior)(?=.*sidekick).*$/i,
	name : "Warrior (sidekick)",
	source : [["T", 146]],
	primaryAbility : "Strength, Dexterity, or Constitution",
	prereqs : "Can't multiclass",
	improvements : levels.map(function (n) {
		return n < 4 ? 0 : n < 8 ? 1 : n < 12 ? 2 : n < 14 ? 3 : n < 16 ? 4 : n < 19 ? 5 : 6;
	}),
	die : CurrentVars.sidekickHD ? CurrentVars.sidekickHD[1] : 8,
	skillstxt : {
		primary : "Choose two from Acrobatics, Animal Handling, Athletics, Intimidation, Nature, Perception, and Survival"
	},
	armorProfs : {
		primary : [true, true, true, false]
	},
	equipment : "",
	subclasses : ["", []],
	attacks : [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3],
	features : {
		"a sidekick" : {
			name : "A Sidekick",
			source : [["T", 142]],
			minlevel : 1,
			description : desc([
				"A sidekick can be any creature with challenge rating of 1/2 or lower",
				"Fill out the stats block into the character sheet manually, the class adds to it",
				"The sidekick's level is the same as the average level of the group",
				"The hit dice of a sidekick are the same as those of the base creature, gaining +1 per level",
				"A sidekick does not get the benefits of a background, nor can it take feats or multiclass"
			]),
			calcChanges : {
				hp : global_TCoE_Sidekick_fn.calcChanges_hp
			},
			eval : global_TCoE_Sidekick_fn.eval,
			removeeval : global_TCoE_Sidekick_fn.removeeval
		},
		"bonus proficiencies: saving throws" : {
			name : "Bonus Proficiencies: Saving Throws",
			source : [["T", 146]],
			minlevel : 1,
			description : desc('Choose Str, Dex, or Con save proficiency, using the "Choose Feature" button above'),
			choices : ["Strength", "Dexterity", "Constitution"],
			"strength" : {
				name : "Bonus Proficiencies: Strength Saving Throws",
				description : desc("I am proficient in Strength saving throws"),
				saves : ["Str"]
			},
			"dexterity" : {
				name : "Bonus Proficiencies: Dexterity Saving Throws",
				description : desc("I am proficient in Dexterity saving throws"),
				saves : ["Dex"]
			},
			"constitution" : {
				name : "Bonus Proficiencies: Constitution Saving Throws",
				description : desc("I am proficient in Constitution saving throws"),
				saves : ["Con"]
			}
		},
		"bonus proficiencies" : {
			name : "Bonus Proficiencies",
			source : [["T", 146]],
			minlevel : 1,
			description : desc([
				"I gain proficiency with all armor and two skills of my choice from the following list:",
				"Acrobatics, Animal Handling, Athletics, Intimidation, Nature, Perception, and Survival",
				'If the base creature is a Humanoid or has a simple or martial weapon in its stat block,',
				'select it using the "Choose Feature" button above, so I gain more bonus proficiencies'
			]),
			choices : ["Base creature is a Humanoid or has a simple or martial weapon in its stat block", "Other base creatures"],
			"base creature is a humanoid or has a simple or martial weapon in its stat block" : {
				name : "Bonus Proficiencies: Humanoid",
				description : desc([
					"I gain proficiency with all armor and two skills of my choice from the following list:",
					"Acrobatics, Animal Handling, Athletics, Intimidation, Nature, Perception, and Survival",
					"Additionally, I gain proficiency with shields and all simple and martial weapons"
				]),
				armorProfs : [false, false, false, true],
				weaponProfs : [true, true]
			},
			"other base creatures" : {
				name : "Bonus Proficiencies: Non-humanoid",
				description : desc([
					"I gain proficiency with all armor and two skills of my choice from the following list:",
					"Acrobatics, Animal Handling, Athletics, Intimidation, Nature, Perception, and Survival"
				])
			}
		},
		"martial role" : {
			name : "Martial Role",
			source : [["T", 146]],
			minlevel : 1,
			description : desc('Choose a Martial Role for the warrior using the "Choose Feature" button above'),
			choices : ["Attacker", "Defender"],
			"attacker" : {
				name : "Martial Role: Attacker",
				description : desc("I gain a +2 bonus to all my attack rolls"),
				calcChanges : {
					atkCalc : [
						function (fields, v, output) {
							if (!v.isDC) output.extraHit += 2;
						},
						"I add a +2 bonus on the To Hit of all my attack rolls."
					]
				}
			},
			"defender" : {
				name : "Martial Role: Defender",
				description : desc([
					"As a reaction, I can give disadv. on an attack made vs. someone within 5 ft of me",
					"I need to be able to see the attacker to do this"
				]),
				action : [["reaction", ""]]
			}
		},
		"second wind" : {
			name : "Second Wind",
			source : [["T", 146]],
			minlevel : 2,
			description : desc([
				"As a bonus action, I can regain hit points equal to 1d10 + warrior level",
				"I can use this once per short rest (twice at 20th-level)"
			]),
			additional : levels.map(function (n) {
				return "1d10+" + n;
			}),
			usages : levels.map(function (n) { return n < 2 ? "" : n < 20 ? 1 : 2 }),
			recovery : "short rest",
			action : [["bonus action", ""]]
		},
		"improved critical" : {
			name : "Improved Critical",
			source : [["T", 146]],
			minlevel : 3,
			description : desc("I score a critical hit with my weapon attacks on a roll of 19 and 20"),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (!v.isSpell && !v.CritChance && classes.known["sidekick-warrior"]) {
							fields.Description += (fields.Description ? '; ' : '') + 'Crit on 19-20';
							v.CritChance = 19;
						};
					},
					"My weapon attacks score a critical on a to hit roll of both 19 and 20.",
					19
				]
			}
		},
		"ability score improvement" : {
			name : "Ability Score Improvement",
			source : [["T", 146]],
			minlevel : 4,
			description : desc([
				"Increase one ability score by 2, or two ability scores by 1, up to a maximum of 20",
				"I gain this at 4th level and again at 8th, 12th, 14th, 16th, and 19th level"
			]),
			additional : levels.map(function (n) {
				return n < 4 ? "" : (n < 8 ? 1 : n < 12 ? 2 : n < 14 ? 3 : n < 16 ? 4 : n < 19 ? 5 : 6) + "\xD7 2 points increase";
			})
		},
		"extra attack" : {
			name : "Extra Attack",
			source : [["T", 147]],
			minlevel : 6,
			description : desc([
				"I can attack twice, instead of once, whenever I take the Attack action on my turn",
				"This increases to three at 15th level",
				"If I have the Multiattack action, I can use either that or extra attack on a turn, not both"
			]),
			additional : levels.map(function (n) {
				return n < 6 ? "" : (n < 15 ? 1 : 3) + " attacks as an action on my turn";
			})
		},
		"battle readiness" : {
			name : "Battle Readiness",
			source : [["T", 147]],
			minlevel : 7,
			description : desc("I have advantage on my Initiative rolls"),
			advantages : [["Initiative", true]]
		},
		"improved defense" : {
			name : "Improved Defense",
			source : [["T", 147]],
			minlevel : 10,
			description : desc("I gain a +1 bonus to AC"),
			extraAC : { mod : 1 }
		},
		"indomitable" : {
			name : "Indomitable",
			source : [["T", 147]],
			minlevel : 11,
			description : desc([
				"I can reroll a failed saving throw, but must keep the new result",
				"I can use this once per long rest (twice at 20th-level)"
			]),
			usages : levels.map(function (n) { return n < 11 ? "" : n < 20 ? 1 : 2 }),
			recovery : "long rest"
		}
	}
}

// Add three subclasses to the spellcaster sidekick
AddSubClass("sidekick-spellcaster-tcoe", "mage", {
	regExpSearch : /^(?=.*mage)(?=.*sidekick).*$/i,
	subname : "Mage",
	fullname : "Spellcaster: Mage (sidekick)",
	source : [["T", 144]],
	abilitySave : 4,
	spellcastingList : {
		"class" : "wizard",
		level : [0, 5]
	},
	features : {
		"subclassfeature1" : {
			name : "Spellcasting",
			source : [["T", 144]],
			minlevel : 1,
			description : desc([
				"I can cast wizard cantrips/spells I know, using Intelligence as my spellcasting ability",
				"I can use an arcane focus as a spellcasting focus for my spells",
				"Whenever I gain a level, I can replace one cantrip/spell I know with another I'm allowed"
			]),
			additional : global_TCoE_Sidekick_fn.spellcasting_additional
		}
	}
});
AddSubClass("sidekick-spellcaster-tcoe", "healer", {
	regExpSearch : /^(?=.*healer)(?=.*sidekick).*$/i,
	subname : "Healer",
	fullname : "Spellcaster: Healer (sidekick)",
	source : [["T", 144]],
	abilitySave : 5,
	spellcastingList : {
		"class" : ["cleric", "druid"],
		level : [0, 5]
	},
	features : {
		"subclassfeature1" : {
			name : "Spellcasting",
			source : [["T", 144]],
			minlevel : 1,
			description : desc([
				"I can cast cleric and druid cantrips/spells I know, using Wisdom as my spellcasting ability",
				"I can use a holy symbol or druidic focus as a spellcasting focus for my spells",
				"Whenever I gain a level, I can replace one cantrip/spell I know with another I'm allowed"
			]),
			additional : global_TCoE_Sidekick_fn.spellcasting_additional
		}
	}
});
AddSubClass("sidekick-spellcaster-tcoe", "prodigy", {
	regExpSearch : /^(?=.*prodigy)(?=.*sidekick).*$/i,
	subname : "Prodigy",
	fullname : "Spellcaster: Prodigy (sidekick)",
	source : [["T", 144]],
	abilitySave : 6,
	spellcastingList : {
		"class" : ["bard", "warlock"],
		level : [0, 5]
	},
	features : {
		"subclassfeature1" : {
			name : "Spellcasting",
			source : [["T", 144]],
			minlevel : 1,
			description : desc([
				"I can cast bard and warlock cantrips/spells I know, using Cha as my spellcasting ability",
				"I can use an arcane focus or musical instrument as a spellcasting focus for my spells",
				"Whenever I gain a level, I can replace one cantrip/spell I know with another I'm allowed"
			]),
			additional : global_TCoE_Sidekick_fn.spellcasting_additional
		}
	}
});

// pub_20201117_TCoE.js
// This file adds the content from Tasha's Cauldron of Everything to MPMB's Character Record Sheet

/*	ACKNOWLEDGEMENTS
	This file contains contributions from many different people over on the /r/mpmb subreddit and
	the MPMB Discord server.

	Many contributions have been reworked by Safety-Orange to fix bugs, make texts more uniform,
	adhere to MPMB's standards, and/or adhere to the latest syntax version.
	Combined with the fact that many contributions haven't been individually tracked (on GitHub),
	it is no longer possible to assign specific additions to a single person.

	Instead, here is a list of people (account names on GitHub) who made contributions,
	helped collect materials, or were otherwise essential to this script coming to fruition,
	in no particular order:
		- Nod_Hero#2046 (Discord)
		- Smashman
		- Metacomet10
		- BraabHimself
		- AelarTheElfRogue
		- uhohspaghetti0
		- Undrhil
		- easyboy
		- SoggieWafflz
		- phelot
		- Cosaur
		- remcovandalen
		- Seneschal55
		- Gam90
		- CountVladmir
		- alastairmarchant
		- edimshuffling
		- githubtkompare
		- Holynight6
		- lizrdgizrd

	Think you're missing from this list? Please let me know!
*/

// Define the source
SourceList.T = {
	name : "Tasha's Cauldron of Everything",
	abbreviation : "TCoE",
	abbreviationSpellsheet : "T",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tashas-cauldron-everything",
	date : "2020/11/17"
};

// Add Custom Lineage
RaceList["custom lineage"] = {
	regExpSearch : /^(?=.*custom)(?=.*lineage).*$/i,
	name : "Custom lineage",
	source : [["T", 8]],
	plural : "Custom lineages",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	scorestxt : "+2 to one ability score of my choice",
	eval : function() { AddString('Feat Note 1', 'Custom lineage bonus feat', '; '); },
	removeeval : function() { RemoveString('Feat Note 1', 'Custom lineage bonus feat'); },
	trait : "Custom Lineage (+2 to one ability score of my choice)" + desc([
		"Size: I am Small or Medium (my choice).",
		"Feat: I gain one feat of my choice for which I qualify.",
		"Variable Trait: I gain either darkvision with a range of 60 ft or proficiency with a skill of my choice. Use the Racial Options button to select either one."
	])
};
AddRacialVariant("custom lineage", "darkvision", {
	regExpSearch : /darkvision/i,
	source : [["T", 8]],
	vision : [["Darkvision", 60]],
	trait : "Custom Lineage (+2 to one ability score of my choice)" + desc([
		"Size: I am Small or Medium (my choice).",
		"Feat: I gain one feat of my choice for which I qualify.",
		"Variable Trait: I have darkvision with a range of 60 ft."
	])
});
AddRacialVariant("custom lineage", "skill proficiency", {
	regExpSearch : /skill proficiency/i,
	source : [["T", 8]],
	skillstxt : "Choose any one skill",
	trait : "Custom Lineage (+2 to one ability score of my choice)" + desc([
		"Size: I am Small or Medium (my choice).",
		"Feat: I gain one feat of my choice for which I qualify.",
		"Variable Trait: I have proficiency with a skill of my choice."
	])
});


// >>>>>>>>>>>>>>>>>>>>>>> //
// >>> Artificer Class >>> //
// >>>>>>>>>>>>>>>>>>>>>>> //
// New Artificer Infusions
AddFeatureChoice(ClassList.artificer.features["infuse item"], true, "Arcane Propulsion Armor (prereq: level 14 artificer)", {
	name : "Arcane Propulsion Armor",
	source : [["T", 20]],
	description : desc([
		"The armor replaces any missing limbs of the wearer and can't be removed against its will",
		"It increases the wearer's walking speed by 5 ft; Its gauntlet can be used as melee weapons"
	]),
	additional : "suit of armor; requires attunement",
	prereqeval : function(v) { return classes.known.artificer.level >= 14; },
	magicitemsAdd : ["Arcane Propulsion Armor"]
});
MagicItemsList["arcane propulsion armor"] = {
	name : "Arcane Propulsion Armor",
	source : [["T", 20]],
	type : "armor (light, medium, or heavy)",
	descriptionFull : "The wearer of this armor gains these benefits:\n \u2022 The wearer's walking speed increases by 5 feet.\n \u2022 The armor includes gauntlets, each of which is a magic melee weapon that can be wielded only when the hand is holding nothing. The wearer is proficient with the gauntlets, and each one deals 1d8 force damage on a hit and has the thrown property, with a normal range of 20 feet and a long range of 60 feet. When thrown, the gauntlet detaches and flies at the attack's target, then immediately returns to the wearer and reattaches.\n \u2022 The armor can't be removed against the wearer's will.\n \u2022 If the wearer is missing any limbs, the armor replaces those limbs\u2014hands, arms, feet, legs, or similar appendages. The replacements function identically to the body parts they replace.",
	description : "This armor replaces any missing limbs, increases my walking speed by 5 ft, and can't be removed against my will. I can use either empty-handed gauntlet as a proficient melee weapon with the thrown property. After a throwing attack with a gauntlet, it returns and reattaches immediately.",
	attunement : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"]
	},
	speed : { walk : { spd : "+5", enc : "+5" } },
	weaponOptions : [{
		regExpSearch : /^(?=.*arcane)(?=.*propulsion)(?=.*gauntlet).*$/i,
		name : "Arcane Propulsion Gauntlets",
		source : [["T", 20]],
		ability : 1,
		type : "AlwaysProf",
		damage : [1, 8, "force"],
		range : "Melee, 20/60 ft",
		description : "Thrown; Returns immediately after thrown",
		abilitytodamage : true,
		selectNow : true
	}]
}
AddFeatureChoice(ClassList.artificer.features["infuse item"], true, "Armor of Magical Strength", {
	name : "Armor of Magical Strength",
	source : [["T", 20]],
	description : desc([
		"The armor has 6 charges, regaining 1d6 expended charges daily at dawn",
		"As a reaction when being knocked prone, the wearer can use 1 charge to not be prone",
		"When making a Str check/save, the wearer can use 1 charge to add its Int mod to the roll"
	]),
	additional : "suit of armor; requires attunement",
	magicitemsAdd : ["Armor of Magical Strength"]
});
MagicItemsList["armor of magical strength"] = {
	name : "Armor of Magical Strength",
	nameTest : "of Magical Strength",
	source : [["T", 20]],
	type : "armor (light, medium, or heavy)",
	descriptionFull : "This armor has 6 charges. The wearer can expend the armor's charges in the following ways:\n \u2022 When the wearer makes a Strength check or a Strength saving throw, it can expend 1 charge to add a bonus to the roll equal to its Intelligence modifier.\n \u2022 If the creature would be knocked prone, it can use its reaction to expend 1 charge to avoid being knocked prone.\nThe armor regains 1d6 expended charges daily at dawn.",
	description : "This armor has 6 charges and regains 1d6 expended charges daily at dawn. As a reaction when I would be knocked prone, I can expend 1 charge to avoid being knocked prone. When I make a Strength check or Strength saving throw, I can expend 1 charge to add my Intelligence modifier to the roll.",
	attunement : true,
	action : [["reaction", ""]],
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "prefix"
	},
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6"
};
AddFeatureChoice(ClassList.artificer.features["infuse item"], true, "Helm of Awareness (prereq: level 10 artificer)", {
	name : "Helm of Awareness",
	source : [["T", 21], ["UA:SP3", 3]],
	description : "\n   The wearer has advantage on Initiative rolls and can't be surprised while not incapacitated",
	additional : "helmet; requires attunement",
	prereqeval : function(v) { return classes.known.artificer.level >= 10; },
	magicitemsAdd : ["Helm of Awareness"]
});
MagicItemsList["helm of awareness"] = {
	name : "Helm of Awareness",
	source : [["T", 21], ["UA:SP3", 3]],
	type : "wondrous item",
	description : "While wearing this helmet, I have advantage on initiative rolls. In addition, I can't be surprised, provided I'm not incapacitated.",
	descriptionFull : "While wearing this helmet, a creature has advantage on initiative rolls. In addition, the wearer can't be surprised, provided it isn't incapacitated.",
	attunement : true,
	advantages : [["Initiative", true]],
	savetxt : { immune : ["surprised"] }
};
AddFeatureChoice(ClassList.artificer.features["infuse item"], true, "Mind Sharpener", {
	name : "Mind Sharpener",
	source : [["T", 22]],
	description : "\n   The wearer can use its reaction to ignore a failed Con save to maintain concentration",
	additional : "suit of armor or robes",
	magicitemsAdd : ["Mind Sharpener"]
});
MagicItemsList["mind sharpener"] = {
	name : "Mind Sharpener",
	source : [["T", 22]],
	descriptionFull : "The infused item can send a jolt to the wearer to refocus their mind. The item has 4 charges. When the wearer fails a Constitution saving throw to maintain concentration on a spell, the wearer can use its reaction to expend 1 of the item's charges to succeed instead. The item regains 1d4 expended charges daily at dawn.",
	description : "This magic armor or robes can send a jolt to refocus my mind. It has 4 charges and regains 1d4 expended charges daily at dawn. As a reaction when I fail a Constitution saving throw to maintain concentration on a spell, I can expend 1 charge to succeed instead.",
	action : [["reaction", ""]],
	usages : 4,
	recovery : "dawn",
	additional : "regains 1d4",
	choices : ["Mind Sharpener Armor", "Mind Sharpener Robes"],
	choicesNotInMenu : true,
	"mind sharpener armor" : {
		name : "Mind\u200A Sharpener",
		type : "armor (light, medium, or heavy)",
		description : "This magic armor can send a jolt to refocus my mind. It has 4 charges and regains 1d4 expended charges daily at dawn. As a reaction when I fail a Constitution saving throw to maintain concentration on a spell, I can expend 1 charge to succeed instead.",
		chooseGear : {
			type : "armor",
			prefixOrSuffix : "brackets",
			itemName1stPage : ["suffix", "Mind Sharpener"],
			descriptionChange : ["prefix", "armor"]
		}
	},
	"mind sharpener robes" : {
		name : "Mind Sharpener (Robes)",
		type : "wondrous item",
		description : "These magic robes can send a jolt to refocus my mind. It has 4 charges and regains 1d4 expended charges daily at dawn. As a reaction when I fail a Constitution saving throw to maintain concentration on a spell, I can expend 1 charge to succeed instead."
	}
};
AddFeatureChoice(ClassList.artificer.features["infuse item"], true, "Spell-Refueling Ring (prereq: level 6 artificer)", {
	name : "Spell-Refueling Ring",
	source : [["T", 23]],
	description : "\n   As an action once per dawn, this ring's wearer can recover one 3rd-level or lower spell slot",
	additional : "ring; requires attunement",
	prereqeval : function(v) { return classes.known.artificer.level >= 6; },
	magicitemsAdd : ["Spell-Refueling Ring"]
});
MagicItemsList["spell-refueling ring"] = {
	name : "Spell-Refueling Ring",
	source : [["T", 23]],
	type : "ring",
	descriptionFull : "While wearing this ring, the creature can recover one expended spell slot as an action. The recovered slot can be of 3rd level or lower. Once used, the ring can't be used again until the next dawn.",
	description : "As an action, I can activate this magic ring to recover one expended spell slot. The recovered slot can be of 3rd level or lower. Once used, the ring can't be used again until the next dawn.",
	attunement : true,
	action : [["action", ""]],
	usages : 1,
	recovery : "dawn"
};

// Add the Armorer specialism (but after all other scripts, so that all armour options are present)
RunFunctionAtEnd(function () {
	var TCoE_Artificer_Subclass_Armorer = AddSubClass("artificer", "armorer", {
		regExpSearch : /^(?=.*armou?rer)(?!.*wizard).*$/i,
		subname : "Armorer",
		fullname : "Armorer",
		source : [["T", 15]],
		attacks : [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
		features : {
			"subclassfeature3" : {
				name : "Tools of the Trade",
				source : [["T", 15]],
				minlevel : 3,
				description : " [proficient with heavy armor \u0026 smith's tools]",
				toolProfs : ["Smith's tools"],
				armorProfs : [false, false, true, false],
				spellcastingExtra : ["magic missile", "thunderwave", "mirror image", "shatter", "hypnotic pattern", "lightning bolt", "fire shield", "greater invisibility", "passwall", "wall of force"]
			},
			"subclassfeature3.1" : {
				name : "Arcane Armor",
				source : [["T", 15]],
				minlevel : 3,
				description : " [reverts back if I die or don another armor]" + desc([
					"As an action, I can use smith's tool to turn an armor I'm wearing into arcane armor",
					"As an action, I can don or doff it; As a bonus action, I can deploy or retract its helmet",
					"It can't be removed against my will, covers all my limbs, and even replaces missing limbs",
					"I ignore the Strength requirement of arcane armor and can use it as a spellcasting focus"
				]),
				action : [["action", " (create/don/doff)"], ["bonus action", " (retract/deploy helmet)"]]
			},
			"subclassfeature3.2" : {
				name : "Armor Model",
				source : [["T", 16]],
				minlevel : 3,
				description : desc([
					"When I finish a rest, I can use smith's tools to change the model of my arcane armor",
					'Select a model using the "Choose Feature" button; See "Notes" page for features of each'
				]),
				additional : "also see notes page",
				toNotesPage : [{
					name : "Arcane Armor Model Features",
					note : desc([
						"I can customize my arcane armor to the guardian or infiltrator model whenever I finish a short or long rest, provided I have smith's tools in hand.",
						"Each model includes a special weapon. When I attack with that weapon, I can use my Intelligence modifier, instead of Strength or Dexterity, for the attack and damage rolls."
					])
				}, {
					name : "Guardian Arcane Armor",
					popupName : "Guardian Arcane Armor Features",
					note : desc([
						"\u2022 Thunder Gauntlets: Each of the armor's gauntlets counts as a simple melee weapon while I'm not holding anything in it, and it deals 1d8 thunder damage on a hit. A creature hit by the gauntlet has disadvantage on attack rolls against targets other than me until the start of me next turn, as the armor magically emits a distracting pulse when the creature attacks someone else.",
						"\u2022 Defensive Field: As a bonus action, I can gain temporary hit points equal to my artificer level, replacing any temporary hit points I already have. I lose these temporary hit points if I doff the armor. I can use this bonus action a number of times equal to my proficiency bonus, and I regain all expended uses when I finish a long rest."
					]),
					amendTo : "Arcane Armor Model Features"
				}, {
					name : "Infiltrator Arcane Armor",
					popupName : "Infiltrator Arcane Armor Features",
					note : desc([
						"\u2022 Lightning Launcher: A gemlike node on one of the armored fists or on the chest (my choice) counts as a simple ranged weapon, with a normal range of 90 ft and a long range of 300 ft. It deals 1d6 lightning damage on a hit. Once on each of my turns when I hit a creature with it, I can deal an extra 1d6 lightning damage to that target.",
						"\u2022 Powered Steps: My walking speed increases by 5 feet.",
						"\u2022 Dampening Field: I have advantage on Dexterity (Stealth) checks. If the armor normally imposes disadvantage on such checks, the advantage and disadvantage cancel each other, as normal."
					]),
					amendTo : "Arcane Armor Model Features"
				}],
				choices : [],
				choiceDependencies : [{
					feature : "subclassfeature15",
					choiceAttribute : true
				}],
				weaponOptions : [{
					regExpSearch : /^(?=.*thunder)(?=.*gauntlet).*$/i,
					name : "Thunder Gauntlets",
					source : [["T", 16]],
					ability : 4,
					type : "Simple",
					damage : [1, 8, "thunder"],
					range : "Melee",
					description : "Target hit disadv. on attacks vs. others than me until my next turn starts",
					abilitytodamage : true,
					monkweapon : true
				}, {
					regExpSearch : /^(?=.*lightning)(?=.*launcher).*$/i,
					name : "Lightning Launcher",
					source : [["T", 16]],
					ability : 4,
					type : "Simple",
					damage : [1, 6, "lightning"],
					range : "90/300 ft",
					description : "Once per turn on hit, +1d6 lightning damage",
					abilitytodamage : true
				}],
				// Do this in the parent object, so that it is always visible and people printing the sheet can more easily switch between the two models
				// Also, the armor model can be changed on a short rest, but the limited feature only resets on a long rest, so shouldn't be removed
				action : [["bonus action", "Defensive Field (Guardian Model)"]],
				extraLimitedFeatures : [{
					name : "Defensive Field (Guardian Model)",
					usages : "Proficiency bonus per ",
					usagescalc : "event.value = How('Proficiency Bonus');",
					recovery : "long rest"
				}]
			},
			"subclassfeature9" : {
				name : "Armor Modifications",
				source : [["T", 17]],
				minlevel : 9,
				description : desc([
					"Arcane armor now counts as armor, boots, helmet, and a weapon for holding infusions",
					"Each can hold one infusion; The infusions remain when I change the armor's model"
				]),
				additional : "+2 infused items, if used on arcane armor"
			},
			"subclassfeature15" : {
				name : "Perfected Armor",
				source : [["T", 17]],
				minlevel : 15,
				description : desc([
					'My armor gets additional features, based on the model; Use "Choose Features" to select it',
					"The guardian gets the ability to pull a creature closer as a reaction and make an attack",
					"The infiltrator gets an upgrade to its lightning launcher weapon attack"
				]),
				toNotesPage : [{
					name : "Guardian Perfected Armor Features",
					note : desc([
						"Tinkering with my armor's energy system leads me to discover a powerful pulling force.",
						"As a reaction when a Huge or smaller creature I can see ends its turn within 30 ft of me, I can magically force the creature to make a Strength saving throw against my spell save DC, pulling the creature up to 30 ft toward me to an unoccupied space. If I pull the target to a space within 5 ft of me, I can make a melee weapon attack against it as part of this reaction.",
						"I can use this reaction a number of times equal to my proficiency bonus. I regain all expended uses of it when I finish a long rest."
					]),
					amendTo : "Arcane Armor Model Features"
				}, {
					name : "Infiltrator Perfected Armor Features",
					note : desc([
						"Any creature that takes lightning damage from my Lightning Launcher glimmers with magical light until the start of my next turn.",
						"The glimmering creature sheds dim light in a 5-ft radius, and it has disadvantage on attack rolls against me, as the light jolts it if it attacks me. In addition, the next attack roll against it has advantage, and if that attack hits, the target takes an extra 1d6 lightning damage."
					]),
					amendTo : "Arcane Armor Model Features"
				}],
				"guardian" : {
					name : "Perfected Armor: Guardian",
					description : " [Proficiency Bonus per long rest]" + desc([
						"As a reaction when a creature I can see ends its turn in 30 ft, I have it make a Str save",
						"If it is Huge or smaller and fails, I pull it up to 30 ft towards me to an unoccupied space",
						"If I pull it within 5 ft, I can make a melee weapon attack vs. it as part of this reaction"
					])
				},
				"infiltrator" : {
					name : "Perfected Armor: Infiltrator",
					description : desc([
						"Those hit by my lightning launcher shed 5-ft radius dim light until my next turn starts",
						"The light gives the target disadvantage on attacks rolls made against me",
						"Also, the next attack against it has advantage and deals an extra 1d6 lightning damage"
					])
				},
				// Do these in the parent object, so that they are always visible and people printing the sheet can more easily switch between the two models
				// Also, the armor model can be changed on a short rest, but the limited feature only resets on a long rest, so shouldn't be removed
				action : [["reaction", "Perfected Armor: Guardian"]],
				extraLimitedFeatures : [{
					name : "Perfected Armor: Guardian",
					usages : "Proficiency bonus per ",
					usagescalc : "event.value = How('Proficiency Bonus');",
					recovery : "long rest"
				}]
			}
		}
	});
	var itsFea = ClassSubList[TCoE_Artificer_Subclass_Armorer].features["subclassfeature3.2"];
	var guardianTxt = desc([
		"Both fists are Thunder Gauntlets, simple melee weapons that distract those hit by it",
		"As a bonus action, I can activate a defensive shield to gain my artificer level in temp HP"
	])
	var guardianAdditional = levels.map(function (n) {
		return n + " temp HP, Prof B. per long rest";
	})
	var infiltratorTxt = desc([
		"+5 ft walking speed; Gemlike node in fist/chest is a ranged weapon, Lightning Launcher",
		"It gives me advantage on Dexterity (Stealth) checks"
	])
	var prereqFunc = function(v) {
		var sParsed = ParseArmor(v.choice.replace(/(Guardian|Infiltrator) arcane /i, ''));
		return sParsed && testSource(sParsed, ArmourList[sParsed], "armorExcl") ? "skip" : true;
	};
	for (var armor in ArmourList) {
		var anArm = ArmourList[armor];
		if (anArm.isMagicArmor || !anArm.weight || (CurrentVars.extraArmour && CurrentVars.extraArmour[armor])) continue;
		// Add the Guardian variant of the armor
		var gArmName = "Guardian Arcane " + anArm.name;
		itsFea[gArmName.toLowerCase()] = {
			name : (typePF ? "Armor " : "") + "Model: Guardian " + anArm.name,
			submenu : "Guardian Arcane Armor",
			description : guardianTxt,
			additional : guardianAdditional,
			armorAdd : { select : gArmName, options : [gArmName] },
			weaponsAdd : { select : ["Thunder Gauntlets"] },
			prereqeval : prereqFunc,
			dependentChoices : "guardian"
		}
		// And now add the Infiltrator variant of the armor
		var iArmName = "Infiltrator Arcane " + anArm.name;
		itsFea[iArmName.toLowerCase()] = {
			name : "Armor Model: Infiltrator " + anArm.name,
			submenu : "Infiltrator Arcane Armor",
			description : infiltratorTxt + (anArm.stealthdis ? ", cancelling out the disadv. it imposes" : ""),
			speed : { walk : {spd : "+5", enc : "+5" } },
			armorAdd : { select : iArmName, options : [iArmName] },
			weaponsAdd : { select : ["Lightning Launcher"] },
			prereqeval : prereqFunc,
			advantages : [["Stealth", true]],
			dependentChoices : "infiltrator"
		}
		// Lastly push both choices to the array
		itsFea.choices.push(gArmName, iArmName);
	}
});


// >>>>>>>>>>>>>>>>>>>>>>>>> //
// >>> Barbarian Options >>> //
// >>>>>>>>>>>>>>>>>>>>>>>>> //

// Barbarian Optional Class Features
AddFeatureChoice(ClassList.barbarian.features["danger sense"], true, "Primal Knowledge", {
	name : "Primal Knowledge",
	extraname : "Optional Barbarian 3",
	source : [["T", 24]],
	description : desc([
		"At 3rd level and again at 10th level I gain proficiency with one skill of my choice",
		"I can choose from Animal Handling, Athletics, Intimidation, Nature, Perception, Survival"
	]),
	skillstxt : "Choose one from Animal Handling, Athletics, Intimidation, Nature, Perception and Survival.\nChoose another from this list at 10th level",
	prereqeval : function (v) { return classes.known.barbarian.level >= 3 ? true : "skip"; }
}, "Optional 3rd-level barbarian features");
AddFeatureChoice(ClassList.barbarian.features["feral instinct"], true, "Instinctive Pounce", {
	name : "Instinctive Pounce",
	extraname : "Optional Barbarian 7",
	source : [["T", 24]],
	description : desc([
		"As part of the bonus action I use to enter rage, I can move up to half my speed"
	]),
	action : [["bonus action", "Rage (start & half move / end)", "Rage (start/end)"]]
}, "Optional 7th-level barbarian features");

// Barbarian Subclasses
AddSubClass("barbarian", "path of the beast", {
	regExpSearch : /^(?=.*\bbeast\b)(?=.*(warrior|marauder|barbarian|viking|(norse|tribes?|clans?)(wo)?m(a|e)n)).*$/i,
	subname : "Path of the Beast",
	source : [["T", 24]],
	abilitySave : 3,
	features : {
		"subclassfeature3" : {
			name : "Form of the Beast",
			source : [["T", 24]],
			minlevel : 3,
			description : desc([
				"When I enter my rage, I can transform to gain a bite, tail, or claws attack for that rage",
				"On a hit with the bite attack once on each of my turns, I can heal my Prof Bonus in HP",
				"This only works if I have less than half my hit points when I hit with this bite attack",
				"With the claws I can make one extra attack when I attack with it in my Attack action",
				"As a reaction with the tail when I'm hit, I can add 1d8 to my AC for that attack",
				"This only works if the hit is from an attack roll made a creature I can see within 30 ft"
			]),
			weaponOptions : [{
				regExpSearch : /^(?=.*(bestial|beast))(?=.*bite).*$/i,
				name : "Bestial Bite",
				source : [["T", 24]],
				ability : 1,
				type : "Natural",
				damage : [1, 8, "piercing"],
				range : "Melee",
				description : "Only in rage; On a hit once on my turn, regain Prof Bonus in HP (if below 1/2 HP)",
				abilitytodamage : true,
				bestialNaturalWeapon : true,
				selectNow : true
			}, {
				regExpSearch : /^(?=.*(bestial|beast))(?=.*claws?).*$/i,
				name : "Bestial Claws",
				source : [["T", 24]],
				ability : 1,
				type : "Natural",
				damage : [1, 6, "slashing"],
				range : "Melee",
				description : "Only in rage; Extra attack if used as part of Attack action",
				abilitytodamage : true,
				bestialNaturalWeapon : true,
				selectNow : true
			}, {
				regExpSearch : /^(?=.*(bestial|beast))(?=.*tail).*$/i,
				name : "Bestial Tail",
				source : [["T", 25]],
				ability : 1,
				type : "Natural",
				damage : [1, 8, "piercing"],
				range : "Melee",
				description : "Reach; Only in rage",
				abilitytodamage : true,
				bestialNaturalWeapon : true,
				selectNow : true
			}],
			additional : levels.map(function(n) {
				return n < 6 ? "" : "chosen weapon counts as magical";
			}),
			action : [["reaction", "Bestial Tail"]]
		},
		"subclassfeature6" : {
			name : "Bestial Soul",
			source : [["T", 25]],
			minlevel : 6,
			description : desc([
				"When I finish a short rest, I can choose one of the following benefits until my next rest:",
				" \u2022 Swimming speed equal to my walking speed and I can breathe underwater",
				" \u2022 Climb speed (same as walking) and no check to climb difficult surfaces or upside down",
				" \u2022 Once per turn when I jump, I can extend it by the result of an Athletics check in feet"
			]),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.theWea.bestialNaturalWeapon && !v.thisWeapon[1] && !v.theWea.isMagicWeapon && !(/counts as( a)? magical/i).test(fields.Description)) {
							fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
						};
					},
					"The natural melee weapon that I gain from Form of the Beast count as magical for the purpose of overcoming resistance and immunity to nonmagical attacks and damage."
				]
			}
		},
		"subclassfeature10" : {
			name : "Infectious Fury",
			source : [["T", 25]],
			minlevel : 10,
			description : desc([
				"In rage, when I hit a creature with my natural weapon, I can have it make a Wis save",
				"If it fails (DC 8 + my Prof Bonus + my Con mod) it suffers one effect of my choice:",
				" \u2022 It uses its reaction to make a melee attack against one creature I can see of my choice",
				" \u2022 It takes 2d12 psychic damage"
			]),
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature14" : {
			name : "Call the Hunt",
			source : [["T", 25]],
			minlevel : 14,
			description : desc([
				"When I enter rage, I can choose my Con mod of willing creatures I can see within 30 ft",
				"Once on each of their turns, if they hit an attack, they can have it deal +1d6 damage",
				"This lasts as long as I rage; I gain 5 temporary HP per creature that accepts this benefit"
			]),
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		}
	}
});
AddSubClass("barbarian", "path of wild magic", {
	regExpSearch : /^(?=.*\bwild\b)(?=.*\bmagic\b).*$/i,
	subname : "Path of Wild Magic",
	source : [["T", 25]],
	abilitySave : 3,
	features : {
		"subclassfeature3" : {
			name : "Magic Awareness",
			source : [["T", 25]],
			minlevel : 3,
			description : desc([
				"As an action, I can open my awareness to the presence of concentrated magic",
				"Until my next turn ends, I know the location of any spell or magic item within 60 ft",
				"I also learn the school of magic of a spell; This doesn't reveal anything behind total cover"
			]),
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus')",
			recovery : "long rest",
			action : [["action", ""]]
		},
		"subclassfeature3.1" : {
			name : "Wild Surge",
			source : [["T", 25]],
			minlevel : 3,
			description : "\n   Whenever I enter my rage, I roll on the Wild Magic table (see Notes page)",
			toNotesPage : [{
				name : "Wild Magic Table",
				source : [["T", 26]],
				note : [
					"The magical energy roiling inside me sometimes erupts from me. Whenever I enter my rage, I have to roll on the table below to see what happens.",
					"If the effect calls for a saving throw, the DC is equal to 8 + my proficiency bonus + my Constitution modifier.\n",
					"d8\tEFFECT",
					" 1\tShadowy tendrils lash around me. Each creature of my choice that I can see within 30 ft of me must succeed on a Constitution saving throw or take 1d12 necrotic damage. I also gain 1d12 temporary hit points.",
					" 2\tI teleport up to 30 ft to an unoccupied space I can see. Until my rage ends, I can use this effect again on each of my turns as a bonus action.",
					" 3\tAn intangible spirit, which looks like a flumph or a pixie (my choice), appears within 5 ft of one creature of my choice that I can see within 30 ft of me. At the end of the current turn, the spirit explodes, and each creature within 5 ft of it must succeed on a Dexterity saving throw or take 1d6 force damage. Until my rage ends, I can use this effect again, summoning another spirit, on each of my turns as a bonus action.",
					" 4\tMagic infuses one weapon of my choice that I am holding. Until my rage ends, the weapon's damage type changes to force, and it gains the light and thrown properties, with a normal range of 20 ft and a long range of 60 ft. If the weapon leaves my hand, the weapon reappears in my hand at the end of the current turn.",
					" 5\tWhenever a creature hits me with an attack roll before my rage ends, that creature takes 1d6 force damage, as magic lashes out in retribution.",
					" 6\tUntil my rage ends, I am surrounded by multicolored, protective lights; I gain a +1 bonus to AC, and while within 10 ft of me, my allies gain the same bonus.",
					" 7\tFlowers and vines temporarily grow around me; until my rage ends, the ground within 15 ft of me is difficult terrain for my enemies.",
					" 8\tA bolt of light shoots from my chest. Another creature of my choice that I can see within 30 ft of me must succeed on a Constitution saving throw or take 1d6 radiant damage and be blinded until the start of my next turn. Until my rage ends, I can use this effect again on each of my turns as a bonus action."
				]
			}]
		},
		"subclassfeature6" : {
			name : "Bolstering Magic",
			source : [["T", 26]],
			minlevel : 6,
			description : desc([
				"As an action, I can touch a creature or myself and confer one of the following benefits:",
				" \u2022 For 10 minutes, they can add 1d3 to any attack roll and ability check",
				" \u2022 Roll 1d3. They regain an expended spell slot of a level equal to or lower than the roll",
				"A creature that receives the second benefit can't receive it again until after a long rest"
			]),
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus')",
			recovery : "long rest",
			action : [["action", ""]]
		},
		"subclassfeature10" : {
			name : "Unstable Backlash",
			source : [["T", 26]],
			minlevel : 10,
			description : desc([
				"As a reaction in rage when taking damage or failing a save, I can lash out with magic",
				"I roll on the Wild Magic table and immediately apply the roll, replacing my current effect"
			]),
			action : [["reaction", " (in rage on damage/save fail)"]]
		},
		"subclassfeature14" : {
			name : "Controlled Surge",
			source : [["T", 26]],
			minlevel : 14,
			description : desc([
				"Whenever I roll on the Wild Magic table, I can roll two dice and choose which to use",
				"If I roll the same on both dice, I can instead choose any effect on the Wild Magic table"
			])
		}
	}
});


// >>>>>>>>>>>>>>>>>>>> //
// >>> Bard Options >>> //
// >>>>>>>>>>>>>>>>>>>> //

// Bard Optional Class Features
AddFeatureChoice(ClassList.bard.features.spellcasting, true, "Additional Bard Spells", {
	name : "Additional Bard Spells",
	source : [["T", 27]],
	extraname : "Optional Bard 1",
	description : "",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "bard" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["color spray", "command", "aid", "enlarge/reduce", "mirror image", "mass healing word", "slow", "phantasmal killer", "rary's telepathic bond", "heroes' feast", "prismatic spray", "antipathy/sympathy", "prismatic wall"]);
			},
			"This optional class feature expands the spell list of the bard class with the following spells (spell level in brackets): Color Spray (1), Command (1), Aid (2), Enlarge/Reduce (2), Mirror Image (2), Mass Healing Word (3), Slow (3), Phantasmal Killer (4), Rary's Telepathic Bond (5), Heroes' Feast (6), Prismatic Spray (7), Antipathy/Sympathy (8), and Prismatic Wall (9)."
		]
	}
}, "Optional 1st-level bard features");
AddFeatureChoice(ClassList.bard.features["jack of all trades"], true, "Magical Inspiration", {
	name : "Magical Inspiration",
	extraname : "Optional Bard 2",
	source : [["T", 27]],
	description : desc([
		"A bardic inspiration die recipient can also use it when casting a damaging or healing spell",
		"They can expend the die and add it to healing or damage dealt to one target of the spell"
	])
}, "Optional 2nd-level bard features");
AddFeatureChoice(ClassList.bard.features["song of rest"], true, "Bardic Versatility", {
	name : "Bardic Versatility",
	extraname : "Optional Bard 4",
	source : [["T", 28]],
	description : " [ASI = Ability Score Improvement]" + desc([
		"Whenever I gain an ASI from the bard class, I can change one cantrip or expertise choice",
		"I can select another cantrip from the bard spell list or another skill I'm proficient with"
	]),
	prereqeval : function (v) { return classes.known.bard.level >= 4 ? true : "skip"; }
}, "Optional 4th-level bard features");

// Bard Subclasses
AddSubClass("bard", "college of creation", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*creation).*$/i,
	subname : "College of Creation",
	source : [["T", 28]],
	features : {
		"subclassfeature3" : {
			name : "Mote of Potential",
			source : [["T", 28]],
			minlevel : 3,
			description : desc([
				"Those who use my Bardic Inspiration die gain an extra bonus depending how they use it:",
				"\u2022 Ability check: Roll the die twice and choose which result to use",
				"\u2022 Attack roll: the target and others of my choice I can see in 5 ft must make a Con save",
				"  If failed, they take the die roll in thunder damage; This uses my spell save DC",
				"\u2022 Saving throw: Grants temporary HP equal to the roll + my Cha mod (min 1 temp HP)"
			])
		},
		"subclassfeature3.1" : {
			name : "Performance of Creation",
			source : [["T", 28]],
			minlevel : 3,
			description : levels.map(function (n) {
				if (n < 14) {
					var descr = [
						"As an action, I create " + (n < 6 ? "a Medium" : "one Large") + " or smaller nonmagical item in an empty space in 10 ft",
						"It can't be worth more than " + (20 * n) + " gp; It lasts for my Proficiency Bonus in hours",
						"I can't have multiple, creating more makes the first one vanish",
						"I can do this once per long rest, or by expending a 2nd-level or higher spell slot (SS 2+)"
					];
				} else {
					var descr = [
						"As an action, I create my Charisma mod of nonmagical items in an empty space in 10 ft",
						"One can be Huge, the rest Small or smaller; They last for my Proficiency Bonus in hours",
						"I can't have more than my Cha mod; If I create more, I get to choose which vanish",
						"I can do this once per long rest, or by expending a 2nd-level or higher spell slot (SS 2+)"
					];
				}
				return desc(descr);
			}),
			action : [["action", ""]],
			usages : 1,
			recovery : "long rest",
			altResource : "SS 2+"
		},
		"subclassfeature6" : {
			name : "Animating Performance",
			source : [["T", 29]],
			minlevel : 6,
			description : desc([
				"As an action, I can animate a Large or smaller nonmagical item I can see within 30 ft",
				"It is friendly and obeys my commands; It lasts for 1 hour, until it has 0 HP, or I die",
				"Unless I use a bonus action to command it, it only takes the Dodge action on its turn",
				"It can take reactions and move on its turn without commands; I can't have multiple",
				"When I use bardic inspiration, I can command the item as part of the same bonus action",
				'It acts on my initiative, after me; See "Dancing Item" on a companion page for its stats',
				"I can do this once per long rest, or by expending a 3rd-level or higher spell slot (SS 3+)"
			]),
			action : [["action", ""], ["bonus action", "Command Dancing Item"]],
			usages : 1,
			recovery : "long rest",
			altResource : "SS 3+",
			creaturesAdd : [["Dancing Item"]],
			creatureOptions : [{
				name : "Dancing Item",
				source : [["T", 29]],
				size : 4,
				type : "Construct",
				alignment : "",
				ac : 16,
				hp : 25,
				hd : [],
				speed : "fly 30 ft (hover)",
				scores : [18, 14, 16, 4, 10, 6],
				damage_immunities : "poison, psychic",
				condition_immunities : "charmed, exhaustion, poisoned, frightened",
				passivePerception : 10,
				senses : "Darkvision 60 ft",
				languages : "understands the languages of its creator but can't speak",
				challengeRating : "1/2",
				proficiencyBonus : 2,
				proficiencyBonusLinked : true,
				attacksAction : 1,
				attacks : [{
					name : "Force-Empowered Slam",
					ability : 6,
					damage : [1, 10, "force"],
					range : "Melee (5 ft)",
					modifiers : ["", "Prof"],
					abilitytodamage : false,
					useSpellMod : "bard"
				}],
				features : [{
					name : "Variable Size",
					description : "The item animated can be Large or smaller."
				}, {
					name : "Creator",
					description : "The item obeys the commands of its creator and has the same proficiency bonus. It takes its turn immediately after its creator, on the same initiative count. It can move and take reactions on its own, but only takes the Dodge action on its turn unless its creator takes a bonus action to command it to take another action. If its creator is incapacitated, it can take any action, not just Dodge."
				}],
				actions : [{
					name : "Immutable Form",
					description : "The item is immune to any spell or effect that would alter its form."
				}, {
					name : "Irrepressible Dance",
					description : "When any creature starts its turn within 10 ft of the item, the item can increase or decrease (its creator's choice) the walking speed of that creature by 10 ft until the end of the turn, provided the item isn't incapacitated."
				}],
				header : 'Animated',
				calcChanges : {
					hp : function (totalHD, HDobj, prefix) {
						if (!classes.known.bard) return;
						var brdLvl = classes.known.bard.level;
						var brdLvl5 = 5 * brdLvl;
						HDobj.alt.push(10 + brdLvl5);
						HDobj.altStr.push(" = 10 as a base\n + 5 \xD7 " + brdLvl + " from five times its creator's bard level (" + brdLvl5 + ")");
					},
					setAltHp : true
				}
			}]
		},
		"subclassfeature14" : {
			name : "Creative Crescendo",
			source : [["T", 29]],
			minlevel : 14,
			description : " [enhances Performance of Creation]"
		}
	}
});
// >>>>>>>>>>>>>>>>>>>>>> //
// >>> Cleric Options >>> //
// >>>>>>>>>>>>>>>>>>>>>> //

// Cleric Optional Class Features
AddFeatureChoice(ClassList.cleric.features.spellcasting, true, "Additional Cleric Spells", {
	name : "Additional Cleric Spells",
	extraname : "Optional Cleric 1",
	source : [["T", 30]],
	description : "",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "cleric" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["aura of vitality", "aura of life", "aura of purity", "sunbeam", "sunburst", "power word heal"]);
			},
			"This optional class feature expands the spell list of the cleric class with the following spells (spell level in brackets): Aura of Vitality (3), Aura of Life (4), Aura of Purity (4), Sunbeam (6), Sunburst (8), and Power Word Heal (9)."
		]
	}
}, "Optional 1st-level cleric features");
AddFeatureChoice(ClassList.cleric.features["channel divinity"], true, "Harness Divine Power", {
	name : "Channel Divinity: Harness Divine Power",
	extraname : "Optional Cleric 2",
	source : [["T", 30]],
	description : desc([
		"As a bonus action, I can expend a use of my channel divinity to regain one used spell slot",
		"The level of this spell slot can be no more than half my Proficiency Bonus (rounded up)",
		"I can only do this so many times per long rest, even if I have uses of channel divinity left"
	]),
	action : [["bonus action", ""]],
	usages : levels.map(function(n) {
		return n < 3 ? "" : n < 6 ? 1 : n < 18 ? 2 : 3;
	}),
	recovery : "long rest"
}, "Optional 2nd-level cleric features");
AddFeatureChoice(ClassList.cleric.features["turn undead"], true, "Cantrip Versatility", {
	name : "Cantrip Versatility",
	extraname : "Optional Cleric 4",
	source : [["T", 31]],
	description : " [ASI = Ability Score Improvement]\n   Whenever I gain an ASI from the cleric class, I can change one cleric cantrip for another",
	prereqeval : function (v) { return classes.known.cleric.level >= 4 ? true : "skip"; }
}, "Optional 4th-level cleric features");
// Cleric subclass alternative feature, so only run this after we are sure all subclasses have been added
RunFunctionAtEnd(function() {
	for (var i = 0; i < ClassList.cleric.subclasses[1].length; i++) {
		var domain = ClassList.cleric.subclasses[1][i];
		var objDomain = ClassSubList[domain];
		if (!objDomain || !objDomain.features.subclassfeature8 || !(/divine strike|potent spellcasting/i).test(objDomain.features.subclassfeature8.name)) continue;
		CreateClassFeatureVariant(domain, "subclassfeature8", "Blessed Strikes", {
			name : "Blessed Strikes",
			source : [["T", 31]],
			description : desc([
				"When my weapon attack or cantrip damages a creature, I can do +1d8 radiant damage",
				"Once I deal this extra damage, I can't do so again until the start of my next turn"
			]),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && (v.isWeapon || (v.thisWeapon[3] && SpellsList[v.thisWeapon[3]].level === 0)) && /\d/.test(fields.Damage_Die)) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per round +1d8 radiant damage';
						}
					},
					"Once per round, when a creature takes damage from one of my spell or weapon attacks, I can also deal 1d8 radiant damage to the target."
				]
			}
		});
	}
});

// Cleric Subclasses
AddSubClass("cleric", "peace domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*peace).*$/i,
	subname : "Peace Domain",
	source : [["T", 32]],
	spellcastingExtra : ["heroism", "sanctuary", "aid", "warding bond", "beacon of hope", "sending", "aura of purity", "otiluke's resilient sphere", "greater restoration", "rary's telepathic bond"],
	features : {
		"subclassfeature1" : {
			name : "Emboldening Bond",
			source : [["T", 33]],
			minlevel : 1,
			description : levels.map(function (n) {
				return desc([
					"As an action, I can magically bond my Prof Bonus of willing creatures I can see in 30 ft",
					"I can be one of the bonded creatures; The bond lasts for 10 min or until I use this again",
					"While within " + (n < 17 ? 30 : 60) + " ft of another, a bonded target can add +1d4 to a save, attack, or check",
					"Each creature can add the +1d4 only once per turn"
				]);
			}),
			action : [["action", ""]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature1.1" : {
			name : "Implement of Peace",
			description : "\n   " + "I gain proficiency in the Insight, Performance, or Persuasion skill (my choice)",
			skillstxt : "Choose one from: Insight, Performance, or Persuasion"
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Balm of Peace",
			source : [["T", 33]],
			minlevel : 2,
			description : desc([
				"As an action, I can move up to my speed without provoking opportunity attacks",
				"During this move, I can heal each creature that I come within 5 ft of once",
				"I restore a number of hit points equal to 2d6 + my Wisdom modifier (minimum 1 HP)"
			]),
			action : [["action", ""]]
		},
		"subclassfeature6" : {
			name : "Protective Bond",
			source : [["T", 33]],
			minlevel : 6,
			description : desc([
				"My Emboldening Bond now also helps those bonded to protect each other if within range",
				"When one is about to take damage, another bonded can use its reaction to teleport closer",
				"They teleport to an empty space within 5 ft of the first and take all the damage instead",
				"From 17th-level, they count as having resistance for this damage, thus take only half"
			]),
			additional : levels.map(function (n) {
				return n < 6 ? "" : "the bonded must be within " + (n < 17 ? 30 : 60) + " ft";
			})
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : [["T", 33]],
			minlevel : 8,
			description : desc("I add my Wisdom modifier to the damage I deal with my cleric cantrips"),
			calcChanges : GenericClassFeatures["potent spellcasting"].calcChanges
		},
		"subclassfeature17" : {
			name : "Expansive Bond",
			source : [["T", 33]],
			minlevel : 17,
			description : desc([
				"Emboldening and Protective Bond work when the bonded are within 60 ft of each other",
				"Protective Bond now also grants resistance when used to take damage for another"
			])
		}
	}
});
AddSubClass("cleric", "twilight domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(twilight|transition)).*$/i,
	subname : "Twilight Domain",
	source : [["T", 34]],
	spellcastingExtra : ["faerie fire", "sleep", "moonbeam", "see invisibility", "aura of vitality", "leomund's tiny hut", "aura of life", "greater invisibility", "circle of power", "mislead"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : [["T", 34]],
			minlevel : 1,
			description : "\n   I gain proficiency with martial weapons and heavy armor",
			armorProfs : [false, false, true, false],
			weaponProfs : [false, true]
		},
		"subclassfeature1.1" : {
			name : "Eyes of Night",
			source : [["T", 34]],
			minlevel : 1,
			description : desc([
				"I gain darkvision out to a range of 300 ft; As an action, I can grant others this as well",
				"I can grant it for 1 hour to my Wis mod (min 1) of willing targets I can see within 10 ft",
				"I can do this once per long rest, or by expending a spell slot (SS 1+)"
			]),
			action : [["action", " (grant others)"]],
			vision : [["Darkvision", 300]],
			additional : "grant others",
			usages : 1,
			recovery : "long rest",
			altResource : "SS 1+"
		},
		"subclassfeature1.2" : {
			name : "Vigilant Blessing",
			source : [["T", 35]],
			minlevel : 1,
			description : desc([
				"As an action, I can grant myself or a creature I touch adv. on the next initiative roll",
				"This benefit ends immediately after the roll or when I use this feature again"
			]),
			action : [["action", ""]]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Twilight Sanctuary",
			source : [["T", 35]],
			minlevel : 2,
			description : desc([
				"As an action, I can use my holy symbol to create a 30-ft radius sphere around myself",
				"It moves with me, is filled with dim light, and lasts for 1 min or until I'm incapacitated",
				"When a creature, including me, ends its turn inside the sphere, I can grant it a benefit:",
				" \u2022 I grant it temporary hit points equal to 1d6 + my cleric level",
				" \u2022 I end one effect on it causing it to be charmed or frightened",
				"From 17th-level onwards, me and my allies have half cover while inside the sphere"
			]),
			action : [["action", ""]],
			additional : levels.map(function(n) {
				return n < 2 ? "" : "1d6 + " + n + " temp HP";
			}),
		},
		"subclassfeature6" : {
			name : "Steps of Night",
			source : [["T", 35]],
			minlevel : 6,
			description : desc([
				"As a bonus action when I'm in dim light or darkness, I can magically grant myself flight",
				"I gain a flying speed equal to my walking speed for 1 minute"
			]),
			action : [["bonus action", ""]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : [["T", 35]],
			minlevel : 8,
			description : "\n  Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 radiant damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && v.isWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 radiant damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra radiant damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Twilight Shroud",
			source : [["T", 35]],
			minlevel : 17,
			description : desc([
				"Me and my allies have half cover while in the sphere created by my Twilight Sanctuary"
			])
		}
	}
});


// >>>>>>>>>>>>>>>>>>>>> //
// >>> Druid Options >>> //
// >>>>>>>>>>>>>>>>>>>>> //

// Druid Optional Class Features
AddFeatureChoice(ClassList.druid.features.spellcasting, true, "Additional Druid Spells", {
	name : "Additional Druid Spells",
	extraname : "Optional Druid 1",
	source : [["T", 35]],
	description : "",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "druid" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["protection from evil and good", "augury", "continual flame", "enlarge/reduce", "aura of vitality", "elemental weapon", "revivify", "divination", "fire shield", "cone of cold", "flesh to stone", "symbol", "incendiary cloud"]);
			},
			"This optional class feature expands the spell list of the druid class with the following spells (spell level in brackets): Protection from Evil and Good (1), Augury (2), Continual Flame (2), Enlarge/Reduce (2), Aura of Vitality (3), Elemental Weapon (3), Revivify (3), Divination (4), Fire Shield (4), Cone of Cold (5), Flesh to Stone (6), Symbol (7), and Incendiary Cloud (8)."
		]
	}
}, "Optional 1st-level druid features");
var TCoE_Wild_Companion = {
	name : "Wild Companion",
	extraname : "Optional Druid 2",
	source : [["T", 35], ["UA:CFV", 4]],
	description : desc([
		"I can expend a use of wild shape to cast Find Familiar without material components",
		"The familiar always has the Fey type and disappears after half my druid level in hours"
	]),
	additional : levels.map(function (n) {
		return n < 2 ? "" : Math.floor(n/2) + " hours";
	}),
	spellcastingBonus : {
		name : "Wild Companion",
		spells : ["find familiar"],
		selection : ["find familiar"],
		firstCol : "Sp"
	},
	spellChanges : {
		"find familiar" : {
			components : "V,S",
			compMaterial : "",
			description : "Gain the services of a fey familiar; can see through its eyes; it can deliver touch spells; see B",
			duration : "\u00BD druid lvl h",
			changes : "By using my Wild Companion class feature, I can expend a use of wild shape to cast Find Familiar without material components. The familiar created this way always has the Fey type and disappears after a number of hours equal to half my druid level."
		}
	}
}
AddFeatureChoice(ClassList.druid.features["subclassfeature2.wild shape"], true, "Wild Companion", TCoE_Wild_Companion, "Optional 2nd-level druid features");
if (ClassSubList["druid-circle of the moon"]) {
	AddFeatureChoice(ClassSubList["druid-circle of the moon"].features["subclassfeature2.wild shape"], true, "Wild Companion", TCoE_Wild_Companion, "Optional 2nd-level druid features");
}
AddFeatureChoice(ClassList.druid.features.druidic, true, "Cantrip Versatility", {
	name : "Cantrip Versatility",
	extraname : "Optional Druid 4",
	source : [["T", 35]],
	description : " [ASI = Ability Score Improvement]\n   Whenever I gain an ASI from the druid class, I can change one druid cantrip for another",
	prereqeval : function (v) { return classes.known.druid.level >= 4 ? true : "skip"; }
}, "Optional 4th-level druid features");

// Druid Subclasses
AddSubClass("druid", "circle of the stars", {
	regExpSearch : /^(?=.*(druid|shaman))(?=.*circle)(?=.*stars).*$/i,
	subname : "Circle of the Stars",
	source : [["T", 38]],
	features : {
		"subclassfeature2" : {
			name : "Star Map",
			source : [["T", 38]],
			minlevel : 2,
			description : desc([
				"I've created a star map, a Tiny object which I can use as my spellcasting focus",
				"If I lose it, I can perform a 1-hour ceremony during a rest to create a replacement",
				"While holding it, I know the Guidance cantrip and always have Guiding Bolt prepared",
				"These count as druid spells, but do not count against the number of spells I can prepare",
				"I can cast Guiding Bolt without expending a spell slot my Proficiency Bonus per long rest"
			]),
			spellcastingBonus : [{
				name : "Star Map",
				spells : ["guidance"],
				selection : ["guidance"],
				firstCol : "atwill"
			}, {
				name : "Star Map",
				spells : ["guiding bolt"],
				selection : ["guiding bolt"],
				firstCol : "Sp"
			}],
			additional : "Guiding Bolt",
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature2.1" : {
			name : "Starry Form",
			source : [["T", 38]],
			minlevel : 2,
			description : desc([
				"As a bonus action, I can expend a use of wild shape to take on a starry form for 10 min",
				"In that form I shed bright light in a 10-ft radius and dim light for an extra 10-ft radius",
				"When I do so, I choose one constellation that glimmers on my body, granting me benefits",
				"See the 3rd page's \"Notes\" section for the benefits of the possible constellations"
			]),
			weaponOptions : [{
				regExpSearch : /^(?=.*luminous)(?=.*arrow).*$/i,
				name : "Luminous Arrow",
				source : [["T", 38]],
				ability : 5,
				type : "Spell",
				damage : [1, 8, "radiant"],
				range : "60 ft",
				description : "Use as bonus action",
				abilitytodamage : true,
				useSpellMod : "druid",
				luminousarrow : true,
				selectNow : true
			}],
			extraname : "Starry Form",
			"archer constellation" : {
				name : "Archer Constellation",
				source : [["T", 38]],
				description : desc([
					"As a bonus action, I can make a ranged spell attack to hurl a luminous arrow 60 ft",
					"I can also do this as part of the bonus action I use to assume the starry form"
				]),
				additional : levels.map(function (n) {
					return n < 2 ? "" : (n < 10 ? 1 : 2) + "d8 + Wisdom modifier radiant damage";
				}),
				action : [["bonus action", " (Luminous Arrow)"]]
			},
			"chalice constellation" : {
				name : "Chalice Constellation",
				source : [["T", 39]],
				description : desc([
					"When I cast a healing spell with a spell slot, I can heal myself or another within 30 ft of me"
				]),
				additional : levels.map(function (n) {
					return n < 2 ? "" : (n < 10 ? 1 : 2) + "d8 + Wisdom modifier hit points restored";
				})
			},
			"dragon constellation" : {
				name : "Dragon Constellation",
				source : [["T", 39]],
				description : desc([
					"I can treat a roll below 10 as a 10 for Int/Wis checks and saves to maintain concentration",
					"From 10th-level onwards, I also gain a flying speed of 20 ft and can hover"
				])
			},
			autoSelectExtrachoices : [{
				extrachoice : "archer constellation"
			}, {
				extrachoice : "chalice constellation"
			}, {
				extrachoice : "dragon constellation"
			}]
		},
		"subclassfeature6" : {
			name : "Cosmic Omen",
			source : [["T", 39]],
			minlevel : 6,
			description : desc([
				"When I finish a long rest, I roll a die to gain an omen based on the result (odd/even)",
				"As a reaction when a creature I can see in 30 ft makes an attack, check, or save, I can:",
				" \u2022 Weal (even): add 1d6 to the number rolled for the attack, check, or save",
				" \u2022 Woe (odd): subtract 1d6 from the number rolled for the attack, check, or save"
			]),
			action : [["reaction", ""]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature10" : {
			name : "Twinkling Constellations",
			source : [["T", 39]],
			minlevel : 10,
			description : desc([
				"While in my starry form, I can change the constellation at the start of each of my turns",
				"The benefit of my constellations improve, see the 3rd page's \"Notes\" section"
			]),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.theWea.luminousarrow && fields.Damage_Die.indexOf('1d8') !== -1) {
							fields.Damage_Die = fields.Damage_Die.replace('1d8', '2d8');
						};
					},
					'',
					1
				]
			}
		},
		"subclassfeature14" : {
			name : "Full of Stars",
			source : [["T", 39]],
			minlevel : 14,
			description : "\n   While in my starry form, I have resistance to bludgeoning, piercing, and slashing damage",
			dmgres : [
				["Bludgeoning", "Bludgeon. (in form)"],
				["Piercing", "Piercing (in form)"],
				["Slashing", "Slashing (in form)"]
			]
		}
	}
});
AddSubClass("druid", "circle of wildfire", {
	regExpSearch : /^(?=.*(druid|shaman))(?=.*wild.{0,1}fire).*$/i,
	subname : "Circle of Wildfire",
	source : [["T", 39]],
	features : {
		"subclassfeature2" : {
			name : "Circle Spells",
			source : [["T", 39]],
			minlevel : 2,
			description : desc([
				"My link to a wildfire spirit grants me access to spells, which count as druid spells to me",
				"These are always prepared, but don't count against the number of spells I can prepare"
			]),
			spellcastingExtra : ["burning hands", "cure wounds", "flaming sphere", "scorching ray", "plant growth","revivify", "aura of life", "fire shield", "flame strike", "mass cure wounds"]
		},
		"subclassfeature2.1" : {
			name : "Summon Wildfire Spirit",
			source : [["T", 40]],
			minlevel : 2,
			description : desc([
				"As an action, I can expend a use of wild shape to summon a wildfire spirit within 30 ft",
				"All within 10 ft of where it manifests must make a Dex save or take 2d10 fire damage",
				"It is friendly and obeys my commands; It lasts for 1 hour, until it has 0 HP, or I die",
				"Unless I use a bonus action to command it, it only takes the Dodge action on its turn",
				"It can always take reactions and move on its turn; It acts on my initiative, after me",
				'It disappears if I summon another; See "Wildfire Spirit" on a companion page for its stats',
			]),
			action : [["action", ""], ["bonus action", "Command Wildfire Spirit"]],
			creaturesAdd : [["Wildfire Spirit", true]],
			creatureOptions : [{
				name : "Wildfire Spirit",
				source : [["T", 40]],
				size : 4,
				type : "Elemental",
				alignment : "",
				ac : 13,
				hp : 20,
				hd : [],
				speed : "30 ft, fly 30 ft (hover)",
				scores : [10, 14, 14, 13, 15, 11],
				damage_immunities : "fire",
				condition_immunities : "charmed, frightened, grappled, prone, restrained",
				senses : "Darkvision 60 ft",
				passivePerception : 12,
				languages : "understands the languages of its creator",
				challengeRating : "1/2",
				proficiencyBonus : 2,
				proficiencyBonusLinked : true,
				attacksAction : 1,
				attacks : [{
					name : "Flame Seed",
					ability : 5,
					damage : [1, 6, "fire"],
					range : "60 ft",
					description : "Ranged weapon attack",
					modifiers : ["", "Prof"],
					abilitytodamage : false,
					useSpellMod : "druid"
				}, {
					name : "Fiery Teleportation",
					ability : 5,
					damage : [1, 6, "fire"],
					range : "5-ft radius",
					description : "Dex save for all within 5 ft of teleportation origin, success - no damage; See traits",
					dc : true,
					modifiers : ["", "Prof"],
					abilitytodamage : false,
					useSpellMod : "druid"
				}, {
					name : "Fiery Manifestation",
					ability : 5,
					damage : [2, 6, "fire"],
					range : "10-ft radius",
					description : "Dex save for all within 10 ft where spirit is summoned, success - no damage",
					dc : true,
					abilitytodamage : false,
					useSpellMod : "druid"
				}],
				features : [{
					name : "Creator",
					description : "The spirit obeys the commands of its creator and has the same proficiency bonus. It takes its turn immediately after its creator, on the same initiative count. It can move and take reactions on its own, but only takes the Dodge action on its turn unless its creator takes a bonus action to command it to take another action. If its creator is incapacitated, it can take any action, not just Dodge."
				}],
				actions : [{
					name : "Fiery Teleportation",
					description : "The spirit and each willing creature of its creator's choice within 5 ft of it teleport up to 15 ft to unoccupied spaces its creator can see. Then each creature within 5 ft of the space that the spirit left must succeed on a Dexterity saving throw against its creator's spell save DC or take fire damage equal to 1d6 + its proficiency bonus."
				}],
				traits : [{
					name : "Fiery Manifestation",
					description : "The spirit appears in an unoccupied space of its creator's choice that its creator can see within 30 ft. Each creature within 10 ft of the spirit (other than its creator) when it appears must succeed on a Dexterity saving throw against its creator's spell save DC or take 2d6 fire damage."
				}],
				header : "Wildfire",
				calcChanges : {
					hp : function (totalHD, HDobj, prefix) {
						if (!classes.known.druid) return;
						var drdLvl = classes.known.druid.level;
						var drdLvl5 = 5 * drdLvl;
						HDobj.alt.push(5 + drdLvl5);
						HDobj.altStr.push(" = 10 as a base\n + 5 \xD7 " + drdLvl + " from five times its creator's druid level (" + drdLvl5 + ")");
					},
					setAltHp : true
				}
			}]
		},
		"subclassfeature6" : {
			name : "Enhanced Bond",
			source : [["T", 40]],
			minlevel : 6,
			description : desc([
				"While my wildfire spirit is present, I can have my spells originate from it (no range 'self')",
				"Also, I can then add 1d8 to a single roll of my spells that restore HP or deal fire damage"
			])
		},
		"subclassfeature10" : {
			name : "Cauterizing Flames",
			source : [["T", 40]],
			minlevel : 10,
			description : desc([
				"As a reaction when a Small or larger creature dies within 30 ft of me or wildfire spirit,",
				"I can have a spectral flame erupt in its space that lasts for 1 minute",
				"As a reaction when I see a creature enter the flame's space, I can extinguish the flame",
				"This heals or deals fire damage to the creature (my choice) equal to 2d10 + my Wis mod"
			]),
			action : [["reaction", ""]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature14" : {
			name : "Blazing Revival",
			source : [["T", 40]],
			minlevel : 14,
			description : desc([
				"If I drop to 0 HP and don't die, and my wildfire spirit is within 120 ft, it can save me",
				"I can have it drop to 0 HP; I then regain half my HP and immediately rise to my feet"
			]),
			usages : 1,
			recovery : "long rest"
		}
	}
});


// >>>>>>>>>>>>>>>>>>>>>>> //
// >>> Fighter Options >>> //
// >>>>>>>>>>>>>>>>>>>>>>> //

// Fighter Optional Class Features
AddFightingStyle(["fighter", "ranger", "paladin"], "Blind Fighting", {
	name : "Blind Fighting Style",
	source : [["T", 41]],
	description : desc([
		"I have blindsight with 10 ft range, allowing me to see anything not behind total cover",
		"In range, I can see invisible, but not hidden, things, even when blinded or in darkness"
	]),
	vision : [["Blindsight", 10]]
});
AddFightingStyle(["fighter", "paladin"], "Interception", {
	name : "Interception Fighting Style",
	source : [["T", 41], ["UA:CFV", 12]],
	description : desc([
		"As a reaction when a creature I can see hits another within 5 ft of me, I can intercept",
		"I reduce the damage the target takes by 1d10 + my Proficiency Bonus (min 0 damage)",
		"I can't be the target and it requires me wielding a shield or a simple or martial weapon"
	]),
	action : [["reaction", ""]]
});
AddFightingStyle(["fighter", "ranger"], "Thrown Weapon Fighting", {
	name : "Thrown Weapon Fighting Style",
	source : [["T", 42]],
	description : desc([
		"I can draw a weapon with the thrown property as part of the attack I make with it",
		"In addition, my ranged attacks made with thrown weapons deal +2 damage"
	]),
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.isThrownWeapon && v.isMeleeWeapon) {
					fields.Description += (fields.Description ? '; ' : '') + '+2 damage when thrown';
				};
			},
			"I deal +2 damage when I hit a ranged attack made with a thrown weapon."
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isThrownWeapon && !v.isMeleeWeapon) {
					output.extraDmg += 2;
				};
			},
			""
		]
	}
});
AddFightingStyle(["fighter"], "Unarmed Fighting", {
	name : "Unarmed Fighting Style",
	source : [["T", 42]],
	description : desc([
		"My unarmed strikes deal 1d6 damage, or 1d8 damage when I have both hands free",
		"At the start of my turn, I can deal 1d4 bludgeoning damage to one target I'm grappling"
	]),
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == "unarmed strike") {
					if (fields.Damage_Die == 1 || fields.Damage_Die == "1d4") fields.Damage_Die = '1d6';
					fields.Description += (fields.Description ? '; ' : '') + 'Versatile (d8)';
				};
			},
			"My unarmed strikes deal 1d6 damage instead of 1, which increases to 1d8 if I have both hands free to make an unarmed strike with.",
			1
		]
	}
});
AddFeatureChoice(ClassList.fighter.features['action surge'], true, "Martial Versatility", {
	name : "Martial Versatility",
	extraname : "Optional Fighter 4",
	source : [["T", 42]],
	description : " [ASI = Ability Score Improvement]\n   Whenever I gain an ASI from the fighter class, I can change a fighting style or a maneuver",
	prereqeval : function (v) { return classes.known.fighter.level >= 4 ? true : "skip"; }
}, "Optional 4th-level fighter features");
// Fighter alternative class features and enhancements (only if Battle Master subclass exists)
if (ClassSubList["fighter-battle master"]) {
	AddFightingStyle(["fighter"], "Superior Technique", {
		name : "Superior Technique",
		source : [["T", 41], ["UA:CFV", 5]],
		description : " [1 maneuver; d6, 1\xD7 per short rest]" + desc([
			"I gain one superiority die (d6) that I can expend to fuel a special Maneuver",
			"I can only use one Maneuver per attack; DCs are 8 + Prof B. + Str/Dex mod, my choice",
			'Use the "Choose Feature" button above to add a Maneuver to the third page'
		]),
		bonusClassExtrachoices : [{
			"class" : "fighter",
			"subclass" : "fighter-battle master",
			"feature" : "subclassfeature3.1",
			"bonus" : 1
		}],
		extraLimitedFeatures : [{
			name : "Combat Superiority",
			usages : 1,
			additional : 'd6',
			recovery : "short rest",
			addToExisting : true
		}]
	});
	// New Maneuver options
	AddFeatureChoice(ClassSubList["fighter-battle master"].features["subclassfeature3.1"], true, "Ambush", {
		name : "Ambush",
		source : [["T", 42], ["UA:CFV", 5]],
		description : desc([
			"When I make an initiative roll or a Dex (Stealth) check, I can add a superiority die to it",
			"I can't do this if I'm incapacitated"
		])
	});
	AddFeatureChoice(ClassSubList["fighter-battle master"].features["subclassfeature3.1"], true, "Bait and Switch", {
		name : "Bait and Switch",
		source : [["T", 42]],
		description : desc([
			"On my turn, I can expend a superiority die to swap places with an ally within 5 ft",
			"I can't do this if the ally is incapacitated or unwilling to swap",
			"Doing this costs me 5 ft of movement, but this doesn't provoke opportunity attacks",
			"Me or my ally (my choice) can then add the superiority die to AC until my next turn starts"
		])
	});
	AddFeatureChoice(ClassSubList["fighter-battle master"].features["subclassfeature3.1"], true, "Brace", {
		name : "Brace",
		source : [["T", 42]],
		description : desc([
			"As a reaction when a creature I can see moves within my melee reach, I can attack it",
			"I expend a superiority die and make one weapon attack, adding the die to the damage"
		]),
		action : [["reaction", ""]]
	});
	AddFeatureChoice(ClassSubList["fighter-battle master"].features["subclassfeature3.1"], true, "Commanding Presence", {
		name : "Commanding Presence",
		source : [["T", 42]],
		description : "\n   When I make a Performance, Intimidation, or Persuasion check, I can add a superiority die"
	});
	AddFeatureChoice(ClassSubList["fighter-battle master"].features["subclassfeature3.1"], true, "Grappling Strike", {
		name : "Grappling Strike",
		source : [["T", 42]],
		description : desc([
			"Immediately after hitting with a melee attack, I can use a bonus action to try to grapple",
			"I add the superiority die to the Str (Athletics) check; I can only do this on my own turn"
		]),
		action : [["bonus action", " (after melee hit)"]]
	});
	AddFeatureChoice(ClassSubList["fighter-battle master"].features["subclassfeature3.1"], true, "Quick Toss", {
		name : "Quick Toss",
		source : [["T", 42]],
		description : desc([
			"As a bonus action, I can use a superiority die to do a ranged attack with a thrown weapon",
			"I can draw a thrown weapon as part of making this attack; I add the die to the damage"
		]),
		action : [["bonus action", ""]]
	});
	AddFeatureChoice(ClassSubList["fighter-battle master"].features["subclassfeature3.1"], true, "Tactical Assessment", {
		name : "Tactical Assessment",
		source : [["T", 42]],
		description : "\n   When I make an Investigation, History, or Insight check, I can add a superiority die to it"
	});
}

// Fighter Subclasses
AddSubClass("fighter", "psi warrior", {
	regExpSearch : /^(?=.*\bpsi(onic)?s?\b)(?=.*warrior).*$/i,
	subname : "Psi Warrior",
	source : [["T", 42]],
	fullname : "Psi Warrior",
	abilitySave : 4,
	features : {
		"subclassfeature3" : {
			name : "Psionic Energy Dice",
			source : [["T", 43]],
			minlevel : 3,
			description : desc([
				"I gain twice my proficiency bonus of psionic energy dice (PsiD) that fuel my psionics",
				"I regain all expended psionic energy dice after a long rest",
				"As a bonus action once per short rest, I can regain one expended psionic energy die"
			]),
			additional : levels.map(function(n) {
				return n < 3 ? "" : n < 5 ? "d6" : n < 11 ? "d8" : n < 17 ? "d10" : "d12";
			}),
			action : [["bonus action", "Regain 1 Psionic Energy Die"]],
			usages : "Proficiency Bonus \xD7 2 per ",
			usagescalc : "event.value = Number(How('Proficiency Bonus'))*2",
			recovery : "long rest",
			extraLimitedFeatures : [{
				name : "Regain 1 Psionic Energy die",
				usages : 1,
				recovery : "short rest"
			}]
		},
		"subclassfeature3.1" : {
			name : "Psionic Power: Protective Field",
			source : [["T", 43]],
			minlevel : 3,
			description : " [1 psionic energy die]" + desc([
				"As a reaction when I or a creature I can see within 30 ft takes damage, I can reduce it",
				"I reduce the damage by the roll of the one psionic energy die I expend + my Int mod"
			]),
			action : [["reaction", "Protective Field"]]
		},
		"subclassfeature3.2" : {
			name : "Psionic Power: Psionic Strike",
			source : [["T", 43]],
			minlevel : 3,
			description : " [1 psionic energy die]" + desc([
				"Once on each of my turns after I hit a target in 30 ft and damage it with a weapon,",
				"I can expend a psionic energy die to deal it the die roll + my Int mod in force damage"
			])
		},
		"subclassfeature3.3" : {
			name : "Psionic Power: Telekinetic Movement",
			source : [["T", 43]],
			minlevel : 3,
			description : desc([
				"As an action, I can move a Large or smaller loose object or one willing creature in 30 ft",
				"I must be able to see the target and can move it up to 30 ft to an empty space I can see",
				"If it is a Tiny object, I can also move it to or from my hand; I can't move myself this way",
				"I can do this once per short rest, or by expending a psionic energy die (PsiD)"
			]),
			limfeaname : "Telekinetic Movement",
			action : [["action", ""]],
			usages : 1,
			recovery : "short rest",
			altResource : "PsiD"
		},
		"subclassfeature7.1" : {
			name : "Telekinetic Adept: Psi-Powered Leap",
			source : [["T", 43]],
			minlevel : 7,
			description : desc([
				"As a bonus action, I gain a flying speed of twice my walking speed until the turn ends",
				"I can do this once per short rest, or by expending a psionic energy die (PsiD)"
			]),
			limfeaname : "Psi-Powered Leap",
			action : [["bonus action", ""]],
			usages : 1,
			recovery : "short rest",
			altResource : "PsiD"
		},
		"subclassfeature7.2" : {
			name : "Telekinetic Adept: Telekinetic Thrust",
			source : [["T", 43]],
			minlevel : 7,
			description : " [DC 8 + Prof B. + Int mod]" + desc([
				"When I deal damage with my Psionic Strike, I can have the target make a Strength save",
				"If failed, I knock the target prone or move it up to 10 ft in any direction horizontally"
			]),
		},
		"subclassfeature10" : {
			name : "Guarded Mind",
			source : [["T", 43]],
			minlevel : 10,
			description : desc([
				"I can expend a psionic energy die to end all effects on me causing charmed or frightened",
				"I can do this if at the start of my turn; I also gain resistance to psychic damage"
			]),
			dmgres : ["Psychic"]
		},
		"subclassfeature15" : {
			name : "Bulwark of Force",
			source : [["T", 44]],
			minlevel : 15,
			description : desc([
				"As a bonus action, I can choose up to my Int mod of creatures (min 1) I can see in 30 ft",
				"This can include me; Each chosen gains half cover for 1 minute or until I'm incapacitated",
				"I can do this once per long rest, or by expending a psionic energy die (PsiD)"
			]),
			action : [["bonus action", ""]],
			usages : 1,
			recovery : "long rest",
			altResource : "PsiD"
		},
		"subclassfeature18" : {
			name : "Telekinetic Master",
			source : [["T", 44]],
			minlevel : 18,
			description : desc([
				"I can cast Telekinesis, requiring no spell slot or components, with Int spellcasting ability",
				"As a bonus action while concentrating on this spell, I can make one weapon attack",
				"I can cast Telekinesis once per long rest, or by expending a psionic energy die (PsiD)"
			]),
			spellcastingBonus : {
				name : "Telekinetic Master",
				spells : ["telekinesis"],
				selection : ["telekinesis"],
				firstCol : "Sp"
			},
			spellChanges : {
				"telekinesis" : {
					components : "",
					changes : "Using Telekinetic Master, I can cast Telekinesis without requiring components or spell slots."
				}
			},
			action : [["bonus action", "Weapon Attack while Telekinesis conc."]],
			usages : 1,
			recovery : "long rest",
			altResource : "PsiD"
		}
	}
});
AddSubClass("fighter", "rune knight", {
	regExpSearch : /^(?=.*rune)(?=.*knight).*$/i,
	subname : "Rune Knight",
	source : [["T", 44]],
	fullname : "Rune Knight",
	abilitySave : 3,
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : [["T", 44]],
			minlevel : 3,
			description : "\n   I gain proficiency with smith's tools and I learn to speak, read, and write Giant",
			toolProfs : ["Smith's tools"],
			languageProfs : ["Giant"]
		},
		"subclassfeature3.1" : {
			name : "Rune Carver",
			source : [["T", 44]],
			minlevel : 3,
			description : desc([
				"I learn how to use magic runes to enhance my gear that I can wear or hold in my hand",
				'Use the "Choose Feature" button above to select a rune and add it to the third page',
				"When I finish a long rest, I can inscribe each rune I know upon a different item I touch",
				"Each item can hold only one rune and remains there until I finish a long rest",
				"Runes inscribed on a carried object grant both a passive and a limited-use active effect",
				"Whenever I gain a fighter level, I can swap a rune I know for another",
				"The DC for a rune's abilities is 8 + my Proficiency bonus + my Constitution modifier"
			]),
			additional : levels.map(function (n){
				return n < 3 ? "" : (n < 7 ? 2 : n < 10 ? 3 : n < 15 ? 4 : 5) + " runes known"
			}),
			extraTimes : levels.map(function (n) {
				return n < 3 ? 0 : n < 7 ? 2 : n < 10 ? 3 : n < 15 ? 4 : 5;
			}),
			extraname : "Rune Knight 3",
			extrachoices : ["Cloud Rune", "Fire Rune", "Frost Rune", "Stone Rune", "Hill Rune (prereq: level 7 fighter)", "Storm Rune (prereq: level 7 fighter)"],
			"cloud rune" : {
				name : "Cloud Rune",
				source : [["T", 44]],
				description : desc([
					"While I wear an object inscribed with this, I gain a deceptiveness reminiscent of cloud giants",
					"I always gain advantage on Dexterity (Sleight of Hand) and Charisma (Deception) checks",
					"As a reaction when I or another I can see within 30 ft is hit by an attack, I can invoke this",
					"I select another target for the attack within 30 ft of me, using the same roll (ignore range)"
				]),
				action : [["reaction", " (invoke)"]],
				additional : "invoke",
				usages : ["", "", 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2],
				recovery : "short rest",
				advantages : [ ["Sleight of Hand", true], ["Deception", true] ]
			},
			"fire rune" : {
				name : "Fire Rune",
				source : [["T", 44]],
				description : desc([
					"While I wear an object inscribed with this, I gain craftsmanship reminiscent of great smiths",
					"I always double my proficiency bonus when making an ability check with a tool",
					"When I hit a creature with a weapon attack, I can invoke it to summon fiery shackles",
					"It takes an extra 2d6 fire damage and must make a Str save or be restrained for 1 min",
					"While restrained, the creature takes 2d6 fire damage at the start of each of its turns",
					"It can repeat the save at the end of each of its turns, banishing the shackles on a success"
				]),
				additional : "invoke",
				usages : ["", "", 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2],
				recovery : "short rest",
				skillstxt : "expertise with all tools I am proficient with",
				eval : function () { Checkbox('Too Exp', true); },
				removeeval : function () { Checkbox('Too Exp', false); }
			},
			"frost rune" : {
				name : "Frost Rune",
				source : [["T", 45]],
				description : desc([
					"While I wear an object inscribed with this, I gain might of those surviving wintry wilderness",
					"I always gain advantage on Wisdom (Animal Handling) and Charisma (Intimidation) checks",
					"As a bonus action, I can invoke this to gain +2 on Str and Con checks and saves for 10 min"
				]),
				action : [["bonus action", " (invoke)"]],
				additional : "invoke",
				usages : ["", "", 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2],
				recovery : "short rest",
				advantages : [ ["Animal Handling", true], ["Intimidation", true] ]
			},
			"stone rune" : {
				name : "Stone Rune",
				source : [["T", 45]],
				description : desc([
					"While I wear an object inscribed with this, I gain judiciousness reminiscent of stone giants",
					"I always gain advantage on Wisdom (Insight) checks and I gain darkvision out to 120 ft",
					"As a reaction when a creature I can see ends it turn within 30 ft, I can invoke this rune",
					"This causes the creature to make a Wisdom save or be charmed by me for 1 minute",
					"While charmed, it descends into a dreamy stupor, becoming incapacitated and has speed 0",
					"It can repeat the save at the end of each of its turns, ending the effect on a success"
				]),
				action : [["reaction", " (invoke)"]],
				additional : "invoke",
				usages : ["", "", 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2],
				recovery : "short rest",
				vision : [["Darkvision", 120]],
				advantages : [ ["Insight", true] ]
			},
			"hill rune (prereq: level 7 fighter)" : {
				name : "Hill Rune",
				source : [["T", 45]],
				description : desc([
					"While I wear an object inscribed with this rune, I gain a resilience reminiscent of hill giants",
					"I always gain advantage on saves against being poisoned and resistance to poison damage",
					"As a bonus action, I can invoke it to gain resistance to bludg/slash/pierc damage for 1 min"
				]),
				prereqeval : function(v) { return classes.known.fighter.level >= 7; },
				action : [["bonus action", " (invoke)"]],
				additional : "invoke",
				usages : ["", "", 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2],
				recovery : "short rest",
				dmgres : ["Poison"],
				savetxt : { adv_vs : ["poison"] }
			},
			"storm rune (prereq: level 7 fighter)" : {
				name : "Storm Rune",
				source : [["T", 45]],
				description : desc([
					"While I wear an object inscribed with this rune, I can glimpse the future like storm giants",
					"I always gain adv. on Int (Arcana) checks and I can't be surprised while not incapacitated",
					"As a bonus action, I can invoke it to enter a prophetic state for 1 min or till incapacitated",
					"While in this state, I can use a reaction to cause a roll to gain advantage or disadvantage",
					"I can do this for attacks, saves, and checks of myself or others I can see within 60 ft of me"
				]),
				prereqeval : function(v) { return classes.known.fighter.level >= 7; },
				action : [["bonus action", " (invoke)"]],
				additional : "invoke",
				usages : ["", "", 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2],
				recovery : "short rest",
				advantages : [ ["Arcana", true] ],
				savetxt : { immune : ["surprised"] },
			}
		},
		"subclassfeature3.2" : {
			name : "Giant's Might",
			source : [["T", 45]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can imbue myself with giant magic for 1 minute and gain benefits:",
				" \u2022 Space permitted, I grow to a larger size category along with everything I'm wearing",
				" \u2022 I have advantage on my Strength check and saves",
				" \u2022 My weapon and unarmed strike attacks deal extra damage"
			]),
			additional : levels.map(function (n) {
				return n < 3 ? "" : (n < 18 ? "Large" : "Huge") + ", +1d" + (n < 10 ? 6 : n < 18 ? 8 : 10) + " damage"
			}),
			action : [["bonus action", ""]],
			savetxt : { text : ["Adv. on Str saves in Giant's Might"] },
			usages : "Prof Bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.fighter && classes.known.fighter.level >= 3 && v.isWeapon && (/giant('s)? might/i).test(v.WeaponTextName)) {
							var GMdmgDie = classes.known.fighter.level < 10 ? 'd6' : classes.known.fighter.level < 18 ? 'd8' : 'd10';
							var dmgDieRx = RegExp('(\\d+)' + GMdmgDie, 'i');
							if (dmgDieRx.test(fields.Damage_Die)) {
								var dmgDieMatch = fields.Damage_Die.match(dmgDieRx);
								fields.Damage_Die = fields.Damage_Die.replace(dmgDieRx, Number(dmgDieMatch[1]) + 1 + GMdmgDie);
								fields.Description = fields.Description.replace(/Versatile \((\d+d\d+)\)/i, 'Versatile ($1+1' + GMdmgDie + ')');
							} else if (!isNaN(fields.Damage_Die)) {
								fields.Damage_Die = 1 + GMdmgDie + "+" + fields.Damage_Die;
							} else {
								fields.Description += (fields.Description ? '; ' : '') + '+1' + GMdmgDie + ' damage';
							}
							if (classes.known.fighter.level >= 18 && v.isMeleeWeapon) fields.Description += (fields.Description ? '; ' : '') + '+5 ft reach';
						};
					},
					"If I include the words \"Giant Might\" in the name of a weapon or unarmed strike, it gets treated as a weapon that I use while imbued by my Giant's Might feature. It adds +1d6 weapon damage. From 10th-level onwards, this increases to +1d8 damage. From 18th-level onwards, this increases to +1d10 damage and my reach increases by 5 ft (for melee weapons).",
					8
				]
			}
		},
		"subclassfeature7" : {
			name : "Runic Shield",
			source : [["T", 45]],
			minlevel : 7,
			description : desc([
				"As a reaction when I see a creature within 60 ft get hit by an attack, I can protect it",
				"The attacker must reroll its attack roll and use the new roll"
			]),
			action : [["reaction", ""]]
		},
		"subclassfeature10" : {
			name : "Great Stature",
			source : [["T", 46]],
			minlevel : 10,
			description : desc([
				"My runes permanently make me grow; I add 3d4 inches to my length",
				"In addition, the extra weapon damage I deal with Giant Might increases to 1d8"
			])
		},
		"subclassfeature15" : {
			name : "Master of Runes",
			source : [["T", 46]],
			minlevel : 15,
			description : "\n   I can now invoke each of my runes twice per short rest instead of once"
		},
		"subclassfeature18" : {
			name : "Runic Juggernaut",
			source : [["T", 46]],
			minlevel : 18,
			description : desc([
				"Giant's Might now adds +1d10 weapon damage, and can make me grow up to Huge",
				"While I'm Huge, my reach increases by 5 ft"
			])
		}
	}
});


// >>>>>>>>>>>>>>>>>>>> //
// >>> Monk Options >>> //
// >>>>>>>>>>>>>>>>>>>> //

// Monk Optional Class Features
AddFeatureChoice(ClassList.monk.features.ki, true, "Dedicated Weapon", {
	name : "Dedicated Weapon",
	extraname : "Optional Monk 2",
	source : [["T", 48]],
	description : desc([
		"When I finish a short or long rest, I can focus ki and touch one simple or martial weapon",
		"From then on, until I use this feature again, this weapon counts as a monk weapon for me",
		"I have to be proficient with the weapon and it can't have the heavy or special property"
	]),
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.monkweapon && !v.theWea.special && classes.known.monk && classes.known.monk.level && (/dedicated/i).test(v.WeaponTextName) && fields.Proficiency && (/simple|martial/i).test(v.theWea.type) && !(/\b(heavy|special)\b/i).test(fields.Description)) {
					v.theWea.monkweapon = true;
				};
			},
			'If I include the word "Dedicated" in the name of a simple or martial weapon that I\'m proficient with and that doesn\'t have the heavy or special property, it will be treated as a monk weapon.',
			1
		]
	}
}, "Optional 2nd-level monk features");
AddFeatureChoice(ClassList.monk.features["unarmored movement"], true, "Ki-Fueled Attack", {
	name : "Ki-Fueled Attack",
	extraname : "Optional Monk 3",
	source : [["T", 48]],
	description : desc([
		"If I use any ki points during my action on my turn, I can make an attack as a bonus action",
		"This attack has to be in the same turn and with an unarmed strike or a monk weapon"
	]),
	action : [["bonus action", ""]]
}, "Optional 3rd-level monk features");
AddFeatureChoice(ClassList.monk.features["deflect missiles"], true, "Quickened Healing (2 ki points)", {
	name : "Quickened Healing",
	extraname : "Optional Monk 4",
	source : [["T", 49]],
	description : " [2 ki points]\n   As an action, I can regain HP equal to the roll of my martial arts die + Proficiency Bonus",
	action : [["action", ""]]
}, "Optional 4th-level monk features");
AddFeatureChoice(ClassList.monk.features["slow fall"], true, "Focused Aim (1-3 ki points)", {
	name : "Focused Aim",
	extraname : "Optional Monk 5",
	source : [["T", 49]],
	description : " [1-3 ki points]\n   When I miss an attack roll, I can spend ki to increase the roll by +2 per ki point (max +6)",
	prereqeval : function (v) { return classes.known.monk.level >= 5 ? true : "skip"; }
}, "Optional 5th-level monk features");

// Monk Subclasses
AddSubClass("monk", "way of mercy", {
	regExpSearch : /^(?=.*mercy)((?=.*(monk|monastic))|((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior))).*$/i,
	subname : "Way of Mercy",
	source : [["T", 49]],
	features : {
		"subclassfeature3" : {
			name : "Implements of Mercy",
			source : [["T", 49]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with Insight, Medicine, and herbalism kit; I have a special Merciful Mask"
			]),
			skills : ["Insight", "Medicine"],
			toolProfs : ["Herbalism kit"],
			"hands of healing" : {
				name : "Hands of Healing",
				extraname : "Way of Mercy 3",
				source : [["T", 49]],
				description : levels.map(function (n) {
					var a = "As an action, I can spend 1 ki point to touch a creature and restore a number of its HP";
					var b6 = "It also recovers from one disease or being blinded, deafened, paralyzed, poisoned or stunned";
					var c = "When I use Flurry of Blows, I can do this instead of one unarmed strike (no extra ki cost)";
					return desc( n < 6 ? [a, c] :
						[a, b6, n < 11 ? c : c.replace("one", "each")]
					);
				}),
				action : [["action", ""]],
				additional : levels.map(function (n) {
					return n < 3 ? "" : "1 ki point; heal 1d" + (n < 5 ? 4 : n < 11 ? 6 : n < 17 ? 8 : 10) + " + Wisdom modifier";
				})
			},
			"hands of harm" : {
				name : "Hands of Harm",
				extraname : "Way of Mercy 3",
				source : [["T", 50]],
				description : levels.map(function (n) {
					var a = "When I hit a creature with an unarmed strike, I can spend 1 ki point to deal extra damage";
					var b6 = "I can also subject the target to the poisoned condition until the end of my next turn";
					var c11 = "When I use Flurry of Blows, I can do this with one unarmed strike (no extra ki cost)";
					var d = "I can use this feature only once per turn";
					return desc( n < 6 ? [a, d] :
						n < 11 ? [a, b6, d] :
						[a, b6, c11, d]
					);
				}),
				additional : levels.map(function (n) {
					return n < 3 ? "" : "1 ki point; 1d" + (n < 5 ? 4 : n < 11 ? 6 : n < 17 ? 8 : 10) + " + Wis mod necrotic damage";
				})
			},
			autoSelectExtrachoices : [{
				extrachoice : "hands of healing"
			}, {
				extrachoice : "hands of harm"
			}]
		},
		"subclassfeature6" : {
			name : "Physician's touch",
			source : [["T", 50]],
			minlevel : 6,
			description : desc([
				"Hand of Healing also ends 1 disease, blinded, deafened, paralyzed, poisoned or stunned",
				"Hand of Harm also causes target to be poisoned until the end of my next turn"
			])
		},
		"subclassfeature11" : {
			name : "Flurry of Healing and Harm",
			source : [["T", 50]],
			minlevel : 11,
			description : desc([
				"I can use Hand of Healing instead of each Flurry of Blows unarmed strike without ki cost",
				"I can use Hand of Harm on one Flurry of Blows unarmed strike without ki cost"
			]),
			"hand of ultimate mercy" : {
				name : "Hand of Ultimate Mercy",
				extraname : "Way of Mercy 17",
				source : [["T", 50]],
				description : desc([
					"As an action, I can spend 5 ki points and touch a creature that died in the last 24 hours",
					"The creature returns to life and regains 4d10 + my Wisdom modifier in hit points",
					"It is also cured of all these conditions: blinded, deafened, paralyzed, poisoned, and stunned"
				]),
				action : [["action", ""]],
				additional : "5 ki points",
				usages : 1,
				recovery : "long rest"
			},
			autoSelectExtrachoices : [{
				extrachoice : "hand of ultimate mercy",
				minlevel : 17
			}]
		}
	}
});
AddSubClass("monk", "way of the astral self", {
	regExpSearch : /^(?=.*astral)(?=.*(self|projection|travel))((?=.*(monk|monastic))|((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior))).*$/i,
	subname : "Way of the Astral Self",
	source : [["T", 50]],
	features : {
		"subclassfeature3" : {
			name : "Arms of the Astral Self",
			source : [["T", 50]],
			minlevel : 3,
			description : ' [1 ki; see 3rd page "Notes"]' + desc([
				"As a bonus action, I can use my ki to summon the arms of my astral self for 10 minutes"
			]),
			action : [["bonus action", "Summon Astral Arms"]],
			weaponOptions : [{
				baseWeapon : "unarmed strike",
				regExpSearch : /^(?=.*\bastral\b)(?=.*\barms?\b).*$/i,
				name : "Astral Arms",
				source : [["T", 50]],
				ability : 5,
				range : "Melee (+5 ft)",
				damage : [1, "", "Force"],
				description : "+5 ft reach; Uses Str, Dex, or Wis",
				isAstralArms : true,
				selectNow : true
			}],
			"astral arms" : {
				name : "Astral Arms",
				extraname : "Way of the Astral Self 3",
				source : [["T", 50]],
				description : desc([
					"As a bonus action, I can summon my astral arms to hover next to or over my own arms",
					"When I summon them, all creatures of my choice I can see in 10 ft must make a Dex save",
					"If failed, they take twice my martial arts die in force damage",
					"I can use the arms to make unarmed strikes, using Wisdom instead of Strength/Dexterity",
					"I have +5 ft reach on attacks made with my astral arms and they deal force damage",
					"They last for 10 minutes or until I'm incapacitated or die; I choose their appearance"
				]),
				additional : levels.map(function (n) {
					return n < 3 ? "" : "1 ki point; 2d" + (n < 5 ? 4 : n < 11 ? 6 : n < 17 ? 8 : 10) + " force damage on summon";
				})
			},
			autoSelectExtrachoices : [{ extrachoice : "astral arms" }]
		},
		"subclassfeature6" : {
			name : "Visage of the Astral Self",
			source : [["T", 50]],
			minlevel : 6,
			description : ' [1 ki; see 3rd page "Notes"]' + desc([
				"As a bonus action, I can use my ki to summon the visage of my astral self for 10 minutes"
			]),
			action : [["bonus action", "Summon Astral Arms and/or Visage", "Summon Astral Arms"]],
			"astral visage" : {
				name : "Astral Visage",
				extraname : "Way of the Astral Self 6",
				source : [["T", 50]],
				description : " [1 ki point]" + desc([
					"As a bonus action (or when summoning my astral arms), I can summon my astral visage",
					"It lasts for 10 minutes or until I'm incapacitated or die; I choose its appearance",
					"My astral visage covers my face like a helmet or mask and grants me the following benefits:",
					" \u2022 Astral Sight: I can see normally in normal and magical darkness to a distance of 120 ft",
					" \u2022 Wisdom of the Spirit: I have advantage on Wisdom (Insight) and Charisma (Intimidation)",
					" \u2022 Word of the Spirit: I can have only one target I can see in 60 ft hear me, or all in 300 ft"
				])
			},
			autoSelectExtrachoices : [{ extrachoice : "astral visage" }]
		},
		"subclassfeature11" : {
			name : "Body of the Astral Self",
			source : [["T", 51]],
			minlevel : 11,
			description : ' [see 3rd page "Notes"]' + desc([
				"When I have both my astral arms and visage summoned, my astral body appears as well",
				"This spectral body covers me like an armor, connecting my astral arms and astral visage"
			]),
			action : [["reaction", "Deflect Energy"]],
			"astral body" : {
				name : "Astral Body",
				extraname : "Way of the Astral Self 11",
				source : [["T", 51]],
				description : " [if both astral arms \u0026 visage are present]" + desc([
					" \u2022 Deflect Energy: As a reaction when I take damage, I can reduce it by 1d10 + Wis mod",
					"   I can only do this if the damage I take is acid, cold, fire, force, lightning, or thunder",
					" \u2022 Empowered Arms: Once per my turn, I can add martial art die to astral arms damage"
				])
			},
			autoSelectExtrachoices : [{ extrachoice : "astral body" }],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.theWea.isAstralArms && classes.known.monk && classes.known.monk.level) {
							var aMonkDie = function (n) { return n < 5 ? 4 : n < 11 ? 6 : n < 17 ? 8 : 10; }(classes.known.monk.level);
							fields.Description += (fields.Description ? '; ' : '') + 'Once on each of my turns +1d' + aMonkDie + ' damage';
						}
					},
					"Once on each of my turns when I hit a target with my astral arms, I can add my martial arts die to the damage dealt."
				]
			}
		},
		"subclassfeature17" : {
			name : "Awakened Astral Self",
			source : [["T", 51]],
			minlevel : 17,
			description : ' [5 ki; see 3rd page "Notes"]' + desc([
				"As a bonus action, I can use 5 ki points to summon astral arms and visage with benefits"
			]),
			action : [["bonus action", ""]],
			"astral body" : {
				name : "Awakened Astral Self",
				extraname : "Way of the Astral Self 17",
				source : [["T", 50]],
				description : " [5 ki points]" + desc([
					"As a bonus action, I can summon my astral arms and astral visage, with extra benefits:",
					" \u2022 Armor of the Spirit: I gain a +2 bonus to my armor class",
					" \u2022 Astral Barrage: I can do three attacks with the Attack action, if all are with astral arms",
					"This lasts for 10 minutes or until I'm incapacitated or die"
				])
			},
			autoSelectExtrachoices : [{ extrachoice : "astral body" }]
		}
	}
});


// >>>>>>>>>>>>>>>>>>>>>>> //
// >>> Paladin Options >>> //
// >>>>>>>>>>>>>>>>>>>>>>> //

// Paladin Optional Class Features
AddFeatureChoice(ClassList.paladin.features.spellcasting, true, "Additional Paladin Spells", {
	name : "Additional Paladin Spells",
	extraname : "Optional Paladin 2",
	source : [["T", 52]],
	description : "",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "paladin" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["gentle repose", "prayer of healing", "warding bond"]);
			},
			"This optional class feature expands the spell list of the paladin class with the following spells (spell level in brackets): Gentle Repose (2), Prayer of Healing (2), and Warding Bond (2)."
		]
	}
}, "Optional 2nd-level paladin features");
// Blind Fighting & Interception already added in the Fighter Options section
AddFightingStyle(["paladin"], "Blessed Warrior", {
	name : "Blessed Warrior Fighting Style",
	source : [["T", 52], ["UA:CFV", 6]],
	description : desc([
		"I learn two cleric cantrips that count as paladin spells for me and use Cha for spellcasting",
		"Whenever I gain a paladin level, I can swap one of these for another cleric cantrip"
	]),
	spellcastingBonus : {
		name : "Blessed Warrior",
		"class" : "cleric",
		level : [0, 0],
		times : 2
	}
});
AddFeatureChoice(ClassList.paladin.features["subclassfeature3.0-channel divinity"], true, "Harness Divine Power", {
	name : "Channel Divinity: Harness Divine Power",
	extraname : "Optional Paladin 3",
	source : [["T", 52]],
	description : desc([
		"As a bonus action, I can expend a use of my channel divinity to regain one used spell slot",
		"The level of this spell slot can be no more than half my Proficiency Bonus (rounded up)",
		"I can only do this so many times per long rest, even if I have uses of channel divinity left"
	]),
	action : [["bonus action", ""]],
	usages : levels.map(function(n) {
		return n < 3 ? "" : n < 7 ? 1 : n < 15 ? 2 : 3;
	}),
	recovery : "long rest"
}, "Optional 3rd-level paladin features");
AddFeatureChoice(ClassList.paladin.features['divine health'], true, "Martial Versatility", {
	name : "Martial Versatility",
	extraname : "Optional Paladin 4",
	source : [["T", 53]],
	description : " [ASI = Ability Score Improvement]\n   Whenever I gain an ASI from the paladin class, I can change my paladin fighting style",
	prereqeval : function (v) { return classes.known.paladin.level >= 4 ? true : "skip"; }
}, "Optional 4th-level paladin features");

// Paladin Subclasses
AddSubClass("paladin", "oath of the watchers", {
	regExpSearch : /^(?=.*watchers)((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper)))).*$/i,
	subname : "Oath of the Watchers",
	source : [["T", 54]],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Watcher's Will",
			source : [["T", 55]],
			minlevel : 3,
			description : "\n   As an action, Cha mod of creatures I see in 30 ft adv. on Int/Wis/Cha saves for 1 min",
			action : [["action", ""]],
			spellcastingExtra : ["alarm", "detect magic", "moonbeam", "see invisibility", "counterspell", "nondetection", "aura of purity", "banishment", "hold monster", "scrying"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Abjure the Extraplanar",
			source : [["T", 55]],
			minlevel : 3,
			description : desc([
				"As an action, all aberration, celestial, elemental, fey, fiend in 30 ft must make Wis save",
				"Succeeds if it can't hear me; On fail, turned for 1 minute or until it takes any damage",
				"Turned: move away, never within 30 ft of me, no reactions or actions other than Dash",
				"Turned: may Dodge instead of Dash when nowhere to move and unable to escape bonds"
			]),
			action : [["action", ""]]
		},
		"subclassfeature7" : {
			name : "Aura of the Sentinel",
			source : [["T", 55]],
			minlevel : 7,
			description : "\n   If I'm not incapacitated, chosen creatures in range and I add my Prof Bonus to Initiative",
			additional : levels.map(function (n) { return n < 7 ? "" : (n < 18 ? 10 : 30) + "-foot aura"; }),
			addMod : [{ type : "skill", field : "Init", mod : "prof", text : "I can add my Proficiency Bonus to initiative rolls." }]
		},
		"subclassfeature15" : {
			name : "Vigilant Rebuke",
			source : [["T", 55]],
			minlevel : 15,
			description : desc([
				"As a reaction when I or another I can see succeeds a Int, Wis, or Cha save, I can rebuke",
				"The creature that forced the saving throw takes 2d8 + my Charisma mod force damage"
			]),
			action : [["reaction", ""]]
		},
		"subclassfeature20" : {
			name : "Mortal Bulwark",
			source : [["T", 55]],
			minlevel : 20,
			description : desc([
				"As a bonus action, I can gain the following benefits for 1 minute:",
				" \u2022 Truesight 120 ft; Adv. on attacks vs. aberrations, celestials, elementals, fey, and fiends",
				" \u2022 When I hit and damage a creature with an attack, I can banish it if it fails a Cha save",
				"   It's banished to its native plane if not there now; It's immune for 24 hours on a success",
				"I can do this once per long rest, or by expending a 5th-level or higher spell slot (SS 5+)"
			]),
			recovery : "long rest",
			usages : 1,
			altResource : "SS 5+",
			action : [["bonus action", ""]]
		}
	}
});


// >>>>>>>>>>>>>>>>>>>>>>> //
// >>> Ranger Options >>> //
// >>>>>>>>>>>>>>>>>>>>>>> //

// Ranger Optional Class Features
var TCoE_Deft_Explorer = function () {
	var a = {
		name : "Deft Explorer: Canny",
		source : [["T", 56]],
		description : "\n   I learn two languages and gain expertise with one skill I'm proficient with",
		languageProfs : [2],
		skillstxt : "Expertise with one skill I'm proficient with",
		additional : "extra benefits at 6th and 10th level",
		extraTimes : [1],
		extraname : "Canny (select skill for expertise)",
		extrachoices : ["Acrobatics", "Animal Handling", "Arcana", "Athletics", "Deception", "History", "Insight", "Intimidation", "Investigation", "Medicine", "Nature", "Perception", "Performance", "Persuasion", "Religion", "Sleight of Hand", "Stealth", "Survival"],
		"roving benefit" : {
			name : "Roving",
			extraname : "Deft Explorer Benefit 6",
			source : [["T", 56]],
			description : "\n   I gain +5 ft walking speed and climbing and swimming speed equal to my walking speed",
			speed : {
				walk : { spd : "+5", enc : "+5" },
				climb : { spd : "walk", enc : "walk" },
				swim : { spd : "walk", enc : "walk" }
			}
		},
		"tireless benefit" : {
			name : "Tireless",
			extraname : "Deft Explorer Benefit 10",
			source : [["T", 56]],
			description : desc([
				"Whenever I finish a short rest, I reduce my exhaustion level, if any, by 1",
				"As an action a number of times per long rest, I can give myself temp HP of 1d8 + Wis mod"
			]),
			action : [["action", ""]],
			additional : "1d8 + Wis Mod",
			usages : "Prof Bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		autoSelectExtrachoices : [{
			extrachoice : "roving benefit",
			minlevel : 6
		}, {
			extrachoice : "tireless benefit",
			minlevel : 10
		}]
	}
	for (var i = 0; i < a.extrachoices.length; i++) {
		var attr = a.extrachoices[i].toLowerCase();
		a[attr] = {
			name : a.extrachoices[i] + " Expertise",
			extraname : "Deft Explorer Benefit 1",
			description : "",
			source : a.source,
			skills : [[a.extrachoices[i], "only"]],
			prereqeval : function(v) {
				return v.skillProfsLC.indexOf(v.choice) === -1 ? false : v.skillExpertiseLC.indexOf(v.choice) === -1 ? true : "markButDisable";
			}
		}
	}
	return a;
}();
CreateClassFeatureVariant("ranger", "natural explorer", "Deft Explorer", TCoE_Deft_Explorer);
var TCoE_Favored_Foe = {
	name : "Favored Foe",
	source : [["T", 56]],
	description : desc([
		"When I hit a creature with an attack roll, I can mark it as my favored enemy for 1 min",
		"I deal extra damage to it when I mark it and the first time I hit a marked on my turn",
		"Keeping a creature marked as favored enemy requires me to concentrate, like on a spell"
	]),
	additional : levels.map(function (n) {
		return "+1d" + (n < 6 ? 4 : n < 14 ? 6 : 8) + " damage";
	}),
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest",
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if (!v.isSpell && (classes.known.rangerua || classes.known.ranger) && (/favou?red.{1,2}enemy/i).test(v.WeaponTextName)) {
					var rngrLvl = classes.known.ranger ? classes.known.ranger.level : classes.known.rangerua.level;
					fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +1d' + (rngrLvl < 6 ? 4 : rngrLvl < 14 ? 6 : 8) + ' damage';
				};
			},
			"If I include the words \"Favored Enemy\" in the name of a weapon, it gets the bonus damage I do against marked favored enemies added to its description."
		]
	}
};
CreateClassFeatureVariant("ranger", "favored enemy", "Favored Foe", TCoE_Favored_Foe);
var TCoE_Additional_Ranger_Spells = {
	name : "Additional Ranger Spells",
	extraname : "Optional Ranger 2",
	source : [["T", 57]],
	description : "",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if ((spName !== "ranger" && spName !== "rangerua") || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["entangle", "searing smite", "aid", "enhance ability", "gust of wind", "magic weapon", "elemental weapon", "meld into stone", "revivify", "dominate beast", "greater restoration"]);
			},
			"This optional class feature expands the spell list of the ranger class with the following spells (spell level in brackets): Entangle (1), Searing Smite (1), Aid (2), Enhance Ability (2), Gust of Wind (2), Magic Weapon (2), Elemental Weapon (3), Meld into Stone (3), Revivify (3), Dominate Beast (4), and Greater Restoration (5)."
		]
	},
	prereqeval : function (v) { return (classes.known.ranger && classes.known.ranger.level >= 2) || (classes.known.rangerau && classes.known.rangerau.level >= 2) ? true : "skip"; }
};
AddFeatureChoice(ClassList.ranger.features.spellcasting, true, "Additional Ranger Spells (prereq: level 2 ranger)", TCoE_Additional_Ranger_Spells, "Optional ranger features");
// Blind Fighting & Thrown Weapon Fighting already added in the Fighter Options section
AddFightingStyle(["ranger"], "Druidic Warrior", {
	name : "Druidic Warrior Fighting Style",
	source : [["T", 57], ["UA:CFV", 7]],
	description : desc([
		"I learn two druid cantrips that count as ranger spells for me and use Wis for spellcasting",
		"Whenever I gain a ranger level, I can swap one of these for another druid cantrip"
	]),
	spellcastingBonus : {
		name : "Druidic Warrior",
		"class" : "druid",
		level : [0, 0],
		times : 2
	}
});
var TCoE_Ranger_Spellcasting_Focus = {
	name : "Spellcasting Focus",
	extraname : "Optional Ranger 2",
	source : [["T", 57], ["UA:CFV", 8]],
	description : "\n   I can use a druidic focus as a spellcasting focus for my ranger spells",
	prereqeval : function (v) { return (classes.known.ranger && classes.known.ranger.level >= 2) || (classes.known.rangerau && classes.known.rangerau.level >= 2) ? true : "skip"; }
};
AddFeatureChoice(ClassList.ranger.features.spellcasting, true, "Spellcasting Focus (prereq: level 2 ranger)", TCoE_Ranger_Spellcasting_Focus, "Optional ranger features");
var TCoE_Primal_Awareness = {
	name : "Primal Awareness",
	source : [["T", 57]],
	description : desc([
		"I get bonus spells known, which do not count against the number of spells I can know",
		"In addition, I can cast each once per long rest without expending a spell slot"
	]),
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Remove the bonus spells from the normally selectable list
				if ((spName === "ranger" || spName === "rangerua") && spType.indexOf("bonus") === -1) {
					if (!spList.notspells) spList.notspells = [];
					spList.notspells = spList.notspells.concat(["speak with animals", "beast sense", "speak with plants", "locate creature", "commune with nature"]);
				}
			},
			"I know the following spells, without them counting towards the maximum number of spells I can know: Speak with Animals, Beast Sense, Speak with Plants, Locate Creature, and Commune with Nature."
		]
	},
	spellcastingBonus : {
		name : "Primal Awareness",
		spells : ["speak with animals", "beast sense", "speak with plants", "locate creature", "commune with nature"],
		selection : ["speak with animals", "beast sense", "speak with plants", "locate creature", "commune with nature"],
		firstCol : "oncelr",
		times : levels.map(function (n) {
			return n < 5 ? 1 : n < 9 ? 2 : n < 13 ? 3 : n < 17 ? 4 : 5;
		})
	}
};
CreateClassFeatureVariant("ranger", "primeval awareness", "Primal Awareness", TCoE_Primal_Awareness);
var TCoE_Ranger_Martial_Versatility = {
	name : "Martial Versatility",
	extraname : "Optional Ranger 4",
	source : [["T", 57]],
	description : " [ASI = Ability Score Improvement]\n   Whenever I gain an ASI from the ranger class, I can change my ranger fighting style",
	prereqeval : function (v) { return (classes.known.ranger && classes.known.ranger.level >= 4) || (classes.known.rangerau && classes.known.rangerau.level >= 4) ? true : "skip"; }
};
AddFeatureChoice(ClassList.ranger.features.spellcasting, true, "Martial Versatility (prereq: level 4 ranger)", TCoE_Ranger_Martial_Versatility, "Optional ranger features");
var TCoE_Natures_Veil = {
	name : "Nature's Veil",
	source : [["T", 57]],
	description : desc([
		"As a bonus action, I can become invisible along with any equipment I'm wearing/carrying",
		"This invisibility lasts until the start of my next turn"
	]),
	action : [["bonus action", ""]],
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest",
};
CreateClassFeatureVariant("ranger", "hide in plain sight", "Nature's Veil", TCoE_Natures_Veil);

// Add the Ranger alternative class features also to the Revised Ranger, if it exists after all scripts have ran
RunFunctionAtEnd(function() {
	if (!ClassList["rangerua"]) return;
	CreateClassFeatureVariant("rangerua", "natural explorer", "Deft Explorer", TCoE_Deft_Explorer);

	// Add Favored Foe as an alternative choice (can't be done by automation because of choices) and add "Favored Foe" variant option
	// Move some attributes from the main object to the favored enemy choice objects
	['additional', 'languageProfs', 'calcChanges'].forEach( function(attr) {
		var fea = ClassList.rangerua.features["favored enemy"];
		if (!fea[attr]) return;
		// Move the attribute to each of the choices
		for (var i = 0; i < fea.choices.length; i++) {
			var aCh = fea[fea.choices[i].toLowerCase()];
			if (aCh.source) continue; // don't do options that are not part of the original entry (which don't have a source)
			aCh[attr] = fea[attr];
		}
		// Now delete the attributes from the parent object
		delete fea[attr];
	});
	// Now add the alternative class feature as another choice
	AddFeatureChoice(ClassList.rangerua.features["favored enemy"], false, "[alternative feature] Favored Foe", TCoE_Favored_Foe);

	AddFeatureChoice(ClassList.rangerua.features.spellcasting, true, "Additional Ranger Spells (prereq: level 2 ranger)", TCoE_Additional_Ranger_Spells, "Optional ranger features");
	AddFeatureChoice(ClassList.rangerua.features.spellcasting, true, "Spellcasting Focus (prereq: level 2 ranger)", TCoE_Ranger_Spellcasting_Focus, "Optional ranger features");
	CreateClassFeatureVariant("rangerua", "primeval awareness", "Primal Awareness", TCoE_Primal_Awareness);
	AddFeatureChoice(ClassList.rangerua.features.spellcasting, true, "Martial Versatility (prereq: level 4 ranger)", TCoE_Ranger_Martial_Versatility, "Optional ranger features");
	CreateClassFeatureVariant("rangerua", "hide in plain sight", "Nature's Veil", TCoE_Natures_Veil);
});

// Ranger (Beast Master) alternative class feature
if (ClassSubList["ranger-beast master"]) {
	var TCoE_Primal_Companion_Attributes = {
		hdLinked : ["ranger", "spell-less ranger"],
		languages : "understands the languages of its master but can't speak",
		features : [{
			name : "Master",
			description : "The beast obeys the commands of its master and shares its proficiency bonus. It takes its turn during that of its master, on the same initiative count. It can move and take reactions on its own, but only takes the Dodge action on its turn unless its master takes a bonus action to command it to take another action. Its master can also forgo one attack during their Attack action to command the beast to take the Attack action. If its master is incapacitated, the beast can take any action, not just Dodge. The beast vanishes if its master dies."
		}],
		traits : [{
			name : "Primal Rebirth",
			description : "Within an hour of the beast's death, its master can take an action to touch it and expend a spell slot to have it return to full HP after 1 minute."
		}, {
			name : "Primal Bond",
			description : "The beast adds it proficiency bonus to all its ability check and saving throws."
		}, {
			name : "Exceptional Training (Beast Master 7)",
			minlevel : 7,
			description : "The beast's attacks count as magical for overcoming resistances and immunities.",
			eval : function(prefix, lvl) {
				AddString(prefix + "Comp.Use.Attack.1.Description", "Counts as magical", "; ");
			},
			removeeval : function(prefix, lvl) {
				RemoveString(prefix + "Comp.Use.Attack.1.Description", "Counts as magical");
			}
		}, {
			name : "Bestial Fury (Beast Master 11)",
			minlevel : 11,
			description : "When commanded to take the Attack action, the beast can make 2 attacks as part of its Attack action.",
			eval : function(prefix, lvl) {
				Value(prefix + "Comp.Use.Attack.perAction", 2);
			},
			removeeval : function(prefix, lvl) {
				Value(prefix + "Comp.Use.Attack.perAction", 1);
			}
		}],
		addMod : [
			{ type : "skill", field : "all", mod : "Prof", text : "The primal companion adds it proficiency bonus to all its ability check and saving throws." },
			{ type : "skill", field : "Init", mod : "Prof", text : "The primal companion adds it proficiency bonus to all its ability check and saving throws." },
			{ type : "save", field : "all", mod : "Prof", text : "The primal companion adds it proficiency bonus to all its ability check and saving throws." }
		],
		calcChanges : {
			hp : function (totalHD, HDobj, prefix) {
				if (!classes.known.ranger && !classes.known["spell-less ranger"]) return;
				var rngrLvl = classes.known.ranger ? classes.known.ranger.level : classes.known["spell-less ranger"].level;
				var multiplier = What(prefix + "Comp.Use.HD.Die") == 6 ? [4, "four"] : [5, "five"];
				var rngrLvlM = multiplier[0] * rngrLvl;
				HDobj.alt.push(multiplier[0] + rngrLvlM);
				HDobj.altStr.push(" = " + multiplier[0] + " as a base\n + " + multiplier[0] + " \xD7 " + rngrLvl + " from " + multiplier[1] + " times its master's ranger level (" + rngrLvlM + ")");
			},
			setAltHp : true
		}
	};
	CreateClassFeatureVariant("ranger-beast master", "subclassfeature3", "Primal Companion", {
		name : "Primal Companion",
		source : [["T", 61]],
		description : desc([
			"When I finish a long rest, I can summon a primal beast of the land, sea, or sky in 5 ft",
			"I determine what animal it looks like, but it always has primal markings",
			"It is friendly to me and my allies, obeys my commands, and acts during my turn",
			"Unless I use a bonus action to command it, it only takes the Dodge action on its turn",
			"I can also forgo one attack of my Attack action to command it to take the Attack action",
			"It can take reactions and move on its turn even if I don't command it",
			"As an action within 1 hour of it dying, I can touch it and expend a spell slot to revive it",
			"It then returns to full HP in 1 minute; It vanishes if I summon another one or if I die"
		]),
		action : [
			["bonus action", " (command)"],
			["action", " (revive)"]
		],
		creaturesAdd : [
			["Beast of the Land", true],
			["Beast of the Sea", true],
			["Beast of the Sky", true]
		],
		creatureOptions : [{
			name : "Beast of the Land",
			source : [["T", 61]],
			size : 3,
			type : "Beast",
			alignment : "Unaligned",
			ac : "11+Dex+Prof",
			hp : 20,
			hd : [3, 8],
			hdLinked : TCoE_Primal_Companion_Attributes.hdLinked,
			speed : "40 ft, climb 40 ft",
			scores : [14, 14, 15, 8, 14, 11],
			senses : "Darkvision 60 ft",
			passivePerception : 12,
			languages : TCoE_Primal_Companion_Attributes.languages,
			challengeRating : "1/4",
			proficiencyBonus : 2,
			proficiencyBonusLinked : true,
			attacksAction : 1,
			attacks : [{
				name : "Maul",
				ability : 5,
				damage : [1, 8, "slashing"],
				modifiers : ["", "Prof"],
				range : "Melee (5 ft)",
				description : "+1d6 damage if hits after moving 20 ft straight in same round, see Charge",
				tooltip : "If the beast moves at least 20 feet straight toward a target and then hits it with a maul attack on the same turn, the target takes an extra 1d6 slashing damage. If the target is a creature, it must succeed on a Strength saving throw against your spell save DC or be knocked prone.",
				useSpellMod : "ranger"
			}, {
				name : "Charge",
				ability : 5,
				damage : ["Str save", "", "Knocked prone"],
				range : "Melee (5 ft)",
				description : "Str save or knocked prone; Only if maul hits after moving 20 ft straight in same round",
				tooltip : "If the beast moves at least 20 feet straight toward a target and then hits it with a maul attack on the same turn, the target takes an extra 1d6 slashing damage. If the target is a creature, it must succeed on a Strength saving throw against your spell save DC or be knocked prone.",
				abilitytodamage : false,
				dc : true,
				useSpellMod : "ranger"
			}],
			actions : [{
				name : "Charge",
				description : "If the beast moves at least 20 ft straight toward a target and then hits it with a maul attack on the same turn, the target takes an extra 1d6 slashing damage. If the target is a creature, it must succeed on a Strength saving throw against my spell save DC or be knocked prone."
			}],
			features : TCoE_Primal_Companion_Attributes.features,
			traits : TCoE_Primal_Companion_Attributes.traits.map( function(n) {
				if (!typePF && /Exceptional Training/i.test(n.name)) {
					var a = newObj(n);
					a.description = "The beast's attacks count as magical.";
					return a;
				} else {
					return n;
				}
			}),
			addMod : TCoE_Primal_Companion_Attributes.addMod,
			calcChanges : TCoE_Primal_Companion_Attributes.calcChanges,
			minlevelLinked : TCoE_Primal_Companion_Attributes.hdLinked
		}, {
			name : "Beast of the Sea",
			source : [["T", 61]],
			size : 3,
			type : "Beast",
			alignment : "Unaligned",
			ac : "11+Dex+Prof",
			hp : 20,
			hd : [3, 8],
			hdLinked : TCoE_Primal_Companion_Attributes.hdLinked,
			speed : "5 ft, swim 60 ft",
			scores : [14, 14, 15, 8, 14, 11],
			senses : "Darkvision 60 ft",
			passivePerception : 12,
			languages : TCoE_Primal_Companion_Attributes.languages,
			challengeRating : "1/4",
			proficiencyBonus : 2,
			proficiencyBonusLinked : true,
			attacksAction : 1,
			attacks : [{
				name : "Binding Strike",
				ability : 1,
				damage : [1, 6, "Pierc./Bludg."],
				modifiers : ["", "Prof"],
				range : "Melee (5 ft)",
				description : "On hit, target is grappled (escape DC is spell DC) and beast can't use attack on others",
				tooltip : "If the beast hits a target with its blinding strike, the target is grappled (escape DC equal to your spellcasting save DC). Until this grapple ends, the beast can't use this attack on another target.",
				useSpellMod : "ranger"
			}],
			actions : [{
				name : "Amphibious",
				description : "The beast can breathe both air and water."
			}],
			features : TCoE_Primal_Companion_Attributes.features,
			traits : TCoE_Primal_Companion_Attributes.traits,
			addMod : TCoE_Primal_Companion_Attributes.addMod,
			calcChanges : TCoE_Primal_Companion_Attributes.calcChanges,
			minlevelLinked : TCoE_Primal_Companion_Attributes.hdLinked
		}, {
			name : "Beast of the Sky",
			source : [["T", 61]],
			size : 4,
			type : "Beast",
			alignment : "Unaligned",
			ac : "10+Dex+Prof",
			hp : 16,
			hd : [3, 6],
			hdLinked : TCoE_Primal_Companion_Attributes.hdLinked,
			speed : "10 ft, fly 60 ft",
			scores : [6, 16, 13, 8, 14, 11],
			senses : "Darkvision 60 ft",
			passivePerception : 12,
			languages : TCoE_Primal_Companion_Attributes.languages,
			challengeRating : "1/4",
			proficiencyBonus : 2,
			proficiencyBonusLinked : true,
			attacksAction : 1,
			attacks : [{
				name : "Shred",
				ability : 2,
				damage : [1, 6, "slashing"],
				modifiers : ["", "Prof"],
				range : "Melee (5 ft)",
				useSpellMod : "ranger"
			}],
			actions : [{
				name : "Flyby",
				description : "The beast doesn't provoke opportunity attacks when it flies out of an enemy's reach."
			}],
			features : TCoE_Primal_Companion_Attributes.features,
			traits : TCoE_Primal_Companion_Attributes.traits,
			addMod : TCoE_Primal_Companion_Attributes.addMod,
			calcChanges : TCoE_Primal_Companion_Attributes.calcChanges,
			minlevelLinked : TCoE_Primal_Companion_Attributes.hdLinked
		}],
		eval : function() {
			// Remove any ranger companion pages
			What("Template.extras.AScomp").split(",").forEach(function (prefix) {
				if (What(prefix + "Companion.Remember") === "companion") {
					DoTemplate("AScomp", "Remove", prefix, true)
				}
			});
		}
	});
}

// Ranger Subclasses
var TCoE_Ranger_Subclass_Fey_Wanderer = AddSubClass("ranger", "fey wanderer", {
	regExpSearch : /^(?=.*fey)(?=.*wanderer).*$/i,
	subname : "Fey Wanderer",
	source : [["T", 58]],
	fullname : "Fey Wanderer",
	features : {
		"subclassfeature3" : {
			name : "Dreadful Strikes",
			source : [["T", 58]],
			minlevel : 3,
			description : desc([
				"My weapons deal extra psychic damage, but only once per turn per creature"
			]),
			additional : levels.map(function (n) {
				return n < 3 ? "" : "+1d" + (n < 11 ? 4 : 6) + " psychic damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.isWeapon && (classes.known.ranger || classes.known.rangerua)) {
							var rngrLvl = classes.known.ranger ? classes.known.ranger.level : classes.known.rangerua.level;
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn per target +1d' + (rngrLvl < 11 ? 4 : 6) + ' psychic damage';
						};
					},
					"When I hit a creature with a weapon, I can deal an extra 1d4 psychic damage to the target, which can take this extra damage only once per turn. From 11th-level, this damage increases to 1d6."
				]
			}
		},
		"subclassfeature3.1" : {
			name : "Fey Wanderer Magic",
			source : [["T", 58]],
			minlevel : 3,
			description : "\n   I get bonus spells known, which do not count against the number of spells I can know",
			spellcastingExtra : ["charm person", "misty step", "dispel magic", "dimension door", "mislead"],
			spellcastingExtraApplyNonconform : true
		},
		"subclassfeature3.2" : {
			name : "Otherworldly Glamour",
			source : [["T", 59]],
			minlevel : 3,
			description : desc([
				"I can add my Wisdom modifier to any Charisma check I make (minimum of +1)",
				'I gain proficiency in Deception, Performance, or Persuasion; Use "Choose Feature" button'
			]),
			addMod : ["Deception", "Intimidation", "Performance", "Persuasion"].map(function(skill){return { type : "skill", field : skill, mod : "max(Wis|1)", text : "I can add my Wisdom modifier to any Charisma check I make (minimum of +1)." };}),
			choices : ["Deception proficiency", "Performance proficiency", "Persuasion proficiency"],
			"deception proficiency" : {
				name : "Otherworldly Glamour",
				description : " [Deception proficiency]\n   I can add my Wisdom modifier to any Charisma check I make (minimum of +1)",
				skills : ["Deception"]
			},
			"performance proficiency" : {
				name : "Otherworldly Glamour",
				description : " [Performance proficiency]\n   I can add my Wisdom modifier to any Charisma check I make (minimum of +1)",
				skills : ["Performance"]
			},
			"persuasion proficiency" : {
				name : "Otherworldly Glamour",
				description : " [Persuasion proficiency]\n   I can add my Wisdom modifier to any Charisma check I make (minimum of +1)",
				skills : ["Persuasion"]
			}
		},
		"subclassfeature7" : {
			name : "Beguiling Twist",
			source : [["T", 59]],
			minlevel : 7,
			description : desc([
				"I have advantage on saves against being charmed or frightened; Below uses my save DC",
				"As a reaction when a creature I see in 120 ft succeeds its save vs. charmed or frightened,",
				"I can have another I see in 120 ft make a Wis save or be charmed/frightened (I choose)",
				"This lasts for 1 minute and the target can repeat the save at the end of each of its turns"
			]),
			action : [["reaction", ""]],
			savetxt : { adv_vs : ["charmed", "frightened"] }
		},
		"subclassfeature11" : {
			name : "Fey Reinforcements",
			source : [["T", 59]],
			minlevel : 11,
			description : desc([
				"I learn Summon Fey; It needs no material component, nor counts against spells known",
				"Once per long rest, I can cast it without expending a spell slot",
				"When I cast it, I can have it not require concentration, but than its duration is 1 minute"
			]),
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Fey Reinforcements",
				spells : ["summon fey"],
				selection : ["summon fey"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"summon fey" : {
					components : "V,S",
					compMaterial : "",
					duration : "Conc,1h/1min",
					changes : "Using my Fey Reinforcements class feature, I can cast Summon Fey without requiring material components and I can cast it once per long rest without requiring a spell slot. Whenever I start casting the spell, I can modify it so that it doesn't require concentration. If I do so, the spell's duration becomes 1 minute for that casting."
				}
			}
		},
		"subclassfeature15" : {
			name : "Misty Wanderer",
			source : [["T", 59]],
			minlevel : 15,
			description : desc([
				"I can cast Misty Step without a spell slot and can bring a willing creature in 5 ft along"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellKey === "misty step") {
							spellObj.firstCol = "Sp";
							spellObj.description = "I and one willing creature I can see within 5 ft of me teleport 30 ft to a unoccupied space I can see";
							return true;
						}
						return false;
					},
					"Whenever I cast misty step, I can bring along one willing creature I can see within 5 ft of me. That creature teleports to an unoccupied space of my choice within 5 ft of my destination space.\nI can cast Misty Step without expending a spell slot a number of times per long rest equal to my Wisdom modifier (minimum of once)."
				]
			}
		}
	}
});
var TCoE_Ranger_Subclass_Swarmkeeper = AddSubClass("ranger", "swarmkeeper", {
	regExpSearch : /swarmkeeper/i,
	subname : "Swarmkeeper",
	source : [["T", 59]],
	fullname : "Swarmkeeper",
	features : {
		"subclassfeature3" : {
			name : "Gathered Swarm",
			source : [["T", 60]],
			minlevel : 3,
			description : levels.map(function (n) {
				var a = [
					"I'm bonded to a swarm of nature spirits crawling in my space; I choose their appearance",
					"Once on each of my turns, I can have it assist me after I hit a creature with an attack:",
					" \u2022 The target takes an extra 1d" + (n < 11 ? 6 : 8) + " piercing damage from the swarm",
					" \u2022 The target must make a Strength save or be moved 15 ft horizontally by the swarm",
					" \u2022 The swarm moves me 5 ft horizontally" + (n < 11 ? "" : " and I have half cover until my next turn starts"),
					"I get to choose the direction whenever the target or I'm moved by the swarm"
				];
				if (n >= 11) a.splice(4, 0, "   Additionally, on a failed save, I can also have the target be knocked prone");
				if (n >= 20) a.pop();
				return desc(a);
			})
		},
		"subclassfeature3.1" : {
			name : "Swarmkeeper Magic",
			source : [["T", 60]],
			minlevel : 3,
			description : desc([
				"I learn Mage Hand; When cast, its hand takes the form of my swarming nature spirits",
				"I get bonus spells known, which do not count against the number of spells I can know"
			]),
			spellcastingBonus : {
				name : "Swarmkeeper Magic",
				spells : ["mage hand"],
				selection : ["mage hand"],
				firstCol : "atwill"
			},
			spellcastingExtra : ["faerie fire", "web", "gaseous form", "arcane eye", "insect plague"],
			spellcastingExtraApplyNonconform : true
		},
		"subclassfeature7" : {
			name : "Writhing Tide",
			source : [["T", 60]],
			minlevel : 7,
			description : desc([
				"As a bonus action, I can fly on my swarm for 1 minute: 10 ft flying speed and can hover"
			]),
			action : [["bonus action", ""]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature11" : {
			name : "Mighty Swarm",
			source : [["T", 60]],
			minlevel : 11,
			description : " [improves Gathered Swarm, see above]\n   Now 1d8 damage, knocks prone on failed save, or grants me half cover until next turn"
		},
		"subclassfeature15" : {
			name : "Swarming Dispersal",
			source : [["T", 60]],
			minlevel : 15,
			description : desc([
				"As a reaction when I take damage, I can gain resistance to that damage and teleport",
				"I vanish into my swarm and teleport to an unoccupied space within 30 ft that I can see"
			]),
			action : [["reaction", ""]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		}
	}
});
// Add both subclasses to the revised ranger as well, if it exists
if (ClassList.rangerua) {
	ClassList.rangerua.subclasses[1].push(TCoE_Ranger_Subclass_Fey_Wanderer, TCoE_Ranger_Subclass_Swarmkeeper);
};


// >>>>>>>>>>>>>>>>>>>>> //
// >>> Rogue Options >>> //
// >>>>>>>>>>>>>>>>>>>>> //

// Rogue Optional Class Features
AddFeatureChoice(ClassList.rogue.features["thieves cant"], true, "Steady Aim", {
	name : "Steady Aim",
	extraname : "Optional Rogue 3",
	source : [["T", 62]],
	description : desc([
		"As a bonus action if I don't move during my turn, I can give myself adv. on my next attack",
		"This attack roll has to be in the same turn and my speed is 0 until the end of the turn"
	]),
	action : [["bonus action", ""]],
	prereqeval : function (v) { return classes.known.rogue.level >= 3 ? true : "skip"; }
}, "Optional 3rd-level rogue features");

// Rogue Subclasses
AddSubClass("rogue", "phantom", {
	regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*phantom).*$/i,
	subname : "Phantom",
	source : [["T", 62]],
	fullname : "Phantom",
	features : {
		"subclassfeature3" : {
			name : "Whispers of the Dead",
			source : [["UA:SR", 1]],
			source : [["T", 62]],
			minlevel : 3,
			description : desc([
				"When I finish a rest, I gain a skill or tool proficiency of my choice until I change it again"
			]),
			skillstxt : "Choose one skill or tool; I can change the choice whenever I finish a short or long rest"
		},
		"subclassfeature3.1" : {
			name : "Wails from the Grave",
			source : [["T", 62]],
			minlevel : 3,
			description : levels.map(function (n) {
				var a = [
					"Directly after I deal sneak attack damage to a creature on my turn, I " + (n < 17 ? "can" : "also") + " harm another",
					n < 17 ? "I then deal half my sneak attack in necrotic damage to a creature I can see within 30 ft" : "I deal half my sneak attack in necrotic damage to both it and another I can see in 30 ft"
				];
				if (n >= 9) a.push("I can do this my Proficiency Bonus per long rest, or by destroying a soul trinket (ST)");
				return desc(a);
			}),
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : levels.map(function (n) {
				return Math.ceil(n / 4) + "d6";
			}),
			altResource : levels.map(function (n) {
				return n < 9 ? "" : "ST";
			})
		},
		"subclassfeature9" : {
			name : "Tokens of the Departed",
			source : [["T", 63]],
			minlevel : 9,
			description : " [max Proficiency Bonus of soul trinkets]" + desc([
				"As a reaction when I see a creature within 30 ft die, I can create a Tiny soul trinket",
				"The token of its life essence appears in my free hand; The DM determines its appearance",
				"While a soul trinket is on my person, I have advantage on death and Constitution saves",
				"As an action, I can destroy one of my soul trinkets and ask its associated spirit a question",
				"Its spirit appears and answers concisely in a language it knew; Trinket can be anywhere"
			]),
			action : [
				["reaction", "Create Soul Trinket"],
				["action", "Destroy Soul Trinket"]
			],
			extraLimitedFeatures : [{
				name : "Soul Trinkets (max Prof Bonus)",
				usages : "",
				recovery : "Special"
			}],
			savetxt : { text : ["While soul trinket is on me, Adv. on Con and death saves"] }
		},
		"subclassfeature13" : {
			name : "Ghost Walk",
			source : [["T", 63]],
			minlevel : 13,
			description : desc([
				"As a bonus action, I can assume a spectral form with 10 ft flying speed and can hover",
				"Attacks vs. me have disadv.; I can move through creatures and objects as difficult terrain",
				"This lasts 10 min; I take 1d10 force damage if I end my turn inside a creature or object",
				"I can assume this form once per long rest, or by destroying one of my soul trinkets (ST)"
			]),
			action : [["bonus action", " (start/end)"]],
			usages : 1,
			recovery : "long rest",
			altResource : "ST"
		},
		"subclassfeature17" : {
			name : "Death's Friend",
			source : [["T", 63]],
			minlevel : 17,
			description : desc([
				"Wails from the Grave now also deals damage to the target of the original sneak attack",
				"If I don't have any soul trinkets at the end of a long rest, one appears in my hand"
			])
		}
	}
});
AddSubClass("rogue", "soulknife", {
	regExpSearch : /soulknife/i,
	subname : "Soulknife",
	source : [["T", 63]],
	fullname : "Soulknife",
	abilitySave : 2,
	features : {
		"subclassfeature3" : {
			name : "Psionic Energy Dice",
			source : [["T", 64]],
			minlevel : 3,
			description : desc([
				"I gain twice my proficiency bonus of psionic energy dice (PsiD) that fuel my psionics",
				"I regain all expended psionic energy dice after a long rest; See psionic powers on page 3",
				"As a bonus action once per short rest, I can regain one expended psionic energy die"
			]),
			additional : levels.map(function(n) {
				return n < 3 ? "" : n < 5 ? "d6" : n < 11 ? "d8" : n < 17 ? "d10" : "d12";
			}),
			action : [["bonus action", "Regain 1 Psionic Energy Die"]],
			usages : "Proficiency Bonus \xD7 2 per ",
			usagescalc : "event.value = Number(How('Proficiency Bonus'))*2",
			recovery : "long rest",
			extraLimitedFeatures : [{
				name : "Regain 1 Psionic Energy die",
				usages : 1,
				recovery : "short rest"
			}],
			extraname : "Soulknife 3",
			"psi-bolstered knack" : {
				name : "Psionic Power: Psi-Bolstered Knack",
				source : [["T", 64]],
				description : " [1 PsiD if successful]" + desc([
					"If I fail an check using a skill or tool I'm proficient with, I can add a psionic energy die to it",
					"The psionic energy die is only expended if this addition turns the failure into a success"
				])
			},
			"psychic whispers" : {
				name : "Psionic Power: Psychic Whispers",
				source : [["T", 64]],
				description : desc([
					"As an action, I can select my Prof Bonus of creatures I can see and roll a psionic energy die",
					"For the roll of hours, I can telepathically communicate with each and they with me",
					"To send or receive messages (no action), we must be within 1 mile of each other",
					"A creature must be able to speak a language to do this; It can end the link at any time",
					"The first time I do this after a long rest, I don't expend the psionic energy die (PsiD)"
				]),
				limfeaname : "Psychic Whispers",
				action : [["action", ""]],
				usages : 1,
				recovery : "long rest",
				altResource : "PsiD"
			},
			autoSelectExtrachoices : [{
				extrachoice : "psi-bolstered knack"
			}, {
				extrachoice : "psychic whispers"
			}]
		},
		"subclassfeature3.1" : {
			name : "Psychic Blades",
			source : [["T", 64]],
			minlevel : 3,
			description : desc([
				"As part of an Attack action, I can manifest a psychic blade from a free hand to attack",
				"It vanishes immediately after making the attack and leaves no mark on its target",
				"As a bonus action after this attack, I can manifest and attack with another psychic blade",
				"To do this, my other hand needs to be free as well and this blade does only 1d4 damage"
			]),
			action : [["bonus action", "Psychic Blade (after Attack action)"]],
			weaponOptions : [{
				regExpSearch : /^(?=.*psychic)(?=.*blade).*$/i,
				name : "Psychic Blade",
				source : [["T", 64]],
				ability : 1,
				type : "Simple",
				damage : [1, 6, "psychic"],
				range : "Melee, 60 ft",
				description : "Finesse, thrown; Bonus action: 1d4 instead of 1d6",
				abilitytodamage : true,
				selectNow : true
			}]
		},
		"subclassfeature9" : {
			name : "Soul Blades",
			source : [["T", 65]],
			minlevel : 9,
			description : desc([
				"My psi-suffused soul grants me more psionic powers, see the 3rd page's \"Notes\" section"
			]),
			extraname : "Soulknife 9",
			"homing strikes" : {
				name : "Homing Strikes",
				source : [["T", 65]],
				description : " [1 PsiD if successful]" + desc([
					"If I miss an attack with my psychic blades, I can add a psionic energy die to the attack roll",
					"The psionic energy die is only expended if this addition turns the miss into a hit"
				])
			},
			"psychic teleportation" : {
				name : "Psychic Teleportation",
				source : [["T", 65]],
				description : " [1 PsiD]" + desc([
					"As a bonus action, I can teleport up to 10 ft away times the roll of my psionic energy die",
					"I manifest a psychic blade and throw it to an empty space I can see before teleporting to it"
				]),
				action : [["bonus action", ""]]
			},
			autoSelectExtrachoices : [{
				extrachoice : "homing strikes"
			}, {
				extrachoice : "psychic teleportation"
			}]
		},
		"subclassfeature13" : {
			name : "Psychic Veil",
			source : [["T", 65]],
			minlevel : 13,
			description : desc([
				"As an action, I can become invisible along with what I'm wearing or carrying for 1 hour",
				"I can end it (no action); It also ends if I damage a creature or force one to make a save",
				"I can do this once per long rest, or by expending a psionic energy die (PsiD)"
			]),
			action : [["action", ""]],
			usages : 1,
			recovery : "long rest",
			altResource : "PsiD"
		},
		"subclassfeature17" : {
			name : "Rend Mind",
			source : [["T", 65]],
			minlevel : 17,
			description : desc([
				"When I use my psychic blade to deal sneak attack damage to a target, I can have it save",
				"It must make a Wisdom save (DC 8 + Prof Bonus + Dex mod) or be stunned for 1 min",
				"It can repeat the save at the end of each of its turns to end being stunned",
				"I can do this once per long rest, or by expending three psionic energy dice (3 PsiD)"
			]),
			action : [["action", ""]],
			usages : 1,
			recovery : "long rest",
			altResource : "3 PsiD"
		}
	}
});


// >>>>>>>>>>>>>>>>>>>>>>>> //
// >>> Sorcerer Options >>> //
// >>>>>>>>>>>>>>>>>>>>>>>> //

// Sorcerer Optional Class Features
AddFeatureChoice(ClassList.sorcerer.features.spellcasting, true, "Additional Sorcerer Spells", {
	name : "Additional Sorcerer Spells",
	extraname : "Optional Sorcerer 1",
	source : [["T", 65]],
	description : "",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "sorcerer" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["grease", "flame blade", "flaming sphere", "magic weapon", "vampiric touch", "fire shield", "bigby's hand", "flesh to stone", "otiluke's freezing sphere", "demiplane"]);
			},
			"This optional class feature expands the spell list of the sorcerer class with the following spells (spell level in brackets): Grease (1), Flame Blade (2), Flaming Sphere (2), Magic Weapon (2), Vampiric Touch (3), Fire Shield (4), Bigby's Hand (5), Flesh to Stone (6), Otiluke's Freezing Sphere (6), and Demiplane (8)."
		]
	}
}, "Optional sorcerer features");
// Metamagic options
AddFeatureChoice(ClassList.sorcerer.features["metamagic"], true, "Seeking Spell", {
	name : "Seeking Spell",
	source : [["T", 66]],
	description : " [2 sorcery points]" + desc([
		"If I miss an attack roll for a spell, I can reroll the d20 and must use the new roll",
		"I can do this even if I already used another Metamagic option during the casting of the spell"
	])
});
AddFeatureChoice(ClassList.sorcerer.features["metamagic"], true, "Transmuted Spell", {
	name : "Transmuted Spell",
	source : [["T", 66]],
	description : " [1 sorcery point]" + desc([
		"If the spell deals one of the below damage types, I can change it to another on the list",
		"These damage types are: acid, cold, fire, lightning, poison, or thunder"
	])
});
// Other optional features
AddFeatureChoice(ClassList.sorcerer.features.spellcasting, true, "Sorcerous Versatility (prereq: level 4 sorcerer)", {
	name : "Sorcerous Versatility",
	extraname : "Optional Sorcerer 4",
	source : [["T", 66]],
	description : " [ASI = Ability Score Improvement]" + desc([
		"Whenever I gain an ASI from the sorcerer class, I can change a cantrip or Metamagic choice",
		"I can select either another cantrip from the sorcerer spell list or another Metamagic option"
	]),
	prereqeval : function (v) { return classes.known.sorcerer.level >= 4 ? true : "skip"; }
}, "Optional sorcerer features");
AddFeatureChoice(ClassList.sorcerer.features.spellcasting, true, "Magical Guidance (prereq: level 5 sorcerer)", {
	name : "Magical Guidance",
	extraname : "Optional Sorcerer 5",
	source : [["T", 66]],
	description : " [1 sorcery point]\n   When I make an ability check that fails, I can reroll the d20 and must use the new roll",
	prereqeval : function (v) { return classes.known.sorcerer.level >= 5 ? true : "skip"; }
}, "Optional sorcerer features");

// Sorcerer Subclasses
AddSubClass("sorcerer", "aberrant mind", {
	regExpSearch : /^(?=.*aberrant)(?=.*mind).*$/i,
	subname : "Aberrant Mind",
	source : [["T", 67]],
	features : {
		"subclassfeature1" : {
			name : "Psionic Spells",
			source : [["T", 67]],
			minlevel : 1,
			description : desc([
				"I learn additional spells, which do not count towards the number of spell I can know",
				"Whenever I gain a sorcerer level, I can replace one of these with another of the same level",
				"It must be a divination or enchantment spell on the sorcerer, wizard, or warlock spell list"
			]),
			spellcastingBonus : [{
				name : "Psionic Spells (cantrip)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Ench", "Div"],
				level : [0, 0],
				extraspells : ["mind sliver"],
				selection : ["mind sliver"]
			}, {
				name : "Psionic Spells (1st-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Ench", "Div"],
				level : [1, 1],
				firstCol : "PS",
				extraspells : ["arms of hadar", "dissonant whispers"],
				selection : ["arms of hadar", "dissonant whispers"],
				times : 2
			}, {
				name : "Psionic Spells (2nd-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Ench", "Div"],
				level : [2, 2],
				firstCol : "PS",
				extraspells : ["calm emotions", "detect thoughts"],
				selection : ["calm emotions", "detect thoughts"],
				times : levels.map(function (n) { return n < 3 ? 0 : 2; })
			}, {
				name : "Psionic Spells (3rd-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Ench", "Div"],
				level : [3, 3],
				firstCol : "PS",
				extraspells : ["hunger of hadar", "sending"],
				selection : ["hunger of hadar", "sending"],
				times : levels.map(function (n) { return n < 5 ? 0 : 2; })
			}, {
				name : "Psionic Spells (4th-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Ench", "Div"],
				level : [4, 4],
				firstCol : "PS",
				extraspells : ["evard's black tentacles", "summon aberration"],
				selection : ["evard's black tentacles", "summon aberration"],
				times : levels.map(function (n) { return n < 7 ? 0 : 2; })
			}, {
				name : "Psionic Spells (5th-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Ench", "Div"],
				level : [5, 5],
				firstCol : "PS",
				extraspells : ["rary's telepathic bond", "telekinesis"],
				selection : ["rary's telepathic bond", "telekinesis"],
				times : levels.map(function (n) { return n < 9 ? 0 : 2; })
			}]
		},
		"subclassfeature1.1" : {
			name : "Telepathic Speech",
			source : [["T", 67]],
			minlevel : 1,
			description : desc([
				"As a bonus action, I can telepathic link myself with a creature within 30 ft that I can see",
				"If we share a language, we can talk telepathically while in my Cha mod of miles (min 1)",
				"This last for my level in minutes, until I'm incapacitated, I die, or I use this feature again"
			]),
			action : [["bonus action", ""]],
			additional : levels.map(function (n) {
				return n + " minute" + (n > 1 ? "s" : "");
			})
		},
		"subclassfeature6" : {
			name : "Psionic Sorcery",
			source : [["T", 68]],
			minlevel : 6,
			description : desc([
				"I can expend sorcery points instead of a spell slot to cast a spell from my Psionic Spells",
				"This costs the spell's level in sorcery points, but in doing so requires no other components",
				"However, I do need to provide a material components if it is consumed by the spell"
			])
		},
		"subclassfeature6.1" : {
			name : "Psychic Defenses",
			source : [["T", 68]],
			minlevel : 6,
			description : "\n   I gain resistance to psychic damage and adv. on saves vs. being charmed or frightened",
			dmgres : ["Psychic"],
			savetxt : { adv_vs : ["charmed", "frightened"] }
		},
		"subclassfeature14" : {
			name : "Revelation in Flesh",
			source : [["T", 68]],
			minlevel : 14,
			description : desc([
				"As a bonus action, I can expend 1 or more sorcery points to transform for 10 minutes",
				"For each sorcery point used, I gain one of the following benefits of my choice:",
				" \u2022 I can see any invisible creatures within 60 ft of me not behind total cover",
				" \u2022 I gain a flying speed equal to my walking speed and I can hover",
				" \u2022 I gain a swimming speed equal to twice my walking speed \u0026 I can breathe underwater",
				" \u2022 I can move, with equipment, through any space as narrow as 1 inch without squeezing",
				"   Also, I can spend 5 ft of movement to escape form a grapple or nonmagical restraints"
			]),
			action : [["bonus action", ""]],
			additional : "1+ sorcery points"
		},
		"subclassfeature18" : {
			name : "Warping Implosion",
			source : [["T", 68]],
			minlevel : 18,
			description : desc([
				"As an action, I can teleport to an unoccupied space I can see within 120 ft",
				"All within 30 ft of where I left take 3d10 force damage and must make a Strength save",
				"If failed, each is pulled towards the space I left, ending up in the nearest empty space",
				"If successful, a creature takes only half damage and isn't pulled",
				"I can do this once per long rest, or by expending 5 sorcery points (5 SP)"
			]),
			action : [["action", ""]],
			recovery : "long rest",
			usages : 1,
			altResource : "5 SP"
		}
	}
});
AddSubClass("sorcerer", "clockwork soul", {
	regExpSearch : /^((?=.*(sorcerer|witch))(?=.*mechanus)|(?=.*clockwork)(?=.*soul)).*$/i,
	subname : "Clockwork Soul",
	source : [["T", 68]],
	fullname : "Clockwork Soul",
	features : {
		"subclassfeature1" : {
			name : "Clockwork Magic",
			source : [["T", 68]],
			minlevel : 1,
			description : desc([
				"I learn additional spells, which do not count towards the number of spell I can know",
				"Whenever I gain a sorcerer level, I can replace one of these with another of the same level",
				"It must be an abjuration or transmutation spell on the sorcerer, wizard, or warlock list"
			]),
			spellcastingBonus : [{
				name : "Clockwork Magic (1st-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Abjur", "Trans"],
				level : [1, 1],
				extraspells : ["alarm", "protection from evil and good"],
				selection : ["alarm", "protection from evil and good"],
				times : 2
			}, {
				name : "Clockwork Magic (2nd-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Abjur", "Trans"],
				level : [2, 2],
				extraspells : ["aid", "lesser restoration"],
				selection : ["aid", "lesser restoration"],
				times : levels.map(function (n) { return n < 3 ? 0 : 2; })
			}, {
				name : "Clockwork Magic (3rd-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Abjur", "Trans"],
				level : [3, 3],
				extraspells : ["dispel magic", "protection from energy"],
				selection : ["dispel magic", "protection from energy"],
				times : levels.map(function (n) { return n < 5 ? 0 : 2; })
			}, {
				name : "Clockwork Magic (4th-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Abjur", "Trans"],
				level : [4, 4],
				extraspells : ["freedom of movement", "summon construct"],
				selection : ["freedom of movement", "summon construct"],
				times : levels.map(function (n) { return n < 7 ? 0 : 2; })
			}, {
				name : "Clockwork Magic (5th-level)",
				"class" : ["sorcerer", "warlock", "wizard"],
				school : ["Abjur", "Trans"],
				level : [5, 5],
				extraspells : ["greater restoration", "wall of force"],
				selection : ["greater restoration", "wall of force"],
				times : levels.map(function (n) { return n < 9 ? 0 : 2; })
			}]
		},
		"subclassfeature1.1" : {
			name : "Restore Balance",
			source : [["T", 69]],
			minlevel : 1,
			description : desc([
				"As a reaction when a creature I can see in 60 ft is about to roll a d20 with adv./disadv.,",
				"I can prevent that roll from being affected by advantage and disadvantage"
			]),
			action : [["reaction", ""]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature6" : {
			name : "Bulwark of Law",
			source : [["T", 69]],
			minlevel : 6,
			description : desc([
				"As an action, I can imbue a creature I can see within 30 ft with a magical ward",
				"The ward has a number of d8s equal to the number of sorcery points I expend to do this",
				"As a reaction when the creature takes damage, it can expend any number of those dice",
				"The dice roll reduces the damage; The ward lasts until I finish a long rest or do this again"
			]),
			additional : "1-5 sorcery points; 1d8 per point",
			action : [["action", ""]]
		},
		"subclassfeature14" : {
			name : "Trance of Order",
			source : [["T", 69]],
			minlevel : 14,
			description : desc([
				"As a bonus action, I can enter a state of clockwork consciousness for 1 minute",
				"While in this state, attack rolls against me can't benefit from advantage",
				"Also, I can then treat a d20 roll below 9 as a 10 for my attack rolls, checks, and saves",
				"I can do this once per long rest, or by expending 5 sorcery points (5 SP)"
			]),
			action : [["bonus action", ""]],
			usages : 1,
			recovery : "long rest",
			altResource : "5 SP"
		},
		"subclassfeature18" : {
			name : "Clockwork Cavalcade",
			source : [["T", 69]],
			minlevel : 18,
			description : desc([
				"As an action, I can call spirits to bring balance in a 30-ft cube originating from me",
				"Inside the cube, the intangible spirits do all the following before vanishing:",
				" \u2022 Restore up to 100 HP, divided among the creatures in the cube as I choose",
				" \u2022 Repair all damaged objects entirely in the cube instantly",
				" \u2022 End every spell of 6th-level or lower on objects or creatures of my choice in the cube",
				"I can do this once per long rest, or by expending 7 sorcery points (7 SP)"
			]),
			action : [["action", ""]],
			usages : 1,
			recovery : "long rest",
			altResource : "7 SP"
		}
	}
});


// >>>>>>>>>>>>>>>>>>>>>>> //
// >>> Warlock Options >>> //
// >>>>>>>>>>>>>>>>>>>>>>> //

// Warlock Optional Class Features
AddFeatureChoice(ClassList.warlock.features["pact magic"], true, "Additional Warlock Spells", {
	name : "Additional Warlock Spells",
	extraname : "Optional Warlock 1",
	source : [["T", 70]],
	description : "",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "warlock" || (spType.indexOf("bonus") !== -1 && (!spList["class"] || spList["class"] !== "warlock"))) return;
				spList.extraspells = spList.extraspells.concat(["mislead", "planar binding", "teleportation circle", "gate", "weird"]);
			},
			"This optional class feature expands the spell list of the warlock class with the following spells (spell level in brackets): Mislead (5), Planar Binding (5), Teleportation Circle (5), Gate (9), and Weird (9)."
		]
	}
}, "Optional 1st-level warlock features");
AddWarlockPactBoon("Pact of the Talisman", {
	name : "Pact of the Talisman",
	source : [["T", 70]],
	description : desc([
		"When the wearer of this amulet fails an ability check, they can add +1d4 to the roll",
		"I can give the talisman to others to use; The talisman turns to ash when I die",
		"If I lose my talisman, I can perform a 1-hour ceremony to gain a replacement",
		"This ceremony destroys the previous amulet and can be done during a short or long rest"
	]),
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus')",
	recovery : "long rest"
});
AddFeatureChoice(ClassList.warlock.features["pact boon"], true, "Eldritch Versatility", {
	name : "Eldritch Versatility",
	extraname : "Optional Warlock 4",
	source : [["T", 70]],
	description : " [ASI = Ability Score Improvement]" + desc([
		"Whenever I gain an ASI from the warlock class, I can change one of the following things:",
		" \u2022 I can replace one warlock cantrip with another cantrip from the warlock spell list",
		" \u2022 I can replace my pact boon for another",
		" \u2022 If I have Mystic Arcanum, I can replace one spell from it with another of the same level"
	]),
	prereqeval : function (v) { return classes.known.warlock.level >= 4 ? true : "skip"; }
}, "Optional 4th-level warlock features");
// Eldritch Invocation options
AddWarlockInvocation("Bond of the Talisman (prereq: level 12 warlock, Pact of the Talisman)", {
	name : "Bond of the Talisman",
	source : [["T", 70]],
	submenu : "[improves Pact of the Talisman]",
	description : desc([
		"As an action, I can teleport to the unoccupied space closest to the wearer of my talisman",
		"The talisman's wearer can do the same to teleport to me; Only works if both on same plane"
	]),
	prereqeval : function(v) {
		return classes.known.warlock.level >= 12 && GetFeatureChoice('class', 'warlock', 'pact boon').indexOf("pact of the talisman") !== -1;
	},
	action : [["action", ""]],
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus')",
	recovery : "long rest"
});
AddWarlockInvocation("Eldritch Mind", {
	name : "Eldritch Mind",
	source : [["T", 71]],
	description : "\n   I have advantage on my Constitution saving throws to maintain concentration on a spell",
	savetxt : { text : "Adv. on Con (Concentration) saves" }
});
AddWarlockInvocation("Far Scribe (prereq: level 5 warlock, Pact of the Tome)", {
	name : "Far Scribe",
	source : [["T", 71]],
	submenu : "[improves Pact of the Tome]",
	description : desc([
		"My book of shadows has a new page; As an action, a creature can write its name on it",
		"This page can hold my Proficiency Bonus in creature names; I can remove one as an action",
		"I can cast Sending without a spell slot or material components, targeting one on the page",
		"Instead of saying the message, I write it on the page and any reply appears there as well",
		"This writing disappears after 1 minute; The target still hears the message in their mind"
	]),
	prereqeval : function(v) {
		return classes.known.warlock.level >= 5 && GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the tome';
	},
	action : [["action", " (erase name)"]],
	spellcastingBonus : {
		name : "Far Scribe",
		spells : ["sending"],
		selection : ["sending"],
		firstCol : "atwill"
	},
	spellChanges : {
		"sending" : {
			components : "V,S",
			compMaterial : "",
			description : "Send 25 word message to crea named in book of shadows; it recognizes me and can respond 25 words",
			changes : "By using Far Scribe, I can cast Sending without using a spell slot or material components, but only to target one of the creatures that wrote their name in my book of shadows. Instead of speaking the message, I write it in my book and any response appears there as well, lasting for 1 minute. The target still hears the message in their mind."
		}
	}
});
AddWarlockInvocation("Gift of the Protectors (prereq: level 9 warlock, Pact of the Tome)", {
	name : "Gift of the Protectors",
	source : [["T", 71]],
	submenu : "[improves Pact of the Tome]",
	description : desc([
		"My book of shadows has a new page; As an action, a creature can write its name on it",
		"This page can hold my Proficiency Bonus in creature names; I can remove one as an action",
		"If a creature whose name is on the page drops to 0 HP, it magically drops to 1 HP instead",
		"This doesn't work if the creature would be killed outright"
	]),
	prereqeval : function(v) {
		return classes.known.warlock.level >= 9 && GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the tome';
	},
	action : [["action", " (erase name)"]],
	usages : 1,
	recovery : "long rest"
});
AddWarlockInvocation("Investment of the Chain Master (prereq: Pact of the Chain)", {
	name : "Investment of the Chain Master",
	source : [["T", 71]],
	submenu : "[improves Pact of the Chain]",
	description : desc([
		"When I cast Find Familiar, the summoned create has additional benefits:",
		"\u2022 It gains a flying or swimming speed of 40 ft (my choice at casting)",
		"\u2022 As a bonus action, I can command it to take the Attack action",
		"\u2022 Its weapon attacks are considered magical for overcoming immunities and resistances",
		"\u2022 If it forces a creature to make a saving throw, it uses my spell save DC",
		"\u2022 As a reaction when it takes damage, I can grant it resistance against that damage"
	]),
	action : [["bonus action", " (command to attack)"], ["reaction", " (give resistance)"]],
	prereqeval : function(v) {
		return GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the chain';
	},
	calcChanges : {
		companionCallback : [function(prefix, oCrea, bAdd, sCompType) {
			if (sCompType !== "pact_of_the_chain") return;
			var strFea = "\u25C6 Investment of the Chain Master (TCoE 71): The familiar gains 40 ft fly or swim speed (my choice), its attacks are considered magical, and it can use my spell save DC instead of its own DC's (if any).";
			var strSpd = "fly or swim 40 ft";
			if (What("Unit System") === "metric") {
				strFea = ConvertToMetric(strFea, 0.5);
				strSpd = ConvertToMetric(strSpd, 0.5);
			}
			var aFnc = bAdd ? AddString : RemoveString;
			aFnc(prefix + "Comp.Use.Features", strFea, true);
			aFnc(prefix + "Comp.Use.Speed", strSpd, typePF ? ",\n" : ", ");
			for (var i = 1; i <= 3; i++) {
				var baseFld = prefix + "Comp.Use.Attack." + i;
				var weaDescrFld = baseFld + ".Description";
				var strWeaDescr = What(weaDescrFld);
				if (bAdd && What(baseFld + ".Weapon Selection") && !(/(,|;)? ?counts as magical/i).test(strWeaDescr)) {
					AddString(weaDescrFld, "Counts as magical", "; ");
				} else if (!bAdd) {
					Value(weaDescrFld, strWeaDescr.replace(/(,|;)? ?counts as magical/i, ''));
				}
			}
		},
		"My pact of the chain familiars gain an extra feature listing the extra bonuses they gain."]
	}
});
AddWarlockInvocation("Protection of the Talisman (prereq: level 7 warlock, Pact of the Talisman)", {
	name : "Protection of the Talisman",
	source : [["T", 71]],
	submenu : "[improves Pact of the Talisman]",
	description : "\n   When the wearer of my talisman fails a saving throw, they can add +1d4 to the roll",
	prereqeval : function(v) {
		return classes.known.warlock.level >= 7 && GetFeatureChoice('class', 'warlock', 'pact boon').indexOf("pact of the talisman") !== -1;
	},
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus')",
	recovery : "long rest"
});
AddWarlockInvocation("Rebuke of the Talisman (prereq: Pact of the Talisman)", {
	name : "Rebuke of the Talisman",
	source : [["T", 71]],
	submenu : "[improves Pact of the Talisman]",
	description : desc([
		"As a reaction when the wearer of my talisman is hit, I deal damage and push the attacker",
		"To be able to do this, I have to see the attacker and it has to be within 30 ft of me",
		"I deal it my Proficiency Bonus in psychic damage and push it 10 ft away from the talisman"
	]),
	prereqeval : function(v) {
		return GetFeatureChoice('class', 'warlock', 'pact boon').indexOf("pact of the talisman") !== -1;
	},
	action : [["reaction", ""]]
});
AddWarlockInvocation("Undying Servitude (prereq: level 5 warlock)", {
	name : "Undying Servitude",
	description : "\n   Once per long rest, I can cast Animate Dead without using a spell slot",
	source : [["T", 71]],
	submenu : "[warlock level  5+]",
	usages : 1,
	additional : "no spell slot",
	recovery : "long rest",
	spellcastingBonus : {
		name : "Undying Servitude",
		spells : ["animate dead"],
		selection : ["animate dead"],
		firstCol : "oncelr"
	},
	prereqeval : function(v) { return classes.known.warlock.level >= 5; }
});

// Warlock Subclasses
AddSubClass("warlock", "the fathomless", {
	regExpSearch : /^(?=.*warlock)(?=.*fathomless).*$/i,
	subname : "the Fathomless",
	source : [["T", 72]],
	spellcastingExtra : ["create or destroy water", "thunderwave", "gust of wind", "silence", "lightning bolt", "sleet storm", "control water", "summon elemental", "bigby's hand", "cone of cold"],
	features : {
		"subclassfeature1" : {
			name : "Tentacle of the Deeps",
			source : [["T", 72]],
			minlevel : 1,
			description : desc([
				"As a bonus action, I can summon or move a spectral tentacle and make an attack with it",
				"I can summon it to a space within 60 ft that I can see or move an existing one 30 ft",
				"I make melee spell attacks with 10 ft reach with it that deal cold damage",
				"Creatures hit by the tentacle suffer 10 ft speed reduction until the start of my next turn",
				"The 10-ft long tentacle lasts for 1 minute or until I summon another"
			]),
			action : [["bonus action", " (summon/move)"]],
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : levels.map(function (n) {
				return (n < 10 ? 1 : 2) + "d8";
			}),
			weaponOptions : [{
				regExpSearch : /^(?=.*tentacle)(?=.*\b(deeps?|spectral)\b).*$/i,
				name : "Tentacle of the Deeps",
				source : [["T", 72]],
				ability : 6,
				type : "Spell",
				damage : [1, 8, "Cold"],
				range : "Melee (10 ft)",
				description : "On hit, -10 ft speed until my next turn starts",
				abilitytodamage : false,
				tentacleOfTheDeeps : true,
				selectNow : true
			}],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.theWea.tentacleOfTheDeeps && classes.known.warlock.level >= 10) {
							fields.Damage_Die = '2d8';
						};
					},
					'',
					1
				]
			}
		},
		"subclassfeature1.1" : {
			name : "Gift of the Sea",
			source : [["T", 72]],
			minlevel : 1,
			description : "\n   I have a swimming speed of 40 ft and I can breathe underwater",
			speed : { swim : { spd : 40, enc : 30 } }
		},
		"subclassfeature6" : {
			name : "Oceanic Soul",
			source : [["T", 73]],
			minlevel : 6,
			description : desc([
				"I gain resistance to cold damage now that I'm even more at home in the depths",
				"While I'm fully submerged, others who are as well can understand my speech and I theirs"
			]),
			dmgres : ["Cold"],
			spellChanges : {
				"summon elemental" : {
					description : "Summon Water Elemental Spirit; obeys commands; takes turn after mine; vanishes at 0 hp (400gp)",
					changes : "My warlock spell Summon Elemental can only call forth an elemental spirit of water."
				}
			}
		},
		"subclassfeature6.1" : {
			name : "Guardian Coil",
			source : [["T", 73]],
			minlevel : 6,
			description : desc([
				"As a reaction when I or a creature I see in 10 ft of my tentacle is damaged, it can help",
				"The tentacle interposes itself, reducing the damage of the attack for that creature"
			]),
			action : [["reaction", ""]],
			additional : levels.map(function (n) {
				return (n < 10 ? 1 : 2) + "d8 damage reduced";
			})
		},
		"subclassfeature10" : {
			name : "Grasping Tentacles",
			source : [["T", 73]],
			minlevel : 10,
			description : desc([
				"I learn Evard's Black Tentacles; Once per long rest, I can cast it without using a spell slot",
				"It counts as a warlock spell for me, but not towards the number of spell I can know",
				"Whenever I cast it, I gain temporary hit points equal to my warlock level",
				"Moreover, damage can't break my concentration on this spell"
			]),
			action : [["action", ""]],
			additional : levels.map(function (n) {
				return n < 10 ? "" : n + " temp HP; 1\xD7 per long rest no SS";
			}),
			spellcastingBonus : {
				name : "Grasping Tentacles",
				spells : ["evard's black tentacles"],
				selection : ["evard's black tentacles"],
				firstCol : "oncelr"
			},
			extraLimitedFeatures : [{
				name : "Evard's Black Tentacles (no spell slot)",
				usages : 1,
				recovery : "long rest"
			}],
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellKey === "evard's black tentacles") {
							spellObj.description = "I temp hp; All enter/start in 20-ft rad save or restrained \u0026 3d6 Bludg. dmg/rnd; Str/Dex check escape";
							spellObj.duration = "Conc*, 1 min";
							return true;
						}
					},
					"Whenever I cast Evard's Black Tentacles, I gain temporary hit points equal to my warlock level.\n \u2022 Damage can't break my concentration on this spell."
				]
			}
		},
		"subclassfeature14" : {
			name : "Fathomless Plunge",
			source : [["T", 73]],
			minlevel : 14,
			description : desc([
				"As an action, I can teleport myself and up to 5 willing creatures I can see within 30 ft",
				"We reappear up to 1 mile away, inside or within 30 ft of a body of water I've seen"
			]),
			action : [["action", ""]],
			recovery : "short rest",
			usages : 1
		}
	}
});
AddSubClass("warlock", "the genie", {
	regExpSearch : /^(?=.*warlock)(?=.*(genie|dao|djinni|efreeti|marid)).*$/i,
	subname : "the Genie",
	source : [["T", 73], ["UA:SR", 2]],
	features : {
		"subclassfeature1" : {
			name : "Choose Genie Kind",
			source : [["T", 73], ["UA:SR", 3]],
			minlevel : 1,
			description : '\n   Use the "Choose Feature" button above to choose the kind of genie your patron is',
			calcChanges : {
				spellList : [
					function(spList, spName, spType) {
						if (spType.indexOf("bonus") !== -1 && spList.name && /mystic arcanum/i.test(spList.name) && spList.level[0] === 9) {
							spList.extraspells.push("wish");
						} else if (spType.indexOf("bonus") === -1 && spName === "warlock") {
							if (!spList.notspells) spList.notspells = [];
							spList.notspells.push("wish");
						}
					},
					"The Genie patron adds Wish as a spell available for my 9th-level Mystic Arcanum selection."
				]
			},
			choices : ["Dao (earth)", "Djinni (air)", "Efreeti (fire)", "Marid (water)"],
			"dao (earth)" : {
				name : "Dao Genie Patron",
				description : "\n   My genie patron is a Dao, associated with earth",
				spellcastingExtra : ["detect evil and good", "sanctuary", "phantasmal force", "spike growth", "create food and water", "meld into stone", "phantasmal killer", "stone shape", "creation", "wall of stone", "wish"]
			},
			"djinni (air)" : {
				name : "Djinni Genie Patron",
				description : "\n   My genie patron is a Djinni, associated with air",
				spellcastingExtra : ["detect evil and good", "thunderwave", "gust of wind", "phantasmal force", "create food and water", "wind wall", "greater invisibility", "phantasmal killer", "creation", "seeming", "wish"]
			},
			"efreeti (fire)" : {
				name : "Efreeti Genie Patron",
				description : "\n   My genie patron is an Efreeti, associated with fire",
				spellcastingExtra : ["burning hands", "detect evil and good", "phantasmal force", "scorching ray", "create food and water", "fireball", "fire shield", "phantasmal killer", "creation", "flame strike", "wish"]
			},
			"marid (water)" : {
				name : "Marid Genie Patron",
				description : "\n   My genie patron is a Marid, associated with water",
				spellcastingExtra : ["detect evil and good", "fog cloud", "blur", "phantasmal force", "create food and water", "sleet storm", "control water", "phantasmal killer", "cone of cold", "creation", "wish"]
			},
			choiceDependencies : [{
				feature : "subclassfeature1.3"
			}, {
				feature : "subclassfeature6"
			}]
		},
		"subclassfeature1.1" : {
			name : "Genie's Vessel",
			source : [["T", 73], ["UA:SR", 3]],
			minlevel : 1,
			description : desc([
				"My patron gifts me a magical vessel, a Tiny object, granting me a measure of its power",
				"I choose the vessel's appearance; I can use it as my spellcasting focus for warlock spells",
				"The vessel's AC is my spell save DC and it has my warlock level + Proficiency Bonus in HP",
				"If it is destroyed or lost, I can get a replacement with a 1-hour ceremony during a rest"
			])
		},
		"subclassfeature1.2" : {
			name : "Genie's Vessel: Bottled Respite",
			source : [["T", 74], ["UA:SR", 3]],
			minlevel : 1,
			description : desc([
				"As an action, I can vanish and enter the extradimensional space inside my genie's vessel",
				"The vessel stays in its location; The space inside is a 20-ft high, 20-ft radius cylinder",
				"As a bonus action, I can exit my vessel; I exit it early if I die or the vessel is destroyed",
				"I can remain inside for twice my Proficiency Bonus in hours; Objects can be left inside"
			]),
			limfeaname : "Bottled Respite",
			action : [["action", " (enter)"], ["bonus action", " (eject)"]],
			usages : 1,
			recovery : "long rest"
		},
		"subclassfeature1.3" : {
			name : "Genie's Wrath",
			source : [["T", 73], ["UA:SR", 3]],
			minlevel : 1,
			description : desc([
				"I can deal bonus damage on my attacks, its type depending on my patron's genie kind",
				'Use the "Choose Feature" button above to choose the kind of genie your patron is'
			]),
			choices : ["dao (earth)", "djinni (air)", "efreeti (fire)", "marid (water)"],
			choicesNotInMenu : true,
			"dao (earth)" : {
				name : "Dao's Wrath",
				description : " [once on each of my turns]\n   When I hit an attack, I can have it deal my Prof Bonus in extra bludgeoning damage",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (!v.isDC) {
								fields.Description += (fields.Description ? '; ' : '') + 'Once per my turn +' + How('Proficiency Bonus') + ' bludgeoning damage';
							}
						},
						"Once on each of my turns, I can have one of my attacks that hit deal extra bludgeoning damage equal to my proficiency bonus."
					]
				}
			},
			"djinni (air)" : {
				name : "Djinni's Wrath",
				description : " [once on each of my turns]\n   When I hit an attack, I can have it deal my Proficiency Bonus in extra thunder damage",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (!v.isDC) {
								fields.Description += (fields.Description ? '; ' : '') + 'Once per my turn +' + How('Proficiency Bonus') + ' thunder damage';
							}
						},
						"Once on each of my turns, I can have one of my attacks that hit deal extra thunder damage equal to my proficiency bonus."
					]
				}
			},
			"efreeti (fire)" : {
				name : "Efreeti's Wrath",
				description : " [once on each of my turns]\n   When I hit an attack, I can have it deal my Proficiency Bonus in extra fire damage",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (!v.isDC) {
								fields.Description += (fields.Description ? '; ' : '') + 'Once per my turn +' + How('Proficiency Bonus') + ' fire damage';
							}
						},
						"Once on each of my turns, I can have one of my attacks that hit deal extra fire damage equal to my proficiency bonus."
					]
				}
			},
			"marid (water)" : {
				name : "Marid's Wrath",
				description : " [once on each of my turns]\n   When I hit an attack, I can have it deal my Proficiency Bonus in extra cold damage",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (!v.isDC) {
								fields.Description += (fields.Description ? '; ' : '') + 'Once per my turn +' + How('Proficiency Bonus') + ' cold damage';
							}
						},
						"Once on each of my turns, I can have one of my attacks that hit deal extra cold damage equal to my proficiency bonus."
					]
				}
			}
		},
		"subclassfeature6" : {
			name : "Elemental Gift",
			source : [["T", 75], ["UA:SR", 3]],
			minlevel : 6,
			description : desc([
				"I gain resistance to a damage type depending on my patron's genie kind",
				'Use the "Choose Feature" button above to choose the kind of genie your patron is',
				"As a bonus action, I can gain a flying speed of 30 ft and I can hover, for 10 minutes"
			]),
			choices : ["dao (earth)", "djinni (air)", "efreeti (fire)", "marid (water)"],
			choicesNotInMenu : true,
			"dao (earth)" : {
				name : "Dao's Elemental Gift",
				description : desc([
					"I gain resistance to bludgeoning damage",
					"As a bonus action, I can gain a flying speed of 30 ft and I can hover, for 10 minutes"
				]),
				action : [["bonus action", " (start fly)"]],
				dmgres : ["Bludgeoning"]
			},
			"djinni (air)" : {
				name : "Djinni's Elemental Gift",
				description : desc([
					"I gain resistance to thunder damage",
					"As a bonus action, I can gain a flying speed of 30 ft and I can hover, for 10 minutes"
				]),
				action : [["bonus action", " (start fly)"]],
				dmgres : ["Thunder"]
			},
			"efreeti (fire)" : {
				name : "Efreeti's Elemental Gift",
				description : desc([
					"I gain resistance to fire damage",
					"As a bonus action, I can gain a flying speed of 30 ft and I can hover, for 10 minutes"
				]),
				action : [["bonus action", " (start fly)"]],
				dmgres : ["Fire"]
			},
			"marid (water)" : {
				name : "Marid's Elemental Gift",
				description : desc([
					"I gain resistance to cold damage",
					"As a bonus action, I can gain a flying speed of 30 ft and I can hover, for 10 minutes"
				]),
				action : [["bonus action", " (start fly)"]],
				dmgres : ["Cold"]
			},
			additional : "Fly 10 min",
			usages : "Prof Bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature10" : {
			name : "Sanctuary Vessel",
			source : [["T", 75], ["UA:SR", 3]],
			minlevel : 10,
			description : desc([
				"When I enter my vessel I can have up to 5 willing creatures I can see in 30 ft join me",
				"As a bonus action, I can eject any number of creatures from my genie's vessel",
				"Everyone is ejected when I leave it, I die, or if the vessel is destroyed",
				"Anyone who remains in the vessel for at least 10 min gains the benefits of a short rest",
				"Also, HD spend as part of this short rest has my Proficiency Bonus added to the roll"
			])
		},
		"subclassfeature14" : {
			name : "Limited Wish",
			source : [["T", 75], ["UA:SR", 3]],
			minlevel : 14,
			description : " [1\xD7 per 1d4 long rests]" + desc([
				"As an action, I can cast a 6th-level or lower spell with a casting time time of one action",
				"This can be any spell; It doesn't require any costly components, it simply takes effect"
			]),
			action : [["action", ""]],
			extraLimitedFeatures : [{
				name : "Limited Wish",
				usages : 1,
				recovery : "1d4 LR"
			}]
		}
	}
});


// >>>>>>>>>>>>>>>>>>>>>> //
// >>> Wizard Options >>> //
// >>>>>>>>>>>>>>>>>>>>>> //

// Wizard Optional Class Features
AddFeatureChoice(ClassList.wizard.features.spellcasting, true, "Additional Wizard Spells", {
	name : "Additional Wizard Spells",
	extraname : "Optional Wizard 1",
	source : [["T", 75]],
	description : "",
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Stop this is not the class' spell list or if this is for a bonus spell entry
				if (spName !== "wizard" || spType.indexOf("bonus") !== -1) return;
				spList.extraspells = spList.extraspells.concat(["augury", "enhance ability", "speak with dead", "divination"]);
			},
			"This optional class feature expands the spell list of the wizard class with the following spells (spell level in brackets): Augury (2), Enhance Ability (2), Speak with Dead (3), and Divination (4)."
		]
	}
}, "Optional 1st-level wizard features");
AddFeatureChoice(ClassList.wizard.features["arcane recovery"], true, "Cantrip Formulas", {
	name : "Cantrip Formulas",
	extraname : "Optional Wizard 3",
	source : [["T", 76]],
	description : desc([
		"I have scribed arcane formulas in my spellbook with which I formulate cantrips in my mind",
		"Whenever I finish a long rest, I can use this to change a wizard cantrip I know for another"
	]),
	prereqeval : function (v) { return classes.known.wizard.level >= 3 ? true : "skip"; }
}, "Optional 3rd-level wizard features");

// Wizard Subclasses
AddSubClass("wizard","order of scribes", {
	regExpSearch : /^(?=.*wizard)(?=.*order)(?=.*scribes?).*$|scrivener/i,
	subname : "Order of Scribes",
	source : [["T", 77]],
	features : {
		"subclassfeature2" : {
			name : "Wizardly Quill",
			source : [["T", 77]],
			minlevel : 2,
			description : desc([
				"As a bonus action, I can magically create a Tiny quill with the following properties:",
				" \u2022 It doesn't require ink and produces ink in the color of my choice when writing with it",
				" \u2022 I require only 2 minutes per spell level to transcribe spells into my spellbook with it",
				" \u2022 As a bonus action, I can use it to erase a text written with it if within 5 ft of the text",
				"The quill disappear if I create another or if I die"
			]),
			action : [["bonus action", " (create/erase)"]]
		},
		"subclassfeature2.1" : {
			name : "Awakened Spellbook",
			source : [["T", 77]],
			minlevel : 2,
			description : desc([
				"My spellbook gains sentience and grants me the following benefits while I am holding it:",
				" \u2022 I can use the book as a spellcasting focus for my wizard spells",
				" \u2022 When I cast a wizard spell using a spell slot, I can temporarily replace its damage type",
				"   The new type must appear in my spellbook in a spell of the same level as the spell slot",
				" \u2022 Once per long rest, I can ritual cast a wizard spell without 10 min extra casting time",
				"I can replace it over a short rest, transferring its spells and sentience to a blank book"
			]),
			additional : "fast ritual cast",
			usages : 1,
			recovery : "long rest"
		},
		"subclassfeature6" : {
			name : "Manifest Mind",
			source : [["T", 78]],
			minlevel : 6,
			description : desc([
				"As a bonus action, I can have the mind of my awakened spellbook manifest within 60 ft",
				"The spellbook needs to be on my person to do this; The mind is a Tiny spectral object",
				"The mind is intangible, doesn't occupy a space, hovers, and sheds dim light in 10 ft",
				"It can hear, see, has 60 ft darkvision, and telepathically shares with me what it perceives",
				"As a bonus action, I can dismiss it or move it up to 30 ft to an empty space I can see",
				"It can pass through creatures; It stops manifesting if it's over 300 ft from me or I die",
				"It also stop manifesting if Dispel Magic is cast on it or the awakened spellbook is no more",
				"I can do this once per long rest, or by expending a spell slot (SS 1+) to manifest it again"
			]),
			action : [["bonus action", " (conjure/move/dismiss)"]],
			usages : 1,
			recovery : "long rest",
			altResource : "SS 1+"
		},
		"subclassfeature6.1" : {
			name : "Manifest Mind: Cast Spell",
			source : [["T", 78]],
			minlevel : 6,
			description : desc([
				"I can have wizard spells I cast on my turn originate from the mind while its manifested"
			]),
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature10" : {
			name : "Master Scrivener",
			source : [["T", 78]],
			minlevel : 10,
			description : desc([
				"When I finish a long rest, I can write a spell in my awakened spellbook on a blank paper",
				"It must be a level 1 or 2 spell with 1 action casting time; My spellbook must be in 5 ft",
				"As an action, I can use this scroll to cast the spell on it at one higher level than normal",
				"Only I can use the scroll; The scroll turns blank again when I use it or finish a long rest",
				"Also, using my Wizardly Quill, the gold and time I need to craft spell scrolls is halved"
			]),
			action : [["action", " (cast scroll)"]],
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Master Scrivener scoll",
				"class" : "wizard",
				level : [1, 2],
				firstCol : "MS"
			},
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName, isDuplicate) {
						if (!isDuplicate && spName === "wizard" && spellObj.firstCol === "MS" && (spellObj.level === 1 || spellObj.level === 2)) {
							// Calculate upcasting to be exactly 1 level higher
							var rxMatch = /(\d*d?\d+)\+(\d*d?\d+)\/(\d*SL)\b/i;
							while (rxMatch.test(spellObj.description)) {
								var aMatch = spellObj.description.match(rxMatch);
								var strDie1 = !isNaN(aMatch[1]) ? true : /\d+d\d+/i.test(aMatch[1]) ? aMatch[1].replace(/\d+(d\d+)/i, "$1") : false;
								var strDie2 = !isNaN(aMatch[2]) ? true : /\d+d\d+/i.test(aMatch[2]) ? aMatch[2].replace(/\d+(d\d+)/i, "$1") : undefined;
								if (!/^SL$/i.test(aMatch[3])) {
									// only increases if more than 1 level higher spell slot, so nothing we can do with it, just remove all upcasting
									removeSpellUpcasting(spellObj);
								} else if (/^\d/.test(aMatch[1]) && strDie1 === strDie2) {
									// identical type steps (e.g. 1d6+1d6/SL or 3+1/SL), so add the second to the first
									var strNew = (Number(aMatch[1].replace(/^(\d+).*/, "$1")) + Number(aMatch[2].replace(/^(\d+).*/, "$1"))) + aMatch[1].replace(/^\d+(.*)/, "$1");
									spellObj.description = spellObj.description.replace(rxMatch, strNew);
								} else {
									// non-identical steps, so leave the first and second along, but remove the /SL
									spellObj.description = spellObj.description.replace(rxMatch, "$1+$2");
								}
							}
							// Remove costly material components
							spellObj.description = spellObj.description.replace(/ \(\d+ ?gp( cons\.?)?\)/i, '');
							// List only the scroll as a component from the spell
							spellObj.components = "M\u2020";
							spellObj.compMaterial = "Spells cast from spell scrolls don't require any components other than the spell scroll itself.";
							return true;
						}
					},
					"When I finish a long rest, I can create a scroll of a spell in my spellbook using my Master Scrivener class feature. I can then cast this spell from the scroll and the spell is cast as if using a spell slot one level higher than its spell level."
				]
			}
		},
		"subclassfeature14" : {
			name : "One with the Word",
			source : [["T", 78]],
			minlevel : 14,
			description : ' [see 3rd page "Notes" section]',
			action : [["reaction", " (when damaged)"]],
			advantages : [["Arcana", true]],
			"one with the word" : {
				name : "One with the Word",
				extraname : "Order of Scribes 14",
				source : [["T", 78]],
				description : desc([
					"While my awakened spellbook is on my person, I have advantage on Int (Arcana) checks",
					"As a reaction when I take damage while my spellbook's mind is manifested, I can dismiss it",
					"In dismissing the manifested mind like this, I prevent all of the damage taken by me",
					"After doing so, I lose spells with a combined level of 3d6 from my awakened spellbook",
					"If I do not have enough spells left to cover the number rolled, I drop to 0 HP instead",
					"The spells vanish from my spellbook, reappearing only after I finish 1d6 long rests",
					"I can't cast spells that I lost this way, even if found on a scroll or in another spellbook"
				]),
				usages : 1,
				recovery : "long rest"
			},
			autoSelectExtrachoices : [{
				extrachoice : "one with the word"
			}]
		}
	}
});


// >>>>>>>>>>>>>>>>> //
// >>> New Feats >>> //
// >>>>>>>>>>>>>>>>> //
FeatsList["artificer initiate"] = {
	name : "Artificer Initiate",
	source : [["T", 79], ["UA:F2", 1]],
	descriptionFull : "You've learned some of an artificer's inventiveness:\n \u2022 You learn one cantrip of your choice from the artificer spell list, and you learn one 1st-level spell of your choice from that list. Intelligence is your spellcasting ability for these spells.\n \u2022 You can cast this feat's 1st-level spell without a spell slot, and you must finish a long rest before you can cast it in this way again. You can also cast the spell using any spell slots you have.\n \u2022 You gain proficiency with one type of artisan's tools of your choice, and you can use that type of tool as a spellcasting focus for any spell you cast that uses Intelligence as its spellcasting ability.",
	description : typePF ? "I learn a cantrip and a 1st-level spell from the artificer's spell list. Int is my spellcasting ability for these. Once per long rest, I can cast the 1st-level spell at its lowest level without using a spell slot. I gain proficiency in one artisan's tool, which I can use as a spellcasting focus for spells I cast with Int as spellcasting ability." : "I learn one cantrip and one 1st-level spell from the artificer's spell list. Intelligence is my spellcasting ability for these. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot. I gain proficiency in one artisan's tool, which I can use as a spellcasting focus for any spell I cast that uses Intelligence as its spellcasting ability.",
	spellcastingBonus : [{
		name : "Artificer cantrip",
		spellcastingAbility : 4,
		allowUpCasting : true,
		"class" : 'artificer',
		level : [0, 0],
		atwill : true
	}, {
		name : "1st-level artificer spell",
		"class" : 'artificer',
		level : [1, 1],
		oncelr : true
	}],
	toolProfs : [ ["Artisan's tools", 1] ]
};
FeatsList["chef"] = {
	name : "Chef",
	source : [["T", 79], ["UA:F2", 1]],
	descriptionFull : "Time spent mastering the culinary arts has paid off, granting you the following benefits:\n \u2022 Increase your Constitution or Wisdom score by 1, to a maximum of 20.\n \u2022 You gain proficiency with cook's utensils if you don't already have it.\n \u2022 As part of a short rest, you can cook special food, provided you have ingredients and cook's utensils on hand. You can prepare enough of this food for a number of creatures equal to 4 + your proficiency bonus. At the end of the short rest, any creature who eats the food and spends one or more Hit Dice to regain hit points regains an extra 1d8 hit points.\n \u2022 With one hour of work or when you finish a long rest, you can cook a number of treats equal to your proficiency bonus. These special treats last 8 hours after being made. A creature can use a bonus action to eat one of those treats to gain temporary hit points equal to your proficiency bonus.",
	description : "During a short rest, I can make food for 4 + my Prof" + (typePF ? "" : "iciency") + " Bonus creatures; if they eat it and spend 1" + (typePF ? "+ HD" : " or more Hit Die") + ", they regain 1d8 HP. In one hour or during a long rest, I can make treats equal to my Prof" + (typePF ? "" : "iciency") + " Bonus that last for 8 hours; As a bonus action, one can eat a treat, gaining my Prof" + (typePF ? "" : "iciency") + " Bonus in temporary HP. [+1 " + (typePF ? "Con or Wis" : "Constitution or Wisdom") + "]",
	action : [["bonus action", "Consume Chef's Treat"]],
	toolProfs : ["Cook's utensils"],
	scorestxt : "+1 Constitution or Wisdom"
};
FeatsList["crusher"] = {
	name : "Crusher",
	source : [["T", 79]],
	descriptionFull : "You are practiced in the art of crushing your enemies, granting you the following benefits:\n \u2022 Increase your Strength or Constitution by 1, to a maximum of 20.\n \u2022 Once per turn, when you hit a creature with an attack that deals bludgeoning damage, you can move it 5 feet to an unoccupied space, provided the target is no more than one size larger than you.\n \u2022 When you score a critical hit that deals bludgeoning damage to a creature, attack rolls against that creature are made with advantage until the start of your next turn.",
	description : "Once per turn, when I hit a creature no more than one size larger than me with an attack that deals bludgeoning damage, I can move it 5 ft to an unoccupied space. If I score a critical hit that deals bludgeoning damage, attacks against the creature hit gain advantage until the start of my next turn. [+1 " + (typePF ? "Str or Con" : "Strength or Constitution") + "]",
	scorestxt : "+1 Strength or Constitution"
};
FeatsList["eldritch adept"] = {
	name : "Eldritch Adept",
	source : [["T", 79], ["UA:F2", 1]],
	descriptionFull : "Studying occult lore, you have unlocked eldritch power within yourself: you learn one Eldritch Invocation option of your choice from the warlock class. If the invocation has a prerequisite of any kind, you can choose that invocation only if you're a warlock who meets the prerequisite.\n   Whenever you gain a level, you can replace the invocation with another one from the warlock class.",
	description : 'I learn one Eldritch Invocation from the warlock class for which I meet the prerequisites (2nd page "Choose Feature" button). I can replace this invocation for another whenever I gain a level.',
	bonusClassExtrachoices : [{
		"class" : "warlock",
		feature : "eldritch invocations",
		bonus : 1
	}],
	prerequisite : "Spellcasting or Pact Magic feature",
	prereqeval : function (v) { return v.isSpellcastingClass; }
};
FeatsList["fey touched"] = {
	name : "Fey Touched",
	source : [["T", 79], ["UA:F2", 2]],
	descriptionFull : "Your exposure to the Feywild's magic has changed you, granting you the following benefits:\n \u2022 Increase your Intelligence, Wisdom, or Charisma score by 1, to a maximum of 20.\n \u2022 You learn the misty step spell and one 1st-level spell of your choice. The 1st-level spell must be from the divination or enchantment school of magic. You can cast each of these spells without expending a spell slot. Once you cast either of these spells in this way, you can't cast that spell in this way again until you finish a long rest. You can also cast these spells using spell slots you have of the appropriate level. The spells' spellcasting ability is the ability increased by this feat.",
	description : "I learn Misty Step and one 1st level divination or enchantment spell. I can cast each once per long rest at their lowest level without expending a spell slot, and can cast them if I have a spell slot to do so. My spellcasting ability is the ability I choose to increase when I gain this feat. [+1 Intelligence, Wisdom, or Charisma]",
	spellcastingBonus : [{
		name : "Misty Step",
		spells : ["misty step"],
		selection : ["misty step"],
		firstCol : "oncelr"
	}, {
		name : "1st-level Ench/Div spell",
		'class': "any",
		school : ["Ench", "Div"],
		level : [1, 1],
		firstCol : "oncelr"
	}],
	spellcastingAbility : 4,
	allowUpCasting : true,
	choices : ["Intelligence", "Wisdom", "Charisma"],
	"intelligence" : {
		description : "I learn Misty Step and one 1st level divination or enchantment spell. I can cast each once per long rest at their lowest level without expending a spell slot, and can cast them " + (typePF ? "by expending" : "with") + " a spell slot as normal. Intelligence is my spellcasting ability for these spells. [+1 Intelligence]",
		spellcastingAbility : 4,
		scores : [0, 0, 0, 1, 0, 0]
	},
	"wisdom" : {
		description : "I learn Misty Step and one 1st level divination or enchantment spell. I can cast each once per long rest at their lowest level without expending a spell slot, and can cast them by expending a spell slot as normal. Wisdom is my spellcasting ability for these spells. [+1 Wisdom]",
		spellcastingAbility : 5,
		scores : [0, 0, 0, 0, 1, 0]
	},
	"charisma" : {
		description : "I learn Misty Step and one 1st level divination or enchantment spell. I can cast each once per long rest at their lowest level without expending a spell slot, and can cast them by expending a spell slot as normal. Charisma is my spellcasting ability for these spells. [+1 Charisma]",
		spellcastingAbility : 6,
		scores : [0, 0, 0, 0, 0, 1]
	}
};
// Add the fighting initiate only when all other code has run, so that we get fighting styles added by the code
RunFunctionAtEnd(function() {
	if (!ClassList.fighter || !ClassList.fighter.features["fighting style"]) return;
	var FtngStyles = ClassList.fighter.features["fighting style"];
	FeatsList["fighting initiate"] = {
		name : "Fighting Initiate",
		source : [["T", 80], ["UA:F2", 2]],
		descriptionFull : "Your martial training has helped you develop a particular style of fighting. As a result, you learn one Fighting Style option of your choice from the fighter class. If you already have a style, the one you choose must be different.\n   Whenever you reach a level that grants the Ability Score Improvement feature, you can replace this feat's fighting style with another one from the fighter class that you don't have.",
		description : "I learn one Fighting Style from the fighter class, which must be one that I don't yet know. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
		prerequisite : "Proficiency with a martial weapon",
		prereqeval : function(v) {
			return v.martialWeaponsProf || v.otherWeaponsProf.some(function (n) {
				return WeaponsList[n] && (/Martial/i).test(WeaponsList[n].type);
			});
		},
		choices : [],
		"archery" : {
			description : "I gain a +2 bonus to attack rolls I make with ranged weapons. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : FtngStyles.source
		},
		"defense" : {
			description : "I gain a +1 bonus to my AC while I'm wearing armor. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : FtngStyles.source
		},
		"dueling" : {
			description : "When I wield a melee weapon in one hand and no other weapons, I gain a +2 bonus to damage rolls with that weapon. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : FtngStyles.source
		},
		"great weapon fighting" : {
			description : "When I roll a 1 or 2 on a damage die for an attack I make with a two-handed or versatile melee weapon that I'm wielding with two hands, I can reroll the die and must use the new roll, even if the new roll is a 1 or a 2. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : FtngStyles.source
		},
		"protection" : {
			description : "When a creature I can see attacks a target other than me that is within 5 ft of me, I can use my reaction to impose disadvantage on the attack roll. I must be wielding a shield to do this. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : FtngStyles.source
		},
		"two-weapon fighting" : {
			description : "When I engage in two-weapon fighting, I can add my ability modifier to the damage of the second (off-hand) attack. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : FtngStyles.source
		},
		"blind fighting" : {
			description : "I have blindsight with a range of 10 ft, wherein I can effectively see anything that isn't behind total cover, including invisible things, even if I'm blinded or in darkness. This doesn't allow me to see things hidden from me. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : [["T", 41]]
		},
		"interception" : {
			description : "As a reaction when a creature I can see hits a target, other than me, within 5 ft of me with an attack, I can reduce the damage the target takes by 1d10 + my proficiency bonus (min 0 damage). I must be wielding a shield or a simple or martial weapon to do this. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : [["T", 41], ["UA:CFV", 12]]
		},
		"thrown weapon fighting" : {
			description : "I can draw a weapon that has the thrown property as part of the attack I make with the weapon. In addition, when I hit with a ranged attack using a thrown weapon, I gain a +2 bonus to the damage roll. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : [["T", 42]]
		},
		"unarmed fighting" : {
			description : "My unarmed strikes deal 1d6 damage, or 1d8 if I'm not wielding any weapons or a shield. At the start of each of my turns, I can deal 1d4 bludgeoning damage to one creature grappled by me. I can replace this fighting style for another whenever I gain an Ability Score Improvement.",
			source : [["T", 42]]
		}
	};
	FtngStyles.choices.forEach(function (sName) {
		var sNameLC = sName.toLowerCase();
		if (!FtngStyles[sNameLC]) return;
		FeatsList["fighting initiate"].choices.push(sName);
		if (!FeatsList["fighting initiate"][sNameLC]) {
			FeatsList["fighting initiate"][sNameLC] = {
				description : FtngStyles[sNameLC].description.replace(/^\n   /i, '').replace(/\n   /g, '. ') + ". I can replace this fighting style whenever I gain an ASI.",
				source : FtngStyles[sNameLC].source ? FtngStyles[sNameLC].source : FtngStyles.source
			}
		}
		// Copy all attributes except name, source and description
		for (var attr in FtngStyles[sNameLC]) {
			if ((/\b(name|description|source)\b/i).test(attr)) continue;
			FeatsList["fighting initiate"][sNameLC][attr] = FtngStyles[sNameLC][attr];
		}
		if (!FeatsList["fighting initiate"][sNameLC].prereqeval) {
			FeatsList["fighting initiate"][sNameLC].prereqeval = function(v) {
				var knownStyles = GetFightingStyleSelection();
				return knownStyles[v.choice] ? false : true;
			};
			if (!FeatsList["fighting initiate"][sNameLC].prerequisite) FeatsList["fighting initiate"][sNameLC].prerequisite = sName + " Fighting Style is not selected anywhere else."
		};
	});
});
FeatsList["gunner"] = {
	name : "Gunner",
	source : [["T", 80], ["UA:F2", 2]],
	descriptionFull : "You have a quick hand and keen eye when employing firearms, granting you the following benefits:\n \u2022 Increase your Dexterity score by 1, to a maximum of 20.\n \u2022 You gain proficiency with firearms (see \"Firearms\" in the Dungeon Master's Guide).\n \u2022 You ignore the loading property of firearms.\n \u2022 Being within 5 feet of a hostile creature doesn't impose disadvantage on your ranged attack rolls.",
	description : "I gain proficiency with firearms. I ignore the loading property of firearms. I don't suffer disadvantage on ranged attack rolls for being within 5 ft of a hostile creature. [+1 Dexterity]",
	scores : [0, 1, 0, 0, 0, 0],
	weaponProfs : [false, false, ["Firearms"]],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if ((/firearm/i).test(v.theWea.type) || (/firearm/i).test(v.theWea.list)) {
					fields.Description = fields.Description.replace(/([;,]? ?loading|loading[;,]? ?)/i, '');
				};
			},
			"I ignore the loading quality of firearms."
		]
	}
};
FeatsList["metamagic adept"] = {
	name : "Metamagic Adept",
	source : [["T", 80], ["UA:F2", 2]],
	descriptionFull : "You've learned how to exert your will on your spells to alter how they function:\n \u2022 You learn two Metamagic options of your choice from the sorcerer class. You can use only one Metamagic option on a spell when you cast it, unless the option says otherwise. Whenever you reach a level that grants the Ability Score Improvement feature, you can replace one of these Metamagic options with another one from the sorcerer class.\n \u2022 You gain 2 sorcery points to spend on Metamagic (these points are added to any sorcery points you have from another source but can be used only on Metamagic). You regain all spent sorcery points when you finish a long rest.",
	description : 'I learn two Metamagic options from the sorcerer class (2nd page "Choose Feature" button). I can use only one option on a spell unless it says otherwise. I gain 2 sorcery points, which I can only use for Metamagic. I regain all expended sorcery points when I finish a long rest. I can change one ' + (typePF ? '' : 'Metamagic option ') + 'whenever I gain an ' + (typePF ? 'ASI' : 'Ability Score Improvement') + '.',
	bonusClassExtrachoices : [{
		"class" : "sorcerer",
		feature : "metamagic",
		bonus : 2
	}],
	extraLimitedFeatures : [{
		name : "Sorcery Points",
		usages : 2,
		recovery : "long rest",
		addToExisting : true
	}],
	prerequisite : "Spellcasting or Pact Magic feature",
	prereqeval : function (v) { return v.isSpellcastingClass; }
};
FeatsList["piercer"] = {
	name : "Piercer",
	source : [["T", 80], ["UA:F2", 2]],
	descriptionFull : "You have achieved a penetrating precision in combat, granting you the following benefits:\n \u2022 Increase your Strength or Dexterity by 1, to a maximum of 20.\n \u2022 Once per turn, when you hit a creature with an attack that deals piercing damage, you can reroll one of the attack's damage dice, and you must use the new roll.\n \u2022 When you score a critical hit that deals piercing damage to a creature, you can roll one additional damage die when determining the extra piercing damage the target takes.",
	description : "Once per turn when I deal piercing damage to a target, I can reroll one of the damage die and use the new roll. If I deal piercing damage on a critical hit to a target, I can roll one additional damage die. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if ((/pierc(\.|ing)/i).test(fields.Damage_Type)) {
					var extraCritRegex = /\d+(d\d+ extra on a crit(ical)?( hit)?( in melee)?)/i;
					v.extraCritM = (v.extraCritM ? v.extraCritM : 0) + 1;
					if (extraCritRegex.test(fields.Description)) {
						fields.Description = fields.Description.replace(extraCritRegex, v.extraCritM + '$1');
					} else if ((/d\d/).test(fields.Damage_Die)) {
						fields.Description += (fields.Description ? '; ' : '') + v.extraCritM + fields.Damage_Die.replace(/.*(d\d+).*/, '$1') + ' extra on a crit';
					}
					if (!(/re-?roll (one|1)? ?damage/i).test(fields.Description)) {
						fields.Description += '; Once per turn, re-roll one damage die';
					}
				}
			},
			"Once per turn when I deal piercing damage to a target, I can reroll one of the damage die and use the new roll. If I deal piercing damage on a critical hit to a target, I can roll one additional damage die.",
			900
		]
	}
};
FeatsList["poisoner"] = {
	name : "Poisoner",
	source : [["T", 80], ["UA:F2", 2]],
	descriptionFull : "You can prepare and deliver deadly poisons, granting you the following benefits:\n \u2022 When you make a damage roll that deals poison damage, it ignores resistance to poison damage.\n \u2022 You can apply poison to a weapon or piece of ammunition as a bonus action, instead of an action.\n \u2022 You gain proficiency with the poisoner's kit if you don't already have it. With one hour of work using a poisoner's kit and expending 50 gp worth of materials, you can create a number of doses of potent poison equal to your proficiency bonus. Once applied to a weapon or piece of ammunition, the poison retains its potency for 1 minute or until you hit with the weapon or ammunition. When a creature takes damage from the coated weapon or ammunition, that creature must succeed on a DC 14 Constitution saving throw or take 2d8 poison damage and become poisoned until the end of your next turn.",
	description : "My poison damage rolls ignore poison resistance. As a bonus action, I can apply poison to a weapon or piece of ammo. I can use a poisoner's kit and 50 gp to create my Prof Bonus doses of poison in 1 hour. Potent 1 min after applying. DC 14 Con save or 2d8 poison damage and poisoned until the end of my next turn.",
	toolProfs : ["Poisoner's kit"],
	action : [["bonus action", "Apply poison to weapon/ammo"]]
};
FeatsList["shadow touched"] = {
	name : "Shadow Touched",
	source : [["T", 80]],
	descriptionFull : "Your exposure to the Shadowfell's magic has changed you, granting you the following benefits:\n \u2022 Increase your Intelligence, Wisdom, or Charisma by 1, to a maximum of 20.\n \u2022 You learn the invisibility spell and one 1st-level spell of your choice. The 1st-level spell must be from the illusion or necromancy school of magic. You learn the invisibility spell and one 1st-level spell of your choice. The 1st-level spell must be from the illusion or necromancy school of magic. You can cast each of these spells without expending a spell slot. Once you cast either of these spells in this way, you can't cast that spell in this way again until you finish a long rest. You can also cast these spells using spell slots you have of the appropriate level. The spells' spellcasting ability is the ability increased by this feat.",
	description : "I learn Invisibility and one 1st level illusion or necromancy spell. I can cast each once per long rest at their lowest level without expending a spell slot, and can cast them if I have a spell slot to do so. My spellcasting ability is the ability I choose to increase when I gain this feat. [+1 Intelligence, Wisdom, or Charisma]",
	spellcastingBonus : [{
		name : "Invisibility",
		spells : ["invisibility"],
		selection : ["invisibility"],
		firstCol : "oncelr"
	}, {
		name : "1st-level Illus/Necro spell",
		'class' : "any",
		school : ["Illus", "Necro"],
		level : [1, 1],
		firstCol : "oncelr"
	}],
	spellcastingAbility : 4,
	allowUpCasting : true,
	choices : ["Intelligence", "Wisdom", "Charisma"],
	"intelligence" : {
		description : "I learn Invisibility and one 1st level illusion or necromancy spell. I can cast each once per long rest at their lowest level without expending a spell slot, and can cast them by expending a spell slot as normal. Intelligence is my spellcasting ability for these spells. [+1 Intelligence]",
		spellcastingAbility : 4,
		scores : [0, 0, 0, 1, 0, 0]
	},
	"wisdom" : {
		description : "I learn Invisibility and one 1st level illusion or necromancy spell. I can cast each once per long rest at their lowest level without expending a spell slot, and can cast them by expending a spell slot as normal. Wisdom is my spellcasting ability for these spells. [+1 Wisdom]",
		spellcastingAbility : 5,
		scores : [0, 0, 0, 0, 1, 0]
	},
	"charisma" : {
		description : "I learn Invisibility and one 1st level illusion or necromancy spell. I can cast each once per long rest at their lowest level without expending a spell slot, and can cast them by expending a spell slot as normal. Charisma is my spellcasting ability for these spells. [+1 Charisma]",
		spellcastingAbility : 6,
		scores : [0, 0, 0, 0, 0, 1]
	}
};
FeatsList["skill expert"] = {
	name : "Skill Expert",
	source : [["T", 80]],
	descriptionFull : "You have honed your proficiency with particular skills, granting you the following benefits:\n \u2022 Increase one ability score of your choice by 1, to a maximum of 20.\n \u2022 You gain proficiency in one skill of your choice.\n \u2022 Choose one skill in which you have proficiency. You gain expertise with that skill, which means your proficiency bonus is doubled for any ability check you make with it. The skill you choose must be one that isn't already benefiting from a feature, such as Expertise, that doubles your proficiency bonus.",
	description : "I gain proficiency in one skill and expertise in that same skill or another skill I'm proficient with. [+1 to one ability score of my choice]",
	skillstxt : "Proficiency with one skill, and\n   Expertise with one skill I'm proficient with",
	scorestxt : "+1 to one ability score of my choice"
};
FeatsList["slasher"] = {
	name : "Slasher",
	source : [["T", 81], ["UA:F2", 3]],
	descriptionFull : "You've learned where to cut to have the greatest results, granting you the following benefits:\n \u2022 Increase your Strength or Dexterity by 1, to a maximum of 20.\n \u2022 Once per turn when you hit a creature with an attack that deals slashing damage, you can reduce the speed of the target by 10 feet until the start of your next turn.\n \u2022 When you score a critical hit that deals slashing damage to a creature, you grievously wound it. Until the start of your next turn, the target has disadvantage on all attack rolls.",
	description : "Once per turn when I deal slashing damage to a target, I can reduce its speed by 10 ft until the start of my next turn. When I score a critical hit that deals slashing damage to a creature, the grievous wound causes it to have disadvantage on all attack rolls until the start of my next turn. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity"
};
FeatsList["telekinetic"] = {
	name : "Telekinetic",
	source : [["T", 81]],
	descriptionFull : "You learn to move things with your mind, granting you the following benefits:\n \u2022 Increase your Intelligence, Wisdom, or Charisma by 1, to a maximum of 20.\n \u2022 You learn the mage hand cantrip. You can cast it without verbal or somatic components, and you can make the spectral hand invisible. If you already know this spell, its range increases by 30 feet when you cast it. Its spellcasting ability is the ability increased by this feat.\n \u2022 As a bonus action, you can try to telekinetically shove one creature you can see within 30 feet of you. When you do so, the target must succeed on a Strength saving throw (DC 8 + your proficiency bonus + the ability modifier of the score increased by this feat) or be moved 5 feet toward you or away from you. A creature can willingly fail this save.",
	description : "I know the Mage Hand cantrip, can cast it without components, and the spectral hand can be invisible. As a bonus action, I can shove one creature I can see within 30 ft. It must make a Str save vs. this feat's spell save DC or be moved 5 ft from or towards me. My spellcasting ability is the ability I choose to increase when I gain this feat. [+1 Int, Wis, or Cha]",
	action : [["bonus action", " Shove"]],
	spellcastingBonus : {
		name : "Mage Hand",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : "atwill"
	},
	spellcastingAbility : 4,
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (spellKey !== "mage hand") return;
				spellObj.components = "";
				if (spellObj.description === SpellsList["mage hand"].description) spellObj.description = "Create (in)visible spectral hand for simple tasks or carry up to 10 lb; 1 a to control; can't have multiple";
				var rangeRx = /(\d+)( ?ft| ?m)/i;
				if (!/^(?=.*telekinetic)(?=.*feat).*$/i.test(CurrentSpells[spName].name) && rangeRx.test(spellObj.range)) {
					// add the +30 ft rang only if not the entry for the feat itself
					var spRangeM = spellObj.range.match(rangeRx);
					spellObj.range = spellObj.range.replace(rangeRx, Number(spRangeM[1]) + (What("Unit System") === "metric" ? 9 : 30) + spRangeM[2]);
				}
				return true;
			},
			"My Telekinetic feat allows me to cast the Mage Hand cantrip without verbal or somatic components and I can make the spectral hand invisible. If I already know the cantrip from another source, its range is also increased with 30 ft."
		]
	},
	choices : ["Intelligence", "Wisdom", "Charisma"],
	"intelligence" : {
		description : "I know the Mage Hand cantrip, can cast it without components, and the spectral hand can be invisible. As a bonus action, I can shove one creature I can see within 30 ft. It must make a Str" + (typePF ? "" : "ength") + " save vs. this feat's spell save DC or be moved 5 ft" + (typePF ? "" : " away") + " from or towards me. Intelligence is my spellcasting ability for these. [+1 Intelligence]",
		spellcastingAbility : 4,
		scores : [0, 0, 0, 1, 0, 0]
	},
	"wisdom" : {
		description : "I know the Mage Hand cantrip, can cast it without components, and the spectral hand can be invisible. As a bonus action, I can shove one creature I can see within 30 ft. It must make a Str" + (typePF ? "" : "ength") + " save vs. this feat's spell save DC or be moved 5 ft" + (typePF ? "" : " away") + " from or towards me. Wisdom is my spellcasting ability for these. [+1 Wisdom]",
		spellcastingAbility : 5,
		scores : [0, 0, 0, 0, 1, 0]
	},
	"charisma" : {
		description : "I know the Mage Hand cantrip, can cast it without components, and the spectral hand can be invisible. As a bonus action, I can shove one creature I can see within 30 ft. It must make a Str" + (typePF ? "" : "ength") + " save vs. this feat's spell save DC or be moved 5 ft" + (typePF ? "" : " away") + " from or towards me. Charisma is my spellcasting ability for these. [+1 Charisma]",
		spellcastingAbility : 6,
		scores : [0, 0, 0, 0, 0, 1]
	}
};
FeatsList["telepathic"] = {
	name : "Telepathic",
	source : [["T", 81]],
	descriptionFull : "You awaken the ability to mentally connect with others, granting you the following benefits:\n \u2022 Increase your Intelligence, Wisdom, or Charisma by 1, to a maximum of 20.\n \u2022 You can speak telepathically to any creature you can see within 60 feet of you. Your telepathic utterances are in a language you know, and the creature understands you only if it knows that language. Your communication doesn't give the creature the ability to respond to you telepathically.\n \u2022 You can cast the detect thoughts spell, requiring no spell slot or components, and you must finish a long rest before you can cast it this way again. Your spellcasting ability for the spell is the ability increased by this feat. If you have spell slots of 2nd level or higher, you can cast this spell with them.",
	description : "I can telepathically speak to a creature I can see within 60 ft in a language I know, but it can't respond telepathically. I can cast Detect Thoughts once per long rest at its lowest level, requiring no spell slot or components, and can cast it using a spell slot as normal. My spellcasting ability is the ability I increase with this feat. [+1 Int, Wis, or Cha]",
	spellcastingBonus : {
		name : "Detect Thoughts",
		spells : ["detect thoughts"],
		selection : ["detect thoughts"],
		firstCol : "oncelr"
	},
	spellcastingAbility : 4,
	allowUpCasting : true,
	spellChanges : {
		"detect thoughts" : {
			components : "(V,S,M)",
			changes : "My Telepathic feat allows me to cast Detect Thoughts once per long rest without requiring a spell slot or spell components, or by using a spell slot and cast it with components as normal."
		}
	},
	choices : ["Intelligence", "Wisdom", "Charisma"],
	"intelligence" : {
		description : "I can telepathically speak to a creature I can see within 60 ft in a language I know, but it can't respond telepathically. I can cast Detect Thoughts once per long rest at its lowest level, requiring no spell slot or components, and can cast it using a spell slot as normal. Intelligence is my spellcasting ability for this. [+1 Int" + (typePF ? "" : "elligence") + "]",
		spellcastingAbility : 4,
		scores : [0, 0, 0, 1, 0, 0]
	},
	"wisdom" : {
		description : "I can telepathically speak to a creature I can see within 60 ft in a language I know, but it can't respond telepathically. I can cast Detect Thoughts once per long rest at its lowest level, requiring no spell slot or components, and can cast it using a spell slot as normal. Wisdom is my spellcasting ability for this. [+1 Wis" + (typePF ? "" : "dom") + "]",
		spellcastingAbility : 5,
		scores : [0, 0, 0, 0, 1, 0]
	},
	"charisma" : {
		description : "I can telepathically speak to a creature I can see within 60 ft in a language I know, but it can't respond telepathically. I can cast Detect Thoughts once per long rest at its lowest level, requiring no spell slot or components, and can cast it using a spell slot as normal. Charisma is my spellcasting ability for this. [+1 Cha" + (typePF ? "" : "risma") + "]",
		spellcastingAbility : 6,
		scores : [0, 0, 0, 0, 0, 1]
	}
};


// >>>>>>>>>>>>>>>>>> //
// >>> New Spells >>> //
// >>>>>>>>>>>>>>>>>> //
SpellsList["dream of the blue veil"] = {
	name : "Dream of the Blue Veil",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["T", 106]],
	level : 7,
	school : "Conj",
	time : "10 min",
	range : "20 ft",
	components : "V,S,M\u0192",
	compMaterial : "A magic item or a willing creature from the destination world",
	duration : "6 hours",
	description : "9 willing crea unconscious for duration, after that travel to origin material plane of magic item or crea",
	descriptionFull : "You and up to eight willing creatures within range fall unconscious for the spell's duration and experience visions of another world on the Material Plane, such as Oerth, Toril, Krynn, or Eberron. If the spell reaches its full duration, the visions conclude with each of you encountering and pulling back a mysterious blue curtain. The spell then ends with you mentally and physically transported to the world that was in the visions." +
	"\n   To cast this spell, you must have a magic item that originated on the world you wish to reach, and you must be aware of the world's existence, even if you don't know the world's name. Your destination in the other world is a safe location within 1 mile of where the magic item was created. Alternatively, you can cast the spell if one of the affected creatures was born on the other world, which causes your destination to be a safe location within 1 mile of where that creature was born." +
	"\n   The spell ends early on a creature if that creature takes any damage, and the creature isn't transported. If you take any damage, the spell ends for you and all the other creatures, with none of you being transported."
};
SpellsList["intellect fortress"] = {
	name : "Intellect Fortress",
	classes : ["artificer", "bard", "sorcerer", "warlock", "wizard"],
	source : [["T", 107]],
	level : 3,
	school : "Abjur",
	time : "1 a",
	range : "30 ft",
	components : "V",
	duration : "Conc, 1 h",
	description : "1+1/SL crea, each max 30 ft apart, has Psychic damage resistance and adv. on Int, Wis, and Cha saves",
	descriptionFull : "For the duration, you or one willing creature you can see within range has resistance to psychic damage, as well as advantage on Intelligence, Wisdom, and Charisma saving throws." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, you can target one additional creature for each slot level above 3rd. The creatures must be within 30 feet of each other when you target them."
};
SpellsList["mind sliver"] = {
	name : "Mind Sliver",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["T", 108], ["UA:SnW", 4], ["UA:FRnW", 7], ["UA:POR", 7]],
	level : 0,
	school : "Ench",
	time : "1 a",
	range : "60 ft",
	components : "V",
	duration : "1 rnd",
	save : "Int",
	description : "1 crea save or 1d6 Psychic dmg, -1d4 on first save before my next turn ends; +1d6 at CL 5, 11, and 17",
	description : "1 crea save or 1d6 Psychic dmg, -1d4 on 1st save before my next turn end; +1d6 at CL 5/11/17",
	descriptionCantripDie : "1 crea save or `CD`d6 Psychic dmg and subtract 1d4 from first saving throw before my next turn ends",
	descriptionFull : "You drive a disorienting spike of psychic energy into the mind of one creature you can see within range. The target must succeed on an Intelligence saving throw or take 1d6 psychic damage and subtract 1d4 from the next saving throw it makes before the end of your next turn." +
	"\n   This spell's damage increases by 1d6 when you reach certain levels: 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
WeaponsList["mind sliver"] = {
	regExpSearch : /^(?=.*mind)(?=.*sliver).*$/i,
	name : "Mind Sliver",
	source : [["T", 108], ["UA:SnW", 4], ["UA:FRnW", 7], ["UA:POR", 7]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "psychic"],
	range : "60 ft",
	description : "1 creature Int save, success - no damage, fail - also -1d4 on first save before my next turn ends",
	abilitytodamage : false,
	dc : true
};
SpellsList["spirit shroud"] = {
	name : "Spirit Shroud",
	classes : ["cleric", "paladin", "warlock", "wizard"],
	source : [["T", 108]],
	level : 3,
	school : "Necro",
	time : "1 bns",
	range : "S:10-ft rad",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "My atks +1d8+1d8/2SL Cold/Necro/Radiant dmg, no heal until next turn; any crea I see -10 ft spd",
	descriptionShorter : "My atks +1d8+1d8/2SL Cold/Necro/Radiant dmg, no heal 1 rnd; any crea -10 ft spd",
	descriptionFull : "You call forth spirits of the dead, which flit around you for the spell's duration. The spirits are intangible and invulnerable."+
	"\n   Until the spell ends, any attack you make deals 1d8 extra damage when you hit a creature within 10 feet of you. This damage is radiant, necrotic, or cold (your choice when you cast the spell). Any creature that takes this damage can't regain hit points until the start of your next turn."+
	"\n   In addition, any creature of your choice that you can see that starts its turn within 10 feet of you has its speed reduced by 10 feet until the start of your next turn."+
	AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d8 for every two slot levels above 3rd.",
	dynamicDamageBonus : {
		multipleDmgTypes : {
			dmgTypes : ["cold", "necrotic", "radiant"],
			inDescriptionAs : "Cold/Necro/Radiant"
		}
	}
};
SpellsList["summon aberration"] = {
	name : "Summon Aberration",
	classes : ["warlock", "wizard"],
	source : [["T", 109]],
	level : 4,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A pickled tentacle and an eyeball in a platinum-inlaid vial worth at least 400 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Abberant Spirit; obeys commands; takes turn after mine; vanishes at 0 hp (300gp)",
	descriptionFull : "You call forth an aberrant spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Aberrant Spirit stat block. When you cast the spell, choose Beholderkin, Slaad, or Star Spawn. The creature resembles an aberration of that kind, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["summon beast"] = {
	name : "Summon Beast",
	classes : ["druid", "ranger"],
	source : [["T", 109]],
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A feather, tuft of fur, and fish tail inside a gilded acorn worth at least 200 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Bestial Spirit; obeys commands; takes turn after mine; disappears at 0 hp (200gp)",
	descriptionFull : "You call forth a bestial spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Bestial Spirit stat block. When you cast the spell, choose an environment: Air, Land, or Water. The creature resembles an animal of your choice that is native to the chosen environment, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["summon celestial"] = {
	name : "Summon Celestial",
	classes : ["cleric", "paladin"],
	source : [["T", 110]],
	level : 5,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A golden reliquary worth at least 500 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Celestial Spirit; obeys commands; takes turn after mine; disappears at 0 hp (500gp)",
	descriptionFull : "You call forth a celestial spirit. It manifests in an angelic form in an unoccupied space that you can see within range. This corporeal form uses the Celestial Spirit stat block. When you cast the spell, choose Avenger or Defender. Your choice determines the creature's attack in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["summon construct"] = {
	name : "Summon Construct",
	classes : ["artificer", "wizard"],
	source : [["T", 111]],
	level : 4,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "An ornate stone and metal lockbox worth at least 400 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Construct Spirit; obeys commands; takes turn after mine; vanishes at 0 hp (400gp)",
	descriptionFull : "You call forth the spirit of a construct. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Construct Spirit stat block. When you cast the spell, choose a material: Clay, Metal, or Stone. The creature resembles a golem or a modron (your choice) made of the chosen material, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["summon elemental"] = {
	name : "Summon Elemental",
	classes : ["druid", "ranger", "wizard"],
	source : [["T", 111]],
	level : 4,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "Air, a pebble, ash, and water inside a gold-inlaid vial worth at least 400 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Elemental Spirit; obeys commands; takes turn after mine; vanishes at 0 hp (400gp)",
	descriptionFull : "You call forth an elemental spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Elemental Spirit stat block. When you cast the spell, choose an element: Air, Earth, Fire, or Water. The creature resembles a bipedal form wreathed in the chosen element, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["summon fey"] = {
	name : "Summon Fey",
	classes : ["druid", "ranger", "warlock", "wizard"],
	source : [["T", 112]],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A gilded flower worth at least 300 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Fey Spirit; obeys commands; takes turn after mine; disappears at 0 hp (300gp)",
	descriptionFull : "You call forth a fey spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Fey Spirit stat block. When you cast the spell, choose a mood: Fuming, Mirthful, or Tricksy. The creature resembles a fey creature of your choice marked by the chosen mood, which determines one of the traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["summon fiend"] = {
	name : "Summon Fiend",
	classes : ["warlock", "wizard"],
	source : [["T", 112]],
	level : 6,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "Humanoid blood inside a ruby vial worth at least 600 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Fiendish Spirit; obeys commands; takes turn after mine; disappears at 0 hp (500gp)",
	descriptionFull : "You call forth a fiendish spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Fiendish Spirit stat block. When you cast the spell, choose Demon, Devil, or Yugoloth. The creature resembles a fiend of the chosen type, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["summon shadowspawn"] = {
	name : "Summon Shadowspawn",
	classes : ["warlock", "wizard"],
	source : [["T", 113]],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "Tears inside a gem worth at least 300 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Shadow Spirit; obeys commands; takes turn after mine; disappears at 0 hp (300gp)",
	descriptionFull : "You call forth a shadowy spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Shadow Spirit stat block. When you cast the spell, choose an emotion: Fury, Despair, or Fear. The creature resembles a misshapen biped marked by the chosen emotion, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["summon undead"] = {
	name : "Summon Undead",
	classes : ["warlock", "wizard"],
	source : [["T", 114]],
	level : 3,
	school : "Necro",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A gilded skull worth at least 300 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Undead Spirit; obeys commands; takes turn after mine; disappears at 0 hp (300gp)",
	descriptionFull : "You call forth an undead spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Undead Spirit stat block. When you cast the spell, choose the creature's form: Ghostly, Putrid, or Skeletal. The spirit resembles an undead creature with the chosen form, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends.\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell's level appears in the stat block."
};
SpellsList["tasha's caustic brew"] = {
	name : "Tasha's Caustic Brew",
	nameAlt : "Caustic Brew",
	classes : ["artificer", "sorcerer", "wizard"],
	source : [["T", 115]],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "S:30-ft line",
	components : "V,S,M",
	compMaterial : "A bit of rotten food",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "30-ft long 5-ft wide all save or 2d4+2d4/SL Acid dmg at start of turn; action to clean self or adjacent",
	descriptionShorter : "30-ft long 5-ft wide all save or 2d4+2d4/SL Acid dmg at turn start; 1 a clean self/adjacent",
	descriptionFull : "A stream of acid emanates from you in a line 30 feet long and 5 feet wide in a direction you choose. Each creature in the line must succeed on a Dexterity saving throw or be covered in acid for the spell's duration or until a creature uses its action to scrape or wash the acid off itself or another creature. A creature covered in the acid takes 2d4 acid damage at start of each of its turns." +
	AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 2d4 for each slot level above 1st."
};
SpellsList["tasha's mind whip"] = {
	name : "Tasha's Mind Whip",
	nameAlt : "Mind Whip",
	regExpSearch : /^(?=.*mind)(?=.*(whip|thrust)).*$/i, // "Mind Thrust" in UA:POR
	classes : ["sorcerer", "wizard"],
	source : [["T", 115], ["UA:POR", 8]],
	level : 2,
	school : "Ench",
	time : "1 a",
	range : "90 ft",
	components : "V",
	duration : "1 rnd",
	save : "Int",
	description : "1+1/SL crea, max 30 ft apart; 3d6 Psychic dmg; no rea; only move, act, or bns; save half, no act limit",
	descriptionShorter : "1+1/SL crea, max 30 ft apart; 3d6 Psychic dmg; no rea; move, act, or bns; save half, no act limit",
	descriptionFull : "You psychically lash out at one creature you can see within range. The target must make an Intelligence saving throw. On a failed save, the target takes 3d6 psychic damage, and it can't take a reaction until the end of its next turn. Moreover, on its next turn, it must choose whether it gets a move, an action, or a bonus action; it gets only one of the three. On a successful save, the target takes half as much damage and suffers none of the spell's other effects." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, you can target one additional creature for each slot level above 2nd. The creatures must be within 30 feet of each other when you target them."
};
SpellsList["tasha's otherworldly guise"] = {
	name : "Tasha's Otherworldly Guise",
	nameShort : "T's Otherworldly Guise",
	nameAlt : "Otherworldly Guise",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["T", 116]],
	level : 6,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "V,S,M\u0192",
	compMaterial : "An object engraved with a symbol of the Outer Planes, worth at least 500 gp",
	duration : "Conc, 1 min",
	description : "Fire/Poison or Radiant/Necrotic/Charm immune; 40 ft fly; +2 AC; 2 atks; spellcast. abi atks (500gp)",
	descriptionFull : "Uttering an incantation, you draw on the magic of the Lower Planes or Upper Planes (your choice) to transform yourself. You gain the following benefits until the spell ends:" +
	"\n \u2022 You are immune to fire and poison damage (Lower Planes) or radiant and necrotic damage (Upper Planes)." +
	"\n \u2022 You are immune to the poisoned condition (Lower Planes) or the charmed condition (Upper Planes)." +
	"\n \u2022 Spectral wings appear on your back, giving you a flying speed of 40 feet." +
	"\n \u2022 You have a +2 bonus to AC." +
	"\n \u2022 All your weapon attacks are magical, and when you make a weapon attack, you can use your spellcasting ability modifier, instead of Strength or Dexterity, for the attack and damage rolls." +
	"\n \u2022 You can attack twice, instead of once, when you take the Attack action on your turn. You ignore this benefit if you already have a feature, like Extra Attack, that lets you attack more than once when you take the Attack action on your turn."
};


// >>>>>>>>>>>>>>>>>>> //
// >>> Magic Items >>> //
// >>>>>>>>>>>>>>>>>>> //
// Tattoos
var TCoE_magicTattoosDescription = desc([
	" >>Tattoo Attunement<<. To attune to this item, you hold the needle to your skin where you want the tattoo to appear, pressing the needle there throughout the attunement process. When the attunement is complete, the needle turns into the ink that becomes the tattoo, which appears on the skin.",
	" If your attunement to the tattoo ends, the tattoo vanishes, and the needle reappears in your space.",
	"\n>>Magic Tattoos<< (TCoE 118)",
	" Blending magic and artistry with ink and needles, magic tattoos imbue their bearers with wondrous abilities. Magic tattoos are initially bound to magic needles, which transfer their magic to a creature.",
	" Once inscribed on a creature's body, damage or injury doesn't impair the tattoo's function, even if the tattoo is defaced. When applying a magic tattoo, a creature can customize the tattoo's appearance. A magic tattoo can look like a brand, scarification, a birthmark, patterns of scale, or any other cosmetic alteration.",
	" The rarer a magic tattoo is, the more space it typically occupies on a creature's skin. The table below offers guidelines for how large a given tattoo is.",
	"\n>>Tattoo Rarity\tArea Covered<<",
	"Common     \tOne hand or foot or a quarter of a limb",
	"Uncommon   \tHalf a limb or the scalp",
	"Rare\t\tOne limb",
	"Very Rare  \tTwo limbs or the chest or upper back",
	"Legendary  \tTwo limbs and the torso"
], "\n  ");
magicTattoosTxt = { // a public variable to be used for any magical tattoo that uses these rules
	base : TCoE_magicTattoosDescription,
	unicode : TCoE_magicTattoosDescription.replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	uppercase : TCoE_magicTattoosDescription.replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/\byou\b/ig, "I"),
	plain : TCoE_magicTattoosDescription.replace(/>>(.*?)<</g, "$1").replace(/your/g, "my").replace(/\byou\b/ig, "I")
};
MagicItemsList["absorbing tattoo"] = function() {
	var oObj = {
		name : "Absorbing Tattoo",
		source : [["T", 119]],
		type : "wondrous item (tattoo)",
		rarity : "very rare",
		attunement : true,
		description : "When I attune to this magic needle, it disappears and I gain a magical tattoo of a design of my choosing. It grants me resistance to a damage type. As a reaction once per dawn when I take that type of damage, I can gain immunity against that instance of damage and recover half the damage as HP.",
		descriptionFull : "Produced by a special needle, this magic tattoo features designs that emphasize one color."+
		"\n   " + toUni("Damage Resistance") + ". While the tattoo is on your skin, you have resistance to a type of damage associated with that color, as shown on the table below. The DM chooses the color or determines it randomly."+
		toUni("\nd10\tDamage Type\tColor")+
		"\n   1\tAcid\t\tGreen"+
		"\n   2\tCold\t\tBlue"+
		"\n   3\tFire\t\tRed"+
		"\n   4\tForce\t\tWhite"+
		"\n   5\tLightning  \tYellow"+
		"\n   6\tNecrotic\t\tBlack"+
		"\n   7\tPoison\t\tViolet"+
		"\n   8\tPsychic\t\tSilver"+
		"\n   9\tRadiant\t\tGold"+
		"\n 10\tThunder\t\tOrange"+
		"\n\n   " + toUni("Damage Absorption") + ". When you take damage of the chosen type, you can use your reaction to gain immunity against that instance of the damage, and you regain a number of hit points equal to half the damage you would have taken. Once this reaction is used, it can't be used again until the next dawn." + magicTattoosTxt.unicode,
		usages : 1,
		recovery : "dawn",
		additional : "Immunity",
		choices : ["Acid (green)", "Cold (blue)", "Fire (red)", "Force (white)", "Lightning (yellow)", "Necrotic (black)", "Poison (violet)", "Psychic (silver)", "Radiant (gold)", "Thunder (orange)"]
	};
	var sDescr = "When I attune to this magic needle, it disappears and I gain a COLOR magical tattoo of a design of my choosing. It grants me resistance to TYPE damage. As a reaction once per dawn when I take TYPE damage, I can gain immunity against that instance of damage and recover half the damage as HP.";
	for (var i = 0; i < oObj.choices.length; i++) {
		var aType = oObj.choices[i].split(/ \(|\)/g);
		oObj[oObj.choices[i].toLowerCase()] = {
			name : aType[0] + " Absorbing Tattoo",
			sortname : "Absorbing Tattoo, " + aType[0],
			description : sDescr.replace(/TYPE/g, aType[0].toLowerCase()).replace(/COLOR/g, aType[1]),
			dmgres : [aType[0]],
			action : [["reaction", " (Immunity)"]]
		}
	}
	return oObj;
}();
MagicItemsList["barrier tattoo"] = {
	name : "Barrier Tattoo",
	source : [["T", 122]],
	type : "wondrous item (tattoo)",
	description : "This magic tattoo depicts protective imagery and uses ink that resembles liquid metal. While not wearing armor, this tatoo grants me an Armor Class related to the rarity of the tattoo.",
	descriptionFull : "Produced by a special needle, this magic tattoo depicts protective imagery and uses ink that resembles liquid metal."+
	"\n   " + toUni("Protection") + ". While you aren't wearing armor, the tattoo grants you an Armor Class depending on the tattoo's rarity, as shown below. You can use a shield and still gain this benefit."+
	toUni("\nTattoo Rarity\tAC")+
	"\n  Uncommon\t12 + your Dexterity modifier"+
	"\n  Rare\t\t15 + your Dexterity modifier (maximum of +2)"+
	"\n  Very Rare\t18\n"+
	magicTattoosTxt.unicode,
	attunement : true,
	choices : ["AC 12+Dex (uncommon)", "AC 15+Dex (rare)", "AC 18 (very rare)"],
	"ac 12+dex (uncommon)" : {
		name : "Barrier Tattoo (uncommon)",
		rarity : "uncommon",
		description : "When I attune to this magic needle, it disappears and I gain a magical tattoo of a design of my choosing featuring protective imagery. While I'm not wearing armor, the tattoo grants me an AC of 12 + my Dexterity modifier. I can use a shield and still gain this benefit.",
		armorOptions : [{
			regExpSearch : /^(?=.*barrier)(?=.*tattoo).*$/i,
			name : "Barrier Tattoo",
			source : [["T", 122]],
			ac : 12,
			affectsWildShape : true,
			selectNow : true
		}]
	},
	"ac 15+dex (rare)" : {
		name : "Barrier Tattoo (rare)",
		rarity : "rare",
		description : "When I attune to this magic needle, it disappears and I gain a magical tattoo of a design of my choosing featuring protective imagery. While I'm not wearing armor, the tattoo grants me an AC of 15 + my Dexterity modifier (maximum of +2). I can use a shield and still gain this benefit.",
		armorOptions : [{
			regExpSearch : /^(?=.*barrier)(?=.*tattoo).*$/i,
			name : "Barrier Tattoo",
			source : [["T", 122]],
			ac : 15,
			dex : 2,
			affectsWildShape : true,
			selectNow : true
		}]
	},
	"ac 18 (very rare)" : {
		name : "Barrier Tattoo (very rare)",
		rarity : "very rare",
		description : "When I attune to this magic needle, it disappears and I gain a magical tattoo of a design of my choosing featuring protective imagery. While I'm not wearing armor, the tattoo grants me an AC of 18. I can use a shield and still gain this benefit.",
		armorOptions : [{
			regExpSearch : /^(?=.*barrier)(?=.*tattoo).*$/i,
			name : "Barrier Tattoo",
			source : [["T", 122]],
			ac : 18,
			dex : -10,
			affectsWildShape : true,
			selectNow : true
		}]
	}
}
MagicItemsList["blood fury tattoo"] = {
	name : "Blood Fury Tattoo",
	source : [["T", 122]],
	type : "wondrous item (tattoo)",
	rarity : "legendary",
	attunement : true,
	description : "This magical tattoo has 10 charges, regaining all at dawn. As a reaction when a creature I can see damages me, I can use 1 charge to make a melee attack with advantage against it. When I hit a creature with a melee attack, I can use 1 charge to deal it 4d6 necrotic damage and regain the same amount in hit points.",
	descriptionFull : "Produced by a special needle, this magic tattoo evokes fury in its form and colors."+
	"\n   " + toUni("Bloodthirsty Strikes") + ". The tattoo has 10 charges, and it regains all expended charges daily at dawn. While this tattoo is on your skin, you gain the following benefits:"+
	"\n \u2022 When you hit a creature with a weapon attack, you can expend a charge to deal an extra 4d6 necrotic damage to the target, and you regain a number of hit points equal to the necrotic damage dealt."+
	"\n \u2022 When a creature you can see damages you, you can expend a charge and use your reaction to make a melee attack against that creature, with advantage on your attack roll." + magicTattoosTxt.unicode,
	usages : 10,
	recovery : "dawn",
	action : [["reaction", " (after taking damage)"]]
}
MagicItemsList["coiling grasp tattoo"] = {
	name : "Coiling Grasp Tattoo",
	source : [["T", 123]],
	type : "wondrous item (tattoo)",
	rarity : "uncommon",
	attunement : true,
	description : "This magical tattoo features intertwining designs. As an action, I can have a creature I can see within 15 ft make a DC 14 Str save or take 3d6 force damage and be grappled. It can use its action to try and escape (DC 14 Athletics/Acrobatics). Grapple ends if I halt it, use it again, or if the target is more than 15 ft away.",
	descriptionFull : "Produced by a special needle, this magic tattoo has long intertwining designs."+
	"\n   " + toUni("Grasping Tendrils") + ". While the tattoo is on your skin, you can, as an action, cause the tattoo to extrude into inky tendrils, which reach for a creature you can see within 15 feet of you. The creature must succeed on a DC 14 Strength saving throw or take 3d6 force damage and be grappled by you. As an action, the creature can escape the grapple by succeeding on a DC 14 Strength (Athletics) or Dexterity (Acrobatics) check. The grapple also ends if you halt it (no action required), if the creature is ever more than 15 feet away from you, or if you use this tattoo on a different creature." + magicTattoosTxt.unicode,
	action : [["action", ""]],
	weaponOptions : [{
		regExpSearch : /^(?=.*coiling grasp)(?=.*tattoo).*$/i,
		name : "Coiling Grasp Tattoo",
		source : [["T", 123]],
		ability : 0,
		type : "Magic Item",
		damage : [3, 6, "force"],
		range : "15 ft",
		description : "Str save, success - no damage, fail - grappled; Escape DC 14 Athletics/Acrobatics",
		abilitytodamage : false,
		dc : true,
		modifiers : [6, ""],
		selectNow : true
	}]
}
MagicItemsList["eldritch claw tattoo"] = {
	name : "Eldritch Claw Tattoo",
	source : [["T", 126]],
	type : "wondrous item (tattoo)",
	rarity : "uncommon",
	attunement : true,
	description : "This magical tattoo featuring clawlike forms makes my unarmed strikes magical with a +1 bonus to attack and damage. As a bonus action once per dawn, I can have it empower me for 1 minute so that all my melee attacks with weapons and unarmed strikes have 15 ft reach and deal an extra 1d6 force damage.",
	descriptionFull : "Produced by a special needle, this magic tattoo depicts clawlike forms and other jagged shapes."+
	"\n   " + toUni("Magical Strikes") + ". While the tattoo is on your skin, your unarmed strikes are considered magical for the purpose of overcoming immunity and resistance to nonmagical attacks, and you gain a +1 bonus to attack and damage rolls with unarmed strikes."+
	"\n   " + toUni("Eldritch Maul") + ". As a bonus action, you can empower the tattoo for 1 minute. For the duration, each of your melee attacks with a weapon or an unarmed strike can reach a target up to 15 feet away from you, as inky tendrils launch toward the target. In addition, your melee attacks deal an extra 1d6 force damage on a hit. Once used, this bonus action can't be used again until the next dawn." + magicTattoosTxt.unicode,
	usages : 1,
	recovery : "dawn",
	additional : "Eldritch Maul",
	action : [["bonus action", " (Eldritch Maul)"]],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if ((v.baseWeaponName === "unarmed strike" || v.isMeleeWeapon) && (/eldritch (claw|maul)/i).test(v.WeaponTextName)) {
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					if (fields.Range.toLowerCase() === 'melee') {
						fields.Range = 'Melee (15 ft reach)';
						fields.Description += (fields.Description ? '; ' : '') + '+1d6 force damage';
					} else {
						fields.Description += (fields.Description ? '; ' : '') + '15 ft reach; +1d6 force damage';
					}
				};
			},
			"If I include the words 'Eldritch Maul' or 'Eldritch Claw' in the name of a melee weapon or an unarmed strike, it gets +10 ft reach and +1d6 force damage.",
			700
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.baseWeaponName === "unarmed strike") {
					output.magic += 1;
				}
			}, ''
		]
	}
}
MagicItemsList["ghost step tattoo"] = {
	name : "Ghost Step Tattoo",
	source : [["T", 128]],
	type : "wondrous item (tattoo)",
	rarity : "very rare",
	attunement : true,
	description : "As a bonus action 3 times per day, I can become incorporeal until my next turn ends. While incorporeal, I can't be grappled or restrained, gain nonmagical bludgeoning, piercing, and slashing damage resistance, and can move through creatures or objects as difficult terrain (1d10 force damage if I end my turn in one).",
	descriptionFull : "Produced by a special needle, this tattoo shifts and wavers on the skin, parts of it appearing blurred."+
	"\n   " + toUni("Ghostly Form") + ". The tattoo has 3 charges, and it regains all expended charges daily at dawn. As a bonus action while the tattoo is on your skin, you can expend 1 of the tattoo's charges to become incorporeal until the end of your next turn. For the duration, you gain the following benefits:"+
	"\n \u2022 You have resistance to bludgeoning, piercing, and slashing damage from nonmagical attacks."+
	"\n \u2022 You can't be grappled or restrained."+
	"\n \u2022 You can move through creatures and solid objects as if they were difficult terrain. If you end your turn in a solid object, you take 1d10 force damage. If the effect ends while you are inside a solid object, you instead are shunted to the nearest unoccupied space, and you take 1d10 force damage for every 5 feet traveled." + magicTattoosTxt.unicode,
	usages : 3,
	recovery : "dawn",
	action : [["bonus action", ""]]
}
MagicItemsList["illuminator's tattoo"] = { // contains contributions by lizrdgizrd
	name : "Illuminator's Tattoo",
	source : [["T", 129]],
	type : "wondrous item (tattoo)",
	rarity : "common",
	attunement : true,
	description : "While this beautiful calligraphy tattoo is on my skin, I can write with my fingertip as if it is an ink pen that never runs out of ink. As an action, I can touch writing up to one page and speak a creature's name, making it invisible to everyone else but me and the creature for up to 24 hours or until I or the creature touch it.",
	descriptionFull : "Produced by a special needle, this magic tattoo features beautiful calligraphy, images of writing implements, and the like."+
	"\n   " + toUni("Magical Scribing") + ". While this tattoo is on your skin, you can write with your fingertip as if it were an ink pen that never runs out of ink."+
	"\n   As an action, you can touch a piece of writing up to one page in length and speak a creature's name. The writing becomes invisible to everyone other than you and the named creature for the next 24 hours. Either of you can dismiss the invisibility by touching the script (no action required). Once used, this action can't be used again until the next dawn." + magicTattoosTxt.unicode,
	usages : 1,
	recovery : "dawn",
	action : [["action", ""]]
}
MagicItemsList["lifewell tattoo"] = {
	name : "Lifewell Tattoo",
	source : [["T", 129]],
	type : "wondrous item (tattoo)",
	rarity : "very rare",
	attunement : true,
	description : "When I attune to this magic needle, it disappears and I gain a magical tattoo of a design of my choosing featuring symbols of life and rebirth. It grants me resistance to necrotic damage. The first time per dawn when I would be reduced to 0 hit points, I drop to 1 hit point instead.",
	descriptionFull : "Produced by a special needle, this magic tattoo features symbols of life and rebirth."+
	"\n   " + toUni("Necrotic Resistance") + ". You have resistance to necrotic damage."+
	"\n   " + toUni("Life Ward") + ". When you would be reduced to 0 hit points, you drop to 1 hit point instead. Once used, this property can't be used again until the next dawn." + magicTattoosTxt.unicode,
	usages : 1,
	recovery : "dawn",
	dmgres : ["Necrotic"]
}
MagicItemsList["masquerade tattoo"] = {
	name : "Masquerade Tattoo",
	source : [["T", 131]],
	type : "wondrous item (tattoo)",
	rarity : "common",
	attunement : true,
	description : "When I attune to this magic needle, it disappears and I gain a magical tattoo. As a bonus action, I can change its size, color, pattern, and location on my skin to whatever I want, but it's always obviously a tattoo. As an action once per dawn, I can use the tattoo to cast Disguise Self (DC 13 to discern the disguise).",
	descriptionFull : "Produced by a special needle, this magic tattoo appears on your body as whatever you desire."+
	"\n   " + toUni("Fluid Ink") + ". As a bonus action, you can shape the tattoo into any color or pattern and move it to any area of your skin. Whatever form it takes, it is always obviously a tattoo. It can range in size from no smaller than a copper piece to an intricate work of art that covers all your skin."+
	"\n   " + toUni("Disguise Self") + ". As an action, you can use the tattoo to cast the disguise self spell (DC 13 to discern the disguise). Once the spell is cast from the tattoo, it can't be cast from the tattoo again until the next dawn." + magicTattoosTxt.unicode,
	usages : 1,
	recovery : "dawn",
	additional : "Disguise Self",
	action : [["bonus action", " (change)"]],
	fixedDC : 13,
	spellcastingBonus : {
		name : "Disguise Self",
		spells : ["disguise self"],
		selection : ["disguise self"],
		firstCol : "oncelr"
	}
}
MagicItemsList["shadowfell brand tattoo"] = { // contains contributions by lizrdgizrd
	name : "Shadowfell Brand Tattoo",
	source : [["T", 134]],
	type : "wondrous item (tattoo)",
	rarity : "rare",
	attunement : true,
	description : "When I attune to this magic needle, it disappears and I gain a dark, abstract magical tattoo. It gives me darkvision with a range of 60 ft and advantage on Dexterity (Stealth) checks. As a reaction once per sunset when I take damage, I can become insubstantial for a moment, halving the damage I take.",
	descriptionFull : "Produced by a special needle, this magic tattoo is dark in color and abstract."+
	"\n   " + toUni("Shadow Essence") + ". You gain darkvision with a range of 60 feet, and you have advantage on Dexterity (Stealth) checks."+
	"\n   " + toUni("Shadowy Defense") + ". When you take damage, you can use your reaction to become insubstantial for a moment, halving the damage you take. Then the reaction can't be used again until the next sunset." + magicTattoosTxt.unicode,
	usages : 1,
	recovery : "sunset",
	action : ["reaction", " (halve damage)"],
	advantages : ["Stealth", true],
	vision : [["Darkvision", 60]]
}
MagicItemsList["spellwrought tattoo"] = {
	name : "Spellwrought Tattoo",
	source : [["T", 135]],
	type : "wondrous item (tattoo)",
	description : "When I hold this magic needle against my skin and speak the command word, it disappears and I gain a magical tattoo. I can use this tattoo to cast its spell, requiring no material components. The tattoo glows faintly while I cast the spell and for the spell's duration. Once the spell ends, the tattoo vanishes.",
	descriptionFull : "Produced by a special needle, this magic tattoo contains a single spell of up to 5th level, wrought on your skin by a magic needle. To use the tattoo, you must hold the needle against your skin and speak the command word. The needle turns into ink that becomes the tattoo, which appears on the skin in whatever design you like. Once the tattoo is there, you can cast its spell, requiring no material components. The tattoo glows faintly while you cast the spell and for the spell's duration. Once the spell ends, the tattoo vanishes from your skin."+
	"\n   The level of the spell in the tattoo determines the spell's saving throw DC, attack bonus, spellcasting ability modifier, and the tattoo's rarity, as shown in the table below.\n"+
	toUni("\n Spell\t\t     Spellcasting\tSave\tAttack"+
	"\n Level\tRarity\t     Ability Mod.\t DC\tBonus")+
	"\nCantrip\tCommon\t\t+3\t 13\t  +5"+
	"\n  1st\tCommon\t\t+3\t 13\t  +5"+
	"\n  2nd\tUncommon\t+3\t 13\t  +5"+
	"\n  3rd\tUncommon\t+4\t 15\t  +7"+
	"\n  4th\tRare\t\t+4\t 15\t  +7"+
	"\n  5th\tRare\t\t+5\t 17\t  +9" + magicTattoosTxt.unicode.replace(/[\s\S]*in your space\.\n */, "\n"),
	allowDuplicates : true,
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if ((/^spellwrought tattoo/i).test(spName)) {
					if (spellObj.components) spellObj.components = spellObj.components.replace(/,?[RM][\u0192\u2020]?/ig, '');
					if (spellObj.compMaterial) spellObj.compMaterial = "Spell cast using a Spellwrought Tattoo, require no material components";
					spellObj.ritual = false;
					["description", "descriptionMetric", "descriptionShorter", "descriptionShorterMetric"].forEach (function (attr) {
						if (!spellObj[attr]) return;
						spellObj[attr] = spellObj[attr].replace(/ \(\d+k? ?gp( cons\.?)?\)/i, '');
					});
					return true;
				}
			},
			"When casting a spell using a Spellwrought Tattoo, no material components are needed, and can't be cast as a ritual."
		]
	},
	choices : ["Cantrip (common)", "1st-level (common)", "2nd-level (uncommon)", "3rd-level (uncommon)", "4th-level (rare)", "5th-level (rare)"],
	choicesNotInMenu : true,
	"cantrip (common)" : {
		name : "Spellwrought Tattoo (cantrip)",
		sortname : "Spellwrought Tattoo  (cantrip)",
		rarity : "common",
		description : "When I put this needle on my skin and speak its command word, it disappears and I gain a magical tattoo. I can use this tattoo to cast its cantrip, requiring no material components, with DC 13, +5 spell attack. It glows faintly while I cast the spell and for the spell's duration. Once the spell ends, the tattoo vanishes.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,0],
			psionic : false,
			times : 20,
			firstCol : "checkbox",
			magicItemComponents : false
		}
	},
	"1st-level (common)" : {
		name : "Spellwrought Tattoo (1st-level)",
		rarity : "common",
		description : "When I put this needle on my skin and speak its command word, it disappears and I gain a magical tattoo. I can use this tattoo to cast its 1st-level spell, requiring no material components, with DC 13, +5 spell attack. It glows faintly while I cast the spell and for the spell's duration. Once the spell ends, the tattoo vanishes.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [1,1],
			psionic : false,
			times : 20,
			firstCol : "checkbox",
			magicItemComponents : false
		}
	},
	"2nd-level (uncommon)" : {
		name : "Spellwrought Tattoo (2nd-level)",
		rarity : "uncommon",
		description : "When I put this needle on my skin and speak its command word, it disappears and I gain a magical tattoo. I can use this tattoo to cast its 2nd-level spell, requiring no material components, with DC 13, +5 spell attack. It glows faintly while I cast the spell and for the spell's duration. Once the spell ends, the tattoo vanishes.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [2,2],
			psionic : false,
			times : 20,
			firstCol : "checkbox",
			magicItemComponents : false
		}
	},
	"3rd-level (uncommon)" : {
		name : "Spellwrought Tattoo (3rd-level)",
		rarity : "uncommon",
		description : "When I put this needle on my skin and speak its command word, it disappears and I gain a magical tattoo. I can use this tattoo to cast its 3rd-level spell, requiring no material components, with DC 15, +7 spell attack. It glows faintly while I cast the spell and for the spell's duration. Once the spell ends, the tattoo vanishes.",
		fixedDC : 15,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [3,3],
			psionic : false,
			times : 20,
			firstCol : "checkbox",
			magicItemComponents : false
		}
	},
	"4th-level (rare)" : {
		name : "Spellwrought Tattoo (4th-level)",
		rarity : "rare",
		description : "When I put this needle on my skin and speak its command word, it disappears and I gain a magical tattoo. I can use this tattoo to cast its 4th-level spell, requiring no material components, with DC 15, +7 spell attack. It glows faintly while I cast the spell and for the spell's duration. Once the spell ends, the tattoo vanishes.",
		fixedDC : 15,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [4,4],
			psionic : false,
			times : 20,
			firstCol : "checkbox",
			magicItemComponents : false
		}
	},
	"5th-level (rare)" : {
		name : "Spellwrought Tattoo (5th-level)",
		rarity : "rare",
		description : "When I put this needle on my skin and speak its command word, it disappears and I gain a magical tattoo. I can use this tattoo to cast its 5th-level spell, requiring no material components, with DC 17, +9 spell attack. It glows faintly while I cast the spell and for the spell's duration. Once the spell ends, the tattoo vanishes.",
		fixedDC : 17,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [5,5],
			psionic : false,
			times : 20,
			firstCol : "checkbox",
			magicItemComponents : false
		}
	}
}
// Bonus to spell attack rolls and saving throw DCs
MagicItemsList["all-purpose tool"] = {
	name : "All-Purpose Tool",
	source : [["T", 119]],
	type : "wondrous item",
	attunement : true,
	prerequisite : "Requires attunement by an artificer",
	prereqeval : function(v) { return classes.known.artificer ? true : false; },
	description : "As an action, I can transform this simple screwdriver into any set of artisan's tools and be proficient with them. While holding this tool, I gain a bonus to my artificer spell attacks and save DCs. As an action once per dawn, I can choose any cantrip that I don't know and cast it as an artificer cantrip for the next 8 hours.",
	descriptionFull : "This simple screwdriver can transform into a variety of tools; as an action, you can touch the item and transform it into any type of artisan's tool of your choice (see the \"Equipment\" chapter in the Player's Handbook for a list of artisan's tools). Whatever form the tool takes, you are proficient with it."+
	"\n   While holding this tool, you gain a bonus to the spell attack rolls and the saving throw DCs of your artificer spells. The bonus is determined by the tool's rarity."+
	"\n   As an action, you can focus on the tool to channel your creative forces. Choose a cantrip that you don't know from any class list. For 8 hours, you can cast that cantrip, and it counts as an artificer cantrip for you. Once this property is used, it can't be used again until the next dawn.",
	usages : 1,
	recovery : "dawn",
	additional : "choose cantrip",
	eval : function () {
		CurrentSpells['all-purpose tool'] = {
			name : 'All-Purpose Tool (item)',
			ability : "artificer",
			list : { 'class' : 'any', level : [0, 0] },
			known : { cantrips : 0, spells : 'list' },
			bonus : {
				bon1 : {
					name : 'Just select "Full List"',
					spells : []
				},
				bon2 : {
					name : 'on the bottom left',
					spells : []
				}
			},
			typeList : 4,
			refType : "item",
			allowUpCasting : true,
			firstCol : "8h"
		};
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	removeeval : function () {
		delete CurrentSpells['all-purpose tool'];
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Remove the already known cantrips, from any source except magic items
				if (spName === 'all-purpose tool') {
					var allSpellsKnown = [];
					for (var sCast in CurrentSpells) {
						if (sCast.refType === "item") continue;
						var oCast = CurrentSpells[sCast];
						if (oCast.selectCa) allSpellsKnown = allSpellsKnown.concat(oCast.selectCa);
						if (oCast.selectBo) allSpellsKnown = allSpellsKnown.concat(oCast.selectBo);
					}
					var knownCantrips = OrderSpells(allSpellsKnown, "single", false, false, 0);
					if (!spList.notspells) spList.notspells = [];
					spList.notspells = spList.notspells.concat(knownCantrips);
				}
			},
		],
		spellAdd : [
			function (spellKey, spellObj, spName, isDuplicate) {
				if (spName === 'all-purpose tool') {
					spellObj.firstCol = "checkbox";
				};
			}
		]
	},
	action : [["action", " (transform tool)"], ["action", " (choose cantrip)"]],
	choices : ["+1 to spell attacks and DCs (uncommon)", "+2 to spell attacks and DCs (rare)", "+3 to spell attacks and DCs (very rare)"],
	"+1 to spell attacks and dcs (uncommon)" : {
		name : "All-Purpose Tool +1",
		rarity : "uncommon",
		description : "As an action, I can transform this simple screwdriver into any set of artisan's tools and be proficient with them. While holding this tool, I gain a +1 bonus to my artificer spell attacks and save DCs. As an action once per dawn, I can choose any cantrip that I don't know and cast it as an artificer cantrip for the next 8 hours.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability, spell) {
					if (type !== "prepare" && (spellcasters.indexOf('artificer') !== -1 || (ability === 4 && spell && SpellsList[spell] && SpellsList[spell].level === 0))) return 1;
				},
				"While holding the All-Purpose Tool, I gain a +1 bonus to spell attack rolls and to the saving throw DCs of my artificer spells."
			]
		}
	},
	"+2 to spell attacks and dcs (rare)" : {
		name : "All-Purpose Tool +2",
		rarity : "rare",
		description : "As an action, I can transform this simple screwdriver into any set of artisan's tools and be proficient with them. While holding this tool, I gain a +2 bonus to my artificer spell attacks and save DCs. As an action once per dawn, I can choose any cantrip that I don't know and cast it as an artificer cantrip for the next 8 hours.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability, spell) {
					if (type !== "prepare" && (spellcasters.indexOf('artificer') !== -1 || (ability === 4 && spell && SpellsList[spell] && SpellsList[spell].level === 0))) return 2;
				},
				"While holding the All-Purpose Tool, I gain a +2 bonus to spell attack rolls and to the saving throw DCs of my artificer spells."
			]
		}
	},
	"+3 to spell attacks and dcs (very rare)" : {
		name : "All-Purpose Tool +3",
		rarity : "very rare",
		description : "As an action, I can transform this simple screwdriver into any set of artisan's tools and be proficient with them. While holding this tool, I gain a +3 bonus to my artificer spell attacks and save DCs. As an action once per dawn, I can choose any cantrip that I don't know and cast it as an artificer cantrip for the next 8 hours.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability, spell) {
					if (type !== "prepare" && (spellcasters.indexOf('artificer') !== -1 || (ability === 4 && spell && SpellsList[spell] && SpellsList[spell].level === 0))) return 3;
				},
				"While holding the All-Purpose Tool, I gain a +3 bonus to spell attack rolls and to the saving throw DCs of my artificer spells."
			]
		}
	}
}
MagicItemsList["amulet of the devout"] = { // contains contributions by lizrdgizrd
	name : "Amulet of the Devout",
	source : [["T", 119]],
	type : "wondrous item",
	attunement : true,
	prerequisite : "Requires attunement by a cleric or paladin",
	prereqeval : function(v) {
		return classes.known.cleric || classes.known.paladin ? true : false;
	},
	description : "This amulet bears the symbol of a deity inlaid with precious stones or metals. While I wear this holy symbol, I gain a bonus to spell attack rolls and saving throw DCs of my spells. Once per dawn, it allows me to use my Channel Divinity feature without expending one of the feature's uses.",
	descriptionFull : "This amulet bears the symbol of a deity inlaid with precious stones or metals. While you wear the holy symbol you gain a bonus to spell attack rolls and the saving throw DCs of your spells. The bonus is determined by the amulet's rarity."+
	"\n   While you wear this amulet, you can use your Channel Divinity feature without expending one of the feature's uses. Once this property is used, it can't be used again until the next dawn.",
	weight : 1, // as amulet holy symbol
	usages : 1,
	recovery : "dawn",
	additional : "Channel Divinity",
	choices : ["+1 to spell attacks and DCs (uncommon)", "+2 to spell attacks and DCs (rare)", "+3 to spell attacks and DCs (very rare)"],
	"+1 to spell attacks and dcs (uncommon)" : {
		name : "Amulet of the Devout +1",
		nameTest : "+1 Amulet of the Devout",
		rarity : "uncommon",
		description : "This amulet bears the symbol of a deity inlaid with precious stones or metals. While I wear this holy symbol, I gain a +1 bonus to spell attack rolls and saving throw DCs of my spells. Once per dawn, it allows me to use my Channel Divinity feature without expending one of the feature's uses.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare") return 1;
				},
				"While wearing the Amulet of the Devout, I gain a +1 bonus to spell attack rolls and to the saving throw DCs of my spells."
			]
		}
	},
	"+2 to spell attacks and dcs (rare)" : {
		name : "Amulet of the Devout +2",
		nameTest : "+2 Amulet of the Devout",
		rarity : "rare",
		description : "This amulet bears the symbol of a deity inlaid with precious stones or metals. While I wear this holy symbol, I gain a +2 bonus to spell attack rolls and saving throw DCs of my spells. Once per dawn, it allows me to use my Channel Divinity feature without expending one of the feature's uses.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare") return 2;
				},
				"While wearing the Amulet of the Devout, I gain a +2 bonus to spell attack rolls and to the saving throw DCs of my spells."
			]
		}
	},
	"+3 to spell attacks and dcs (very rare)" : {
		name : "Amulet of the Devout +3",
		nameTest : "+3 Amulet of the Devout",
		rarity : "very rare",
		description : "This amulet bears the symbol of a deity inlaid with precious stones or metals. While I wear this holy symbol, I gain a +3 bonus to spell attack rolls and saving throw DCs of my spells. Once per dawn, it allows me to use my Channel Divinity feature without expending one of the feature's uses.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare") return 3;
				},
				"While wearing the Amulet of the Devout, I gain a +3 bonus to spell attack rolls and to the saving throw DCs of my spells."
			]
		}
	}
}
MagicItemsList["arcane grimoire"] = { // contains contributions by lizrdgizrd
	name : "Arcane Grimoire",
	source : [["T", 120]],
	type : "wondrous item",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "I can use this leather-bound book as a spellbook and it allows me to regain 1 extra spell slot level when I use Arcane Recovery (not included in the automation). While holding it, I can use it as a spellcasting focus for my wizard spells and gain a bonus to spell attack rolls and the saving throw DCs of my wizard spells.",
	descriptionFull : "While you are holding this leather-bound book, you can use it as a spellcasting focus for your wizard spells, and you gain a bonus to spell attack rolls and the saving throw DCs of your wizard spells. The bonus is determined by the book's rarity."+
	"\n   You can use this book as a spellbook. In addition, when you use your Arcane Recovery feature, you can increase the number of spell slot levels you regain by 1.",
	weight : 3, // as spellbook
	choices : ["+1 to spell attacks and DCs (uncommon)", "+2 to spell attacks and DCs (rare)", "+3 to spell attacks and DCs (very rare)"],
	"+1 to spell attacks and dcs (uncommon)" : {
		name : "Arcane Grimoire +1",
		rarity : "uncommon",
		description : "I can use this leather-bound book as a spellbook and it allows me to regain 1 extra spell slot level when I use Arcane Recovery (not included in the automation). While holding it, I can use it as a spellcasting focus for my wizard spells and gain a +1 bonus to the spell attack rolls and saving throw DCs of my wizard spells.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('wizard') !== -1) return 1;
				},
				"While holding the Arcane Grimoire, I gain a +1 bonus to the spell attack rolls and saving throw DCs of my wizard spells."
			]
		}
	},
	"+2 to spell attacks and dcs (rare)" : {
		name : "Arcane Grimoire +2",
		rarity : "rare",
		description : "I can use this leather-bound book as a spellbook and it allows me to regain 1 extra spell slot level when I use Arcane Recovery (not included in the automation). While holding it, I can use it as a spellcasting focus for my wizard spells and gain a +2 bonus to the spell attack rolls and saving throw DCs of my wizard spells.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('wizard') !== -1) return 2;
				},
				"While holding the Arcane Grimoire, I gain a +2 bonus to the spell attack rolls and saving throw DCs of my wizard spells."
			]
		}
	},
	"+3 to spell attacks and dcs (very rare)" : {
		name : "Arcane Grimoire +3",
		rarity : "very rare",
		description : "I can use this leather-bound book as a spellbook and it allows me to regain 1 extra spell slot level when I use Arcane Recovery (not included in the automation). While holding it, I can use it as a spellcasting focus for my wizard spells and gain a +3 bonus to the spell attack rolls and saving throw DCs of my wizard spells.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('wizard') !== -1) return 3;
				},
				"While holding the Arcane Grimoire, I gain a +3 bonus to the spell attack rolls and saving throw DCs of my wizard spells."
			]
		}
	}
}
MagicItemsList["bloodwell vial"] = { // contains contributions by lizrdgizrd
	name : "Bloodwell Vial",
	source : [["T", 122]],
	type : "wondrous item",
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer",
	prereqeval : function(v) { return classes.known.sorcerer ? true : false; },
	description : "While I wear or hold this vial to which I added a few drops of my blood, I gain a bonus to my spell attack rolls and to the saving throw DCs of my sorcerer spells. While I'm attuned to it, it can't be opened. Once per dawn, when I roll any Hit Dice to recover HP while carrying this vial, I can regain 5 sorcery points.",
	descriptionFull : "To attune to this vial, you must place a few drops of your blood into it. The vial can't be opened while your attunement to it lasts. If your attunement to the vial ends, the contained blood turns to ash. You can use the vial as a spellcasting focus for your spells while wearing or holding it, and you gain a bonus to spell attack rolls and to the saving throw DCs of your sorcerer spells. The bonus is determined by the vial's rarity."+
	"\n   In addition, when you roll any Hit Dice to recover hit points while you are carrying the vial, you can regain 5 sorcery points. This property of the vial can't be used again until the next dawn.",
	usages : 1,
	recovery : "dawn",
	additional : "recover 5 Sorcery Points",
	choices : ["+1 to spell attacks and DCs (uncommon)", "+2 to spell attacks and DCs (rare)", "+3 to spell attacks and DCs (very rare)"],
	"+1 to spell attacks and dcs (uncommon)" : {
		name : "Bloodwell Vial +1",
		rarity : "uncommon",
		description : "While I wear or hold this vial to which I added a few drops of my blood, I gain a +1 bonus to my spell attack rolls and to the saving throw DCs of my sorcerer spells. While I'm attuned to it, it can't be opened. Once per dawn, when I roll any Hit Dice to recover HP while carrying this vial, I can regain 5 sorcery points.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('sorcerer') !== -1) return 1;
				},
				"While wearing or holding the Bloodwell Vial, I gain a +1 bonus to the spell attack rolls and saving throw DCs of my sorcerer spells."
			]
		}
	},
	"+2 to spell attacks and dcs (rare)" : {
		name : "Bloodwell Vial +2",
		rarity : "rare",
		description : "While I wear or hold this vial to which I added a few drops of my blood, I gain a +1 bonus to my spell attack rolls and to the saving throw DCs of my sorcerer spells. While I'm attuned to it, it can't be opened. Once per dawn, when I roll any Hit Dice to recover HP while carrying this vial, I can regain 5 sorcery points.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('sorcerer') !== -1) return 2;
				},
				"While wearing or holding the Bloodwell Vial, I gain a +2 bonus to the spell attack rolls and saving throw DCs of my sorcerer spells."
			]
		}
	},
	"+3 to spell attacks and dcs (very rare)" : {
		name : "Bloodwell Vial +3",
		rarity : "very rare",
		description : "While I wear or hold this vial to which I added a few drops of my blood, I gain a +3 bonus to my spell attack rolls and to the saving throw DCs of my sorcerer spells. While I'm attuned to it, it can't be opened. Once per dawn, when I roll any Hit Dice to recover HP while carrying this vial, I can regain 5 sorcery points.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('sorcerer') !== -1) return 3;
				},
				"While wearing or holding the Bloodwell Vial, I gain a +3 bonus to the spell attack rolls and saving throw DCs of my sorcerer spells."
			]
		}
	}
}
MagicItemsList["moon sickle"] = {
	name : "Moon Sickle",
	source : [["T", 133]],
	type : "weapon (sickle)",
	attunement : true,
	prerequisite : "Requires attunement by a druid or ranger",
	prereqeval : function(v) {
		return classes.known.druid || classes.known.ranger || classes.known.rangerua ? true : false;
	},
	description : "This silver-bladed sickle glimmers softly with moonlight. I gain a bonus to attack and damage rolls made with it. While I'm holding it, I gain a bonus to spell attack rolls and saving throw DCs of my druid and ranger spells, and spells I cast that restore HP add 1d4 to the number of HP restored.",
	descriptionFull : "This silver-bladed sickle glimmers softly with moonlight. While holding this magic weapon, you gain a bonus to attack and damage rolls made with it, and you gain a bonus to spell attack rolls and the saving throw DCs of your druid and ranger spells. The bonus is determined by the weapon's rarity. In addition, you can use the sickle as a spellcasting focus for your druid and ranger spells."+
	"\n   When you cast a spell that restores hit points, you can roll a d4 and add the number rolled to the amount of hit points restored, provided you are holding the sickle.",
	weight : 2,
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (spellObj.psionic || !spellObj.level) return;
				switch (spellKey) {
					case "enervation" :
					case "life transference" :
					case "vampiric touch" :
						var useSpellDescr = getSpellShortDescription(spellKey, spellObj);
						var strAdd = " +1d4";
						spellObj.description = useSpellDescr.replace(/(heals? (half|twice)( the damage dealt| that)?)( in HP)?/, "$1" + strAdd);
						return true;
					default :
						return genericSpellDmgEdit(spellKey, spellObj, "heal", "1d4");
				}
			},
			"While holding the Moon Sickle when I cast a spell that restores hit points, I can roll a d4 and add the number rolled to the amount of hit points restored."
		]
	},
	choices : ["+1 weapon, +1 to spell attacks and DCs (uncommon)", "+2 weapon, +2 to spell attacks and DCs (rare)", "+3 weapon, +3 to spell attacks and DCs (very rare)"],
	"+1 weapon, +1 to spell attacks and dcs (uncommon)" : {
		name : "Moon Sickle +1",
		rarity : "uncommon",
		description : "This silver-bladed sickle glimmers softly with moonlight. I gain a +1 bonus to attack and damage rolls made with it. While I'm holding it, I gain a +1 bonus to spell attack rolls and saving throw DCs of my druid and ranger spells, and spells I cast that restore HP add 1d4 to the number of HP restored.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && (spellcasters.indexOf('druid') !== -1 || spellcasters.indexOf('ranger') !== -1)) return 1;
				},
				"While holding the Moon Sickle, I gain a +1 bonus to the spell attack rolls and saving throw DCs of my druid and ranger spells."
			]
		},
		weaponsAdd : { select : ["Moon Sickle +1"], options : ["Moon Sickle +1"] }
	},
	"+2 weapon, +2 to spell attacks and dcs (rare)" : {
		name : "Moon Sickle +2",
		rarity : "rare",
		description : "This silver-bladed sickle glimmers softly with moonlight. I gain a +2 bonus to attack and damage rolls made with it. While I'm holding it, I gain a +2 bonus to spell attack rolls and saving throw DCs of my druid and ranger spells, and spells I cast that restore HP add 1d4 to the number of HP restored.",
		calcChanges : {
				spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && (spellcasters.indexOf('druid') !== -1 || spellcasters.indexOf('ranger') !== -1)) return 2;
				},
				"While holding the Moon Sickle, I gain a +2 bonus to the spell attack rolls and saving throw DCs of my druid and ranger spells."
			]
		},
		weaponsAdd : { select : ["Moon Sickle +2"], options : ["Moon Sickle +2"] }
	},
	"+3 weapon, +3 to spell attacks and dcs (very rare)" : {
		name : "Moon Sickle +3",
		rarity : "very rare",
		description : "This silver-bladed sickle glimmers softly with moonlight. I gain a +3 bonus to attack and damage rolls made with it. While I'm holding it, I gain a +3 bonus to spell attack rolls and saving throw DCs of my druid and ranger spells, and spells I cast that restore HP add 1d4 to the number of HP restored.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && (spellcasters.indexOf('druid') !== -1 || spellcasters.indexOf('ranger') !== -1)) return 3;
				},
				"While holding the Moon Sickle, I gain a +3 bonus to the spell attack rolls and saving throw DCs of my druid and ranger spells."
			]
		},
		weaponsAdd : { select : ["Moon Sickle +3"], options : ["Moon Sickle +3"] }
	}
}
MagicItemsList["rhythm maker's drum"] = {
	name : "Rhythm Maker's Drum",
	source : [["T", 134]],
	type : "wondrous item (instrument)",
	attunement : true,
	prerequisite : "Requires attunement by a bard",
	prereqeval : function(v) { return classes.known.bard ? true : false; },
	description : "While holding this drum, I gain a bonus to spell attack rolls and to the spell saving throw DCs of my bard spells.\nAs an action once per dawn, I can play the drum to regain one use of my Bardic Inspiration feature.",
	descriptionFull : "While holding this drum, you gain a bonus to spell attack rolls and to the spell saving throw DCs or your bard spells. The bonus is determined by the drum's rarity."+
	"\n   As an action, you can play the drum to regain one use of your Bardic Inspiration feature. This property of the drum can't be used again until the next dawn.",
	weight : 3,
	usages : 1,
	recovery : "dawn",
	action : [["action", " (bardic inspiration)"]],
	choices : ["+1 to spell attacks and DCs (uncommon)", "+2 to spell attacks and DCs (rare)", "+3 to spell attacks and DCs (very rare)"],
	"+1 to spell attacks and dcs (uncommon)" : {
		name : "Rhythm Maker's Drum +1",
		rarity : "uncommon",
		description : "While holding this drum, I gain a +1 bonus to spell attack rolls and to the spell saving throw DCs of my bard spells.\nAs an action once per dawn, I can play the drum to regain one use of my Bardic Inspiration feature.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('bard') !== -1) return 1;
				},
				"While holding the Rhythm Maker's Drum, I gain a +1 bonus to the spell attack rolls and saving throw DCs of my bard spells."
			]
		}
	},
	"+2 to spell attacks and dcs (rare)" : {
		name : "Rhythm Maker's Drum +2",
		rarity : "rare",
		description : "While holding this drum, I gain a +2 bonus to spell attack rolls and to the spell saving throw DCs of my bard spells.\nAs an action once per dawn, I can play the drum to regain one use of my Bardic Inspiration feature.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('bard') !== -1) return 2;
				},
				"While holding the Rhythm Maker's Drum, I gain a +2 bonus to the spell attack rolls and saving throw DCs of my bard spells."
			]
		}
	},
	"+3 to spell attacks and dcs (very rare)" : {
		name : "Rhythm Maker's Drum +3",
		rarity : "very rare",
		description : "While holding this drum, I gain a +3 bonus to spell attack rolls and to the spell saving throw DCs of my bard spells.\nAs an action once per dawn, I can play the drum to regain one use of my Bardic Inspiration feature.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare" && spellcasters.indexOf('bard') !== -1) return 3;
				},
				"While holding the Rhythm Maker's Drum, I gain a +3 bonus to the spell attack rolls and saving throw DCs of my bard spells."
			]
		}
	}
}
// Spellbook alternatives
MagicItemsList["alchemical compendium"] = {
	name : "Alchemical Compendium",
	source : [["T", 119]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "I can use this tome with spells as my spellbook and spellcasting focus. It has 3 charges, regaining 1d3 at dawn. With 1 charge \u0026 1 min of study, I can change a prepared spell to a transmutation spell within. As an action, I can touch an unattended, nonmagical object and use charges to transform it into another. See tooltip.",
	descriptionLong : "I can use this acrid smelling, stained, heavy book with metal fittings as my spellbook and, while held, as my spellcasting focus. It contains several spells and has 3 charges, regaining 1d3 at dawn. I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to a transmutation spell within. As an action, I can touch an unattended, nonmagical object and use charges to transform it into another. For 1 charge, the object can be up to 1 ft on a side. I can spend additional charges to increase these dimensions by 2 ft per charge. The new object must have no higher gp value than the original.",
	descriptionFull : "Acrid odors cling to this stained, heavy volume. The book's metal fittings are copper, iron, lead, silver, and gold, some frozen mid-transition from one metal to another. When found, the book contains the following spells: enlarge/reduce, feather fall, flesh to stone, gaseous form, magic weapon, and polymorph. It functions as a spellbook for you."+
	"\n   While you are holding the book, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The book has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the book, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book. The new spell must be of the transmutation school."+
	"\n \u2022 As an action, you can touch a nonmagical object that isn't being worn or carried and spend a number of charges to transform the target into another object. For 1 charge, the object can be no larger than 1 foot on a side. You can spend additional charges to increase the maximum dimensions by 2 feet per charge. The new object must have a gold value equal to or less than the original.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		addToKnown : ["enlarge/reduce", "feather fall", "flesh to stone", "gaseous form", "magic weapon", "polymorph"]
	},
	action : [["action", " (transform object)"]]
}
MagicItemsList["astromancy archive"] = {
	name : "Astromancy Archive",
	source : [["T", 120]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "As bonus action, I can (un)fold this disc into an armillary sphere. I can use it as a spellcasting focus and spellbook with 3 charges, regains 1d3 at dawn. For 1 charge \u0026 1 min of study, I can swap a prepared spell for a divination spell within. As a reaction, I can use 1 charge to add/subtract d4 from attack/check/save in 30 ft.",
	descriptionLong : "As a bonus action, I can unfold this brass disc of articulated, concentric rings into an armillary sphere or back into a disc. I can use it as my spellbook and, while held, as a spellcasting focus for my wizard spells. It contains several spells and has 3 charges, regaining 1d3 at dawn. I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to a divination spell within. As a reaction when I see a creature within 30 ft roll for an attack, check, or save, I can expend 1 change to add or subtract 1d4 from the roll. This happens after I see the roll but before the roll's effects are applied.",
	descriptionFull : "This brass disc of articulated, concentric rings unfolds into an armillary sphere. As a bonus action, you can unfold it into the sphere or back into a disc. When found, it contains the following spells, which are wizard spells for you while you are attuned to it: augury, divination, find the path, foresight, locate creature, and locate object. It functions as a spellbook for you, with spells encoded on the rings."+
	"\n   While you are holding the archive, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The archive has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the archive, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the archive. The new spell must be of the divination school."+
	"\n \u2022 When a creature you can see within 30 feet of you makes an attack roll, an ability check, or a saving throw, you can use your reaction to expend 1 charge and force the creature to roll a d4 and apply the number rolled as a bonus or penalty (your choice) to the original roll. You can do this after you see the roll but before its effects are applied.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		spellcastingBonus : {
			name : "Astromancy Archive",
			spells : ["augury", "divination", "find the path"], // not wizard spells!
			selection : ["augury", "divination", "find the path"],
			times : 3
		},
		addToKnown : ["foresight", "locate creature", "locate object"]
	},
	action : [
		["bonus action", " (fold/unfold)"],
		["reaction", " (add/subtract d4)"]
	]
}
MagicItemsList["atlas of endless horizons"] = {
	name : "Atlas of Endless Horizons",
	source : [["T", 120]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "This spellbook starts with 7 spells and is a wizard spellcasting focus. It has 3 charges, regaining 1d3 at dawn. For 1 charge \u0026 1 min of study, I can change a prepared spell to a conjuration spell within. As a reaction when hit by an attack, I can use 1 charge to teleport up to 10 ft, making it miss if I'm out of range.",
	descriptionLong : "This thick book is bound in dark leather, crisscrossed with inlaid silver lines suggesting a map or chart. I can use it as my spellbook and, while held, as a spellcasting focus for my wizard spells. It contains several spells and has 3 charges, regaining 1d3 expended charges daily at dawn. I can study the book for 1 minute and expend 1 charge to replace one of my prepared wizard spells with a conjuration spell in this book. As a reaction when I am hit by an attack, I can expend 1 charge to teleport up to 10 ft to an unoccupied space I can see. If my new position is out of range of the attack, it misses me.",
	descriptionFull : "This thick book is bound in dark leather, crisscrossed with inlaid silver lines suggesting a map or chart. When found, the book contains the following spells, which are wizard spells for you while you are attuned to the book: arcane gate, dimension door, gate, misty step, plane shift, teleportation circle, and word of recall. It functions as a spellbook for you."+
	"\n   While you are holding the book, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The book has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the book, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book. The new spell must be of the conjuration school."+
	"\n \u2022 When you are hit by an attack, you can use your reaction to expend 1 charge to teleport up to 10 feet to an unoccupied space you can see. If your new position is out of range of the attack, it misses you.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		spellcastingBonus : {
			name : "Atlas of Endless Horizons",
			spells : ["word of recall"], // not a wizard spell!
			selection : ["word of recall"]
		},
		addToKnown : ["arcane gate", "dimension door", "gate", "misty step", "plane shift", "teleportation circle"]
	},
	action : [["reaction", "Teleport 10ft (1 charge)"]]
}
MagicItemsList["crystalline chronicle"] = {
	name : "Crystalline Chronicle",
	source : [["T", 124]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "I can use this orb with spells as a wizard spellcasting focus and spellbook. It lets me use Mage Hand, Mind Sliver, and Message. It has 3 charges, regaining 1d3 at dawn. For 1 charge \u0026 1 min of study, I can change a prepared spell to another within. I can use 1 charge to ignore components of a wizard spell (max 100 gp).",
	descriptionLong : "This grapefruit sized, etched crystal sphere hums pulses with irregular flares of inner light. I can retrieve and store information within the crystal as a spellbook by touching it. It contains several spells and has 3 charges, regaining 1d3 at dawn. While holding it, I can use it as a spellcasting focus for my wizard spells, I know the Mage Hand, Mind Sliver, and Message cantrips, I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to another within, and when I cast a wizard spell, I can expend 1 charge to cast it without verbal, somatic, or material components of up to 100 gp value.",
	descriptionFull : "An etched crystal sphere the size of a grapefruit hums faintly and pulses with irregular flares of inner light. While you are touching the crystal, you can retrieve and store information and spells within the crystal at the same rate as reading and writing. When found, the crystal contains the following spells: detect thoughts, intellect fortress, Rary's telepathic bond, sending, telekinesis, Tasha's mind whip, and Tenser's floating disk. It functions as a spellbook for you, with its spells and other writing psychically encoded within it."+
	"\n   While you are holding the crystal, you can use it as a spellcasting focus for your wizard spells, and you know the mage hand, mind sliver, and message cantrips if you don't already know them."+
	"\n   The crystal has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the information within the crystal, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book."+
	"\n \u2022 When you cast a wizard spell, you can expend 1 charge to cast the spell without verbal, somatic, or material components of up to 100 gp value.",
	weight : 3, // As orb arcane focus
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		addToKnown : ["mage hand", "mind sliver", "message", "detect thoughts", "intellect fortress", "rary's telepathic bond", "sending", "telekinesis", "tasha's mind whip", "tenser's floating disk"]
	}
}
MagicItemsList["duplicitous manuscript"] = {
	name : "Duplicitous Manuscript",
	source : [["T", 126]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "This spellbook starts with 7 spells and is a wizard spellcasting focus. It has 3 charges, regaining 1d3 at dawn. For 1 charge \u0026 1 min of study, I can change a prepared spell to an illusion spell within. As a reaction when a save or Investigation check is made vs. my illusion spells, I can use 1 charge to impose disadv.",
	descriptionLong : "This book appears to be a volume of romance fiction to anyone but me. As an action, I can change its appearance and plot. I can use it as my spellbook and, while held, as a spellcasting focus for my wizard spells. It contains several spells and has 3 charges, regaining 1d3 expended charges at dawn. I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to an illusion spell within. As a reaction while holding it when a creature I can see makes a save or an Intelligence (Investigation) check against an illusion spell I cast, I can expend 1 charge to impose disadvantage on the roll.",
	descriptionFull : "To you, this book is a magical spellbook. To anyone else, the book appears to be a volume of verbose romance fiction. As an action, you can change the book's appearance and alter the plot of the romance."+
	"\n   When found, the book contains the following spells: hallucinatory terrain, major image, mirror image, mislead, Nystul's magic aura, phantasmal force, and silent image. It functions as a spellbook for you."+
	"\n   While you are holding the book, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The book has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the book, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book. The new spell must be of the illusion school."+
	"\n \u2022 When a creature you can see makes an Intelligence (Investigation) check to discern the true nature of an illusion spell you cast, or makes a saving throw against an illusion spell you cast, you can use your reaction and expend 1 charge to impose disadvantage on the roll.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		addToKnown : ["hallucinatory terrain", "major image", "mirror image", "mislead", "nystul's magic aura", "phantasmal force", "silent image"]
	},
	action : [
		["reaction", " (impose disadv.)"],
		["action", " (change book)"]
	]
}
MagicItemsList["fulminating treatise"] = {
	name : "Fulminating Treatise",
	source : [["T", 128]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "I can use this tome as a wizard spellcasting focus and spellbook. It has 3 charges, regaining 1d3 at dawn. For 1 charge \u0026 1 min study, I can change a prepared spell to an evocation spell within. As a reaction when my evocation spell damages a creature, I can use 1 charge to deal it 2d6 force damage and knock it prone.",
	descriptionLong : "This thick, scorched book reeks of smoke and ozone, and sparks of energy crackles along the edges of its pages. I can use it as my spellbook and, while held, as a spellcasting focus for my wizard spells. It contains several spells and has 3 charges, regaining 1d3 expended charges at dawn. I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to an evocation spell within. As a reaction while holding it when a creature I can see takes damage from an evocation spell I cast, I can expend 1 charge to deal the creature an extra 2d6 force damage and knock it prone if it's Large or smaller.",
	descriptionFull : "This thick, scorched spellbook reeks of smoke and ozone, and sparks of energy crackles along the edges of its pages. When found, the book contains the following spells: contingency, fireball, gust of wind, Leomund's tiny hut, magic missile, thunderwave, and wall of force. It functions as a spellbook for you."+
	"\n   While you are holding the book, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The book has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the book, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book. The new spell must be of the evocation school."+
	"\n \u2022 When one creature you can see takes damage from an evocation spell you cast, you can use your reaction and expend 1 charge to deal an extra 2d6 force damage to the creature and knock the creature prone if it is Large or smaller.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		addToKnown : ["contingency", "fireball", "gust of wind", "leomund's tiny hut", "magic missile", "thunderwave", "wall of force"]
	},
	action : [["reaction", "Add 2d6 Force Dmg (1 chg)"]]
}
MagicItemsList["heart weaver's primer"] = {
	name : "Heart Weaver's Primer",
	source : [["T", 128]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "I can use this book as a wizard spellcasting focus and spellbook. It has 3 charges, regaining 1d3 at dawn. For 1 charge \u0026 1 min of study, I can change a prepared spell to an enchantment spell in it. When I cast an enchantment spell, I can use 1 charge to grant disadv. on the first save one target makes against the spell.",
	descriptionLong : "This pristine book smells faintly of a random scent I find pleasing. I can use it as my spellbook and, while held, as a spellcasting focus for my wizard spells. It contains several spells that I can prepare as wizards spells. It has 3 charges and it regains 1d3 expended charges daily at dawn. I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to an enchantment spell within the book. When I cast an enchantment spell while holding the book, I can expend 1 charge to impose disadvantage on the first saving throw one target makes against the spell.",
	descriptionFull : "This pristine book smells faintly of a random scent you find pleasing. When found, the book contains the following spells: antipathy/sympathy, charm person, dominate person, enthrall, hypnotic pattern, modify memory, and suggestion. It functions as a spellbook for you."+
	"\n   While you are holding the book, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The book has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the book, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book. The new spell must be of the enchantment school."+
	"\n \u2022 When you cast an enchantment spell, you can expend 1 charge to impose disadvantage on the first saving throw one target makes against the spell.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		spellcastingBonus : {
			name : "Heart Weaver's Primer",
			spells : ["enthrall"], // not a wizard spell!
			selection : ["enthrall"]
		},
		addToKnown : ["antipathy/sympathy", "charm person", "dominate person", "hypnotic pattern", "modify memory", "suggestion"]
	}
}
MagicItemsList["libram of souls and flesh"] = {
	name : "Libram of Souls and Flesh",
	source : [["T", 129]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "This spellbook starts with 7 spells and is a wizard spellcasting focus. It has 3 charges, regaining 1d3 at dawn. For 1 charge \u0026 1 min of study, I can change a prepared spell to a necromancy spell within. As an action, I can use 1 charge to appear undead for 10 min, causing undead I haven't damage to be indifferent.",
	descriptionLong : "With covers made of skin and fittings of bone, this tome is cold to the touch, and fainlty whispers. I can use it as my spellbook and, while held, as a spellcasting focus for my wizard spells. It contains several spells and has 3 charges, regaining 1d3 at dawn. I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to a necromancy spell within. As an action, I can expend 1 charge to appear undead for 10 minutes, fooling even spells. For the duration, undead are indifferent to me, unless I have damaged them. The effect ends early if I deal damage or force a creature to make a save.",
	descriptionFull : "With covers made of skin and fittings of bone, this tome is cold to the touch, and it whispers faintly. When found, the book contains the following spells, which are wizard spells for you while you are attuned to the book: animate dead, circle of death, false life, finger of death, speak with dead, summon undead, and vampiric touch. It functions as a spellbook for you."+
	"\n   While you are holding the book, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The book has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the book, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book. The new spell must be of the necromancy school."+
	"\n \u2022 As an action, you can expend 1 charge to take on a semblance of undeath for 10 minutes. For the duration, you take on a deathly appearance, and undead creatures are indifferent to you, unless you have damaged them. You also appear undead to all outward inspection and to spells used to determine the target's status. The effect ends if you deal damage or force a creature to make a saving throw.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		spellcastingBonus : {
			name : "Libram of Souls and Flesh",
			spells : ["speak with dead"], // not a wizard spell!
			selection : ["speak with dead"]
		},
		addToKnown : ["animate dead", "circle of death", "false life", "finger of death", "summon undead", "vampiric touch"]
	},
	action : [["action", "Semblance of Undeath"]]
}
MagicItemsList["planecaller's codex"] = {
	name : "Planecaller's Codex",
	source : [["T", 134]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "This spellbook starts with 6 spells and is a wizard spellcasting focus. It has 3 charges, regaining 1d3 at dawn. For 1 charge \u0026 1 min of study, I can change a prepared spell to a conjuration spell within. When I cast a conjuration spell to summon or create one creature, I can give it adv. on attacks for 1 min for 1 charge.",
	descriptionLong : "The pages of this book are bound in fiend hide, and its cover is embossed with a diagram of the multiverse. I can use it as my spellbook and, while held, as a spellcasting focus for my wizard spells. It contains several spells and has 3 charges, regaining 1d3 expended charges daily at dawn. I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to a conjuration spell within the book. When I hold the book and cast a conjuration spell that summons or creates one creature, I can expend 1 charge to grant that creature advantage on attack rolls for 1 minute.",
	descriptionFull : "The pages of this book are bound in fiend hide, and its cover is embossed with a diagram of the Great Wheel of the multiverse. When found, the book contains the following spells: banishment, find familiar, gate, magic circle, planar binding, and summon elemental. It functions as a spellbook for you."+
	"\n   While you are holding the book, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The book has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the book, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book. The new spell must be of the conjuration school."+
	"\n \u2022 When you cast a conjuration spell that summons or creates one creature, you can expend 1 charge to grant that creature advantage on attack rolls for 1 minute.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		addToKnown : ["banishment", "find familiar", "gate", "magic circle", "planar binding", "summon elemental"]
	}
}
MagicItemsList["protective verses"] = {
	name : "Protective Verses",
	source : [["T", 134]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	description : "I can use this book with an iron lock as a spellcasting focus and spellbook. As an action, I can use Arcane Lock it. It has 3 charges, regains 1d3 at dawn. For 1 charge \u0026 1 min study, I can change a prepared spell to an abjuration within. I can use 1 charge when I cast an abjuration spell to give a creature in 30 ft 2d10 temp HP.",
	descriptionLong : "This leather-bound spellbook is reinforced with iron and silver fittings and an iron lock (DC 20 to open). As an action, I can touch the book's cover and cause it to lock as if I cast arcane lock on it. I can use it as my spellbook and, while held, as a spellcasting focus for my wizard spells. It contains several spells and has 3 charges, regaining 1d3 charges at dawn. I can study the book for 1 minute and expend 1 charge to change one of my prepared spells to an abjuration spell within. When I hold the book and cast an abjuration, I can expend 1 charge to grant a creature I can see within 30 ft 2d10 temporary hit points.",
	descriptionFull : "This leather-bound spellbook is reinforced with iron and silver fittings and an iron lock (DC 20 to open). As an action, you can touch the book's cover and cause it to lock as if you cast arcane lock on it. When found, the book contains the following spells: arcane lock, dispel magic, globe of invulnerability, glyph of warding, Mordenkainen's private sanctum, protection from evil, and symbol. It functions as a spellbook for you."+
	"\n   While you are holding the book, you can use it as a spellcasting focus for your wizard spells."+
	"\n   The book has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it:"+
	"\n \u2022 If you spend 1 minute studying the book, you can expend 1 charge to replace one of your prepared wizard spells with a different spell in the book. The new spell must be of the abjuration school."+
	"\n \u2022 When you cast an abjuration spell, you can expend 1 charge to grant a creature you can see within 30 feet of you 2d10 temporary hit points.",
	weight : 3, // as spellbook
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	spellcastingBonusElsewhere : {
		addTo : "wizard",
		addToKnown : ["arcane lock", "dispel magic", "globe of invulnerability", "glyph of warding", "mordenkainen's private sanctum", "protection from evil and good", "symbol"]
	},
	action : [["action", " (Arcane Lock itself)"]]
}
// Sorcerer stones
MagicItemsList["astral shard"] = {
	name : "Astral Shard",
	source : [["T", 120]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer",
	prereqeval : function(v) { return classes.known.sorcerer ? true : false; },
	description : "I can use this crystal swirling with silver mist as a spellcasting focus for my sorcerer spells while I hold or wear it. As an action, I can attach or detach it to a Tiny object. Immediately after I cast a spell with a metamagic option while I hold or wear this shard, I can teleport to an unoccupied space I can see within 30 ft.",
	descriptionFull : "This crystal is a solidified shard of the Astral Plane, swirling with silver mist. As an action, you can attach the shard to a Tiny object (such as a weapon or a piece of jewelry) or detach it. It falls off if your attunement to it ends. You can use the shard as a spellcasting focus for your sorcerer spells while you hold or wear it."+
	"\n   When you use a Metamagic option on a spell while you are holding or wearing the shard, immediately after casting the spell you can teleport to an unoccupied space you can see within 30 feet of you.",
	weight : 1, // as crystal arcane focus
	action : [["action", " (attach/detach)"]]
}
MagicItemsList["elemental essence shard"] = {
	name : "Elemental Essence Shard",
	source : [["T", 127]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer",
	prereqeval : function(v) { return classes.known.sorcerer ? true : false; },
	description : "I can use this flickering crystal as a spellcasting focus for my sorcerer spells while I hold or wear it. As an action, I can attach or detach it to a Tiny object. It holds the essence of an Elemental Plane, which grants me additional benefits when I use a Metamagic option on a spell.",
	descriptionFull : "This crackling crystal contains the essence of an elemental plane. As an action, you can attach the shard to a Tiny object (such as a weapon or a piece of jewelry) or detach it. It falls off if your attunement to it ends. You can use the shard as a spellcasting focus while you hold or wear it."+
	"\n   Roll a d4 and consult the Elemental Essence Shards table to determine the shard's essence and property. When you use a Metamagic option on a spell while you are holding or wearing the shard, you can use that property."+
	toUni("\n d4\tEssence")+
	"\n  1\tAir"+
	"\n  2\tEarth"+
	"\n  3\tFire"+
	"\n  4\tWater\n"+
	"\n   " + toUni("Air") + ". You can immediately fly up to 60 feet without provoking opportunity attacks."+
	"\n   " + toUni("Earth") + ". You gain resistance to a damage type of your choice until the start of your next turn."+
	"\n   " + toUni("Fire") + ". One target of the spell that you can see catches fire. The burning target takes 2d10 fire damage at the start of its next turn, and then the flames go out."+
	"\n   " + toUni("Water") + ". You create a wave of water that bursts out from you in a 10-foot radius. Each creature of your choice that you can see in that area takes 2d6 cold damage and must succeed on a Strength saving throw against your spell save DC or be pushed 10 feet away from you and fall prone.",
	weight : 1, // as crystal arcane focus
	action : [["action", " (attach/detach)"]],
	choices : ["Air Essence", "Earth Essence", "Fire Essence", "Water Essence"],
	"air essence" : {
		name : "Air Elemental Essence Shard",
		sortname : "Elemental Essence Shard, Air",
		description : "As an action, I can attach or detach this crackling crystal to a Tiny object. While I hold or wear it, I can use this crystal as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, I can immediately fly up to 60 ft without provoking opportunity attacks."
	},
	"earth essence" : {
		name : "Earth Elemental Essence Shard",
		sortname : "Elemental Essence Shard, Earth",
		description : "As an action, I can attach or detach this crackling crystal to a Tiny object. While I hold or wear it, I can use this crystal as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, I gain resistance to a damage type of my choice until the start of my next turn."
	},
	"fire essence" : {
		name : "Fire Elemental Essence Shard",
		sortname : "Elemental Essence Shard, Fire",
		description : "As an action, I can attach/detach this crackling crystal to a Tiny object. While I hold or wear it, I can use it as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, one target of that spell that I can see catches fire for a round, taking 2d10 fire damage at the start of its next turn."
	},
	"water essence" : {
		name : "Water Elemental Essence Shard",
		sortname : "Elemental Essence Shard, Water",
		description : "As an action, I can attach/detach this crackling crystal to a Tiny object. While I hold or wear it, I can use it as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, all chosen creatures in 10 ft of me take 2d6 cold damage and must make a Str save or fall prone \u0026 be pushed back 10 ft"
	}
}
MagicItemsList["far realm shard"] = {
	name : "Far Realm Shard",
	source : [["T", 127]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer",
	prereqeval : function(v) { return classes.known.sorcerer ? true : false; },
	description : "As an action, I can attach/detach this crystal to an object. While I hold or wear it, it works as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option, I can have a creature I can see in 30 ft make a Cha save (my spell save DC) or take 3d6 psychic damage \u0026 be frightened of me until my next turn starts.",
	descriptionFull : "This writhing crystal is steeped in the warped essence of the Far Realm. As an action, you can attach the shard to a Tiny object (such as a weapon or a piece of jewelry) or detach it. It falls off if your attunement to it ends. You can use the shard as a spellcasting focus while you hold or wear it."+
	"\n   When you use a Metamagic option on a spell while you are holding or wearing the shard, you can cause a slimy tentacle to rip through the fabric of reality and strike one creature you can see within 30 feet of you. The creature must succeed on a Charisma saving throw against your spell save DC or take 3d6 psychic damage and become frightened of you until the start of your next turn.",
	weight : 1, // as crystal arcane focus
	action : [["action", " (attach/detach)"]]
}
MagicItemsList["outer essence shard"] = {
	name : "Outer Essence Shard",
	source : [["T", 133]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer",
	prereqeval : function(v) { return classes.known.sorcerer ? true : false; },
	description : "I can use this flickering crystal as a spellcasting focus for my sorcerer spells while I hold or wear it. As an action, I can attach or detach it to a Tiny object. It holds the essence of an Outer Plane, which grants me additional benefits when I use a Metamagic option on a spell.",
	descriptionFull : "This flickering crystal holds the essence of an Outer Plane. As an action, you can attach the shard to a Tiny object (such as a weapon or a piece of jewelry) or detach it. It falls off if your attunement to it ends. You can use the shard as a spellcasting focus while you hold or wear it."+
	"\n   Roll a d4 and consult the Outer Essence Shards table to determine the shard's essence and property. When you use a Metamagic option on a spell while you are holding or wearing the shard, you can use that property."+
	toUni("\n d4\tEssence")+
	"\n  1\tLawful"+
	"\n  2\tChaotic"+
	"\n  3\tGood"+
	"\n  4\tEvil\n"+
	"\n   " + toUni("Lawful") + ". You can end one of the following conditions affecting yourself or one creature you can see within 30 feet of you: charmed, blinded, deafened, frightened, poisoned, or stunned."+
	"\n   " + toUni("Chaotic") + ". Choose one creature who takes damage from the spell. That target has disadvantage on attack rolls and ability checks made before the start of your next turn."+
	"\n   " + toUni("Good") + ". You or one creature of your choice that you can see within 30 feet of you gains 3d6 temporary hit points."+
	"\n   " + toUni("Evil") + ". Choose one creature who takes damage from the spell. That target takes an extra 3d6 necrotic damage.",
	weight : 1, // as crystal arcane focus
	action : [["action", " (attach/detach)"]],
	choices : ["Lawful Essence", "Chaotic Essence", "Good Essence", "Evil Essence"],
	"lawful essence" : {
		name : "Lawful Outer Essence Shard",
		sortname : "Outer Essence Shard, Lawful",
		description : "As an action, I can attach/detach this flickering crystal to a Tiny object. While I hold or wear it, I can use it as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, I can have myself or another I can see in 30 ft no longer be charmed, blinded, deafened, frightened, poisoned, or stunned."
	},
	"chaotic essence" : {
		name : "Chaotic Outer Essence Shard",
		sortname : "Outer Essence Shard, Chaotic",
		description : "As an action, I can attach/detach this flickering crystal to a Tiny object. While I hold or wear it, I can use it as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, I can have one creature that was damaged by that spell have disadv. on its attacks and checks until my next turn starts."
	},
	"good essence" : {
		name : "Good Outer Essence Shard",
		sortname : "Outer Essence Shard, Good",
		description : "As an action, I can attach or detach this flickering crystal to a Tiny object. While I hold or wear it, I can use this crystal as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, I can have one creature that I can see within 30 ft or myself gain 3d6 temporary hit points."
	},
	"evil essence" : {
		name : "Evil Outer Essence Shard",
		sortname : "Outer Essence Shard, Evil",
		description : "As an action, I can attach or detach this flickering crystal to a Tiny object. While I hold or wear it, I can use this crystal as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, I can have one creature that took damage from that spell take an extra 3d6 necrotic damage."
	}
}
MagicItemsList["shadowfell shard"] = {
	name : "Shadowfell Shard",
	source : [["T", 135]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer",
	prereqeval : function(v) { return classes.known.sorcerer ? true : false; },
	description : "As an action, I can attach/detach this dull crystal to a Tiny object. While I hold or wear it, I can use it as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, I can curse a target of that spell to have disadv. on checks and saves with an ability score of my choice until my next turn ends.",
	descriptionFull : "This dull, cold crystal sits heavy and leaden, saturated by the Shadowfell's despair. As an action, you can attach the shard to a Tiny object (such as a weapon or a piece of jewelry) or detach it. It falls off if your attunement to it ends. You can use the shard as a spellcasting focus while you hold or wear it."+
	"\n   When you use a Metamagic option on a spell while you are holding or wearing the shard, you can momentarily curse one creature targeted by the spell; choose one ability score, and until the end of your next turn, the creature has disadvantage on ability checks and saving throws that use that ability.",
	weight : 1, // as crystal arcane focus
	action : [["action", " (attach/detach)"]]
}
MagicItemsList["feywild shard"] = {
	name : "Feywild Shard",
	source : [["T", 127]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer",
	prereqeval : function(v) { return classes.known.sorcerer ? true : false; },
	description : "As an action, I can attach/detach this warm crystal that glints with sunset colors to a Tiny object. While I hold or wear it, I can use it as a spellcasting focus for my sorcerer spells, and once per dawn when I use a Metamagic option on a spell, I can choose to roll on the Wild Magic Surge table (see Notes for the table).",
	descriptionFull : "This warm crystal glints with the sunset colors of the Feywild sky and evokes whispers of emotional memory. As an action, you can attach the shard to a Tiny object (such as a weapon or a piece of jewelry) or detach it. It falls off if your attunement to it ends. You can use the shard as a spellcasting focus while you hold or wear it."+
	"\n   When you use a Metamagic option on a spell while you are holding or wearing the shard, you can roll on the Wild Magic Surge table in the Player's Handbook. If the result is a spell, it is too wild to be affected by your Metamagic, and if it normally requires concentration, it doesn't require concentration in this case; the spell lasts for its full duration."+
	"\n   If you don't have the Wild Magic Sorcerous Origin, once this property is used to roll on the Wild Magic Surge table, it can't be used again until the next dawn.",
	weight : 1, // as crystal arcane focus
	action : [["action", " (attach/detach)"]],
	choices : ["As a wild magic sorcerer (Wild Mage)", "As any other sorcerer"],
	selfChoosing : function () {
		return classes.known.sorcerer && /wild mag(ic|e)/i.test(classes.known.sorcerer.subclass) ? "as a wild magic sorcerer (wild mage)" : "as any other sorcerer";
	},
	"as a wild magic sorcerer (wild mage)" : {
		name : "Feywild Shard (Wild Mage)",
		description : "As an action, I can attach/detach this warm crystal that glints with sunset colors to a Tiny object. It falls off if my attunement ends. While I hold or wear it, I can use it as a spellcasting focus for my sorcerer spells, and when I use a Metamagic option on a spell, I can choose to roll on the Wild Magic Surge table."
	},
	"as any other sorcerer" : {
		name : "Feywild Shard  ", // spaces are intentional
		description : "As an action, I can attach/detach this warm crystal that glints with sunset colors to a Tiny object. While I hold or wear it, I can use it as a spellcasting focus for my sorcerer spells, and once per dawn when I use a Metamagic option on a spell, I can choose to roll on the Wild Magic Surge table (see Notes for the table).",
		extraLimitedFeatures : [{
			name : "Feywild Shard (wild magic surge)",
			usages : 1,
			recovery : "dawn"
		}]
	}
}
if (ClassSubList['sorcerer-wild magic'] && ClassSubList['sorcerer-wild magic'].features.subclassfeature1.toNotesPage) { // Add the wild magic surge tables to this item
	MagicItemsList["feywild shard"].toNotesPage = ClassSubList['sorcerer-wild magic'].features.subclassfeature1.toNotesPage;
}
// Bard instruments
MagicItemsList["reveler's concertina"] = {
	name : "Reveler's Concertina",
	source : [["T", 134]],
	type : "wondrous item (instrument)",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a bard",
	prereqeval : function(v) { return classes.known.bard ? true : false; },
	description : "While holding this concertina, I gain a +2 bonus to the saving throw DC of my bard spells.\nOnce per dawn, I can use the concertina to cast Otto's Irresistible Dance.",
	descriptionFull : "While holding this concertina, you gain a +2 bonus to the saving throw DC of your bard spells."+
	"\n   As an action, you can use the concertina to cast Otto's irresistible dance from the item. This property of the concertina can't be used again until the next dawn.",
	usages : 1,
	recovery : "dawn",
	additional : "Irresistible Dance",
	spellcastingAbility : "class", // https://www.sageadvice.eu/2015/11/27/hat-of-disguise-dc/
	spellcastingBonus : {
		name : "Otto's Irresistible Dance",
		spells : ["otto's irresistible dance"],
		selection : ["otto's irresistible dance"],
		firstCol : "oncelr"
	},
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type === "dc" && spellcasters.indexOf('bard') !== -1) return 2;
			},
			"While holding the Reveler's Concertina, I gain a +2 bonus to the saving throw DCs of my bard spells."
		]
	}
}
MagicItemsList["lyre of building"] = {
	name : "Lyre of Building",
	source : [["T", 131]],
	type : "wondrous item (instrument)",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a bard",
	prereqeval : function(v) { return classes.known.bard ? true : false; },
	description : "While holding this lyre, I can cast mending as an action. As a reaction, I can protect a structure or object that takes damage from that damage type until the my next turn starts. As an action, I can play the lyre to cast Fabricate, Move Earth, Passwall, or Summon Construct from it, each spell once per dawn.",
	descriptionFull : "While holding this lyre, you can cast mending as an action. You can also play the lyre as a reaction when an object or a structure you can see within 300 feet of you takes damage, causing it to be immune to that damage and any further damage of the same type until the start of your next turn."+
	"\n   In addition, you can play the lyre as an action to cast fabricate, move earth, passwall, or summon construct, and that spell can't be cast from it again until the next dawn.",
	weight : 2,
	spellcastingAbility : "class",
	spellcastingBonus : [{
		name : "At will",
		spells : ["mending"],
		selection : ["mending"],
		firstCol : "atwill"
	}, {
		name : "Once per dawn",
		spells : ["fabricate", "move earth", "passwall", "summon construct"],
		selection : ["fabricate", "move earth", "passwall", "summon construct"],
		firstCol : "oncelr",
		times : 4
	}],
	spellChanges : {
		"fabricate" : {
			time : "1 a",
			changes : "Using the Lyre of Building, I can cast Fabricate as an action."
		},
		"mending" : {
			time : "1 a",
			changes : "Using the Lyre of Building, I can cast Mending as an action."
		}
	},
	action : [["reaction", " (protect object)"]]
}
// Other magic items
MagicItemsList["bell branch"] = {
	name : "Bell Branch",
	source : [["T", 122]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a druid or warlock",
	prereqeval : function(v) {
		return classes.known.druid || classes.known.warlock ? true : false;
	},
	description : "This silver branch with bells has 3 charges, regains 1d3 at dawn. I can use it as my spellcasting focus. As a bonus action, I can use 1 charge to detect the presence of aberrations, celestials, fiends, constructs, elementals, fey, or undead in 60 ft not behind total cover. I can use 1 charge to cast Protection from Evil and Good.",
	descriptionFull : "This silver implement is shaped like a tree branch and is strung with small golden bells. The branch is a spellcasting focus for your spells while you hold it."+
	"\n   The branch has 3 charges, and it regains 1d3 expended charges daily at dawn. You can use the charges in the following ways while holding it."+
	"\n \u2022 As a bonus action, you can expend 1 charge to detect the presence of aberrations, celestials, constructs, elementals, fey, fiends, or undead within 60 feet of you. If such creatures are present and don't have total cover from you, the bells ring softly, their tone indicating the creature types present."+
	"\n \u2022 As an action, you can expend 1 charge to cast protection from evil and good.",
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	action : [["bonus action", " (detect)"]],
	spellFirstColTitle : "Ch",
	spellcastingAbility : "class",
	spellcastingBonus : {
		name : "Protection from Evil/Good",
		spells : ["protection from evil and good"],
		selection : ["protection from evil and good"],
		firstCol : 1
	}
}
MagicItemsList["cauldron of rebirth"] = {
	name : "Cauldron of Rebirth",
	source : [["T", 122]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	prerequisite : "Requires attunement by a druid or warlock",
	prereqeval : function(v) {
		return classes.known.druid || classes.known.warlock ? true : false;
	},
	description : "After a long rest, I can use this Tiny pot to create a potion of greater healing that lasts up to 24 hours. As an action, I can have it grow to fit a Medium creature, or shrink it back down. I can place a dead creature inside with 200 lb salt (10 gp) for 8 hours to Raise Dead. Once used, it can't do this again for 7 days.",
	descriptionFull : "This Tiny pot bears relief scenes of heroes on its cast iron sides. You can use the cauldron as a spellcasting focus for your druid spells, and it functions as a suitable component for the scrying spell. When you finish a long rest, you can use the cauldron to create a potion of greater healing. The potion lasts for 24 hours, then loses its magic if not consumed."+
	"\n   As an action, you can cause the cauldron to grow large enough for a Medium creature to crouch within. You can revert the cauldron to its normal size as an action, harmlessly shunting anything that can't fit inside to the nearest unoccupied space."+
	"\n   If you place the corpse of a humanoid into the cauldron and cover the corpse with 200 pounds of salt (which costs 10 gp) for at least 8 hours, the salt is consumed and the creature returns to life as if by raise dead at the next dawn. Once used, this property can't be used again for 7 days.",
	action : [["action", " (grow/shrink)"]],
	usages : 1,
	recovery : "7 days",
	additional : "Raise Dead"
}
MagicItemsList["devotee's censer"] = {
	name : "Devotee's Censer",
	source : [["T", 126]],
	type : "weapon",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a cleric or paladin",
	prereqeval : function(v) {
		return classes.known.cleric || classes.known.paladin ? true : false;
	},
	description : "I can use this magic flail, perforated with tiny holes, as a holy symbol. Attacks with it deal +1d8 radiant damage. As a bonus action once per dawn, I can speak the command word to cause it to emanate incense out to 10 ft for 1 minute. At the start of each of my turns, all creatures in the incense heal 1d4 hit points.",
	descriptionFull : "The rounded head of this flail is perforated with tiny holes, arranged in symbols and patterns. The flail counts as a holy symbol for you. When you hit with an attack using this magic flail, the target takes an extra 1d8 radiant damage."+
	"\n   As a bonus action, you can speak the command word to cause the flail to emanate a thin cloud of incense out to 10 feet for 1 minute. At the start of each of your turns, you and any other creatures in the incense each regain 1d4 hit points. This property can't be used again until the next dawn.",
	weight : 2,
	usages : 1,
	recovery : "dawn",
	action : [["bonus action", " (incense cloud)"]],
	weaponOptions : [{
		baseWeapon : "flail",
		regExpSearch : /^(?=.*devotee)(?=.*censer).*$/i,
		name : "Devotee's Censer",
		source : [["T", 126]],
		description : "+1d8 radiant damage",
		selectNow : true
	}]
}
MagicItemsList["guardian emblem"] = {
	name : "Guardian Emblem",
	source : [["T", 128]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a cleric or paladin",
	prereqeval : function(v) {
		return classes.known.cleric || classes.known.paladin ? true : false;
	},
	description : "As an action, I can attach or detach this symbol of a deity to a shield or a suit of armor. It has 3 charges, regaining all at dawn. As a reaction when I or a creature I can see within 30 ft suffers a critical hit while I wear the armor or wield the shield that bears the emblem, I can expend 1 charge to turn it into a normal hit.",
	descriptionFull : "This emblem is the symbol of a deity or a spiritual tradition. As an action, you can attach the emblem to a suit of armor or a shield or remove it."+
	"\n   The emblem has 3 charges. When you or a creature you can see within 30 feet of you suffers a critical hit while you're wearing the armor or wielding the shield that bears the emblem, you can use your reaction to expend 1 charge to turn the critical hit into a normal hit instead."+
	"\n   The emblem regains all expended charges daily at dawn.",
	usages : 3,
	recovery : "dawn",
	additional : "stop critical",
	action : [
		["action", " (attach/detach)"],
		["reaction", " (stop critical)"]
	]
}
MagicItemsList["nature's mantle"] = {
	name : "Nature's Mantle",
	source : [["T", 133]],
	type : "wonderous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a druid or ranger.",
	prereqeval : function(v) {
		return classes.known.druid || classes.known.ranger || classes.known.rangerua ? true : false;
	},
	description : "This cloak shifts color and texture to blend with the terrain surrounding me. While wearing the cloak, I can use it as a spellcasting focus for my druid and ranger spells. While I am in an area that is lightly obscured, I can Hide as a bonus action even if I am being directly observed.",
	descriptionFull : "This cloak shifts color and texture to blend with the terrain surrounding you. While wearing the cloak, you can use it as a spellcasting focus for your druid and ranger spells."+
	"\n   While you are in an area that is lightly obscured, you can Hide as a bonus action even if you are being directly observed.",
	action : [["bonus action", " (Hide)"]]
}

// pub_20210316_CM.js
// This file adds the content from the Candlekeep Mysteries adventure to MPMB's Character Record Sheet
// All content in this file contains contributions by Ratatoskr589

SourceList.CM = {
	name : "Candlekeep Mysteries",
	abbreviation : "CM",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dnd.wizards.com/products/candlekeep-mysteries",
	date : "2021/03/16"
};

MagicItemsList["orcus figurine"] = {
	name : "Orcus Figurine",
	source : [["CM", 44]],
	type : "wondrous item",
	rarity : "",
	storyItemAL : true,
	attunement : false,
	description : "This Tiny figurine smells of decaying flesh, detectable out to 5 ft. Within 30 ft of it, dead can't be brought back to life and undead can't be turned. If I hold it and pray for 1 hour, I have a 10% chance of calling a wraith for 1 hour that attacks all non-undead. Once summoned, the figurine can't do so again for 30 days.",
	descriptionFull : "Carved from an ogre's petrified heart, the gray figurine depicts the Demon Prince of Undeath in ghastly detail, clutching his skull-topped wand in one hand and three severed heads by the hair in the other. The figurine smells like decaying flesh, and this scent is detectable out to a range of 5 feet."+
	"\n   The figurine is a Tiny object with AC 17, 3 hit points, and immunity to all types of damage except radiant damage. A detect evil and good spell or similar magic reveals that the figurine has been desecrated. As long as it has at least 1 hit point, the figurine has the following magical properties:"+
	"\n   \u2022 Undead within 30 feet of the figurine can't be turned."+
	"\n   \u2022 Dead creatures within 30 feet of the figurine can't be brought back to life."+
	"\n   \u2022 A creature that holds the figurine while praying to Orcus for at least 1 hour has a 10 percent chance of summoning a smoky avatar of the demon lord. Once this avatar is summoned, it can't be summoned again for 30 days. Orcus's avatar has the statistics of a wraith except that it's chaotic evil. It attacks all non-undead creatures it encounters, and it disappears after 1 hour or when reduced to 0 hit points."
};
MagicItemsList["radiance (wand)"] = {
	name : "Radiance (wand)",
	source : [["CM", 87]],
	type : "wand",
	rarity : "rare", // inferred, as it is a wand of the war mage +1 (uncommon) with extra's
	attunement : true,
	description : "While I am holding this exquisite golden hand mirror, I gain a +1 bonus to spell attack rolls and I ignore half cover when making a spell attack. This arcane focus sheds dim light in a 5-ft radius while in darkness. As a bonus action once per dawn, I can use Radiance to cast Enhance Ability on myself.",
	descriptionFull : "While holding this wand, you gain a +1 bonus to spell attack rolls. In addition, you ignore half cover when making a spell attack. Radiance is in the form of an exquisite golden hand mirror."+
	"\n   While surrounded by darkness, it sheds dim light in a 5-foot radius. A creature that is attuned to Radiance can use a bonus action while holding the mirror to cast the enhance ability spell, choosing itself and no other creature as the spell's target. Once this property of the wand is used, it can't be used again until the next dawn.",
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	extraLimitedFeatures : [{
		name : "Radiance (Enhance Ability)",
		usages : 1,
		recovery : "dawn"
	}],
	spellcastingBonus : {
		name : "Once per dawn, self only",
		spells : ["enhance ability"],
		selection : ["enhance ability"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"enhance ability" : {
			description : "I gain adv. on checks with 1 ability score; choosing Str, Dex, or Con gives secondary benefits",
			time : "1 bns",
			range : "Self",
			changes : "Using Radiance, I can cast Enhance Ability once per dawn as a bonus action instead of an action, but only on myself."
		}
	},
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type == "attack") return 1;
			},
			"I gain a +1 bonus to spell attack rolls."
		]
	}
};
MagicItemsList["serpent scale armor"] = {
	name : "Serpent Scale Armor",
	source : [["CM", 98]],
	type : "armor (scale mail)",
	rarity : "uncommon",
	attunement : false,
	description : "This suit of magical scale mail is made from shimmering scales. Unlike normal scale mail, it does not impose disadvantage on my Dexterity (Stealth) checks and allows me to apply my full Dexterity modifier instead of the normal maximum of +2 for Medium armor.",
	descriptionFull : "This suit of magic armor is made from shimmering scales. While wearing it, you can apply your full Dexterity modifier (instead of a maximum of +2) when determining your Armor Class. In addition, this armor does not impose disadvantage on your Dexterity (Stealth) checks.",
	armorOptions : [{
		regExpSearch : /serpent scale/i,
		name : "Serpent Scale Armor",
		source : [["CM", 98]],
		type : "medium",
		ac : 14,
		weight : 45,
		dex : 100,
		selectNow : true
	}]
};
MagicItemsList["serpent's fang"] = {
	name : "Serpent's Fang",
	source : [["CM", 98]],
	type : "weapon (longsword)",
	rarity : "rare",
	attunement : false,
	description : "This single-edged magic sword is made from the scrimshawed fang of a giant serpent. Its hilt changes shape to adjust to the grasp of any creature that picks it up. The weapon deals an extra 1d10 poison damage to any target it hits.",
	descriptionFull : "This single-edged magic sword is made from the scrimshawed fang of a giant serpent. Its hilt changes shape to adjust to the grasp of any creature that picks it up. The weapon deals an extra 1d10 poison damage to any target it hits.",
	weight : 2,
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /^(?=.*serpent)(?=.*fang).*$/i,
		name : "Serpent's Fang",
		source : [["CM", 98]],
		description : "Versatile (d10); +1d10 poison damage",
		selectNow : true
	}]
};
if (MagicItemsList["alchemy jug"]) {
	// Make the default into a choice (if not done so already)
	if (!MagicItemsList["alchemy jug"].choices) {
		MagicItemsList["alchemy jug"].source = [["D", 150], ["CM", 144]];
		MagicItemsList["alchemy jug"].allowDuplicates = true;
		AddFeatureChoice(MagicItemsList["alchemy jug"], false, "Regular (acid and poison)", {
			name : "Alchemy Jug (regular)",
			source : [["D", 150]],
			description : MagicItemsList["alchemy jug"].description,
			descriptionLong : MagicItemsList["alchemy jug"].descriptionLong,
			descriptionFull : MagicItemsList["alchemy jug"].descriptionFull
		}, true);
	};
	// Add the blue and orange jugs as choices
	AddFeatureChoice(MagicItemsList["alchemy jug"], false, "Blue (hot tea)", {
		name : "Alchemy Jug (Blue)",
		source : [["CM", 144]],
		description : MagicItemsList["alchemy jug"].description.replace("acid (8 fl oz), basic poison (1/2 fl oz)", "boiling hot tea (1 qt)"),
		descriptionLong : MagicItemsList["alchemy jug"].descriptionLong.replace("acid (8 fl. oz.), basic poison (1/2 fl. oz.)", "boiling hot tea (1 quart)"),
		descriptionFull : MagicItemsList["alchemy jug"].descriptionFull.replace(/\n8 ounces[\s\S]+/, 
			"\n4 gallons  \tBeer\t\t2 gallons  \tVinegar"+
			"\n1 quart   \tBoiling hot tea\t8 gallons  \tWater, fresh"+
			"\n1 gallon    \tHoney\t\t12 gallons\tWater, salt"+
			"\n2 gallons \tMayonnaise\t1 gallon    \tWine"+
			"\n1 quart   \tOil"
		)
	});
	AddFeatureChoice(MagicItemsList["alchemy jug"], false, "Orange (soy sauce)", {
		name : "Alchemy Jug (Orange)",
		source : [["CM", 144]],
		description : MagicItemsList["alchemy jug"].description.replace("acid (8 fl oz), basic poison (1/2 fl oz)", "soy sauce (1 gal)"),
		descriptionLong : MagicItemsList["alchemy jug"].descriptionLong.replace("acid (8 fl. oz.), basic poison (1/2 fl. oz.)", "soy sauce (1 gallon)"),
		descriptionFull : MagicItemsList["alchemy jug"].descriptionFull.replace(/\n8 ounces[\s\S]+/, 
			"\n4 gallons  \tBeer\t\t2 gallons  \tVinegar"+
			"\n1 gallon    \tHoney\t\t8 gallons  \tWater, fresh"+
			"\n2 gallons \tMayonnaise\t12 gallons\tWater, salt"+
			"\n1 quart   \tOil\t\t1 gallon    \tWine"+
			"\n1 gallon    \tSoy sauce"
		)
	});
};
MagicItemsList["gloves of soul catching"] = {
	name : "Gloves of Soul Catching",
	source : [["CM", 169]],
	type : "wondrous item",
	rarity : "legendary",	
	notLegalAL : true,
	attunement : true,
	description : "My Constitution increases to 20 while wearing these gloves. After hitting with an unarmed strike while wearing these gloves, I can deal an extra 2d10 force damage to target and regain an equal amount of HP. Alternatively, instead of regaining hit points in this way, you can choose to gain advantage on one attack roll, ability check, or saving throw you make before the end of your next turn.",
	descriptionFull : "Your Constitution score is 20 while you wear these gloves. This property of the gloves has no effect on you if your Constitution is already 20 or higher."+
	"\n   After making a successful unarmed strike while wearing these gloves, you can use the gloves to deal an extra 2d10 force damage to the target, and you regain a number of hit points equal to the force damage dealt. Alternatively, instead of regaining hit points in this way, you can choose to gain advantage on one attack roll, ability check, or saving throw you make before the end of your next turn.",
	scoresOverride : [0, 0, 20, 0, 0, 0],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*gloves)(?=.*soul)(?=.*catching).*$/i,
		name : "Gloves of Soul Catching",
		source : [["CM", 169]],
		description : "+2d10 force damage",
		selectNow : true
	}]
};
MagicItemsList["watchful helm"] = {
	name : "Watchful Helm",
	source : [["CM", 183]],
	type : "wondrous item",
	rarity : "very rare",	
	attunement : true,
	description : "While I wear this helm, I gain a +1 bonus to AC, remain aware of my surroundings even while asleep, and have advantage on Wisdom (Perception) checks that rely on sight. As a bonus action once per dawn, I can use it to cast See Invisibility.",
	descriptionFull : "While you wear this helm, you gain a +1 bonus to AC and remain aware of your surroundings even while you're asleep, and you have advantage on Wisdom (Perception) checks that rely on sight."+
	"\n   As a bonus action, you can cast the see invisibility spell from the helm. Once this property of the helm is used, it can't be used again until the next dawn.",
	weight : 1,
	extraAC : [{name : "Watchful Helm", mod : 1, magic : true, text : "I gain a +1 bonus to AC while attuned."}],
	extraLimitedFeatures : [{
		name : "Watchful Helm (See Invisibility)",
		usages : 1,
		recovery : "dawn"
	}],
	vision : [["Adv. on Perception checks that rely on sight", 0]],
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["see invisibility"],
		selection : ["see invisibility"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"see invisibility" : {
			time : "1 bns",
			changes : "Using the Watchful Helm, I can cast See Invisibility once per dawn as a bonus action instead of an action."
		}
	}
};
MagicItemsList["staff of fate"] = {
	name : "Staff of Fate",
	source : [["CM", 183]],
	type : "staff",
	rarity : "very rare",
	attunement : true,
	description : "This +3 crystal quarterstaff has 6 charges. If I use its last charge, I roll a d20. On a 10+ it regains 1d6 charges, but on a 9 or less it becomes nonmagical. As a bonus action, I can expend 1 charge to give myself or a creature I can see a d4 that can be added to a check, save, attack, or damage roll before my next turn starts.",
	descriptionFull : "This transparent crystal staff can be wielded as a magic quarterstaff that grants a +3 bonus to attack and damage rolls made with it."+
	"\n   " + toUni("Altered Outcome") + ". The staff has 6 charges. As a bonus action, you can expend 1 of the staff's charges to give yourself or one other creature that you can see a d4. The recipient can roll this d4 and add the number rolled to one ability check, attack roll, damage roll, or saving throw it makes before the start of your next turn. If this extra die is not used before then, it is lost."+
	"\n   If you expend the staff's last charge, roll a d20. On a roll of 9 or lower, the staff becomes a nonmagical quarterstaff that breaks the first time it scores a hit and deals damage. On a roll of 10 or higher, the staff regains 1d6 of its expended charges.",
	weight : 4,
	extraLimitedFeatures : [{
		name : "Staff of Fate (Alter Outcome)",
		usages : 6,
		recovery : "Special"
	}],
	action : [["bonus action", ""]],
	weaponOptions : [{
		baseWeapon : "quarterstaff",
		regExpSearch : /\bstaff of fate\b/i,
		name : "Staff of Fate",
		source : [["CM", 183]],
		modifiers : [3, 3],
		selectNow : true
	}]
};
var CM_NetherScrollOfAzumar = "After 30 days of studying 8 h/day, I make a DC 25 Int (Arcana) check. If failed, I take 16d10 psychic damage and start anew. On a success, I gain +2 Int to a max of 22, I gain advantage on saves against spells and magical effects, and a stone golem appears within 60 ft that acts as ally. If I die, the golem turns to dust.";
MagicItemsList["nether scroll of azumar"] = {
	name : "Nether Scroll of Azumar",
	source : [["CM", 210]],
	type : "scroll",
	rarity : "legendary",
	storyItemAL : true,
	choicesNotInMenu : true,
	description : CM_NetherScrollOfAzumar,
	descriptionFull : "Unlike most scrolls, a Nether Scroll of Azumar is not a consumable magic item. It takes 30 days of concentrated study\u2014at least 8 hours per day\u2014to attempt to understand this scroll. After completing this study, you must make a DC 25 Intelligence (Arcana) check. If this check fails, you take 16d10 psychic damage, and you can attempt the check again after another 30 days of concentrated study."+
	"\n   When you succeed on the check, you gain the following benefits:"+
	"\n   \u2022 Your Intelligence score increases by 2, to a maximum of 22. Once you gain this benefit, you can't use this scroll to increase your Intelligence again."+
	"\n   \u2022 You gain advantage on saving throws against spells and other magical effects."+
	"\n\n   When you gain the scroll's benefits, a stone golem magically appears in an unoccupied space within 60 feet of you and acts as your ally. If you die, the golem turns to dust.",
	choices : ["Not Read", "Read"],
	"not read" : {
		description : CM_NetherScrollOfAzumar
	},
	"read" : { // contains contributions by Nod_Hero
		description : CM_NetherScrollOfAzumar,
		eval : function() {
			var src = "Nether Scroll of Azumar";
			MagicItemsList["manual of bodily health"].applyStatBonus(src, "Intelligence", 2);
			SetProf("savetxt", true, { adv_vs : ["magic"] }, src);
		},
		creaturesAdd : [["Stone Golem", "stop"]]
	}
};

// pub_20210518_VRGtR.js
// This file adds all the player-material from Van Richten's Guide to Ravenloft to MPMB's Character Record Sheet

// Define the source
SourceList.VRGtR = {
	name : "Van Richten's Guide to Ravenloft",
	abbreviation : "VRGtR",
	group : "Campaign Sourcebooks",
	campaignSetting : "Ravenloft",
	url : "https://dnd.wizards.com/products/van-richtens-guide-ravenloft",
	date : "2021/05/18"
};

// Races
RaceList["dhampir"] = {
	regExpSearch : /dhampir/i,
	name : "Dhampir",
	source : [["VRGtR", 17]],
	plural : "Dhampirs",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	scoresGeneric : true,
	trait : "Dhampir" + (typePF ? "\n " : "\t") +
	"\u2022 Deathless Nature: I don't need to breathe." +
	"\n \u2022 Spider Climb: Climbing speed equal to walking speed. At 3rd level, I can move up, down, and across vertical surfaces and upside down along ceilings, while leaving my hands free." +
	"\n \u2022 Vampiric Bite: Uses Constitution and has adv. on the attack roll if I'm at or below half HP. My Proficiency Bonus per long rest, when I hit a creature other than a construct or undead, I can empower myself. I either regain HP or gain a bonus on my next ability check or attack roll. The bonus is equal to the piercing damage dealt.",
	features : {
		"spider climb" : { // So it doesn't interfere with inherited speeds by useFromPreviousRace
			name : "Spider Climb",
			minlevel : 1,
			speed : { climb : { spd : "walk", enc : "walk" } }
		}
	},
	vision : [["Darkvision", 60]],
	weaponOptions : [{
		regExpSearch : /^(?=.*vampiric)(?=.*bite).*$/i,
		name : "Vampiric Bite",
		source : [["VRGtR", 17]],
		ability : 3,
		type : "Simple",
		damage : [1, 4, "piercing"],
		range : "Melee",
		description : "Adv. while at or below half HP; Can empower myself on hit",
		isAlwaysProf : true,
		abilitytodamage : true,
		monkweapon : true,
		selectNow : true
	}],
	extraLimitedFeatures : [{
		name : "Vampiric Bite",
		additional : "empower myself",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus')",
		recovery : "long rest"
	}],
	useFromPreviousRace : {
		message : "If you replace a race with the Dhampir lineage, you can keep the following elements of that race:"+
		desc(["its size,",
		"any skill proficiencies you gained from it,",
		"any climbing, flying, or swimming speed you gained from it, and",
		"any languages it knows."], "\n   \u2022 ")+
		"\n\nIf you don't keep any of those elements or you choose this lineage at character creation, you instead:"+
		desc(["are size Medium or Small (your choice),",
		"gain proficiency in two skills of your choice, and",
		"can speak, read, and write Common and one other language that you and your DM agree is appropriate."], "\n   \u2022 "),
		defaultTraits : {
			size : [3, 4],
			skillstxt : "Choose any two skills"
		},
		gainTraits : ["size", "age", "height", "weight", "heightMetric", "weightMetric", "languageProfs", "skillstxt", "skills", "speed.climb", "speed.fly", "speed.swim"],
		updateName : "prefix" // e.g. "Hill Dwarf Dhampir"
	}
};
RaceList["hexblood"] = {
	regExpSearch : /hexblood/i,
	name : "Hexblood",
	source : [["VRGtR", 18]],
	plural : "Hexbloods",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	scoresGeneric : true,
	trait : "Hexblood" + (typePF ? "\n " : "\t") +
	"\u2022 Fey: My creature type is fey, rather than humanoid." +
	"\n \u2022 Eerie Token: As a bonus action once per long rest, I can harmlessly remove a lock of my hair, one of my nails or teeth and imbue this token with magic until I finish a long rest. While the token is imbued in this way, I can telepathically speak to a creature holding it or see and hear around it. See the Notes page for more information." +
	"\n \u2022 Hex Magic: I known Disguise Self and Hex. I can cast each spell once per long rest without using a spell slot, or by using a spell slot as normal.",
	toNotesPage : [{
		name : "Hexblood's Eerie Token",
		note : ["As a bonus action, I can harmlessly remove a lock of my hair, one of my nails, or one of my teeth. This token is imbued with magic until I finish a long rest. While the token is imbued in this way, I can take these actions:"+
		"\n\u2022 Telepathic Message",
		"As an action, I can send a telepathic message to the creature holding or carrying the token, as long as I'm within 10 miles of it. The message can contain up to twenty-five words."+
		"\n\u2022 Remote Viewing",
		"If I'm within 10 miles of the token, I can enter a trance as an action. The trance lasts for 1 minute, but it ends early if I dismiss it (no action required) or I'm incapacitated. During this trance, I can see and hear from the token as if I were located where it is. While I'm using my senses at the token's location, I'm blinded and deafened in regard to my own surroundings. When the trance ends, the token is harmlessly destroyed.",
		"\nOnce I create a token using this feature, I can't do so again until I finish a long rest, at which point my missing part regrows."]
	}],
	vision : [["Darkvision", 60]],
	action : [["bonus action", "Eerie Token (create)"], ["action", "Eerie Token (use)"]],
	extraLimitedFeatures : [{
		name : "Eerie Token",
		usages : 1,
		recovery : "long rest"
	}],
	spellcastingAbility : [4, 5, 6],
	features : {
		"hex magic" : {
			name : "Hex Magic",
			minlevel : 1,
			spellcastingBonus : {
				name : "Hex Magic",
				spells : ["disguise self", "hex"],
				selection : ["disguise self", "hex"],
				firstCol : 'oncelr',
				times : 2,
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Disguise Self",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}, {
				name : "Hex",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}]
		}
	},
	useFromPreviousRace : {
		message : "If you replace a race with the Hexblood lineage, you can keep the following elements of that race:"+
		desc(["its size,",
		"any skill proficiencies you gained from it,",
		"any climbing, flying, or swimming speed you gained from it, and",
		"any languages it knows."], "\n   \u2022 ")+
		"\n\nIf you don't keep any of those elements or you choose this lineage at character creation, you instead:"+
		desc(["are size Medium or Small (your choice),",
		"gain proficiency in two skills of your choice, and",
		"can speak, read, and write Common and one other language that you and your DM agree is appropriate."], "\n   \u2022 "),
		defaultTraits : {
			size : [3, 4],
			skillstxt : "Choose any two skills"
		},
		gainTraits : ["size", "age", "height", "weight", "heightMetric", "weightMetric", "languageProfs", "skillstxt", "skills", "speed.climb", "speed.fly", "speed.swim"],
		updateName : "prefix" // e.g. "Tiefling Hexblood"
	}
};
RaceList["reborn"] = {
	regExpSearch : /reborn/i,
	name : "Reborn",
	source : [["VRGtR", 21]],
	plural : "Reborns",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	scoresGeneric : true,
	trait : "Reborn" +
	"\n \u2022 Deathless Nature: I don't need to sleep, eat, drink, or breathe. I have adv. on saves vs. disease, poison, and death saves. I have resistance to poison damage. Magic can't put me to sleep and I can finish a long rest in 4 hours if I spend it in an inactive, motionless state." +
	"\n \u2022 Knowledge from a Past Life: When I make an ability check that uses a skill, I can add +1d6 to the roll after seeing the d20 result. I can do this a number of times equal to my Proficiency Bonus and regain all expended uses when I finish a long rest.",
	dmgres : ["Poison"],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["disease", "poison", "death saves"],
	},
	extraLimitedFeatures : [{
		name : "Knowledge from a Past Life",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus')",
		recovery : "long rest"
	}],
	useFromPreviousRace : {
		message : "If you replace a race with the Reborn lineage, you can keep the following elements of that race:"+
		desc(["its size,",
		"any skill proficiencies you gained from it,",
		"any climbing, flying, or swimming speed you gained from it, and",
		"any languages it knows."], "\n   \u2022 ")+
		"\n\nIf you don't keep any of those elements or you choose this lineage at character creation, you instead:"+
		desc(["are size Medium or Small (your choice),",
		"gain proficiency in two skills of your choice, and",
		"can speak, read, and write Common and one other language that you and your DM agree is appropriate."], "\n   \u2022 "),
		defaultTraits : {
			size : [3, 4],
			skillstxt : "Choose any two skills"
		},
		gainTraits : ["size", "age", "height", "weight", "heightMetric", "weightMetric", "languageProfs", "skillstxt", "skills", "speed.climb", "speed.fly", "speed.swim"],
		updateName : "suffix" // e.g. "Reborn Human"
	}
};

// Subclasses
AddSubClass("bard", "college of spirits",{
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*spirits?).*$/i,
	subname : "College of Spirits",
	source : [["VRGtR", 28]],
	features : {
		"subclassfeature3" : {
			name : "Guiding Whispers",
			source : [["VRGtR", 28]],
			minlevel : 3,
			description : desc([
				"I learn the Guidance cantrip and can cast it with a range of 60 ft"
			]),
			spellcastingBonus : {
				name : "Guiding Whispers",
				spells : ["guidance"],
				selection : ["guidance"],
				firstCol : "atwill"
			},
			spellChanges : {
				"guidance" : {
					range : "60 ft",
					changes : "I can cast Guidance with a range of 60 ft."
				}
			}
		},
		"subclassfeature3.1" : {
			name : "Spiritual Focus",
			source : [["VRGtR", 28]],
			minlevel : 3,
			description : " [only for bard spells]" + desc([
				"I can use a candle, crystal ball, skull, spirit board, or tarokka deck as a spellcasting focus"
			])
		},
		"subclassfeature3.2" : {
			name : "Tales from Beyond",
			source : [["VRGtR", 28]],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can expend a bardic inspiration die to roll on the Spirit Tales table",
				"I retain the rolled tale in my mind until I bestow its effects or finish a short or long rest",
				"I can only retain one tale at a time; I need to hold a spiritual focus to roll on the table",
				"As an action, I can choose a creature I see in 30 ft or myself to bestow the tale's effect",
				"The tales use my spell save DC; See the Notes page for the Spirit Tales table"
			]),
			action : [["bonus action", " (roll on table)"], ["action", " (use effect)"]],
			toNotesPage : [{
				name : "Spirit Tales Table",
				note : desc([
					"As a bonus action while I'm holding my spiritual focus, I can reach out to spirits who tell their tales through me. I expend one use of my Bardic Inspiration and roll on the table below using my Bardic Inspiration die to determine the tale. I retain the tale in mind until I bestow the tale's effect or finish a short or long rest.",
					"I can retain only one of these tales in mind at a time, and rolling on the table immediately ends the effect of the previous tale.",
					"As an action, I can choose myself or one creature I can see within 30 ft to be the target of the tale's effect. If the tale requires a saving throw, the DC equals my spell save DC.",
					"\nRoll " + (typePF ? "" : " ") + "Tale"
				])+
				 desc([
					"  1    Tale of the Clever Animal: For the next 10 minutes, whenever the target makes an Intelligence, a Wisdom, or a Charisma check, the target can roll my Bardic Inspiration die immediately after rolling the d20 and add it to the check.",
					"  2    Tale of the Renowned Duelist: I make a melee spell attack against the target. On a hit, the target takes force damage equal to two rolls of my Bardic Inspiration die + my Charisma modifier.",
					"  3    Tale of the Beloved Friends: The target and another creature of its choice it can see within 5 ft of it gains temporary hit points equal to a roll of my Bardic Inspiration die + my Charisma modifier.",
					"  4    Tale of the Runaway: The target can immediately use its reaction to teleport up to 30 ft to an unoccupied space it can see. When the target teleports, it can choose a number of creatures it can see within 30 ft of it up to my Charisma modifier (minimum of 0) to immediately use the same reaction.",
					"  5    Tale of the Avenger: For 1 minute, any creature that hits the target with a melee attack takes force damage equal to a roll of my Bardic Inspiration die.",
					"  6    Tale of the Traveler: The target gains temporary hit points equal to a roll of my Bardic Inspiration die + my bard level. While it has these temporary hit points, the target's walking speed increases by 10 ft and it gains a +1 bonus to its AC.",
					"  7    Tale of the Beguiler: The target must succeed on a Wisdom saving throw or take psychic damage equal to two rolls of my Bardic Inspiration die, and the target is incapacitated until the end of its next turn.",
					"  8    Tale of the Phantom: The target becomes invisible until the end of its next turn or until it hits a creature with an attack. If the target hits a creature with an attack during this invisibility, the creature it hits takes necrotic damage equal to a roll of my Bardic Inspiration die and is frightened of the target until the end of the frightened creature's next turn.",
					"  9    Tale of the Brute: Each creature of the target's choice it can see within 30 ft of it must make a Strength saving throw. On a failed save, a creature takes thunder damage equal to three rolls of my Bardic Inspiration die and is knocked prone. A creature that succeeds on its saving throw takes half as much damage and isn't knocked prone.",
					" 10    Tale of the Dragon: The target spews fire from the mouth in a 30-ft cone. Each creature in that area must make a Dexterity saving throw, taking fire damage equal to four rolls of my Bardic Inspiration die on a failed save, or half as much damage on a successful one.",
					" 11    Tale of the Angel: The target regains hit points equal to two rolls of my Bardic Inspiration die + my Charisma modifier, and I end one condition from the following list affecting the target: blinded, deafened, paralyzed, petrified, or poisoned.",
					" 12    Tale of the Mind-Bender: I evoke an incomprehensible fable from an otherworldly being. The target must succeed on an Intelligence saving throw or take psychic damage equal to three rolls of my Bardic Inspiration die and be stunned until the end of its next turn."
				], "\n")
			}]
		},
		"subclassfeature6" : {
			name : "Spiritual Focus: Improve spells",
			source : [["VRGtR", 28]],
			minlevel : 6,
			description : desc([
				"While holding a spiritual focus, I can add 1d6 to one damage or healing roll of bard spells"
			]),
			calcChanges : {
				atkAdd : [
					function (fields, v, output) {
						if (v.thisWeapon[3] && SpellsList[v.thisWeapon[3]] && v.thisWeapon[4].indexOf("bard") !== -1) {
							// If RAW is selected, first test if this spell is eligible to use with a spellcasting focus
							var isRAW = GetFeatureChoice("classes", "bard", "subclassfeature6") === "raw: only +1d6 for spells with non-costly material components";
							var spellObj = SpellsList[v.thisWeapon[3]];
							if (isRAW && (!spellObj.components || !/\bM\b/.test(spellObj.components) || /M\u0192|M\u2020/.test(spellObj.components))) return;
							fields.Damage_Die = fields.Damage_Die.replace(/D/g, 'd');
							var d6Regex = /(\d+)d6/;
							if (fields.Damage_Die.indexOf('Bd6') != -1) {
								fields.Damage_Die = fields.Damage_Die.replace('Bd6', 'Cd6');
							} else if (fields.Damage_Die.indexOf('Cd6') != -1) {
								fields.Damage_Die = fields.Damage_Die.replace('Cd6', 'Qd6');
							} else if (d6Regex.test(fields.Damage_Die)) {
								fields.Damage_Die = fields.Damage_Die.replace(d6Regex, Number(fields.Damage_Die.replace(d6Regex, '$1')) + 1 + 'd6');
							} else if (v.thisWeapon[3] == "eldritch blast") {
								fields.Description += (fields.Description ? '; ' : '') + "One ray +1d6 dmg";
							} else {
								fields.Damage_Die += '+1d6';
							}
						}
					},
					'When I cast a bard spell, I can use my spiritual focus to add 1d6 to one damage roll or roll to restore hit points.\n   Going by rules as written (RAW), the spiritual focus has to be used as a spellcasting focus for this bonus to be added. This means that it can only be used on spells with a non-costly material component. Most DMs will forgo this technicality and that is why this sheet will add the 1d6 to any damage/healing spell by default. You can enable to use the stricter rules as written with the "Choose Feature" button on the second page.',
					1
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						// Do not process if a psionic, not a bard spell, or, if RAW is selected, not eligible to use with a spellcasting focus
						var isRAW = GetFeatureChoice("classes", "bard", "subclassfeature6") === "raw: only +1d6 for spells with non-costly material components";
						if (spellObj.psionic || spName !== "bard" || (isRAW && (!spellObj.components || !/\bM\b/.test(spellObj.components) || /M\u0192|M\u2020/.test(spellObj.components)))) return;
						if (genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", "1d6", true, true) || genericSpellDmgEdit(spellKey, spellObj, "heal", "1d6", true, true)) {
							return true;
						}
					},
					'When I cast a bard spell, I can use my spiritual focus to add 1d6 to one damage roll or roll to restore hit points.\n   Going by rules as written (RAW), the spiritual focus has to be used as a spellcasting focus for this bonus to be added. This means that it can only be used on spells with a non-costly material component. Most DMs will forgo this technicality and that is why this sheet will add the 1d6 to any damage/healing spell by default. You can enable to use the stricter rules as written with the "Choose Feature" button on the second page.'
				]
			},
			choices : ["RAW: only +1d6 for spells with non-costly material components", "Allow +1d6 for any bard spell"],
			"raw: only +1d6 for spells with non-costly material components" : {
				name : "Spiritual Focus: Improve spells",
				description : desc([
					"If I use a spiritual focus to cast a bard spell, I can add 1d6 to one damage or healing roll"
				])
			},
			"allow +1d6 for any bard spell" : {
				name : "Spiritual Focus: Improve spells",
				description : desc([
					"While holding a spiritual focus, I can add 1d6 to one damage or healing roll of bard spells"
				])
			},
			defaultChoice : "allow +1d6 for any bard spell"
		},
		"subclassfeature6.1" : {
			name : "Spirit Session",
			source : [["VRGtR", 29]],
			minlevel : 6,
			description : desc([
				"Using my spiritual focus, I can conduct a hour-long ritual to channel spirit during a rest",
				"The number of willing participants, me included, can be up to my Proficiency Bonus",
				"At the end, I learn a divination or necromancy spell of my choice until I start a long rest",
				"The spell can't be higher level than the number of participants and of a level I can cast"
			]),
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Spirit Session",
				school : ["Div", "Necro"],
				firstCol : "SS"
			}
		},
		"subclassfeature14" : {
			name : "Mystical Connection",
			source : [["VRGtR", 29]],
			minlevel : 14,
			description : desc([
				"For Tales from Beyond, I now roll my bardic inspiration die twice and " + (typePF ? "choose" : "select") + " which to use",
				"If I roll the same number on both dice, I can instead choose any effect on the table"
			])
		}
	}
});
AddSubClass("warlock", "the undead",{
	regExpSearch : /^(?=.*undead)(?=.*warlock).*$/i,
	subname : "the Undead",
	source : [["VRGtR", 30]],
	spellcastingExtra : ["bane", "false life", "blindness/deafness", "phantasmal force", "phantom steed", "speak with dead", "death ward", "greater invisibility", "antilife shell", "cloudkill"],
	features : {
		"subclassfeature1" : {
			name : "Form of Dread",
			source : [["VRGtR", 30]],
			minlevel : 1,
			description : desc([
				"As a bonus action, I can transform for 1 minute and gain the following benefits:",
				" \u2022 I gain temporary hit points equal to 1d10 + my warlock level",
				" \u2022 I am immune to the frightened condition",
				" \u2022 Once per turns when I hit an attack, I can force the target to make a Wis save",
				"   If the target fails this save, it is frightened of me until the end of my next turn"
			]),
			additional : levels.map(function (n) {
				return "1d10+" + n + " temp HP";
			}),
			usages : "Prof Bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			action : [["bonus action", ""]],
			savetxt : { immune : ["frightened (Form of Dread)"] }
		},
		"subclassfeature6" : {
			name : "Grave Touched",
			source : [["VRGtR", 30]],
			minlevel : 6,
			description : desc([
				"I no longer need to eat, drink, or breathe",
				"Once per turn if I damage a creature with an attack, I can change its type to necrotic",
				"While I'm in my Form of Dread, I can roll one extra damage die for this necrotic damage"
			])
		},
		"subclassfeature10" : {
			name : "Necrotic Husk",
			source : [["VRGtR", 31]],
			minlevel : 10,
			description : desc([
				"I have resistance to necrotic damage, or immunity while I'm in my Form of Dread",
				"As a reaction when reduced to 0 HP, I can drop to 1 HP instead and erupt with energy",
				"Each creature of my choice within 30 ft takes 2d10 + my warlock level necrotic damage",
				"After this, I gain 1 level of exhaustion and must complete 1d4 long rests to do so again"
			]),
			additional : levels.map(function (n) {
				return n < 10 ? "" : "2d10+" + n + " damage, 1\xD7 per 1d4 long rests"
			}),
			action : [["reaction", ""]],
			dmgres : [["Necrotic"]],
			savetxt : { immune : ["necrotic (Form of Dread)"] },
			extraLimitedFeatures : [{
				name : "Necrotic Husk (revive)",
				usages : 1,
				recovery : "1d4 LR"
			}]
		},
		"subclassfeature14" : {
			name : "Spirit Projection",
			source : [["VRGtR", 31]],
			minlevel : 14,
			description : desc([
				"As an action, I can project my spirit from my body, leaving it suspended and unconscious",
				"This lasts 1 hour or until my concentration is broken; Damage and effects affect both",
				"When it ends, I can have my spirit return to my body or my body teleport to my spirit",
				"My spirit has my abilities, but no gear; While projecting I gain the following benefits:",
				" \u2022 My spirit and body gain resistance to bludgeoning, piercing, and slashing damage",
				" \u2022 My conjuration/necromancy spells need no verbal, somatic, non-costly material comp.",
				" \u2022 I gain a flying speed equal to my walking speed and can hover",
				" \u2022 Move through creatures/objects as difficult terrain; 1d10 force damage if end turn in",
				" \u2022 While in my Form of Dread, once per turns when I deal necrotic damage, I can heal",
				"   I regain hit points equal to half the amount of necrotic damage dealt"
			]),
			usages : 1,
			recovery : "long rest",
			action : [["action", ""]]
		}
	}
});

// Backgrounds and Background Features
BackgroundFeatureList["inheritor"] = {
	description : "I'm the clear inheritor of a famed legacy, my ancestor or mentor. I've inherited a token that marks me as their inheritor. Revealing my legacy lets me swiftly learn the local opinion of my predecessor, if they heard of it. As rumors spread swiftly, locals will consider me either a hero or a threat. Heroes are welcomed, while threats are encouraged to leave.",
	source : [["VRGtR", 31], ["ALbackground", 0]]
};
BackgroundFeatureList["mist wanderer"] = {
	description : "The Mists whisper to me and guide me through. I immediately know if an object I'm touching is a Mist talisman, a nonmagical object that resonates with the domain where it originated, allowing the creature holding it to find a path to that domain. I recognize where the talisman originates from if I have been to its domain of origin.",
	source : [["VRGtR", 31], ["ALbackground", 0]]
};
BackgroundFeatureList["spirit medium"] = {
	description : "A fateful experience made me believe I'm aligned with spirits and can serve as a conduit for their insights and goals. I have advantage on Arcana and Religion check to remember or research information about spirits and the afterlife. I have and am proficient with a device I made for communing with otherworldly forces (e.g. a spirit-board or tarokka deck).",
	source : [["VRGtR", 31], ["ALbackground", 0]]
};
BackgroundFeatureList["trauma survivor"] = {
	description : "I faced something specifically traumatic and survived. Now people view me as an expert on it and can help others make it through. I'm aware of nonmagical recovery techniques, common resources, and misinformation. I know how to speak to sympathetic doctors, clergy, and leaders to can convince them to shelter one other than myself up to one month.",
	source : [["VRGtR", 32], ["ALbackground", 0]]
};
BackgroundFeatureList["traveler"] = {
	description : "I come from another place that others couldn't begin to understand. I can find a spot to hide, rest, or recuperate among sympathetic trading caravans, itinerant families, or displaced groups, so long as I present no visible danger. Such groups will hide me, but won't risk their lives for me. I can tell if an object I can see and touch is from my homeland.",
	source : [["VRGtR", 32], ["ALbackground", 0]]
};
BackgroundList["haunted one"] = { // Reprint from Curse of Strahd, but re-define because of new "horror" background traits options
	regExpSearch : /haunted.one/i,
	name : "Haunted One",
	source : [["CoS", 209], ["VRGtR", 34], ["ALbackground", 0]],
	skillstxt : "Choose two from Arcana, Investigation, Religion, and Survival",
	languageProfs : [2],
	gold : 0.01,
	equipleft : [
		["Chest, with:", "", 25],
		["Crowbar", "", 5],
		["Hammer", "", 3],
		["Wooden Stakes", 3, 1],
		["Holy symbol", "", 1],
		["Holy water, flasks of", "", 1],
		["Manacles", "", 6],
		["Steel Mirror", "", 0.5],
		["Oil, flasks of", "", 1],
		["Tinderbox", "", 1],
		["Torch", 3, 1]
	],
	equipright : [
		["Common clothes", "", 3],
		["Trinket of special significance", "", ""]
	],
	feature : "Heart of Darkness",
	trait : [
		"I don't run from evil. Evil runs from me.",
		"I like to read and memorize poetry. It keeps me calm and brings me fleeting moments of happiness.",
		"I spend money freely and live life to the fullest, knowing that tomorrow I might die.",
		"I live for the thrill of the hunt.",
		"I don't talk about the thing that torments me. I'd rather not burden others with my curse.",
		"I expect danger around every corner.",
		"I refuse to become a victim, and I will not allow others to be victimized.",
		"I put no trust in divine beings.",
		"I had an encounter that I believe gives me a special affinity with a supernatural creature or event.",
		"A signature piece of clothing or distinct weapon serves as an emblem of who I am.",
		"I never accept that I'm out of my depth.",
		"I must know the answer to every secret. No door remains unopened in my presence.",
		"I let people underestimate me, revealing my full competency only to those close to me.",
		"I compulsively seek to collect trophies of my travels and victories.",
		"It doesn't matter if the whole world's against me. I'll always do what I think is right.",
		"I have morbid interests and a macabre aesthetic.",
		"I have a personal ritual, mantra, or relaxation method I use to deal with stress.",
		"Nothing is more important than life, and I never leave anyone in danger.",
		"I'm quick to jump to extreme solutions. Why risk a lesser option not working?",
		"I'm easily startled, but I'm not a coward."
	],
	ideal : [
		["Sacrifice", "Sacrifice: I try to help those in need, no matter what the personal cost. (Good)"],
		["Desperation", "Desperation: I'll stop the spirits that haunt me or die trying. (Any)"],
		["Cleansing", "Cleansing: I kill monsters to make the world a safer place, and to exorcise my own demons. (Good)"],
		["Vigilante", "Vigilante: I have a dark calling that puts me above the law. (Chaotic)"],
		["Preparation", "Preparation: I like to know my enemy's capabilities and weaknesses before rushing into battle. (Lawful)"],
		["Destruction", "Destruction: I'm a monster that destroys other monsters, and anything else that gets in my way. (Evil)"],
		["Adrenaline", "Adrenaline: I've experienced such strangeness that now I feel alive only in extreme situations."],
		["Balance", "Balance: I strive to counter the deeds of someone for whom I feel responsible."],
		["Bound", "Bound: I've wronged someone and must work their will to avoid their curse."],
		["Escape", "Escape: I believe there is something beyond the world I know, and I need to find it."],
		["Legacy", "Legacy: I must do something great so that I'm remembered, and my time is running out."],
		["Misdirection", "Misdirection: I work vigorously to keep others from realizing my flaws or misdeeds."],
		["Obsession", "Obsession: I've lived this way for so long that I can't imagine another way."],
		["Obligation", "Obligation: I owe it to my people, faith, family, or teacher to continue a vaunted legacy."],
		["Promise", "Promise: My life is no longer my own. I must fulfill the dream of someone who's gone."],
		["Revelation", "Revelation: I need to know what lies beyond the mysteries of death, the world, or the Mists."],
		["Sanctuary", "Sanctuary: I know the forces at work in the world and strive to create islands apart from them."],
		["Truth", "Truth: I care about the truth above all else, even if it doesn't benefit anyone."]
	],
	bond : [
		"I keep my thoughts and discoveries in a journal. My journal is my legacy.",
		"I would sacrifice my life and my soul to protect the innocent.",
		"My torment drove away the person I love. I strive to win back the love I've lost.",
		"A terrible guilt consumes me. I hope that I can find redemption through my actions.",
		"There's evil in me, I can feel it. It must never be set free.",
		"I have a child to protect. I must make the world a safer place for him (or her).",
		"I desperately need to get back to someone or someplace, but I lost them in the Mists.",
		"Everything I do is in the service of a powerful master, one I must keep a secret from everyone.",
		"I owe much to my vanished mentor. I seek to continue their work even as I search to find them.",
		"I've seen great darkness, and I'm committed to being a light against it\u2014the light of all lights.",
		"Someone I love has become a monster, murderer, or other threat. It's up to me to redeem them.",
		"The world has been convinced of a terrible lie. It's up to me to reveal the truth.",
		"I deeply miss someone and am quick to adopt people who remind me of them.",
		"A great evil dwells within me. I will fight against it and the world's other evils for as long as I can.",
		"I'm desperately seeking a cure to an affliction or a curse, either for someone close to me for myself.",
		"Spirits are drawn to me. I do all I can to help them find peace.",
		"I use my cunning mind to solve mysteries and find justice for those who've been wronged.",
		"I lost someone I care about, but I still see them in guilty visions, recurring dreams, or as a spirit."
	],
	flaw : [
		"I have certain rituals that I must follow every day. I can never break them.",
		"I assume the worst in people.",
		"I feel no compassion for the dead. They're the lucky ones.",
		"I have an addiction.",
		"I am a purveyor of doom and gloom who lives in a world without hope.",
		"I talk to spirits that no one else can see.",
		"I believe doom follows me and that anyone who gets close to me will face a tragic end.",
		"I'm convinced something is after me, appearing in mirrors, dreams, and places where no one could.",
		"I'm especially superstitious and live life seeking to avoid bad luck, wicked spirits, or the Mists.",
		"I've done unspeakable evil and will do anything to prevent others from finding out.",
		"I am exceptionally credulous and believe any story or legend immediately.",
		"I'm a skeptic and don't believe in the power of rituals, religion, superstition, or spirits.",
		"I know my future is written and that anything I do will lead to a prophesied end.",
		"I need to find the best in everyone and everything, even when that means denying obvious malice.",
		"I've seen the evil of a type of place\u2014like forests, cities, or graveyards\u2014and resist going there.",
		"I'm exceptionally cautious, planning laboriously and devising countless contingencies.",
		"I have a reputation for defeating a great evil, but that's a lie and the wicked force knows.",
		"I know the ends always justify the means and am quick to make sacrifices to attain my goals."
	],
	extra : [
		"Select a Harrowing Event",
		"Monster spared my life",
		"Born under a dark star",
		"Haunted by an apparition",
		"Dark arts in the family",
		"An oni took my sibling",
		"Memory of cured lycanthropy",
		"Raised by a hag",
		"Studied an eldritch tome",
		"Formerly possessed by a fiend",
		"Avenged a murder"
	]
};
BackgroundList["investigator-vrgtr"] = {
	regExpSearch : /^((?=.*investigator)(?=.*(VRGtR|Richten|Ravenloft))|private eye).*$/i,
	name : "Investigator (VRGtR)",
	source : [["VRGtR", 35], ["ALbackground", 0]],
	skillstxt : "Choose two from Insight, Investigation, and Perception",
	toolProfs : [["Disguise kit", 1], ["Thieves' tools", "Dex"]],
	gold : 10,
	equipleft : [
		["Magnifying glass", "", ""],
		["Evidence from a past case (horror trinket)", "", ""],
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Official Inquiry",
	trait : [
		"I had an encounter that I believe gives me a special affinity with a supernatural creature or event.",
		"A signature piece of clothing or distinct weapon serves as an emblem of who I am.",
		"I never accept that I'm out of my depth.",
		"I must know the answer to every secret. No door remains unopened in my presence.",
		"I let people underestimate me, revealing my full competency only to those close to me.",
		"I compulsively seek to collect trophies of my travels and victories.",
		"It doesn't matter if the whole world's against me. I'll always do what I think is right.",
		"I have morbid interests and a macabre aesthetic.",
		"I have a personal ritual, mantra, or relaxation method I use to deal with stress.",
		"Nothing is more important than life, and I never leave anyone in danger.",
		"I'm quick to jump to extreme solutions. Why risk a lesser option not working?",
		"I'm easily startled, but I'm not a coward."
	],
	ideal : [
		["Adrenaline", "Adrenaline: I've experienced such strangeness that now I feel alive only in extreme situations."],
		["Balance", "Balance: I strive to counter the deeds of someone for whom I feel responsible."],
		["Bound", "Bound: I've wronged someone and must work their will to avoid their curse."],
		["Escape", "Escape: I believe there is something beyond the world I know, and I need to find it."],
		["Legacy", "Legacy: I must do something great so that I'm remembered, and my time is running out."],
		["Misdirection", "Misdirection: I work vigorously to keep others from realizing my flaws or misdeeds."],
		["Obsession", "Obsession: I've lived this way for so long that I can't imagine another way."],
		["Obligation", "Obligation: I owe it to my people, faith, family, or teacher to continue a vaunted legacy."],
		["Promise", "Promise: My life is no longer my own. I must fulfill the dream of someone who's gone."],
		["Revelation", "Revelation: I need to know what lies beyond the mysteries of death, the world, or the Mists."],
		["Sanctuary", "Sanctuary: I know the forces at work in the world and strive to create islands apart from them."],
		["Truth", "Truth: I care about the truth above all else, even if it doesn't benefit anyone."]
	],
	bond : [
		"I desperately need to get back to someone or someplace, but I lost them in the Mists.",
		"Everything I do is in the service of a powerful master, one I must keep a secret from everyone.",
		"I owe much to my vanished mentor. I seek to continue their work even as I search to find them.",
		"I've seen great darkness, and I'm committed to being a light against it\u2014the light of all lights.",
		"Someone I love has become a monster, murderer, or other threat. It's up to me to redeem them.",
		"The world has been convinced of a terrible lie. It's up to me to reveal the truth.",
		"I deeply miss someone and am quick to adopt people who remind me of them.",
		"A great evil dwells within me. I will fight against it and the world's other evils for as long as I can.",
		"I'm desperately seeking a cure to an affliction or a curse, either for someone close to me for myself.",
		"Spirits are drawn to me. I do all I can to help them find peace.",
		"I use my cunning mind to solve mysteries and find justice for those who've been wronged.",
		"I lost someone I care about, but I still see them in guilty visions, recurring dreams, or as a spirit."
	],
	flaw : [
		"I believe doom follows me and that anyone who gets close to me will face a tragic end.",
		"I'm convinced something is after me, appearing in mirrors, dreams, and places where no one could.",
		"I'm especially superstitious and live life seeking to avoid bad luck, wicked spirits, or the Mists.",
		"I've done unspeakable evil and will do anything to prevent others from finding out.",
		"I am exceptionally credulous and believe any story or legend immediately.",
		"I'm a skeptic and don't believe in the power of rituals, religion, superstition, or spirits.",
		"I know my future is written and that anything I do will lead to a prophesied end.",
		"I need to find the best in everyone and everything, even when that means denying obvious malice.",
		"I've seen the evil of a type of place\u2014like forests, cities, or graveyards\u2014and resist going there.",
		"I'm exceptionally cautious, planning laboriously and devising countless contingencies.",
		"I have a reputation for defeating a great evil, but that's a lie and the wicked force knows.",
		"I know the ends always justify the means and am quick to make sacrifices to attain my goals."
	],
	extra : [
		"Select a Path to Mystery",
		"Proved friend's innocence",
		"My memory loss",
		"Helped spirit find peace",
		"Uncovered magical hoax",
		"Fugitive after wrongful convicion",
		"Tracking supernatural phenomena",
		"Tried to expose mysterious cabal",
		"Investigate unsolved crimes"
	]
};
BackgroundFeatureList["official inquiry"] = {
	description : "Through a combination of fast-talking, determination, and official-looking documentation, I can gain access to a place or an individual related to a crime I'm investigating. Those who aren't involved in my investigation avoid impeding me or pass along my requests. Local law enforcement has firm opinions, viewing me as either a nuisance or one of their own.",
	source : [["VRGtR", 35], ["ALbackground", 0]]
};

// Magic Items
MagicItemsList["harkon's bite"] = {
	name : "Harkon's Bite",
	source : [["VRGtR", 137]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	description : "This necklace with a dire wolf tooth gives me a +1 on checks and saves. Curse: I can't remove it once I'm attuned to it. If I don or remove the necklace, even if I'm not attuned, I'm afflicted with werewolf lycanthropy (MM 211). This lasts until the dawn after the next full moon, unless I'm still wearing the necklace at dawn.",
	descriptionFull : "A dire wolf tooth dangles from this simple cord necklace. While you wear it, the necklace grants you a +1 bonus to ability checks and saving throws."+
	"\n   " + toUni("Curse") + ". Attuning to Harkon's Bite curses you until either Harkon Lukas removes the necklace from you or you are targeted by a remove curse spell or similar magic. As long as you remain cursed, you cannot remove the necklace."+
	"\n   Upon donning or removing the necklace, whether you are attuned to it or not, you are afflicted with werewolf lycanthropy as detailed in the Monster Manual. The curse lasts until the dawn after the next full moon. If you are still wearing the necklace at this time, you are afflicted with the lycanthropy again.",
	addMod : [
		{ type : "save", field : "all", mod : 1, text : "I gain a +1 bonus on all my saving throws." },
		{ type : "skill", field : "all", mod : 1, text : "I gain a +1 bonus on all my ability checks." },
		{ type : "skill", field : "Init", mod : 1, text : "I gain a +1 bonus on all my ability checks." }
	]
}
var VRGtR_nepentheFullDescription = [
	"You gain a +3 bonus to attack and damage rolls made with this magic weapon. When you hit a fiend or an undead with it, that creature takes an extra 2d10 radiant damage.",
	"While you hold the drawn sword, it creates an aura in a 10-foot radius around you. You and all creatures friendly to you in the aura have advantage on saving throws against spells and other magical effects. If you have 17 or more levels in the paladin class, the radius of the aura increases to 30 feet.",
	">>Sentience<<. Nepenthe is a sentient, neutral evil weapon with an Intelligence of 10, a Wisdom of 8, and a Charisma of 18. It has hearing and darkvision out to a range of 60 feet. It can read and understand Elvish. It can also speak Elvish, but only through the voice of its wielder, with whom the sword can communicate telepathically.",
	">>Personality<<. In its lifetime, the sword has beheaded thousands of criminals, not all of whom were guilty of the crimes for which they were convicted. The sword cannot distinguish the guilty from the innocent. With each beheading, it hungers for more justice and blood. The sword is corrupt and irredeemable."
]
MagicItemsList["nepenthe"] = {
	name : "Nepenthe",
	source : [["VRGtR", 137]],
	type : "weapon (any sword)",
	rarity : "legendary",
	magicItemTable : "I",
	attunement : true,
	prerequisite : "Requires attunement by a paladin",
	prereqeval : function (v) { return classes.known.paladin ? true : false; },
	description : "This sentient holy avenger longsword gives me a +3 bonus to attack and damage rolls. It does +2d10 radiant damage against fiends and undead. While holding the drawn sword, I have a 10-ft radius aura (30-ft if level 17 paladin) that grants me and my allies adv. on saves against spells and magical effects.",
	descriptionFull : VRGtR_nepentheFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : desc(VRGtR_nepentheFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/(to|around) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /nepenthe/i,
		name : "Nepenthe",
		source : [["VRGtR", 137]],
		description : "Versatile (1d10); +2d10 radiant damage vs. fiends and undead",
		modifiers : [3, 3],
		selectNow : true
	}],
	savetxt : { adv_vs : ["spells", "magical effects"] },
	choices : ["Paladin level 1-16 (10-ft aura)", "Paladin level 17+ (30-ft aura)"],
	selfChoosing : function () {
		return !classes.known.paladin ? "" : classes.known.paladin.level < 17 ? "paladin level 1-16 (10-ft aura)" : "paladin level 17+ (30-ft aura)";
	},
	"paladin level 1-16 (10-ft aura)" : {
		name : "Nepenthe\u200A",
		description : "This sentient holy avenger longsword gives me a +3 bonus to attack and damage rolls made with it. It does +2d10 radiant damage against fiends and undead. While holding the drawn sword, I have a 10-ft radius aura that grants me and my allies advantage on saving throws against spells and magical effects."
	},
	"paladin level 17+ (30-ft aura)" : {
		name : "Nepenthe\u200A\u200A",
		description : "This sentient holy avenger longsword gives me a +3 bonus to attack and damage rolls made with it. It does +2d10 radiant damage against fiends and undead. While holding the drawn sword, I have a 30-ft radius aura that grants me and my allies advantage on saving throws against spells and magical effects."
	}
}

/* Dark gift

MagicItemsList["living shadow"] = {
	name : "Living Shadow",
	source : [["VRGtR", 24]],
	type : "dark gift",
	rarity : "",
	description : "I learn the Mage Hand cantrip and require no components to cast it. My Prof Bonus per long rest, I can gain +10 ft reach for one melee attack. The first time I roll a 1 on a d20 after a short rest, my shadow will act up. The next time I or another I can see in 30 ft rolls a d20, I roll a d4. If even: add to roll, odd: subtract.",
	descriptionLong : "I learn the Mage Hand cantrip and require no components to cast it. The hand created by the spell is shadowy but is not bound to your actual shadow. My proficiency bonus per long rest, when I make a melee attack, I can gain +10 ft reach for that attack as my shadow stretches and delivers the attack. The first time after a short rest when I roll a 1 on an attack, check, or save, my shadow will act up. The next time I or a creature I can see within 30 ft rolls for an attack, check, or save, roll a d4. If the number is odd, reduce the total by that number. If it is even, increase the total by that number instead.",
	descriptionFull : "The shadow you cast is animate and ever-present, even when lighting conditions would otherwise prevent it. Your shadow occasionally moves out of sync with you. Sometimes it appears to be undertaking random but mundane tasks, while at other times it acts out your darker impulses, threatening or even attacking other shadows. With effort, you can bend this shadow puppetry to your will.\n"+
	toUni("Grasping Shadow") + ". You learn the mage hand cantrip if you don't already know it, and require no components to cast it. The hand created by the spell is shadowy but is not bound to your actual shadow. Your spellcasting ability for this spell is Intelligence, Wisdom, or Charisma (your choice when you gain this Dark Gift).\n"+
	toUni("Shadow Strike") + ". When you make a melee attack roll, you can increase your reach for that attack by 10 feet. Your shadow stretches and delivers the attack as if it were you. You can use this feature a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.\n"+
	toUni("Ominous Will") + ". Immediately after you make an attack roll, an ability check, or a saving throw and roll a 1 on the d20, your shadow exerts a will of its own and might assist or hinder you or those around you. The next time you or a creature within 30 feet of you that you can see makes an attack roll, an ability check, or a saving throw, roll a d4. If the number is odd, reduce the total by the number rolled. If the number is even, increase the total by the number rolled. Once this effect occurs, it can't happen again until you finish a short or long rest.",
	action : [["action", "Unsettling Presence"]],
	extraLimitedFeatures : [{
		name : "Shadow Strike",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus')",
		recovery : "long rest"
	}, {
		name : "Ominous Will",
		usages : 1,
		recovery : "short rest"
	}],
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Grasping Shadow",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : "atwill"
	},
	spellChanges : {
		"mage hand" : {
			components : "",
			changes : "Using Grasping Shadow from my Living Shadow dark gift, I can cast Mage Hand without any components. The hand created by the spell is shadowy but is not bound to my actual shadow."
		}
	}
};
FeatsList["living shadow"] = MagicItemsList["living shadow"];

*/
// pub_20210921_WBtW.js
// This file adds the content from The Wild Beyond the Witchlight adventure to MPMB's Character Record Sheet

SourceList.WBtW = {
	name : "The Wild Beyond the Witchlight",
	abbreviation : "WBtW",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/wild-beyond-witchlight",
	date : "2021/09/21"
};

// Backgrounds
BackgroundList["feylost"] = {
	regExpSearch : /feylost/i,
	name : "Feylost",
	source : [["WBtW", 9], ["ALbackground", 0]],
	skills : ["Deception", "Survival"],
	toolProfs : [["Musical instrument", 1]],
	languageProfs : [["Elvish, Gnomish, Goblin, or Sylvan", 1]],
	gold : 8,
	equipleft : [
		["Musical instrument of my choice", "", ""],
		["Three Feywild trinkets", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Feywild Connection",
	trait : [
		"I'm haunted by fey laughter that only I can hear, though I know it's just my mind playing tricks on me.",
		"Like a nomad, I can't settle down in one place for very long.",
		"Good music makes me weep like a baby.",
		"Wherever I go, I try to bring a little of the warmth and tranquility of home with me.",
		"I have never lost my childlike sense of wonder.",
		"When I have a new idea, I get wildly excited about it until I come up with another, better idea.",
		"I live by my own set of weird and wonderful rules.",
		"I can't bring myself to trust most adults."
	],
	ideal : [
		["Friendship", "Friendship: I never leave a friend behind. (Good)"],
		["Empathy", "Empathy: No creature should be made to suffer. (Good)"],
		["Wanderlust", "Wanderlust: I prefer to take the less traveled path. (Chaotic)"],
		["Changeability", "Changeability: Change is good, which is why I live by an ever-changing set of rules. (Chaotic)"],
		["Honor", "Honor: A deal is a deal, and I would never break one. (Lawful)"],
		["Rule of Three", 'Rule of Three: Everything in the multiverse happens in threes. I see the "rule of three" everywhere. (Lawful)'],
		["Obsession", "Obsession: I won't let go of a grudge. (Evil)"],
		["Greed", "Greed: I will do whatever it takes to get what I want, regardless of the harm it might cause. (Evil)"]
	],
	bond : [
		"I would never break my word.",
		"I find magic in all its forms to be compelling. The more magical a place, the more I am drawn to it.",
		"I do what I can to protect the natural world.",
		"A trusted friend is the most important thing in the multiverse to me.",
		"I can't bring myself to harm a Fey creature, either because I consider myself one or because I fear the repercussions.",
		"The Witchlight Carnival feels like home to me.",
		"I'm drawn to the Feywild and long to return there, if only for a short while.",
		"I feel indebted to Mister Witch and Mister Light for giving me a home and a purpose."
	],
	flaw : [
		"I easily lose track of time. My poor sense of time means I'm always late.",
		"I think the whole multiverse is out to get me.",
		"I'm always operating under a tight timeline, and I'm obsessed with keeping everything on schedule.",
		"I'm a kleptomaniac who covets shiny, sparkling treasure.",
		"I'm forgetful. Sometimes I can't remember even the simplest things.",
		"I never give away anything for free and always expect something in return.",
		"I have many vices and tend to indulge them.",
		"I'm always changing my mind\u2014well, almost always."
	],
	extra : [
		"Select a Fey Mark",
		"Iridescent color eyes",
		"Sweet scent",
		"Long whiskers",
		"Furry ears",
		"Skin sparkles in moonlight",
		"Flowers bloom in my presence",
		"Flowers wilt in my presence",
		"Vines for hair",
		"Brambles for hair",
		"Tail"
	],
	toNotesPage : [{
		name : "Feywild Visitor",
		note : [
			"Whenever I'm sound asleep or in a deep trance during a long rest, a spirit of the Feywild might pay me a visit, if the DM wishes it. Determine the spirit's form by rolling on the table below. No harm ever comes to me as a result of such visits, which can last for minutes or hours, and I remember each visit when I wake up. Conversations that occur with a visitor can contain any number of things, from messages and insights to nonsense and red herrings, at the DM's discretion. Such conversations are always conducted in a language I can understand, even if the Feywild visitor can't speak that language normally.\n",
			"d8\tVisitor",
			" 1\tAwakened creature (beast or plant that had the Awaken spell cast on it)",
			" 2\tCentaur",
			" 3\tDryad",
			" 4\tFaerie dragon",
			" 5\tPixie",
			" 6\tSatyr",
			" 7\tSprite",
			" 8\tUnicorn"
		]
	}]
};
BackgroundFeatureList["feywild connection"] = {
	description : "My mannerisms and knowledge of fey customs are recognized by natives of the Feywild, who see me as one of their own. Because of this, friendly Fey creatures are inclined to come to my aid if I am lost or need help in the Feywild.",
	source : [["WBtW", 11], ["ALbackground", 0]]
};
BackgroundList["witchlight hand"] = {
	regExpSearch : /^(?=.*(witchlight|carnival))(?=.*hand).*$/i,
	name : "Witchlight Hand",
	source : [["WBtW", 11], ["ALbackground", 0]],
	skills : ["Performance", "Sleight of Hand"],
	toolProfs : [["Disguise kit or Musical instrument", 1]],
	languageProfs : [1],
	gold : 8,
	equipleft : [
		["Disguise kit or Musical instrument", "", ""],
		["Deck of cards", "", ""],
		["Feywild trinket", "", ""]
	],
	equipright : [
		["Carnival uniform or Costume", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Carnival Fixture",
	trait : BackgroundList["feylost"].trait,
	ideal : BackgroundList["feylost"].ideal,
	bond : BackgroundList["feylost"].bond,
	flaw : BackgroundList["feylost"].flaw,
	extra : [
		"Select Carnival Companion",
		"Old, cantankerous Witchlight hand",
		"Young, impressionable Witchlight hand",
		"Performer",
		"Retired performer",
		"Seasoned animal trainer",
		"Old blink dog",
		"Your hair is made of vines or brambles and grows back to normal length within 1 hour of being cut.",
		"You have a tail like that of a dog or another animal."
	]
};
BackgroundFeatureList["carnival fixture"] = {
	description : "The Witchlight Carnival provides me with free, modest lodging and food. In addition, I may wander about the carnival and partake of its many wonders at no cost to me, provided I don't disrupt its shows or cause any other trouble.",
	source : [["WBtW", 11], ["ALbackground", 0]]
};

// Races
RaceList["fairy"] = {
	regExpSearch : /fairy/i,
	name : "Fairy",
	source : [["WBtW", 12], ["MotM", 14]],
	plural : "Fairies",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 },
		fly : { spd : "walk", enc : 0 }
	},
	scoresGeneric : true,
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Fairy Magic",
		spells : ["druidcraft"],
		selection : ["druidcraft"],
		firstCol : "atwill"
	},
	features : {
		"fairy magic (level 3)" : {
			name : "Fairy Magic (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Fairy Magic (level 3)",
				spells : ["faerie fire"],
				selection : ["faerie fire"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Faerie Fire",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}]
		},
		"fairy magic (level 5)" : {
			name : "Fairy Magic (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Fairy Magic (level 5)",
				spells : ["enlarge/reduce"],
				selection : ["enlarge/reduce"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Enlarge/Reduce",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}]
		}
	},
	trait : "Fairy"+
		(typePF ? "\n \u2022 Fey: My " : " (") + "creature type is fey, rather than humanoid" + (typePF ? "." : ")") +
		"\n \u2022 Flight: I have a flying speed equal to my walking speed. To use this speed, I can't be wearing medium or heavy armor."+
		"\n \u2022 Fairy Magic: I know the Druidcraft cantrip. At 3rd level, I can cast Faerie Fire. At 5th level, I can cast Enlarge/Reduce. I can cast each spell without using a spell slot once per long rest, as well as by using spell slots as normal. Intelligence, Wisdom, or Charisma is my spellcasting ability for these (one-time choice)."
};
RaceList["harengon"] = {
	regExpSearch : /harengon/i,
	name : "Harengon",
	source : [["WBtW", 13], ["MotM", 22]],
	plural : "Harengons",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 },
	},
	skills : ["Perception"],
	addMod : [{ type : "skill", field : "Init", mod : "Prof", text : "I can add my proficiency bonus to my initiative rolls." }],
	scoresGeneric : true,
	action : [["reaction", "Lucky Footwork"], ["bonus action", "Rabbit Hop"]],
	features : {
		"rabbit hop" : {
			name : "Rabbit Hop",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) {
				var hopDistance = n * 5 + ' ft';
				return What("Unit System") === "metric" ? ConvertToMetric(hopDistance) : hopDistance;
			})
		}
	},
	trait : "Harengon"+
		"\n \u2022 Hare-Trigger: I can add my proficiency bonus to my initiative rolls."+
		"\n \u2022 Leporine Senses: I have proficiency in the Perception skill."+
		"\n \u2022 Lucky Footwork: As a reaction when I fail a Dexterity saving throw, I can add +1d4 to the result, potentially making it a success. I can't do this if I'm prone or my speed is 0."+
		"\n \u2022 Rabbit Hop: As a bonus action if my speed isn't 0, I can jump 5 ft times my Prof Bonus without provoking opportunity attacks. I can do this my Prof Bonus times per long rest."
};

// Magic Items
var WBtW_Sentient_Item_toNotes = function (sDescr, skipConflict) {
	var theR = desc(sDescr).replace(/\bf(oo|ee)t\b/ig, "ft")
		.replace(/you are/ig, "I am").replace(/\byou\b/ig, "I")
		.replace(/(by|of|to|for) I\b|\bI to|\bI an?\b/ig, "$1 me")
		.replace(/\bI (to|a|an)\b/ig, "me $1")
		.replace(/your/g, "my").replace(/Your/g, "My")
		.replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); });
	return skipConflict ? theR : theR + "\n\n" + sentientItemConflictTxt
}
MagicItemsList["bobbing lily pad"] = {
	name : "Bobbing Lily Pad",
	source : [["WBtW", 208]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "This 10-ft diameter vehicle float on water and has a walking, flying, and swimming speed of 20 ft, and it can hover. While I ride it, it moves according to my spoken directions. The lily pad can transport up to 600 lb, but moves at only half speed when carrying more than 300 lb.",
	descriptionFull : "This magic vehicle is a 10-foot-diameter leaf that floats on water. It has tendrils that propel it across land and across the water's surface (but not underwater), as well as through the air. It has a walking, flying, and swimming speed of 20 feet, and it can hover. It moves according to your spoken directions while you are riding it."+
	"\n   The lily pad can transport up to 300 pounds without hindrance. It can carry up to twice this weight, but it moves at half speed if it carries more than its normal capacity.",
}
MagicItemsList["chromatic rose"] = {
	name : "Chromatic Rose",
	source : [["WBtW", 208]],
	type : "wondrous item",
	rarity : "rare",
	description : "While I hold this magic rose, it grants me resistance to a damage type determined by its color. If I would take 10+ damage from a single source (after resistance), the rose disintegrates and I take no damage. As an action, I can destroy it by blowing on its petals, causing a 20-ft cone that deals 3d10 damage.",
	descriptionFull : "This magic rose comes in one of five colors, as noted in the table below. While a rose is held, it gains a harmless visual effect as indicated on the table."+
	"\n   While holding the rose by its stem, you gain resistance to damage of the type associated with the rose's color. If you would take more than 10 damage of this type from a single source (after applying the resistance), the rose disintegrates, and you take no damage instead."+
	"\n   As an action, you can blow the petals from the rose to produce a 20-foot cone of acid, lightning, poisonous gas, fire, or cold, as dictated by the rose's damage type. Each creature in the cone must make a DC 15 Constitution saving throw, taking 3d10 damage of the appropriate type on a failed save, or half as much damage on a successful one. Using this property destroys the rose."+
	toUni("\n Color\tVisual Effect\tDamage Type")+
	"\n Black\tDrips acid\tAcid"+
	"\n Blue\tCrackles with lightning\tLightning"+
	"\n Green\tIssues green gas\tPoison"+
	"\n Red\tWreathed in fire\tFire"+
	"\n White\tCovered in frost\tCold",
	allowDuplicates : true,
	action : [["action", "Destroy Chromatic Rose for Cone"]],
	choices : ["Black (acid)", "Blue (lightning)", "Green (poison)", "Red (fire)", "White (cold)"],
	choicesNotInMenu : true,
	"black (acid)" : {
		name : "Black Chromatic Rose",
		description : "While I hold this acid dripping rose, it grants me acid resistance. If I would take more than 10 acid damage from a single source (after resistance), the rose disintegrates and I take no damage. As an action, I can destroy it by blowing on its petals, causing a 20-ft cone that deals 3d10 acid damage, Con DC 15 halves.",
		dmgres : ["Acid"]
	},
	"blue (lightning)" : {
		name : "Blue Chromatic Rose",
		description : "While I hold this magic rose, it grants me lightning resistance. If I would take more than 10 lightning damage from a single source (after resistance), the rose disintegrates and I take no damage. As an action, I can destroy it by blowing on its petals, causing a 20-ft cone that deals 3d10 lightning damage, Con DC 15 halves.",
		dmgres : ["Lightning"]
	},
	"green (poison)" : {
		name : "Green Chromatic Rose",
		description : "While I hold this magic rose, it grants me poison resistance. If I would take more than 10 poison damage from a single source (after resistance), the rose disintegrates and I take no damage. As an action, I can destroy it by blowing on its petals, causing a 20-ft cone that deals 3d10 poison damage, Con DC 15 halves.",
		dmgres : ["Poison"]
	},
	"red (fire)" : {
		name : "Red Chromatic Rose",
		description : "While I hold this magic rose, it grants me fire resistance. If I would take more than 10 fire damage from a single source (after resistance), the rose disintegrates and I take no damage instead. As an action, I can destroy it by blowing on its petals, causing a 20-ft cone that deals 3d10 fire damage, Con DC 15 halves.",
		dmgres : ["Fire"]
	},
	"white (cold)" : {
		name : "White Chromatic Rose",
		description : "While I hold this magic rose, it grants me cold resistance. If I would take more than 10 cold damage from a single source (after resistance), the rose disintegrates and I take no damage. As an action, I can destroy it by blowing on its petals, causing a 20-ft cone that deals 3d10 cold damage, Con DC 15 halves.",
		dmgres : ["Cold"]
	}
}
MagicItemsList["dust of corrosion"] = {
	name : "Dust of Corrosion",
	source : [["WBtW", 209]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "Once as an action, I can throw this dust in the air, affecting a 10-ft cube that extends from me. Objects made of nonmagical ferrous metal in the area corrode and turn to dust. Creatures in the area (partly) made out of ferrous metal take 4d8 necrotic damage and can make a DC 13 Con save to halve this damage.",
	descriptionFull : "As an action, you can throw this dust into the air, filling a 10-foot cube that extends out from you. Surfaces and objects made of nonmagical ferrous metal in the area instantly corrode and turn to dust, becoming useless and unsalvageable. Any creature in the area that is made wholly or partly out of ferrous metal must make a DC 13 Constitution saving throw, taking 4d8 necrotic damage on a failed save, or half as much damage on a successful one."+
	"\n   Found in a small packet, this dust is made from finely ground rust monster antennae. There is enough dust in each packet for one use.",
}
MagicItemsList["eldritch staff"] = {
	name : "Eldritch Staff",
	source : [["WBtW", 209]],
	type : "staff",
	rarity : "very rare",
	attunement : true,
	description : "This +1 quarterstaff has 10 charges, regaining 1d6+4 charges at dawn. 5% chance it's destroyed If I use its last charge. When I hit with it, I can deal +1d8 lightning damage per charge (max 3). As a reaction when I'm damaged, I can use 3 charges to teleport 60 ft and become invisible until my next turn starts, or I attack/cast.",
	descriptionLong : "This magic quarterstaff grants a +1 bonus to attack and damage rolls made with it. It has 10 charges and regains 1d6 + 4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff is destroyed in an otherwise harmless burst of eldritch energy. When I hit with it in melee, I can expend up to 3 charges, dealing +1d8 lightning damage per charge. As a reaction when I'm damaged while holding the staff, I can use 3 charges to become invisible and teleport 60 ft to an empty space I can see. I then remain invisible until the start of my next turn or until I attack, cast a spell, or deal damage.",
	descriptionFull : "This staff can be wielded as a magic quarterstaff that grants a +1 bonus to attack and damage rolls made with it."+
	"\n   The staff has 10 charges and regains 1d6 + 4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff is destroyed in an otherwise harmless burst of eldritch energy."+
	"\n   " + toUni("Eldritch Attack") + ". When you hit with a melee attack using the staff, you can expend up to 3 of its charges. For each charge you expend, the target takes an extra 1d8 lightning damage."+
	"\n   " + toUni("Eldritch Escape") + ". If you take damage while holding the staff, you can use your reaction to expend 3 of the staff's charges, whereupon you turn invisible and teleport yourself, along with any equipment you are wearing or carrying, up to 60 feet to an unoccupied space that you can see. You remain invisible until the start of your next turn or until you attack, cast a spell, or deal damage.",
	weight : 4,
	action : [["reaction", " (if damaged)"]],
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	weaponOptions : [{
		baseWeapon : "quarterstaff",
		regExpSearch : /eldritch staff/i,
		name : "Eldritch Staff",
		source : [["WBtW", 209]],
		description : "Versatile (1d8); On hit, +1d8 lightning damage per charge (max 3)",
		modifiers : [1, 1],
		selectNow : true
	}]
}
MagicItemsList["ornithopter of flying"] = {
	name : "Ornithopter of Flying",
	source : [["WBtW", 212]],
	type : "wondrous item",
	rarity : "very rare",
	description : "This contraption can lift up to 300 lb in the air. It has a flying speed of 30 ft and moves according to my spoken directions while I am riding it. It can't hover. If the ornithopter loses its rider while airborne, it falls and can't fly again for 1d6 + 4 days. It is 8 ft long, has a 14-ft wingspan, and weighs 25 lb.",
	descriptionFull : "You can use this contraption to fly, provided your weight (including whatever you are wearing or carrying) doesn't exceed 300 pounds. The ornithopter has a flying speed of 30 feet, and it moves according to your spoken directions while you are riding it. It can't hover. If the ornithopter loses its rider while airborne, it falls and can't fly again for 1d6 + 4 days."+
	"\n   The ornithopter is 8 feet long, has a 14-foot wingspan, and weighs 25 pounds.",
	weight : 25
}
MagicItemsList["pixie dust"] = {
	name : "Pixie Dust",
	source : [["WBtW", 212]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "Once as an action, I can sprinkle this dust on myself or another creature I can see within 5 ft. The recipient gains a flying speed of 30 ft and the ability to hover for 1 minute. If the creature is airborne when this effect ends, it falls safely to the ground, taking no damage and landing on its feet.",
	descriptionFull : "As an action, you can sprinkle this dust on yourself or another creature you can see within 5 feet of you. The recipient gains a flying speed of 30 feet and the ability to hover for 1 minute. If the creature is airborne when this effect ends, it falls safely to the ground, taking no damage and landing on its feet."+
	"\n   A small packet holds enough pixie dust for one use.",
}
MagicItemsList["potion of advantage"] = {
	name : "Potion of Advantage",
	source : [["WBtW", 212]],
	type : "potion",
	rarity : "uncommon",
	description : "Once as an action, I can drink this potion of a sparkling, golden mist that moves and pours like water or administer it to another. The consumer of the potion gains advantage on one ability check, attack roll, or saving throw of its choice that it makes within the next hour.",
	descriptionFull : "When you drink this potion, you gain advantage on one ability check, attack roll, or saving throw of your choice that you make within the next hour."+
	"\n   This potion takes the form of a sparkling, golden mist that moves and pours like water.",
}

var WBtW_Scissors_of_Shadow_Snipping_Full_Description = [
	"As an action, you make a few snips with these iron shears and cause the shadow of a Humanoid creature you can see within 5 feet of you to detach from its source. If the creature is unwilling to give up its shadow, it can make a DC 15 Charisma saving throw, retaining its shadow on a success. Whether or not the shadow is snipped, this property of the scissors can't be used again until the next dawn.",
	"The detached shadow is rooted to the spot where it was snipped until you use a bonus action to cause it to behave in one of the following ways, either of which is possible only if you can see the shadow:",
	"\u2022 You control the shadow's movements and can make the shadow move up to 30 feet across a solid or liquid surface, in any direction you choose (including along vertical surfaces), provided it remains within your sight at all times. The shadow is harmless and unable to be harmed, and it is invisible in darkness. It can't speak, and it doesn't require air, sleep, or nourishment.",
	"\u2022 You can relinquish control of the shadow, at which point it becomes autonomous and behaves as the DM wishes. It uses the shadow stat block in the Monster Manual, but its creature type is Fey instead of Undead. A creature whose Strength is reduced to 0 by this shadow's Strength Drain attack does not die but falls unconscious instead. The creature regains consciousness and all its Strength after finishing a short or long rest.",
	"A creature whose shadow has detached from it is cursed. If a shadowless creature is subjected to any spell that ends a curse, or if its detached shadow is reduced to 0 hit points, the detached shadow disappears, and the creature regains its normal shadow instantly."
];
MagicItemsList["scissors of shadow snipping"] = {
	name : "Scissors of Shadow Snipping",
	source : [["WBtW", 213]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a fey or a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; }, // no fey player races exist that don't have racial spellcasting
	description : "As an action once per dawn, I can use these iron shears to detach the shadow of a Humanoid I can see within 5 ft. An involuntary target can make a DC 15 Cha save to resist. The detached shadow stays where it was snipped until I use a bonus action to control it or set it free. See Notes page.",
	descriptionFull : WBtW_Scissors_of_Shadow_Snipping_Full_Description.join("\n   "),
	toNotesPage : [{
		name : "Features",
		note : WBtW_Sentient_Item_toNotes(WBtW_Scissors_of_Shadow_Snipping_Full_Description, true)
	}],
	action : [["action", " (snip)"], ["bonus action", " (control)"]],
	usages : 1,
	recovery : "dawn"
}
var WBtW_Snicker_Snack_Full_Description = [
	"You gain a +3 bonus to attack and damage rolls made with this magic vorpal sword. In addition, the weapon ignores resistance to slashing damage. When you use this weapon to attack a creature that has at least one head and roll a 20 on the attack roll, you cut off one of the creature's heads. The creature dies if it can't survive without the lost head. A creature is immune to this effect if it is immune to slashing damage, it doesn't have or need a head, it has legendary actions, or the DM decides that the creature is too big for its head to be cut off with this weapon. Such a creature instead takes an extra 6d8 slashing damage from the hit.",
	"While attuned to Snicker-Snack, you have proficiency with greatswords, and you can use your Charisma modifier instead of your Strength modifier for attack and damage rolls made with the weapon.",
	">>Sentience<<. Snicker-Snack is a sentient, chaotic good greatsword with an Intelligence of 9, a Wisdom of 14, and a Charisma of 18. It has hearing and darkvision out to a range of 120 feet. It can speak, read, and understand Common, and its voice sounds silvery and melodic. Snicker-Snack craves the destruction of evil Dragons and urges you to seek out these creatures and slay them.",
	">>Personality<<. Snicker-Snack has a fickle personality. It ends its attunement to you if you miss on attack rolls with the weapon three times in a row. Each time you finish a long rest after that happens, you can attempt to regain the sword's trust by making a contested Charisma check against Snicker-Snack. If you win the contest, your attunement to the weapon is instantly restored. Your attunement to the weapon can't be restored in any other way."
];
MagicItemsList["snicker-snack"] = {
	name : "Snicker-Snack",
	source : [["WBtW", 213]],
	type : "weapon (greatsword)",
	rarity : "legendary",
	attunement : true,
	prerequisite : "Requires attunement by a non-evil creature",
	prereqeval : function(v) { return !/evil/i.test(What("Alignment")); },
	description : "I have a +3 bonus on attack and damage rolls with this sentient magic greatsword and can use Cha instead of Str. It ignores slashing resistance. On a 20 to hit, it cuts off " + (typePF ? "a head" : "one head, possibly killing it instantly") + ". If the target has legendary actions, no head, too wide neck, or is immune to slashing damage, it takes +6d8 damage instead. See Notes.",
	descriptionFull : WBtW_Snicker_Snack_Full_Description.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	weight : 6,
	toNotesPage : [{
		name : "Features",
		note : WBtW_Sentient_Item_toNotes(WBtW_Snicker_Snack_Full_Description)
	}],
	weaponProfs : [false, false ["greatsword"]],
	weaponOptions : [{
		baseWeapon : "greatsword",
		regExpSearch : /snicker.snack/i,
		name : "Snicker-Snack",
		source : [["WBtW", 213]],
		description : "Heavy, two-handed; Ignores slashing resistance; On 20 to hit: cut off head",
		modifiers : [3, 3],
		isSnickerSnack : true,
		selectNow : true
	}],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.isSnickerSnack && fields.Mod === 1 && What('Cha') > What('Str')) {
					fields.Mod = 6;
				}
			},
			"I can use my Charisma modifier instead of my Strength modifier for attack and damage rolls made with Snicker-Snack."
		]
	}
}
var WBtW_Steel_Full_Description = [
	"You have a +2 bonus to attack and damage rolls made with this magic weapon.",
	">>Revivify<<. You can use an action to cast the revivify spell from the sword. You must touch the target with the sword to cast the spell. Once this property of the weapon is used, it can't be used again until the next dawn.",
	">>Sentience<<. Steel is a sentient, lawful good longsword with an Intelligence of 8, a Wisdom of 11, and a Charisma of 15. It can see and hear out to a range of 60 feet. The sword can speak, read, and understand Common and Draconic. It frets over your well-being while you are attuned to it, and it doesn't like to back down from a fight."
];
MagicItemsList["steel"] = {
	name : "Steel",
	source : [["WBtW", 214]],
	type : "weapon (longsword)",
	rarity : "very rare",
	attunement : true,
	prerequisite : "Requires attunement by a good-aligned creature",
	prereqeval : function(v) { return /good/i.test(What("Alignment")); },
	description : "This sentient longsword adds +2 to attack and damage rolls made with it. As an action once per dawn, I can use it to cast Revivify on a target I touch with the sword. Steel is lawful good and frets over my well-being and doesn't like to back down from a fight. It has Int 8, Wis 11, and Cha 15. See Notes page.",
	descriptionFull : WBtW_Steel_Full_Description.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	weight : 3,
	toNotesPage : [{
		name : "Features",
		note : WBtW_Sentient_Item_toNotes(WBtW_Steel_Full_Description)
	}],
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /['"]steel['"]/i,
		name : '"Steel"',
		source : [["WBtW", 214]],
		modifiers : [2, 2],
		selectNow : true
	}]
}
MagicItemsList["woodcutter's axe"] = {
	name : "Woodcutter's Axe",
	source : [["WBtW", 214]],
	type : "weapon (greataxe)",
	rarity : "rare",
	description : "I have a +1 bonus to attack and damage rolls made with this magic greataxe. When I use this axe to make an attack against a plant (an ordinary plant or a creature with the Plant type) or a wooden object that isn't being worn or carried, the attack deals an extra 2d6 slashing damage on a hit.",
	descriptionFull : "You have a +1 bonus to attack and damage rolls made with this magic weapon."+
	"\n   When you use this axe to make an attack against a plant (an ordinary plant or a creature with the Plant type) or a wooden object that isn't being worn or carried, the attack deals an extra 2d6 slashing damage on a hit.",
	weight : 7,
	weaponOptions : [{
		baseWeapon : "greataxe",
		regExpSearch : /^(?=.*woodcutter)(?=.*axe).*$/i,
		name : "Woodcutter's Axe",
		source : [["WBtW", 214]],
		description : "Heavy, two-handed; +2d6 damage vs. plants/wood",
		modifiers : [1, 1],
		selectNow : true
	}]
}
var WBtW_Witchlight_Vane_Full_Description = [
	"This ornate rod is topped by a pair of butterfly wings and incorporates bits of red glass into its length. It weighs 3 pounds.",
	">>Magic Weapon<<. In the hands of one who is attuned to it, the vane can be wielded as a magic mace that grants a +3 bonus to attack and damage rolls made with it. In addition, the vane deals an extra 1d8 radiant damage on a hit.",
	">>Sense Mood<<. While the vane is inside the perimeter of the Witchlight Carnival, it can sense the mood of every creature in the carnival that has an Intelligence of 4 or higher. As an action, a creature attuned to the vane can use it to pinpoint the location of the happiest creature in the carnival.",
	"The butterfly shape at the top of the vane spins slowly clockwise when spirits in the carnival are generally high; if the general mood in the carnival is dour, the top of the vane spins slowly counterclockwise.",
	">>Sentience<<. The vane is a sentient, chaotic good wondrous item with an Intelligence of 11, a Wisdom of 14, and a Charisma of 14. It has hearing and normal vision out to a range of 30 feet, and it communicates by transmitting emotion to the creature attuned to it. Its purpose is to make sure everyone in the Witchlight Carnival is having a good time.",
	">>Additional Properties<<. The vane has the following additional properties:",
	"\u2022 The creature holding the vane has vulnerability to lightning damage.",
	"\u2022 The creature attuned to the vane can't be blinded, deafened, petrified, or stunned.",
	"\u2022 While carrying the vane, the creature attuned to it can cast the dancing lights, polymorph, or ray of frost spell as an action, requiring no spell components and using Charisma as the spellcasting ability. After the vane's polymorph spell is cast, roll a d8; on a roll of 3 or 8, the vane can't be used to cast this spell again until the next dawn."
];
MagicItemsList["witchlight vane"] = {
	name : "Witchlight Vane",
	source : [["WBtW", 27]],
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	prerequisite : "Requires attunement by a mister light or his handpicked successor",
	description : "I can use this sentient ornate rod as a +3 mace that deals an extra 1d8 radiant damage on a hit. It can sense the mood of every creature in the carnival. As an action, I can pinpoint the happiest in the carnival. I can use it to cast spells. I can't be blinded, deafened, petrified, or stunned. See Notes page.",
	descriptionLong : "This sentient ornate rod is topped by a pair of butterfly wings and incorporates bits of red glass into its length. I can use it as a +3 mace that deals an extra 1d8 radiant damage on a hit. It can sense the mood of every creature in the carnival. As an action, I can use it to pinpoint the happiest in the carnival. I can use it to cast Dancing Light, Ray of Frost, and Polymorph. After I use it to cast Polymorph, roll a d8. On a roll of 3 or 8, the vane can't be used to cast Polymorph again until the next dawn. It makes me vulnerable to lightning damage, but I can't be blinded, deafened, petrified, or stunned. See Notes page.",
	descriptionFull : WBtW_Witchlight_Vane_Full_Description.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	weight : 3,
	toNotesPage : [{
		name : "Features",
		note : WBtW_Sentient_Item_toNotes(WBtW_Witchlight_Vane_Full_Description)
	}],
	action : [["action", " (find happiest)"]],
	weaponOptions : [{
		baseWeapon : "mace",
		regExpSearch : /^(?=.*witchlight)(?=.*vane).*$/i,
		name : "Witchlight Vane",
		source : [["WBtW", 27]],
		description : "+1d8 radiant damage",
		modifiers : [3, 3],
		selectNow : true
	}],
	extraLimitedFeatures : [{
		name : "Witchlight Vane [Polymorph] (25% chance use)",
		usages : 1,
		recovery : "dawn"
	}],
	spellcastingAbility : 6,
	spellcastingBonus : [{
		name : "At will",
		spells : ["dancing lights", "ray of frost"],
		selection : ["dancing lights", "ray of frost"],
		firstCol : "atwill"
	}, {
		name : "See Notes",
		spells : ["polymorph"],
		selection : ["polymorph"],
		firstCol : "SP"
	}],
	savetxt : {
		text : ["Vulnerable to lightning"],
		immune : ["blinded", "deafened", "petrified", "stunned"]
	}
}
var WBtW_Witchlight_Watch_Full_Description = [
	"This ornate pocket watch is fastened to the end of a gold chain. It glows with a faint golden light when opened, and it makes a soft ticking noise that can be heard only by the creature holding it. The face of the watch shows a miniature painting of the Witchlight Carnival ringed by a tiny henge, orbited at night by a mote of light small enough to slip through the eye of a needle. This light causes the henge to cast shadows, and these shadows allow the watch's owner to track the passage of time.",
	">>Carnival Setup and Takedown<<. The creature attuned to the watch can use an action to initiate the packing up or the unpacking of the Witchlight Carnival, provided the creature and the carnival are on the same plane of existence. In the span of 1 hour, all objects that are elements of the carnival are magically whisked about until everything is packed up and ready for travel, or unpacked and assembled. The watch has no effect on creatures, which can move about freely and safely while the carnival is being set up or taken down. Once the process of packing up or unpacking the carnival begins, it can't be stopped until the task is complete. When the watch is used to pack up or unpack the carnival, this property cannot be used again until 8 hours have elapsed.",
	">>Additional Properties<<. The pocket watch has the following additional properties:",
	"\u2022 While carrying the watch, the creature attuned to it can cast the fire bolt, invisibility, or message spell as an action, requiring no spell components and using Intelligence as the spellcasting ability. After the watch's invisibility spell is cast, roll a d8; on a roll of 3 or 8, the watch can't be used to cast this spell again until the next dawn.",
	"\u2022 The creature attuned to the watch gains 30 pounds. This extra weight vanishes when the attunement ends.",
	"\u2022 The creature attuned to the watch must eat and drink eight times the normal amount each day."
];
MagicItemsList["witchlight watch"] = {
	name : "Witchlight Watch",
	source : [["WBtW", 25]],
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	prerequisite : "Requires attunement by a mister witch or his handpicked successor",
	description : "As an action once per 8 hours, I can use this ornate pocket watch to initiate the (un)packing of the carnival over the next hour. I can use it to cast Fire Bolt, Message, and Invisibility. After it casts Invisibility, I roll a d8. On a roll of 3 or 8, I can't cast this again until the next dawn. See Notes page.",
	descriptionLong : "This ornate pocket watch is fastened to the end of a gold chain and glows with a faint golden light when opened. As an action once per 8 hours, I can use this ornate pocket watch to initiate the (un)packing of the carnival over the next hour, provided the carnival and I are on the same plane of existence. I can use it to cast Fire Bolt, Message, and Invisibility. After I use it to cast Invisibility, roll a d8. On a roll of 3 or 8, it can't be used to cast Invisibility again until the next dawn. As long as I'm attuned to it, I'm 30 lb heavier and must eat and drink eight times the normal amount each day. See Notes page.",
	descriptionFull : WBtW_Witchlight_Watch_Full_Description.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : WBtW_Sentient_Item_toNotes(WBtW_Witchlight_Watch_Full_Description, true)
	}],
	extraLimitedFeatures : [{
		name : "Witchlight Watch [initiate (un)packing]",
		usages : 1,
		recovery : "8 hrs"
	}, {
		name : "Witchlight Watch [Invisibility] (25% chance use)",
		usages : 1,
		recovery : "dawn"
	}],
	action : [["action", " [initiate (un)packing]"]],
	spellcastingAbility : 4,
	spellcastingBonus : [{
		name : "At will",
		spells : ["fire bolt", "message"],
		selection : ["fire bolt", "message"],
		firstCol : "atwill"
	}, {
		name : "See Notes",
		spells : ["invisibility"],
		selection : ["invisibility"],
		firstCol : "SP"
	}],
}
// Beasts
CreatureList["giant swan"] = { // a giant eagle except that it has no talons, can attack twice with its beak as an action, and speaks Common and Auran
	name : "Giant Swan",
	nameAlt : ["Swan, Giant"],
	source : [["WBtW", 38]],
	size : 2, //Large
	type : "Beast",
	alignment : "Neutral Good",
	ac : 13,
	hp : 26,
	hd : [4, 10],
	speed : "10 ft, fly 80 ft",
	scores : [16, 17, 13, 8, 14, 10],
	skills : {
		"perception" : 4
	},
	senses : "Adv. on Wis (Perception) checks using sight",
	passivePerception : 14,
	languages : "Common and Auran",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Beak",
		ability : 1,
		damage : [1, 6, "piercing"],
		range : "Melee (5 ft)",
		description : "Two beak attack as an Attack action"
	}],
	actions : [{
		name : "Multiattack",
		description : "The swan makes two beak attacks."
	}],
	traits : [{
		name : "Keen Sight",
		description : "The swan has advantage on Wisdom (Perception) checks that rely on sight."
	}]
}
CreatureList["giant dragonfly"] = {
	name : "Giant Dragonfly",
	nameAlt : ["Dragonfly, Giant"],
	source : [["WBtW", 234]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 16,
	hp : 22,
	hd : [4, 10],
	speed : "10 ft, fly 60 ft",
	scores : [15, 18, 11, 3, 10, 3],
	senses : "",
	passivePerception : 10,
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 6, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Drone",
		description : "When it beats its wings, the dragonfly emits a loud droning sound that can be heard out to a range of 120 ft."
	}],
	actions : [{
		name : "Uncanny Dodge",
		description : "As a reaction, the dragonfly can halve the damage it takes from an attack made against it, provided it can see the attacker."
	}]
}
CreatureList["giant snail"] = {
	name : "Giant Snail",
	nameAlt : ["Snail, Giant"],
	source : [["WBtW", 234]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 11,
	hp : 22,
	hd : [4, 10],
	speed : "10 ft, climb 10 ft",
	scores : [15, 3, 11, 3, 10, 3],
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Slam",
		ability : 1,
		damage : [1, 6, "bludgeoning"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Salt Osmosis",
		description : "Whenever the snail starts its turn in contact with a pound or more of salt, it takes 1d4 necrotic damage. Using an action to sprinkle a pound of salt on the snail deals 1d4 necrotic damage to it immediately and another 1d4 necrotic damage to it at the start of its next turn (after which the salt rubs off), provided the snail has not withdrawn into its shell."
	}],
	actions : [{
		name : "Shell Defense",
		description : "As an action, the snail withdraws into its shell, gaining a +4 bonus to its AC until it emerges. It can emerge from its shell as a bonus action on its turn."
	}]
}

// pub_20211019_FToD.js
// This file adds all the player-material from Fizban's Treasury of Dragons to MPMB's Character Record Sheet

// Define the source
SourceList.FToD = {
	name : "Fizban's Treasury of Dragons",
	abbreviation : "FToD",
	abbreviationSpellsheet : "FD",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/treasury-dragons",
	date : "2021/10/19"
};

// Races
var FToD_dragonborns_add = function () { // New dragonborn variants
	var objDragonborns = {
		Chromatic : {
			regExpSearch : /^(?=.*chromatic)(?=.*dragonborn).*$/i,
			source : [["FToD", 10]],
			variants : [["Black", "Acid"], ["Blue", "Lightning"], ["Green", "Poison"], ["Red", "Fire"], ["White", "Cold"]],
			breathWeaponShape : "5-ft by 30-ft line",
			trait : desc([
				">>TYPE<< Breath Weapon: When I take the Attack action on my turn, I can replace one attack with a breath weapon that deals 1d10 >>type<< damage to all in a 5-ft by 30-ft line, Dex save halves (DC 8 + Con mod + Proficiency Bonus). I can do this my Proficiency Bonus per long rest. The damage increases with +1d10 at 5th, 11th, and 17th level.",
				"Chromatic Warding: From 5th level, I can protect myself using my draconic energies. As an action once per long rest, I can become immune to >>type<< damage for 1 minute."
			], "\n \u2022 "),
			features : {
				"chromatic warding" : {
					name : "Chromatic Warding",
					source : [["FToD", 10]],
					minlevel : 5,
					usages : 1,
					recovery : "long rest",
					action : [["action", ""]]
				}
			}
		},
		Gem : {
			regExpSearch : /^(?=.*gem)(?=.*dragonborn).*$/i,
			source : [["FToD", 11]],
			variants : [["Amethyst", "Force"], ["Crystal", "Radiant"], ["Emerald", "Psychic"], ["Sapphire", "Thunder"], ["Topaz", "Necrotic"]],
			breathWeaponShape : "15-ft cone",
			trait : desc([
				">>TYPE<< Breath Weapon: When I take the Attack action on my turn, I can replace one attack with a breath weapon that deals 1d10 >>type<< damage to all in a 15-ft cone, Dex save halves (DC 8 + Con mod + Prof Bonus). I can do this my Prof" + (typePF ? "iciency" : ".") + " Bonus per long rest.",
				"Psionic Mind: " + (typePF ? "I can send telepathic messages to any creature I can see within 30 ft that understands at least one language." : "I can telepathically message a creature with a language I can see in 30 ft."),
				"Gem Flight: From 5th level, I can manifest spectral wings. As a bonus action once per long rest, I can gain, for 1 minute, a flying speed equal to my walking speed and can hover."
			], "\n \u2022 "),
			features : {
				"gem flight" : {
					name : "Gem Flight",
					source : [["FToD", 11]],
					minlevel : 5,
					usages : 1,
					recovery : "long rest",
					action : [["bonus action", ""]]
				}
			}
		},
		Metallic : {
			regExpSearch : /^(?=.*metallic)(?=.*dragonborn).*$/i,
			source : [["FToD", 12]],
			variants : [["Brass", "Fire"], ["Bronze", "Lightning"], ["Copper", "Acid"], ["Gold", "Fire"], ["Silver", "Cold"]],
			breathWeaponShape : "15-ft cone",
			trait : desc([
				">>TYPE<< Breath Weapon: When I take the Attack action on my turn, I can replace one attack with a breath weapon that deals 1d10 >>type<< damage to all in a 15-ft cone, Dex save halves (DC 8 + Con mod + Prof" + (typePF ? "iciency" : ".") + " Bonus). I can do this my Prof" + (typePF ? "iciency" : ".") + " Bonus per long rest.",
				"Metallic Breath Weapon: At 5th level I gain a second breath weapon once per long rest, that works just like the first, but I choose the effect when I use it: Enervating: Con save or incapacitated until my next turn starts. Repulsion: Str save or pushed 20 ft and prone."
			], "\n \u2022 "),
			features : {
				"metallic breath weapon" : {
					name : "Metallic Breath Weapon",
					source : [["FToD", 12]],
					minlevel : 5,
					usages : 1,
					recovery : "long rest",
					weaponOptions : [{
						regExpSearch : /^(?=.*metallic)(?=.*breath)(?=.*weapon).*$/i,
						name : "Metallic breath weapon",
						source : [["FToD", 12]],
						ability : 3,
						type : 'Natural',
						damage : ['Enervating', '', 'or Repulsion'],
						range : "15-ft cone",
						description : "Repulsion: Str save or pushed 20 ft \u0026 prone; Enervating: Con save or incapacitated till my next turn starts",
						abilitytodamage : false,
						dc : true,
						selectNow : true
					}]
				}
			}
		}
	}
	for (var sDrBrn in objDragonborns) {
		var sDrBrnLC = sDrBrn.toLowerCase();
		var oDrBrn = objDragonborns[sDrBrn];
		RaceList[sDrBrnLC + " dragonborn"] = {
			regExpSearch : oDrBrn.regExpSearch,
			name : sDrBrn + " Dragonborn",
			sortname : "Dragonborn, " + sDrBrn,
			source : oDrBrn.source,
			plural : sDrBrn + " Dragonborn",
			size : 3,
			speed : {
				walk : { spd : 30, enc : 20 }
			},
			weaponOptions : [{
				regExpSearch : /^(?=.*breath)(?=.*weapon).*$/i,
				name : "Breath weapon",
				source : oDrBrn.source,
				ability : 3,
				type : 'Natural',
				damage : ['C', 10, 'fire'],
				range : oDrBrn.breathWeaponShape.replace('by', '\xD7'),
				description : "Hits all in area; Dex save, success - half damage",
				abilitytodamage : false,
				dc : true,
				dbBreathWeapon : true,
				selectNow : true
			}],
			age : " reach adulthood by 15 and live around 80 years",
			height : " stand well over 6 feet tall (5'6\" + 2d8\")",
			weight : " weigh around 240 lb (175 + 2d8 \xD7 2d6 lb)",
			heightMetric : " stand well over 1,8 metres tall (170 + 5d8 cm)",
			weightMetric : " weigh around 110 kg (80 + 5d8 \xD7 4d6 / 10 kg)",
			scoresGeneric : true,
			trait : sDrBrn + " Dragonborn"+
				"\n \u2022 " + sDrBrn + ' Ancestry: Choose a type of dragon using the "Racial Options" button. The damage type of my resistance and my breath weapon are determined by the dragon type chosen.'+
				+ oDrBrn.trait.replace(/>>type<< /ig, ""),
			features : {
				"breath weapon" : {
					name : "Breath Weapon",
					minlevel : 1,
					usages : "Proficiency bonus per ",
					usagescalc : "event.value = How('Proficiency Bonus');",
					recovery : "long rest",
					additional : levels.map(function (n) {
						return (n < 5 ? 1 : n < 11 ? 2 : n < 17 ? 3 : 4) + 'd10';
					}),
					calcChanges : {
						atkAdd : [
							function (fields, v) {
								if (v.theWea.dbBreathWeapon && (/dragonborn/i).test(CurrentRace.known) && CurrentRace.variant) {
									fields.Damage_Type = CurrentRace.dmgres[0];
								}
							},
							'',
							1
						]
					}
				}
			},
			variants : []
		};
		if (oDrBrn.features) {
			for (var sFea in oDrBrn.features) {
				RaceList[sDrBrnLC + " dragonborn"].features[sFea] = oDrBrn.features[sFea];
			}
		}
		for (var i = 0; i < oDrBrn.variants.length; i++) {
			var sDrBrnVar = oDrBrn.variants[i][0];
			var sDrBrnDmg = oDrBrn.variants[i][1];
			AddRacialVariant(sDrBrnLC + " dragonborn", sDrBrnVar.toLowerCase(), {
				regExpSearch : RegExp(sDrBrnVar, "i"),
				name : sDrBrnVar + " " + sDrBrnLC + " dragonborn",
				trait : sDrBrnVar + " " + sDrBrnLC + " dragonborn"+
					oDrBrn.trait.replace(/>>TYPE<</g, sDrBrnDmg).replace(/>>type<</g, sDrBrnDmg.toLowerCase()),
				dmgres : [sDrBrnDmg]
			});
		}
	}
}();

// Subclasses
AddSubClass("monk", "ascendant dragon", {
	regExpSearch : /^(?=.*ascendant)(?=.*(dragon|draconic))((?=.*(monk|monastic))|((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior))).*$/i,
	subname : "Way of the Ascendant Dragon",
	source : [["FToD", 13]],
	features : {
		"subclassfeature3" : {
			name : "Draconic Disciple",
			source : [["FToD", 13]],
			minlevel : 3,
			description : desc([
				"I learn to speak, read, and write Draconic or one other language of my choice",
				"I can change the damage type of my unarmed strikes to acid, cold, fire, lightning, poison",
				"As a reaction when I fail an Intimidation or Persuasion check, I can reroll the check",
				"If this reroll turns the check into a success, I can't do so again until I finish a long rest"
			]),
			languageProfs : [["Draconic or other", 1]],
			action : [["reaction", " (reroll check)"]],
			usages : 1,
			recovery : "long rest",
			additional : "reroll",
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.baseWeaponName === "unarmed strike") {
							fields.Description += (fields.Description ? '; ' : '') + "Change type to acid/cold/fire/lightning/poison";
						};
					},
					"When I damage a target with an unarmed strike, I can change the damage type to acid, cold, fire, lightning or poison."
				]
			},
			"breath of the dragon" : {
				name : "Breath of the Dragon",
				extraname : "Ascendant Dragon 3",
				source : [["FToD", 13]],
				description : levels.map(function (n) {
					var iMonkDie = n < 5 ? 4 : n < 11 ? 6 : n < 17 ? 8 : 10;;
					var aDesc = [
						"When I take the Attack action on my turn, I can replace one attack with a breath weapon",
						"This deals " + (n < 11 ? 2 : 3) + "d" + iMonkDie + " acid, cold, fire, lightning, or poison (my choice) damage to all in the area",
						"The area can be a 20-ft cone or a 5-ft wide, 30-ft line; Dex save to halve the damage",
						"I can do this my Proficiency Bonus times per long rest, or by expending 2 ki points"
					];
					if (n < 17) return desc(aDesc);
					var aDesc17 = [
						"From 17th-level, I can expend 1 (extra) ki point when I use this feature to augment it",
						"The damage increases to 4d" + iMonkDie + " and the area to a 60-ft cone or a 5-ft wide, 90-ft line"
					];
					return desc(aDesc.concat(aDesc17));
				}),
				usages : "Prof B. per ",
				usagescalc : "event.value = How('Proficiency Bonus');",
				recovery : "long rest",
				altResource : "2 ki",
				additional : levels.map(function (n) {
					return n < 3 ? "" : (n < 11 ? 2 : 3) + "d" + (n < 5 ? 4 : n < 11 ? 6 : n < 17 ? 8 : 10);
				}),
				weaponOptions : [{
					regExpSearch : /^(?=.*breath)(?=.*dragon).*$/i,
					name : "Breath of the Dragon",
					source : [["FToD", 13]],
					ability : 5,
					type : "Natural",
					damage : [2, 4, "My choice"],
					range : "5-ft \xD7 30-ft line",
					description : "All in area; Dex save for half damage; Alt: 20-ft cone; Type: acid/cold/fire/lightning/poison",
					dc : true,
					monkweapon : false,
					abilitytodamage : false,
					WotAD_BreathWeapon : true,
					selectNow : true
				}],
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (classes.known.monk && classes.known.monk.level && v.theWea.WotAD_BreathWeapon) {
								var n = classes.known.monk.level;
								var aMonkDie = n < 5 ? 4 : n < 11 ? 6 : n < 17 ? 8 : 10;;
								fields.Damage_Die = (v.theWea.WotAD_BreathWeaponAugmented ? 4 : n < 11 ? 2 : 3) + "d" + aMonkDie;
							};
						},
						"My Breath of the Dragon deals damage equal to two rolls of my Martials Arts die. At 11th level, this increases to three rolls of my Martial Arts die. At 17th level, I can expend 1 ki point to augment the breath to increase the damage to four rolls of my Martial Arts die."
					]
				}
			},
			autoSelectExtrachoices : [{ extrachoice : "breath of the dragon" }]
		},
		"subclassfeature6" : {
			name : "Wings Unfurled",
			source : [["FToD", 13]],
			minlevel : 6,
			description : desc([
				"When I use Step of the Wind, I can gain a flying speed equal to my walking speed"
			]),
			usages : "Prof Bonus per ",
			recovery : "long rest",
			usagescalc : "event.value = How('Proficiency Bonus');",
			"aspect of the wyrm" : {
				name : "Aspect of the Wyrm",
				extraname : "Ascendant Dragon 11",
				source : [["FToD", 13]],
				description : levels.map(function (n) {
					var aDesc = [
						"As a bonus action, I can activate a 10 ft aura for 1 minute that grants me one benefit:",
						" \u2022 My allies in the aura and I gain resistance to acid, cold, fire, lightning, or poison damage",
						" \u2022 When I create this aura and as a bonus action while it is active, I can frighten a creature",
						"      One creature must make a Wisdom save or become frightened of me for 1 minute",
						"      It can repeat the save at the end of each of its turns, ending the effect on a success",
						"I can activate this aura once per long rest, or by expending 3 ki points"
					];
					if (n < 17) return desc(aDesc);
					var aDesc17 = [
						"From 17th-level, when I active this, I can choose any creatures I can see in the aura",
						"Each must then make a Dex save or take 3d10 acid, cold, fire, lightning, or poison damage"
					];
					return desc(aDesc.concat(aDesc17));
				}),
				usages : 1,
				recovery : "long rest",
				altResource : "3 ki",
				action : [["bonus action", ""]]
			},
			autoSelectExtrachoices : [{
				extrachoice : "aspect of the wyrm",
				minlevel : 11
			}]
		},
		"subclassfeature17" : {
			name : "Ascendant Aspect",
			source : [["FToD", 13]],
			minlevel : 17,
			description : "\n   I gain 10 ft blindsight and both Breath of the Dragon and Aspect of the Wyrm improve",
			vision : [["blindsight", 10]],
			weaponOptions : [{
				regExpSearch : /^(?=.*breath)(?=.*dragon)(?=.*augment).*$/i,
				name : "Breath of the Dragon (Augmented)",
				source : [["FToD", 13]],
				ability : 5,
				type : "Natural",
				damage : [4, 10, "My choice"],
				range : "5-ft \xD7 90-ft line",
				description : "[1 ki] All in area; Dex save for half damage; Alt: 60-ft cone; Type: acid/cold/fire/lightning/poison",
				dc : true,
				monkweapon : false,
				abilitytodamage : false,
				WotAD_BreathWeapon : true,
				WotAD_BreathWeaponAugmented : true,
				selectNow : true
			}]
		}
	}
});
var FToD_Ranger_Subclass_Drakewarden = AddSubClass("ranger", "drakewarden", {
	regExpSearch : /^(?=.*(drake|dragon|draconic))(?=.*(warden|ranger|trainer)).*$/i,
	subname : "Drakewarden",
	source : [["FToD", 15]],
	fullname : "Drakewarden",
	features : {
		"subclassfeature3" : {
			name : "Draconic Gift",
			source : [["FToD", 15]],
			minlevel : 3,
			description : desc([
				"I learn the Draconic language and the Thaumaturgy cantrip"
			]),
			languageProfs : ["Draconic"],
			spellcastingBonus : [{
				name : "Draconic Gift",
				spells : ["thaumaturgy"],
				selection : ["thaumaturgy"],
				firstCol : "atwill"
			}]
		},
		"subclassfeature3.1" : {
			name : "Drake Companion",
			source : [["FToD", 15]],
			minlevel : 3,
			description : desc([
				"As an action, I can summon my drake to appear in an empty space within 30 ft",
				'Select a "Drake Companion" on the companion page for its stats and rules',
				"I can do this once per long rest, or by expending a 1st-level or higher spell slot (SS 1+)"
			]),
			usages : 1,
			recovery : "long rest",
			altResource : "SS 1+",
			action : [["action", " (summon)"], ["bonus action", " (command)"]],
			creaturesAdd : [["Drake Companion", true]],
			creatureOptions : [{
				name : "Drake Companion",
				source : [["FToD", 15]],
				size : 4,
				type : "Dragon",
				alignment : "Unaligned",
				ac : "14+Prof",
				hp : 20,
				hd : [3, 10],
				hdLinked : ["ranger", "rangerua"],
				minlevelLinked : ["ranger", "rangerua"],
				speed : "40 ft",
				scores : [16, 12, 15, 8, 14, 8],
				saves : ["", 3, "", "", 4, ""],
				damage_immunities : "the chosen Draconic Essence damage type",
				senses : "Darkvision 40 ft",
				passivePerception : 12,
				languages : "Draconic",
				challengeRating : "0",
				proficiencyBonus : 2,
				proficiencyBonusLinked : true,
				attacksAction : 1,
				attacks : [{
					name : "Bite",
					ability : 1,
					damage : [1, 6, "piercing"],
					modifiers : ["", "Prof"],
					range : "Melee (5 ft)",
					description : "", //+1d6 damage of the chosen Draconic Essense type
					abilitytodamage : false
				}],
				features : [{
					name : "Warden",
					description : "The drake obeys the commands of its warden and shares its proficiency bonus. It takes its turn immediately after that of its warden, on the same initiative. It can move and take reactions on its own, but only takes the Dodge action on its turn unless its warden takes a bonus action to command it to take another action. If its warden is incapacitated, the drake can take any action, not just Dodge. The drake vanishes when it is reduced to 0 hit points, when its warden summons another drake, or when its warden dies."
				}],
				traits : [{
					name : "Draconic Essence",
					description : "Chosen when summoned: acid, cold, fire, lightning, or poison damage."
				}, {
					name : "Infused Strikes",
					description : "As a reaction when another creature within 30 ft of the drake that it can see hits with a weapon attack, the drake can infuse the strike with its essence, causing the attack to deal an extra 1d6 damage of its chosen Draconic Essence damage type"
				}, {
					name : "Bond of Fang and Scale (Drakewarden 7)",
					minlevel : 7,
					description : "The drake is now Medium and can be ridden as a mount. It has a flying speed equal to its walking speed, but can't fly with a rider on its back. The drake's bite deals an extra 1d6 damage of its chosen Draconic Essence type.",
					eval : function(prefix, lvl) {
						var sMoveStr = (typePF ? ",\n" : ", ") + "fly 40 ft";
						if (What("Unit System") === "metric") sMoveStr = ConvertToMetric(sMoveStr, 0.5);
						tDoc.getField(prefix + "Comp.Use.Speed").value += sMoveStr;
						AddString(prefix + "Comp.Use.Attack.1.Description", "+1d6 damage of the chosen Draconic Essense type");
						PickDropdown(prefix + "Comp.Desc.Size", 3); // Medium
					},
					removeeval : function(prefix, lvl) {
						var sMoveStr = (typePF ? ",\n" : ", ") + "fly 40 ft";
						if (What("Unit System") === "metric") sMoveStr = ConvertToMetric(sMoveStr, 0.5);
						Value(prefix + "Comp.Use.Speed", What(prefix + "Comp.Use.Speed").replace(sMoveStr, ""));
						var sAtkFld = prefix + "Comp.Use.Attack.1.Description";
						Value(sAtkFld, What(sAtkFld).replace(/\+\d+d6 damage of the chosen Draconic Essense type/i, ''));
						PickDropdown(prefix + "Comp.Desc.Size", 4); // Small
					}
				}, {
					name : "Perfected Bond (Drakewarden 15)",
					minlevel : 15,
					description : "The drake is now Large and can fly while its being ridden. Its bite attack deals an extra 1d6 damage (for a total of +2d6) of its chosen Draconic Essence type.",
					eval : function(prefix, lvl) {
						var sAtkFld = prefix + "Comp.Use.Attack.1.Description";
						Value(sAtkFld, What(sAtkFld).replace(/\+\d+d6 damage of the chosen Draconic Essense type/i, '+2d6 damage of the chosen Draconic Essense type'));
						PickDropdown(prefix + "Comp.Desc.Size", 2); // Large
					},
					removeeval : function(prefix, lvl) {
						var sAtkFld = prefix + "Comp.Use.Attack.1.Description";
						Value(sAtkFld, What(sAtkFld).replace(/\+\d+d6 damage of the chosen Draconic Essense type/i, '+1d6 damage of the chosen Draconic Essense type'));
						PickDropdown(prefix + "Comp.Desc.Size", 3); // Medium
					}
				}],
				calcChanges : {
					hp : function (totalHD, HDobj, prefix) {
						if (!classes.known.ranger && !classes.known.rangerua) return;
						var rngrLvl = classes.known.ranger ? classes.known.ranger.level : classes.known.rangerua.level;
						var rngrLvlM = 5 * rngrLvl;
						HDobj.alt.push(5 + rngrLvlM);
						HDobj.altStr.push(" = 5 as a base\n + 5 \xD7 " + rngrLvl + " from five times its warden's ranger level (" + rngrLvlM + ")");
					},
					setAltHp : true
				}
			}]
		},
		"subclassfeature7" : {
			name : "Bond of Fang and Scale",
			source : [["FToD", 15]],
			minlevel : 7,
			description : desc([
				"My drake is now Medium, has a 40 ft fly speed, and can be ridden, but not while flying",
				"The drake's bite attack deals an extra 1d6 damage chosen by its Draconic Essense",
				"While it is summoned, I gain resistance to the damage type of its Draconic Essense"
			]),
			dmgres : ["(See Drake)"]
		},
		"subclassfeature11" : {
			name : "Drake's Breath",
			source : [["FToD", 15]],
			minlevel : 11,
			description : desc([
				"As an action, I can cause my drake or myself to exhale a 30-ft cone breath weapon",
				"Its damage type is acid, cold, fire, lightning, or poison; Dex save to halve the damage",
				"I can do this once per long rest, or by expending a 3rd-level or higher spell slot (SS 3+)"
			]),
			additional : levels.map(function (n) {
				return n < 11 ? "" : (n < 15 ? 8 : 10) + "d6 damage";
			}),
			action : [["action", ""]],
			usages : 1,
			recovery : "long rest",
			altResource : "SS 3+",
			weaponOptions : [{
				regExpSearch : /^(?=.*drake)(?=.*breath).*$/i,
				name : "Drake's Breath",
				source : [["FToD", 15]],
				ability : 5,
				type : "Natural",
				damage : [8, 6, "My choice"],
				range : "30-ft cone",
				description : "Hits all in area; Dex save for half damage; Damage type: acid, cold, fire, lightning, or poison",
				abilitytodamage : false,
				dc : true,
				useSpellMod : "ranger",
				DrakewardenDrakeBreath : true,
				selectNow : true
			}],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.theWea.DrakewardenDrakeBreath && (classes.known.rangerua || classes.known.ranger)) {
							var rngrLvl = classes.known.ranger ? classes.known.ranger.level : classes.known.rangerua.level;
							fields.Damage_Die = (rngrLvl < 15 ? 8 : 10) + 'd6';
						};
					},
					"",
					1
				],
				atkCalc : [
					function (fields, v, output) {
						if (v.theWea.DrakewardenDrakeBreath && classes.known.rangerua) {
							v.theWea.useSpellMod = "rangerua";
						}
					}
				]
			}
		},
		"subclassfeature15" : {
			name : "Perfected Bond",
			source : [["FToD", 15]],
			minlevel : 15,
			description : desc([
				"My drake is now Large, can serve as a mount, and adds another +1d6 damage to its bite",
				"As a reaction when the drake or I take damage while within 30 ft of each other,",
				"I can give myself or the drake resistance to that instance of damage",
			]),
			action : [["reaction", ""]],
			usages : "proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : "reaction"
		}
	}
});
// Add the subclass to the revised ranger as well, if it exists
if (ClassList.rangerua) {
	ClassList.rangerua.subclasses[1].push(FToD_Ranger_Subclass_Drakewarden);
};

// Feats
FeatsList["gift of the chromatic dragon"] = {
	name : "Gift of the Chromatic Dragon",
	source : [["FToD", 17], ["UA:DO", 4]],
	descriptionFull : "You've manifested some of the power of chromatic dragons, granting you the following benefits:"+
	"\n   " + toUni("Chromatic Infusion") + ". As a bonus action, you can touch a simple or martial weapon and infuse it with one of the following damage types: acid, cold, fire, lightning, or poison. For the next minute, the weapon deals an extra 1d4 damage of the chosen type when it hits. After you use this bonus action, you can't do so again until you finish a long rest."+
	"\n   " + toUni("Reactive Resistance") + ". When you take acid, cold, fire, lightning, or poison damage, you can use your reaction to give yourself resistance to that instance of damage. You can use this reaction a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	description : "As a bonus action once per long rest, I can touch a simple or martial weapon and infuse it to deal +1d4 acid, cold, fire, poison, or lightning damage for 1 minute. As a reaction when I take acid, cold, fire, lightning, or poison damage, I can gain resistance to that damage instance. I can do this my Prof Bonus per long rest.",
	action : [
		["bonus action", "Chromatic Gift (Chromatic Infusion)"],
		["reaction", "Chromatic Gift (Reactive Resistance)"]
	],
	extraLimitedFeatures : [{
		name : "Chromatic Gift (Chromatic Infusion)",
		usages : 1,
		recovery : "long rest"
	}, {
		name : "Chromatic Gift (Reactive Resistance)",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus');",
		recovery : "long rest"
	}]
};
FeatsList["gift of the gem dragon"] = {
	name : "Gift of the Gem Dragon",
	source : [["FToD", 17], ["UA:DO", 5]],
	descriptionFull : "You've manifested some of the power of gem dragons, granting you the following benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase your Intelligence, Wisdom, or Charisma score by 1, to a maximum of 20."+
	"\n   " + toUni("Telekinetic Reprisal") + ". When you take damage from a creature that is within 10 feet of you, you can use your reaction to emanate telekinetic energy. The creature that dealt damage to you must make a Strength saving throw (DC equals 8 + your proficiency bonus + the ability modifier of the score increased by this feat). On a failed save, the creature takes 2d8 force damage and is pushed up to 10 feet away from you. On a successful save, the creature takes half as much damage and isn't pushed. You can use this reaction a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	description : "As a reaction when I take damage from a creature that is within 10 ft, I can have it take 2d8 force damage and push it up to 10 ft away. If it succeeds on a Str save (DC 8 + Prof Bonus + chosen ability score modifier), it halves the damage and isn't pushed. I can do this my Prof Bonus per long rest. [+1 Int, Wis or Cha]",
	action : [["reaction", ""]],
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest",
	choices : ["Intelligence", "Wisdom", "Charisma"],
	"intelligence" : {
		calculate : "event.value = 'As a reaction when I take damage from a creature that is within 10 ft of me, I can have it take 2d8 force damage and push it up to 10 ft away from me. If it succeeds a Strength save DC ' + ( 8 + Number(How('Proficiency Bonus')) + Number(What('Int Mod')) ) + ' (8 + Prof Bonus + Int mod), it halves the damage and isn\\'t pushed. I can do this my Proficiency Bonus per long rest. [+1 Intelligence]';",
		scores : [0, 0, 0, 1, 0, 0]
	},
	"wisdom" : {
		calculate : "event.value = 'As a reaction when I take damage from a creature that is within 10 ft of me, I can have it take 2d8 force damage and push it up to 10 ft away from me. If it succeeds a Strength save DC ' + (8 + Number(How('Proficiency Bonus')) + Number(What('Wis Mod'))) + ' (8 + Prof Bonus + Wis mod), it halves the damage and isn\\'t pushed. I can do this my Proficiency Bonus per long rest. [+1 Wisdom]';",
		scores : [0, 0, 0, 0, 1, 0]
	},
	"charisma" : {
		calculate : "event.value = 'As a reaction when I take damage from a creature that is within 10 ft of me, I can have it take 2d8 force damage and push it up to 10 ft away from me. If it succeeds a Strength save DC ' + (8 + Number(How('Proficiency Bonus')) + Number(What('Cha Mod'))) + ' (8 + Prof Bonus + Cha mod), it halves the damage and isn\\'t pushed. I can do this my Proficiency Bonus per long rest. [+1 Charisma]';",
		scores : [0, 0, 0, 0, 0, 1]
	}
};
FeatsList["gift of the metallic dragon"] = {
	name : "Gift of the Metallic Dragon",
	source : [["FToD", 17]],
	descriptionFull : "You've manifested some of the power of metallic dragons, granting you the following benefits:"+
	"\n   " + toUni("Draconic Healing") + ". You learn the cure wounds spell. You can cast this spell without expending a spell slot. Once you cast this spell in this way, you can't do so again until you finish a long rest. You can also cast this spell using spell slots you have. The spell's spellcasting ability is Intelligence, Wisdom, or Charisma when you cast it with this feat (choose when you gain the feat)."+
	"\n   " + toUni("Protective Wings") + ". You can manifest protective wings that can shield you or others. When you or another creature you can see within 5 feet of you is hit by an attack roll, you can use your reaction to manifest spectral wings from your back for a moment. You grant a bonus to the target's AC equal to your proficiency bonus against that attack roll, potentially causing it to miss. You can use this reaction a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	description : "I know Cure Wounds. I can cast it using spell slots and once per long rest without a spell slot. As a reaction when I or another I can see within 5 ft is hit by an attack, I can add my Proficiency Bonus to AC, potentially causing the attack to miss. I can do this my Proficiency Bonus per long rest.",
	spellcastingAbility : [4, 5, 6],
	allowUpCasting : true,
	spellcastingBonus : [{
		name : "Cure Wounds",
		spells : ["cure wounds"],
		selection : ["cure wounds"],
		firstCol : "oncelr"
	}],
	action : [["reaction", "Metallic Gift (Protective Wings)"]],
	extraLimitedFeatures : [{
		name : "Metallic Gift (Cure Wounds)",
		usages : 1,
		recovery : "long rest"
	}, {
		name : "Metallic Gift (Protective Wings)",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus');",
		recovery : "long rest"
	}]
};

// Spells
SpellsList["ashardalon's stride"] = { // contains contributions by Nod_Hero (Flame Stride in UA:DO)
	name : "Ashardalon's Stride",
	nameAlt : "Flame Stride",
	classes : ["artificer", "ranger", "sorcerer", "wizard"],
	source : [["FToD", 19], ["UA:DO", 6]],
	level : 3,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "+20+5/SL ft speed; provoke no opp atks for moving; all crea/obj in 5 ft of path 1d6+1d6/SL Fire dmg",
	descriptionShorter : "+20+5/SL ft spd; no opp atks with move; all crea/obj in 5 ft of path 1d6+1d6/SL Fire dmg",
	descriptionMetric : "+6+1,5/SL m spd; provoke no opp atks in move; all crea/obj in 1,5 m of path 1d6+1d6/SL Fire dmg",
	descriptionShorterMetric : "+6+1,5/SL m spd; no opp atks in move; all crea/obj in 1,5 m of path 1d6+1d6/SL Fire dmg",
	descriptionFull : "The billowing flames of a dragon blast from your feet, granting you explosive speed. For the duration, your speed increases by 20 feet and moving doesn't provoke opportunity attacks."+
	"\n   When you move within 5 feet of a creature or an object that isn't being worn or carried, it takes 1d6 fire damage from your trail of heat. A creature or object can take this damage only once during a turn."+
	AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, increase your speed by 5 feet for each spell slot level above 3rd. The spell deals an additional 1d6 fire damage for each slot level above 3rd."
};
SpellsList["draconic transformation"] = {
	name : "Draconic Transformation",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["FToD", 19]],
	level : 7,
	school : "Trans",
	time : "1 bns",
	range : "S:60" + (typePF ? "-" : "") + "ft cone",
	components : "V,S,M\u0192",
	compMaterial : "A statuette of a dragon, worth at least 500 gp",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "Blindsight 30 ft; 60 ft fly speed; at cast and 1 bns: 60-ft cone all 6d8 Force damage, save half (500gp)",
	descriptionShorter : "Blindsight 30 ft; 60 ft fly; at cast and 1 bns: 60-ft cone all 6d8 Force dmg, save half (500gp)",
	descriptionFull : "With a roar, you draw on the magic of dragons to transform yourself, taking on various draconic features. You gain the following benefits until the spell ends:"+
	"\n   " + toUni("Blindsight") + ". You have blindsight with a range of 30 feet. Within that range, you can effectively see anything that isn't behind total cover, even if you're blinded or in darkness. Moreover, you can see an invisible creature, unless the creature successfully hides from you."+
	"\n   " + toUni("Breath Weapon") + ". When you cast this spell, and as a bonus action on subsequent turns for the duration, you can exhale shimmering energy in a 60-foot cone. Each creature in that area must make a Dexterity saving throw, taking 6d8 force damage on a failed save, or half as much damage on a successful one."+
	"\n   " + toUni("Wings") + ". Incorporeal wings sprout from your back, giving you a flying speed of 60 feet."
};
SpellsList["fizban's platinum shield"] = {
	name : "Fizban's Platinum Shield",
	nameAlt : "Platinum Shield",
	classes : ["sorcerer", "wizard"],
	source : [["FToD", 20]],
	level : 6,
	school : "Abjur",
	time : "1 bns",
	range : "60 ft",
	components : "V,S,M\u0192",
	compMaterial : "A platinum-plated dragon scale, worth at least 500 gp",
	duration : "Conc, 1 min",
	description : "1 crea Acid, Cold, Fire, Lightn. \u0026 Poison resist., half cover, better Dex saves; 1 bns change crea (500gp)",
	descriptionFull : "You create a field of silvery light that surrounds a creature of your choice within range (you can choose yourself). The field sheds dim light out to 5 feet. While surrounded by the field, a creature gains the following benefits:"+
	"\n   " + toUni("Cover") + ". The creature has half cover."+
	"\n   " + toUni("Damage Resistance") + ". The creature has resistance to acid, cold, fire, lightning, and poison damage."+
	"\n   " + toUni("Evasion") + ". If the creature is subjected to an effect that allows it to make a Dexterity saving throw to take only half damage, the creature instead takes no damage if it succeeds on the saving throw, and only half damage if it fails."+
	"\n   As a bonus action on subsequent turns, you can move the field to another creature within 60 feet of the field."
};
SpellsList["nathair's mischief"] = {
	name : "Nathair's Mischief",
	nameAlt : "Mischief",
	classes : ["bard", "sorcerer", "wizard"],
	source : [["FToD", 20], ["UA:DO", 6]],
	level : 2,
	school : "Illus",
	time : "1 a",
	range : "60 ft",
	components : "S,M",
	compMaterial : "A piece of crust from an apple pie",
	duration : "Conc, 1 min",
	save : "Var",
	description : "20-ft cube of magic, roll d4 for effect; At start of my turn, move cube 10 ft and reroll effect; see book",
	descriptionFull : "You fill a 20-foot cube you can see within range with fey and draconic magic. Roll on the Mischievous Surge table to determine the magical effect produced, and roll again at the start of each of your turns until the spell ends. You can move the cube up to 10 feet before you roll."+
	"\n\nMischievous Surge"+
	toUni("\nd4\tEffect")+
	"\n  1\tThe smell of apple pie fills the air, and each creature in the cube must succeed on a Wisdom saving throw or become charmed by you until the start of your next turn."+
	"\n  2\tBouquets of flowers appear all around, and each creature in the cube must succeed on a Dexterity saving throw or be blinded until the start of your next turn as the flowers spray water in their faces."+
	"\n  3\tEach creature in the cube must succeed on a Wisdom saving throw or begin giggling until the start of your next turn. A giggling creature is incapacitated and uses all its movement to move in a random direction."+
	"\n  4\tDrops of molasses hover in the cube, making it difficult terrain until the start of your next turn."
};
SpellsList["raulothim's psychic lance"] = {
	name : "Raulothim's Psychic Lance",
	nameAlt : "Psychic Lance",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["FToD", 21]],
	level : 4,
	school : "Ench",
	time : "1 a",
	range : "120 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Int",
	description : "1 crea I see or can name 7d6+1d6/SL Psychic dmg \u0026 incap. till start of my turn; save half, not incap.",
	descriptionShorter : "1 crea I see or can name 7d6+1d6/SL Psychic dmg \u0026 incap. for 1 rnd; save half, not incap.",
	descriptionFull : "You unleash a shimmering lance of psychic power from your forehead at a creature that you can see within range. Alternatively, you can utter a creature's name. If the named target is within range, it becomes the spell's target even if you can't see it. If the named target isn't within range, the lance dissipates without effect."+
	"\n   The target must make an Intelligence saving throw. On a failed save, the target takes 7d6 psychic damage and is incapacitated until the start of your next turn. On a successful save, the creature takes half as much damage and isn't incapacitated."+
	AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the damage increases by 1d6 for each slot level above 4th."
};
SpellsList["rime's binding ice"] = { // Icingdeath's Frost in UA:DO
	name : "Rime's Binding Ice",
	nameAlt : "Binding Ice",
	classes : ["sorcerer", "wizard"],
	source : [["FToD", 21], ["UA:DO", 6]],
	level : 2,
	school : "Evoc",
	time : "1 a",
	range : "S:30" + (typePF ? "-" : "") + "ft cone",
	components : "S,M",
	compMaterial : "A vial of meltwater",
	duration : "Instantaneous",
	save : "Con",
	description : "All in area 3d8+1d8/SL Cold dmg and speed 0 for 1 min until 1 a to undo; save halves, normal speed",
	descriptionShorter : "All in area 3d8+1d8/SL Cold dmg \u0026 spd 0 for 1 min until 1 a to undo; save halves, normal spd",
	descriptionFull : "A burst of cold energy emanates from you in a 30-foot cone. Each creature in that area must make a Constitution saving throw. On a failed save, a creature takes 3d8 cold damage and is hindered by ice formations for 1 minute, or until it or another creature within reach of it uses an action to break away the ice. A creature hindered by ice has its speed reduced to 0. On a successful save, a creature takes half as much damage and isn't hindered by ice."+
	AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, increase the cold damage by 1d8 for each slot level above 2nd."
};
SpellsList["summon draconic spirit"] = {
	name : "Summon Draconic Spirit",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["FToD", 21], ["UA:DO", 7]],
	level : 5,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M\u0192",
	compMaterial : "an object with the image of a dragon engraved on it, worth at least 500 gp",
	duration : "Conc, 1 h",
	description : "Summon choice of Draconic Spirit; obeys commands; takes turn after mine; vanishes at 0 hp (500gp)",
	descriptionFull : "You call forth a draconic spirit. It manifests in an unoccupied space that you can see within range. This corporeal form uses the Draconic Spirit stat block. When you cast this spell, choose a family of dragon: chromatic, gem, or metallic. The creature resembles a dragon of the chosen family, which determines certain traits in its stat block. The creature disappears when it drops to 0 hit points or when the spell ends."+
	"\n   The creature is an ally to you and your companions. In combat, the creature shares your initiative count, but it takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue any, it takes the Dodge action and uses its move to avoid danger."+
	AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, use the higher level wherever the spell's level appears in the stat block."
};

// Magic Items
MagicItemsList["amethyst lodestone"] = {
	name : "Amethyst Lodestone",
	source : [["FToD", 22]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "This " + (typePF ? "" : "mineral ") + "grants me adv. on Str saves. It has 6 charges, regain" + (typePF ? "s" : "ing") + " 1d6 at dawn."+
		(typePF ? " " : "\n") + "\u2022 1 charge, bonus action: I gain a fly speed equal to walk speed for 10 min and I can hover."+
		(typePF ? " \u2022 1 charge, action: a creature I can see in 60 ft makes DC 18 Str save or pushed 20 ft in chosen direction." : "\n\u2022 1 charge, action: a creature I can see in 60 ft must make a DC 18 Str save or be pushed up to 20 ft in a direction of my choice.")+
		" \u2022 3 charges, action: I cast Reverse Gravity (DC 18).",
	descriptionFull : "This fist-sized chunk of amethyst is infused with an amethyst dragon's ability to bend gravitational forces. While you are carrying the lodestone, you have advantage on Strength saving throws."+
	"\n   The lodestone has 6 charges for the following properties, which you can use while you are holding the stone. The stone regains 1d6 expended charges daily at dawn."+
	"\n   " + toUni("Flight") + ". As a bonus action, you can expend 1 charge to gain the power of flight for 10 minutes. For the duration, you gain a flying speed equal to your walking speed, and you can hover."+
	"\n   " + toUni("Gravitational Thrust") + ". As an action, you can expend 1 charge to focus gravity around a creature you can see within 60 feet of you. The target must succeed on a DC 18 Strength saving throw or be pushed up to 20 feet in a direction of your choice."+
	"\n   " + toUni("Reverse Gravity") + ". As an action, you can expend 3 charges to cast reverse gravity from the stone (save DC 18).",
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6",
	spellFirstColTitle : "Ch",
	fixedDC : 18,
	spellcastingBonus : {
		name : "3 charges",
		spells : ["reverse gravity"],
		selection : ["reverse gravity"],
		firstCol : 3
	},
	advantages : [["Strength", true]],
	savetxt : { text : ["Adv. on Str saves"] },
	action : [["bonus action", " (Flight)"], ["action", " (Grav. Thrust)"]]
}
MagicItemsList["crystal blade"] = {
	name : "Crystal Blade",
	source : [["FToD", 22]],
	type : "weapon (any sword)",
	rarity : "rare",
	attunement : true,
	description : "This magic sword has 3 charges, regaining 1d3 at dawn. It deals an extra 1d8 radiant damage. When it does so to a creature, I can expend 1 charge to heal myself for the same amount. As a bonus action, I can have it start or stop shedding light: either 30 ft bright light and 30 ft dim, or only 10 ft dim.",
	descriptionFull : "This magic sword's blade is fashioned from a horn or spine from a crystal dragon. When you hit with an attack roll using this sword, the target takes an extra 1d8 radiant damage."+
	"\n   The sword has 3 charges and regains 1d3 expended charges daily at dawn. When you hit a creature with an attack roll using the sword, you can expend 1 charge to regain a number of hit points equal to the extra radiant damage the sword dealt."+
	"\n   While you're holding the sword, you can use a bonus action to cause it to shed bright light in a 30-foot radius and dim light for an additional 30 feet, to cause it to shed dim light in a 10-foot radius, or to douse the light.",
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	action : [["bonus action", ""]],
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "brackets",
		descriptionChange : ["replace", "sword"],
		itemName1stPage : ["suffix", "Crystal Bladed"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/\bcrystal bladed?\b/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + '+1d8 radiant damage; 1 charge to heal';
				}
			},
			'If I include the words "Crystal Blade" or "Crystal Bladed" in a the name of a sword, it will be treated as the magic weapon Crystal Blade. The sword deals an extra 1d8 radiant damage and when it does so, I can expend 1 of its charges to heal me for the same amount.'
		]
	}
}
MagicItemsList["dragonhide belt, +1, +2, or +3"] = {
	name : "Dragonhide Belt, +1, +2, or +3",
	source : [["FToD", 23]],
	type : "wondrous item",
	rarity : "very rare",
	description : "This finely detailed belt is made of dragonhide. While wearing it, I gain a bonus to the save DCs of my ki features determined by its rarity: uncommon (+1), rare (+2), or very rare (+3). As an action, I can use it to regain ki points equal to a roll of my Martial Arts die. I can't use this action again until the next dawn.",
	descriptionFull : "This finely detailed belt is made of dragonhide. While wearing it, you gain a bonus to the saving throw DCs of your ki features. The bonus is determined by the belt's rarity: uncommon (+1), rare (+2), or very rare (+3). In addition, you can use an action to regain ki points equal to a roll of your Martial Arts die. You can't use this action again until the next dawn.",
	attunement : true,
	prerequisite : "Requires attunement by a monk",
	prereqeval : function(v) { return classes.known.monk ? true : false; },
	usages : 1,
	recovery : "dawn",
	additional : "regain ki points",
	allowDuplicates : true,
	choices : ["+1 to ki save DCs (uncommon)", "+2 to ki save DCs (rare)", "+3 to ki save DCs (very rare)"],
	"+1 to ki save dcs (uncommon)" : {
		name : "Dragonhide Belt +1",
		rarity : "uncommon",
		description : "This finely detailed belt is made of dragonhide. While wearing it, I gain a +1 bonus to the saving throw DCs of my ki features. As an action, I can use it to regain ki points equal to a roll of my Martial Arts die. Once I do so, I can't use this action again until the next dawn.",
		action : [["action", " (regain ki)"]],
		addMod : [{
			type : "dc", field : "Wis", mod : 1, text : "I gain a +1 bonus to the saving throw DCs of my ki features while attuned to this belt."
		}],
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type === "dc" && spellcasters.indexOf('monk') !== -1) return 1;
				},
				"I gain a +1 bonus to the saving throw DCs of my ki features while attuned to this belt."
			]
		}
	},
	"+2 to ki save dcs (rare)" : {
		name : "Dragonhide Belt +2",
		rarity : "uncommon",
		description : "This finely detailed belt is made of dragonhide. While wearing it, I gain a +2 bonus to the saving throw DCs of my ki features. As an action, I can use it to regain ki points equal to a roll of my Martial Arts die. Once I do so, I can't use this action again until the next dawn.",
		action : [["action", " (regain ki)"]],
		addMod : [{
			type : "dc", field : "Wis", mod : 2, text : "I gain a +2 bonus to the saving throw DCs of my ki features while attuned to this belt."
		}],
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type === "dc" && spellcasters.indexOf('monk') !== -1) return 2;
				},
				"I gain a +2 bonus to the saving throw DCs of my ki features while attuned to this belt."
			]
		}
	},
	"+3 to ki save dcs (very rare)" : {
		name : "Dragonhide Belt +3",
		rarity : "uncommon",
		description : "This finely detailed belt is made of dragonhide. While wearing it, I gain a +3 bonus to the saving throw DCs of my ki features. As an action, I can use it to regain ki points equal to a roll of my Martial Arts die. Once I do so, I can't use this action again until the next dawn.",
		action : [["action", " (regain ki)"]],
		addMod : [{
			type : "dc", field : "Wis", mod : 3, text : "I gain a +3 bonus to the saving throw DCs of my ki features while attuned to this belt."
		}],
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type === "dc" && spellcasters.indexOf('monk') !== -1) return 3;
				},
				"I gain a +3 bonus to the saving throw DCs of my ki features while attuned to this belt."
			]
		}
	}
}
MagicItemsList["dragonlance"] = {
	name : "Dragonlance",
	source : [["FToD", 23]],
	type : "weapon (lance or pike)",
	rarity : "legendary",
	attunement : true,
	description : "This magic weapon forged from rare metal grants me a +3 bonus to attack and damage rolls made with it. When I hit a dragon with it, the dragon takes an extra 3d6 force damage, and any Dragon of my choice that I can see within 30 ft can immediately use its reaction to make a melee attack.",
	descriptionFull : "A dragonlance is a renowned weapon forged from rare metal with the aid of powerful artifacts associated with Bahamut. Different lances are forged for use by foot soldiers (as pikes) and by riders (as lances), but the magical properties of the weapons are the same."+
	"\n   You gain a +3 bonus to attack and damage rolls made with this magic weapon."+
	"\n   When you hit a Dragon with this weapon, the Dragon takes an extra 3d6 force damage, and any Dragon of your choice that you can see within 30 feet of you can immediately use its reaction to make a melee attack.",
	choices : ["A lance for riders", "A pike for foot soldiers"],
	allowDuplicates : true,
	choicesNotInMenu : true,
	"a lance for riders" : {
		name : "Dragonlance (for riders)",
		description : "This magic lance forged from rare metal grants me a +3 bonus to attack and damage rolls made with it. When I hit a dragon with it, the dragon takes an extra 3d6 force damage, and any Dragon of my choice that I can see within 30 ft can immediately use its reaction to make a melee attack.",
		weaponOptions : [{
			baseWeapon : "lance",
			regExpSearch : /dragonlance/i,
			name : "Dragonlance",
			source : [["FToD", 23]],
			description : "Reach, disadv. within 5 ft, two-handed if not mounted; +3d6 force damage vs. dragons",
			modifiers : [3, 3],
			selectNow : true
		}]
	},
	"a pike for foot soldiers" : {
		name : "Dragonlance (for foot soldiers)",
		description : "This magic pike forged from rare metal grants me a +3 bonus to attack and damage rolls made with it. When I hit a dragon with it, the dragon takes an extra 3d6 force damage, and any Dragon of my choice that I can see within 30 ft can immediately use its reaction to make a melee attack.",
		weaponOptions : [{
			baseWeapon : "pike",
			regExpSearch : /^(?=.*dragonlance)(?=.*pike).*$/i,
			name : "Dragonlance (pike)",
			source : [["FToD", 23]],
			description : "Heavy, reach, two-handed; +3d6 force damage vs. dragons",
			modifiers : [3, 3],
			selectNow : true
		}]
	}
}
MagicItemsList["dragon wing bow"] = function () {
	var obj = {
		name : "Dragon Wing Bow",
		source : [["FToD", 23]],
		type : "weapon (any bow)",
		rarity : "rare",
		attunement : true,
		description : "This magic bow has limb tips shaped like dragon wings and is infused with the essence of a dragon's breath. Attacks made with it deal an extra 1d6 damage of the dragon's type. When I pull back the string without ammo loaded in it, the weapon creates its own that lasts until it hits or misses a target.",
		descriptionFull : "The limb tips of this magic bow are shaped like a dragon's wings, and the weapon is infused with the essence of a chromatic, gem, or metallic dragon's breath. When you hit with an attack roll using this magic bow, the target takes an extra 1d6 damage of the same type as the breath infused in the bow\u2014acid, cold, fire, force, lightning, necrotic, poison, psychic, radiant, or thunder."+
		"\n   If you load no ammunition in the weapon, it produces its own, automatically creating one piece of magic ammunition when you pull back the string. The ammunition created by the bow vanishes the instant after it hits or misses a target.",
		chooseGear : {
			type : "weapon",
			prefixOrSuffix : "suffix",
			descriptionChange : ["replace", "bow"],
			excludeCheck : function (inObjKey, inObj) {
				var testRegex = /bow/i;
				return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
			}
		},
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (v.theWea.isMagicWeapon || !v.isRangedWeapon || !/bow/i.test(v.baseWeaponName) || !/\bdragon wing\b/i.test(v.WeaponTextName)) return;
					var oBowUse = false;
					for (var i = 0; i < CurrentMagicItems.known.length; i++) {
						if (CurrentMagicItems.known[i] !== "dragon wing bow") continue;
						var oBow = MagicItemsList["dragon wing bow"][CurrentMagicItems.choices[i]];
						// see if this one matches
						if (oBow && oBow.dragonWingBowDragonType && v.WeaponTextName.toLowerCase().indexOf(oBow.dragonWingBowDragonType) !== -1) oBowUse = oBow;
						// save the first one found in case none match(ed)
						if (oBowUse === false) oBowUse = oBow;
					}
					if (oBowUse) {
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + '+1d6 ' + oBowUse.dragonWingBowDmgType + ' damage; Creates own ammo';
					}
				},
				'If I include the words "Dragon Wing" and a dragon type in the name of a bow, it will be treated as the magic weapon Dragon Wing Bow. The bow deals an extra 1d6 damage of the type of its associated dragon. It also requires no ammunition, creating its own if fired without loading ammunition.'
			]
		},
		choices : [],
		allowDuplicates : true,
		choicesNotInMenu : true
	};
	var aDragons = [["Black", "acid"], ["Blue", "lightning"], ["Green", "poison"], ["Red", "fire"], ["White", "cold"], ["Amethyst", "force"], ["Crystal", "radiant"], ["Emerald", "psychic"], ["Sapphire", "thunder"], ["Topaz", "necrotic"], ["Brass", "fire"], ["Bronze", "lightning"], ["Copper", "acid"], ["Gold", "fire"], ["Silver", "cold"]];
	var aVowels = ["a", "e"];
	for (var i = 0; i < aDragons.length; i++) {
		var sDragon = aDragons[i][0];
		var sDragonLC = sDragon.toLowerCase();
		var sDmg = aDragons[i][1];
		var sNameTest = sDragon + " Dragon Wing";
		var sNameFull = sNameTest + " Bow";
		var sNameChoice = sDragon + " dragon (" + sDmg + ")";
		var sAorAn = aVowels.indexOf(sDragon[0].toLowerCase()) === -1 ? "a " : "an ";
		obj.choices.push(sNameChoice);
		obj[sNameChoice.toLowerCase()] = {
			name : sNameFull,
			nameTest : sNameTest,
			description : "This magic bow has limb tips shaped like dragon wings and is infused with the essence of " + sAorAn + sDragonLC + " dragon's breath. Attacks made with it deal an extra 1d6 " + sDmg + " damage. When I pull back the string without ammunition loaded in it, the weapon creates its own that lasts until it hits or misses a target.",
			dragonWingBowDmgType : sDmg,
			dragonWingBowDragonType : sDragonLC
		}
	}
	return obj;
}();
MagicItemsList["emerald pen"] = {
	name : "Emerald Pen",
	source : [["FToD", 23]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "This pen is tipped with an emerald nib and requires no ink to write. While holding this pen, I can cast Illusory Script at will, requiring no material components.",
	descriptionFull : "This pen is tipped with an emerald nib and requires no ink to write. While holding this pen, you can cast illusory script at will, requiring no material components.",
	spellcastingAbility : "class",
	spellcastingBonus : {
		name : "At will",
		spells : ["illusory script"],
		selection : ["illusory script"],
		firstCol : "atwill"
	},
	spellChanges : {
		"illusory script" : {
			ritual : false,
			changes : "Using the Emerald Pen, I can cast Illusory Script at will without requiring material components. Thus, the Ritual tag is removed."
		}
	}
}
MagicItemsList["flail of tiamat"] = {
	name : "Flail of Tiamat",
	source : [["FToD", 23]],
	type : "weapon (flail)",
	rarity : "legendary",
	attunement : true,
	description : "This magical flail adds a +3 bonus to its attack and damage rolls and deals +5d4 damage. As an action once per dawn, I can have it breathe flames in a 90-ft cone that deals 14d6 damage, Dex save DC 18 to halve. Damage type is acid, cold, fire, lightning, or poison, which I can choose when I deal the damage (cone or hit).",
	descriptionFull : "This magic flail is made in the image of Tiamat, with five jagged heads shaped like the heads of five different chromatic dragons. You gain a +3 bonus to attack and damage rolls made with this flail. When you hit with an attack roll using it, the target takes an extra 5d4 damage of your choice of one of the following damage types: acid, cold, fire, lightning, or poison."+
	"\n   While holding the flail, you can use an action and speak a command word to cause the heads to breathe multicolored flames in a 90-foot cone. Each creature in that area must make a DC 18 Dexterity saving throw. On a failed save, it takes 14d6 damage of one of the following damage types (your choice): acid, cold, fire, lightning, or poison. On a successful save, it takes half as much damage. Once this action is used, it can't be used again until the next dawn.",
	weight : 2,
	usages : 1,
	recovery : "dawn",
	additional : "Breathe Flames",
	action : [["action", " (Breathe Flames)"]],
	weaponOptions : [{
		baseWeapon : "flail",
		regExpSearch : /^(?=.*flail)(?=.*tiamat).*$/i,
		name : "Flail of Tiamat",
		source : [["FToD", 23]],
		description : "+5d4 acid, cold, fire, lightning, or poison damage",
		modifiers : [3, 3],
		selectNow : true
	}]
}
AddFeatureChoice(MagicItemsList["figurine of wondrous power"], false, "Gold Canary", {
	source : [["FToD", 23]],
	rarity : "legendary",
	description : "As an action, I can speak the command word and throw this statuette to an empty space within 60 ft, where it becomes a giant canary for 8 hours (or once a year an adult gold dragon for 1 hour), until I use the command again, or it drops to 0 hp. It is friendly, understands my languages, and obeys my commands.",
	descriptionLong : "As an action, I can speak the command word and throw this gold statuette of a canary to an unoccupied space within 60 ft, where it becomes a giant canary for up to 8 hours, until I use an action to repeat the command word, or it reaches 0 HP. It is friendly to me and my allies, understands my languages, and obeys my spoken commands. If I issue no commands, the creature defends itself but takes no other actions. Once per year, I can have it become an adult gold dragon for up to 1 hour. When it reverts back to a figurine, it can't be used again until the next dawn (canary) or 1 year has passed (dragon).",
	descriptionFull : "This gold statuette is carved in the likeness of a canary and is small enough to fit in a pocket. If you use an action to speak the command word and throw the figurine to a point on the ground within 60 feet of you, the figurine becomes a living creature in one of two forms (you choose). If there isn't enough space for the creature where it would appear, the figurine doesn't become a creature. The two forms are as follows:"+
	"\n   " + toUni("Giant Canary Form") + ". The figurine becomes a giant canary for up to 8 hours and can be ridden as a mount. Once the figurine has become a giant canary, it can't be used this way again until the next dawn."+
	"\n   " + toUni("Gold Dragon Form") + ". While you are missing half or more of your hit points, you can speak a different command word and the figurine becomes an adult gold dragon (see its stat block in the Monster Manual) for up to 1 hour. The dragon can't use any legendary actions or lair actions. Once the figurine has become an adult gold dragon, it can't be used this way again until 1 year has passed."+
	"\n   In either form, the creature is friendly to you and your companions. It understands your languages and obeys your spoken commands. If you issue no commands, the creature defends itself but takes no other actions."+
	"\n   The creature exists for a duration specific to each form. At the end of the duration, the creature reverts to its figurine form. It reverts to a figurine early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature becomes a figurine again, its property can't be used again until a certain amount of time has passed, as specified in the description.",
	extraLimitedFeatures : [{
		name : "Gold Canary Figurine [canary form]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Gold Canary Figurine [dragon form]",
		usages : 1,
		recovery : "1 year"
	}]
}, false, true);
MagicItemsList["platinum scarf"] = {
	name : "Platinum Scarf",
	source : [["FToD", 24]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "As an action, I can pull a scale from this scarf, of which it has 3 per dawn. When I do so, I can choose the effect: heal 10d4 HP to a creature I touch, or for 1 hour it becomes a shield (+1 shield that grants radiant damage immunity) or a light hammer (deals 2d4 radiant damage and +2d4 to chromatic dragons).",
	descriptionFull : "This scarf is made of sturdy cloth and covered in platinum-colored scales."+
	"\n   As an action, you can pull a scale from the scarf and speak a command word. When you do so, choose one of the following effects:"+
	"\n   " + toUni("Breath of Life") + ". The scale disappears, and you or a creature you touch regains 10d4 hit points."+
	"\n   " + toUni("Platinum Shield") + ". For 1 hour or until you dismiss it (no action required), the scale becomes a +1 shield, which you or another creature can use. A creature wielding the shield has immunity to radiant damage."+
	"\n   " + toUni("Radiant Hammer") + ". For 1 hour or until you dismiss it (no action required), the scale becomes a magic light hammer, which you or another creature can use. The weapon deals 2d4 radiant damage, instead of the bludgeoning damage normal for a light hammer. It deals an extra 2d4 radiant damage to chromatic dragons."+
	"\n   Once three scales have been pulled from the scarf, no more scales can be removed until the next dawn, when all the missing scales grow back. If you pull off a scale but don't speak a command word, it disappears after 1 minute.",
	usages : 3,
	recovery : "dawn",
	action : [["action", ""]],
	weaponOptions : [{
		baseWeapon : "light hammer",
		regExpSearch : /^(?=.*platinum scarf)(?=.*radiant hammer).*$/i,
		name : "Platinum Scarf's Radiant Hammer",
		damage : [2, 4, "radiant"],
		source : [["FToD", 24]],
		description : "Light, thrown; +2d4 damage vs. chromatic dragons",
		selectNow : true
	}]
}
MagicItemsList["potion of dragon's majesty"] = function () { // NOG AFMAKEN!!!!
	var obj = {
		name : "Potion of Dragon's Majesty",
		source : [["FToD", 24]],
		type : "potion",
		rarity : "legendary",
		description : "Once as an action, I can drink this potion or administer it to transform into an adult dragon for 1 hour. They can't use Change Shape, legendary actions, or lair actions. They retain languages, personality, and memories, but their equipment melds into the form or falls to the ground (their choice).",
		descriptionFull : "This potion looks like liquid gold, with a single scale from a chromatic, gem, or metallic dragon suspended in it. When you drink this potion, you transform into an adult dragon of the same kind as the dragon the scale came from. The transformation lasts for 1 hour. Any equipment you are wearing or carrying melds into your new form or falls to the ground (your choice). For the duration, you use the game statistics of the adult dragon instead of your own, but you retain your languages, personality, and memories. You can't use a dragon's Change Shape or its legendary or lair actions.",
		weight : 0.5,
		choices : [],
		allowDuplicates : true,
		choicesNotInMenu : true
	}
	var aDragons = ["Black", "Blue", "Green", "Red", "White", "Amethyst", "Crystal", "Emerald", "Sapphire", "Topaz", "Brass", "Bronze", "Copper", "Gold", "Silver"];
	for (var i = 0; i < aDragons.length; i++) {
		var sDragon = aDragons[i];
		var sNameChoice = sDragon + " Dragon";
		obj.choices.push(sNameChoice);
		obj[sNameChoice.toLowerCase()] = {
			name : "Potion of " + sDragon + " Dragon's Majesty",
			description : "Once as an action, I can drink this potion or administer it to transform into an adult " + sDragon.toLowerCase() + " dragon for 1 hour. They can't use Change Shape, legendary actions, or lair actions. They retain languages, personality, and memories, but their equipment melds into the form or falls to the ground (their choice)."
		}
	}
	return obj;
}();
MagicItemsList["ruby weave gem"] = {
	name : "Ruby Weave Gem",
	source : [["FToD", 24]],
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "While I hold this gem, I can use it as my spellcasting focus. It has 3 charges per dawn. When I cast a spell while holding it, I can use charges to ignore 500 gp per charge of components with a gp cost. When I finish a long rest, I learn any one spell of a level I can cast until my next long rest. I can cast it using spell slots.",
	descriptionFull : "While you are holding this gem, you can use it as a spellcasting focus for your spells."+
	"\n   The gem has 3 charges and regains all expended charges daily at dawn. When you cast a spell while holding this gem, you can expend up to 3 charges to ignore the spell's material components with a gold piece cost, up to 500 gp per charge expended."+
	"\n   When you finish a long rest, choose a spell from any class list. The spell you choose must be of a level you can cast. You know the chosen spell and can cast it with your spell slots of the appropriate level until the end of your next long rest.",
	usages : 3,
	recovery : "dawn",
	spellcastingAbility : "class",
	spellcastingBonus : [{
		name : "Any one spell per LR, so",
		"class" : "any",
		psionic : false,
		firstCol : "checkbox"
	}, {
		name : "add as many as needed",
		"class" : "any",
		psionic : false,
		firstCol : "checkbox"
	}, {
		name : "to have some choices.",
		"class" : "any",
		psionic : false,
		firstCol : "checkbox"
	}]
}
MagicItemsList["sapphire buckler"] = {
	name : "Sapphire Buckler",
	source : [["FToD", 24]],
	type : "shield",
	rarity : "very rare",
	attunement : true,
	description : "While I wield this crystalline blue shield, I have resistance to psychic and thunder damage. As a reaction when I take damage from a creature within 5 ft, I can deal it 2d6 thunder damage. As an action once per dawn, I can use it to know the direction of all aberrations within 1 mile until the end of my next turn.",
	descriptionFull : "This crystalline blue shield is fashioned from a sapphire dragon's scale and is created to aid in rooting out the influence of Aberrations. While wielding the shield, you have resistance to psychic and thunder damage. Also, when you take damage from a creature that is within 5 feet of you, you can use your reaction to deal 2d6 thunder damage to that creature."+
	"\n   As an action, you can use the shield to help you locate Aberrations until the end of your next turn. If any Aberrations are within 1 mile of you, the shield emits a low humming tone for a moment, and you know the direction of all Aberrations within that range. Once this property is used, it can't be used again until the next dawn.",
	weight : 6,
	shieldAdd : "Sapphire Buckler",
	dmgres : ["Psychic", "Thunder"],
	action : [["reaction", " (damaged in melee)"], ["action", " (locate aberrations)"]]
}
MagicItemsList["topaz annihilator"] = {
	name : "Topaz Annihilator",
	source : [["FToD", 24]],
	type : "weapon (firearm)",
	rarity : "legendary",
	attunement : true,
	description : "This magical firearm deals 2d6 necrotic damage on a hit. It has the two-handed property, requires no ammunition, 100 ft short range, and 300 ft long range. Targets reduced to 0 HP by it turn to dust and only True Resurrection or Wish can restore them to life. Once per dawn, I can use it to cast Disintegrate (DC 18).",
	descriptionFull : "This magic ranged weapon resembles a musket, but in lieu of any ammunition, it holds a glowing yellow scale from a topaz dragon in its heart."+
	"\n   The weapon has a normal range of 100 feet and a long range of 300 feet, and it has the two-handed property. It deals 2d6 necrotic damage on a hit. If this damage reduces a creature or object to 0 hit points, the target is reduced to dust. A creature reduced to dust can be restored to life only by a true resurrection or wish spell."+
	"\n   While the weapon is on your person, you can use an action to cast the disintegrate spell (save DC 18). Once this property is used, it can't be used again until the next dawn.",
	weaponOptions : [{
		regExpSearch : /^(?=.*Topaz)(?=.*tiamat).*$/i,
		name : "Topaz Annihilator",
		source : [["FToD", 24]],
		ability : 2,
		type : "firearm",
		damage : [2, 6, "necrotic"],
		range : "100/300 ft",
		weight : 10,
		description : "Two-handed; Targets reduced to 0 HP turn to dust",
		abilitytodamage : true,
		selectNow : true
	}],
	usages : 1,
	recovery : "dawn",
	additional : "Disintegrate",
	fixedDC : 18,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["disintegrate"],
		selection : ["disintegrate"],
		firstCol : "oncelr"
	},
}
var FToD_HoardItems = {
	"dragon's wrath weapon" : [
		"This weapon is decorated with dragon heads, claws, wings, scales, or Draconic letters. When it steeps in a dragon's hoard, it absorbs the energy of the dragon's breath weapon and deals damage of that type with its special properties.",
		">>Slumbering (Uncommon)<<. Whenever you roll a 20 on your attack roll with this weapon, each creature of your choice within 5 feet of the target takes 5 damage of the type dealt by the dragon's breath weapon.",
		">>Stirring (Rare)<<. The Stirring weapon has the Slumbering property. In addition, you gain a +1 bonus to attack and damage rolls made using the weapon. On a hit, the weapon deals an extra 1d6 damage of the type dealt by the dragon's breath weapon.",
		">>Wakened (Very Rare)<<. The Wakened weapon has the Slumbering property, and it improves on the Stirring property. The bonus to attack and damage rolls increases to +2, and the extra damage dealt by the weapon increases to 2d6.",
		"As an action, you can unleash a 30-foot cone of destructive energy from the weapon. Each creature in that area must make a DC 16 Dexterity saving throw, taking 8d6 damage of the type dealt by the dragon's breath weapon on a failed save, or half as much damage on a successful one. Once this action is used, it can't be used again until the next dawn.",
		">>Ascendant (Legendary)<<. The Ascendant weapon has the Slumbering property, and it improves on the Stirring and Wakened properties. The bonus to attack and damage rolls increases to +3, and the extra damage dealt by the weapon increases to 3d6.",
		"The cone of destructive energy the weapon creates increases to a 60-foot cone, the save DC increases to 18, and the damage increases to 12d6."
	],
	"dww-slumbering" : {
		description : "This magic weapon decorated with draconic ornaments has absorbed the energy of >>a dragon<< dragon's breath weapon. Whenever I roll a 20 on an attack roll with it, each creature of my choice within 5 ft of the target takes 5 >>dmg type<< damage.",
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && (v.isMeleeWeapon || v.isRangedWeapon) && /^(?=.*slumbering)(?=.*\b(black|blue|green|red|white|amethyst|crystal|emerald|sapphire|topaz|brass|bronze|copper|gold|silver).(dragon'?s?.wrath|DW)\b).*$/i.test(v.WeaponTextName)) {
						var sWeaNmLC = v.WeaponTextName.toLowerCase();
						var aDragons = [["black", "acid"], ["blue", "lightning"], ["green", "poison"], ["red", "fire"], ["white", "cold"], ["amethyst", "force"], ["crystal", "radiant"], ["emerald", "psychic"], ["sapphire", "thunder"], ["topaz", "necrotic"], ["brass", "fire"], ["bronze", "lightning"], ["copper", "acid"], ["gold", "fire"], ["silver", "cold"]];
						var sDmgType = false;
						for (var i = 0; i < aDragons.length; i++) {
							if (sWeaNmLC.indexOf(aDragons[i][0]) !== -1) {
								sDmgType = aDragons[i][1];
								break;
							}
						}
						if (!sDmgType) return;
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + 'On 20 to hit: 5 ' + sDmgType + ' damage to chosen in 5 ft of target';
					};
				},
				"If I include the words \"TYPE Dragon's Wrath\" or \"TYPE DW\" (where \"TYPE\" is replaced with a dragon's type like \"Red\") and \"Slumbering\" in the name of a weapon, it will be treated as the magic item Slumbering Dragon's Wrath Weapon (e.g. \"Red DW Longbow (slumbering)\"). Whenever I roll a 20 on an attack roll with a slumbering dragon's wrath weapon, each creature of my choice within 5 ft of the target takes 5 damage of the associated dragon's type. "
			]
		}
	},
	"dww-stirring" : {
		description : "This dragon decorated weapon has absorbed the energy of >>a dragon<< dragon's breath weapon. I add +1 on attack and damage rolls made with it and it deals +1d6 >>dmg type<< damage. When I roll a 20 on an attack roll with it, each creature of my choice within 5 ft of the target takes 5 >>dmg type<< damage.",
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && (v.isMeleeWeapon || v.isRangedWeapon) && /^(?=.*stirring)(?=.*\b(black|blue|green|red|white|amethyst|crystal|emerald|sapphire|topaz|brass|bronze|copper|gold|silver).(dragon'?s?.wrath|DW)\b).*$/i.test(v.WeaponTextName)) {
						var sWeaNmLC = v.WeaponTextName.toLowerCase();
						var aDragons = [["black", "acid"], ["blue", "lightning"], ["green", "poison"], ["red", "fire"], ["white", "cold"], ["amethyst", "force"], ["crystal", "radiant"], ["emerald", "psychic"], ["sapphire", "thunder"], ["topaz", "necrotic"], ["brass", "fire"], ["bronze", "lightning"], ["copper", "acid"], ["gold", "fire"], ["silver", "cold"]];
						var sDmgType = false;
						for (var i = 0; i < aDragons.length; i++) {
							if (sWeaNmLC.indexOf(aDragons[i][0]) !== -1) {
								sDmgType = aDragons[i][1];
								break;
							}
						}
						if (!sDmgType) return;
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + '+1d6 ' + sDmgType + ' damage; On 20: 5 ' + sDmgType + ' damage to chosen in 5 ft of target';
					};
				},
				"If I include the words \"TYPE Dragon's Wrath\" or \"TYPE DW\" (where \"TYPE\" is replaced with a dragon's type like \"Red\") and \"Stirring\" in the name of a weapon, it will be treated as the magic item Stirring Dragon's Wrath Weapon (e.g. \"Red DW Longbow (stirring)\"). A stirring dragon's wrath weapon adds +1 to attack and damage rolls made with it. On a hit, the weapon deals an extra +1d6 damage and on a 20 on an attack roll with it, each creature of my choice within 5 ft of the target takes 5 damage. The damage is of the associated dragon's type."
			],
			atkCalc : [
				function (fields, v, output) {
					if (!v.theWea.isMagicWeapon && (v.isMeleeWeapon || v.isRangedWeapon) && /^(?=.*stirring)(?=.*\b(dragon'?s?.wrath|DW)\b).*$/i.test(v.WeaponTextName)) {
						v.theWea.isMagicWeapon = true;
						output.magic = v.thisWeapon[1] + 1;
					}
				}, ''
			]
		}
	},
	"dww-wakened" : {
		description : "This weapon uses >>dmg type<< of >>a dragon<< dragon. It adds +2 to its attack and damage rolls and deals +2d6 >>dmg type<< damage. On a 20 to hit, any creature of my choice in 5 ft of the target take 5 damage. As an action once per dawn, it can do a 30-ft cone, Dex DC 16 half, 8d6 damage dragon breath.",
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && (v.isMeleeWeapon || v.isRangedWeapon) && /^(?=.*wakened)(?=.*\b(black|blue|green|red|white|amethyst|crystal|emerald|sapphire|topaz|brass|bronze|copper|gold|silver).(dragon'?s?.wrath|DW)\b).*$/i.test(v.WeaponTextName)) {
						var sWeaNmLC = v.WeaponTextName.toLowerCase();
						var aDragons = [["black", "acid"], ["blue", "lightning"], ["green", "poison"], ["red", "fire"], ["white", "cold"], ["amethyst", "force"], ["crystal", "radiant"], ["emerald", "psychic"], ["sapphire", "thunder"], ["topaz", "necrotic"], ["brass", "fire"], ["bronze", "lightning"], ["copper", "acid"], ["gold", "fire"], ["silver", "cold"]];
						var sDmgType = false;
						for (var i = 0; i < aDragons.length; i++) {
							if (sWeaNmLC.indexOf(aDragons[i][0]) !== -1) {
								sDmgType = aDragons[i][1];
								break;
							}
						}
						if (!sDmgType) return;
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + '+2d6 ' + sDmgType + ' damage; On 20: 5 ' + sDmgType + ' damage to chosen in 5 ft of target';
					};
				},
				"If I include the words \"TYPE Dragon's Wrath\" or \"TYPE DW\" (where \"TYPE\" is replaced with a dragon's type like \"Red\") and \"Wakened\" in the name of a weapon, it will be treated as the magic item Wakened Dragon's Wrath Weapon (e.g. \"Red DW Longbow (wakened)\"). A wakened dragon wrath weapon adds +2 to attack and damage rolls made with it. On a hit, the weapon deals an extra +2d6 damage and on a 20 on an attack roll with it, each creature of my choice within 5 ft of the target takes 5 damage. The damage is of the associated dragon's type."
			],
			atkCalc : [
				function (fields, v, output) {
					if (!v.theWea.isMagicWeapon && (v.isMeleeWeapon || v.isRangedWeapon) && /^(?=.*wakened)(?=.*\b(dragon'?s?.wrath|DW)\b).*$/i.test(v.WeaponTextName)) {
						v.theWea.isMagicWeapon = true;
						output.magic = v.thisWeapon[1] + 2;
					}
				}, ''
			]
		},
		usages : 1,
		recovery : "dawn",
		limfeaname : ">>dragon<< Dragon's Wrath Breath (wakened)",
		action : [["action", ""]],
		weaponOptions : [{
			regExpSearch : "^(?=.*wakened)(?=.*>>dragon<< (dragon'?s? wrath|DW))(?=.*breath).*$",
			name : ">>dragon<< Dragon's Wrath Breath (wakened)",
			source : [["FToD", 25]],
			ability : 0,
			type : "Magic Item",
			damage : [8, 6, ">>type<<"],
			range : "30-ft cone",
			description : "Hits all in area; Dex save, success - half damage; Usable only once per dawn",
			abilitytodamage : false,
			dc : true,
			modifiers : [8, ""],
			selectNow : true
		}]
	},
	"dww-ascendant" : {
		description : "This weapon uses >>dmg type<< of >>a dragon<< dragon. It adds +3 to its attack and damage rolls and deals +3d6 >>dmg type<< damage. On a 20 to hit, any creature of my choice in 5 ft of the target take 5 damage. As an action once per dawn, it can do a 60-ft cone, Dex DC 18 half, 12d6 damage dragon breath.",
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && (v.isMeleeWeapon || v.isRangedWeapon) && /^(?=.*ascendant)(?=.*\b(black|blue|green|red|white|amethyst|crystal|emerald|sapphire|topaz|brass|bronze|copper|gold|silver).(dragon'?s?.wrath|DW)\b).*$/i.test(v.WeaponTextName)) {
						var sWeaNmLC = v.WeaponTextName.toLowerCase();
						var aDragons = [["black", "acid"], ["blue", "lightning"], ["green", "poison"], ["red", "fire"], ["white", "cold"], ["amethyst", "force"], ["crystal", "radiant"], ["emerald", "psychic"], ["sapphire", "thunder"], ["topaz", "necrotic"], ["brass", "fire"], ["bronze", "lightning"], ["copper", "acid"], ["gold", "fire"], ["silver", "cold"]];
						var sDmgType = false;
						for (var i = 0; i < aDragons.length; i++) {
							if (sWeaNmLC.indexOf(aDragons[i][0]) !== -1) {
								sDmgType = aDragons[i][1];
								break;
							}
						}
						if (!sDmgType) return;
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + '+3d6 ' + sDmgType + ' damage; On 20: 5 ' + sDmgType + ' damage to chosen in 5 ft of target';
					};
				},
				"If I include the words \"TYPE Dragon's Wrath\" or \"TYPE DW\" (where \"TYPE\" is replaced with a dragon's type like \"Red\") and \"Ascendant\" in the name of a weapon, it will be treated as the magic item Ascendant Dragon's Wrath Weapon (e.g. \"Red DW Longbow (ascendant)\"). An ascendant dragon wrath weapon adds +3 to attack and damage rolls made with it. On a hit, the weapon deals an extra +3d6 damage and on a 20 on an attack roll with it, each creature of my choice within 5 ft of the target takes 5 damage. The damage is of the associated dragon's type."
			],
			atkCalc : [
				function (fields, v, output) {
					if (!v.theWea.isMagicWeapon && (v.isMeleeWeapon || v.isRangedWeapon) && /^(?=.*ascendant)(?=.*\b(dragon'?s?.wrath|DW)\b).*$/i.test(v.WeaponTextName)) {
						v.theWea.isMagicWeapon = true;
						output.magic = v.thisWeapon[1] + 3;
					}
				}, ''
			]
		},
		usages : 1,
		recovery : "dawn",
		limfeaname : ">>dragon<< Dragon's Wrath Breath (ascendant)",
		action : [["action", "Dragon's Wrath Breath Weapon"]],
		weaponOptions : [{
			regExpSearch : "^(?=.*ascendant)(?=.*>>dragon<< (dragon'?s? wrath|DW))(?=.*breath).*$",
			name : ">>dragon<< Dragon's Wrath Breath (ascendant)",
			source : [["FToD", 25]],
			ability : 0,
			type : "Magic Item",
			damage : [12, 6, ">>type<<"],
			range : "60-ft cone",
			description : "Hits all in area; Dex save, success - half damage; Usable only once per dawn",
			abilitytodamage : false,
			dc : true,
			modifiers : [10, ""],
			selectNow : true
		}]
	},
	dragonsWrathWeaponCreate : function() {
		var aTypes = [["Slumbering", "uncommon"], ["Stirring", "rare"], ["Wakened", "very rare"], ["Ascendant", "legendary"]];
		var aDragons = [["Black", "acid"], ["Blue", "lightning"], ["Green", "poison"], ["Red", "fire"], ["White", "cold"], ["Amethyst", "force"], ["Crystal", "radiant"], ["Emerald", "psychic"], ["Sapphire", "thunder"], ["Topaz", "necrotic"], ["Brass", "fire"], ["Bronze", "lightning"], ["Copper", "acid"], ["Gold", "fire"], ["Silver", "cold"]];
		var aVowels = ["a", "e"];
		var sDescriptionFull = FToD_HoardItems["dragon's wrath weapon"].join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); });
		var sNotesDescription = FToD_HoardItems.to1stPerson(FToD_HoardItems["dragon's wrath weapon"]);
		for (var t = 0; t < aTypes.length; t++) {
			var sItemType = aTypes[t][0];
			var sItemTypeLC = aTypes[t][0].toLowerCase();
			var sItemName = "Dragon's Wrath Weapon (" + sItemTypeLC + ")";
			var sItemNameLC = sItemName.toLowerCase();
			var oDwwObj = FToD_HoardItems["dww-"+sItemTypeLC];
			MagicItemsList[sItemNameLC] = {
				name : sItemName,
				source : [["FToD", 25]],
				type : "weapon (any)",
				rarity : aTypes[t][1],
				attunement : true,
				description : oDwwObj.description.replace(/>>a dragon<</ig, "a").replace(/>>dmg type<< /ig, ""),
				descriptionFull : sDescriptionFull,
				toNotesPage : [{
					name : "Full Text",
					note : sNotesDescription
				}],
				allowDuplicates : true,
				choicesNotInMenu : true,
				choices : []
			}
			for (var sAttr in oDwwObj) {
				if (/^(description|weaponOptions|limfeaname)$/.test(sAttr)) continue;
				MagicItemsList[sItemNameLC][sAttr] = oDwwObj[sAttr];
			}
			for (var i = 0; i < aDragons.length; i++) {
				var sDragon = aDragons[i][0];
				var sDragonLC = sDragon.toLowerCase();
				var sDmg = aDragons[i][1];
				var sNameChoice = sDragon + " dragon (" + sDmg + ")";
				var sNameChoiceLC = sNameChoice.toLowerCase();
				var sNameTest = sItemType + " " + sDragon + " Dragon's Wrath";
				var sAorAnDragon = (aVowels.indexOf(sDragonLC[0]) === -1 ? "a " : "an ") + sDragonLC;
				MagicItemsList[sItemNameLC].choices.push(sNameChoice);
				MagicItemsList[sItemNameLC][sNameChoiceLC] = {
					name : sNameTest + " Weapon",
					nameTest : sNameTest,
					description : oDwwObj.description.replace(/>>a dragon<</ig, sAorAnDragon).replace(/>>dmg type<</ig, sDmg),
					chooseGear : {
						type : "weapon",
						prefixOrSuffix : "suffix",
						descriptionChange : ["replace", "weapon"],
						itemName1stPage : ["between", sDragon + " Dragon's Wrath", "(" + sItemTypeLC + ")"]
					}
				}
				if (oDwwObj.limfeaname) {
					MagicItemsList[sItemNameLC][sNameChoiceLC].limfeaname = [oDwwObj.limfeaname.replace(/>>dragon<</ig, sDragon)]
				}
				if (oDwwObj.weaponOptions) {
					MagicItemsList[sItemNameLC][sNameChoiceLC].weaponOptions = {};
					for (var sAttr in oDwwObj.weaponOptions) {
						var toSet = oDwwObj.weaponOptions[sAttr];
						switch (sAttr) {
							case "regExpSearch":
								toSet = RegExp(toSet.replace(/>>dragon<</ig, sDragonLC), "i");
								break;
							case "name":
								toSet = toSet.replace(/>>dragon<</ig, sDragon);
								break;
							case "damage":
								toSet = [toSet[0], toSet[1], sDmg];
								break;
						}
						MagicItemsList[sItemNameLC][sNameChoiceLC].weaponOptions[sAttr] = toSet;
					}
				}
			}
		}
	},
	"dragon-touched focus" : [
		"This wondrous item can be a scepter, an orb, an amulet, a crystal, or another finely crafted object. It typically incorporates imagery of dragons' wings, claws, teeth, or scales.",
		">>Slumbering (Uncommon)<<. You have advantage on initiative rolls. While you are holding the focus, it can function as a spellcasting focus for all your spells.",
		">>Stirring (Rare)<<. The Stirring focus has the Slumbering property, and it gains an additional property determined by the family of the dragon in whose hoard it became Stirring:",
		"\u2022 Chromatic. Whenever you use a spell slot to cast a spell that deals acid, cold, fire, lightning, or poison damage, roll a d6, and you gain a bonus equal to the number rolled to one of the spell's damage rolls.",
		"\u2022 Gem. Whenever you use a spell slot to cast a spell, you can immediately teleport to an unoccupied space you can see within 15 feet of you.",
		"\u2022 Metallic. When a creature you can see within 30 feet of you makes a saving throw, you can use your reaction to give that creature advantage on the saving throw.",
		">>Wakened (Very Rare)<<. The Wakened focus has the Slumbering and Stirring properties, and while you are holding a Wakened focus, you can use it to cast certain spells. Once the item is used to cast a given spell, it can't be used to cast that spell again until the next dawn. The spells are determined by the family of the dragon in whose hoard it became Wakened. An asterisk indicates a new spell that appears earlier in this chapter.",
		"\u2022 Chromatic. Hold monster, Rime's binding ice",
		"\u2022 Gem. Rary's telepathic bond, Raulothim's psychic lance",
		"\u2022 Metallic. Fizban's platinum shield, legend lore",
		">>Ascendant (Legendary)<<. The Ascendant focus has the Slumbering, Stirring, and Wakened properties. In addition, when you cast a spell of 1st level or higher while holding this focus, you can treat the spell as if it were cast using a 9th-level spell slot. Once this property is used, it can't be used again until the next dawn."
	],
	dtf_chromatic : {
		calcChanges : {
			spellAdd : [
				function (spellKey, spellObj, spName) {
					if (CurrentSpells[spName].refType == "class" && !spellObj.psionic && spellObj.level !== 0 && (/(check|checked|marked)box/i.test(spellObj.firstCol) || (spName === "warlock" && !/atwill|sp/i.test(spellObj.firstCol)))) return genericSpellDmgEdit(spellKey, spellObj, "acid|cold|fire|lightning|lightn\\.?|poison", "1d6", true, true);
				},
				"Whenever I use a spell slot to cast a spell that deals acid, cold, fire, lightning, or poison damage, roll a d6, and I gain a bonus equal to the number rolled to one of the spell's damage rolls."
			]
		},
		extraLimitedFeatures : [{
			name : "Dragon-Touched Focus (Hold Monster)",
			usages : 1,
			recovery : "dawn"
		}, {
			name : "Dragon-Touched Focus (Rime's Binding Ice)",
			usages : 1,
			recovery : "dawn"
		}],
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["hold monster", "rime's binding ice"],
			selection : ["hold monster", "rime's binding ice"],
			firstCol : "oncelr",
			times : 2
		}
	},
	dtf_gem : {
		extraLimitedFeatures : [{
			name : "Dragon-Touched Focus (Rary's Telepathic Bond)",
			usages : 1,
			recovery : "dawn"
		}, {
			name : "Dragon-Touched Focus (R's Psychic Lance)",
			usages : 1,
			recovery : "dawn"
		}],
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["rary's telepathic bond", "raulothim's psychic lance"],
			selection : ["rary's telepathic bond", "raulothim's psychic lance"],
			firstCol : "oncelr",
			times : 2
		}
	},
	dtf_metallic : {
		extraLimitedFeatures : [{
			name : "Dragon-Touched Focus (F's Platinum Shield)",
			usages : 1,
			recovery : "dawn"
		}, {
			name : "Dragon-Touched Focus (Legend Lore)",
			usages : 1,
			recovery : "dawn"
		}],
		spellcastingBonus : {
			name : "Once per dawn",
			spells : ["fizban's platinum shield", "legend lore"],
			selection : ["fizban's platinum shield", "legend lore"],
			firstCol : "oncelr",
			times : 2
		}
	},
	dtf_ascendant : {
		extraLimitedFeatures : [{
			name : "Dragon-Touched Focus (upcast to 9th-level)",
			usages : 1,
			recovery : "dawn"
		}]
	},
	"dragon vessel" : [
		"This vessel can be a potion bottle, drinking horn, or other container meant to hold a liquid.",
		">>Slumbering (Uncommon)<<. As a bonus action, if the vessel is empty, you can speak the command word to fill the vessel with one of the following (your choice): ale, olive oil, a potion of healing, or a potion of climbing. Once this property is used, it can't be used until the next dawn. A potion you create in this way loses its magical properties if it isn't imbibed within 24 hours.",
		">>Stirring (Rare)<<. In addition to the options for a Slumbering vessel, you can fill a Stirring vessel with mead, a potion of fire breath, or a potion of healing (greater).",
		">>Wakened (Very Rare)<<. In addition to the options for a Slumbering or Stirring vessel, you can fill a Wakened vessel with wine, a potion of flying, or a potion of healing (superior).",
		">>Ascendant (Legendary)<<. In addition to the options for other states, you can fill an Ascendant vessel with whiskey, a potion of healing (supreme), or a potion of dragon's majesty (described earlier in this chapter)."
	],
	"scaled ornament" : [
		"This ornament can be jewelry, a cloak, or another wearable accessory. It appears to be fashioned from a dragon's scale, tooth, or claw, or it incorporates images in those shapes.",
		">>Slumbering (Uncommon)<<. You have advantage on saving throws you make to avoid being charmed or frightened or to end those conditions on you.",
		">>Stirring (Rare)<<. You gain a +1 bonus to AC, and you can't be charmed or frightened. Moreover, each creature of your choice within 30 feet of you has advantage on saving throws it makes to avoid being charmed or frightened or to end those conditions on itself.",
		">>Wakened (Very Rare)<<. The Wakened ornament has the Stirring property. In addition, when you would take damage of the type dealt by the breath of the dragon in whose hoard the ornament became Wakened, you can use your reaction to take no damage instead, and you regain hit points equal to the damage you would have taken. Once this property is used, it can't be used again until the next dawn.",
		">>Ascendant (Legendary)<<. The Ascendant ornament has the Stirring and Wakened properties. In addition, while you are wearing the ornament, you gain a flying speed equal to your walking speed and can hover. While you are flying using this speed, spectral dragon wings appear on your back."
	],
	hoardMagicItems : [
		"\n\n\u25C6 Hoard Magic Items (FToD 25)",
		"Certain magic items can absorb the ambient magic of a dragon's hoard. The mightier the dragon, the more powerful the item becomes when it is steeped in the dragon's hoard. These items, called hoard items, have four states A hoard item in its Slumbering state has certain base properties, and it gains additional properties when it enters the Stirring (young dragon), Wakened (adult dragon), or Ascendant (ancient dragon) state.",
		"Ordinarily, a hoard item must steep in a dragon's hoard for 1 year to reach the maximum possible state allowed by the age of the hoard's dragon. For example, a hoard item that steeps in an adult dragon's hoard for 1 year enters its Wakened state.",
		"When a dragon is slain, the magic surrounding its hoard becomes volatile. This allows a hoard item to steep more quickly in the hoard. A hoard item steeped in a dragon's hoard for 8 hours rises one state, as long as the steeping begins within 1 hour of the dragon's death and occurs within the dragon's lair. Steeping in this way can't raise the state of the item beyond the state associated with the dragon's age.",
		"Just as hoard items can grow in power by absorbing the ambient magic of a dragon's hoard, so too can these treasures fall back into slumber. If no creature is attuned to a hoard item and that item isn't in a dragon's hoard, the item decreases in power by one state every 30 days until it is Slumbering."
	].join("\n   "),
	to1stPerson : function (sDescr) {
		return desc(sDescr).replace(/\bf(oo|ee)t\b/ig, "ft")
			.replace(/you are/ig, "I am").replace(/\byou\b/ig, "I")
			.replace(/(by|of|to|for|on) I\b|\bI to|\bI an?\b/ig, "$1 me")
			.replace(/\bI (to|a|an)\b/ig, "me $1")
			.replace(/your/g, "my").replace(/Your/g, "My")
			.replace(/   >>(.*?)( \(.*?\))?<<. /g, function(a, p1, p2) { return "\n   " + p1.toUpperCase() + p2.toLowerCase() + "\n   "; })+
			FToD_HoardItems.hoardMagicItems;
	}
}
FToD_HoardItems.dragonsWrathWeaponCreate();
MagicItemsList["dragon-touched focus"] = {
	name : "Dragon-Touched Focus",
	nameTest : /^(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
	source : [["FToD", 26]],
	type : "wondrous item",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "",
	descriptionFull : FToD_HoardItems["dragon-touched focus"].join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Full Text",
		note : FToD_HoardItems.to1stPerson(FToD_HoardItems["dragon-touched focus"])
	}],
	allowDuplicates : true,
	choicesNotInMenu : true,
	advantages : [["Initiative", true]],
	choices : ["Slumbering (uncommon)", "Stirring - Chromatic (rare)", "Stirring - Gem (rare)", "Stirring - Metallic (rare)", "Wakened - Chromatic (very rare)",  "Wakened - Gem (very rare)",  "Wakened - Metallic (very rare)", "Ascendant - Chromatic (legendary)", "Ascendant - Gem (legendary)", "Ascendant - Metallic (legendary)"],
	"slumbering (uncommon)" : {
		name : "Dragon-Touched Focus (slumbering)",
		nameTest : /^(?=.*slumbering)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "uncommon",
		description : "This wondrous item can be a scepter, an orb, an amulet, a crystal, or another finely crafted object. It typically incorporates imagery of dragons' wings, claws, teeth, or scales. It grants me advantage on initiative rolls. While I am holding the focus, it can function as a spellcasting focus for all my spells."
	},
	"stirring - chromatic (rare)" : {
		name : "Chromatic Dragon-Touched Focus (stirring)",
		nameTest : /^(?=.*chromatic)(?=.*stirring)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "rare",
		description : "This ornate object with imagery of chromatic dragon limbs or scales grants me advantage on initiative rolls. While I am holding it, I can use it as my spellcasting focus and when I use a spell slot to cast a spell that deals acid, cold, fire, lightning, or poison damage, I can add +1d6 to one of the spell's damage rolls.",
		calcChanges : FToD_HoardItems.dtf_chromatic.calcChanges
	},
	"stirring - gem (rare)" : {
		name : "Gem Dragon-Touched Focus (stirring)",
		nameTest : /^(?=.*gem)(?=.*stirring)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "rare",
		description : "This ornate object with imagery of gem dragon limbs or scales grants me advantage on initiative rolls. While I am holding it, I can use it as my spellcasting focus and when I use a spell slot to cast a spell I can immediately teleport to an unoccupied space I can see within 15 ft."
	},
	"stirring - metallic (rare)" : {
		name : "Metallic Dragon-Touched Focus (stirring)",
		nameTest : /^(?=.*metallic)(?=.*stirring)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "rare",
		description : "This ornate object with imagery of metallic dragon limbs or scales grants me advantage on initiative rolls. While I am holding it, I can use it as my spellcasting focus. As a reaction when a creature I can see within 30 ft makes a saving throw, I can grant it advantage on that save.",
		action : [["reaction", "Dragon-Touched Focus (adv. on save)"]]
	},
	"wakened - chromatic (very rare)" : {
		name : "Chromatic Dragon-Touched Focus (wakened)",
		nameTest : /^(?=.*chromatic)(?=.*wakened)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "very rare",
		description : "While holding this object, I can use it as my spellcasting focus and I can add +1d6 to one damage roll of spells I cast with a spell slot that deal acid, cold, fire, lightning, or poison damage. It also grants me advantage on initiative and allows me to cast Hold Monster and Rime's Binding Ice each once per dawn.",
		calcChanges : FToD_HoardItems.dtf_chromatic.calcChanges,
		spellcastingAbility : "class",
		spellcastingBonus : FToD_HoardItems.dtf_chromatic.spellcastingBonus,
		extraLimitedFeatures : FToD_HoardItems.dtf_chromatic.extraLimitedFeatures
	},
	"wakened - gem (very rare)" : {
		name : "Gem Dragon-Touched Focus (wakened)",
		nameTest : /^(?=.*gem)(?=.*wakened)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "very rare",
		description : "While holding this object, I can use it as my spellcasting focus and I can immediately teleport to an unoccupied space I can see within 15 ft when I cast a spell with a spell slot. It also grants me advantage on initiative and allows me to cast Rary's Telepathic Bond and Raulothim's Psychic Lance each once per dawn.",
		spellcastingAbility : "class",
		spellcastingBonus : FToD_HoardItems.dtf_gem.spellcastingBonus,
		extraLimitedFeatures : FToD_HoardItems.dtf_gem.extraLimitedFeatures
	},
	"wakened - metallic (very rare)" : {
		name : "Metallic Dragon-Touched Focus (wakened)",
		nameTest : /^(?=.*metallic)(?=.*wakened)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "very rare",
		description : "While holding this object, I can use it as my spellcasting focus. As a reaction when a creature I can see within 30 ft makes a saving throw, I can grant it advantage on that save. It also grants me advantage on initiative and allows me to cast Fizban's Platinum Shield and Legend Lore each once per dawn.",
		action : [["reaction", "Dragon-Touched Focus (adv. on save)"]],
		spellcastingAbility : "class",
		extraLimitedFeatures : FToD_HoardItems.dtf_metallic.extraLimitedFeatures,
		spellcastingBonus : FToD_HoardItems.dtf_metallic.spellcastingBonus
	},
	"ascendant - chromatic (legendary)" : {
		name : "Chromatic Dragon-Touched Focus (ascendant)",
		nameTest : /^(?=.*chromatic)(?=.*ascendant)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "legendary",
		description : "While holding this, I can use it as my spellcasting focus and I can add 1d6 to a roll of acid, cold, fire, lightning, or poison damage for spells I cast with a spell slot. It grants me adv. on initiative and allows me to cast 2 spells once per dawn. Once per dawn, I can treat a spell I cast as if casted with a 9th-level spell slot.",
		calcChanges : FToD_HoardItems.dtf_chromatic.calcChanges,
		spellcastingAbility : "class",
		spellcastingBonus : FToD_HoardItems.dtf_chromatic.spellcastingBonus,
		extraLimitedFeatures : FToD_HoardItems.dtf_ascendant.extraLimitedFeatures.concat(FToD_HoardItems.dtf_chromatic.extraLimitedFeatures)
	},
	"ascendant - gem (legendary)" : {
		name : "Gem Dragon-Touched Focus (ascendant)",
		nameTest : /^(?=.*gem)(?=.*ascendant)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "legendary",
		description : "While holding this, I can use it as my spellcasting focus and I can teleport to an empty space I can see in 15 ft when I cast a spell with a spell slot. It also grants me adv. on initiative and allows me to cast 2 spells each once per dawn. Once per dawn, I can treat a spell I cast as if casted with a 9th-level spell slot.",
		spellcastingAbility : "class",
		spellcastingBonus : FToD_HoardItems.dtf_gem.spellcastingBonus,
		extraLimitedFeatures : FToD_HoardItems.dtf_ascendant.extraLimitedFeatures.concat(FToD_HoardItems.dtf_gem.extraLimitedFeatures)
	},
	"ascendant - metallic (legendary)" : {
		name : "Metallic Dragon-Touched Focus (ascendant)",
		nameTest : /^(?=.*metallic)(?=.*ascendant)(?=.*dragon.touched)(?=.*(focus|rod|wand|staff|scepter|orb|amulet|crystal)).*$/i,
		rarity : "legendary",
		description : "While holding this, I can use it as my spellcasting focus. As a reaction when a creature I can see in 30 ft makes a save, I can grant it adv. on that save. It also grants me adv. on initiative and allows me to cast 2 spells each once per dawn. Once per dawn, I can treat a spell I cast as if casted with a 9th-level spell slot.",
		action : [["reaction", "Dragon-Touched Focus (adv. on save)"]],
		spellcastingAbility : "class",
		extraLimitedFeatures : FToD_HoardItems.dtf_metallic.extraLimitedFeatures,
		spellcastingBonus : FToD_HoardItems.dtf_ascendant.extraLimitedFeatures.concat(FToD_HoardItems.dtf_metallic.spellcastingBonus)
	}
}
MagicItemsList["dragon vessel"] = {
	name : "Dragon Vessel",
	source : [["FToD", 27]],
	type : "wondrous item",
	attunement : true,
	description : "As a bonus action once per dawn, if this magical container is empty, I can speak the command word to fill the vessel with one liquid of my choice. The list of options depends on the level and rarity of the item.",
	descriptionFull : FToD_HoardItems["dragon vessel"].join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Full Text",
		note : FToD_HoardItems.to1stPerson(FToD_HoardItems["dragon vessel"])
	}],
	action : [["bonus action", ""]],
	usages : 1,
	recovery : "dawn",
	allowDuplicates : true,
	choicesNotInMenu : true,
	choices : ["Slumbering (uncommon)", "Stirring (rare)", "Wakened (very rare)", "Ascendant (legendary)"],
	"slumbering (uncommon)" : {
		name : "Dragon Vessel (slumbering)",
		rarity : "uncommon",
		description : "As a bonus action once per dawn, if this magical container is empty, I can speak the command word to fill the vessel with one of the following of my choice:  ale, olive oil, a potion of healing, or a potion of climbing. A potion loses its magic if it is not consumed within 24 hours."
	},
	"stirring (rare)" : {
		name : "Dragon Vessel (stirring)",
		rarity : "rare",
		description : "As a bonus action once per dawn, if this magical container is empty, I can speak the command word to fill the vessel with one of the following of my choice:  ale, mead, olive oil, a potion of healing (normal or greater), or a potion of climbing. A potion loses its magic if it is not consumed within 24 hours."
	},
	"wakened (very rare)" : {
		name : "Dragon Vessel (wakened)",
		rarity : "very rare",
		description : "As a bonus action once per dawn, if this magical container is empty, I can speak the command word to fill it with one of the following of my choice:  ale, mead, wine, olive oil, a potion of healing (normal, greater, or superior), a potion of climbing, or a potion of flying. Unused potions lose their magic after 24 hours."
	},
	"ascendant (legendary)" : {
		name : "Dragon Vessel (ascendant)",
		rarity : "legendary",
		description : "As a bonus action once per dawn, I can speak the command word to fill this empty vessel with one of my choice:  ale, mead, wine, whiskey, olive oil, a potion of healing (normal, greater, superior, or supreme), a potion of climbing, a potion of flying, or a potion of dragon's majesty. Potions lose magic after 24 hours."
	}
}
MagicItemsList["scaled ornament"] = function (n) {
	var obj = {
		name : "Scaled Ornament",
		source : [["FToD", 27]],
		type : "wondrous item",
		attunement : true,
		description : "This ornament can be jewelry, a cloak, or another wearable accessory. It appears to be fashioned from a dragon's scale, tooth, or claw, or it incorporates images in those shapes.",
		descriptionFull : FToD_HoardItems["scaled ornament"].join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
		toNotesPage : [{
			name : "Full Text",
			note : FToD_HoardItems.to1stPerson(FToD_HoardItems["scaled ornament"])
		}],
		allowDuplicates : true,
		choicesNotInMenu : true,
		choices : ["Slumbering (uncommon)", "Stirring (rare)"],
		"slumbering (uncommon)" : {
			name : "Scaled Ornament (slumbering)",
			rarity : "uncommon",
			description : "This ornament can be jewelry, a cloak, or another wearable accessory. It appears to be fashioned from a dragon's scale, tooth, or claw, or it incorporates images in those shapes. It grants me advantage on saving throws to avoid being charmed or frightened and to end those conditions on myself.",
			savetxt : { adv_vs : ["charmed", "frightened"] }
		},
		"stirring (rare)" : {
			name : "Scaled Ornament (stirring)",
			rarity : "rare",
			description : "This ornament is fashioned from a dragon's scale, tooth, or claw, or it incorporates images in those shapes. It makes me immune to being charmed or frightened and grants my allies within 30 ft advantage on saves to avoid or end those conditions on themselves. It also gives me a +1 bonus to my AC.",
			savetxt : { immune : ["charmed", "frightened"] },
			extraAC : [{
				mod : 1,
				name : "Scaled Ornament",
				magic : true,
				text : "I gain a +1 bonus to AC while I'm attuned to the scaled ornament."
			}]
		},
		"wakened (very rare)" : {
			name : "Scaled Ornament (wakened)",
			rarity : "very rare",
			description : ""
		},
		"ascendant (legendary)" : {
			name : "Scaled Ornament (ascendant)",
			rarity : "legendary",
			description : ""
		}
	};
	var aDragons = [["black", "acid"], ["blue", "lightning"], ["green", "poison"], ["red", "fire"], ["white", "cold"], ["amethyst", "force"], ["crystal", "radiant"], ["emerald", "psychic"], ["sapphire", "thunder"], ["topaz", "necrotic"], ["brass", "fire"], ["bronze", "lightning"], ["copper", "acid"], ["gold", "fire"], ["silver", "cold"]];
	var aChoicesNew = [[], []];
	for (var i = 0; i < aDragons.length; i++) {
		var sDragon = aDragons[i][0];
		var sDmg = aDragons[i][1];
		var sWakenedChoice = "Wakened - " + sDragon + " dragon - " + sDmg + " (very rare)";
		var sWakenedChoiceLC = sWakenedChoice.toLowerCase();
		var sWakenedName = "Scaled Ornament (" + sDragon + ", wakened)";
		var sAscendantChoice = "Ascendant - " + sDragon + " dragon - " + sDmg + " (very rare)";
		var sAscendantChoiceLC = sAscendantChoice.toLowerCase();
		var sAscendantName = "Scaled Ornament (" + sDragon + ", ascendant)";
		aChoicesNew[0].push(sWakenedChoice);
		aChoicesNew[1].push(sAscendantChoice);
		obj[sWakenedChoiceLC] = {
			name : sWakenedName,
			rarity : "very rare",
			description : "This wearable accessory makes me immune to being charmed or frightened and grants my allies within 30 ft adv. on saves vs. those conditions. It also gives me a +1 bonus to my AC. As a reaction once per dawn when I take " + sDmg + " damage, I can ignore that damage and heal for the same amount instead.",
			savetxt : obj["stirring (rare)"].savetxt,
			extraAC : obj["stirring (rare)"].extraAC,
			extraLimitedFeatures : [{
				name : "Scaled Ornament (absorb " + sDmg + ")",
				usages : 1,
				recovery : "dawn"
			}],
			action : [["reaction", "Scaled Ornament (absorb " + sDmg + ")"]],
		}
		obj[sAscendantChoiceLC] = newObj(obj[sWakenedChoiceLC]);
		obj[sAscendantChoiceLC].name = sAscendantName;
		obj[sAscendantChoiceLC].rarity = "legendary";
		obj[sAscendantChoiceLC].description = "This makes me immune to being charmed or frightened and my allies in 30 ft gain adv. on saves vs. those conditions. It also gives me +1 bonus to AC, a flying speed equal to my walking speed, and I can hover. As a reaction once per dawn when I take " + sDmg + " damage, I can ignore it and instead heal that amount.";
		obj[sAscendantChoiceLC].speed = { fly : { spd : "walk", enc : "walk" } }
	}
	obj.choices = obj.choices.concat(aChoicesNew[0]).concat(aChoicesNew[1]);
	return obj;
}();

// Creatures
CreatureList["giant canary"] = {
	name : "Giant Canary",
	nameAlt : ["Canary, Giant"],
	source : [["FToD", 23]],
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 12,
	hp : 26,
	hd : [4, 10],
	speed : "30 ft, fly 60 ft",
	scores : [10, 14, 12, 2, 10, 6],
	damage_immunities : "poison, psychic",
	condition_immunities : "blinded, charmed, deafened, exhaustion, frightened, paralyzed, petrified, poisoned",
	senses : "Blindsight 60 ft (blind beyond this radius)",
	passivePerception : 10,
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Peck",
		ability : 2,
		damage : [1, 10, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}]
};
CreatureList["dragonnel"] = { // Alternate for Find Greater Steed spell (contributed by Nod_Hero)
	name : "Dragonnel",
	source : [["FToD", 190]],
	size : 2, //Large
	type : "Dragon",
	companion : ["steed_not_al"],
	alignment : "Neutral",
	ac : 13,
	hp : 58,
	hd : [9, 10],
	speed : "30 ft, fly 60 ft",
	scores : [16, 15, 12, 8, 13, 10],
	skills : {
		"perception" : 3
	},
	senses : "Blindsight 30 ft; Darkvision 120 ft",
	passivePerception : 13,
	languages : "understands Draconic and Common but can't speak",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Rend",
		ability : 1,
		damage : [2, 6, "slashing"],
		range : "Melee (5 ft)",
		description : "Two rend attacks as Attack action"
	}],
	actions : [{
		name : "Multiattack",
		description : "The dragonnel makes two Rend attacks."
	}],
	traits : [{
		name : "Flyby",
		description : "The dragonnel doesn't provoke an opportunity attack when it flies out of an enemy's reach."
	}]
};

// pub_20211207_SCC.js
// This file adds all the player-material from Strixhaven: A Curriculum of Chaos to MPMB's Character Record Sheet

// Define the source
SourceList.SCC = {
	name : "Strixhaven: A Curriculum of Chaos",
	abbreviation : "SCC",
	abbreviationSpellsheet : "SC",
	group : "Campaign Sourcebooks",
	campaignSetting : "Magic: The Gathering",
	url : "https://dnd.wizards.com/products/strixhaven-curriculum-chaos",
	date : "2021/12/07"
};

// Race
RaceList["owlin"] = {
	regExpSearch : /owlin/i,
	name : "Owlin",
	source : [["SCC", 29]],
	plural : "Owlin",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 },
		fly : { spd : "walk", enc : 0 }
	},
	skills : ["Stealth"],
	vision : [["Darkvision", 120]],
	languageProfs : ["Common", 1],
	scorestxt : "+2 to one ability score and +1 to a different score of my choice, -or- +1 to three different scores of my choice",
	trait : "Owlin"+
	"\n \u2022 Flight: Thanks to my wings, I have a flying speed equal to my walking speed. I can't use this flying speed if I'm wearing medium or heavy armor."+
	"\n \u2022 Silent Feathers: I have proficiency in the Stealth skill."
};

// Backgrounds
BackgroundList["lorehold student"] = {
	regExpSearch : /^(?=.*lorehold)(?=.*student).*$/i,
	name : "Lorehold Student",
	source : [["SCC", 31]],
	skills : ["History", "Religion"],
	languageProfs : [2],
	gold : 15,
	equipleft : [
		["Black ink, 1 ounce bottle of", 1, ""],
		["Ink pen", "", ""],
		["Tome of history", "", 5]
	],
	equipright : [
		["School uniform", "", 4], // as costume
		["Hammer", "", 3],
		["Hooded lantern", "", 2],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Lorehold Initiate",
	trait : [
		"I thrive on esoteric lore. The more obscure the historical references I can include in everyday conversation, the better.",
		"By searching for these lost artifacts, I hope to find who I really am along the way.",
		"I can barely go a minute without talking about my research. I have so much knowledge in my head, and it needs to be let out somewhere!",
		"The spirits of the dead are so much more interesting to talk with than living classmates.",
		"I can speak eloquently about the historical ramifications of an ancient war. But ask me to add two-digit numbers together, and I'm a mess.",
		"In the end, it's all just entropy. Everything falls apart someday."
	]
};
BackgroundFeatureList["lorehold initiate"] = {
	description : "I gain the Strixhaven Initiate feat for the Lorehold college. In addition, I add the following spells to the spell list of all my spellcasting classes, if any: Comprehend Languages, Identify, Borrowed Knowledge, Locate Object, Speak with Dead, Spirit Guardians, Arcane Eye, Stone Shape, Flame Strike, and Legend Lore.",
	source : [["SCC", 31]],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["comprehend languages", "identify", "borrowed knowledge", "locate object", "speak with dead", "spirit guardians", "arcane eye", "stone shape", "flame strike", "legend lore"]);
			},
			"My background feature adds extra spells to the spell list(s) of my spellcasting class(es): Comprehend Languages, Identify, Borrowed Knowledge, Locate Object, Speak with Dead, Spirit Guardians, Arcane Eye, Stone Shape, Flame Strike, and Legend Lore."
		]
	},
	eval : function() { AddFeat("Strixhaven Initiate"); },
	removeeval : function() { RemoveFeat("Strixhaven Initiate"); }
};
BackgroundList["prismari student"] = {
	regExpSearch : /^(?=.*prismari)(?=.*student).*$/i,
	name : "Prismari Student",
	source : [["SCC", 32]],
	skills : ["Acrobatics", "Performance"],
	languageProfs : [1],
	toolProfs : [["Artisan's tools or Musical instrument", 1]],
	gold : 10,
	equipleft : [
		["Black ink, 1 ounce bottle of", 1, ""],
		["Ink pen", "", ""],
		["Artisan's tools or musical instrument", "", ""]
	],
	equipright : [
		["School uniform", "", 4], // as costume
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Prismari Initiate",
	trait : [
		"I'm the life of the party, and I expect everyone's attention when I walk into a room.",
		"Two weeks ago, I was enthralled with my latest project. Now, I think it's garbage and deserves to be destroyed.",
		"I believe everyone has the ability to express their truest selves through art, and I'm happy to quietly push them in the right direction.",
		"Everyone is a critic, and I work to win them all over.",
		"I'm beset with such an overwhelming sense of ennui regarding my art. Nothing quite captures my attention anymore.",
		"Instead of confronting my negative emotions, I channel them into explosive artistic displays."
	]
};
BackgroundFeatureList["prismari initiate"] = {
	description : "I gain the Strixhaven Initiate feat for the Prismari college. In addition, I add the following spells to the spell list of all my spellcasting classes, if any: Chromatic Orb, Thunderwave, Flaming Sphere, Kinetic Jaunt, Haste, Water Walk, Freedom of Movement, Wall of Fire, Cone of Cold, and Conjure Elemental.",
	source : [["SCC", 32]],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["chromatic orb", "thunderwave", "flaming sphere", "kinetic jaunt", "haste", "water walk", "freedom of movement", "wall of fire", "cone of cold", "conjure elemental"]);
			},
			"My background feature adds extra spells to the spell list(s) of my spellcasting class(es): Chromatic Orb, Thunderwave, Flaming Sphere, Kinetic Jaunt, Haste, Water Walk, Freedom of Movement, Wall of Fire, Cone of Cold, and Conjure Elemental."
		]
	},
	eval : function() { AddFeat("Strixhaven Initiate [Prismari]"); },
	removeeval : function() { RemoveFeat("Strixhaven Initiate [Prismari]"); }
};
BackgroundList["quandrix student"] = {
	regExpSearch : /^(?=.*quandrix)(?=.*student).*$/i,
	name : "Quandrix Student",
	source : [["SCC", 33]],
	skills : ["Arcana", "Nature"],
	languageProfs : [1],
	toolProfs : [["Artisan's tools", 1]],
	gold : 15,
	equipleft : [
		["Black ink, 1 ounce bottle of", 1, ""],
		["Ink pen", "", ""],
		["Abacus", "", 2],
		["Book of arcane theory", "", 5]
	],
	equipright : [
		["School uniform", "", 4], // as costume
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Quandrix Initiate",
	trait : [
		"When I find a subject I'm interested in, I won't stop studying until I know everything about it. It keeps me up at night.",
		"I hope this all makes sense to me one day. Until then, I'm going to keep faking it.",
		"Equations and patterns come naturally to my mind. I wish friendship came just as easily.",
		"I believe I'm always the smartest person in the room. And I'll prove it, even if no one asks me to.",
		"If these classes have taught me anything, it's that reality is a lie, and nothing matters. So why bother?",
		"Before I graduate, I want to achieve something mathematically impossible. I must leave a legacy!"
	]
};
BackgroundFeatureList["quandrix initiate"] = {
	description : "I gain the Strixhaven Initiate feat for the Quandrix college. In addition, I add the following spells to the spell list of all my spellcasting classes, if any: Entangle, Guiding Bolt, Enlarge/Reduce, Vortex Warp, Aura of Vitality, Haste, Control Water, Freedom of Movement, Circle of Power, and Passwall.",
	source : [["SCC", 33]],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["entangle", "guiding bolt", "enlarge/reduce", "vortex warp", "aura of vitality", "haste", "control water", "freedom of movement", "circle of power", "passwall"]);
			},
			"My background feature adds extra spells to the spell list(s) of my spellcasting class(es): Entangle, Guiding Bolt, Enlarge/Reduce, Vortex Warp, Aura of Vitality, Haste, Control Water, Freedom of Movement, Circle of Power, and Passwall."
		]
	},
	eval : function() { AddFeat("Strixhaven Initiate [Quandrix]"); },
	removeeval : function() { RemoveFeat("Strixhaven Initiate [Quandrix]"); }
};
BackgroundList["silverquill student"] = {
	regExpSearch : /^(?=.*silverquill)(?=.*student).*$/i,
	name : "Silverquill Student",
	source : [["SCC", 35]],
	skills : ["Intimidation", "Persuasion"],
	languageProfs : [2],
	gold : 15,
	equipleft : [
		["Black ink, 1 ounce bottle of", 1, ""],
		["Ink pen", "", ""],
		["Book of poetry", "", 5]
	],
	equipright : [
		["School uniform", "", 4], // as costume
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Silverquill Initiate",
	trait : [
		"I'll say whatever I need to in order to maintain my high social status.",
		"I prefer saying the blunt truth over a pretty lie, and I don't particularly care whose feelings I hurt.",
		"I believe that uplifting my peers is the best way to succeed.",
		"I've mastered the art of using humor as a defense, and I always have a charming joke ready.",
		"I always wait before speaking, analyzing the situation for whichever angle is most advantageous to my goals.",
		"No one knows about the all-nighters I've pulled to keep my magic looking effortless, and I'm going to keep it that way."
	]
};
BackgroundFeatureList["silverquill initiate"] = {
	description : "I gain the Strixhaven Initiate feat for the Silverquill college. In addition, I add the following spells to the spell list of all my spellcasting classes, if any: Dissonant Whispers, Silvery Barbs, Calm Emotions, Darkness, Beacon of Hope, Daylight, Compulsion, Confusion, Dominate Person, and Rary's Telepathic Bond.",
	source : [["SCC", 35]],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["dissonant whispers", "silvery barbs", "calm emotions", "darkness", "beacon of hope", "daylight", "compulsion", "confusion", "dominate person", "rary's telepathic bond"]);
			},
			"My background feature adds extra spells to the spell list(s) of my spellcasting class(es): Dissonant Whispers, Silvery Barbs, Calm Emotions, Darkness, Beacon of Hope, Daylight, Compulsion, Confusion, Dominate Person, and Rary's Telepathic Bond."
		]
	},
	eval : function() { AddFeat("Strixhaven Initiate [Silverquill]"); },
	removeeval : function() { RemoveFeat("Strixhaven Initiate [Silverquill]"); }
};
BackgroundList["witherbloom student"] = {
	regExpSearch : /^(?=.*witherbloom)(?=.*student).*$/i,
	name : "Witherbloom Student",
	source : [["SCC", 36]],
	skills : ["Nature", "Survival"],
	languageProfs : [1],
	toolProfs : ["Herbalism kit"],
	gold : 15,
	equipleft : [
		["Black ink, 1 ounce bottle of", 1, ""],
		["Ink pen", "", ""],
		["Book about plant identification", "", 5],
		["Iron pot", "", 10],
		["Herbalism kit", "", 3]
	],
	equipright : [
		["School uniform", "", 4], // as costume
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Witherbloom Initiate",
	trait : [
		"I love brewing up a new recipe, even if some might be repulsed by my choice of ingredients. Or the final product. Or both.",
		"My fashion sense is like my garden: withered, black, and weird.",
		"I'm going to befriend every single monster in this swamp if it's the last thing I do.",
		"Everything in this world dies eventually. The question is, what will you do with the time you have left?",
		"I know we just met, but when you die, may I have your bones? For research.",
		"Don't interrupt me; I'm brooding."
	]
};
BackgroundFeatureList["witherbloom initiate"] = {
	description : "I gain the Strixhaven Initiate feat for the Witherbloom college. In addition, I add the following spells to the spell list of all my spellcasting classes, if any: Cure Wounds, Inflict Wounds, Lesser Restoration, Wither and Bloom, Revivify, Vampiric Touch, Blight, Death Ward, Antilife Shell, and Greater Restoration.",
	source : [["SCC", 36]],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["cure wounds", "inflict wounds", "lesser restoration", "wither and bloom", "revivify", "vampiric touch", "blight", "death ward", "antilife shell", "greater restoration"]);
			},
			"My background feature adds extra spells to the spell list(s) of my spellcasting class(es): Cure Wounds, Inflict Wounds, Lesser Restoration, Wither and Bloom, Revivify, Vampiric Touch, Blight, Death Ward, Antilife Shell, and Greater Restoration."
		]
	},
	eval : function() { AddFeat("Strixhaven Initiate [Witherbloom]"); },
	removeeval : function() { RemoveFeat("Strixhaven Initiate [Witherbloom]"); }
};

// Feats
FeatsList["strixhaven initiate"] = {
	name : "Strixhaven Initiate",
	source : [["SCC", 36]],
	description : "I learn two cantrips and a 1st-level spell from a list depending on my Strixhaven college. I can cast the spell once per long rest at its lowest level without expending a spell slot, and can cast it if I have a spell slot to do so. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
	descriptionFull : "You have studied some magical theory and have learned a few spells associated with Strixhaven University."+
	"\n   Choose one of Strixhaven's colleges: Lorehold, Prismari, Quandrix, Silverquill, or Witherbloom. You learn two cantrips and one 1st-level spell based on the college you choose, as specified in the Strixhaven Spells table."+
	"\n   You can cast the chosen 1st-level spell without a spell slot, and you must finish a long rest before you can cast it in this way again. You can also cast the spell using any spell slots you have."+
	"\n   Your spellcasting ability for this feat's spells is Intelligence, Wisdom, or Charisma (choose when you select this feat).",
	choices : ["Lorehold", "Prismari", "Quandrix", "Silverquill", "Witherbloom"],
	"lorehold" : {
		description : "I learn two cantrips (Light, Sacred Flame, or Thaumaturgy) and a 1st-level spell from the cleric or wizard spell list. I can cast the spell once per long rest at its lowest level without expending a spell slot, and can cast it if I have a spell slot to do so. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4, 5, 6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Cantrip",
			spells : ["light", "sacred flame", "thaumaturgy"],
			firstCol : "atwill",
			times : 2
		}, {
			name : "1st-level spell",
			"class" : ["cleric", "wizard"],
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"prismari" : {
		description : "I learn two cantrips (Fire Bolt, Prestidigitation, or Ray of Frost) and a 1st-level spell from the bard or sorcerer spell list. I can cast the spell once per long rest at its lowest level without expending a spell slot, and can cast it if I have a spell slot to do so. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4, 5, 6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Cantrip",
			spells : ["fire bolt", "prestidigitation", "ray of frost"],
			firstCol : "atwill",
			times : 2
		}, {
			name : "1st-level spell",
			"class" : ["bard", "sorcerer"],
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"quandrix" : {
		description : "I learn two cantrips (Druidcraft, Guidance, or Mage Hand) and a 1st-level spell from the druid or wizard spell list. I can cast the spell once per long rest at its lowest level without expending a spell slot, and can cast it if I have a spell slot to do so. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4, 5, 6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Cantrip",
			spells : ["druidcraft", "guidance", "mage hand"],
			firstCol : "atwill",
			times : 2
		}, {
			name : "1st-level spell",
			"class" : ["druid", "wizard"],
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"silverquill" : {
		description : "I learn two cantrips (Sacred Flame, Thaumaturgy, or Vicious Mockery) and a 1st-level spell from the bard or cleric spell list. I can cast the spell once per long rest at its lowest level without expending a spell slot, and can cast it if I have a spell slot to do so. I can have Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4, 5, 6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Cantrip",
			spells : ["sacred flame", "thaumaturgy", "vicious mockery"],
			firstCol : "atwill",
			times : 2
		}, {
			name : "1st-level spell",
			"class" : ["bard", "cleric"],
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"witherbloom" : {
		description : "I learn two cantrips (Chill Touch, Druidcraft, or Spare the Dying) and a 1st-level spell from the druid or wizard spell list. I can cast the spell once per long rest at its lowest level without expending a spell slot, and can cast it if I have a spell slot to do so. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4, 5, 6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Cantrip",
			spells : ["chill touch", "druidcraft", "spare the dying"],
			firstCol : "atwill",
			times : 2
		}, {
			name : "1st-level spell",
			"class" : ["druid", "wizard"],
			level : [1, 1],
			firstCol : "oncelr"
		}]
	}
};
FeatsList["strixhaven mascot"] = {
	name : "Strixhaven Mascot",
	source : [["SCC", 37]],
	description : "I can cast Find Familiar as a ritual and it can take the form of my college's mascot. When I take the Attack action on my turn, I can forgo one attack to have it make one attack with its reaction. As an action once per long rest (or 2nd-level spell slot) while its within 60 ft, I can teleport to swap places with it, if there's space.",
	descriptionFull : "You have learned how to summon a Strixhaven mascot to assist you, granting you these benefits:"+
	"\n \u2022 You can cast the find familiar spell as a ritual. Your familiar can take the form of the mascot associated with the college you chose for the Strixhaven Initiate feat: a spirit statue mascot (Lorehold), an art elemental mascot (Prismari), a fractal mascot (Quandrix), an inkling mascot (Silverquill), or a pest mascot (Witherbloom)."+
	"\n \u2022 When you take the Attack action on your turn, you can forgo one attack to allow your mascot familiar to make one attack of its own with its reaction."+
	"\n \u2022 If your mascot familiar is within 60 feet of you, you can teleport as an action, swapping places with the familiar. If your destination space is too small for you to occupy, the teleportation fails and is wasted. Once you teleport in this way, you can't do so again until you finish a long rest, unless you expend a spell slot of 2nd level or higher to do it again.",
	prerequisite : "4th level, Strixhaven Initiate feat",
	prereqeval : function(v) { return v.characterLevel >= 4 && CurrentFeats.known.indexOf("strixhaven initiate") !== -1; },
	extraLimitedFeatures : [{
		name : "Swap places with Strixhaven Mascot",
		recovery : "long rest",
		usages : 1,
		altResource : "SS 2+"
	}],
	spellcastingBonus : {
		name : "Strixhaven Mascot",
		spells : ["find familiar"],
		selection : ["find familiar"],
		firstCol : "(R)"
	},
	choices : ["Lorehold", "Prismari", "Quandrix", "Silverquill", "Witherbloom"],
	selfChoosing : function () {
		var iStrixInit = CurrentFeats.known.indexOf("strixhaven initiate");
		if (iStrixInit !== -1 && CurrentFeats.choices[iStrixInit]) {
			return CurrentFeats.choices[iStrixInit];
		}
	},
	"lorehold" : {
		description : "I can cast Find Familiar as a ritual and it can take the form of a Spirit Statue Mascot. When I take the Attack action on my turn, I can forgo one attack to have it make one attack with its reaction. As an action once per long rest (or 2nd-level spell slot) while its within 60 ft, I can teleport to swap places with it, if there's space.",
		creaturesAdd : [["Spirit Statue Mascot", true, false, "strixhaven_mascot"]]
	},
	"prismari" : {
		description : "I can cast Find Familiar as a ritual and it can take the form of an Art Elemental Mascot. When I take the Attack action on my turn, I can forgo one attack to have it make an attack with its reaction. As an action once per long rest (or 2nd-level spell slot) while its within 60 ft, I can teleport to swap places with it, if there's space.",
		creaturesAdd : [["Art Elemental Mascot", true, false, "strixhaven_mascot"]]
	},
	"quandrix" : {
		description : "I can cast Find Familiar as a ritual and it can take the form of a Fractal Mascot. When I take the Attack action on my turn, I can forgo one attack to have it make one attack with its reaction. As an action once per long rest (or 2nd-level spell slot) while its within 60 ft, I can teleport to swap places with it, if there's space.",
		creaturesAdd : [["Fractal Mascot", true, false, "strixhaven_mascot"]]
	},
	"silverquill" : {
		description : "I can cast Find Familiar as a ritual and it can take the form of an Inkling Mascot. When I take the Attack action on my turn, I can forgo one attack to have it make one attack with its reaction. As an action once per long rest (or 2nd-level spell slot) while its within 60 ft, I can teleport to swap places with it, if there's space.",
		creaturesAdd : [["Inkling Mascot", true, false, "strixhaven_mascot"]]
	},
	"witherbloom" : {
		description : "I can cast Find Familiar as a ritual and it can take the form of a Pest Mascot. When I take the Attack action on my turn, I can forgo one attack to have it make one attack with its reaction. As an action once per long rest (or 2nd-level spell slot) while its within 60 ft, I can teleport to swap places with it, if there's space.",
		creaturesAdd : [["Pest Mascot", true, false, "strixhaven_mascot"]]
	}
};
if (CompanionList.familiar && CompanionList.pact_of_the_chain) {
	CompanionList.strixhaven_mascot = {
		name : "Strixhaven Mascot",
		nameTooltip : "Strixhaven Mascot (feat)",
		nameOrigin : "variant of the Find Familiar 1st-level conjuration [ritual] spell",
		nameMenu : "Strixhaven Mascot familiar (feat)",
		source : [["SCC", 37]],
		includeCheck : CompanionList.pact_of_the_chain.includeCheck,
		action : [["action", "Swap places with Strixhaven Mascot"]].concat(CompanionList.familiar.action),
		attributesChange : CompanionList.pact_of_the_chain.attributesChange,
		attributesAdd : CompanionList.familiar.attributesAdd,
		notes : function() {
			var a = newObj(CompanionList.pact_of_the_chain.notes);
			a[0].description = [
				"appearing in an unoccupied space within 10 ft",
				"It assumes a chosen beast or mascot form (can change at every casting), see the spell and feat",
				"It has the chosen form's statistics, but its type changes from beast to celestial, fey, or fiend",
				"When the familiar drops to 0 hit points, it disappears, leaving behind no physical form",
				"It reappears when I cast this spell again (in a new form if so desired)"
			].join("\n   ");
			a.push({
				name : "As an action while it is within 60 ft, we can teleport",
				description : [
					"swapping places if there is enough space",
					"I can do this once per long rest, or by expending a 2nd-level or higher spell slot (SS 2+)"
				].join("\n   "),
				joinString : ", "
			});
			return a;
		}()
	};
}

// Spells
SpellsList["borrowed knowledge"] = {
	name : "Borrowed Knowledge",
	classes : ["bard", "cleric", "warlock", "wizard"],
	source : [["SCC", 37]],
	level : 2,
	school : "Div",
	time : "1 a",
	range : "Self",
	components : "V,S,M\u0192",
	compMaterial : "A book worth at least 25 gp.",
	duration : "1 h",
	description : "Gain proficiency with one skill; ends early if cast again (25gp)",
	descriptionFull : "You draw on knowledge from spirits of the past. Choose one skill in which you lack proficiency. For the spell's duration, you have proficiency in the chosen skill. The spell ends early if you cast it again."
};
SpellsList["kinetic jaunt"] = {
	name : "Kinetic Jaunt",
	classes : ["artificer", "bard", "sorcerer", "wizard"],
	source : [["SCC", 37]],
	level : 2,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "S",
	duration : "Conc, 1 min",
	description : "+10 ft walk spd; provoke no opportunity atks; move through crea space, counts not as difficult terrain",
	descriptionFull : "You magically empower your movement with dance-like steps, giving yourself the following benefits for the duration."+
	"\n \u2022 Your walking speed increases by 10 feet."+
	"\n \u2022 You don't provoke opportunity attacks."+
	"\n \u2022 You can move through the space of another creature, and it doesn't count as difficult terrain. If you end your turn in another creature's space, you are shunted to the last unoccupied space you occupied, and you take 1d8 force damage."
};
SpellsList["silvery barbs"] = {
	name : "Silvery Barbs",
	classes : ["bard", "sorcerer", "wizard"],
	source : [["SCC", 38]],
	level : 1,
	school : "Ench",
	time : "1 rea",
	timeFull : "1 reaction, which you take when a creature you can see within 60 feet of yourself succeeds on an attack roll, an ability check, or a saving throw",
	range : "60 ft",
	components : "V",
	duration : "Instantaneous",
	description : "1 crea reroll d20 and use lowest for atk, check, or save; 1 crea adv. next atk, check, or save in 1 min",
	descriptionFull : "You magically distract the triggering creature and turn its momentary uncertainty into encouragement for another creature. The triggering creature must reroll the d20 and use the lower roll."+
	"\n   You can then choose a different creature you can see within range (you can choose yourself). The chosen creature has advantage on the next attack roll, ability check, or saving throw it makes within 1 minute. A creature can be empowered by only one use of this spell at a time."
};
SpellsList["vortex warp"] = {
	name : "Vortex Warp",
	classes : ["artificer", "sorcerer", "wizard"],
	source : [["SCC", 38]],
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "1 crea save or teleported to a sufficiently empty space of my choice within range; +30 ft/SL range",
	descriptionFull : "You magically twist space around another creature you can see within range. The target must succeed on a Constitution saving throw (the target can choose to fail), or the target is teleported to an unoccupied space of your choice that you can see within range. The chosen space must be on a surface or in a liquid that can support the target without the target having to squeeze."+
	AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the range of the spell increases by 30 feet for each slot level above 2nd."
};
SpellsList["wither and bloom"] = {
	name : "Wither and Bloom",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["SCC", 38]],
	level : 2,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A withered vine twisted into a loop.",
	duration : "Instantaneous",
	save : "Con",
	description : "10-ft rad any crea 2d6+1d6/SL Necrotic dmg, save half; 1 crea can heal using 1+1/SL HD; see B",
	descriptionFull : "You invoke both death and life upon a 10-foot-radius sphere centered on a point within range. Each creature of your choice in that area must make a Constitution saving throw, taking 2d6 necrotic damage on a failed save, or half as much damage on a successful one. Nonmagical vegetation in that area withers."+
	"\n   In addition, one creature of your choice in that area can spend and roll one of its unspent Hit Dice and regain a number of hit points equal to the roll plus your spellcasting ability modifier."+
	AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot above the 2nd, and the number of Hit Dice that can be spent and added to the healing roll increases by one for each slot above 2nd."
};

// Magic Items
MagicItemsList["bottle of boundless coffee"] = {
	name : "Bottle of Boundless Coffee",
	source : [["SCC", 38]],
	type : "wondrous item",
	rarity : "common",
	description : "This metal bottle is full with delicious, comfortably warm coffee, but I can't feel the heat. It has a stopper on a little chain. It will accept only the coffee it produces. Each time I drink the coffee, I roll a d20. On a 1, the bottle stops dispensing coffee for 1 hour. Unless drunk, the coffee vanishes when it leaves the bottle.",
	descriptionFull : "This metal bottle carries delicious, warm coffee. The bottle comes with a stopper, which is attached to the bottle by a little chain. Even when open, the bottle won't accept any liquid other than the coffee it produces. The coffee inside is always comfortably warm, and none of the heat can be felt through the bottle."+
	"\n   Each time you drink the coffee, roll a d20. On a 1, the bottle refuses to dispense coffee for the next hour. If you pour coffee from the bottle, rather than drinking from it, the coffee vanishes the moment it leaves the bottle."
}
MagicItemsList["cuddly strixhaven mascot"] = {
	name : "Cuddly Strixhaven Mascot",
	source : [["SCC", 38]],
	type : "wondrous item",
	rarity : "common",
	description : "This soft, Tiny, magic toy represents a Strixhaven mascot. As an action, I can press it to my arm, shoulder, or leg, and it attaches there for 1 hour or until I remove it as an action. Once per long rest while this toy is on my person, I can give myself advantage on the save to avoid or end the frightened condition on myself.",
	descriptionFull : "Representing one of the mascots of Strixhaven, this soft, Tiny, magic toy is perfect for cuddling. If you press it to your arm, shoulder, or leg as an action, the toy stays attached there for 1 hour or until you use an action to remove it."+
	"\n   The toy can also be used to fight off fear. When you make a saving throw to avoid or end the frightened condition on yourself, you can give yourself advantage on the roll if the toy is on your person. You must decide to do so before rolling the d20. If the save succeeds, you can't use the toy in this way until you finish a long rest.",
	action : [["action", " (attach/remove)"]],
	usages : 1,
	recovery : "long rest"
}
MagicItemsList["lorehold primer"] = {
	name : "Lorehold Primer",
	source : [["SCC", 39]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "This magic textbook has 3 charges, regaining 1d3 used charges at dawn. While holding it, I can use 1 charge to add +1d4 to an History or Religion check, after the d20 roll. If I study it during a long rest, I can pick a 1st-level cleric or wizard spell. I can cast the spell once without a spell slot before my next long rest ends.",
	descriptionFull : "The Lorehold Primer is a magic textbook created at Strixhaven's Lorehold College. The primer has 3 charges, and it regains 1d3 expended charges daily at dawn. If you make an Intelligence (History) or Intelligence (Religion) check while holding the primer, you can expend 1 charge to give yourself 1d4 bonus to the check, immediately after you roll the d20."+
	"\n   In addition, if you study the primer at the end of a long rest, you can choose one 1st-level spell from the cleric or wizard spell list. Before you finish your next long rest, you can cast the chosen spell once without a spell slot if you are holding the primer. Your spellcasting ability for this spell is your choice of Intelligence, Wisdom, or Charisma.",
	extraLimitedFeatures : [{
		name : "Lorehold Primer charges (regains 1d3)",
		usages : 3,
		recovery : "dawn"
	}, {
		name : "Lorehold Primer (cast spell)",
		usages : 1,
		recovery : "long rest"
	}],
	spellcastingAbility : [4, 5, 6],
	fCreateSCCPrimerSpellsEntry : function(bAddIt, sName, aClasses) {
		var sNameLC = sName.toLowerCase();
		if (bAddIt) {
			CurrentSpells[sNameLC] = {
				name : sName + ' (item)',
				list : { 'class' : aClasses, level : [1, 1] },
				known : { spells : 1 },
				bonus : {
					bon0 : {
						name : 'Either select a spell',
						spells : []
					},
					bon1 : {
						name : 'or just select "Full List"',
						spells : []
					},
					bon2 : {
						name : 'on the bottom left',
						spells : []
					}
				},
				typeList : 4,
				refType : "item",
				allowUpCasting : false,
				firstCol : "LR"
			};
		} else {
			delete CurrentSpells[sNameLC];
		}
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	eval : function () {
		MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(true, "Lorehold Primer", ['cleric', 'wizard']);
	},
	removeeval : function () {
		MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(false, "Lorehold Primer");
	}
}
MagicItemsList["prismari primer"] = {
	name : "Prismari Primer",
	source : [["SCC", 39]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "This magic textbook has 3 charges, regaining 1d3 used charges at dawn. While holding it, I can use 1 charge to add +1d4 to an Acrobatics or Performance check, after the d20 roll. If I study it in a long rest, I can pick a 1st-level bard or sorcerer spell. I can cast the spell once without a spell slot before my next long rest ends.",
	descriptionFull : "The Prismari Primer is a magic textbook created at Strixhaven's Prismari College. The primer has 3 charges, and it regains 1d3 expended charges daily at dawn. If you make a Dexterity (Acrobatics) or a Charisma (Performance) check while holding the primer, you can expend 1 charge to give yourself a 1d4 bonus to the check, immediately after you roll the d20."+
	"\n   In addition, if you study the primer at the end of a long rest, you can choose one 1st-level spell from the bard or sorcerer spell list. Before you finish your next long rest, you can cast the chosen spell once without a spell slot if you are holding the primer. Your spellcasting ability for this spell is your choice of Intelligence, Wisdom, or Charisma.",
	extraLimitedFeatures : [{
		name : "Prismari Primer charges (regains 1d3)",
		usages : 3,
		recovery : "dawn"
	}, {
		name : "Prismari Primer (cast spell)",
		usages : 1,
		recovery : "long rest"
	}],
	spellcastingAbility : [4, 5, 6],
	eval : function () {
		if (MagicItemsList["lorehold primer"])
			MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(true, "Prismari Primer", ['bard', 'sorcerer']);
	},
	removeeval : function () {
		if (MagicItemsList["lorehold primer"])
			MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(false, "Prismari Primer");
	}
}
MagicItemsList["quandrix primer"] = {
	name : "Quandrix Primer",
	source : [["SCC", 39]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "This magic textbook has 3 charges, regaining 1d3 used charges at dawn. While holding it, I can use 1 charge to add +1d4 to an Arcana or Nature check, after the d20 roll. If I study it during a long rest, I can pick a 1st-level druid or wizard spell. I can cast the spell once without a spell slot before my next long rest ends.",
	descriptionFull : "The Quandrix Primer is a magic textbook created at Strixhaven's Quandrix College. The primer has 3 charges, and it regains 1d3 expended charges daily at dawn. If you make an Intelligence (Arcana) or an Intelligence (Nature) check while holding the primer, you can expend 1 charge to give yourself a 1d4 bonus to the check, immediately after you roll the d20."+
	"\n   In addition, if you study the primer at the end of a long rest, you can choose one 1st-level spell from the druid or wizard spell list. Before you finish your next long rest, you can cast the chosen spell once without a spell slot if you are holding the primer. Your spellcasting ability for this spell is your choice of Intelligence, Wisdom, or Charisma.",
	extraLimitedFeatures : [{
		name : "Quandrix Primer charges (regains 1d3)",
		usages : 3,
		recovery : "dawn"
	}, {
		name : "Quandrix Primer (cast spell)",
		usages : 1,
		recovery : "long rest"
	}],
	spellcastingAbility : [4, 5, 6],
	eval : function () {
		if (MagicItemsList["lorehold primer"])
			MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(true, "Quandrix Primer", ['druid', 'wizard']);
	},
	removeeval : function () {
		if (MagicItemsList["lorehold primer"])
			MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(false, "Quandrix Primer");
	}
}
MagicItemsList["silverquill primer"] = {
	name : "Silverquill Primer",
	source : [["SCC", 39]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "This magic textbook has 3 charges, regaining 1d3 used charges at dawn. While holding it, I can use 1 charge to add +1d4 to an Intimidation or Persuasion check, after the d20 roll. If I study it in a long rest, I can pick a 1st-level bard or cleric spell. I can cast the spell once without a spell slot before my next long rest ends.",
	descriptionFull : "The Silverquill Primer is a magic textbook created at Strixhaven's Silverquill College. The primer has 3 charges, and it regains 1d3 expended charges daily at dawn. If you make a Charisma (Intimidation) or a Charisma (Persuasion) check while holding the primer, you can expend 1 charge to give yourself a 1d4 bonus to the check, immediately after you roll the d20."+
	"\n   In addition, if you study the primer at the end of a long rest, you can choose one 1st-level spell from the bard or cleric spell list. Before you finish your next long rest, you can cast the chosen spell once without a spell slot if you are holding the primer. Your spellcasting ability for this spell is your choice of Intelligence, Wisdom, or Charisma.",
	extraLimitedFeatures : [{
		name : "Silverquill Primer charges (regains 1d3)",
		usages : 3,
		recovery : "dawn"
	}, {
		name : "Silverquill Primer (cast spell)",
		usages : 1,
		recovery : "long rest"
	}],
	spellcastingAbility : [4, 5, 6],
	eval : function () {
		if (MagicItemsList["lorehold primer"])
			MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(true, "Silverquill Primer", ['bard', 'cleric']);
	},
	removeeval : function () {
		if (MagicItemsList["lorehold primer"])
			MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(false, "Silverquill Primer");
	}
}
MagicItemsList["strixhaven pennant"] = {
	name : "Strixhaven Pennant",
	source : [["SCC", 39]],
	type : "wondrous item",
	rarity : "common",
	description : "This magic pennant bears the symbol of Strixhaven or one of its colleges: Lorehold, Prismari, Quandrix, Silverquill, or Witherbloom. While I wave the pennant, the symbol on it glitters, and the pennant sheds bright light in a 10-ft radius and dim light for an additional 10 ft.",
	descriptionFull : "This magic pennant bears the symbol of Strixhaven or one of its colleges: Lorehold, Prismari, Quandrix, Silverquill, or Witherbloom. While you wave the pennant, the symbol on it glitters, and the pennant sheds bright light in a 10-foot-radius and dim light for an additional 10 feet."
}
MagicItemsList["witherbloom primer"] = {
	name : "Witherbloom Primer",
	source : [["SCC", 39]],
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "This magic textbook has 3 charges, regaining 1d3 used charges at dawn. While holding it, I can use 1 charge to add +1d4 to a Nature or Survival check, after the d20 roll. If I study it during a long rest, I can pick a 1st-level druid or wizard spell. I can cast the spell once without a spell slot before my next long rest ends.",
	descriptionFull : "The Witherbloom Primer is a magic textbook created at Strixhaven's Witherbloom College. The primer has 3 charges, and it regains 1d3 expended charges daily at dawn. If you make an Intelligence (Nature) or Wisdom (Survival) check while holding the primer, you can expend 1 charge to give yourself a 1d4 bonus to the check, immediately after you roll the d20."+
	"\n   In addition, if you study the primer at the end of a long rest, you can choose one 1st-level spell from the druid or wizard spell list. Before you finish your next long rest, you can cast the chosen spell once without a spell slot if you are holding the primer. Your spellcasting ability for this spell is your choice of Intelligence, Wisdom, or Charisma.",
	extraLimitedFeatures : [{
		name : "Witherbloom Primer charges (regains 1d3)",
		usages : 3,
		recovery : "dawn"
	}, {
		name : "Witherbloom Primer (cast spell)",
		usages : 1,
		recovery : "long rest"
	}],
	spellcastingAbility : [4, 5, 6],
	eval : function () {
		if (MagicItemsList["lorehold primer"])
			MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(true, "Witherbloom Primer", ['druid', 'wizard']);
	},
	removeeval : function () {
		if (MagicItemsList["lorehold primer"])
			MagicItemsList["lorehold primer"].fCreateSCCPrimerSpellsEntry(false, "Witherbloom Primer");
	}
}
var SCC_Murgaxors_Orb_Full_Description = [
	"Roiling green mist fills this glass orb, which the exiled Strixhaven mage Murgaxor once used in foul magical experiments. Murgaxor's spirit has infused the orb, which he uses to spread a terrible curse among Strixhaven's students.",
	">>Sentience<<. Murgaxor's orb is a sentient, chaotic evil magic item with the following properties:",
	"\u2022 The orb has an Intelligence of 20, a Wisdom of 16, and a Charisma of 16, as well as hearing and darkvision out to a range of 30 feet.",
	"\u2022 The orb can speak, read, and understand Common, and it can communicate telepathically with any creature touching it.",
	"\u2022 At any time during your turn, the orb can cast the suggestion spell (save DC 17), targeting you or one other creature that touched the orb within the last 24 hours. This isn't a power of the orb that you control.",
	">>Curse<<. Any Humanoid you touch while holding the orb must succeed on a DC 10 Wisdom saving throw or become cursed. Each creature cursed by the orb bears an echo of Murgaxor's hateful thoughts, and that creature suffers from headaches that are persistent but not debilitating until the curse ends. On your turn, the orb can use an action to produce one of the following effects, targeting one or more creatures it has cursed:",
	"\u2022 >>Unconsciousness<<. The cursed creature falls unconscious for 1 hour. The creature is roused if it takes damage or someone uses an action to shake or slap it awake.",
	"\u2022 >>Visions of Terror<<. The cursed creature sees terrifying visions, causing it to view all creatures that aren't also cursed as dangerous monsters for 10 minutes. The cursed creature must use its action each round to make one attack against the nearest non-cursed creature. If the cursed creature has multiple possible targets, it attacks one at random. This effect ends if the cursed creature is incapacitated.",
	"After either of these effects ends, the affected creature is no longer cursed. The curse can also be removed from a creature with a remove curse spell or similar magic. All cases of the curse end if Murgaxor's orb is destroyed.",
	">>Magical Signature<<. As a side effect of the orb's curse, the spell detect magic reveals an aura of enchantment surrounding creatures bearing the curse. This aura is distinctive, but in a way detect magic offers no further details about.",
	">>Destroying the Orb<<. Murgaxor's orb has AC 18; 20 hit points; immunity to necrotic, poison, and psychic damage; and resistance to all other types of damage. If reduced to 0 hit points, the orb shatters."
]
MagicItemsList["murgaxor's orb"] = {
	name : "Murgaxor's Orb",
	source : [["SCC", 126]],
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	description : "This sentient, chaotic evil orb bears a curse. It can communicate telepathically with any creature touching it. It can cast Suggestion on my turn, possibly on me. I have no control over it. Any Humanoid I touch while holding the orb must make a DC 10 Wisdom save or become cursed. See the Notes page.",
	descriptionFull : SCC_Murgaxors_Orb_Full_Description.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : desc(SCC_Murgaxors_Orb_Full_Description).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(targeting) you/ig, "$1 me").replace(/you /ig, "I ").replace(/feet/ig, "ft") + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["masque charm"] = {
	name : "Masque Charm",
	source : [["SCC", 127]],
	type : "wondrous item",
	rarity : "common",
	description : "While wearing this small silver pin, I can cast Disguise Self once per sunset. It has DC 13 to discern the disguise. I can have the spell last its normal 1 hour duration, or 6 hours. If I choose 6 hours, the charm becomes nonmagical when the spell ends. In either case, the spell ends if the pin is removed from me.",
	descriptionFull : "A masque charm is a small silver pin. While wearing this charm, you can use an action to cast the disguise self spell (DC 13 to discern the disguise). Once the spell is cast, it can't be cast from the charm again until the next sunset. When casting the spell, you can have the spell last for its normal 1 hour duration or for 6 hours. If you choose the 6-hour duration, the charm becomes nonmagical when the spell ends. In either case, the spell ends if the charm is removed from you.",
	usages : 1,
	recovery : "Sunset",
	spellcastingBonus : [{
		name : "Once per sunset",
		spells : ["disguise self"],
		selection : ["disguise self"],
		firstCol : "oncelr"
   }],
   fixedDC : 13
}

// Creatures (for Strixhaven Mascot feat)
CreatureList["art elemental mascot"] = { // Prismari
	name : "Art Elemental Mascot",
	nameAlt : ["Mascot, Art Elemental"],
	source : [["SCC", 185]],
	size : 4,
	type : "Elemental",
	companion : "strixhaven_mascot",
	alignment : "Neutral",
	ac : 11,
	hp : 18,
	hd : [4, 6],
	speed : "30 ft",
	scores : [6, 13, 12, 8, 11, 15],
	skills : {
		"performance" : 4
	},
	damage_resistances : "cold, fire",
	damage_immunities : "poison",
	condition_immunities : "poisoned",
	senses : "",
	passivePerception : 10,
	languages : "understands the languages of its creator but can't speak",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Joyful Flare",
		ability : 2,
		damage : [2, 4, "fire"],
		range : "Melee (5 ft)",
		description : ""
	}, {
		name : "Melancholic Bolt",
		ability : 2,
		damage : [2, 4, "cold"],
		range : "30 ft",
		description : ""
	}],
	actions : [{
		name : "Captivating Artistry (1/Day)",
		description : "As an action, the elemental can target one creature it can see within 30 ft of itself. The target must succeed on a DC 12 Charisma saving throw or be charmed for 1 minute. The charmed target can repeat the save at the end of each of its turns, ending the effect on itself on a success."
	}],
	traits : [{
		name : "Death Burst",
		description : "When the elemental dies, it explodes in a burst of colored light. Each creature within 5 ft of the elemental must succeed on a DC 11 Constitution saving throw or be blinded for 1 minute. A blinded creature can repeat the save at the end of each of its turns, ending the effect on itself on a success."
	}]
};
CreatureList["fractal mascot"] = { // Quandrix
	name : "Fractal Mascot",
	nameAlt : ["Mascot, Fractal"],
	source : [["SCC", 192]],
	size : 4,
	type : "Construct",
	companion : "strixhaven_mascot",
	alignment : "Neutral",
	ac : 12,
	hp : 27,
	hd : [6, 6],
	speed : "30 ft",
	scores : [12, 14, 13, 7, 10, 5],
	damage_immunities : "poison",
	condition_immunities : "poisoned",
	senses : "",
	passivePerception : 10,
	languages : "understands the languages of its creator but can't speak",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Quantum Strike",
		ability : 1,
		damage : [1, 4, "force"],
		range : "30 ft",
		description : "+1d4 damage if the fractal is Medium or bigger"
	}],
	actions : [{
		name : "Augment (bonus action)",
		description : "The fractal can increase its size by one category as a bonus action. While the fractal is Medium or bigger, it makes Strength checks and Strength saving throws with advantage. The fractal can become no larger than Huge via this bonus action."
	}, {
		name : "Diminish (bonus action)",
		description : "The fractal can decreases its size by one category as a bonus action. While the fractal is Tiny, it makes attack rolls, Dexterity checks, and Dexterity saving throws with advantage. The fractal can become no smaller than 1 ft in height via this bonus action."
	}],
	traits : [{
		name : "Relative Density",
		description : "The fractal can move through creatures and objects as if they were difficult terrain. It takes 1d10 force damage if it ends its turn inside an object."
	}]
};
CreatureList["inkling mascot"] = { // Silverquill
	name : "Inkling Mascot",
	nameAlt : ["Mascot, Inkling"],
	source : [["SCC", 195]],
	size : 5,
	type : "Ooze",
	companion : "strixhaven_mascot",
	alignment : "Neutral",
	ac : 13,
	hp : 18,
	hd : [4, 4],
	speed : "10 ft, fly 30 ft (hover)",
	scores : [10, 16, 14, 6, 7, 11],
	skills : {
		"stealth" : 5
	},
	damage_immunities : "psychic",
	condition_immunities : "blinded, charmed, deafened, exhaustion, prone",
	senses : "Blindsight 60 ft",
	passivePerception : 8,
	languages : "understands the languages of its creator but can't speak",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Blot",
		ability : 2,
		damage : [1, 4, "psychic"],
		range : "Melee (5 ft)",
		description : ""
	}],
	actions : [{
		name : "Ink Spray (1/Day)",
		description : "As an action, the inkling can spray viscous ink at one creature within 15 ft of itself. The target must succeed on a DC 12 Constitution saving throw or be blinded until the end of the inkling's next turn."
	}, {
		name : "Shadow Stealth (bonus action)",
		description : "While in dim light or darkness, the inkling can take the Hide action as a bonus action."
	}],
	traits : [{
		name : "Amorphous",
		description : "The inkling can move through a space as narrow as 1 inch wide without squeezing."
	}]
};
CreatureList["pest mascot"] = { // Witherbloom
	name : "Pest Mascot",
	nameAlt : ["Mascot, Pest"],
	source : [["SCC", 203]],
	size : 5,
	type : "Monstrosity",
	companion : "strixhaven_mascot",
	alignment : "Unaligned",
	ac : 13,
	hp : 22,
	hd : [4, 4],
	speed : "30 ft",
	scores : [11, 14, 17, 5, 13, 4],
	skills : {
		"perception" : 3
	},
	senses : "Darkvision 60 ft",
	passivePerception : 13,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Regeneration",
		description : "The pest regains 5 hit points at the start of its turn if it has at least 1 hit point. If it takes fire damage, this trait doesn't function at the start of the pest's next turn."
	}, {
		name : "Spiny Hide",
		description : "At the start of each of its turns, the pest deals 1d4 piercing damage to any creature grappling it or that it is grappling."
	}]
};
CreatureList["spirit statue mascot"] = { // Lorehold
	name : "Spirit Statue Mascot",
	nameAlt : ["Mascot, Spirit Statue"],
	source : [["SCC", 216]],
	size : 3,
	type : "Construct",
	companion : "strixhaven_mascot",
	alignment : "Any alignment",
	ac : 14,
	hp : 26,
	hd : [4, 8],
	speed : "30 ft",
	scores : [14, 9, 15, 12, 13, 8],
	skills : {
		"arcana" : 5,
		"history" : 5,
		"perception" : 3
	},
	senses : "",
	passivePerception : 13,
	languages : "any languages it knew in life",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Slam",
		ability : 1,
		damage : [1, 6, "bludgeoning"],
		range : "Melee (5 ft)",
		description : ""
	}],
	actions : [{
		name : "Counsel of the Past (2/Day)",
		description : "The spirit statue touches one creature. Once within the next 10 minutes, that creature can roll a d4 and add the number rolled to one ability check of its choice, immediately after rolling the d20."
	}],
	traits : [{
		name : "Death Burst",
		description : "When the spirit statue is reduced to 0 hit points, the statue crumbles, and the spirit returns to the afterlife in a burst of ghostly white flame. Each creature within 5 ft of it must succeed on a DC 12 Constitution saving throw or take 1d6 radiant damage."
	}]
};

// pub_20220125_MotM.js
// This file adds all the player-material from Mordenkainen Presents: Monsters of the Multiverse to MPMB's Character Record Sheet
// Includes many contributions by Nod_Hero and BraabHimself

// Define the source
SourceList.MotM = {
	name : "Mordenkainen Presents: Monsters of the Multiverse",
	abbreviation : "MotM",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/monsters-of-the-multiverse",
	date : "2022/01/25" // box set release date
};

//Add Races
RaceList["multiverse aarakocra"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*aarakocra).*$/i,
	name : "Multiverse Aarakocra",
	sortname : "Aarakocra, Multiverse",
	source : [["MotM", 5]],
	plural : "Aarakocra",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		fly : { spd : "walk", enc : 0 }
	},
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /talon/i,
		name : "Talons",
		source : [["MotM", 5]],
		damage : [1, 6, "slashing"],
		selectNow : true
	}],
	spellcastingAbility : [4, 5, 6],
	features : {
		"wind caller" : {
			name : "Wind Caller",
			minlevel : 3,
			spellcastingBonus : {
				name : "Wind Caller",
				spells : ["gust of wind"],
				selection : ["gust of wind"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Gust of Wind",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}],
			spellChanges : {
				"gust of wind" : {
					components : SpellsList["gust of wind"].components + "*",
					compMaterial : SpellsList["gust of wind"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Wind Caller trait.",
					changes : "Using Wind Caller, I can cast Gust of Wind once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			}
		}
	},
	scoresGeneric : true,
	trait : "Aarakocra"+
		"\n \u2022 Flight: I have a flying speed equal to my walking speed. To use this speed, I can't be wearing medium or heavy armor."+
		"\n \u2022 Talons: My unarmed strikes with talons deal 1d6 slashing damage."+
		"\n \u2022 Wind Caller: At 3rd level, I can cast Gust of Wind without using a spell slot or material component once per long rest, and by using spell slots as normal. Intelligence, Wisdom, or Charisma is my spellcasting ability for this (one-time choice)."
};
var MotM_Aasimar_trait = (typePF ? "\n" : "") + " \u2022 Light Bearer: I know the Light cantrip." +
"\n \u2022 Healing Hands: As an action once per long rest, I can touch a creature and heal it for a number of d4s equal to my Prof" + (typePF ? "." : "iciency") + " Bonus.";
var MotM_Aasimar_HealingHands = {
	name : "Healing Hands",
	minlevel : 1,
	usages : 1,
	recovery : "long rest",
	additional : ProficiencyBonusList.map(function(n) { return n + "d4 healing"; }),
	action : [["action", ""]]
};
RaceList["multiverse aasimar"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*aasimar).*$/i,
	name : "Multiverse Aasimar",
	sortname : "Aasimar, Multiverse",
	source : [["MotM", 7]],
	plural : "Aasimar",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	dmgres : ["Necrotic", "Radiant"],
	vision : [["Darkvision", 60]],
	scoresGeneric : true,
	trait : "Aasimar" + MotM_Aasimar_trait +
		"\n \u2022 Celestial Revelation: At 3rd level, I choose one option from Necrotic Shroud, Radiant Consumption, or Radiant Soul. As a bonus action once per long rest, I can transform and gain its benefits. This transformation lasts for 1 minute or until I end it as a bonus action.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Light Bearer",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"healing hands" : MotM_Aasimar_HealingHands
	}
};
AddRacialVariant("multiverse aasimar", "necrotic shroud", {
	regExpSearch : /shroud/i,
	name : "Necrotic Shroud Aasimar",
	source : [["MotM", 7]],
	abilitySave : 6,
	trait : "Aasimar (Necrotic Shroud)" + MotM_Aasimar_trait +
		"\n \u2022 Necrotic Shroud (3rd level): Once per long rest, I can transform for 1 minute as a bonus action (start/end), causing enemies within 10 ft to make a Cha save (DC 8 + Cha mod + Prof Bonus) or become frightened of me until my next turn ends. Also, once on each of my turns, I can deal my Prof Bonus in necrotic damage to one damaged by my attack or spell.",
	features : {
		"healing hands" : MotM_Aasimar_HealingHands,
		"necrotic shroud" : {
			name : "Necrotic Shroud",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) { return "+" + n + " necrotic damage"; }),
			action : [["bonus action", " (start/end)"]]
		}
	}
});
AddRacialVariant("multiverse aasimar", "radiant consumption", {
	regExpSearch : /consumption/i,
	name : "Radiant Consumption Aasimar",
	source : [["MotM", 7]],
	plural : "Aasimar",
	trait : "Aasimar (Radiant Consumption)" + MotM_Aasimar_trait +
		"\n \u2022 Radiant Consumption (3rd level): Once per long rest, I can transform for 1 minute as a bonus action (start/end). I shed 10-ft radius bright light and 10-ft dim light. At the end of my turns, all in this bright light take my Prof Bonus in radiant damage. Also, once on my turns, I can deal Prof Bonus in radiant damage to one damaged by my attack or spell.",
	features : {
		"healing hands" : MotM_Aasimar_HealingHands,
		"radiant consumption" : {
			name : "Radiant Consumption",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) { return "+" + n + " radiant damage"; }),
			action : [["bonus action", " (start/end)"]]
		}
	}
});
AddRacialVariant("multiverse aasimar", "radiant soul", {
	regExpSearch : /soul/i,
	name : "Radiant Soul Aasimar",
	source : [["MotM", 7]],
	plural : "Aasimar",
	trait : "Aasimar (Radiant Soul)" + MotM_Aasimar_trait +
		"\n \u2022 Radiant Soul (3rd level): As a bonus action once per long rest, I can transform to gain spectral wings that give my a flying speed equal to my walking speed. These last for 1 minute or until I dismiss them as a bonus action. Once on each of my turns while active, I can deal my Prof Bonus in radiant damage to one target damaged by my attack or spell.",
	features : {
		"healing hands" : MotM_Aasimar_HealingHands,
		"radiant soul" : {
			name : "Radiant Soul",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) { return "+" + n + " radiant damage"; }),
			action : [["bonus action", " (start/end)"]]
		}
	}
});
RaceList["multiverse bugbear"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*bugbear).*$/i,
	name : "Multiverse Bugbear",
	sortname : "Bugbear, Multiverse",
	source : [["MotM", 8]],
	plural : "Bugbears",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	savetxt : { adv_vs : ["charmed"] },
	skills : ["Stealth"],
	scoresGeneric : true,
	carryingCapacity : 2,
	trait : "Bugbear (my creature type is humanoid, goblinoid)"+
		"\n \u2022 Fey Ancestry: I have adv. on saves to avoid or end being charmed."+
		"\n \u2022 Powerful Build: I count as one size larger for the weight I can carry."+
		"\n \u2022 Long-Limbed: I add 5 ft of reach with my melee attacks on my turn."+
		"\n \u2022 Sneaky: I am proficient in Stealth and can move through and stop in a space large enough for a Small creature without squeezing."+
		"\n \u2022 Surprise Attack: My attacks deal +2d6 damage if the target hasn't taken a turn yet" + (typePF ? " in the current combat." : ".")
};
RaceList["multiverse centaur"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*centaur).*$/i,
	name : "Multiverse Centaur",
	sortname : "Centaur, Multiverse",
	source : [["MotM", 9]],
	plural : "Centaurs",
	size : 3,
	speed : {
		walk : { spd : 40, enc : 30 }
	},
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /\b(hoofs?|hooves)\b/i,
		name : "Hooves",
		source : [["MotM", 9]],
		damage : [1, 6, "bludgeoning"],
		description : "Use as bonus action after charge 30 ft",
		selectNow : true
	}],
	action : [["bonus action", "Hooves (after charge)"]],
	skillstxt : "Choose one from Animal Handling, Medicine, Nature, or Survival",
	scoresGeneric : true,
	trait : "Centaur"+
		"\n \u2022 Fey: My creature type is fey, rather than humanoid."+
		"\n \u2022 Hooves: I can use my hooves for unarmed strikes that deal 1d6 bludgeoning damage."+
		"\n \u2022 Charge: If I move 30 ft straight toward a creature and then hit it with a melee weapon attack on the same turn, I can make a hooves attack against it as a bonus action."+
		"\n \u2022 Equine Build: I count as one size larger for my carrying capacity and the weight I can push, drag, or lift. Because of my hooves, 1 ft of movement while climbing costs me 4 ft.",
	carryingCapacity : 2
};
RaceList["multiverse changeling"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*changeling).*$/i,
	name : "Multiverse Changeling",
	sortname : "Changeling, Multiverse",
	source : [["MotM", 41]],
	plural : "Changelings",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose two from Deception, Insight, Intimidation, Performance, and Persuasion",
	age : " typically live to be around 100 years old. While a changeling can transform to conceal their age, the effects of aging affect them similarly to humans",
	scoresGeneric : true,
	trait : "Changeling"+
		"\n \u2022 Fey: My creature type is fey, rather than humanoid."+
		"\n \u2022 Shapechanger: As an action, I can change my appearance and voice to or from a humanoid-shaped form I have seen, not changing my equipment. I determine the specifics of the form like hair length, eye color, and sex. I can adjust my height and weight between Medium and Small and can appear as a member of another race, though none of my game statistics change. I revert back when I die."+
		(typePF ? "\n \u2022 Changeling Instincts: I gain proficiency with 2 of the following skills: Deception, Insight, Intimidation, Performance, or Persuasion." : ""),
	action : [["action", "Shapechanger"]]
};
RaceList["multiverse deep gnome"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))((?=.*\b(underdarks?|deep|depths?)\b)(?=.*\bgnomes?\b)|(?=.*svirfneblin)).*$/i,
	name : "Multiverse Svirfneblin",
	sortname : "Gnome, Deep, Multiverse",
	source : [["MotM", 41]],
	plural : "Svirfneblin",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 120]],
	savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. spells"] },
	age : " can live to be 500 years old",
	scoresGeneric : true,
	trait : "Svirfneblin (my creature type is humanoid, gnome)"+
		"\n \u2022 Svirfneblin Camouflage: Proficiency bonus per long rest, I can gain adv. on Stealth checks."+
		"\n \u2022 Gnomish Magic Resistance: I have advantage on Int, Wis, and Cha saves vs. spells."+
		"\n \u2022 Gift of the Svirfneblin: At 3rd level, I can cast Disguise Self once per long rest without a spell slot. At 5th level, I can cast Nondetection once per long rest without a spell slot or material components. I can also cast each spell using spell slots as normal. Int, Wis, or Cha is my spellcasting ability for these (one-time choice).",
	spellcastingAbility : [4, 5, 6],
	features : {
		"svirfneblin camouflage" : {
			name : "Svirfneblin Camouflage",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"gift of the svirfneblin (level 3)" : {
			name : "Gift of the Svirfneblin (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Gift of the Svirfneblin",
				spells : ["disguise self"],
				selection : ["disguise self"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Disguise Self",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}]
		},
		"gift of the svirfneblin (level 5)" : {
			name : "Gift of the Svirfneblin (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Gift of the Svirfneblin",
				spells : ["nondetection"],
				selection : ["nondetection"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			spellChanges : {
				"nondetection" : {
					components : "V,S,M*",
					compMaterial : SpellsList["nondetection"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Gift of the Svirfneblin trait.",
					changes : "Using Gift of the Svirfneblin, I can cast Nondetection once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			},
			extraLimitedFeatures : [{
				name : "Nondetection",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 3+"
			}]
		}
	},
};
RaceList["multiverse duergar"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))((?=.*\bduergars?\b)|((?=.*\b(dwarfs?|dwarves|dwarfish|dwarvish|dwarven)\b)(?=.*\b(grey|gray|underdark)\b))).*$/i,
	name : "Multiverse Duergar",
	sortname : "Duergar, Multiverse",
	source : [["MotM", 12]],
	plural : "Duergar",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 120]],
	savetxt : { adv_vs : ["charmed", "poisoned", "stunned"] },
	dmgres : ["Poison"],
	age : " can live to be 350 years old",
	scoresGeneric : true,
	trait : "Duergar (my creature type is humanoid, dwarf)"+
		"\n \u2022 Dwarven Resilience \u0026 Psionic Fortitude: I have advantage on saving throws to avoid or end being poisoned, charmed, or stunned and I have resistance to poison damage."+
		"\n \u2022 Duergar Magic: At 3rd level, I learn the Enlarge/Reduce spell. At 5th level, I learn the Invisibility spell. I can cast each spell on myself once per long rest without using a spell slot or material components, or by using spell slots as normal. Intelligence, Wisdom, or Charisma is my spellcasting ability for these (one-time choice).",
	spellcastingAbility : [4, 5, 6],
	features : {
		"duergar magic (level 3)" : {
			name : "Duergar Magic (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Duergar Magic",
				spells : ["enlarge/reduce"],
				selection : ["enlarge/reduce"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			spellChanges : {
				"enlarge/reduce" : {
					range : "Self/" + SpellsList["enlarge/reduce"].range,
					components : SpellsList["enlarge/reduce"].components + "*",
					compMaterial : SpellsList["enlarge/reduce"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Duergar Magic trait.",
					changes : "Using Duergar Magic, I can cast Enlarge/Reduce on myself once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			},
			extraLimitedFeatures : [{
				name : "Enlarge/Reduce",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}]
		},
		"duergar magic (level 5)" : {
			name : "Duergar Magic (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Duergar Magic",
				spells : ["invisibility"],
				selection : ["invisibility"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			spellChanges : {
				"invisibility" : {
					range : "Self/" + SpellsList["invisibility"].range,
					components : SpellsList["invisibility"].components + "*",
					compMaterial : SpellsList["invisibility"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Duergar Magic trait.",
					changes : "Using Duergar Magic, I can cast Invisibility on myself once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			},
			extraLimitedFeatures : [{
				name : "Invisibility",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}]
		}
	}
};
RaceList["multiverse eladrin"] = {
	regExpSearch : /^(?!.*half)(?=.*(multiverse|motm\b))((?=.*eladrin)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(feys?|feywild)\b))).*$/i,
	name : "Multiverse Eladrin",
	sortname : "Elf, Fey (Eladrin), Multiverse",
	source : [["MotM", 13]],
	plural : "Eladrin",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	toolProfs : [["Trance: tool or weapon", 2]],
	age : " can live to be 750 years old",
	scoresGeneric : true,
	abilitySave : [4, 5, 6],
	trait : "Eladrin (my creature type is humanoid, elf)"+
		"\n \u2022 Trance: I don't need to sleep, and magic can't put me to sleep. I can finish a long rest in 4 hours while meditating consciously. At the end of the trance, I gain 2 weapon/tool proficiencies until the end of my next long rest."+
		"\n \u2022 Shifting Seasons: After finish a long rest, I can align with a season."+
		"\n \u2022 Fey Step: Prof Bonus per long rest, as a bonus action, I can magically teleport up to 30 ft to an unoccupied space I can see. At 3rd level, additional effects based on my season.",
	features : {
		"fey step" : {
			name : "Fey Step",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			action : [["bonus action", ""]],
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		}
	},
	toNotesPage : [{
		name : "Shifting Seasons",
		source : [["MotM", 13]],
		popupName : "Eladrin Shifting Season Features",
		additional : "save DC 8 + Prof Bonus + Int/Wis/Cha mod",
		page3notes : true,
		note : [
			"\u2022 Autumn (Eladrin Season)",
			" After using Fey Step, up to 2 creatures I can see within 10 ft of me must make a Wis save",
			" If failed, a target is charmed by me for 1 minute, or until I or my allies damage it",
			"\u2022 Winter (Eladrin Season)",
			" When I use Fey Step, one target " + (typePF ? "with" : "") + "in 5 ft of where I teleported from must make a Wis save",
			" If failed, it is frightened of me until the end of my next turn",
			"\u2022 Spring (Eladrin Season)",
			" When I use Fey Step, I can instead teleport one willing creature I touch within 5 ft of me",
			" It teleports to an unoccupied space of my choice that I can see within 30 ft of me",
			"\u2022 Summer (Eladrin Season)",
			" After using Fey Step, each creature of my choice I can see within 5 ft of me takes damage",
			" This is fire damage equal to my proficiency bonus"
		]
	}]
};
RaceList["multiverse firbolg"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*firbolg).*$/i,
	name : "Multiverse Firbolg",
	sortname : "Firbolg, Multiverse",
	source : [["MotM", 15]],
	plural : "Firbolg",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Speech of Beast and Leaf", 1],
	age : " can live up to 500 years",
	scoresGeneric : true,
	trait : "Firbolg"+
		(typePF ? "\n" : "") + " \u2022 Powerful Build: I count as one size larger for my carrying capacity."+
		"\n \u2022 Hidden Step: Proficiency Bonus per long rest, as a bonus action, I can turn invisible until my next turn starts, as per the Invisibility spell."+
		"\n \u2022 Firbolg Magic: I can cast Detect Magic and Disguise Self each once per long rest, or using spell slots as normal. Int, Wis, or Cha is my spellcasting ability for these (one-time choice)."+
		"\n \u2022 Speech of Beast and Leaf: I can make my words understood, in a limited manner, by Beasts, Plants, and vegetation. I have advantage on Charisma checks to influence them.",
	spellcastingAbility : [4, 5, 6],
	features : {
		"firbolg magic " : {
			name : "Firbolg Magic",
			spellcastingBonus : {
				name : "Firbolg Magic",
				spells : ["detect magic", "disguise self"],
				selection : ["detect magic", "disguise self"],
				firstCol : 'oncelr',
				times : 2,
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Detect Magic",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}, {
				name : "Disguise Self",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}],
			spellChanges : {
				"disguise self" : {
					description : "Alter appearance, up to 3ft shorter/taller; Int(Investigation) check vs. spell DC to determine disguise",
					changes : "Using Firbolg Magic, I can cast Disguise Self once per long rest without using a spell slot. When I cast it using Firbolg Magic, I can also seem up to 3 feet shorter or taller."
				}
			}
		},
		"hidden step" : {
			name : "Hidden Step",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			action : [["bonus action", ""]]
		}
	},
	carryingCapacity : 2
};
RaceList["multiverse air genasi"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*(genasi|planetouched))(?=.*\bairs?\b).*$/i,
	name : "Multiverse Air Genasi",
	sortname : "Genasi, Air, Multiverse",
	source : [["MotM", 16]],
	plural : "Air genasi",
	size : [3, 4],
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	vision : [["Darkvision", 60]],
	dmgres : ["Lightning"],
	age : " can live up to 120 years",
	scoresGeneric : true,
	trait : "Air Genasi"+
	"\n \u2022 Unending Breath: I can hold my breath indefinitely while I am not incapacitated."+
	"\n \u2022 Lightning Resistance: I have resistance to lightning damage."+
	"\n \u2022 Mingle with the Wind: I know the Shocking Grasp cantrip. At 3rd level, I learn Feather Fall. At 5th level, I learn Levitate. I can cast each spell without using a spell slot or material components once per long rest, and by using spell slots as normal. Intelligence, Wisdom, or Charisma is my spellcasting ability for these (one-time choice).",
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Mingle with the Wind",
		spells : ["shocking grasp"],
		selection : ["shocking grasp"],
		firstCol : "atwill"
	},
	features : {
		"mingle with the wind (level 3)" : {
			name : "Mingle with the Wind (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Mingle with the Wind",
				spells : ["feather fall"],
				selection : ["feather fall"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Feather Fall",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}],
			spellChanges : {
				"feather fall" : {
					components : SpellsList["feather fall"].components + "*",
					compMaterial : SpellsList["feather fall"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Mingle with the Wind trait.",
					changes : "Using Mingle with the Wind, I can cast Feather Fall once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			}
		},
		"mingle with the wind (level 5)" : {
			name : "Mingle with the Wind (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Mingle with the Wind",
				spells : ["levitate"],
				selection : ["levitate"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Levitate",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}],
			spellChanges : {
				"levitate" : {
					components : SpellsList["levitate"].components + "*",
					compMaterial : SpellsList["levitate"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Mingle with the Wind trait.",
					changes : "Using Mingle with the Wind, I can cast Levitate once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			}
		}
	}
};
RaceList["multiverse earth genasi"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*(genasi|planetouched))(?=.*\bearths?\b).*$/i,
	name : "Multiverse Earth Genasi",
	sortname : "Genasi, Earth, Multiverse",
	source : [["MotM", 17]],
	plural : "Earth genasi",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	age : " can live up to 120 years",
	scoresGeneric : true,
	trait : "Earth Genasi"+
	"\n \u2022 Earth Walk: I can move across difficult terrain without expending extra movement if I am using my walking speed on the ground or a floor."+
	"\n \u2022 Merge with Stone: I can cast the Blade Ward cantrip as normal and as a bonus action Prof Bonus times per long rest. At 5th level, I can cast Pass Without Trace without using a spell slot or material component once per long rest, or by using spell slots as normal. Intelligence, Wisdom, or Charisma is my spellcasting ability for these (one-time choice).",
	spellcastingAbility : [4, 5, 6],
	features : {
		"Merge with Stone (level 1)" : {
			name : "Merge with Stone",
			minlevel : 1,
			spellcastingBonus : {
				name : "Merge with Stone",
				spells : ["blade ward"],
				selection : ["blade ward"],
				firstCol : "atwill"
			},
			extraLimitedFeatures : [{
				name : "Blade Ward (as bonus action)",
				usages : "Proficiency bonus per ",
				recovery : "long rest",
				usagescalc : "event.value = How('Proficiency Bonus');"
			}],
			action : [["bonus action", "Blade Ward"]],
			spellChanges : {
				"blade ward" : {
					time : "1 a/bns",
					changes : "Using Merge with Stone, I can cast Blade Ward as a bonus action a number of times per long rest equal to my proficiency bonus."
				}
			}
		},
		"merge with stone (level 5)" : {
			name : "Merge with Stone (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Merge with Stone",
				spells : ["pass without trace"],
				selection : ["pass without trace"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Pass Without Trace",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}],
			spellChanges : {
				"pass without trace" : {
					components : SpellsList["pass without trace"].components + "*",
					compMaterial : SpellsList["pass without trace"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Merge with Stone trait.",
					changes : "Using Merge with Stone, I can cast Pass Without Trace once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			}
		}
	}
};
RaceList["multiverse fire genasi"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*(genasi|planetouched))(?=.*\bfires?\b).*$/i,
	name : "Multiverse Fire Genasi",
	sortname : "Genasi, Fire, Multiverse",
	source : [["MotM", 17]],
	plural : "Fire genasi",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " can live up to 120 years",
	scoresGeneric : true,
	trait : "Fire Genasi"+
	"\n \u2022 Fire Resistance: I have resistance to fire damage."+
	"\n \u2022 Reach to the Blaze: I know the Produce Flame cantrip. At 3rd level, I learn Burning Hands. At 5th level, I learn Flame Blade. I can cast each spell without using a spell slot or material components once per long rest, or by using spell slots as normal. Intelligence, Wisdom, or Charisma is my spellcasting ability for these (one-time choice).",
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Reach to the Blaze",
		spells : ["produce flame"],
		selection : ["produce flame"],
		firstCol : "atwill"
	},
	features : {
		"reach to the blaze (level 3)" : {
			name : "Reach to the Blaze (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Reach to the Blaze",
				spells : ["burning hands"],
				selection : ["burning hands"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Burning Hands",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}]
		},
		"reach to the blaze (level 5)" : {
			name : "Reach to the Blaze (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Reach to the Blaze",
				spells : ["flame blade"],
				selection : ["flame blade"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Flame Blade",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}],
			spellChanges : {
				"flame blade" : {
					components : SpellsList["flame blade"].components + "*",
					compMaterial : SpellsList["flame blade"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Reach to the Blaze trait.",
					changes : "Using Reach to the Blaze, I can cast Flame Blade once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			}
		}
	}
};
RaceList["multiverse water genasi"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*(genasi|planetouched))(?=.*\bwaters?\b).*$/i,
	name : "Multiverse Water Genasi",
	sortname : "Genasi, Water, Multiverse",
	source : [["MotM", 17]],
	plural : "Water genasi",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : "walk", enc : "walk" }
	},
	vision : [["Darkvision", 60]],
	dmgres : ["Acid"],
	age : " can live up to 120 years",
	scoresGeneric : true,
	trait : "Water Genasi"+
	"\n \u2022 Amphibious: I can breathe air and water" + (typePF ? "and I have a swimming speed equal to my walking speed." : ", have a swimming speed equal to walking speed.")+
	"\n \u2022 Acid Resistance: I have resistance to acid damage."+
	"\n \u2022 Call to the Wave: I know the Acid Splash cantrip. At 3rd level, I can cast Create or Destroy Water without using a spell slot once per long rest. At 5th level, I can cast Water Walk without using a spell slot or material components once per long rest. I can also cast each spell using spell slots as normal. Int, Wis, or Cha is my spellcasting ability for these" + (typePF ? " (one-time choice)." : "."),
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Call to the Wave",
		spells : ["acid splash"],
		selection : ["acid splash"],
		firstCol : "atwill"
	},
	features : {
		"call to the wave (level 3)" : {
			name : "Call to the Wave (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Call to the Wave",
				spells : ["create or destroy water"],
				selection : ["create or destroy water"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Create or Destroy Water",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}]
		},
		"call to the wave (level 5)" : {
			name : "Call to the Wave (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Call to the Wave",
				spells : ["water walk"],
				selection : ["water walk"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Water Walk",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 3+"
			}],
			spellChanges : {
				"water walk" : {
					components : SpellsList["water walk"].components + "*",
					compMaterial : SpellsList["water walk"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Call to the Wave trait.",
					changes : "Using Call to the Wave, I can cast Water Walk once per long rest without requiring material components. I can also cast it using a spell slot as normal, but then it does require material components."
				}
			}
		}
	}
};
RaceList["multiverse githyanki"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*githyanki).*$/i,
	name : "Multiverse Githyanki",
	sortname : "Githyanki, Multiverse",
	source : [["MotM", 18]],
	plural : "Githyanki",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	dmgres : ["Psychic"],
	skillstxt : "Choose any one skill that lasts until the end of my next long rest",
	toolProfs : [["Astral Knowledge: tool/weapon", 1]],
	age : " typically live to be around 100 years old. Githyanki who reside in the Astral Plane can live indefinitely.",
	scoresGeneric : true,
	trait : "Githyanki"+
		"\n \u2022 Astral Knowledge: When I finish a long rest, I gain proficiency with 1 skill and with 1 weapon or tool from the PHB until the end of my next long rest."+
		"\n \u2022 Githyanki Psionics: I know the Mage Hand cantrip, but require no components to cast it and the hand is invisible. At 3rd level, I learn Jump. At 5th level, I learn Misty Step. I can cast each without using components or a spell slot once per long rest, as well as by using spell slots as normal. Int, Wis, or Cha is my spellcasting ability for these (one-time choice).",
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Githyanki Psionics (1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : "atwill"
	},
	spellChanges : {
		"mage hand" : {
			components : "",
			description : "Create invisible spectral hand for simple tasks or carry up to 10 lb; 1 a to control; can't have multiple",
			changes : "Using Githyanki Psionics, I can cast Mage Hand without requiring components and the spectral hand is invisible."
		}
	},
	features : {
		"githyanki psionics (level 3)" : {
			name : "Githyanki Psionics (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Githyanki Psionics (3)",
				spells : ["jump"],
				selection : ["jump"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Jump",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}],
			spellChanges : {
				"jump" : {
					components : SpellsList["jump"].components + "*",
					compMaterial : SpellsList["jump"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Githyanki Psionics trait.",
					changes : "Using Githyanki Psionics, I can cast Jump once per long rest without requiring components. I can also cast it using a spell slot as normal, but then it does require components."
				}
			}
		},
		"githyanki psionics (level 5)" : {
			name : "Githyanki Psionics (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Githyanki Psionics (5)",
				spells : ["misty step"],
				selection : ["misty step"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Misty Step",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}],
			spellChanges : {
				"misty step" : {
					components : SpellsList["misty step"].components + "*",
					changes : "Using Githyanki Psionics, I can cast Misty Step once per long rest without requiring components. I can also cast it using a spell slot as normal, but then it does require components."
				}
			}
		}
	}
};
// Githzerai
RaceList["multiverse githzerai"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*githzerai).*$/i,
	name : "Multiverse Githzerai",
	sortname : "Githzerai, Multiverse",
	source : [["MotM", 19]],
	plural : "Githzerai",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	savetxt : { adv_vs : ["charmed", "frightened"] },
	dmgres : ["Psychic"],
	age : " typically live to be around 100 years old. Githzerai who reside in the Astral Plane can live indefinitely.",
	scoresGeneric : true,
	trait : "Githzerai"+
		"\n \u2022 Githzerai Psionics: I know the Mage Hand cantrip, but require no components to cast it and the hand is invisible. At 3rd level, I learn Shield. At 5th level, I learn Detect Thoughts. I can cast each without using components or a spell slot once per long rest, or by using spell slots as normal. Int, Wis, or Cha is my spellcasting ability for these (one-time choice)."+
		"\n \u2022 Mental Discipline: I have advantage on saving throws to avoid or end the charmed and frightened conditions on myself.",
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Githzerai Psionics (1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : "atwill"
	},
	spellChanges : {
		"mage hand" : {
			components : "",
			description : "Create invisible spectral hand for simple tasks or carry up to 10 lb; 1 a to control; can't have multiple",
			changes : "Using Githzerai Psionics, I can cast Mage Hand without requiring components and the spectral hand is invisible."
		}
	},
	features : {
		"githzerai psionics (level 3)" : {
			name : "Githzerai Psionics (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Githzerai Psionics (3)",
				spells : ["shield"],
				selection : ["shield"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Shield",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}],
			spellChanges : {
				"shield" : {
					components : SpellsList["shield"].components + "*",
					changes : "Using Githzerai Psionics, I can cast Shield once per long rest without requiring components. I can also cast it using a spell slot as normal, but then it does require components."
				}
			}
		},
		"githzerai psionics (level 5)" : {
			name : "Githzerai Psionics (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Githzerai Psionics (5)",
				spells : ["detect thoughts"],
				selection : ["detect thoughts"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Detect Thoughts",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}],
			spellChanges : {
				"detect thoughts" : {
					components : SpellsList["detect thoughts"].components + "*",
					compMaterial : SpellsList["detect thoughts"].compMaterial + "\nMaterial component is only needed when cast using a spell slot, not when cast using the Githzerai Psionics trait.",
					changes : "Using Githzerai Psionics, I can cast Detect Thoughts once per long rest without requiring components. I can also cast it using a spell slot as normal, but then it does require components."
				}
			}
		}
	},
};
RaceList["multiverse goblin"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*goblin).*$/i,
	name : "Multiverse Goblin",
	sortname : "Goblin, Multiverse",
	source : [["MotM", 20]],
	plural : "Goblins",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	savetxt : { adv_vs : ["charmed"] },
	scoresGeneric : true,
	features : {
		"fury of the small" : {
			name : "Fury of the Small",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) { return "+" + n + " damage"; })
		}
	},
	action : [["bonus action", "Nimble Escape (disengage/hide)"]],
	trait : "Goblin (my creature type is humanoid, goblinoid)"+
		"\n \u2022 Fey Ancestry: I have advantage on saving throws to avoid or end the charmed condition on myself."+
		"\n \u2022 Fury of the Small: A number of times per long rest equal to my Proficiency Bonus, when I damage a creature of a size category larger than mine with an attack or a spell, I can have it take extra damage equal to my Proficiency Bonus."+
		"\n \u2022 Nimble Escape: As a bonus action, I can take the Disengage or Hide action."
};
RaceList["multiverse goliath"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*goliath).*$/i,
	name : "Multiverse Goliath",
	sortname : "Goliath, Multiverse",
	source : [["MotM", 21]],
	plural : "Goliaths",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	dmgres : ["Cold"],
	skills : ["Athletics"],
	scoresGeneric : true,
	features : {
		"stone's endurance" : {
			name : "Stone's Endurance",
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			action : [["reaction", ""]]
		}
	},
	trait : "Goliath"+
		"\n \u2022 Stone's Endurance: Proficiency Bonus per long rest, when I take damage, I can use my reaction to reduce the damage by 1d12 + my Constitution modifier."+
		"\n \u2022 Little Giant: I have proficiency in the Athletics skill and count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift."+
		"\n \u2022 Mountain Born: I have resistance to cold damage and I'm acclimated to high altitude, including elevations above 20000 ft.",
	carryingCapacity : 2
};
RaceList["multiverse hobgoblin"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*hobgoblin).*$/i,
	name : "Multiverse Hobgoblin",
	sortname : "Hobgoblin, Multiverse",
	source : [["MotM", 23]],
	plural : "Hobgoblins",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	scoresGeneric : true,
	vision : [["Darkvision", 60]],
	savetxt : { adv_vs : ["charmed"] },
	features : {
		"fey gift" : {
			name : "Fey Gift",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			action : [["bonus action", " (Help action)"]],
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"fortune from the many" : {
			name : "Fortune from the Many",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"fey gift: additional effect" : {
			name : "Fey Gifts: Additional Effects",
			minlevel : 3,
			toNotesPage : [{
				page3notes : true,
				note : [
					"Whenever I use Fey Gift to take the Help action, I can choose one of these additional effects:",
					" \u2022 Hospitality: The one I help and I each gain 1d6 + my Prof Bonus in temporary HP",
					" \u2022 Passage: The one I help and I both gain +10 ft walking speed until my next turn stats",
					" \u2022 Spite: The first time the one I help hits an attack roll before my next turn starts,",
					"   the creature hit gains disadvantage on its next attack roll within the next minute"
				]
			}]
		}
	},
	trait : "Hobgoblin (my creature type is humanoid, goblinoid)"+
		"\n \u2022 Fey Ancestry: I have adv. on saves to avoid or end being charmed."+
		'\n \u2022 Fey Gift: Prof Bonus per long rest, I can take the Help action as a bonus action. From 3rd-level, I can produce an additional effect when I do this: Hospitality, Passage, or Spite.'+
		"\n \u2022 Fortune from the Many: Prof Bonus per long rest, when I miss an attack or fail an ability check or saving throw, I can gain a bonus to the roll equal to the number of allies I can see within 30 ft of me (max +3)."
};
RaceList["multiverse kenku"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*kenku).*$/i,
	name : "Multiverse Kenku",
	sortname : "Kenku, Multiverse",
	source : [["MotM", 24]],
	plural : "Kenku",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose any two skills",
	abilitySave : 6,
	scoresGeneric : true,
	features : {
		"kenku recall" : {
			name : "Kenku Recall",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		}
	},
	trait : "Kenku"+
		"\n \u2022 Expert Duplication: I have adv. on checks to produce exact copies of writing or craftwork."+
		"\n \u2022 Kenku Recall: Proficiency Bonus per long rest, I can give myself advantage on an ability check using any skill in which I have proficiency."+
		"\n \u2022 Mimicry: I can mimic sounds and voices I have heard. Creatures hearing me can determine the imitation with a successful Wisdom (Insight) check against a DC of 8 + my Proficiency Bonus + my Charisma modifier."
};
var MotM_Kobold_Draconic_Cry = "\n \u2022 Draconic Cry: As a bonus action, I can let out a cry. Until the start of my next turn, my allies and I have advantage on attack rolls against any enemies within 10 ft of me who could hear the cry. I can do this a number of times per long rest equal to my Proficiency Bonus.";
RaceList["multiverse kobold"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*kobold).*$/i,
	name : "Multiverse Kobold",
	sortname : "Kobold, Multiverse",
	source : [["MotM", 25]],
	plural : "Kobolds",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	scoresGeneric : true,
	features : {
		"draconic cry" : {
			name : "Draconic Cry",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			action : [["bonus action", ""]],
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		}
	},
	trait : "Kobold"+
		'\n \u2022 Kobold Legacy: Choose one of the following with the "Racial Options" button:'+
		"\n    - Defiance: I have advantage on saves vs. being frightened"+
		"\n    - Draconic Sorcery: I know one sorcerer cantrip of my choice"+
		"\n    - Craftiness: I gain proficiency in one of the following: Arcana, Investigation, Medicine, Sleight of Hand, or Survival."+
		MotM_Kobold_Draconic_Cry
};
AddRacialVariant("multiverse kobold", "craftiness", {
	regExpSearch : /craftiness/i,
	name : "Craftiness Multiverse Kobold",
	source : [["MotM", 25]],
	skillstxt : "Choose one from Arcana, Investigation, Medicine, Sleight of Hand, or Survival",
	trait : "Kobold"+
		"\n \u2022 Kobold Legacy (Craftiness): I gain proficiency in one of the following skills of my choice: Arcana, Investigation, Medicine, Sleight of Hand, or Survival."+
		MotM_Kobold_Draconic_Cry
});
AddRacialVariant("multiverse kobold", "defiance", {
	regExpSearch : /defiance/i,
	name : "Defiance Multiverse Kobold",
	source : [["MotM", 25]],
	plural : "Kobolds",
	savetxt : { adv_vs : ["frightened"] },
	trait : "Kobold"+
		'\n \u2022 Kobold Legacy (Defiance): I have advantage on saving throws to avoid or end the frightened condition on myself.'+
		MotM_Kobold_Draconic_Cry,
});
AddRacialVariant("multiverse kobold", "draconic sorcery", {
	regExpSearch : /sorcery/i,
	name : "Draconic Sorcery Multiverse Kobold",
	source : [["MotM", 25]],
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Kobold Legacy",
		"class" : "sorcerer",
		level : [0, 0],
		firstCol : 'atwill',
		allowUpCasting : true
	},
	trait : "Kobold"+
		'\n \u2022 Kobold Legacy (Draconic Sorcery): I know one cantrip from the sorcerer spell list. Intelligence, Wisdom, or Charisma is my spellcasting ability for it (one-time choice).'+
		MotM_Kobold_Draconic_Cry,
});
// Lizardfolk
RaceList["multiverse lizardfolk"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*lizard(folk|man|men)).*$/i,
	name : "Multiverse Lizardfolk",
	sortname : "Lizardfolk, Multiverse",
	source : [["MotM", 26]],
	plural : "Lizardfolk",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : "walk", enc : "walk" }
	},
	skillstxt : "Choose two from Animal Handling, Medicine, Nature, Perception, Stealth, and Survival",
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /\bbite\b/i,
		name : "Bite",
		source : [["MotM", 26]],
		damage : [1, 6, "slashing"],
		selectNow : true
	}],
	armorOptions : [{
		regExpSearch : /^(?=.*natural)(?=.*armou?r).*$/i,
		name : "Natural Armor",
		source : [["MotM", 26]],
		ac : 13,
		selectNow : true
	}],
	scoresGeneric : true,
	features : {
		"hungry jaws" : {
			name : "Hungry Jaws",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) { return n + " temp HP"; }),
			action : ["bonus action", ""]
		}
	},
	trait : "Lizardfolk"+
		"\n \u2022 Bite: My unarmed strikes with my fanged maw deal 1d6 slashing damage."+
		"\n \u2022 Hold Breath: I can hold my breath for up to 15 minutes at a time."+
		"\n \u2022 Hungry Jaws: Prof Bonus per long rest, as a bonus action, I can make a special bite attack. If it hits, it deals damage and I gain temporary HP equal to my proficiency bonus."+
		"\n \u2022 Natural Armor: I have an AC of 13 + Dexterity modifier + shield."+
		"\n \u2022 Nature's Intuition: I gain proficiency with two of the following  Animal Handling, Medicine, Nature, Perception, Stealth, or Survival."
};
RaceList["multiverse minotaur"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*minotaur).*$/i,
	name : "Multiverse Minotaur",
	sortname : "Minotaur, Multiverse",
	source : [["MotM", 27]],
	plural : "Minotaurs",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /\bhorns?\b/i,
		name : "Horns",
		source : [["MotM", 27]],
		damage : [1, 6, "piercing"],
		description : "Attack as a bonus action after moving 20 ft with the Dash action",
		selectNow : true
	}],
	scoresGeneric : true,
	abilitySave : 1,
	vision : [["Always know north", 0], ["Adv. on Survival to navigate or track", 0]],
	action : [["bonus action", "Goring Rush (with Dash)"], ["bonus action", "Hammering Horns (after hit)"]],
	trait : "Minotaur"+(typePF ? "\n" : "")+
		" \u2022 Horns: My unarmed strikes with horns deal 1d6 piercing damage."+
		"\n \u2022 Goring Rush: When taking a Dash action and moving at least 20 ft, I can make a horns attack as a bonus action."+
		"\n \u2022 Hammering Horns: As a bonus action after I hit a melee attack on my turn during my Attack action, I can shove the target, if it's up to one size larger than me. It must make a Str save (DC 8 + Str mod + Prof Bonus) or be pushed up to 10 ft away from me."+
		"\n \u2022 Labyrinthine Recall: " + (typePF ? "I always know which direction is north, and have adv. on any Wis (Survival) check I make to navigate or track." : "I have adv. on Survival to navigate or track and always know north.")
};
RaceList["multiverse orc"] = {
	regExpSearch : /^(?!.*half)(?=.*(multiverse|motm\b))(?=.*orc).*$/i,
	name : "Multiverse Orc",
	sortname : "Orc, Multiverse",
	source : [["MotM", 28]],
	plural : "Orcs",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	scoresGeneric : true,
	trait : "Orc"+
		"\n \u2022 Adrenaline Rush: Proficiency bonus per long rest, I can take the Dash action as a bonus action and gain my proficiency bonus in temporary hit points."+
		"\n \u2022 Powerful Build: I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift."+
		"\n \u2022 Relentless Endurance: Once per long rest, when I am reduced to 0 hit points but not killed outright, I can drop to 1 hit point instead.",
	features : {
		"adrenaline rush" : {
			name : "Adrenaline Rush",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) { return "+" + n + " temp HP"; }),
			action : [["bonus action", ""]],
		},
		"relentless endurance" : {
			name : "Relentless Endurance",
			minlevel : 1,
			usages : 1,
			recovery : "long rest"
		}
	},
	carryingCapacity : 2
};
RaceList["multiverse satyr"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*satyr).*$/i,
	name : "Multiverse Satyr",
	sortname : "Satyr, Multiverse",
	source : [["MotM", 29]],
	plural : "Satyr",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	savetxt : { adv_vs : ["spells"] },
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*(satyr|\bram\b))(?=.*headbutt).*$/i,
		name : "Satyr Headbutt",
		source : [["MotM", 29]],
		damage : [1, 6, "bludgeoning"],
		selectNow : true
	}],
	toolProfs : [["Musical instrument", 1]],
	scoresGeneric : true,
	skills : ["Performance", "Persuasion"],
	trait : "Satyr (my creature type is fey, rather than humanoid)"+
		"\n \u2022 Ram: My unarmed strikes with my horned head deal 1d6 bludgeoning damage."+
		"\n \u2022 Magic Resistance: I have advantage on saves against spells."+
		"\n \u2022 Mirthful Leaps: Whenever I make a long or high jump, I can roll a d8 and add the number rolled to the number of feet I cover, even when making a standing jump. This extra distance costs movement as normal."+
		"\n \u2022 Reveler: I have proficiency in Performance, Persuasion, and one musical instrument."
};
RaceList["multiverse sea elf"] = {
	regExpSearch : /^(?!.*half)(?=.*(multiverse|motm\b))((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(seas?|oceans?|water)\b)).*$/i,
	name : "Multiverse Sea Elf",
	sortname : "Elf, Sea, Multiverse",
	source : [["MotM", 30]],
	plural : "Sea Elves",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : "walk", enc : "walk" }
	},
	languageProfs : ["Common", "Friend of the Sea", 1],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	dmgres : ["Cold"],
	skills : ["Perception"],
	toolProfs : [["Trance: tool or weapon", 2]],
	age : " can live to be 750 years old",
	scoresGeneric : true,
	trait : "Sea Elf (my creature type is humanoid, elf)"+
		"\n \u2022 Trance: I don't need to sleep, and magic can't put me to sleep. I can finish a long rest in 4 hours while meditating consciously. At the end of the trance, I gain 2 weapon/tool proficiencies until the end of my next long rest."+
		"\n \u2022 Child of the Sea. I can breathe air and water and have resistance to cold damage."+
		"\n \u2022 Friend of the Sea: I can communicate simple ideas to beasts with a swimming speed. It can understand my words, though I have no special ability to understand it in return."
};
RaceList["multiverse shadar-kai"] = {
	regExpSearch : /^(?!.*half)(?=.*(multiverse|motm\b))((?=.*shadar-kai)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(shadows?|shadowfell)\b))).*$/i,
	name : "Multiverse Shadar-kai",
	sortname : "Elf, Shadow (Shadar-kai), Multiverse",
	source : [["MotM", 31]],
	plural : "Shadar-kai",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	dmgres : ["Necrotic"],
	skills : ["Perception"],
	toolProfs : [["Trance: tool or weapon", 2]],
	age : " can live to be 750 years old",
	scoresGeneric : true,
	trait : "Shadar-kai (my creature type is humanoid, elf)"+
		"\n \u2022 Trance: I don't need to sleep, and magic can't put me to sleep. I can finish a long rest in 4 hours while meditating consciously. At the end of the trance, I gain 2 weapon/tool proficiencies until the end of my next long rest."+
		"\n \u2022 Blessing of the Raven Queen: Prof Bonus per long rest, as a bonus action, I can magically teleport up to 30 ft to an unoccupied space I can see. Once I reach 3rd level, I then also appear translucent and have resistance to all damage until the start of my next turn.",
	features : {
		"blessing of the raven queen" : {
			name : "Blessing of the Raven Queen",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			action : [["bonus action", ""]]
		}
	}
};
[{
	name : "Beasthide",
	regExpSearch : "(?=.*beast)(?=.*hide)",
	trait : "\n \u2022 Shifting (Beasthide): Prof Bonus per long rest, as a bonus action, I can assume a more bestial appearance. This transformation lasts for 1 minute, until I die, or until I revert back as a bonus action. When I shift, I gain 1d6 + twice my proficiency bonus in temporary hit points and a +1 bonus to my AC.",
	extra : {
		features : {
			"shift" : {
				name : "Shift",
				minlevel : 1,
				usages : "Proficiency bonus per ",
				usagescalc : "event.value = How('Proficiency Bonus');",
				recovery : "long rest",
				additional : ProficiencyBonusList.map(function(n) { return "1d6 + " + (2 * n) + " temp HP"; })
			}
		}
	}
}, {
	name : "Longtooth",
	regExpSearch : "(?=.*long)(?=.*(tooth|teeth))",
	trait : "\n \u2022 Shifting (Longtooth): Prof Bonus per long rest, as a bonus action, I can assume a more bestial appearance for 1 minute, until I die, or until I revert back as a bonus action. When I shift, I gain twice my proficiency bonus in temporary hit points and my fangs elongate. As part of the bonus action when I shift and as a bonus action while shifted, I can make a single unarmed strike with my elongated fangs that deals 1d6 piercing damage.",
	extra : {
		action : [["bonus action", "Longtooth Fangs (while shifted)"]],
		weaponOptions : [{
			baseWeapon : "unarmed strike",
			regExpSearch : /^(?=.*fangs?)(?=.*long)(?=.*(tooth|teeth)).*$/i,
			name : "Longtooth Fangs",
			source : [["MotM", 32]],
			damage : [1, 6, "piercing"],
			description : "Only while shifted; One attack as bonus action",
			selectNow : true
		}]
	}
}, {
	name : "Swiftstride",
	regExpSearch : "(?=.*swift)(?=.*stride)",
	trait : "\n \u2022 Shifting (Swiftstride): Prof Bonus per long rest, as a bonus action, I can assume a more bestial appearance for 1 minute, until I die, or until I revert back as a bonus action. When I shift, I gain twice my proficiency bonus in temporary hit points and +10 ft to my walking speed. Additionally, as a reaction when a creature ends its turn within 5 ft of me, I can move up to 10 ft. This reactive movement doesn't provoke opportunity attacks.",
	extra : {
		action : [['reaction', 'Reactive Stride (while shifted)']]
	}
}, {
	name : "Wildhunt",
	regExpSearch : "(?=.*wild)(?=.*hunt)",
	trait : "\n \u2022 Shifting (Wildhunt): Prof Bonus per long rest, as a bonus action, I can assume a more bestial appearance. This transformation lasts for 1 minute, until I die, or until I revert back as a bonus action. When I shift, I gain twice my proficiency bonus in temporary hit points. While I'm shifted, I have advantage on Wisdom checks and no creature within 30 ft of me can make an attack roll with advantage against me unless I'm incapacitated.",
	extra : {
		vision : [
			["Darkvision", 60],
			["While shifted, creatures within 30 ft can't attack me with adv.", 0]
		],
		savetxt : { text : ["While shifted, Adv. on Wis checks"] }
	}
}].forEach(function(o) {
	var objNm = "multiverse " + o.name.toLowerCase() + " shifter";
	RaceList[objNm] = {
		regExpSearch : RegExp("^(?=.*(multiverse|motm\\b))" + o.regExpSearch + "(?=.*shifter).*$", "i"),
		name : "Multiverse " + o.name + " Shifter",
		sortname : "Shifter, " + o.name + ", Multiverse",
		source : [["MotM", 32]],
		plural : o.name + " shifters",
		size : 3,
		speed : {
			walk : { spd : 30, enc : 20 }
		},
		vision : [["Darkvision", 60]],
		skillstxt : "Choose one skill from Acrobatics, Athletics, Intimidation, or Survival",
		scoresGeneric : true,
		trait : o.name + " Shifter"+
			"\n \u2022 Bestial Instincts: I have proficiency in Acrobatics, Athletics, Intimidation, or Survival."+
			o.trait,
		features : {
			"shift" : {
				name : "Shift",
				minlevel : 1,
				usages : "Proficiency bonus per ",
				usagescalc : "event.value = How('Proficiency Bonus');",
				recovery : "long rest",
				additional : ProficiencyBonusList.map(function(n) { return 2 * n + " temp HP"; }),
				action : [["bonus action", " (start/end)"]]
			}
		}
	};
	for (var attr in o.extra) {
		RaceList[objNm][attr] = o.extra[attr];
	}
});
RaceList["tabaxi-motm"] = { // just a plain improvement over the previous, no need to make it a separate "multiverse" choice
	regExpSearch : /tabaxi/i,
	name : "Tabaxi",
	source : [["MotM", 33]],
	plural : "Tabaxi",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 },
		climb : { spd : "walk", enc : "walk" }
	},
	skills : ["Perception", "Stealth"],
	vision : [["Darkvision", 60]],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*(tabaxi|\bcat\b))(?=.*claw).*$/i,
		name : "Tabaxi Claws",
		source : [["MotM", 33]],
		damage : [1, 6, "slashing"],
		selectNow : true
	}],
	scoresGeneric : true,
	age : " reach adulthood in their late teens and live less than 100 years [according to VGtM]",
	height : ", when Medium sized, range from 5 to well over 6 feet tall (4'10\" + 2d10\") [according to VGtM]",
	weight : ", when Medium sized, weigh around 150 lb (90 + 2d10 \xD7 2d4 lb) [according to VGtM]",
	heightMetric : ", when Medium sized, range from 1,5 to well over 1,8 metres tall (145 + 5d10 cm) [according to VGtM]",
	weightMetric : ", when Medium sized, weigh around 70 kg (40 + 5d10 \xD7 4d4 / 10 kg)",
	features : {
		"feline agility" : {
			name : "Feline Agility",
			minlevel : 1,
			usages : 1,
			recovery : " Turn",
			additional : "still for 1 turn to recover",
			tooltip : " (can be replenished by not moving for one whole turn)"
		}
	},
	trait : "Tabaxi"+
		"\n \u2022 Cat's Talent: I have proficiency in Perception and Stealth."+
		"\n \u2022 Cat's Claws: I can use my retractable claws to make unarmed strikes dealing 1d6 slashing damage. They also give me a climbing speed equal to my walking speed."+
		"\n \u2022 Feline Agility: When moving on my turn in combat, I can move double my speed. Once I do this, I can't do it again until I don't move at all on one of my turns."
};
RaceList["tortle-motm"] = { // just a plain improvement over the previous, no need to make it a separate "multiverse" choice
	regExpSearch : /tortle/i,
	name : "Tortle",
	sortname : "Tortle",
	source : [["MotM", 34]],
	plural : "Tortles",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose one from Animal Handling, Medicine, Nature, Perception, Stealth, or Survival",
	armorOptions : [{
		regExpSearch : /^(?=.*tortle)(?=.*shell).*$/i,
		name : "Tortle's Shell",
		source : [["MotM", 34]],
		ac : 17,
		dex : -10,
		selectNow : true
	}],
	weaponOptions : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*tortle)(?=.*\bclaws?\b).*$/i,
		name : "Tortle's Claws",
		source : [["MotM", 34]],
		damage : [1, 6, "slashing"],
		selectNow : true
	}],
	scoresGeneric : true,
	age : " reach adulthood by the age of 15 and live an average of 50 years [according to the Tortle Package]",
	height : ", when Medium sized, stand between 5 and 6 feet tall (4'10\" + 2d8\") [according to the Tortle Package]",
	weight : ", when Medium sized, weigh around 450 lb (400 + 2d8 \xD7 2d4 lb) [according to the Tortle Package]",
	heightMetric : ", when Medium sized, stand between 1,5 and 1,8 metres tall (150 + 5d8 cm) [according to the Tortle Package]",
	weightMetric : ", when Medium sized, weigh around 190 kg (180 + 5d8 \xD7 4d4 / 10 kg) [according to the Tortle Package]",
	action : [["action", "Shell Defense (start)"], ["bonus action", "Shell Defense (end)"]],
	trait : "Tortle"+
		"\n \u2022 Claws: My unarmed strikes with my claws deal 1d6 slashing damage."+
		"\n \u2022 Hold Breath: I can hold my breath for up to 1 hour at a time."+
		"\n \u2022 Natural Armor: I have a base AC of 17, but I can't add my Dex to it or wear armor."+
		"\n \u2022 Shell Defense: As an action, I can withdraw into my shell and gain +4 AC and adv. on Str and Con saves, but I count as prone, have speed 0, have disadv. on Dex saves, and can't take reactions. The only action I can take is a bonus action to emerge from the shell."
};
RaceList["multiverse triton"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*triton).*$/i,
	name : "Multiverse Triton",
	sortname : "Triton, Multiverse",
	source : [["MotM", 35]],
	plural : "Triton",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : "walk", enc : "walk" }
	},
	dmgres : ["Cold"],
	languageProfs : ["Common", "Emissary of the Sea", 1],
	vision : [["Darkvision", 60]],
	scoresGeneric : true,
	trait : "Triton"+
		"\n \u2022 Control Air and Water: I can cast the Fog Cloud spell. At 3rd level, Gust of Wind. At 5th level, Water Walk. I can cast each without using a spell slot once per long rest, and by using spell slots as normal. Int, Wis, or Cha is my spellcasting ability for these (one-time choice)."+
		"\n \u2022 Emissary of the Sea: I can communicate simple ideas to beasts, elementals, and monstrosities with a swimming speed. They can understand my words, though I have no special ability to understand them in return."+
		(typePF ? "\n" : "") + " \u2022 Amphibious: I can breathe air and water.",
	spellcastingAbility : [4, 5, 6],
	features : {
		"control air and water (level 1)" : {
			name : "Control Air and Water (level 1)",
			minlevel : 1,
			spellcastingBonus : {
				name : "Control Air and Water",
				spells : ["fog cloud"],
				selection : ["fog cloud"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Fog Cloud",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 1+"
			}]
		},
		"control air and water (level 3)" : {
			name : "Control Air and Water (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Control Air and Water",
				spells : ["gust of wind"],
				selection : ["gust of wind"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Gust of Wind",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}]
		},
		"control air and water (level 5)" : {
			name : "Control Air and Water (level 5)",
			minlevel : 5,
			spellcastingBonus : {
				name : "Control Air and Water",
				spells : ["water walk"],
				selection : ["water walk"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Water Walk",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 3+"
			}]
		}
	},
};
RaceList["multiverse yuan-ti"] = {
	regExpSearch : /^(?=.*(multiverse|motm\b))(?=.*yuan.ti).*$/i,
	name : "Multiverse Yuan-Ti",
	sortname : "Yuan-Ti, Multiverse",
	source : [["MotM", 36]],
	plural : "Yuan-Ti",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	vision : [["Darkvision", 60]],
	dmgres : ["Poison"],
	savetxt : {
		adv_vs : ["poisoned", "spells"],
	},
	scoresGeneric : true,
	trait : "Yuan-Ti"+
		"\n \u2022 Serpentine Spellcasting: I know the Poison Spray cantrip and I can cast Animal Friendship on snakes at will. Once I reach 3rd level, I can cast Suggestion once per long rest, and by using spell slots as normal. Intelligence, Wisdom, or Charisma is my spellcasting ability for these spells (one-time choice)."+
		"\n \u2022 Magic and Poison Resistance: I have advantage on saving throws against spells and on saving throws to avoid or end being poisoned. I also have resistance to poison damage.",
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Serpentine Spellcasting (level 1)",
		spells : ["poison spray", "animal friendship"],
		selection : ["poison spray", "animal friendship"],
		firstCol : 'atwill',
		times : 2
	},
	spellChanges : {
		"animal friendship" : {
			description : "One snake with Intelligence 3 or less save or charmed for the duration",
			changes : "I can cast Animal Friendship at-will, but only to target snakes."
		}
	},
	features : {
		"serpentine spellcasting (level 3)" : {
			name : "Serpentine Spellcasting (level 3)",
			minlevel : 3,
			spellcastingBonus : {
				name : "Serpentine Spellcasting (level 3)",
				spells : ["suggestion"],
				selection : ["suggestion"],
				firstCol : 'oncelr',
				allowUpCasting : true
			},
			extraLimitedFeatures : [{
				name : "Suggestion",
				usages : 1,
				recovery : "long rest",
				altResource : "SS 2+"
			}]
		}
	}
};

// Creatures

// pub_20220315_CotN.js
// This file adds all the magic items from Critical Role: Call of the Netherdeep to MPMB's Character Record Sheet

SourceList.CotN = {
	name : "Critical Role: Call of the Netherdeep [magic items]",
	abbreviation : "CotN",
	abbreviationSpellsheet : "MO",
	group : "Adventure Books",
	campaignSetting : "Critical Role",
	url : "https://dnd.wizards.com/products/call-netherdeep",
	date : "2022/03/15"
};

CreatureList["young horizonback tortoise"] = { // Contains contributions by Nod_Hero
	name : "Young Horizonback Tortoise",
	nameAlt : ["Tortoise, Young Horizonback"],
	source : [["CotN", 26]],
	size : 1,
	type : "Beast",
	alignment : "Unaligned",
	ac : 15,
	hp : 68,
	hd : [8, 12],
	speed : "30 ft",
	scores : [19, 11, 15, 2, 12, 5],
	senses : "",
	passivePerception : 11,
	languages : "understands Goblin but can't speak",
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [4, 6, "piercing"],
		range : "Melee (10 ft)",
		description : "Target must succeed on a DC 14 Strength saving throw or be knocked prone",
		modifiers : [1, ""]
	}],
	traits : [{
		name : "Amphibious",
		description : "The tortoise can breathe air and water.",
	}]
};

MagicItemsList["breathing bubble"] = {
	name : "Breathing Bubble",
	source : [["W", 266], ["CotN", 212]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "This translucent, bubble-like sphere has a slightly tacky outer surface. I gain its benefits only while wearing it over my head like a helmet. The bubble contains 1 hour of breathable air. The bubble regains all its expended air daily at dawn.",
	descriptionFull : "This translucent, bubble-like sphere has a slightly tacky outer surface, and you gain the item's benefits only while wearing it over your head like a helmet. The bubble contains 1 hour of breathable air. The bubble regains all its expended air daily at dawn.",
	usages : 1,
	recovery : "dawn"
};
MagicItemsList["earring of message"] = {
	name : "Earring of Message",
	source : [["CotN", 212]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "The blue crystal of this earring is wrapped with delicate copper wire. The earring has 5 charges. While wearing it, I can use an action to expend 1 charge and cast the message spell. The earring regains 1d4 + 1 expended charges daily at dawn.",
	descriptionFull : "The blue crystal of this earring is wrapped with delicate copper wire. The earring has 5 charges. While wearing it, you can use an action to expend 1 charge and cast the message spell. The earring regains 1d4 + 1 expended charges daily at dawn.",
	usages : 5,
	recovery : "dawn",
	additional : "regains 1d4+1",
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["message"],
		selection : ["message"],
		firstCol : '1'
	}
};
MagicItemsList["medal of muscle"] = {
	name : "Medal of Muscle",
	source : [["CotN", 214]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "Once as a an action, I can squeeze this medal tightly in the palm of my hand. Doing so gives me advantage on Strength checks and Strength saving throws for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical.",
	descriptionFull : "You can squeeze this medal tightly in the palm of your hand as an action. Doing so gives you advantage on Strength checks and Strength saving throws for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical."
};
MagicItemsList["medal of the conch"] = {
	name : "Medal of the Conch",
	source : [["CotN", 214]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "Once as an action, I can rub this medal to gain a swimming speed equal to my walking speed for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical.",
	descriptionFull : "When you use an action to rub this medal, you gain a swimming speed equal to your walking speed for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical."
};
MagicItemsList["medal of the horizonback"] = {
	name : "Medal of the Horizonback",
	source : [["CotN", 214]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "Once as a reaction when I would be hit by an attack, I can increase my AC by 5 until the start of my next turn, including against the triggering attack. I must be wearing the medal and able to see the creature that made the triggering attack. Once this property has been used, the medal becomes nonmagical.",
	descriptionFull : "When you would be hit by an attack, you can use your reaction to increase your AC by 5 until the start of your next turn, including against the triggering attack. You must be wearing the medal and able to see the creature that made the triggering attack to use this property. Once this property has been used, it can't be used again, and the medal becomes nonmagical."
};
MagicItemsList["medal of the maze"] = {
	name : "Medal of the Maze",
	source : [["CotN", 214]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "Once as an action, I can trace the maze inscribed on this medal to gain advantage on Wisdom checks and to know the quickest route to the end of any nonmagical path or maze for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical.",
	descriptionFull : "When you use an action to trace the maze inscribed on this medal, you gain advantage on Wisdom checks and know the quickest route to the end of any nonmagical path or maze for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical."
};
MagicItemsList["medal of the meat pie"] = {
	name : "Medal of the Meat Pie",
	source : [["CotN", 214]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "Once as an action, I can press this medal to my mouth to gain 2d4 + 2 temporary hit points. Once this property has been used, it can't be used again, and the medal becomes nonmagical. While magical, this medal is slightly warm to the touch (as if it's fresh from the oven) and smells faintly of baked pie crust.",
	descriptionFull : "You gain 2d4 + 2 temporary hit points when you use an action to press this medal to your mouth. Once this property has been used, it can't be used again, and the medal becomes nonmagical."+
	"\n   While magical, this medal is slightly warm to the touch (as if it's fresh from the oven) and smells faintly of baked pie crust."
};
MagicItemsList["medal of the wetlands"] = {
	name : "Medal of the Wetlands",
	source : [["CotN", 214]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "Once as an action, I can trace the edge of this medal, making it so that difficult terrain doesn't cost me extra movement for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical.",
	descriptionFull : "When you use an action to trace the edge of this medal, difficult terrain doesn't cost you extra movement for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical."
};
MagicItemsList["medal of wit"] = {
	name : "Medal of Wit",
	source : [["CotN", 214]],
	type : "wondrous item",
	rarity : "common",
	notLegalAL : true,
	description : "Once as an action, I can press this medal to my temple to give me advantage on Intelligence checks and Intelligence saving throws for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical.",
	descriptionFull : "You can press this medal to your temple as an action. Doing so gives you advantage on Intelligence checks and Intelligence saving throws for 1 hour. Once this property has been used, it can't be used again, and the medal becomes nonmagical."
};
MagicItemsList["ring of red fury"] = {
	name : "Ring of Red Fury",
	source : [["CotN", 214]],
	type : "ring",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	description : "This ring allows me to breathe water and gives me a swimming speed equal to my walking speed. As a bonus action once per long rest, I can use it to, for 1 minute, have adv. on Str checks and saves, add my Prof Bonus to damage rolls of my attacks, ignore difficult terrain, be immune to paralyzed and restrained.",
	descriptionLong : "While wearing this ring with a stripe of ruidium running through it, I am able to breathe water and I have a swimming speed equal to my walking speed. As a bonus action once per long rest, I can use it to, for 1 minute, have adv. on my Strength checks and saves, add my proficiency bonus to the damage rolls of my attacks, have difficult terrain not cost me extra movement, and be immune to being paralyzed and restrained. When I do this bonus action, I have to make a DC 20 Charisma save or gain 1 level of exhaustion and become corrupted. If the Apotheon is killed or redeemed, this ring turns into a Ring of Free Action.",
	descriptionFull : [
		"This ring has a stripe of ruidium running through it. While wearing the ring, you gain the following benefits:",
		"\u2022 You can breathe water.",
		"\u2022 You gain a swimming speed equal to your walking speed.",
		toUni("Ruidium Rage") + ". As a bonus action, you can use the ring to gain the following benefits, which last for 1 minute or until you are incapacitated:",
		"\u2022 You have advantage on Strength checks and Strength saving throws.",
		"\u2022 When you hit with an attack, you can add your proficiency bonus to the damage roll.",
		"\u2022 Difficult terrain doesn't cost you extra movement, and you are immune to the paralyzed and restrained conditions.",
		"You can't use this property of the ring again until you finish a long rest.",
		toUni("Ruidium Corruption") + ". When you use the Ruidium Rage property of the ring, you must make a DC 20 Charisma saving throw. On a failed save, you gain 1 level of exhaustion. If you are not already suffering from ruidium corruption, you become corrupted when you fail this save.",
		toUni("If Ruidium Is Destroyed") + ". If the Apotheon is killed or redeemed, all the ruidium in Exandria is destroyed instantly, and the ring of red fury becomes a Ring of Free Action."
	].join("\n   "),
	speed : { swim : { spd : "walk", enc : "walk" } },
	action : [["bonus action", ""]]
};
MagicItemsList["ruidium armor"] = {
	name : "Ruidium Armor",
	nameTest : "Ruidium",
	source : [["CotN", 215]],
	type : "armor (medium or heavy)",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	description : "This magic armor containing ruidium gives me resistance to psychic damage, a swimming speed equal to my walking speed, and allows me to breathe water. If I roll a 1 on a save while wearing it, I must make a DC 15 Charisma save or gain 1 level of exhaustion and become corrupted by ruidium.",
	descriptionFull : [
		"This magic armor has a dull, rusty color or has veins of ruidium running through it. While you wear this armor, you gain the following benefits:",
		"\u2022 You have resistance to psychic damage.",
		"\u2022 You can breathe water.",
		"\u2022 You gain a swimming speed equal to your walking speed.",
		toUni("Ruidium Corruption") + ". When you roll a 1 on a saving throw while wearing this armor, you must make a DC 15 Charisma saving throw. On a failed save, you gain 1 level of exhaustion. If you are not already suffering from ruidium corruption, you become corrupted when you fail this save.",
		toUni("If Ruidium Is Destroyed") + ". If the Apotheon is killed or redeemed, all the ruidium in Exandria is destroyed instantly, and ruidium armor becomes +1 armor."
	].join("\n   "),
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		excludeCheck : function (inObjKey, inObj) {
			return !(/medium|heavy/i).test(inObj.type) || (/hide/i).test(inObj.name);
		},
		descriptionChange : ["prefix", "armor"]
	},
	dmgres : ["Psychic"],
	speed : { swim : { spd : "walk", enc : "walk" } }
};
MagicItemsList["ruidium shield"] = {
	name : "Ruidium Shield",
	source : [["CotN", 215]],
	type : "shield",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	description : "This magic shield gives me resistance to psychic damage, a swimming speed equal to my walking speed, and allows me to breathe water. As a reaction when I take psychic damage, I can have another creature I can see in 30 ft take the damage instead, but I must make a DC 20 Cha save or gain 1 level of exhaustion.",
	descriptionFull : [
		"Tendrils of ruidium extend across the metal surface of this shield. While this shield is on your person, you gain the following benefits:",
		"\u2022 You have resistance to psychic damage.",
		"\u2022 You can breathe water.",
		"\u2022 You gain a swimming speed equal to your walking speed.",
		toUni("Psychic Reflection") + ". When you take psychic damage while holding the shield, you can use your reaction to choose another creature you can see within 30 feet of you. That creature takes the psychic damage you would have taken.",
		toUni("Ruidium Corruption") + ". When you use the shield's Psychic Reflection property, you must make a DC 20 Charisma saving throw. On a failed save, you gain 1 level of exhaustion. If you are not already suffering from ruidium corruption, you become corrupted when you fail this save.",
		toUni("If Ruidium Is Destroyed") + ". If the Apotheon is killed or redeemed, all the ruidium in Exandria is destroyed instantly, and a ruidium shield becomes a +2 shield."
	].join("\n   "),
	weight : 6,
	shieldAdd : "Ruidium Shield",
	dmgres : ["Psychic"],
	speed : { swim : { spd : "walk", enc : "walk" } },
	action : [["reaction", " (if taking psychic damage)"]]
}
MagicItemsList["ruidium weapon"] = {
	name : "Ruidium Weapon",
	source : [["CotN", 216]],
	type : "weapon (any)",
	rarity : "very rare",
	notLegalAL : true,
	attunement : true,
	description : "This magic weapon deals an extra 2d6 psychic damage to creatures. It also allows me to breath water and gives me a swimming speed equal to my walking speed. If I roll a 1 on an attack roll with it, I must make a DC 20 Cha save or gain 1 level of exhaustion and become corrupted by ruidium.",
	descriptionFull : [
		"This magic weapon has a dull, rusty color or has veins of ruidium running through it. While this weapon is on your person, you gain the following benefits:",
		"\u2022 You can breathe water.",
		"\u2022 You gain a swimming speed equal to your walking speed.",
		toUni("Ruidium Strike") + ". A creature you hit with this weapon takes an extra 2d6 psychic damage.",
		toUni("Ruidium Corruption") + ". When you roll a 1 on an attack roll made with this weapon, you must make a DC 20 Charisma saving throw. On a failed save, you gain 1 level of exhaustion. If you are not already suffering from ruidium corruption, you become corrupted when you fail this save.",
		toUni("If Ruidium Is Destroyed") + ". If the Apotheon is killed or redeemed, all the ruidium in Exandria is destroyed instantly, and a ruidium weapon becomes a +2 weapon."
	].join("\n   "),
	allowDuplicates : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "brackets",
		itemName1stPage : ["suffix", "Ruidium"],
		descriptionChange : ["replace", "weapon"]
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if ( /ruidium/i.test(v.WeaponTextName) ) {
					fields.Description += (fields.Description ? '; ' : '') + '+2d6 psychic damage vs. creatures';
				}
			},
			'If I include the word "Ruidium" in the name of a weapon, it will be treated as the magic item Ruidium Weapon. Whenever it hits a creature, it deals an extra 2d6 psychic damage.'
		]
	},
	speed : { swim : { spd : "walk", enc : "walk" } }
};
MagicItemsList["teleportation tablet"] = {
	name : "Teleportation Tablet",
	source : [["CotN", 216]],
	type : "wondrous item",
	rarity : "rare",
	notLegalAL : true,
	description : "Once as an action, I can break this clay tablet in half to create a 5-ft radius Teleportation Circle to its predetermined destination within 30 ft, lasting until the end of my next turn. I can learn its destination by studying it for 10 minutes and making a DC 21 Arcana check. Once broken, the tablet turns to dust.",
	descriptionFull : "This clay tablet is eight inches long, four inches wide, and half an inch thick. Inscribed on it is the sigil sequence for a permanent teleportation circle. A creature that studies the sequence for 10 minutes can make a DC 21 Intelligence (Arcana) check, learning the circle's destination on a success."+
	"\n   You can use an action to break the tablet in half, turning it to dust. If the tablet is broken while it is on the same plane of existence as the teleportation circle whose sigil sequence was engraved on it, a 10-foot-diameter teleportation circle of glowing blue light appears on the ground in an unoccupied space you choose within 30 feet of you. This teleportation circle has the characteristics of one created using the teleportation circle spell, except that it connects to the teleportation circle whose sigil sequence appears on the tablet."+
	"\n   The teleportation circle created by the tablet disappears at the end of your next turn."
};

// Vestige of Divergence
var EGtW_Vestiges_Replace = function (sDescr) {
	return desc(sDescr).replace(/\bf(oo|ee)t\b/ig, "ft")
		.replace(/you are/ig, "I am").replace(/\byou\b/ig, "I")
		.replace(/(by|giving|grants|of|to|for) I\b/ig, "$1 me")
		.replace(/your/g, "my").replace(/Your/g, "My")
		.replace(/   >>(.*?)<<\. /g, function(a, match) { return "\n" + match.toUpperCase() + "\n   "; });
}
var EGtW_JewelOfThreePrayersFullDescription = [
	"The Jewel of Three Prayers is a Vestige of Divergence. In ancient times, Alyxian the Apotheon bore this amulet as a symbol of his covenant with three Prime Deities: Sehanine the Moon Weaver, Avandra the Change Bringer, and Corellon the Arch Heart.[[ When the jewel is found, only Sehanine's power thrums within its dormant heart. The power of the other two deities waits to be reawakened by a hero \u2014 or heroes \u2014 who can follow in Alyxian's footsteps.]]",
	">>Dormant<<. In this state, the Jewel of Three Prayers is a glittering golden disk attached to a fine golden chain. The chain magically resizes to function as a necklace for the creature that wears it.",
	"In its Dormant State, the jewel has the following properties:",
	"\u2022 You gain a +1 bonus to AC while wearing the jewel.",
	"\u2022 While wearing or holding the jewel, you can use an action to cause it to shed bright light in a 15-foot radius and dim light for an additional 15 feet. The light lasts until you extinguish it (no action required).",
	"\u2022 The jewel has 3 charges and regains all its expended charges daily at dawn. While holding the jewel, you can expend 1 charge from it to cast the invisibility spell.",
	">>Awakened<<. In this state, the jewel has received the blessing of Avandra the Change Bringer. Three delicate spires unfurl from the jewel's center, like the buds of flowers opening in the spring. Three lapis lazuli stones rest like dewdrops on these spires.",
	"The following benefits of the jewel improve:",
	"\u2022 The bonus that the jewel confers to your AC increases to +2.",
	"\u2022 Its number of charges increases to 5.",
	"The jewel gains the following additional properties, which you can use while wearing or holding it:",
	"\u2022 You can expend 1 of the jewel's charges (no action required) to end one of the following conditions on yourself: grappled, paralyzed, or restrained.",
	"\u2022 When another creature you can see within 60 feet of you fails a saving throw, you can expend 1 of the jewel's charges as a reaction to enable that creature to reroll the saving throw, potentially turning a failure into a success. The creature must use the new roll.",
	">>Exalted<<. In this state, the jewel has received the blessing of Corellon the Arch Heart. A gleaming emerald surrounded by a halo of gold appears on the jewel.",
	"The following benefits of the jewel improve:",
	"\u2022 The bonus that the jewel confers to your AC increases to +3.",
	"\u2022 Its number of charges increases to 7.",
	"The jewel gains the following additional properties, which you can use while wearing or holding it:",
	"\u2022 You gain the ability to breathe water, and you gain a swimming speed equal to your walking speed.",
	"\u2022 Each of your allies within 30 feet of you gains the ability to breathe water and gains a swimming speed equal to its walking speed.",
	"\u2022 As a bonus action, you can expend 1 of the jewel's charges to target yourself or one willing creature you can see within 15 feet of yourself. The target teleports to an unoccupied space of your choice within 15 feet of yourself, along with any equipment the target is wearing or carrying. The target appears in a flash of golden radiance, and each creature of your choice within 5 feet of the target's new location must make a DC 18 Constitution saving throw. On a failed save, the creature takes 4d10 radiant damage and is blinded until the start of your next turn. On a successful save, the creature takes half as much damage and isn't blinded."
];
MagicItemsList["jewel of three prayers"] = {
	name : "Jewel of Three Prayers",
	source : [["CotN", 213]],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	attunement : true,
	description : "The golden chain of this intricate jewel magically resizes to function as a necklace for the creature that wears it. In ancient times, Alyxian the Apotheon bore this amulet as a symbol of his covenant with three Prime Deities: Sehanine the Moon Weaver, Avandra the Change Bringer, and Corellon the Arch Heart.",
	descriptionFull : EGtW_JewelOfThreePrayersFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }).replace(/\[\[|\]\]/g, ''),
	toNotesPage : [{
		name : "Features",
		note : EGtW_Vestiges_Replace(EGtW_JewelOfThreePrayersFullDescription).replace(/\[\[.*?\]\]/, '')
	}],
	choices : ["Dormant", "Awakened", "Exalted"],
	choicesNotInMenu : true,
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["invisibility"],
		selection : ["invisibility"],
		firstCol : "1"
	},
	action : [["action", " (shed light)"]],
	"dormant" : {
		name : "Jewel of Three Prayers [dormant]",
		description : "This piece of jewelry grants me +1 AC and has 3 charges, regaining all at dawn. As an action, I can use it to shed bright light in a 15-ft radius and dim for another 15 ft (extinguishing requires no action). I can expend 1 charge to cast Invisibility.",
		usages : 3,
		recovery : "dawn",
		extraAC : [{name : "Jewel of Three Prayers", mod : 1, magic : true, text : "I gain a +1 bonus to AC while attuned."}]
	},
	"awakened" : {
		name : "Jewel of Three Prayers [awakened]",
		description : "This grants me +2 AC. It has 5 charges, regaining all at dawn. As an action, I can have it shed 15-ft radius bright light and dim for another 15 ft. I can use 1 charge to cast Invisibility or stop being grappled, paralyzed, or restrained. As a reaction when I see a creature in 60 ft fail a save, I can use 1 charge to have it reroll.",
		usages : 5,
		recovery : "dawn",
		extraAC : [{name : "Jewel of Three Prayers", mod : 2, magic : true, text : "I gain a +2 bonus to AC while attuned."}],
		action : [["reaction", "Jewel of Three Prayers (reroll save)"]]
	},
	"exalted" : {
		name : "Jewel of Three Prayers [exalted]",
		description : "This grants me +3 AC. It has 7 charges, regaining all at dawn. As an action, I can have it shed 15-ft radius bright light and dim for another 15 ft. I can use 1 charge to cast Invisibility or stop being grappled, paralyzed, or restrained. As a reaction when I see failed save in 60 ft, I can use 1 charge for a reroll. See notes.",
		usages : 7,
		recovery : "dawn",
		extraAC : [{name : "Jewel of Three Prayers", mod : 3, magic : true, text : "I gain a +3 bonus to AC while attuned."}],
		speed : { swim : { spd : "walk", enc : "walk" } },
		action : [["reaction", "Jewel of Three Prayers (reroll save)"], ["bonus action", "Jewel of Three Prayers (teleport)"]]
	}
}

// pub_20220816_Spelljammer.js
/*
	This file adds the Character Options content from the "Spelljammer: Adventures in Space" set
	(the "Astral Adventurer's Guide" book and the "Boo's Astral Menagerie" book)
	to MPMB's Character Record Sheet

	Includes many contributions by Nod_Hero

	- ERRATA -
	Note that this document includes the second "Spelljammer: Adventures in Space" Errata
	https://media.dndbeyond.com/compendium-images/errata/SAiS/SJA-Errata.pdf
*/


// Unless otherwise noted, page numbers refer to the "Astral Adventurer's Guide" book
SourceList["S:AiS"] = {
	name : "Spelljammer: Adventures in Space",
	abbreviation : "S:AiS",
	abbreviationSpellsheet : "SJ",
	group : "Campaign Sourcebooks",
	campaignSetting : "Spelljammer",
	url : "https://dnd.wizards.com/products/spelljammer",
	date : "2022/08/16"
};

// Backgrounds from Astral Adventurer's Guide
BackgroundList["astral drifter"] = {
	regExpSearch : /^(?=.*astral)(?=.*drifter).*$/i,
	name : "Astral Drifter",
	source : [["S:AiS", 7]],
	skills : ["Insight", "Religion"],
	languageProfs : [["Any, Celestial or Gith recommended", 2]],
	gold : 10,
	equipleft : [
		["Diary", "", 5],
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Divine Contact",
	extra : ["Select a Divine Contact",
		"Corellon (art/magic; CG)",
		"Tymora (good fortune; CG)",
		"Fharlanghn (horizons/travel; NG)",
		"Istus (fate/destiny; N)",
		"Nuada (war/warriors; N)",
		"Zivilyn (wisdom; N)",
		"Arawn (life/death; NE)",
		"Hecate (magic/moons; CE)",
		"Celestian (stars/wanderers; N)",
		"Ptah (knowledge/secrets; LN)"
	]
};
BackgroundFeatureList["divine contact"] = {
	description : "I am 20d6 years older than I look, thanks to time spent in the Astral Sea without aging. While in the Astral Sea, I crossed paths with a wandering deity. The encounter was brief and nonviolent, yet it made a lasting impression on me. This deity saw fit to share one secret or obscure bit of cosmic lore with me. I gain the Magic Initiate [Cleric] feat.",
	source : [["S:AiS", 7]],
	eval : function() { AddFeat("Magic Initiate [Cleric]"); },
	removeeval : function() { RemoveFeat("Magic Initiate [Cleric]"); }
};

BackgroundList["wildspacer"] = {
	regExpSearch : /wildspacer/i,
	name : "Wildspacer",
	source : [["S:AiS", 8]],
	skills : ["Athletics", "Survival"],
	toolProfs : ["Navigator's tools", "Vehicles (space)"],
	gold : 10,
	equipleft : [
		["Hempen rope, feet of", 50, 0.2],
		["Grappling hook", "", 4]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belaying pin (club)", "", 2],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Wildspace Adaptation",
	extra : ["Select a Close Encounter",
		"Beholder",
		"Cosmic horror",
		"Feyr",
		"Lunar dragon",
		"Mind flayer",
		"Neh-thalggu",
		"Neogi",
		"Space clown",
		"Vampirate",
		"Void scavver",
	]
};
BackgroundFeatureList["wildspace adaptation"] = {
	description : "I was raised in the void of Wildspace, home to asteroid miners, moon farmers, and other hardy folk. Life in Wildspace has toughened me to face the terrors and other challenges of the airless night and I've learned how to adapt to zero gravity. Being weightless doesn't give me disadvantage on any of my melee attack rolls and I gain the Tough feat.",
	source : [["S:AiS", 8]],
	eval : function() { AddFeat("Tough"); },
	removeeval : function() { RemoveFeat("Tough"); }
};

// Races from Astral Adventurer's Guide
RaceList["astral elf"] = {
	regExpSearch : /^(?!.*half)(?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(astral|silver void)\b).*$/i,
	name : "Astral elf",
	sortname : "Elf, Astral",
	source : [["S:AiS", 10]],
	plural : "Astral elves",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	scoresGeneric : true,
	age : " typically claim adulthood around age 100 and can live to be 750 years old. Because nothing ages in the Astral Plane, astral elves from that plane can be thousands of years old.",
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	skillstxt : "Perception and choose any one skill which lasts until the end of my next Astral Trance",
	toolProfs : [["Astral Trance: tool or weapon", 1]],
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : {
		name : "Astral Fire",
		spells : ["dancing lights", "light", "sacred flame"],
		firstCol : "atwill"
	},
	features : {
		"starlight step" : {
			name : "Starlight Step",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			action : [["bonus action", ""]]
		}
	},
	trait : "Astral Elf (my creature type is humanoid, elf)"+
	"\n \u2022 Starlight Step: A number of times per long rest equal to my proficiency bonus, as a bonus action, I can magically teleport up to 30 ft to an unoccupied space I can see."+
	"\n \u2022 Astral Trance: I don't need to sleep, and magic can't put me to sleep. I can finish a long rest in 4 hours if I spend those hours in a trancelike meditation, during which I remain conscious. Whenever I finish this trance, I gain proficiency with one skill, and one weapon or tool of my choice. They last until I finish my next long rest."
};
RaceList["autognome"] = {
	regExpSearch : /autognome/i,
	name : "Autognome",
	source : [["S:AiS", 11]],
	plural : "Autognomes",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	scoresGeneric : true,
	age : " can live for centuries, typically up to 500 years",
	armorOptions : [{
		regExpSearch : /^(?=.*armou?red)(?=.*casing).*$/i,
		name : "Armored Casing",
		source : [["S:AiS", 2]],
		ac : 13,
		selectNow : true
	}],
	extraLimitedFeatures : [{
		name : "Built for Success",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus');",
		recovery : "long rest"
	}],
	dmgres : ["Poison"],
	savetxt : {
		adv_vs : ["paralyzed", "poison"],
		immune : ["disease"]
	},
	toolProfs : [["Tool of my choice", 2]],
	trait : typePF ?
		"Autognome (my creature type is Construct)"+
		"\n \u2022 Armored Casing: My base AC is 13 + my Dexterity modifier."+
		"\n \u2022 Built for Success: For my Prof B. per long rest, I can add +1d4 to an attack, check, or save, after I see the roll, but before the effect."+
		"\n \u2022 Mechanical Nature: I don't need to eat, drink or breathe."+
		"\n \u2022 Sentry's Rest: I only need 6 hours to finish a long rest if I stay in an inactive and motionless state during which I'm conscious."+
		"\n \u2022 Healing Machine: Cure Wounds, Healing Word, and Spare the Dying work on me. If Mending is cast on me, I can expend one HD like during a short rest to regain hit points."
		:
		"Autognome (my creature type is Construct; I don't need to eat, drink or breathe)"+
		"\n \u2022 Armored Casing: While I'm not wearing armor, my AC is 13 + my Dexterity modifier."+
		"\n \u2022 Built for Success: For my Prof B. per long rest, I can add +1d4 to an attack, check, or save. I can do this after seeing the d20 roll, but before knowing the roll's effects."+
		"\n \u2022 Sentry's Rest: I only need 6 hours to finish a long rest if I stay inactive and motionless."+
		"\n \u2022 Healing Machine: Cure Wounds, Healing Word, and Spare the Dying work on me. If Mending is cast on me, I can expend one HD like during a short rest to regain hit points."
};
RaceList["giff"] = {
	regExpSearch : /giff|hippofolk/i,
	name : "Giff",
	source : [["S:AiS", 12]],
	plural : "Giff",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : "walk", enc : "walk" }
	},
	scoresGeneric : true,
	features : {
		"astral spark" : {
			name : "Astral Spark",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) { return "+" + n + " force damage"; })
		}
	},
	weaponProfs : [false, false, ["Firearms"]],
	carryingCapacity : 2,
	savetxt : { text : ["Adv. on Str saves and checks"] },
	advantages : [["Strength", true]],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (/firearm/i.test(v.theWea.type) || /firearm/i.test(v.theWea.list)) {
					fields.Description = fields.Description.replace(/([;,]? ?loading|loading[;,]? ?)/i, '');
					fields.Description += (fields.Description ? '; ' : '') + "No disadv. at long range";
				};
			},
			"I ignore the loading quality of firearms and attacking at long range with a firearm doesn't impose disadvantage on my attack roll."
		]
	},
	trait : "Giff"+
	"\n \u2022 Astral Spark: My proficiency bonus times per long rest, when I hit a target with a simple or martial weapon, I can once per turn deal extra force damage equal to my prof" + (typePF ? "iciency" : ".") + " bonus."+
	"\n \u2022 Firearms Mastery: I am proficient with firearms, ignore their loading property, and they don't impose disadvantage at long range."+
	"\n \u2022 Hippo Build: I have advantage on Strength saves and checks. In addition, I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift."
};
RaceList["hadozee"] = {
	regExpSearch : /hadozee/i,
	name : "Hadozee",
	source : [["S:AiS", 13]],
	plural : "Hadozees",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 },
		climb : { spd : "walk", enc : "walk" }
	},
	scoresGeneric : true,
	action : [
		["bonus action", "Dexterous Feet (Use an Object)"],
		["reaction", "Glide (if 10 ft above ground)"]
	],
	features : {
		"hadozee dodge" : {
			name : "Hadozee Dodge",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			additional : ProficiencyBonusList.map(function(n) { return "1d6+" + n + " damage"; }),
			action : [["reaction", ""]]
		}
	},
	trait : "Hadozee"+
	"\n \u2022 Dexterous Feet: As a bonus action, I can manipulate an object, open or close a door or container, or pick up or set down a Tiny object."+
	"\n \u2022 Glide: As a reaction when I fall at least 10 ft above the ground, I can extend my skin membranes to glide my walking speed horizontally, and take 0 damage from the fall."+
	"\n \u2022 Hadozee Dodge: A number of times equal to my proficiency bonus per long rest, as a reaction when I take damage, I can reduce the damage by 1d6 + my proficiency bonus."
};
RaceList["plasmoid"] = {
	regExpSearch : /plasmoid/i,
	name : "Plasmoid",
	source : [["S:AiS", 14]],
	plural : "Plasmoids",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	scoresGeneric : true,
	vision : [["Darkvision", 60]],
	dmgres : ["Acid", "Poison"],
	savetxt : {
		adv_vs : ["poison"],
		text : ["Adv. on grapple checks"]
	},
	action : [
		["action", "Reshape Body"],
		["bonus action", "Extrude/Reabsorb Pseudopod"]
	],
	trait : "Plasmoid (my creature type is Ooze)"+
	(typePF ? "\n" : "") + " \u2022 Hold Breath: I can hold my breath for 1 hour."+
	"\n \u2022 Amorphous: I can squeeze through a 1-inch wide space without my equipment or clothes. " + (typePF ? "I have advantage on grapple checks." : "I also have advantage on ability checks I make to initiate or escape a grapple.")+
	"\n \u2022 Shape Self: As an action, I can reshape my body to have a head and limbs, or back to a limbless blob. As a bonus action, I can extrude/reabsorb a pseudopod up to 6 inch wide and 10 ft long. As part of the bonus action, it can manipulate objects, open/close doors, or pick up/set down a Tiny object. It can carry up to 10 lb, but not attack or use magic items."
};
RaceList["thri-kreen"] = {
	regExpSearch : /thri.?kreen/i,
	name : "Thri-kreen",
	source : [["S:AiS", 15]],
	plural : "Thri-kreen",
	size : [3, 4],
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	scoresGeneric : true,
	// age, height and weight taken from Shining South (2004) p17 (using the male option)
	age : " reach maturity around 7 years old and typically live around 30 years",
	height : " stand between 5 and 7 feet tall (5'2\" + 2d10\")",
	weight : " weigh between 140 and 375 pounds (135 + 2d10 \xD7 2d6 lb)",
	heightMetric : " stand from 1,6 to over 2 metres tall (160 + 5d10 cm)",
	weightMetric : " weigh between 60 and 180 kg (60 + 5d10 \xD7 4d6 / 10 kg)",
	languageProfs : ["Common", "Thri-kreen Telepathy", 1],
	vision : [["Darkvision", 60]],
	armorOptions : [{
		regExpSearch : /^(?=.*carapace)(?=.*chameleon).*$/i,
		name : "Chameleon Carapace",
		source : [["S:AiS", 4]],
		ac : 13,
		selectNow : true
	}],
	action : [["action", "Chameleon Carapace"]],
	trait : "Thri-kreen (my creature type is Monstrosity)"+
	"\n \u2022 Chameleon Carapace: My base AC is 13 + Dex mod. As an action, " + (typePF ? "I can gain adv. on Stealth checks to hide in my current surroundings." : "I can have it match my current surroundings, granting me adv. on Stealth checks to hide in those surroundings.")+
	"\n \u2022 Secondary Arms: " + (typePF ? "I have two slightly smaller arms below my primary pair of arms. I can use these secondary arms" : "Able") + " to manipulate objects, hold Tiny objects, or wield light weapons."+
	"\n \u2022 Sleepless: I don't " + (typePF ? "" : "require ") + "sleep. I rest by refraining from strenuous activity."+
	"\n \u2022 " + (typePF ? "Thri-kreen " : "") + "Telepathy: I can't speak, but can communicate telepathically to any willing creatures within 120 ft that understand at least one language. Any can break this (no action)."
};

// Spells from Astral Adventurer's Guide
SpellsList["air bubble"] = {
	name : "Air Bubble",
	classes : ["artificer", "druid", "ranger", "sorcerer", "wizard"],
	source : [["S:AiS", 22]],
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "24 h",
	description : "Create spectral globe of fresh air around a head of 1+2/SL willing creatures, lasts for the duration",
	descriptionFull : "You create a spectral globe around the head of a willing creature you can see within range. The globe is filled with fresh air that lasts until the spell ends. If the creature has more than one head, the globe of air appears around only one of its heads (which is all the creature needs to avoid suffocation, assuming that all its heads share the same respiratory system)." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, you can create two additional globes of fresh air for each slot level above 2nd."
};
SpellsList["create spelljamming helm"] = {
	name : "Create Spelljamming Helm", 
	nameShort : typePF ? "Create spelljamming helm" : "Create spelljammin' helm", // Lowercase or won't fit, shortened for Colourful version
	classes : ["artificer", "wizard"],
	source : [["S:AiS", 22]],
	level : 5,
	school : "Trans",
	time : "1 a",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "A crystal rod worth at least 5,000 gp, which the spell consumes",
	duration : "Instantaneous",
	description : "One Large or smaller unoccupied chair I touch transforms into a spelljamming helm (5000gp cons.)",
	descriptionFull : "Holding the rod used in the casting of the spell, you touch a Large or smaller chair that is unoccupied. The rod disappears, and the chair is transformed into a spelljamming helm."
};

// Magic Items from Astral Adventurer's Guide
MagicItemsList["fish suit"] = {
	name : "Fish Suit",
	source : [["S:AiS", 22]],
	type : "wondrous item",
	rarity : "very rare",
	savetxt : { immune : ["surrounding gas"] },
	speed : { swim : { spd : "walk", enc : "walk" } }, // flying speed is more situational, so not added to the listing
	description : "This bulky suit takes 1 minute to don or doff. While worn, I can breathe in an airless environment and am immune to any gas that surrounds me. The suit grants me a swimming speed equal to my walking speed while underwater, or a flying speed equal to my walking speed in an environment with no gravity.",
	descriptionFull : "This bulky suit, which fully encases your head and body, takes 1 minute to don or doff. While worn, it enables you to breathe in an airless environment and renders you immune to the harmful effects of any gas that surrounds you. The suit also grants you a swimming speed equal to your walking speed while underwater, or a flying speed equal to your walking speed in an environment with no gravity."
};
var SJAAG_SpelljammingHelm = [
	"The function of this ornate chair is to propel and maneuver a ship on which it has been installed through space and air. It can also propel and maneuver a ship on water or underwater, provided the ship is built for such travel. The ship in question must weigh 1 ton or more.",
	"The sensation of being attuned to a spelljamming helm is akin to the pins-and-needles effect one experiences after one's arm or leg falls asleep, but not as painful.",
	"While attuned to a spelljamming helm and sitting in it, you gain the following abilities for as long as you maintain concentration (as if concentrating on a spell):",
	"\u2022 You can use the spelljamming helm to move the ship through space, air, or water up to the ship's speed. If the ship is in space and no other objects weighing 1 ton or more are within 1 mile of it, you can use the spelljamming helm to move the vessel fast enough to travel 100 million miles in 24 hours.",
	"\u2022 You can steer the vessel, albeit in a somewhat clumsy fashion, in much the way that a rudder or oars can be used to maneuver a seafaring ship.",
	"\u2022 At any time, you can see and hear what's happening on and around the vessel as though you were standing in a location of your choice aboard it.",
	">>Transfer Attunement<<. You can use an action to touch a willing spellcaster. That creature attunes to the spelljamming helm immediately, and your attunement to it ends."
];
MagicItemsList["spelljamming helm"] = {
	name : "Spelljamming Helm",
	source : [["S:AiS", 23]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "While attuned to  this ornate chair and sitting in it, I can propel and maneuver the ship on which it has been installed through space, air, or water up to the ship's speed. I need to maintain concentration as if concentrating on a spell to do so. The ship can move faster in space if nothing is nearby. See Notes page.",
	descriptionFull : SJAAG_SpelljammingHelm.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	action : [["action", " (Transfer Attunement)"]],
	toNotesPage : [{
		name : "Features",
		note : desc(SJAAG_SpelljammingHelm).replace(/your/ig, "my").replace(/\byou\b/ig, "I").replace(/   >>(.*?)<<\. /g, function(a, match) { return "\n" + match.toUpperCase() + "\n   "; })
	}]
};
MagicItemsList["wildspace orrery"] = {
	name : "Wildspace Orrery",
	source : [["S:AiS", 23]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "Inside a Wildspace system, this portable arcane device automatically tracks the positions and movements of all suns, planets, moons, and comets within that system, projecting a display of all these bodies in the space above its current location, marking itself as a white, pulsating pinprick of light.",
	descriptionFull : "Inside a Wildspace system, this portable arcane device automatically tracks the positions and movements of all suns, planets, moons, and comets within that system, projecting a display of all these bodies in the space above its current location. In that display, a white, pulsating pinprick of light marks the orrery's location."
};

// Beasts from Boo's Astral Menagerie
CreatureList["space eel"] = {
	name : "Space Eel",
	nameAlt : ["Eel, Space"],
	source : [["S:AiS", 55]], // page number in Boo's Astral Menagerie
	size : 4,
	type : "Beast",
	alignment : "Unaligned",
	ac : 14,
	hp : 7,
	hd : [2, 6],
	speed : "10 ft, fly 30 ft",
	scores : [12, 18, 11, 1, 10, 1],
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 6, "piercing"],
		range : "Melee (5 ft)",
		description : "Attaches on hit; While attached, auto-damage at turn start, but can't make bite attacks",
		tooltip : "On a hit, the eel attaches to the target. While attached, the eel can't make bite attacks. Instead, the target takes 4 (1d6 + 1) piercing damage at the start of each of the eel's turns. The eel can detach itself as a bonus action. A creature, including the target, can use its action to detach the eel."
	}, {
		name : "Tail Spine",
		ability : 1,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)",
		description : "Target DC 10 Con save or poisoned and paralyzed for 1 min (can save as each turn ends)",
		tooltip : "The target must succeed on a DC 10 Constitution saving throw or be poisoned for 1 minute. Until this poison ends, the target is paralyzed. The target can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success."
	}],
	traits : [{
		name : "Unusual Nature",
		description : "The eel doesn't require air."
	}],
	actions : [{
		name : "Multiattack",
		description : "If it isn't attached to a creature, the eel makes one bite attack and one tail spine attack."
	}, {
		name : "Attach",
		description : "If the eel hits with its bite attack, it attaches to the target. While attached, the eel can't make bite attacks. Instead, the target takes 4 (1d6 + 1) piercing damage at the start of each of the eel's turns. The eel can detach itself as a bonus action. A creature, including the target, can use its action to detach the eel."
	}, {
		name : "Tail Spine",
		description : "If the eel hits with its tail spine, the target must succeed on a DC 10 Constitution saving throw or be poisoned for 1 minute. Until this poison ends, the target is paralyzed. The target can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success."
	}],
	wildshapeString : [
		"\u25C6 Senses: Darkvision 60 ft",
		"Unusual Nature: The eel doesn't require air.",
		"Multiattack: If it isn't attached to a creature, the eel makes one bite attack and one tail spine attack.",
		"Bite: Attaches to the target hit by its bite attack, dealing bite damage at the start of each turn. The eel can detach itself as a bonus action. A creature, including the target, can use its action to detach the eel."
	].join("\n\u25C6 ")
};
CreatureList["space guppy"] = {
	name : "Space Guppy",
	nameAlt : ["Guppy, Space"],
	source : [["S:AiS", 55]], // page number in Boo's Astral Menagerie
	size : 4,
	type : "Beast",
	alignment : "Unaligned",
	ac : 13,
	hp : 3,
	hd : [1, 6],
	speed : "0 ft, fly 30 ft",
	scores : [3, 16, 10, 1, 10, 1],
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Tail Slap",
		ability : 2,
		damage : [1, "", "bludgeoning"],
		range : "Melee (5 ft)"
	}],
	traits : [{
		name : "Air Envelope",
		description : "If it has at least 1 hit point, the guppy can generate an air envelope around itself when in a vacuum. This air envelope can sustain the guppy and one other Tiny creature in its space indefinitely."
	}, {
		name : "Flyby",
		description : "The guppy doesn't provoke opportunity attacks when it flies out of an enemy's reach."
	}]
};
CreatureList["giant space hamster"] = {
	name : "Giant Space Hamster",
	nameAlt : ["Hamster, Giant Space"],
	source : [["S:AiS", 56]], // page number in Boo's Astral Menagerie
	size : 2,
	type : "Beast",
	alignment : "Unaligned",
	ac : 11,
	hp : 22,
	hd : [4, 10],
	speed : "30 ft, burrow 10 ft",
	scores : [14, 12, 10, 2, 12, 4],
	senses : "",
	passivePerception : 11,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [2, 4, "piercing"],
		range : "Melee (5 ft)"
	}]
};
CreatureList["space mollymawk"] = {
	name : "Space Mollymawk",
	nameAlt : ["Mollymawk, Space"],
	source : [["S:AiS", 57]], // page number in Boo's Astral Menagerie
	size : 4,
	type : "Beast",
	alignment : "Unaligned",
	ac : 12,
	hp : 3,
	hd : [1, 6],
	speed : "10 ft, fly 50 ft",
	scores : [6, 14, 11, 3, 12, 3],
	skills : {
		"perception" : 5
	},
	senses : "",
	passivePerception : 15,
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)"
	}],
	traits : [{
		name : "Flyby",
		description : "The mollymawk doesn't provoke opportunity attacks when it flies out of an enemy's reach."
	}, {
		name : "Hold Breath",
		description : "The mollymawk can hold its breath for 15 minutes."
	}]
};
CreatureList["space swine"] = {
	name : "Space Swine",
	nameAlt : ["Swine, Space"],
	source : [["S:AiS", 57]], // page number in Boo's Astral Menagerie
	size : 3,
	type : "Beast",
	alignment : "Unaligned",
	ac : 11,
	hp : 22,
	hd : [4, 8],
	speed : "40 ft, fly 40 ft",
	scores : [14, 12, 10, 2, 12, 4],
	skills : {
		"perception" : 4,
		"survival" : 4
	},
	senses : "",
	passivePerception : 14,
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 6, "piercing"],
		range : "Melee (5 ft)"
	}],
	traits : [{
		name : "Barding",
		description : "Space swine that are trained for battle are typically outfitted with half-plate barding and are referred to as death squealers. This barding gives them an AC of 16."
	}],
	wildshapeString : " " // the barding trait is not applicable to wild shapes
};

// pub_20221206_Dragonlance.js
// This file adds the Character Options content from Dragonlance: Shadow of the Dragon Queen to MPMB's Character Record Sheet

SourceList["D:SotDQ"] = {
	name : "Dragonlance: Shadow of the Dragon Queen",
	abbreviation : "D:SotDQ",
	group : "Campaign Sourcebooks",
	campaignSetting : "Dragonlance",
	url : "https://dnd.wizards.com/products/dragonlance",
	date : "2022/12/06"
};

RaceList["kender"] = {
	regExpSearch : /kender/i,
	name : "Kender",
	source : [["D:SotDQ", 27]],
	plural : "Kender",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	scoresGeneric : true,
	savetxt : { adv_vs : ["frightened"]},
	skillstxt : "Choose one from Insight, Investigation, Sleight of Hand, Stealth, or Survival",
	abilitySave : [4, 5, 6],
	features : {
		"fearless" : {
			name : "Fearless",
			minlevel : 1,
			usages : 1,
			recovery : "long rest"
		},
		"taunt" : {
			name : "Taunt",
			minlevel : 1,
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest",
			action : [["bonus action", ""]]
		}
	},
	trait : "Kender"+
	"\n \u2022 Fearless: I have adv. on saves against the frightened condition. Once per long rest when I fail " + (typePF ? "such a save" : "a save to avoid being frightened") + ", I can choose to succeed" + (typePF ? "." : " instead")+
	"\n \u2022 Taunt: As a bonus action, I can taunt a creature within 60 ft of me that can hear and understand me. They must make a Wisdom " + (typePF ? "saving throw or have disadvantage" : "save (DC 8 + Prof B + Int/Wis/Cha mod; one-time choice) or have disadv.") + " on attack rolls not made against me until the start of my next turn. I can do this a number of times per long rest equal to my proficiency bonus." + (typePF ? " The DC equals 8 + my proficiency bonus + Intelligence, Wisdom, or Charisma modifier (one-time choice when selecting this race)." : "")
};

BackgroundList["knight of solamnia"] = {
	regExpSearch : /^(?=.*(knight|champion|warrior))(?=.*solamnia).*$/i,
	name : "Knight of Solamnia",
	source : [["D:SotDQ", 0], ["UA:HoKR", 2]],
	skills : ["Athletics", "Survival"],
	gold : 10,
	languageProfs : [2],
	equipleft : [
		["Insignia of rank", "", ""],
		["Deck of cards", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Pouch (with coins)", "", 1]
	],
	feature : "Squire of Solamnia",
	trait : [ // Kept those from the UA article
		"I pledge my sword to the greater good. If I must perish in pursuit of that good, so be it.",
		"My comrades-in-arms are my family. I'll do whatever it takes to keep them safe.",
		"The protection of innocent people comes first. All other concerns come second.",
		"I joined the knights for the free meals, but their lessons grew on me over time.",
		"I wish my deeds to become the stuff of legends\xD7just like those of the knighthood's heroic founders.",
		"A dishonorable act drove me to become a knight. I have acted with honor ever since."
	],
	extra : [
		"Choose a Trinket",
		"Silver disk, recording my heroics",
		"Piece of a fallen knight's armor",
		"Pendant with a crown/rose/sword",
		"Pommel of my mentor's sword",
		"Favor from someone I defended",
		"Locket with silver dragon sketch"
	]
};
BackgroundFeatureList["squire of solamnia"] = {
	description : "I gain the Squire of Solamnia feat. In addition, the Knights of Solamnia provide me free, modest lodging and food at any of their fortresses or encampments.",
	source : [["D:SotDQ", 0], ["UA:HoKR", 2], ["UA:HoK", 3]],
	eval : function() { AddFeat("Squire of Solamnia"); },
	removeeval : function() { RemoveFeat("Squire of Solamnia"); }
};

BackgroundList["mage of high sorcery"] = {
	regExpSearch : /^(?=.*(mage|wizard|magus))(?=.*high)(?=.*sorcery).*$/i,
	name : "Mage of High Sorcery",
	source : [["D:SotDQ", 0], ["UA:HoKR", 3], ["UA:HoK", 4]],
	skills : ["Arcana", "History"],
	gold : 10,
	languageProfs : [2],
	equipleft : [
		["Bottle of colored ink", "", ""],
		["Ink pen", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Pouch (with coins)", "", 1]
	],
	feature : "Initiate of High Sorcery",
	trait : [ // Kept those from the UA article
		"I wish to use my knowledge of magic to better people's lives.",
		"My study of magic might reveal all manner of secrets.",
		"Magic is a means to power, and I will use it to pursue my ambitions.",
		"I learned magic so I'd be able to protect those I care about.",
		"I use my magic to maintain the balance between all things.",
		"Whether in the past, present, or future, I will be the greatest mage ever known."
	],
	extra : [
		"Choose a Trinket",
		"Unopened letter from first teacher",
		"Broken black/red/white wooden wand",
		"Scroll with incomprehensible formula",
		"Stone-covered foldable device",
		"Pouch with triple moon symbol",
		"Spellbook with triple moon symbol",
		"Lens to see Nuitari, invisible moon"
	]
};
BackgroundFeatureList["initiate of high sorcery"] = {
	description : "I gain the Initiate of High Sorcery feat. In addition, the Mages of High Sorcery provide me with free, modest lodging and food indefinitely at any occupied Tower of High Sorcery and for one night at the home of an organization member.",
	source : [["D:SotDQ", 0], ["UA:HoKR", 3], ["UA:HoK", 4]],
	eval : function() { AddFeat("Initiate of High Sorcery"); },
	removeeval : function() { RemoveFeat("Initiate of High Sorcery"); }
};


// Feats tree for Initiate of High Sorcery
FeatsList["initiate of high sorcery"] = {
	name : "Initiate of High Sorcery",
	source : [["D:SotDQ", 32], ["UA:HoKR", 4]],
	description : "I learn a wizard cantrip and two 1st-levels spell from a list depending on my chosen moon. I can cast each spell once per long rest at its lowest levels without expending a spell slot, or by using a spell slot as normal. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
	descriptionFull : "You've received training from magic-users affiliated with the Mages of High Sorcery."+
	"\n   Choose one of the three moons of Krynn to influence your magic: the black moon, Nuitari; the red moon, Lunitari; or the white moon, Solinari. You learn one cantrip of your choice from the wizard spell list and two 1st-level spells based on the moon you choose, as specified in the Lunar Spells table."+
	"\n\n" + toUni("Lunar Spells")+
	"\n" + toUni("Moon\t1st-Level Spell")+
	"\nNuitari\tChoose two from dissonant whispers, false life,"+
	"\n\thex, and ray of sickness"+
	"\nLunitari\tChoose two from color spray, disguise self,"+
	"\n\tfeather fall, and longstrider"+
	"\nSolinari\tChoose two from comprehend languages, detect"+
	"\n\tevil and good, protection from evil and good, and"+
	"\n\tshield"+
	"\n\n   You can cast each of the chosen 1st-level spells without a spell slot, and you must finish a long rest before you can cast them in this way again. You can also cast the spells using any spell slots you have."+
	"\n   Your spellcasting ability for this feat's spells is Intelligence, Wisdom, or Charisma (choose when you select this feat).",
	prerequisite : "Dragonlance Campaign, plus Sorcerer, Wizard, or Mage of High Sorcery background",
	prereqeval : function (v) {
		return classes.known.wizard || classes.known.sorcerer || CurrentBackground.known.indexOf('mage of high sorcery') !== -1 || /initiate of high sorcery/i.test(What("Background Feature"));
	},
	choices : ["Nuitari", "Lunitari", "Solinari"],
	"nuitari" : {
		description : "I learn a wizard cantrip and two 1st-level spells (Dissonant Whispers, False Life, Hex, or Ray of Sickness). I can cast each spell once per long rest at its lowest level without expending a spell slot, or by using a spell slot as normal. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Wizard Cantrip",
			"class" : ["wizard"],
			level : [0, 0],
			firstCol : "atwill"
		}, {
			name : "Nuitari 1st-level spell",
			spells : ["dissonant whispers", "false life", "hex", "ray of sickness"],
			firstCol : "oncelr",
			times : 2
		}]
	},
	"lunitari" : {
		description : "I learn a wizard cantrip and two 1st-level spells (Color Spray, Disguise Self, Feather Fall, Longstrider). I can cast each spell once per long rest at its lowest level without expending a spell slot, or by using a spell slot as normal. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Wizard Cantrip",
			"class" : ["wizard"],
			level : [0, 0],
			firstCol : "atwill"
		}, {
			name : "Lunitari 1st-level spell",
			spells : ["color spray", "disguise self", "feather fall", "longstrider"],
			firstCol : "oncelr",
			times : 2
		}]
	},
	"solinari" : {
		description : "I learn a wizard cantrip and two 1st-level spells (Comprehend Languages, Detect Evil and Good, Protection from Evil and Good, Shield). I can cast each spell once per long rest at its lowest level without expending a spell slot, or by using a spell slot as normal. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Wizard Cantrip",
			"class" : ["wizard"],
			level : [0, 0],
			firstCol : "atwill"
		}, {
			name : "Solinari 1st-level spell",
			spells : ["comprehend languages", "detect evil and good", "protection from evil and good", "shield"],
			firstCol : "oncelr",
			times : 2
		}]
	}
};
FeatsList["adept of the black robes"] = {
	name : "Adept of the Black Robes",
	source : [["D:SotDQ", 31], ["UA:HoKR", 4]],
	description : "I learn one 2nd-level Ench or Necro spell, which I can cast once per long rest at its lowest level without a spell slot, or as normal with one. When a creature I can see within 60 ft fails its save vs. my damaging spell, I can expend HD up to the spell's level and add the rolls to the damage of the spell for that one creature.",
	descriptionFull : "You chose the moon Nuitari to influence your magic, and your ambition and loyalty to the Order of the Black Robes have been recognized, granting you these benefits:"+
	"\n   " + toUni("Ambitious Magic") + ". You learn one 2nd-level spell of your choice. The 2nd-level spell must be from the evocation or necromancy school of magic. You can cast this feat's 2nd-level spell without a spell slot, and you must finish a long rest before you can cast it in this way again. You can also cast this spell using spell slots you have of the appropriate level. The spell's spellcasting ability is the one chosen when you gain the Initiate of High Sorcery feat."+
	"\n   " + toUni("Life Channel") + ". You can channel your life force into the power of your magic. When a creature you can see within 60 feet fails on a saving throw against a spell that deals damage that you cast, you can expend a number of Hit Dice equal to the level of the spell. Roll the expended Hit Dice and add them together. The damage that the creature takes increases by an amount equal to that total.",
	prerequisite : "4th level, Initiate of High Sorcery (Nuitari) feat",
	prereqeval : function(v) {
		var iHghSrcyInit = CurrentFeats.known.indexOf("initiate of high sorcery");
		return v.characterLevel >= 4 && iHghSrcyInit !== -1 && CurrentFeats.choices[iHghSrcyInit] === 'nuitari';
	},
	spellcastingBonus : {
		name : "2nd-level Evoc/Necro spell",
		"class" : "any",
		school : ["Evoc", "Necro"],
		level : [2, 2],
		firstCol : "oncelr"
	},
	spellcastingAbility : 'initiate of high sorcery_-_nuitari',
	allowUpCasting : true
};
FeatsList["adept of the red robes"] = {
	name : "Adept of the Red Robes",
	source : [["D:SotDQ", 32], ["UA:HoKR", 4]],
	description : "I learn a 2nd-level Illusion or Transmutation spell, which I can cast once per long rest at its lowest level without a spell slot, or as normal with one. When I roll 9 or lower on the d20 for an attack or ability check, I can treat the roll as a 10. I can do this a number of times per long rest equal to my proficiency bonus.",
	descriptionFull : "You chose the moon Lunitari to influence your magic, and your dedication to maintaining the balance between all things has been recognized by the Order of the Red Robes, granting you these benefits:"+
	"\n   " + toUni("Insightful Magic") + ". You learn one 2nd-level spell of your choice. The 2nd-level spell must be from the illusion or transmutation school of magic. You can cast this feat's 2nd-level spell without a spell slot, and you must finish a long rest before you can cast it in this way again. You can also cast this spell using spell slots you have of the appropriate level. The spell's spellcasting ability is the one chosen when you gain the Initiate of High Sorcery feat."+
	"\n   " + toUni("Magical Balance") + ". When you make an attack roll, an ability check, or a saving throw, and roll a 9 or lower on the d20, you can use your reaction to balance fate and treat the roll as a 10. you can use this reaction a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	prerequisite : "4th level, Initiate of High Sorcery (Lunitari) feat",
	prereqeval : function(v) {
		var iHghSrcyInit = CurrentFeats.known.indexOf("initiate of high sorcery");
		return v.characterLevel >= 4 && iHghSrcyInit !== -1 && CurrentFeats.choices[iHghSrcyInit] === 'lunitari';
	},
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest",
	spellcastingBonus : {
		name : "2nd-level Illus/Trans spell",
		"class" : "any",
		school : ["Illus", "Trans"],
		level : [2, 2],
		firstCol : "oncelr"
	},
	spellcastingAbility : 'initiate of high sorcery_-_lunitari',
	allowUpCasting : true
};
FeatsList["adept of the white robes"] = {
	name : "Adept of the White Robes",
	source : [["D:SotDQ", 32], ["UA:HoKR", 4]],
	description : "I learn one 2nd-level Abjur or Div spell, which I can cast once per long rest at its lowest level without a spell slot, or as normal with one. As a reaction when I or a creature I can see within 30 ft is damaged, I can expend a spell slot and roll d6s equal to its level to reduce the damage by that much + my spellcasting modifier.",
	descriptionFull : "You chose the moon Solinari to influence your magic, and your oath to use magic to make the world a better place has been recognized by the Order of the White Robes, granting you these benefits:"+
	"\n   " + toUni("Protective Magic") + ". You learn one 2nd-level spell of you choice. The 2nd-level spell must be from the abjuration or divination school of magic. You can cast this feat's 2nd-level spell without a spell slot, and you must finish a long rest before you can cast it in this way again. You can also cast this spell using spell slots you have of the appropriate level. The spell's spellcasting ability is the one chosen when you gain the Initiate of High Sorcery feat."+
	"\n   " + toUni("Protective Ward") + ". When you or a creature you can see within 30 feet of you takes damage, you can use your reaction to expend a spell slot and weave protective magic around the target. Roll a number of d6s equal to the level of the spell slot expended and reduce the damage the target takes by the total rolled on those dice + your spellcasting ability modifier.",
	prerequisite : "4th level, Initiate of High Sorcery (Solinari) feat",
	prereqeval : function(v) {
		var iHghSrcyInit = CurrentFeats.known.indexOf("initiate of high sorcery");
		return v.characterLevel >= 4 && iHghSrcyInit !== -1 && CurrentFeats.choices[iHghSrcyInit] === 'solinari';
	},
	action : [["reaction", ""]],
	spellcastingBonus : {
		name : "2nd-level Abjur/Div spell",
		"class" : "any",
		school : ["Abjur", "Div"],
		level : [2, 2],
		firstCol : "oncelr"
	},
	spellcastingAbility : 'initiate of high sorcery_-_solinari',
	allowUpCasting : true
};

// Feat Divinely Favored
FeatsList["divinely favored"] = {
	name : "Divinely Favored",
	source : [["D:SotDQ", 32], ["UA:HoKR", 4]],
	description : "I learn a cleric cantrip, a 1st-level spell based on my alignment, and Augury. I can cast the spells each once per long rest at their lowest level without a spell slot, or by using a spell slot as normal. I can choose Int, Wis, or Cha as my spellcasting ability for this. I can use a holy symbol as a spellcasting focus for any spell that uses the chosen ability.",
	descriptionFull : "A god chose you to carry a spark of their power."+
	"\n   You learn one cantrip of your choice from the cleric spell list and one 1st-level spell based on the alignment of your character, as specified in the table below. You also learn the augury spell."+
	"\n\n" + toUni("Alignment\t1st-level Spell")+
	"\n Evil\t\tChoose one 1st level warlock spell"+
	"\n Good\t\tChoose one 1st-level cleric spell"+
	"\n Neutral\t\tChoose one 1st-level druid spell"+
	"\n\n   You can cast the chosen 1st-level spell and the augury spell without a spell slot, and you must finish a long rest before you can cast either of these spells in this way again. You can also cast these spells using spell slots you have of the appropriate level."+
	"\n   Your spellcasting ability for this feat's spells is Intelligence, Wisdom, or Charisma (choose when you select this feat)."+
	"\n\n   In addition, you can use a holy symbol as a spellcasting focus for any spell you cast that uses the spellcasting ability you choose when you select this feat.",
	choices : ["Evil (warlock spell)", "Good (cleric spell)", "Neutral (druid spell)"],
	"evil (warlock spell)" : {
		name : "Divinely Favored [Evil]",
		description : "I learn a cleric cantrip, a 1st-level warlock spell, and Augury. I can cast each spell once per long rest at their lowest level without a spell slot, or by using a spell slot as normal. I choose Int, Wis, or Cha as my spellcasting ability for this. I can use a holy symbol as a spellcasting focus for any spell that uses the chosen ability.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Cleric Cantrip",
			"class" : ["cleric"],
			level : [0, 0],
			firstCol : "atwill"
		}, {
			name : "1st-level Warlock Spell",
			"class" : ["warlock"],
			level : [1, 1],
			firstCol : "oncelr"
		}, {
			name : "Augury",
			spells : ["augury"],
			selection : ["augury"],
			firstCol : "oncelr"
		}]
	},
	"good (cleric spell)" : {
		name : "Divinely Favored [Good]",
		description : "I learn a cleric cantrip, a 1st-level cleric spell, and Augury. I can cast each spell once per long rest at their lowest level without a spell slot, or by using a spell slot as normal. I choose Int, Wis, or Cha as my spellcasting ability for this. I can use a holy symbol as a spellcasting focus for any spell that uses the chosen ability.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Cleric Cantrip",
			"class" : ["cleric"],
			level : [0, 0],
			firstCol : "atwill"
		}, {
			name : "1st-level Cleric Spell",
			"class" : ["cleric"],
			level : [1, 1],
			firstCol : "oncelr"
		}, {
			name : "Augury",
			spells : ["augury"],
			selection : ["augury"],
			firstCol : "oncelr"
		}]
	},
	"neutral (druid spell)" : {
		name : "Divinely Favored [Neutral]",
		description : "I learn a cleric cantrip, a 1st-level druid spell, and Augury. I can cast each spell once per long rest at their lowest level without a spell slot, or by using a spell slot as normal. I choose Int, Wis, or Cha as my spellcasting ability for this. I can use a holy symbol as a spellcasting focus for any spell that uses the chosen ability.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : [{
			name : "Cleric Cantrip",
			"class" : ["cleric"],
			level : [0, 0],
			firstCol : "atwill"
		}, {
			name : "1st-level Druid Spell",
			"class" : ["druid"],
			level : [1, 1],
			firstCol : "oncelr"
		}, {
			name : "Augury",
			spells : ["augury"],
			selection : ["augury"],
			firstCol : "oncelr"
		}]
	}
};

// Feats tree for Squire of Solamnia
FeatsList["squire of solamnia"] = {
	name : "Squire of Solamnia",
	source : [["D:SotDQ", 34]],
	description : "Mounting or dismounting costs me only 5-ft of movement. Once per turn, I can grant myself advantage on a weapon attack, adding +1d8 to the damage roll if it hits. I can use this benefit my proficiency bonus per long rest, but a use is expended only if the attack hits.",
	descriptionFull : "Your training in the ways of the Knights of Solamnia grants you these benefits:"+
	"\n   " + toUni("Mount Up") + ". Mounting or dismounting costs you only 5 feet of movement."+
	"\n   " + toUni("Precise Strike") + ". Once per turn, when you make a weapon attack roll against a creature, you can cause the attack roll to have advantage. If the attack hits, you roll a d8 and add the number rolled as a bonus to the attack's damage roll. You can use this benefit a number of times equal to your proficiency bonus, but a use is expended only if the attack hits. You regain all expended uses when you finish a long rest.",
	prerequisite : "Dragonlance Campaign, plus Fighter, Paladin, or Knight of Solamnia background",
	prereqeval : function (v) {
		return classes.known.fighter || classes.known.paladin || CurrentBackground.known.indexOf('knight of solamnia') !== -1 || /squire of solamnia/i.test(What("Background Feature"));
	},
	limfeaname : "Precise Strike (Squire of Solamnia)",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = Number(How('Proficiency Bonus'));",
	recovery : "long rest"
};
FeatsList["knight of the crown"] = {
	name : "Knight of the Crown",
	source : [["D:SotDQ", 32]],
	description : "As a bonus action, I can use Commanding Rally on one ally within 30 ft that can see or hear me to immediately make one weapon attack as a reaction. +1d8 is added to the damage roll, if it hits. I can do this my proficiency bonus per long rest. [+1 Strength, Dexterity, or Constitution]",
	descriptionFull : "You are a Knight of Solamnia aligned with the Order of the Crown, a group that extols the virtues of cooperation, loyalty, and obedience. You excel in group combat and gain these benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase your Strength, Dexterity, or Constitution by 1, to a maximum of 20."+
	"\n   " + toUni("Commanding Rally") + ". As a bonus action, you can command one ally within 30 feet of yourself to attack. If that ally can see or hear you, they can immediately make one weapon attack as a reaction. If the attack hits, the ally can roll a d8 and add the number rolled as a bonus to the attack's damage roll. You can use this bonus action a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	prerequisite : "4th level, Squire of Solamnia feat",
	prereqeval : function(v) { return v.characterLevel >= 4 && CurrentFeats.known.indexOf("squire of solamnia") !== -1; },
	limfeaname : "Commanding Rally (Knight of the Crown)",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = Number(How('Proficiency Bonus'));",
	recovery : "long rest",
	action : [["bonus action", ""]],
	choices : ["Strength", "Dexterity", "Constitution"],
	"strength" : {
		description : "As a bonus action, I can use Commanding Rally on one ally within 30 ft that can see or hear me to immediately make one weapon attack as a reaction. +1d8 is added to the damage roll, if it hits. I can do this my proficiency bonus per long rest. [+1 Strength]",
		scores : [1,0,0,0,0,0]
	},
	"dexterity" : {
		description : "As a bonus action, I can use Commanding Rally on one ally within 30 ft that can see or hear me to immediately make one weapon attack as a reaction. +1d8 is added to the damage roll, if it hits. I can do this my proficiency bonus per long rest. [+1 Dexterity]",
		scores : [0,1,0,0,0,0]
	},
	"constitution" : {
		description : "As a bonus action, I can use Commanding Rally on one ally within 30 ft that can see or hear me to immediately make one weapon attack as a reaction. +1d8 is added to the damage roll, if it hits. I can do this my proficiency bonus per long rest. [+1 Constitution]",
		scores : [0,0,1,0,0,0]
	}
};
FeatsList["knight of the rose"] = {
	name : "Knight of the Rose",
	source : [["D:SotDQ", 33]],
	description : "As a bonus action, I can use Bolstering Rally on myself or an ally within 30 ft that I can see and can see or hear me. They gain 1d8 + my proficiency bonus + the modifier of the ability chosen to increase temporary hit points. I can do this my proficiency bonus per long rest. [+1 Constitution, Wisdom, or Charisma]",
	descriptionFull : "You are a Knight of Solamnia aligned with the Order of the Rose, a group known for leadership, justice, and wisdom. Your resolve grants you these benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase your Constitution, Wisdom, or Charisma by 1, to a maximum of 20."+
	"\n   " + toUni("Bolstering Rally") + ". As a bonus action, you can encourage one creature you can see within 30 feet of yourself (you can choose yourself). If the target can see or hear you, the target gains temporary hit points equal to 1d8 + your proficiency bonus + the ability modifier of the ability score increased by this feat. You can use this bonus action a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	prerequisite : "4th level, Squire of Solamnia feat",
	prereqeval : function(v) { return v.characterLevel >= 4 && CurrentFeats.known.indexOf("squire of solamnia") !== -1; },
	limfeaname : "Bolstering Rally (Knight of the Rose)",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = Number(How('Proficiency Bonus'));",
	recovery : "long rest",
	action : [["bonus action", ""]],
	choices : ["Constitution", "Wisdom", "Charisma"],
	"constitution" : {
		calculation : 'event.value = "As a bonus action, I can use Bolstering Rally on myself or an ally within 30 ft that I can see and can see or hear me. They gain 1d8 + " + (Number(How("Proficiency Bonus")) + Number(What("Con Mod"))) + " temporary hit points (1d8 + proficiency bonus + Constitution modifier). I can do this my proficiency bonus per long rest. [+1 Constitution]";',
		scores : [0,0,1,0,0,0]
	},
	"wisdom" : {
		calculation : 'event.value = "As a bonus action, I can use Bolstering Rally on myself or an ally within 30 ft that I can see and can see or hear me. They gain 1d8 + " + (Number(How("Proficiency Bonus")) + Number(What("Wis Mod"))) + " temporary hit points (1d8 + proficiency bonus + Wisdom modifier). I can do this my proficiency bonus per long rest. [+1 Wisdom]";',
		scores : [0,0,0,0,1,0]
	},
	"charisma" : {
		calculation : 'event.value = "As a bonus action, I can use Bolstering Rally on myself or an ally within 30 ft that I can see and can see or hear me. They gain 1d8 + " + (Number(How("Proficiency Bonus")) + Number(What("Cha Mod"))) + " temporary hit points (1d8 + proficiency bonus + Charisma modifier). I can do this my proficiency bonus per long rest. [+1 Charisma]";',
		scores : [0,0,0,0,0,1]
	}
};
FeatsList["knight of the sword"] = {
	name : "Knight of the Sword",
	source : [["D:SotDQ", 33]],
	description : "Once per turn, when I hit a creature with a weapon attack, I can have it make a Wisdom save DC (8 + Prof Bonus + mod of the ability increased by this feat) or be frightened of me until my next turn ends. On a successful save, the target has disadv. on its next attack before its next turn ends. I can do this my proficiency bonus per long rest. [+1 Int/Wis/Cha]",
	descriptionFull : "You are a Knight of Solamnia aligned with the Order of the Sword, a group devoted to heroism and courage. Bravery steels your spirit, granting you these benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase your Intelligence, Wisdom, or Charisma by 1, to a maximum of 20."+
	"\n   " + toUni("Demoralizing Strike") + ". Once per turn, when you hit a creature with a weapon attack roll, you can attempt to frighten that target. The target must make a Wisdom saving throw (DC equals 8 + your proficiency bonus + the ability modifier of the score increased by this feat). On a failed save, the target is frightened of you until the end of your next turn. On a successful save, the target has disadvantage on the next attack roll it makes before the end of its next turn. You can use this benefit a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	prerequisite : "4th level, Squire of Solamnia feat",
	prereqeval : function(v) { return v.characterLevel >= 4 && CurrentFeats.known.indexOf("squire of solamnia") !== -1; },
	limfeaname : "Demoralizing Strike (Knight of the Sword)",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = Number(How('Proficiency Bonus'));",
	recovery : "long rest",
	choices : ["Intelligence", "Wisdom", "Charisma"],
	"intelligence" : {
		calculation : 'event.value = "Once per turn, when I hit a creature with a weapon attack, I can have it make a Wisdom save DC " + (8 + Number(How("Proficiency Bonus")) + Number(What("Int Mod"))) + " (8 + Prof Bonus + Int mod) or be frightened of me until my next turn ends. On a successful save, the target has disadv. on its next attack before its next turn ends. I can do this my proficiency bonus per long rest. [+1 Int]";',
		scores : [0,0,0,1,0,0]
	},
	"wisdom" : {
		calculation : 'event.value = "Once per turn, when I hit a creature with a weapon attack, I can have it make a Wisdom save DC " + (8 + Number(How("Proficiency Bonus")) + Number(What("Wis Mod"))) + " (8 + Prof Bonus + Wis mod) or be frightened of me until my next turn ends. On a successful save, the target has disadv. on its next attack before its next turn ends. I can do this my proficiency bonus per long rest. [+1 Wis]";',
		scores : [0,0,0,0,1,0]
	},
	"charisma" : {
		calculation : 'event.value = "Once per turn, when I hit a creature with a weapon attack, I can have it make a Wisdom save DC " + (8 + Number(How("Proficiency Bonus")) + Number(What("Cha Mod"))) + " (8 + Prof Bonus + Cha mod) or be frightened of me until my next turn ends. On a successful save, the target has disadv. on its next attack before its next turn ends. I can do this my proficiency bonus per long rest. [+1 Cha]";',
		scores : [0,0,0,0,0,1]
	}
};

// Subclass
AddSubClass("sorcerer", "lunar sorcery", {
	regExpSearch : /^(?=.*(sorcerer|sorcery|witch))(?=.*(lunar|moon)).*$/i,
	subname : "Lunar Sorcery",
	fullname : "Lunar Sorcerer",
	source : [["D:SotDQ", 0]],
	features : {
		"subclassfeature1" : {
			name : "Lunar Embodiment",
			source : [["D:SotDQ", 0]],
			minlevel : 1,
			additional : levels.map(function (n) { return (n < 3 ? 3 : n < 5 ? 6 : n < 7 ? 9 : n < 9 ? 12 : 15) + " additional spells known"}),
			spellcastingExtra : [
				// full moon
				"shield", "lesser restoration", "dispel magic", "death ward", "rary's telepathic bond",
				// new moon
				"ray of sickness", "blindness/deafness", "vampiric touch", "confusion", "hold monster",
				// crescent moon
				"color spray", "alter self", "phantom steed", "hallucinatory terrain", "mislead"
			],
			spellcastingExtraApplyNonconform : true,
			description : levels.map(function(n) {
				var phases = {
					"\u25CB Full: " : ["Shield", "Lesser Restoration", "Dispel Magic", "Death Ward", "Rary's Telepathic Bond"],
					"\u25CF New: " : ["Ray of Sickness", "Blindness/deafness", "Vampiric Touch", "Confusion", "Hold Monster"],
					"\u25D6 Crescent: " : ["Color Spray", "Alter Self", "Phantom Steed", "Hallucinatory Terrain", "Mislead"]
				};
				var aReturn = [
					"When I finish a long rest, I can choose a lunar phase: Full, New, or Crescent Moon",
					"I can cast the 1st-level spell of that lunar phase once per long rest without a spell slot"
				];
				var iSpellsAdd = n < 3 ? 1 : n < 5 ? 2 : n < 7 ? 3 : n < 9 ? 4 : 5;
				for (var phase in phases) {
					aReturn.push(phase + phases[phase].slice(0,iSpellsAdd).join(", "));
				}
				//aReturn.push("I know all " + (iSpellsAdd * 3) + " spells above; They don't count towards the number of spells I can know");
				return desc(aReturn);
			}),
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName, isDuplicate) {
						if (spName === "sorcerer" && !isDuplicate && CurrentSpells.sorcerer.extra.indexOf(spellKey) !== -1) {
							var phases = {
								"F" : ["shield", "lesser restoration", "dispel magic", "death ward", "rary's telepathic bond"],
								"N" :  ["ray of sickness", "blindness/deafness", "vampiric touch", "confusion", "hold monster"],
								"C" : ["color spray", "alter self", "phantom steed", "hallucinatory terrain", "mislead"]
							};
							for (var phase in phases) {
								if (phases[phase].indexOf(spellKey) !== -1) {
									spellObj.firstCol = phase;
									return true;
								}
							}
						}
					},
					'The letters "F", "N", or "C" in the first column are used to indicate that a spell belongs to either the Full Moon, New Moon, or Crescent Moon lunar phase.'
				]
			},
			spellFirstColTitle : "Ph",
			extraLimitedFeatures : [{
				name : "1st-level lunar phase spell",
				usages : 1,
				recovery : "long rest"
			}]
		},
		"subclassfeature1.1" : {
			name : "Moon Fire",
			source : [["D:SotDQ", 0]],
			minlevel : 1,
			description : desc("I know the Sacred Flame cantrip and can use it on 2 creatures within 5 ft of each other"),
			spellcastingBonus : {
				name : "Moon Fire",
				spells : ["sacred flame"],
				selection : ["sacred flame"]
			},
			weaponsAdd : { select : ["Sacred Flame"] },
			spellChanges : {
				"sacred flame" : {
					description : "Up to 2 creas I see, max 5 ft apart, save or 1d8 Radiant dmg; no cover bonus; +1d8 at CL 5, 11, and 17",
					descriptionShorter : "Up to 2 creas I see, max 5 ft apart, save or 1d8 Radiant dmg; no cover bonus; +1d8 CL 5/11/17",
					descriptionCantripDie : "Up to 2 creas I see, max 5 ft apart, save or `CD`d8 Radiant dmg; no bonus for cover on save",
					changes : "When I cast Sacred Flame, I can target one creature as normal or target two creatures within range that are within 5 feet of each other."
				}
			},
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.baseWeaponName == 'sacred flame') {
							fields.Description = fields.Description.replace("1 creature", "up to 2 creatures within 5 ft");
						}
					},
					"When I cast Sacred Flame, I can target one creature as normal or target two creatures within range that are within 5 feet of each other."
				]
			}
		},
		"subclassfeature6" : {
			name : "Lunar Boons",
			source : [["D:SotDQ", 0]],
			minlevel : 6,
			description : desc([
				"Each lunar phase is additionally associated with spells of the following schools of magic:",
				"\u25CB Full: Abjur \u0026 Div\t\t\u25CF New: Ench \u0026 Necro\t" + (typePF ? "\t" : Array(8).join(" ")) + "\u25D6 Crescent: Illus \u0026 Trans",
				"I can reduce the sorcery point needed for Metamagic of spells of my current phase by 1"
			]),
			usages : "Proficiency bonus per ",
			usagescalc : "event.value = How('Proficiency Bonus');",
			recovery : "long rest"
		},
		"subclassfeature6.1" : {
			name : "Waxing and Waning",
			source : [["D:SotDQ", 0]],
			minlevel : 6,
			description : " [1 sorcery point]" + desc([
				"As a bonus action, I can spend 1 sorcery point to change my lunar phase",
				"I can cast each lunar phase's 1st-level spells once per long rest, if it is my current phase"
			]),
			action : [["bonus action", ""]],
			extraLimitedFeatures : [{
				name : "Shield (in Full lunar phase)",
				usages : 1,
				recovery : "long rest"
			}, {
				name : "Ray of Sickness (in New lunar phase)",
				usages : 1,
				recovery : "long rest"
			}, {
				name : "Color Spray (in Crescent lunar phase)",
				usages : 1,
				recovery : "long rest"
			}],
			eval : function () {
				RemoveFeature("1st-level lunar phase spell", 0, "", "", "Lunar Sorcerer: Lunar Embodiment");
			},
			removeeval : function () {
				AddFeature("1st-level lunar phase spell", 1, "", "long rest", "Lunar Sorcerer: Lunar Embodiment");
			}
		},
		"subclassfeature14" : {
			name : "Lunar Empowerment",
			source : [["D:SotDQ", 0]],
			minlevel : 14,
			description : " [passive benefits for current phase]" + desc([
				"\u25CB Full: I shed bright light in a 10-ft radius \u0026 dim light for extra 10 ft",
				"  Myself and creatures I choose in 10 ft have adv. on Investigation and Perception checks",
				"\u25CF New: I have adv. on Stealth checks; While I'm in darkness, attacks have disadv. vs me",
				"\u25D6 Crescent: I have resistance to Necrotic and Radiant damage"
			]),
			dmgres : [
				["Necrotic", "Necro. (in crescent)"],
				["Radiant", "Rad. (in crescent)"]
			]
		},
		"subclassfeature18" : {
			name : "Lunar Phenomenon",
			source : [["D:SotDQ", 0]],
			minlevel : 18,
			description : " [per phase: 1\xD7 per long rest or 5 SP]" + desc([
				"As a bonus action, or as part of changing phase, I can use a power of the (new) phase:",
				"\u25CB Full: Chosen creatures within 30 ft of me must make a Constitution save or be blinded",
				"  This lasts until their next turn ends; I also heal one creature within 30 ft for 3d8 HP",
				"\u25CF New: Chosen creatures within 30 ft of me must make a Dexterity save",
				"  If failed, they take 3d10 Necrotic damage and have 0 speed until their next turn ends",
				"  Also, I become invisible until the end of my next turn, or until I attack or cast a spell",
				"\u25D6 Crescent: I can magically teleport to an unoccupied space I can see within 60 ft",
				"  Both of us gain resistance to all damage until the start of my next turn",
				"I can use each phase's bonus action 1/LR, or by spending 5 sorcery points to use it again"
			]),
			action : [["bonus action", ""]],
			extraLimitedFeatures : [{
				name : "Lunar Phenomenon (Full)",
				usages : 1,
				recovery : "long rest",
				altResource : "5 SP"
			}, {
				name : "Lunar Phenomenon (New)",
				usages : 1,
				recovery : "long rest",
				altResource : "5 SP"
			}, {
				name : "Lunar Phenomenon (Crescent)",
				usages : 1,
				recovery : "long rest",
				altResource : "5 SP"
			}]
		}
	}
});

// Weapon, Hoopak
WeaponsList["hoopak, melee"] = {
	regExpSearch : /hoopak/i,
	name : "Hoopak, melee",
	source : [["D:SotDQ", 0]],
	list : "melee",
	ability : 1,
	type : "Martial",
	damage : [1, 6, "piercing"],
	range : "Melee",
	weight : 2,
	description : "Finesse, two-handed; Can be used ranged (40/160 ft) with ammo, for 1d4 bludgeoning damage",
	special : true,
	abilitytodamage : true
};
WeaponsList["hoopak, ranged"] = {
	regExpSearch : /^(?=.*hoopak)(?=.*ranged).*$/i,
	name : "Hoopak, ranged",
	source : [["D:SotDQ", 0]],
	list : "ranged",
	ability : 1,
	type : "Martial",
	damage : [1, 4, "bludgeoning"],
	range : "40/160 ft",
	weight : 2,
	description : "Ammunition, finesse, two-handed; Can be used in melee without ammo, for 1d6 piercing damage",
	special : true,
	abilitytodamage : true
};

// Magic Items
MagicItemsList["flying citadel helm"] = {
	name : "Flying Citadel Helm",
	source : [["D:SotDQ", 190]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "This ornate chair allows me to maneuver a flying citadel while concentrating (as if a spell). I can move the citadel through the air 80 ft/round or 8 miles/h, steer it, and see and hear from its highest point as though I were at that location. As an action or bonus action, I can transfer attunement to a willing spellcaster.",
	descriptionFull : "The function of this ornate chair is to propel and maneuver a flying citadel on which it has been installed. The chair has AC 15, 18 hit points, and immunity to poison and psychic damage. It is destroyed if reduced to 0 hit points."+
	"\n   The sensation of being attuned to a flying citadel helm is akin to the pins-and-needles effect one experiences after one's arm or leg falls asleep, but not as intense."+
	"\n   While attuned to a flying citadel helm and sitting in it, you gain the following abilities for as long as you maintain concentration (as if concentrating on a spell):"+
	"\n \u2022 You can use the flying citadel helm to move the citadel through the air, up to 80 feet per round, or up to 8 miles per hour."+
	"\n \u2022 You can steer the citadel, albeit in a somewhat clumsy fashion, in much the way that a rudder or oars can be used to maneuver a seafaring ship."+
	"\n \u2022 At any time, you can see and hear from the highest point outside the citadel as though you were at that location."+
	"\n\n   If no creature attuned to the helm is maintaining concentration, the citadel remains motionless in its space."+
	"\n   "+toUni("Transfer Attunement")+". You can use an action or a bonus action to touch a willing spellcaster, whereupon that creature attunes to the flying citadel helm immediately, and your attunement to the flying citadel helm ends."+
	"\n   "+toUni("Crash")+". Should the flying citadel helm be destroyed, the citadel it is installed on loses power and begins to crumble. If the crumbling citadel is in the air, it descends at a rate of 30 feet per round, or 300 feet per minute. Any creature on the citadel or on the ground within 120 feet of the citadel when it lands must make a DC 20 Dexterity saving throw, taking 39 (6d12) bludgeoning damage on a failed save, or half as much damage on a successful one.",
	action : [
		["action", " (Transfer Attunement)"],
		["bonus action", " (Transfer Attunement)"]
	]
};
MagicItemsList["kagonesti forest shroud"] = {
	name : "Kagonesti Forest Shroud",
	source : [["D:SotDQ", 190]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "This cloak of autumnal leaves woven together grants me advantage on Dexterity (Stealth) checks. As a bonus action once per dawn, I can use it to magically teleport to an unoccupied space I can see within 30 ft. I then have advantage on the next attack roll I make before the end of the turn.",
	descriptionFull : "This cloak appears to be made of autumnal leaves woven together. While you wear this cloak, you have advantage on Dexterity (Stealth) checks, and you can use a bonus action to magically teleport, along with any equipment you are wearing or carrying, to an unoccupied space you can see within 30 feet of yourself. You then have advantage on the next attack roll you make before the end of the turn. Once this bonus action is used, it can't be used again until the next dawn.",
	advantages : [["Stealth", true]],
	action : [["bonus action", " (teleport)"]],
	usages : 1,
	recovery : "Dawn",
	additional : "teleport"
};
MagicItemsList["mirror of reflected pasts"] = {
	name : "Mirror of Reflected Pasts",
	source : [["D:SotDQ", 190]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "As an action, I can (de)activate this mirror. It can be activated once per dawn, making it hover in the air, can't be moved, and when a non-construct sees its reflection in it while within 30 ft, it must make a DC 15 Wis save. It is paralyzed until the mirror is deactivated. It can retry the save at the end of each of its turns.",
	descriptionLong : "As an action, I can activate this mirror of elven design once per dawn, or deactive it. While active, it hovers in the air and can't be moved. When a non-construct creature within 30 ft of the mirror sees its reflection in it, the creature must make a DC 15 Wisdom save or become paralyzed. The creature can repeat the save at the end of each of its turns, but is otherwise paralyzed until the  mirror is deactivated. A successful save makes a creature immune for 24 hours. While paralyzed by the mirror, the creature sees idealized versions of events from their past reflected in the mirror's glass.",
	descriptionFull : "This mirror of elven design allows those who stare into it to reflect on positive memories. The 3-foot-tall mirror weighs 25 pounds, and it has AC 11, 10 hit points, and vulnerability to bludgeoning damage. It shatters and is destroyed if reduced to 0 hit points."+
	"While holding the mirror upright, you can use an action to speak its command word and activate it. While activated, the mirror hovers in the air, and it can be destroyed but not moved. It remains activated until you use an action to speak the command word again or your attunement to the mirror ends, at which point the mirror harmlessly floats to the ground. Once the mirror has been deactivated, it can't be activated again until the next dawn."+
	"If a non-Construct creature other than you sees its reflection in the activated mirror while within 30 feet of it, that creature must succeed on a DC 15 Wisdom saving throw or become paralyzed until the mirror is deactivated or until that creature can no longer see the mirror. A creature paralyzed by the mirror can repeat the saving throw at the end of each of its turns, ending the effect on a success. If a creature's saving throw is successful or the effect ends for it, the creature is immune to this mirror's effect for the next 24 hours."+
	"While paralyzed by the mirror, the creature sees events from their past reflected in the mirror's glass. These memories aren't real, but rather idealized versions of those occurrences. Nearby observers can glimpse flashes of these memories if looking indirectly at the mirror.",
	weight : 25,
	action : [["action", " [(de)activate]"]],
	usages : 1,
	recovery : "Dawn"
};

// pub_20230221_KftGV.js
// This file adds the magic items from the Keys from the Golden Vault adventure book to MPMB's Character Record Sheet

SourceList["KftGV"] = {
	name : "Keys from the Golden Vault [items]",
	abbreviation : "KftGV",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/keys-from-the-golden-vault",
	date : "2023/02/21"
};

var KftGV_ConstantoriPortrait = [
	"This painting by famed artist Dkesii Kwan depicts Constantori, a beautiful courtier, who was paid a staggering sum to be Dkesii's model. Whether Constantori's actual appearance matches the painting remains a subject of debate. The portrait is one of several paintings commissioned by the late Daiyani Grysthorn, a crime lord who frequently gave magical paintings as gifts to her most esteemed associates.",
	">>Sentience<<. Constantori's Portrait is a sentient, lawful evil item with an Intelligence score of 14, a Wisdom score of 12, and a Charisma score of 8. It can hear within a range of 120 feet and has darkvision within a range of 60 feet, but it can't see anything behind itself.",
	"The painting can converse in Common, Draconic, and Elvish as if it were a living person, though Constantori's mouth doesn't move. Whenever conversation occurs within the portrait's auditory range, the painting eagerly gathers secrets, the names of secret tellers, significant events, or any political conversations.",
	">>Personality<<. Constantori's Portrait is demanding, condescending, and vain. It doesn't like being covered or placed out of sight, and it loudly condemns anyone who tries to remove it from its gold-leaf frame.",
	">>Wealth of Information<<. The painting's primary purpose is to observe and recall conversations. Over the past few decades, Constantori's Portrait has quietly observed countless conversations and now possesses an unquantifiable amount of lore\u2014everything from criminal conspiracies to secret passwords. The DM decides what the painting knows and what it doesn't.",
	"While attuned to the painting, you can take an action to telepathically contact it over any distance, provided the painting and you are on the same plane of existence. The painting can't telepathically contact you, however. Maintaining telepathic contact with the painting requires your concentration (as if concentrating on a spell).",
	">>Guardian Portrait<<. While you are attuned to the painting, you can command it to guard its location against one or more creatures you identify as the painting's enemies. The painting performs this function until you command it to stop or until your attunement to the painting ends.",
	"The painting has 3 charges. When a creature the painting identifies as its enemy starts its turn in a space the painting can see, the painting expends 1 of its charges to cast magic missile (3 missiles), targeting that creature. The painting regains all expended charges daily at dawn.",
	"The painting is a Small object with AC 12, 20 hit points, and immunity to poison damage. In its gold-leaf frame, the painting weighs 15 pounds. If the painting has at least 1 hit point and is targeted by a mending spell, it regains 2d6 hit points."
];
MagicItemsList["constantori's portrait"] = {
	name : "Constantori's Portrait",
	source : [["KftGV", 101]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "As an action, I can telepathically contact this sentient painting over any distance while on the same plane. It can't contact me. Maintaining contact requires concentration like on a spell. I can command the painting to guard an area. It can cast Magic Missile 3 times per dawn. See Notes page.",
	descriptionFull : KftGV_ConstantoriPortrait.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : desc(KftGV_ConstantoriPortrait).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/\bf(oo|ee)t\b/ig, "ft").replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(contact) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	action : [["action", " (contact)"]],
	usages : 3,
	recovery : "dawn",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["magic missile"],
		selection : ["magic missile"],
		firstCol : 1
	}
};

MagicItemsList["shard of xeluan"] = {
	name : "Shard of Xeluan",
	source : [["KftGV", 134]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "While holding this 1-ft long obsidian shard, I can use it as a spellcasting focus, and I gain a +1 bonus to my spell attack rolls. While it is on my person, I gain +4 Strength up to 22. Attuning to this shard extends its curse to me: When I roll a 1 on a check, attack, or save, I must roll on its misfortunes table, see Notes.",
	descriptionFull : "This 1-foot-long shard of obsidian has veins of silver and gold beneath its cold surface."+
	"\n   " + toUni("Empowered Magic") + ". While holding the shard, you can use it as a spellcasting focus, and it gives you a +1 bonus to your spell attack rolls."+
	"\n   " + toUni("Enhanced Strength") + ". Your Strength score increases by 4 while the shard is on your person. The shard can't raise your Strength score above 22."+
	"\n   " + toUni("Curse") + ". Attuning to this item extends its curse to you. You remain cursed until you are targeted by a remove curse spell or similar magic, or until the shard is reattached to Xeluan's petrified heart."+
	"\n   The shard's curse causes misfortune to befall you. When you roll a 1 on an attack roll, an ability check, or a saving throw, roll on the Shard Misfortunes table to determine the misfortune. For as long as this misfortune lasts, no other shard misfortunes befall you."+
	"\n\n " + toUni("d6\tMisfortune")+
	"\n  1\tYou accidentally cut yourself with the shard and are poisoned until the next dawn."+
	"\n  2\tYou experience a vision of an ancient calamity\u2014a beautiful city threatened by crumbling mountains and erupting volcanoes\u2014and are stunned until the end of your next turn."+
	"\n  3\tFor a few seconds, the ground shakes under you. You and each creature within 10 feet of you must succeed on a DC 16 Dexterity saving throw or be knocked prone."+
	"\n  4\tThe shard releases three glowing darts of magical force that target one random creature within 30 feet of you. If no such target exists, you become the target. Each dart hits automatically and deals 3 (1d4 + 1) force damage to the target."+
	"\n  5\tUntil the next dawn, Beasts with an Intelligence score of 3 or lower are hostile to you."+
	"\n  6\tNothing seems to go your way. Until the next dawn, you have disadvantage on ability checks.",
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type == "attack") return 1;
			},
			"I gain a +1 bonus to spell attack rolls."
		]
	},
	scores : [4, 0, 0, 0, 0, 0],
	scoresMaximum : [22, 0, 0, 0, 0, 0],
	toNotesPage : [{
		name : "Shard Misfortunes Table",
		note : [
			"Attuning to this item extends its curse to me. I remain cursed until I'm targeted by a remove curse spell or similar magic, or until the shard is reattached to Xeluan's petrified heart.",
			"The shard's curse causes misfortune to befall me. When I roll a 1 on an attack roll, an ability check, or a saving throw, roll on the Shard Misfortunes table to determine the misfortune. For as long as this misfortune lasts, no other shard misfortunes befall me.",
			"\n  d6\tMisfortune",
			"1\tI accidentally cut myself with the shard and are poisoned until the next dawn."+
			"2\tI experience a vision of an ancient calamity: a beautiful city threatened by crumbling mountains and erupting volcanoes. I am stunned until the end of my next turn."+
			"3\tFor a few seconds, the ground shakes under me. Each creature within 10 ft of me, myself included, must succeed on a DC 16 Dexterity saving throw or be knocked prone."+
			"4\tThe shard releases three glowing darts of magical force that target one random creature within 30 ft of me. If no such target exists, I become the target. Each dart hits automatically and deals 1d4+1 force damage to the target."+
			"5\tUntil the next dawn, Beasts with an Intelligence score of 3 or lower are hostile to me."+
			"6\tNothing seems to go my way. Until the next dawn, I have disadvantage on ability checks."
		]
	}]
};

var KftGV_ShardSolitaire = {
	descriptionFull : "This gemstone contains an unstable extradimensional rift. Its facets are ribboned with iridescent veins that seem to move of their own accord. Five types of shard solitaire are known to exist, each one a different type of gemstone: black sapphire, diamond, jacinth, rainbow pearl, and ruby."+
	"\n   " + toUni("Rift Step") + ". As a bonus action, while wearing or holding the shard solitaire, you can teleport yourself, along with anything you're wearing or carrying, to an unoccupied space you can see within 30 feet of yourself."+
	"\n   When you use this property, you can tap into the unstable power of the stone's extradimensional rift to increase the teleport distance by up to 30 feet, but if you teleport more than 30 feet using Rift Step, you must succeed on a DC 16 Constitution saving throw or take 3d10 force damage immediately after you teleport."+
	"\n   " + toUni("Spellcasting") + ". The stone has 6 charges and regains 1d6 expended charges daily at dawn. ",
	descriptionTable : "The Shard Solitaire Types table lists the spells common to all shard solitaires, as well as the spells specific to each kind of stone. As an action, you can cast one of the stone's spells by expending the requisite number of charges, requiring no material components (save DC 16)."+
	"\n\n " + toUni("Shard Solitaire\tSpells")+
	"\n  All\t\tBanishment (3 charges; the target is banished to the stone's extradimensional space"+
	"\n\t\tfor the spell's duration), Mirror Image (1 charge)"+
	"\n  Black sapphire\tBlight (3 charges), Finger of Death (6 charges)"+
	"\n  Diamond\tIce Storm (3 charges), Simulacrum (6 charges; the duplicate created by the spell"+
	"\n\t\thas the same number of hit points as the creature it imitates)"+
	"\n  Jacinth\t\tFireball (2 charges), Fire Storm (6 charges)"+
	"\n  Rainbow pearl\tPrismatic Spray (6 charges), Water Breathing (2 charges)"+
	"\n  Ruby\t\tFly (2 charges), Teleport (6 charges)",
	spellcastingBonus : [{
		fixedDC : 16,
		name : "1 charge",
		spells : ["mirror image"],
		selection : ["mirror image"],
		firstCol : 1
	}, {
		name : "3 charges",
		spells : ["banishment"],
		selection : ["banishment"],
		firstCol : 3
	}],
	spellChanges_banishment : {
		description : "1 crea save or banished to the stone's extradimensional space for the spell's duration",
		changes : "The target is instead banished to the stone's extradimensional space for the spell's duration."
	}
};
MagicItemsList["shard solitaire"] = {
	name : "Shard Solitaire",
	source : [["KftGV", 193]],
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	description : "As a bonus action while wearing or holding this gemstone, I can teleport up to 60 ft to an empty space I can see. If I teleport over 30 ft, I need to make a DC 16 Con save or take 3d10 force damage. It has 6 charges, regaining 1d6 at dawn. I can use these charges to cast several spells as an action, see the spell sheet.",
	descriptionFull : KftGV_ShardSolitaire.descriptionFull.replace(": black sapphire, diamond, jacinth, rainbow pearl, and ruby.", ", as shown in the Shard Solitaire Types table.") + KftGV_ShardSolitaire.descriptionTable,
	allowDuplicates : true,
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6",
	choices : ["Black Sapphire", "Diamond", "Jacinth", "Rainbow Pearl", "Ruby"],
	"black sapphire" : {
		descriptionFull : KftGV_ShardSolitaire.descriptionFull + "The black sapphire shard solitaire can be used to cast the following spells: Banishment (3 charges; the target is banished to the stone's extradimensional space for the spell's duration), Mirror Image (1 charge), Blight (3 charges), Finger of Death (6 charges).",
		action : [["bonus action", "Black Sapphire (Shard Step)"]],
		spellFirstColTitle : "Ch",
		spellcastingBonus : KftGV_ShardSolitaire.spellcastingBonus.concat([{
			name : "3 charges",
			spells : ["blight"],
			selection : ["blight"],
			firstCol : 3
		}, {
			name : "6 charges",
			spells : ["finger of death"],
			selection : ["finger of death"],
			firstCol : 6
		}]),
		spellChanges : {
			"banishment" : KftGV_ShardSolitaire.spellChanges_banishment
		}
	},
	"diamond" : {
		descriptionFull : KftGV_ShardSolitaire.descriptionFull + "The diamond shard solitaire can be used to cast the following spells: Banishment (3 charges; the target is banished to the stone's extradimensional space for the spell's duration), Mirror Image (1 charge), Ice Storm (3 charges), Simulacrum (6 charges; the duplicate created by the spell has the same number of hit points as the creature it imitates).",
		action : [["bonus action", "Diamond (Shard Step)"]],
		spellFirstColTitle : "Ch",
		spellcastingBonus : KftGV_ShardSolitaire.spellcastingBonus.concat([{
			name : "3 charges",
			spells : ["ice storm"],
			selection : ["ice storm"],
			firstCol : 3
		}, {
			name : "6 charges",
			spells : ["simulacrum"],
			selection : ["simulacrum"],
			firstCol : 6
		}]),
		spellChanges : {
			"banishment" : KftGV_ShardSolitaire.spellChanges_banishment,
			"simulacrum" : {
				time : "1 a",
				description : "Create illusory duplicate of humanoid/beast; follows my verbal commands; has full HP, not half; See B",
				changes : "Cast as 1 action and the duplicate created by the spell has the same number of hit points as the creature it imitates."
			}
		}
	},
	"jacinth" : {
		descriptionFull : KftGV_ShardSolitaire.descriptionFull + "The jacinth shard solitaire can be used to cast the following spells: Banishment (3 charges; the target is banished to the stone's extradimensional space for the spell's duration), Mirror Image (1 charge), Fireball (2 charges), Fire Storm (6 charges).",
		action : [["bonus action", "Jacinth (Shard Step)"]],
		spellFirstColTitle : "Ch",
		spellcastingBonus : KftGV_ShardSolitaire.spellcastingBonus.concat([{
			name : "2 charges",
			spells : ["fireball"],
			selection : ["fireball"],
			firstCol : 2
		}, {
			name : "6 charges",
			spells : ["fire storm"],
			selection : ["fire storm"],
			firstCol : 6
		}]),
		spellChanges : {
			"banishment" : KftGV_ShardSolitaire.spellChanges_banishment
		}
	},
	"rainbow pearl" : {
		descriptionFull : KftGV_ShardSolitaire.descriptionFull + "The rainbow pearl shard solitaire can be used to cast the following spells: Banishment (3 charges; the target is banished to the stone's extradimensional space for the spell's duration), Mirror Image (1 charge), Prismatic Spray (6 charges), Water Breathing (2 charges).",
		action : [["bonus action", "Rainbow Pearl (Shard Step)"]],
		spellFirstColTitle : "Ch",
		spellcastingBonus : KftGV_ShardSolitaire.spellcastingBonus.concat([{
			name : "6 charges",
			spells : ["prismatic spray"],
			selection : ["prismatic spray"],
			firstCol : 6
		}, {
			name : "2 charges",
			spells : ["water breathing"],
			selection : ["water breathing"],
			firstCol : 2
		}]),
		spellChanges : {
			"banishment" : KftGV_ShardSolitaire.spellChanges_banishment
		}
	},
	"ruby" : {
		descriptionFull : KftGV_ShardSolitaire.descriptionFull + "The ruby shard solitaire can be used to cast the following spells: Banishment (3 charges; the target is banished to the stone's extradimensional space for the spell's duration), Mirror Image (1 charge), Fly (2 charges), Teleport (6 charges).",
		action : [["bonus action", "Ruby (Shard Step)"]],
		spellFirstColTitle : "Ch",
		spellcastingBonus : KftGV_ShardSolitaire.spellcastingBonus.concat([{
			name : "2 charges",
			spells : ["fly"],
			selection : ["fly"],
			firstCol : 2
		}, {
			name : "6 charges",
			spells : ["teleport"],
			selection : ["teleport"],
			firstCol : 6
		}]),
		spellChanges : {
			"banishment" : KftGV_ShardSolitaire.spellChanges_banishment
		}
	}
};

// pub_20230815_GotG.js
// This file adds the player-material from Bigby Presents: Glory of the Giants to MPMB's Character Record Sheet

SourceList["GotG"] = {
	name : "Bigby Presents: Glory of the Giants",
	abbreviation : "GotG",
	group : "Primary Sources",
	url : "https://www.dndbeyond.com/marketplace/sourcebooks/bigby-presents-glory-of-the-giants",
	date : "2023/08/15"
};

AddSubClass("barbarian", "giant", {
	regExpSearch : /^((?=.*(marauder|barbarian|viking|(norse|tribes?|clans?)(wo)?m(a|e)n))|((?=.*(warrior|fighter))(?=.*(feral|tribal))))(?=.*giant).*$/i,
	subname : "Path of the Giant",
	source : [["GotG", 11]],
	abilitySave : 1,
	spellcastingAbility : 5,
	features : {
		"subclassfeature3" : {
			name : "Giant Power",
			source : [["GotG", 11]],
			minlevel : 3,
			description : desc("I learn Giant, and the Druidcraft or Thaumaturgy cantrip with Wis as spellcasting ability"),
			languageProfs : ["Giant"],
			spellcastingBonus : [{
				name : "Giant Power",
				spells : ["druidcraft", "thaumaturgy"],
				firstCol : "atwill"
			}]
		},
		"subclassfeature3.1" : {
			name : "Giant's Havoc",
			source : [["GotG", 11]],
			minlevel : 3,
			description : levels.map(function (n) {
				return desc([
					"While raging, I add the bonus damage to ranged thrown weapon attacks that use Str,",
					"I gain +" + (n < 14 ? 5 : 10) + " ft reach, and I can become " + (n < 14 ? 'Large' : 'Huge') + " along with what I'm wearing, if there is room"
				]);
			})
		},
		"subclassfeature6" : {
			name : "Elemental Cleaver",
			source : [["GotG", 11]],
			minlevel : 6,
			description : levels.map(function (n) {
				return desc([
					"When I rage, I can infuse a weapon I'm holding with acid, cold, fire, thunder, or lightning",
					"While raging, its damage type changes to the chosen type and it deals +" + (n < 14 ? 1 : 2) + "d6 damage,",
					"it gains the thrown (20/60 ft) property, and reappears instantly after a thrown attack",
					"As a bonus action, I can change the chosen type; The bonuses only function for me"
				]);
			}),
			action : [["bonus action", " (change type)"]],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if ((v.isMeleeWeapon || v.isRangedWeapon) && classes.known.barbarian && classes.known.barbarian.level && /^(?=.*elemental)(?=.*cleaver).*$/i.test(v.WeaponTextName)) {
							fields.Damage_Type = "Varies";
							var isThrownWeapon = /\bthrown\b/i.test(v.WeaponText);
							var extraDmg = classes.known.barbarian.level < 14 ? '+1d6 damage' : '+2d6 damage';
							var extraProp = v.isRangedWeapon && !isThrownWeapon ? 'Thrown (20/60 ft), returning; ' : isThrownWeapon ? 'Returning; ' : 'Thrown, returning; ';
							var hasRange = /\d+ ?(f.{0,2}t|m)/i.test(fields.Range);
							if (!hasRange) {
								fields.Range += ', 20/60 ft';
							} else if ((!v.isRangedWeapon || isThrownWeapon) && hasRange) {
								var rangeNmbr = fields.Range.match(/\d+([.,]\d+)?/g);
								if (rangeNmbr.length === 1) {
									var longRange = Number(rangeNmbr[0].replace(',', '.'));
									if (longRange < 60) tempRange = fields.Range.replace(longRange,"long_range");
								} else {
									var shortRange = Number(rangeNmbr[0].replace(',', '.'));
									var longRange = Number(rangeNmbr[1].replace(',', '.'));
									tempRange = fields.Range;
									if (shortRange < 20) tempRange = tempRange.replace(shortRange,"short_range");
									if (longRange < 60) tempRange = tempRange.replace(longRange,"long_range");
								}
								fields.Range = tempRange.replace("short_range", 20).replace("long_range", 60);
							}
							fields.Description += (fields.Description ? '; ' : '') + extraProp + extraDmg;
						}
					},
					"If I include the words 'Elemental Cleaver' in a weapon's name, the Elemental Cleaver infused weapon properties will be added to it and its damage type will be set to 'Varies'. Also, my Rage's bonus damage will be added to it if it is a melee weapon that uses Strength."
				],
				atkCalc : [
					function (fields, v, output) {
						if (v.isMeleeWeapon && fields.Mod === 1 && classes.known.barbarian && classes.known.barbarian.level && /^(?!.*\brage\b)(?=.*elemental)(?=.*cleaver).*$/i.test(v.WeaponTextName)) {
							output.extraDmg += classes.known.barbarian.level < 9 ? 2 : classes.known.barbarian.level < 16 ? 3 : 4;
						}
					},
					""
				]
			}
		},
		"subclassfeature10" : {
			name : "Mighty Impel",
			source : [["GotG", 12]],
			minlevel : 10,
			description : levels.map(function (n) {
				return " [DC 8 + Prof Bonus + Str mod]" + desc([
					"As a bonus action while raging, I can hurl a " + (n < 14 ? 'Medium' : 'Large') + " or smaller creature within my reach",
					"I move it to an empty space I can see within 30 ft; Unwilling can save to avoid this",
					"If it doesn't end this movement on a surface that can support it, it falls and lands prone"
				]);
			}),
			action : [["bonus action", " (in rage)"]]
		},
		"subclassfeature14" : {
			name : "Demiurgic Colossus",
			source : [["GotG", 12]],
			minlevel : 14,
			description : desc([
				"While raging, my reach increases by 10 ft, and my size can increase to Huge",
				"Mighty Impel works on Large creatures; Elemental Cleaver increases to +2d6 damage",
			])
		}
	}
});

BackgroundList["giant foundling"] = {
	regExpSearch : /^(?=.*giant)(?=.*foundling).*$/i,
	name : "Giant Foundling",
	source : [["GotG", 12]],
	skills : ["Intimidation", "Survival"],
	gold : 10,
	languageProfs : ["Giant", 1],
	equipleft : [
		["Backpack", "", 5],
		["Small stone/sprig from home", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Pouch (with coins)", "", 1]
	],
	feature : "Strike of the Giants",
	trait : [
		"What I lack in stature compared to giants, I make up for with sheer spite.",
		"I insist on being taken seriously as a full-grown adult. Nobody talks down to me!",
		"Crowded spaces make me uncomfortable. I'd much rather be in an open field than a bustling tavern.",
		"I embrace my shorter stature. It helps me stay unnoticed\u2014and underestimated.",
		"Every avalanche begins as a single pebble.",
		"The world always feels too big, and I'm afraid I'll never find my place in it."
	],
	extra : [
		"Choose an Origin Story",
		"Found as a baby",
		"Rescued by stone giants",
		"Lost in the jungle with frost giant",
		"Family killed in war of giants",
		"Studied with storm giant oracle",
		"Adopted by cloud giant"
	]
};
BackgroundFeatureList["strike of the giants"] = {
	description : "I grew up among giants or where they lived. Something about this environment\u2014the food, water, elemental magic, or some blessing\u2014caused me to grow to a remarkable size for my kind. I'm used to moving through a world much bigger than I, and that is reflected in my skills, attitude, and perspective on life. I gain the Strike of the Giants feat.",
	source : [["GotG", 13], ["UA:WotM", 4]],
	eval : function() { AddFeat("Strike of the Giants"); },
	removeeval : function() { RemoveFeat("Strike of the Giants"); }
};

BackgroundList["rune carver"] = {
	regExpSearch : /^(?=.*rune)(?=.*carver).*$/i,
	name : "Rune Carver",
	source : [["GotG", 14]],
	skills : ["History", "Perception"],
	gold : 10,
	toolProfs : [["Artisan's tools", 1]],
	languageProfs : ["Giant"],
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Small knife", "", 0.5],
		["Whetstone", "", 1]
	],
	equipright : [
		["Common clothes", "", 3],
		["Pouch (with coins)", "", 1]
	],
	feature : "Rune Shaper",
	trait : [
		"Is it practical to learn an ancient language that is rarely spoken? No. But is it fun? Very.",
		"I learned one of my ancestors was a lauded rune carver whose story was lost to time. I seek to rekindle that legacy.",
		"The old, traditional markings of runecraft look so boring. Why not give my runes some flair?",
		"In my studies of runes, I strive to understand how great civilizations of the past fell, so I can prevent it from happening to societies of the present.",
		"Life may be a whirlwind of chaos, but whenever I create my runes, I feel at peace.",
		"My brain struggles to process words written in ink, but the feeling of carved runes makes my mind sing."
	],
	extra : [
		"Choose a Rune Style",
		"Needle in wax/clay",
		"Whittle wooden figurines",
		"Engraved glass beads",
		"Stitched into hems of clothing",
		"Carved animal bones",
		"Drawn into candles"
	]
};
BackgroundFeatureList["rune shaper"] = {
	description : "I've dedicated my life to studying runecraft, taught by a master rune carver or learned by poring over ancient engravings. I can tap into the supernatural power held within runes. The art of runecraft has been adopted by many outside of giant society and those often incorporate their native language among the Giant runes. I gain the Rune Shaper feat.",
	source : [["GotG", 14]],
	eval : function() { AddFeat("Rune Shaper"); },
	removeeval : function() { RemoveFeat("Rune Shaper"); }
};

// Feats - first the Strike of the Giants tree
FeatsList["strike of the giants"] = {
	name : "Strike of the Giants",
	source : [["GotG", 19]],
	prerequisite : "Martial weapon proficiency or Giant Foundling background",
	prereqeval : function (v) {
		return v.martialWeaponsProf || CurrentBackground.known.indexOf('giant foundling') !== -1 || /strike of the giants/i.test(What("Background Feature"));
	},
	descriptionFull : "You have absorbed primeval magic that gives you an echo of the might of giants. When you take this feat, choose one of the benefits listed below. Once per turn, when you hit a target with a melee weapon attack or a ranged weapon attack using a thrown weapon, you can imbue the attack with an additional effect depending on the benefit you chose:"+
	"\n   " + toUni("Cloud Strike") + ". The target takes an extra 1d4 thunder damage. If the target is a creature, it must succeed on a Wisdom saving throw, or you become invisible to it until the start of your next turn or until immediately after you make an attack roll or cast a spell."+
	"\n   " + toUni("Fire Strike") + ". The target takes an extra 1d10 fire damage."+
	"\n   " + toUni("Frost Strike") + ". The target takes an extra 1d6 cold damage. If the target is a creature, it must succeed on a Constitution saving throw, or its speed is reduced to 0 until the start of your next turn."+
	"\n   " + toUni("Hill Strike") + ". The target takes an extra 1d6 damage of the weapon's type. If the target is a creature, it must succeed on a Strength saving throw or have the prone condition."+
	"\n   " + toUni("Stone Strike") + ". The target takes an extra 1d6 force damage. If the target is a creature, it must succeed on a Strength saving throw or be pushed 10 feet from you in a straight line."+
	"\n   " + toUni("Storm Strike") + ". The target takes an extra 1d6 lightning damage. If the target is a creature, it must succeed on a Constitution saving throw, or it has disadvantage on attack rolls until the start of your next turn."+
	"\n   The saving throw DC for these effects equals 8 + your proficiency bonus + your Strength or Constitution modifier."+
	"\n   You can use this feat a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	description : "",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest",
	choices : ["Cloud Strike", "Fire Strike", "Frost Strike", "Hill Strike", "Stone Strike", "Storm Strike"],
	"cloud strike" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'Once per turn, when I hit with a melee weapon attack or thrown weapon, the target takes +1d4 thunder damage. It must then make a Wis save DC ' + ( 8 + iProfB + Math.max( Number(What('Str Mod')), Number(What('Con Mod')) ) ) + ' (8 + Prof Bonus + Str/Con mod) or I become invisible to it until my next turn starts, I make an attack, or I cast a spell. I can do this ' + iProfB + ' (Prof Bonus) times per long rest.';"
	},
	"fire strike" : {
		description : "I have absorbed primeval magic that gives me an echo of the might of giants. Once per turn when I hit with a melee weapon attack or thrown weapon, the target takes +1d10 fire damage. I can do this a number of times per long rest equal to my proficiency bonus."
	},
	"frost strike" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'Once per turn, when I hit with a melee weapon attack or thrown weapon, the target takes +1d6 cold damage. It must then make a Con save DC ' + (8 + iProfB + Math.max(Number(What('Str Mod')), Number(What('Con Mod')))) + ' (8 + Prof Bonus + Str/Con mod) or its speed is reduced to 0 until my next turn starts. I can do this ' + iProfB + ' (Prof Bonus) times per long rest.';"
	},
	"hill strike" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'Once per turn, when I hit with a melee weapon attack or thrown weapon, the target takes +1d6 damage. It must then make a Str save DC ' + (8 + iProfB + Math.max(Number(What('Str Mod')), Number(What('Con Mod')))) + ' (8 + Prof Bonus + Str/Con mod) or be knocked prone. I can do this ' + iProfB + ' (Prof Bonus) times per long rest.';"
	},
	"stone strike" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'Once per turn, when I hit with a melee weapon attack or thrown weapon, the target takes +1d6 force damage. It must then make a Wis save DC ' + (8 + iProfB + Math.max(Number(What('Str Mod')), Number(What('Con Mod')))) + ' (8 + Prof Bonus + Str/Con mod) or be pushed 10 ft away from me in a straight line. I can do this ' + iProfB + ' (Prof Bonus) times per long rest.';"
	},
	"storm strike" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'Once per turn, when I hit with a melee weapon attack or thrown weapon, the target takes +1d6 lightning damage. It must then make a Con save DC ' + (8 + iProfB + Math.max(Number(What('Str Mod')), Number(What('Con Mod')))) + ' (8 + Prof Bonus + Str/Con mod) or it gets disadvantage on attack rolls until my next turn starts. I can do this ' + iProfB + ' (Prof Bonus) times per long rest.';"
	}
}
FeatsList["ember of the fire giant"] = {
	name : "Ember of the Fire Giant",
	source : [["GotG", 17]],
	prerequisite : "4th level, Strike of the Giants (Fire Strike) feat",
	prereqeval : function(v) {
		var iStrikeGiants = CurrentFeats.known.indexOf("strike of the giants");
		return v.characterLevel >= 4 && iStrikeGiants !== -1 && CurrentFeats.choices[iStrikeGiants] === 'fire strike';
	},
	descriptionFull : "You've manifested the fiery combat emblematic of fire giants, granting you the following benefits:"+
	"\n\n" + toUni("Ability Score Increase") + ". Increase your Strength, Constitution, or Wisdom by 1, to a maximum of 20."+
	"\n\n" + toUni("Born of Flame") + ". You have resistance to fire damage."+
	"\n" + toUni("Searing Ignition") + ". When you take the Attack action on your turn, you can replace a single attack with a magical burst of flame. Each creature of your choice in a 15-foot-radius sphere centered on you must make a Dexterity saving throw (DC equals 8 + your proficiency bonus + the modifier of the ability increased by this feat). On a failed save, a creature takes fire damage equal to 1d8 + your proficiency bonus, and it has the blinded condition until the start of your next turn. On a successful save, the creature takes half as much damage only. You can use your Searing Ignition a number of times equal to your proficiency bonus (but no more than once per turn), and you regain all expended uses when you finish a long rest.",
	description : "I get fire resistance. Prof B. per long rest, when I use the Attack action on my turn, I can replace one attack with Searing Ignition: Chosen targets in 15-ft radius sphere on me take 1d8 + Prof B. fire damage, blind until my next turn starts. Dex save DC 8 + Prof B. + Str/Con/Wis mod half damage, not blind. [+1 Str/Con/Wis]",
	extraLimitedFeatures : [{
		name : "Searing Ignition",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus');",
		recovery : "long rest"
	}],
	dmgres : ["Fire"],
	choices : ["Strength", "Constitution", "Wisdom"],
	"strength" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'I get fire resistance. ' + iProfB + '\xD7 (Prof) per long rest, when I use the Attack action on my turn, I can replace one attack with Searing Ignition: Chosen targets in 15-ft radius sphere on me take 1d8+' + iProfB + ' (Prof B.) fire damage, blinded until my next turn starts. Dex save DC ' + ( 8 + iProfB + Number(What('Str Mod')) ) + ' (8 + Prof B. + Str mod) halves damage, not blinded. [+1 Str]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*searing)(?=.*ignition).*$/i,
			name : "Searing Ignition",
			source : [["GotG", 17]],
			ability : 1,
			type : 'AlwaysProf',
			damage : [1, 8, 'fire'],
			range : "15-ft radius",
			description : "Affects only chosen targets; Dex save halves, otherwise blinded until my next turn starts",
			abilitytodamage : false,
			dc : true,
			isNotWeapon : true,
			modifiers : ["", "Prof"],
			selectNow : true
		}],
		scores : [1,0,0,0,0,0]
	},
	"constitution" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'I get fire resistance. ' + iProfB + '\xD7 (Prof) per long rest, when I use the Attack action on my turn, I can replace one attack with Searing Ignition: Chosen targets in 15-ft radius sphere on me take 1d8+' + iProfB + ' (Prof B.) fire damage, blinded until my next turn starts. Dex save DC ' + ( 8 + iProfB + Number(What('Con Mod')) ) + ' (8 + Prof B. + Con mod) halves damage, not blinded. [+1 Con]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*searing)(?=.*ignition).*$/i,
			name : "Searing Ignition",
			source : [["GotG", 17]],
			ability : 3,
			type : 'Magical',
			damage : [1, 8, 'fire'],
			range : "15-ft radius",
			description : "Affects only chosen targets; Dex save halves, otherwise blinded until my next turn starts",
			abilitytodamage : false,
			dc : true,
			isNotWeapon : true,
			modifiers : ["", "Prof"],
			selectNow : true
		}],
		scores : [0,0,1,0,0,0]
	},
	"wisdom" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'I get fire resistance. ' + iProfB + '\xD7 (Prof) per long rest, when I use the Attack action on my turn, I can replace one attack with Searing Ignition: Chosen targets in 15-ft radius sphere on me take 1d8+' + iProfB + ' (Prof B.) fire damage, blinded until my next turn starts. Dex save DC ' + ( 8 + iProfB + Number(What('Wis Mod')) ) + ' (8 + Prof B. + Wis mod) halves damage, not blinded. [+1 Wis]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*searing)(?=.*ignition).*$/i,
			name : "Searing Ignition",
			source : [["GotG", 17]],
			ability : 5,
			type : 'Magical',
			damage : [1, 8, 'fire'],
			range : "15-ft radius",
			description : "Affects only chosen targets; Dex save halves, otherwise blinded until my next turn starts",
			abilitytodamage : false,
			dc : true,
			isNotWeapon : true,
			modifiers : ["", "Prof"],
			selectNow : true
		}],
		scores : [0,0,0,0,1,0]
	}
};
FeatsList["fury of the frost giant"] = {
	name : "Fury of the Frost Giant",
	source : [["GotG", 17]],
	prerequisite : "4th level, Strike of the Giants (Frost Strike) feat",
	prereqeval : function(v) {
		var iStrikeGiants = CurrentFeats.known.indexOf("strike of the giants");
		return v.characterLevel >= 4 && iStrikeGiants !== -1 && CurrentFeats.choices[iStrikeGiants] === 'frost strike';
	},
	descriptionFull : "You've manifested the icy might emblematic of frost giants, granting you the following benefits:"+
	"\n\n" + toUni("Ability Score Increase") + ". Increase your Strength, Constitution, or Wisdom by 1, to a maximum of 20."+
	"\n\n" + toUni("Born of Ice") + ". You have resistance to cold damage."+
	"\n" + toUni("Frigid Retaliation") + ". Immediately after a creature you can see within 30 feet of you hits you with an attack roll and deals damage, you can use your reaction to retaliate with a conjured blast of ice. The creature must make a Constitution saving throw (DC equals 8 + your proficiency bonus + the modifier of the ability increased by this feat). On a failed save, the creature takes cold damage equal to 1d8 + your proficiency bonus, and its speed is reduced to 0 until the end of its next turn. You can use this reaction a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	description : "I gain cold resistance. As a reaction when a creature I see within 30 ft damages me with an attack, I can, Prof B. times per long rest, use Frigid Retaliation: it must make a Con save DC 8 + Prof B. + Str/Con/Wis mod or take 1d8 + Prof B. cold damage and have speed 0 until its next turn ends. [+1 Str/Con/Wis]",
	action : [["reaction", "Frigid Retaliation"]],
	extraLimitedFeatures : [{
		name : "Frigid Retaliation",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus');",
		recovery : "long rest"
	}],
	dmgres : ["Cold"],
	choices : ["Strength", "Constitution", "Wisdom"],
	"strength" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'I gain cold resistance. As a reaction when a creature I see within 30 ft hits me with an attack roll and deals damage, I can, ' + iProfB + ' times (Prof B.) per long rest, use Frigid Retaliation: it must make a Con save DC ' + ( 8 + iProfB + Number(What('Str Mod')) ) + ' (8 + Prof B. + Str mod) or take 1d8+' + iProfB + ' (Prof B.) cold damage and have speed 0 until its next turn ends. [+1 Str]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*frigid)(?=.*retaliation).*$/i,
			name : "Frigid Retaliation",
			source : [["GotG", 17]],
			ability : 1,
			type : 'Magical',
			damage : [1, 8, 'cold'],
			range : "30 ft",
			description : "Reaction; Con save - success: no damage, fail: also 0 speed until target's next turn ends",
			abilitytodamage : false,
			dc : true,
			isNotWeapon : true,
			modifiers : ["", "Prof"],
			selectNow : true
		}],
		scores : [1,0,0,0,0,0]
	},
	"constitution" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'I gain cold resistance. As a reaction when a creature I see within 30 ft hits me with an attack roll and deals damage, I can, ' + iProfB + ' times (Prof B.) per long rest, use Frigid Retaliation: it must make a Con save DC ' + ( 8 + iProfB + Number(What('Con Mod')) ) + ' (8 + Prof B. + Con mod) or take 1d8+' + iProfB + ' (Prof B.) cold damage and have speed 0 until its next turn ends. [+1 Con]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*frigid)(?=.*retaliation).*$/i,
			name : "Frigid Retaliation",
			source : [["GotG", 17]],
			ability : 3,
			type : 'Magical',
			damage : [1, 8, 'cold'],
			range : "30 ft",
			description : "Reaction; Con save - success: no damage, fail: also 0 speed until target's next turn ends",
			abilitytodamage : false,
			dc : true,
			isNotWeapon : true,
			modifiers : ["", "Prof"],
			selectNow : true
		}],
		scores : [0,0,1,0,0,0]
	},
	"wisdom" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'I gain cold resistance. As a reaction when a creature I see within 30 ft hits me with an attack roll and deals damage, I can, ' + iProfB + ' times (Prof B.) per long rest, use Frigid Retaliation: it must make a Con save DC ' + ( 8 + iProfB + Number(What('Wis Mod')) ) + ' (8 + Prof B. + Wis mod) or take 1d8+' + iProfB + ' (Prof B.) cold damage and have speed 0 until its next turn ends. [+1 Wis]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*frigid)(?=.*retaliation).*$/i,
			name : "Frigid Retaliation",
			source : [["GotG", 17]],
			ability : 5,
			type : 'Magical',
			damage : [1, 8, 'cold'],
			range : "30 ft",
			description : "Reaction; Con save - success: no damage, fail: also 0 speed until target's next turn ends",
			abilitytodamage : false,
			dc : true,
			isNotWeapon : true,
			modifiers : ["", "Prof"],
			selectNow : true
		}],
		scores : [0,0,0,0,1,0]
	}
};
FeatsList["guile of the cloud giant"] = {
	name : "Guile of the Cloud Giant",
	source : [["GotG", 18]],
	prerequisite : "4th level, Strike of the Giants (Cloud Strike) feat",
	prereqeval : function(v) {
		var iStrikeGiants = CurrentFeats.known.indexOf("strike of the giants");
		return v.characterLevel >= 4 && iStrikeGiants !== -1 && CurrentFeats.choices[iStrikeGiants] === 'cloud strike';
	},
	descriptionFull : "You've manifested the confounding magic emblematic of cloud giants, granting you the following benefits:"+
	"\n\n" + toUni("Ability Score Increase") + ". Increase your Strength, Constitution, or Charisma by 1, to a maximum of 20."+
	"\n\n" + toUni("Cloudy Escape") + ". When a creature you can see hits you with an attack roll, you can use your reaction to give yourself resistance to that attack's damage. You then teleport to an unoccupied space that you can see within 30 feet of yourself. You can use this reaction a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	description : "As a reaction when a creature I see within 30 ft hits me with an attack roll, I can give myself resistance to that attack's damage. I then teleport to an unoccupied space that I can see within 30 ft. I can do this reaction my proficiency bonus times per long rest.",
	action : [["reaction", "Cloudy Escape"]],
	extraLimitedFeatures : [{
		name : "Cloudy Escape",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus');",
		recovery : "long rest"
	}],
	choices : ["Strength", "Constitution", "Charisma"],
	"strength" : {
		description : "As a reaction when a creature I see within 30 ft hits me with an attack roll, I can use Cloudy Escape: I give myself resistance to that attack's damage and then I teleport to an unoccupied space that I can see within 30 ft. I can do this Proficiency Bonus per long rest. [+1 Strength]",
		scores : [1,0,0,0,0,0]
	},
	"constitution" : {
		description : "As a reaction when a creature I see within 30 ft hits me with an attack roll, I can use Cloudy Escape: I give myself resistance to that attack's damage and then I teleport to an unoccupied space that I can see within 30 ft. I can do this Proficiency Bonus per long rest. [+1 Constitution]",
		scores : [0,0,1,0,0,0]
	},
	"charisma" : {
		description : "As a reaction when a creature I see within 30 ft hits me with an attack roll, I can use Cloudy Escape: I give myself resistance to that attack's damage and then I teleport to an unoccupied space that I can see within 30 ft. I can do this Proficiency Bonus per long rest. [+1 Charisma]",
		scores : [0,0,0,0,0,1]
	}
};
FeatsList["keenness of the stone giant"] = {
	name : "Keenness of the Stone Giant",
	source : [["GotG", 18]],
	prerequisite : "4th level, Strike of the Giants (Stone Strike) feat",
	prereqeval : function(v) {
		var iStrikeGiants = CurrentFeats.known.indexOf("strike of the giants");
		return v.characterLevel >= 4 && iStrikeGiants !== -1 && CurrentFeats.choices[iStrikeGiants] === 'stone strike';
	},
	descriptionFull : "You've manifested the physical talents emblematic of stone giants, granting you the following benefits:"+
	"\n\n" + toUni("Ability Score Increase") + ". Increase your Strength, Constitution, or Wisdom by 1, to a maximum of 20."+
	"\n\n" + toUni("Cavernous Sight") + ". You gain darkvision with a range of 60 feet. If you already have darkvision from another source, its range increases by 60 feet."+
	"\n" + toUni("Stone Throw") + ". As a bonus action, you can take a rock and make a magical attack with it. The attack is a ranged spell attack with a range of 60 feet that uses the ability score you increased with this feat as the spellcasting ability. On a hit, the rock deals 1d10 force damage, and the target must succeed on a Strength saving throw (DC equals 8 + your proficiency bonus + the spellcasting ability modifier) or have the prone condition. You can use this bonus action a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	description : "I gain +60 ft Darkvision. As a bonus action, Prof Bonus times per long rest, I can make a magical Stone Throw attack. It is a spell attack with 60 ft range that deals 1d10 force damage and the target hit must make a Str save or be knocked prone. This uses the ability increased as spellcasting ability. [+1 Str/Con/Wis]",
	vision : [["Darkvision", "fixed 60"], ["Darkvision", "+60"]],
	action : [["bonus action", "Stone Throw"]],
	extraLimitedFeatures : [{
		name : "Stone Throw",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus');",
		recovery : "long rest"
	}],
	choices : ["Strength", "Constitution", "Wisdom"],
	"strength" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')), iMod = Number(What('Str')); event.value = 'I gain +60 ft Darkvision. As a bonus action, ' + iProfB + ' (Prof Bonus) times per long rest, I can make a magical Stone Throw attack: a spell attack (+' + (iProfB + iMod) + ') with 60 ft range that deals 1d10 force damage and the target hit must make a Strength save (DC ' + (8 + iProfB + iMod) + ') or be knocked prone. This uses Strength as spellcasting ability. [+1 Strength]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*stone)(?=.*throw).*$/i,
			name : "Stone Throw",
			source : [["GotG", 18]],
			ability : 1,
			type : 'Spell',
			damage : [1, 10, 'force'],
			range : "60 ft",
			description : "Bonus action; Target Strength save (DC 8 + To Hit) or be knocked prone",
			abilitytodamage : false,
			selectNow : true
		}],
		scores : [1,0,0,0,0,0]
	},
	"constitution" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')), iMod = Number(What('Con')); event.value = 'I gain +60 ft Darkvision. As a bonus action, ' + iProfB + ' (Prof Bonus) times per long rest, I can make a magical Stone Throw attack: a spell attack (+' + (iProfB + iMod) + ') with 60 ft range that deals 1d10 force damage and the target hit must make a Strength save (DC ' + (8 + iProfB + iMod) + ') or be knocked prone. This uses Constitution as spellcasting ability. [+1 Con]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*stone)(?=.*throw).*$/i,
			name : "Stone Throw",
			source : [["GotG", 18]],
			ability : 3,
			type : 'Spell',
			damage : [1, 10, 'force'],
			range : "60 ft",
			description : "Bonus action; Target Strength save (DC 8 + To Hit) or be knocked prone",
			abilitytodamage : false,
			selectNow : true
		}],
		scores : [0,0,1,0,0,0]
	},
	"wisdom" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')), iMod = Number(What('Wis')); event.value = 'I gain +60 ft Darkvision. As a bonus action, ' + iProfB + ' (Prof Bonus) times per long rest, I can make a magical Stone Throw attack: a spell attack (+' + (iProfB + iMod) + ') with 60 ft range that deals 1d10 force damage and the target hit must make a Strength save (DC ' + (8 + iProfB + iMod) + ') or be knocked prone. This uses Wisdom as spellcasting ability. [+1 Wisdom]';",
		weaponOptions : [{
			regExpSearch : /^(?=.*stone)(?=.*throw).*$/i,
			name : "Stone Throw",
			source : [["GotG", 18]],
			ability : 5,
			type : 'Spell',
			damage : [1, 10, 'force'],
			range : "60 ft",
			description : "Bonus action; Target Strength save (DC 8 + To Hit) or be knocked prone",
			abilitytodamage : false,
			selectNow : true
		}],
		scores : [0,0,0,0,1,0]
	}
};
FeatsList["soul of the storm giant"] = {
	name : "Soul of the Storm Giant",
	source : [["GotG", 19]],
	prerequisite : "4th level, Strike of the Giants (Storm Strike) feat",
	prereqeval : function(v) {
		var iStrikeGiants = CurrentFeats.known.indexOf("strike of the giants");
		return v.characterLevel >= 4 && iStrikeGiants !== -1 && CurrentFeats.choices[iStrikeGiants] === 'storm strike';
	},
	descriptionFull : "You've manifested the tempest magic emblematic of storm giants, granting you the following benefits:"+
	"\n\n" + toUni("Ability Score Increase") + ". Increase your Strength, Constitution, or Charisma by 1, to a maximum of 20."+
	"\n\n" + toUni("Maelstrom Aura") + ". As a bonus action, you surround yourself with an aura of magical wind and lightning that extends 10 feet from you in every direction but not through total cover. The aura lasts until the start of your next turn or until you are incapacitated. While the aura is active, you have resistance to lightning and thunder damage. In addition, attack rolls against you have disadvantage, and whenever another creature starts its turn within the aura, you can force the creature to make a Strength saving throw (DC equals 8 + your proficiency bonus + the modifier of the ability increased by this feat). On a failed save, the creature's speed is halved until the start of its next turn. You can use this bonus action a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	description : "As a bonus action, Prof B. per long rest, I can make a 10-ft radius Maelstrom Aura until my next turn starts: I get lightning/thunder resistance, attacks vs. me have disadv., I can force those starting their turn inside to a Str save DC 8 + Prof + Str/Con/Cha mod or halve their speed until their next turn starts. [+1 Str/Con/Cha]",
	action : [["bonus action", "Maelstrom Aura"]],
	extraLimitedFeatures : [{
		name : "Maelstrom Aura",
		usages : "Proficiency bonus per ",
		usagescalc : "event.value = How('Proficiency Bonus');",
		recovery : "long rest"
	}],
	choices : ["Strength", "Constitution", "Charisma"],
	"strength" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'As a bonus action, ' + iProfB + '\xD7 (Prof) per long rest, I can invoke a 10-ft radius Maelstrom Aura until my next turn starts: I get lightning \u0026 thunder resistance, attacks vs. me have disadv., I can force those starting their turn inside to make a Str save DC ' + ( 8 + iProfB + Number(What('Str Mod')) ) + ' (8+Prof+Str mod) or halve their speed until their next turn starts. [+1 Str]';",
		scores : [1,0,0,0,0,0]
	},
	"constitution" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'As a bonus action, ' + iProfB + '\xD7 (Prof) per long rest, I can invoke a 10-ft radius Maelstrom Aura until my next turn starts: I get lightning \u0026 thunder resistance, attacks vs. me have disadv., I can force those starting their turn inside to make a Str save DC ' + ( 8 + iProfB + Number(What('Con Mod')) ) + ' (8+Prof+Con mod) or halve their speed until their next turn starts. [+1 Con]';",
		scores : [0,0,1,0,0,0]
	},
	"charisma" : {
		description : "",
		calculate : "var iProfB = Number(How('Proficiency Bonus')); event.value = 'As a bonus action, ' + iProfB + '\xD7 (Prof) per long rest, I can invoke a 10-ft radius Maelstrom Aura until my next turn starts: I get lightning \u0026 thunder resistance, attacks vs. me have disadv., I can force those starting their turn inside to make a Str save DC ' + ( 8 + iProfB + Number(What('Cha Mod')) ) + ' (8+Prof+Cha mod) or halve their speed until their next turn starts. [+1 Cha]';",
		scores : [0,0,0,0,0,1]
	}
};
FeatsList["vigor of the hill giant"] = {
	name : "Vigor of the Hill Giant",
	source : [["GotG", 19]],
	prerequisite : "4th level, Strike of the Giants (Hill Strike) feat",
	prereqeval : function(v) {
		var iStrikeGiants = CurrentFeats.known.indexOf("strike of the giants");
		return v.characterLevel >= 4 && iStrikeGiants !== -1 && CurrentFeats.choices[iStrikeGiants] === 'hill strike';
	},
	descriptionFull : "You've manifested the resilience emblematic of hill giants, granting you the following benefits:"+
	"\n\n" + toUni("Ability Score Increase") + ". Increase your Strength, Constitution, or Wisdom by 1, to a maximum of 20."+
	"\n\n" + toUni("Bulwark") + ". When you are subjected to an effect that would move you at least 5 feet or give you the prone condition, you can use your reaction to steady yourself. You aren't moved and don't have the prone condition."+
	"\n" + toUni("Iron Stomach") + ". Whenever you eat food as part of a short rest and spend one or more Hit Dice to regain hit points, you regain additional hit points equal to your Constitution modifier + your proficiency bonus.",
	description : "Bulwark: When I would be moved or knocked prone I can use my reaction to prevent that. Iron Stomach: Whenever I eat food as part of a short rest and spend HD to regain hit points, I regain additional hp equal to my Constitution modifier + my proficiency bonus. [+1 Strength/Constitution/Wisdom]",
	action : [["reaction", "Bulwark"]],
	choices : ["Strength", "Constitution", "Wisdom"],
	"strength" : {
		description : "Bulwark: When I would be moved or knocked prone I can use my reaction to prevent that. Iron Stomach: Whenever I eat food as part of a short rest and spend HD to regain hit points, I regain additional hp equal to my Con" + (typePF ? "stitution" : "") + " modifier + my proficiency bonus. [+1 St" + (typePF ? "rength" : "") + "]",
		scores : [1,0,0,0,0,0]
	},
	"constitution" : {
		description : "Bulwark: When I would be moved or knocked prone I can use my reaction to prevent that. Iron Stomach: Whenever I eat food as part of a short rest and spend HD to regain hit points, I regain additional hp equal to my Con" + (typePF ? "stitution" : "") + " modifier + my proficiency bonus. [+1 Con" + (typePF ? "stitution" : "") + "]",
		scores : [0,0,1,0,0,0]
	},
	"wisdom" : {
		description : "Bulwark: When I would be moved or knocked prone I can use my reaction to prevent that. Iron Stomach: Whenever I eat food as part of a short rest and spend HD to regain hit points, I regain additional hp equal to my Con" + (typePF ? "stitution" : "") + " modifier + my proficiency bonus. [+1 Wis" + (typePF ? "dom" : "") + "]",
		scores : [0,0,0,0,1,0]
	}
};
// Feats - Rune Shaper
var GotG_RuneShaper = [
	"You've studied the magic of Giant runes, granting you the following benefits:",
	">>Comprehend Languages<<. You learn the comprehend languages spell. You can cast this spell without expending a spell slot, and you must finish a long rest before you can cast it in this way again. You can also cast this spell using any spell slots you have.",
	">>Rune Magic<<. You know a number of runes equal to half your proficiency bonus (rounded down), chosen from the Rune Spells table. Whenever you finish a long rest, you can inscribe each rune you know onto one nonmagical weapon, armor, piece of clothing, or other object you touch. You temporarily learn the 1st-level spells that correspond to the runes you inscribed, as specified on the Rune Spells table, and you know those spells until you finish a long rest, when the runes fade. While you are wearing or carrying any rune-marked object, you can cast the spells associated with those runes using any spell slots you have.",
	"You can also invoke a rune inscribed on an object you are wearing or carrying and cast its associated spell without expending a spell slot or using material components. Once you cast the spell in this way, you can't do so again until you finish a long rest. Your spellcasting ability for this feat is Intelligence, Wisdom, or Charisma (choose when you select this feat).",
	"Each time you gain a level, you can replace one of the runes you know with another one from the Rune Spells table below.\n",
	">>Rune\tSpell<<",
	"Cloud\tFog Cloud",
	"Death\tInflict Wounds",
	"Dragon\tChromatic Orb",
	"Enemy\tDisguise Self",
	"Fire\tBurning Hands",
	"Friend\tSpeak with Animals",
	"Frost\tArmor of Agathys",
	"Hill\tGoodberry",
	"Journey\tLongstrider",
	"King\tCommand",
	"Mountain\tEntangle",
	"Stone\tSanctuary",
	"Storm\tThunderwave"
];
FeatsList["rune shaper"] = {
	name : "Rune Shaper",
	source : [["GotG", 18]],
	prerequisite : "Spellcasting feature or Rune Carver background",
	prereqeval : function(v) { return v.isSpellcastingClass || CurrentBackground.known.indexOf('rune carver') !== -1 || /rune shaper/i.test(What("Background Feature")); },
	descriptionFull : GotG_RuneShaper.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	description : "I know half my Prof Bonus, rounded down, in runes. After a long rest, I can inscribe each rune on a nonmagical objects I touch. It lasts until my next long rest. I can cast Comprehend Languages and each inscribed rune's spell once per long rest without a spell slot or material components, or by using spell slots. See Notes.",
	spellcastingAbility : [4, 5, 6],
	spellcastingBonus : [{
		name : "Comprehend languages",
		spells : ["comprehend languages"],
		selection : ["comprehend languages"],
		allowUpCasting : true,
		// checkbox first column to check of when used once per long rest without a spell slot
		spellFirstColTitle : "1\xD7",
		firstCol : "checkbox"
	}, {
		name : "Runes",
		spells : ["fog cloud", "inflict wounds", "chromatic orb", "disguise self", "burning hands", "speak with animals", "armor of agathys", "goodberry", "longstrider", "command", "entangle", "sanctuary", "thunderwave"],
		allowUpCasting : true,
		// checkbox first column to check of when used once per long rest without a spell slot
		spellFirstColTitle : "1\xD7",
		firstCol : "checkbox",
		linkTimesToHalfProf : true, // custom attribute, can be used as an exsee changeeval & calcChanges.spellList
		times : 1 // half proficiency bonus, so always minimum of 1
	}],
	changeeval : function() {
		if (!CurrentSpells['rune shaper']) return;
		// See if the proficiency bonus changed to trigger the changes dialog
		// Don't set the times attribute here, but instead on every call to the spell dialog
		var halfProf = Math.floor( Number(How('Proficiency Bonus')) / 2 );
		if (CurrentSpells['rune shaper'].halfProf != halfProf) {
			CurrentSpells['rune shaper'].halfProf = halfProf;
			CurrentUpdates.types.push("spells");
		}
	},
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// Change the times attribute to be half proficiency, rounded down
				// Do it this way, so it is updated even if a bonus to proficiency was manually applied
				if (spName === 'rune shaper' && spType === 'feat-bonus' && spList.name === "Comprehend languages") {
					var halfProf = Math.floor( Number(How('Proficiency Bonus')) / 2 );
					CurrentSpells['rune shaper'].halfProf = halfProf;
					for (var key in CurrentSpells[spName].bonus) {
						var aBonus = CurrentSpells['rune shaper'].bonus[key];
						if (!isArray(aBonus)) aBonus = [aBonus];
						for (var i = 0; i < aBonus.length; i++) {
							if (aBonus[i].linkTimesToHalfProf) {
								aBonus[i].times = halfProf;
							}
						}
					}
					
				}
			},
			""
		]
	},
	toNotesPage : [{
		name : "Features",
		note : desc(GotG_RuneShaper).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/Your/g, "My").replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(contact|granting) you/ig, "$1 me").replace(/you /ig, "I ")
	}]
};

CreatureList["spotted lion"] = {
	name : "Spotted Lion",
	nameAlt : ["Lion, Spotted"],
	source : [["GotG", 177]],
	size : 1,
	type : "Beast",
	alignment : "Unaligned",
	ac : 15,
	hp : 66,
	hd : [7, 12],
	speed : "60 ft",
	scores : [23, 14, 17, 5, 13, 10],
	skills : {
		"perception" : 5,
		"stealth" : 6
	},
	senses : "Darkvision 60 ft",
	passivePerception : 15,
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Rend",
		ability : 1,
		damage : [2, 8, "piercing"],
		range : "Melee (10 ft)",
		description : "Bonus action on prone target; If used after 20 ft straight move, see Pounce trait",
		tooltip : "If the lion moved at least 20 ft straight toward the target immediately before hitting it, the target must succeed on a DC 16 Strength saving throw or have the prone condition. If the target has the prone condition, the lion can make another Rend attack against it as a bonus action."
	}],
	traits : [{
		name : "Pack Tactics",
		description : "The lion has advantage on an attack roll against a creature if at least one of the lion's allies is within 5 feet of the target and the ally doesn't have the incapacitated condition."
	}, {
		name : "Pounce",
		description : "If the lion moved at least 20 ft straight toward the target immediately before hitting it, the target must succeed on a DC 16 Strength saving throw or have the prone condition. If the target has the prone condition, the lion can make another Rend attack against it as a bonus action."
	}],
	wildshapeString : [
		"\u25C6 Senses: Darkvision 60 ft",
		"Pack Tactics: advantage on attack rolls if at least one capable ally is within 5 ft of the target.",
		"Pounce: If moved 20 ft straight to the target before hitting it, the target must succeed on a DC 16 Strength saving throw or be knocked prone. If the target has the prone condition, the lion can make another Rend attack against it as a bonus action."
	].join("\n\u25C6 ")
};
CreatureList["titanothere"] = {
	name : "Titanothere",
	source : [["GotG", 185]],
	size : 1,
	type : "Beast",
	alignment : "Unaligned",
	ac : 16,
	hp : 136,
	hd : [13, 12],
	speed : "50 ft",
	scores : [25, 10, 19, 2, 12, 6],
	senses : "",
	passivePerception : 11,
	challengeRating : "5",
	proficiencyBonus : 3,
	attacksAction : 1,
	attacks : [{
		name : "Stomp",
		ability : 1,
		damage : [2, 8, "piercing"],
		range : "Melee (10 ft)",
		description : "If used after moving 20 ft straight in the same round, see Charge trait",
		tooltip : "If the titanothere moved at least 20 feet straight toward the target immediately before hitting it, the target takes an extra 13 (3d8) bludgeoning damage, and if the target is a creature, it must succeed on a DC 18 Strength saving throw or be knocked prone."
	}],
	traits : [{
		name : "Beast of Burden",
		description : "The titanothere is considered to be one size larger for the purpose of determining its carrying capacity."
	}, {
		name : "Charge",
		description : "If the titanothere moved at least 20 feet straight toward the target immediately before hitting it, the target takes an extra 13 (3d8) bludgeoning damage, and if the target is a creature, it must succeed on a DC 18 Strength saving throw or be knocked prone."
	}]
};

// Magic Items (excluding Horizon Puzzle Cube, because that's really just a storytelling device)
MagicItemsList["elven thrower"] = { // spear, but otherwise identical to Dwarven Thrower
	name : "Elven Thrower",
	source : [["GotG", 64]],
	type : "weapon (spear)",
	rarity : "very rare",
	attunement : true,
	prerequisite : "Requires attunement by an Elf",
	prereqeval : function(v) { return (/elf|eladrin|avariel|grugach|shadar-kai/i).test(CurrentRace.known); },
	descriptionFull : "You gain a +3 bonus to attack and damage rolls made with this magic weapon. When you hit with a ranged attack using this weapon, it deals an extra 1d8 damage or, if the target is a Giant, 2d8 damage. Immediately after the attack, the weapon flies back to your hand.",
	description : "I gain a +3 bonus to attack and damage rolls made with this magic spear. When I hit with a ranged attack using this weapon, it deals an extra 1d8 damage or, if the target is a Giant, 2d8 damage. Immediately after the attack, the weapon flies back to my hand.",
	weight : 3,
	weaponOptions : [{
		baseWeapon : "spear",
		regExpSearch : /^(?=.*elven)(?=.*thrower).*$/i,
		name : "Elven Thrower",
		source : [["SRD", 220], ["D", 167]],
		range : "Melee, 20/60 ft",
		description : "Thrown, versatile (1d8); +1d8 damage when thrown (2d8 vs. giants) and returns immediately",
		modifiers : [3, 3],
		selectNow : true
	}]
};

MagicItemsList["armor of safeguarding"] = {
	name : "Armor of Safeguarding",
	nameTest : "of Safeguarding",
	source : [["GotG", 111]],
	type : "armor (heavy)",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "Set in the center of this armor's chest is a citrine engraved with the shield rune."+
	"\n   While wearing this armor, your hit point maximum increases by an amount equal to 10 + your level."+
	"\n   " + toUni("Invoking the Rune") + ". As an action, you can invoke the armor's rune to cast the beacon of hope spell with it; the spell has a duration of 1 minute and doesn't require concentration. Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "Set in the center of this armor's chest is a citrine engraved with the shield rune. While wearing this armor, my max hp increases by my level + 10. As an action once per dawn, I can invoke its shield rune to cast Beacon of Hope with a duration of 1 minute without requiring concentration.",
	usages : 1,
	recovery : "dawn",
	additional : "Beacon of Hope",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "prefix",
		descriptionChange : ["prefix", "armor"],
		excludeCheck : function (inObjKey, inObj) {
			return !/heavy/i.test(inObj.type);
		}
	},
	spellcastingBonus : [{
		name : "Beacon of Hope",
		spells : ["beacon of hope"],
		selection : ["beacon of hope"],
		firstCol : 'oncelr'
	}],
	spellChanges : {
		"beacon of hope" : {
			duration : "1 min",
			changes : "I can cast Beacon of Hope once per dawn without it requiring concentration."
		}
	},
	calcChanges : {
		hp : function (totalHD, HDobj, prefix) {
			return [10 + (classes.totallevel ? classes.totallevel : 0)];
		}
	}
};
MagicItemsList["bloodshed blade"] = {
	name : "Bloodshed Blade",
	nameTest : "Bloodshed",
	source : [["GotG", 111]],
	type : "weapon (any sword)",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "The hilt of this sword bears a carnelian engraved with the blood rune."+
	"\n   You can add your Constitution modifier (minimum of +1) to the damage rolls of attacks made with this weapon."+
	"\n   " + toUni("Invoking the Rune") + ". When you target a creature with an attack using this weapon, you can invoke the sword's rune, causing it to flare with crimson light and infusing your attack with bloodthirsty precision. You then spend and roll one of your unspent Hit Dice and add the number rolled to the attack roll. You can choose to invoke the rune after rolling the d20."+
	"\n   If this attack hits, you can also spend and roll any number of your unspent Hit Dice and add the total rolled to the weapon's damage."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "This sword with a carnelian engraved hilt adds my Con mod to damage rolls (min +1). Once per dawn after I roll to hit against a creature with it, I can invoke its blood rune and expend one HD to add to the to hit total. If this attack hits, I can expend any HD I have left and add them to the damage roll.",
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if (v.isMeleeWeapon && /sword|scimitar|rapier/i.test(v.baseWeaponName) && /\bbloodshed\b/i.test(v.WeaponTextName)) {
					output.extraDmg += Math.max(1, Number(What("Con Mod")));
				}
			},
			'If I include the word "Bloodshed" in a the name of a sword, it will be treated as the magic weapon Bloodshed Blade, which adds my Constitution modifier (minimum of +1) to its damage rolls.'
		]
	}
};
MagicItemsList["crown of the wrath bringer"] = {
	name : "Crown of the Wrath Bringer",
	source : [["GotG", 111]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	descriptionFull : "This jagged iron circlet bears ornaments in the shape of the enemy rune. When worn, the crown glows with pale light as it draws upon the wearer's fury to strike opponents with vicious terror."+
	"\n   When you make an attack roll against a creature and hit it while wearing this crown, you can spend and roll one of your unspent Hit Dice. The creature takes extra psychic damage equal to the number rolled."+
	"\n   " + toUni("Invoking the Rune") + ". As an action, you can invoke the crown's rune to cast the fear spell (save DC 15) with it; the spell has a duration of 1 minute and doesn't require concentration. Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "When I hit a creature with an attack roll while wearing this jagged icon circlet, I can spend one HD to have the attack deal that much extra psychic damage. As an action once per dawn, I can invoke its enemy rune to cast Fear (DC 15) with a duration of 1 minute without requiring concentration.",
	usages : 1,
	recovery : "dawn",
	additional : "Fear",
	fixedDC : 15,
	spellcastingBonus : [{
		name : "Fear",
		spells : ["fear"],
		selection : ["fear"],
		firstCol : 'oncelr'
	}],
	spellChanges : {
		"fear" : {
			duration : "1 min",
			changes : "I can cast Fear once per dawn without it requiring concentration."
		}
	}
};
MagicItemsList["delver's claws"] = {
	name : "Delver's Claws",
	source : [["GotG", 112]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	descriptionFull : "The back of this weatherworn leather glove is adorned with three large metal hooks shaped like a mole's claws. Stitched into the glove's palm is the mountain rune."+
	"\n   The glove is considered a simple melee weapon with the finesse and light properties, and it deals 1d4 slashing damage on a hit. While attuned to the glove, you gain a burrowing speed equal to your walking speed and blindsight to 15 feet."+
	"\n   " + toUni("Invoking the Rune") + "As an action, you can invoke the glove's rune to bolster yourself with the sturdiness of the earth. Spend and roll a number of your unspent Hit Dice up to a maximum equal to your proficiency bonus. You then regain a number of hit points equal to the total roll plus your Constitution modifier."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "This weatherworn leather glove is a simple, finesse, light melee weapon, dealing 1d4 slashing damage. While attuned, I gain 15 ft blindsight and a burrow speed equal to my walking speed. As an action once per dawn, I can invoke its mountain rune to spend up to Prof Bonus HD to regain hp (total roll + Con mod).",
	weaponOptions : [{
		regExpSearch : /^(?=.*delver)(?=.*claw).*$/i,
		name : "Delver's Claws",
		source : [["GotG", 112]],
		ability : 1,
		type : "Simple",
		damage : [1, 4, "slashing"],
		range : "Melee",
		description : "Finesse, light",
		abilitytodamage : true,
		monkweapon : true,
		selectNow : true
	}],
	speed : { burrow : { spd : "walk", enc : "walk" } },
	vision : [["Blindsight", 15]],
	action : [["action", " (invoke rune)"]],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune"
};
MagicItemsList["glowrune pigment"] = {
	name : "Glowrune Pigment",
	source : [["GotG", 112]],
	type : "wondrous item",
	rarity : "rare",
	descriptionFull : "This set of 1d4 + 2 small paint pots contains pigments mixed from crushed luminescent gemstones. This magical paint bestows temporary magical gifts on creatures with runes drawn on their skin with this paint."+
	"\n   One paint pot contains enough pigment to paint one rune. A creature can spend 10 minutes to paint one of the following runes onto itself or another creature:"+
	"\n   " + toUni("Journey Rune") + ". Difficult terrain doesn't cost the painted creature extra movement."+
	"\n   " + toUni("Life Rune") + ". The painted creature gains 10 temporary hit points and has advantage on death saving throws."+
	"\n   " + toUni("Light Rune") + ". The painted creature gains darkvision to a range of 30 feet. If the painted creature already has darkvision from another source, the range of its darkvision increases by 30 feet."+
	"\n   " + toUni("Mountain Rune") + ". The painted creature is immune to being knocked prone and has advantage on Strength and Constitution saving throws."+
	"\n   " + toUni("Shield Rune") + ". The painted creature has advantage on Dexterity saving throws against effects that deal damage."+
	"\n   A creature can benefit from only one painted rune at a time, so a new rune painted on a creature has no effect unless the old one is removed first. The rune's benefits last for 8 hours or until the painted creature uses its action to wipe away the rune.",
	description : "This set of 1d4+2 paint pots can each be used to draw one rune on a creature in 10 min, which lasts for 8 hours: \u2022 No penalty from difficult terrain. \u2022 10 temp hp and adv. on death saves. \u2022 +30 ft darkvision. \u2022 Can't be knocked prone and adv. on Str saves and Con saves. \u2022 Adv. on Dex save vs. damaging effects."
};
var GotG_HarpOfGildedPlenty = [
	"This golden harp is sculpted in the image of the god Iallanis, depicted as a young cloud giant woman. When a creature comes within 5 feet of the harp, the instrument animates and is capable of speaking, singing, and playing by itself.",
	"Whenever you attempt to attune to the harp, you must first make either a DC 15 Charisma (Performance) check or a DC 20 Charisma (Persuasion) check to convince the harp that you are worthy, attuning to the harp on a success. If you fail, you can't attempt to attune to the harp again until the next dawn. Once you have successfully attuned to the harp, the harp resizes to suit you.",
	">>Stalwart Song<<. Whenever you make a Charisma check while attuned to the harp, you can treat a roll of 9 or lower on the die as a 10.",
	">>Feast of Plenty<<. If you spend 10 minutes playing the harp, you can cast the heroes' feast spell from it. Once this property is used, it can't be used again until 1d10 + 10 days have passed.",
	">>Soothing Melody<<. As an action, you can use the harp to cast the calm emotions spell (save DC 19). When the spell is cast using the harp, its duration increases to 1 hour, provided you maintain concentration on the spell. This property can be used five times, and it regains all uses at dawn.",
	">>Sentience<<. The harp is a sentient, chaotic good object with an Intelligence of 13, a Wisdom of 15, and a Charisma of 20. It has hearing and darkvision to a range of 120 feet.",
	"The harp can speak, read, and understand Common and Giant. It can also communicate telepathically with the creature attuned to it.",
	"The harp has a dramatic and pompous personality, taking extreme pride in the quality of music produced from its strings. If the harp is shorter than 6 feet tall, it bemoans its height."
];
MagicItemsList["harp of gilded plenty"] = {
	name : "Harp of Gilded Plenty",
	source : [["GotG", 112]],
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	descriptionFull : GotG_HarpOfGildedPlenty.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		note : desc(GotG_HarpOfGildedPlenty).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/\bf(oo|ee)t\b/ig, "ft").replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(suit) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	prerequisite : "To attune to the harp, you must first make either a DC 15 Charisma (Performance) check or a DC 20 Charisma (Persuasion) check to convince the harp that you are worthy. You can retry after the next dawn.",
	prereqeval : function() { return false; }, // so that everyone reads the prerequisite before adding the item
	description : "This sentient harp is dramatic and pompous, see notes. I can treat a roll of 9 or lower as a 10 for Charisma checks. I can cast Heroes' Feast by playing it for 10 min, but can't do so again until 1d10+10 days have passed. Five times per dawn, I can use it to cast Calm Emotions (DC 19) with a 1 hour duration.",
	extraLimitedFeatures : [{
		name : "Harp of Gilded Plenty: Calm Emotions",
		usages : 5,
		recovery : "dawn"
	}, {
		name : "Harp: Heroes' Feast",
		usages : 1,
		recovery : "Special",
		additional : "1d10+10 days"
	}],
	spellFirstColTitle : "Ch",
	fixedDC : 19,
	spellcastingBonus : [{
		name : "5\xD7 per dawn",
		spells : ["calm emotions"],
		selection : ["calm emotions"],
		firstCol : 1
	}, {
		name : "1\xD7 per 1d10+10 days",
		spells : ["heroes' feast"],
		selection : ["heroes' feast"],
		firstCol : "Sp"
	}]
};
MagicItemsList["lash of immolation"] = {
	name : "Lash of Immolation",
	source : [["GotG", 113]],
	type : "weapon (whip)",
	rarity : "rare",
	descriptionFull : "The handle of this dark leather whip bears the fire rune, and embers dance around the whip's tail."+
	"\n   You gain a +1 bonus to attack and damage rolls made with this weapon, and on a hit, the whip deals an extra 1d6 fire damage. When you score a critical hit with an attack using this whip, the target also has the restrained condition until the start of your next turn, as fiery bands lash around the target."+
	"\n   " + toUni("Invoking the Rune") + ". When you make an attack with the whip and hit, you can use your reaction to invoke the whip's rune. Doing so increases the extra fire damage dealt by the whip to 2d6."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "This +1 dark leather whip ha embers dancing around its tail. It deals +1d6 fire damage. When I score a critical hit with it, the target is restrained until my next turn starts, as fiery bands lash around it. As a reaction once per dawn when I hit with it, I can invoke its fire rune to increase the fire damage to 2d6.",
	weight : 3,
	weaponOptions : [{
		baseWeapon : "whip",
		regExpSearch : /^(?=.*last)(?=.*immolation).*$/i,
		name : "Lash of Immolation",
		source : [["GotG", 113]],
		description : "Finesse, reach; +1d6 fire damage (1/dawn +2d6); Critical hit: restrained until my next turn starts",
		modifiers : [1, 1],
		selectNow : true
	}],
	action : [["reaction", " (invoke rune)"]],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune"
};
MagicItemsList["longbow of the healing hearth"] = {
	name : "Longbow of the Healing Hearth",
	nameAlt : typePF ? "" : "Healing Hearth", // shorter for the colourful spell sheet
	source : [["GotG", 113]],
	type : "weapon (longbow)",
	rarity : "legendary",
	attunement : true,
	descriptionFull : "This ivory longbow is inscribed with a prayer to the god Hiatea, the runes of which are entwined with gilded engravings of wheat stalks and deer antlers."+
	"\n   You gain a +3 bonus to attack and damage rolls made with this weapon. If you load no ammunition in the weapon, it produces its own, automatically creating one magic arrow when you pull back the string. The arrow created by the bow vanishes the instant after it hits or misses a target."+
	"\n   The bow has 8 charges for the following properties, which you can use while wielding the bow. The bow regains 1d4 + 1 charges daily at dawn."+
	"\n   " + toUni("Curative Arrow") + ". When you take the Attack action using the bow, you can expend 1 charge to replace one of your attacks with a blazing arrow of curative magic, which automatically hits one creature you can see within 150 feet of you. The target can then immediately spend and roll one of its unspent Hit Dice and regain a number of hit points equal to the roll plus your Wisdom modifier (minimum of +1)."+
	"\n   If the target has no unspent Hit Dice remaining, nothing happens. You can use a curative arrow only once per turn."+
	"\n   " + toUni("Spellcasting") + ". While holding the bow, you can use an action to expend 1 or more of its charges to cast one of the following spells from it (save DC 18): create food and water (1 charge), warding bond (2 charges), guardian of faith (3 charges).",
	description : "This +3 ivory longbow creates its own ammo if needed and has 8 charges, regaining 1d4+1 at dawn. Instead of one attack in my Attack action, I can use 1 charge to have a target I see in 150 ft use 1 HD to regain hp + my Wis mod. I can use charges to cast (DC 18): Create Food " + (typePF ? "\u0026" : "and") + " Water, Warding Bond, Guardian of Faith.",
	weight : 2,
	weaponOptions : [{
		baseWeapon : "longbow",
		regExpSearch : /^(?=.*longbow)(?=.*healing)(?=.*hearth).*$/i,
		name : "Longbow of the Healing Hearth",
		source : [["GotG", 113]],
		description : "Ammunition, heavy, two-handed; Creates own ammo",
		modifiers : [3, 3],
		ammo : "",
		selectNow : true
	}],
	usages : 8,
	recovery : "dawn",
	additional : "regains 1d4+1",
	fixedDC : 18,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["create food and water"],
		selection : ["create food and water"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["warding bond"],
		selection : ["warding bond"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["guardian of faith"],
		selection : ["guardian of faith"],
		firstCol : 3
	}]
};
MagicItemsList["lucent destroyer"] = {
	name : "Lucent Destroyer",
	source : [["GotG", 113]],
	type : "weapon (musket)",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "This magic weapon is a triple-barreled bronze musket. You gain a +1 bonus to attack and damage rolls made with it. It requires no ammunition, its damage is radiant instead of piercing, and it doesn't have the loading property. The base of the weapon is emblazoned with the light rune."+
	"\n   Additionally, while attuned to the weapon, you can cast dancing lights from the musket at will."+
	"\n   " + toUni("Invoking the Rune") + ". As an action, you can invoke the weapon's rune to cast the sunbeam spell (save DC 17) with it. Once the rune has been invoked, it can't be invoked again until the next dawn."+
	"\n\nIt's up to the DM to decide whether a character has proficiency with a firearm. Characters in most D\u0026D worlds wouldn't have such proficiency. During their downtime, characters can use the training rules in the Player's Handbook to acquire proficiency, assuming that they have enough ammunition to keep the weapons working while mastering their use.",
	description : "I gain a +1 bonus to attack and damage rolls made with this magical musket emblazoned with the light rune. It deals radiant damage and doesn't need to be loaded with ammunition. It allows me to cast Dancing Lights at will and Sunbeam (DC 17) once per dawn by invoking the rune.",
	weight : 10,
	weaponOptions : [{
		baseWeapon : "musket",
		regExpSearch : /^(?=.*lucent)(?=.*destroyer).*$/i,
		name : "Lucent Destroyer",
		source : [["GotG", 113]],
		damage : [1, 12, "radiant"],
		description : "Two-handed",
		modifiers : [1, 1],
		ammo : "",
		selectNow : true
	}],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune: Sunbeam",
	fixedDC : 17,
	spellcastingBonus : [{
		name : "At will",
		spells : ["dancing lights"],
		selection : ["dancing lights"],
		firstCol : "atwill"
	}, {
		name : "Once per dawn",
		spells : ["sunbeam"],
		selection : ["sunbeam"],
		firstCol : "oncelr"
	}]
};
MagicItemsList["mistral mantle"] = {
	name : "Mistral Mantle",
	source : [["GotG", 114]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "This thick, fur-lined cloak has the frost rune stitched on the hem in silvery blue thread. Frigid wind swirls around the cloak, regardless of the weather."+
	"\n   While wearing this cloak, you have resistance to cold damage. Additionally, when you move within 5 feet of a creature, you can cause the cloak's cold wind to buffet the creature. The creature must succeed on a DC 14 Dexterity saving throw or take 1d6 cold damage and have the prone condition. A creature can be affected by the mantle only once during a turn."+
	"\n   " + toUni("Invoking the Rune") + ". As an action, you can invoke the mantle's rune to cast the sleet storm spell (save DC 14) with it. When you use the mantle to cast the spell, the area of the spell isn't difficult terrain for you, and you can see through the storm, ignoring the normal penalties of a heavily obscured area."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "This thick, fur-lined cloak gives me cold resistance. When I move within 5 ft of a creature, I can have it make a DC 14 Dex save once per turn or take 1d6 cold damage and become prone. As an action once per dawn, I can invoke its frost rune to cast Sleet Storm (DC 14), which I can move and see through normally.",
	dmgres : ["Cold"],
	fixedDC : 14,
	spellcastingBonus : [{
		name : "Sleet Storm",
		spells : ["sleet storm"],
		selection : ["sleet storm"],
		firstCol : 'oncelr'
	}],
	usages : 1,
	recovery : "dawn",
	additional : "Sleet Storm"
};
MagicItemsList["nimbus coronet"] = {
	name : "Nimbus Coronet",
	source : [["GotG", 114]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "The design of this bronze circlet resembles swirling clouds. At its center is set a deep-blue stone, upon which is inscribed the cloud rune."+
	"\n   While wearing this circlet, you take no damage from falling. Additionally, as a bonus action, you and everything you are wearing or carrying can teleport to an unoccupied space you can see within 15 feet of yourself, reappearing in a puff of shimmering clouds."+
	"\n   " + toUni("Invoking the Rune") + ". As an action, you can invoke the circlet's rune to assume a cloudlike form. The form lasts for 1 minute, until you are incapacitated, or until you dismiss it (no action required)."+
	"\n   While in cloud form, you have a flying speed of 60 feet and resistance to bludgeoning, piercing, and slashing damage."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "I take no damage from falling while wearing this bronze circlet. As a bonus action, I can use it to teleport to an empty space I see within 15 ft. As an action once per dawn, I can invoke its cloud rune to become cloudlike for up to 1 minute. I then gain 60 ft fly speed, bludgeoning, slashing and piercing resistance.",
	action : [["bonus action", " (teleport 15 ft)"], ["action", " (invoke rune)"]],
	savetxt : { immune : ["falling damage"] },
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune"
};
MagicItemsList["orb of skoraeus"] = {
	name : "Orb of Skoraeus",
	source : [["GotG", 114]],
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	descriptionFull : "Said to be infused with the wisdom and power of the god Skoraeus, this polished stone orb is veined with iridescent crystal that seems to glow from within. The orb is 8 inches in diameter and weighs 8 pounds, making it a palm-sized trinket for a stone giant but a more unwieldy item for a Medium creature to use."+
	"\n   While holding this orb, you can use it as a spellcasting focus for your spells. You also gain the following benefits:"+
	"\n   " + toUni("Abundant Components") + ". The orb has 3 charges and regains all expended charges at dawn. When you cast a spell while holding this orb, you can expend up to 3 charges to ignore the spell's material components with a gold piece cost, up to 300 gp per charge expended."+
	"\n   " + toUni("Astute Mind") + ". You gain a +2 bonus to any Constitution saving throw you make to maintain your concentration on a spell."+
	"\n   " + toUni("Divine Sight") + ". You can see normally in darkness, both magical and nonmagical, to a distance of 120 feet.",
	description : 'I can use this polished stone orb as a spellcasting focus that grants me +2 to concentration saves and "Divine Sight", the ability to see in normal and magical darkness out to 120 ft. It has 3 charges per dawn. When I cast a spell, I can expend charges to ignore 300 gp worth of material components per charge used.',
	weight : 8,
	usages : 3,
	recovery : "dawn",
	vision : [["Divine Sight", 120]],
	savetxt : {
		text : ["+2 on concentration saves"]
	}
};
MagicItemsList["prehistoric figurine of wondrous power"] = {
	name : "Prehistoric Figurine of Wondrous Power",
	source : [["GotG", 114]],
	type : "wondrous item",
	descriptionFull : "Larger and more roughly hewn than typical figurines of wondrous power, these statuettes depict dinosaurs and related creatures from the earliest days of the world."+
	"\n   As an action, you can throw a prehistoric figurine of wondrous power to a point on the ground within 60 feet of yourself while speaking a command word, whereupon the figurine magically transforms into a living creature. If the space where the creature would appear is occupied by other creatures or objects, or if there isn't enough space for the creature, the figurine doesn't become a creature."+
	"\n   The creature is friendly to you and your companions. It understands your languages and obeys your spoken commands. If you issue no commands, the creature defends itself but takes no other actions. See the Monster Manual for the creature's statistics."+
	"\n   The creature exists for a duration specific to each figurine. At the end of the duration, the creature reverts to its statuette form. It reverts to a figurine early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature becomes a figurine again, its property can't be used again until a certain amount of time has passed, as specified in the figurine's description.",
	description : "As an action, I can speak the command word and throw one or more statuettes to an unoccupied space within 60 ft where it becomes a specific creature for a certain amount of time. It is friendly, understands my languages, and obeys my commands.",
	action : [["action", ""]],
	choices : ["Carnelian Triceratops", "Jasper Tyrannosaurus Rex", "Kyanite Pteranodon", "Pyrite Plesiosaurus"],
	"carnelian triceratops" : {
		rarity : "very rare",
		description : "As an action, I can speak the command word and throw this carnelian statuette to an unoccupied space within 60 ft, where it becomes a triceratops for 6 hours, until I use the command word again, or it reaches 0 HP. It can be ridden as a mount, is friendly, understands my languages, and obeys my commands.",
		descriptionLong : "As an action, I can speak the command word and throw this carnelian statuette of a triceratops to an unoccupied space within 60 ft, where it becomes a triceratops for up to 6 hours, until I use an action to repeat the command word, or it reaches 0 HP. It can be ridden as a mount, is friendly to me and my allies, understands my languages, and obeys my spoken commands. If I issue no commands, the triceratops defends itself but takes no other actions. When it reverts back to a figurine, it can't be used again until 10 days have passed.",
		descriptionFull : "Larger and more roughly hewn than typical figurines of wondrous power, this carnelian statuette depicts a triceratops."+
		"\n   As an action, you can throw the prehistoric figurine of wondrous power to a point on the ground within 60 feet of yourself while speaking a command word, whereupon the figurine magically transforms into a living triceratops. If the space where the triceratops would appear is occupied by other creatures or objects, or if there isn't enough space for the triceratops, the figurine doesn't become a triceratops."+
		"\n   The triceratops is friendly to you and your companions. It understands your languages and obeys your spoken commands. If you issue no commands, the triceratops defends itself but takes no other actions. It can be ridden as a mount. See the Monster Manual for the triceratops's statistics."+
		"\n   The triceratops exists for up to 6 hours. At the end of the duration, the triceratops reverts to its statuette form. It reverts to a figurine early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the triceratops becomes a figurine again, its property can't be used again until 10 days have passed.",
		usages : 1,
		recovery : "10 days"
	},
	"jasper tyrannosaurus rex" : {
		rarity : "legendary",
		description : "As an action, I can speak the command word and throw this jasper statuette to an unoccupied space within 60 ft, where it becomes a T-rex for up to 1 hour, until I use the command word again, or it reaches 0 HP. It is friendly, obeys my commands, and understands my languages. I can lose control of it, see notes.",
		descriptionLong : "As an action, I can speak the command word and throw this jasper statuette of a T-rex to an unoccupied space within 60 ft, where it becomes a T-rex for up to 1 hour, until I use an action to repeat the command word, or it reaches 0 HP. It is friendly to me and my allies, understands my languages, and obeys my spoken commands. If I issue no commands, the creature defends itself but takes no other actions. When it reverts back to a figurine, it can't be used again until 14 days have passed. Whenever I command it (even if reverting back), roll a d20. On a 1, I lose control and it becomes hostile until it drops to 0 hp.",
		descriptionFull : "Larger and more roughly hewn than typical figurines of wondrous power, this jasper statuette depicts a tyrannosaurus rex."+
		"\n   As an action, you can throw the prehistoric figurine of wondrous power to a point on the ground within 60 feet of yourself while speaking a command word, whereupon the figurine magically transforms into a living tyrannosaurus rex. If the space where the tyrannosaurus rex would appear is occupied by other creatures or objects, or if there isn't enough space for the tyrannosaurus rex, the figurine doesn't become a tyrannosaurus rex."+
		"\n   The tyrannosaurus rex is friendly to you and your companions. It understands your languages and obeys your spoken commands. If you issue no commands, the tyrannosaurus rex defends itself but takes no other actions. See the Monster Manual for the tyrannosaurus rex's statistics."+
		"\n   The tyrannosaurus rex exists for up to 1 hour. At the end of the duration, the tyrannosaurus rex reverts to its statuette form. It reverts to a figurine early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the tyrannosaurus rex becomes a figurine again, its property can't be used again until 14 days have passed."+
		"\n   Whenever you command the figurine while it's in tyrannosaurus rex form (including commanding it to revert to figurine form), you must roll a d20. On a 1, you lose control of the figurine, and it becomes hostile to you and your companions until it is reduced to 0 hit points, at which point it reverts to figurine form.",
		usages : 1,
		recovery : "14 days",
		toNotesPage : [{
			name : "Lose Control",
			note : desc("Whenever I command the figurine while it's in tyrannosaurus rex form (including commanding it to revert to figurine form), I must roll a d20. On a 1, I lose control of the figurine, and it becomes hostile to me and my companions until it is reduced to 0 hit points, at which point it reverts to figurine form.")
		}]
	},
	"kyanite pteranodon" : {
		rarity : "rare",
		description : "As an action, I can speak the command word and throw this kyanite statuette to an unoccupied space within 60 ft, where it becomes a pteranodon for 8 hours, until I use the command word again, or it reaches 0 HP. It can be ridden as a mount, is friendly, understands my languages, and obeys my commands.",
		descriptionLong : "As an action, I can speak the command word and throw this kyanite statuette of a pteranodon to an unoccupied space within 60 ft, where it becomes a pteranodon for up to 8 hours, until I use an action to repeat the command word, or it reaches 0 HP. It can be ridden as a mount if I'm Medium or smaller, is friendly to me and my allies, understands my languages, and obeys my spoken commands. If I issue no commands, the creature defends itself but takes no other actions. When it reverts back to a figurine, it can't be used again until 7 days have passed.",
		descriptionFull : "Larger and more roughly hewn than typical figurines of wondrous power, this kyanite statuette depicts a pteranodon."+
		"\n   As an action, you can throw the prehistoric figurine of wondrous power to a point on the ground within 60 feet of yourself while speaking a command word, whereupon the figurine magically transforms into a living pteranodon. If the space where the pteranodon would appear is occupied by other creatures or objects, or if there isn't enough space for the pteranodon, the figurine doesn't become a pteranodon."+
		"\n   The pteranodon is friendly to you and your companions. It understands your languages and obeys your spoken commands. If you issue no commands, the pteranodon defends itself but takes no other actions. If your size is Medium or smaller, you can ride the pteranodon as a mount. See the Monster Manual for the pteranodon's statistics."+
		"\n   The pteranodon exists for up to 8 hours. At the end of the duration, the pteranodon reverts to its statuette form. It reverts to a figurine early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the pteranodon becomes a figurine again, its property can't be used again until 7 days have passed.",
		usages : 1,
		recovery : "7 days"
	},
	"pyrite plesiosaurus" : {
		rarity : "uncommon",
		description : "As an action, I can speak the command word and throw this pyrite statuette to an unoccupied space within 60 ft, where it becomes a plesiosaurus for 12 hours, until I use the command word again, or it reaches 0 HP. It can be ridden as a mount, is friendly, understands my languages, and obeys my commands.",
		descriptionLong : "As an action, I can speak the command word and throw this pyrite statuette of a plesiosaurus to an unoccupied space within 60 ft, where it becomes a plesiosaurus for up to 12 hours, until I use an action to repeat the command word, or it reaches 0 HP. It can be ridden as a mount, is friendly to me and my allies, understands my languages, and obeys my spoken commands. If I issue no commands, the creature defends itself but takes no other actions. When it reverts back to a figurine, it can't be used again until 4 days have passed. While I'm riding it, I can use it to cast Water Breathing at will.",
		descriptionFull : "Larger and more roughly hewn than typical figurines of wondrous power, this pyrite statuette depicts a plesiosaurus."+
		"\n   As an action, you can throw the prehistoric figurine of wondrous power to a point on the ground within 60 feet of yourself while speaking a command word, whereupon the figurine magically transforms into a living plesiosaurus. If the space where the plesiosaurus would appear is occupied by other creatures or objects, or if there isn't enough space for the plesiosaurus, the figurine doesn't become a plesiosaurus."+
		"\n   The plesiosaurus is friendly to you and your companions. It understands your languages and obeys your spoken commands. If you issue no commands, the plesiosaurus defends itself but takes no other actions. It can be ridden as a mount. While you are riding the plesiosaurus, you can use it to cast water breathing at will. See the Monster Manual for the plesiosaurus's statistics."+
		"\n   The plesiosaurus exists for up to 12 hours. At the end of the duration, the plesiosaurus reverts to its statuette form. It reverts to a figurine early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the plesiosaurus becomes a figurine again, its property can't be used again until 4 days have passed.",
		usages : 1,
		recovery : "4 days",
		spellcastingBonus : [{
			name : "At will while riding it",
			spells : ["water breathing"],
			selection : ["water breathing"],
			firstCol : "atwill"
		}]
	}
};
MagicItemsList["reaper's scream"] = {
	name : "Reaper's Scream",
	source : [["GotG", 115]],
	type : "weapon (morningstar)",
	rarity : "legendary",
	attunement : true,
	descriptionFull : "The spikes of this iron morningstar glow with sickly, pale light. The death rune is inscribed on its shaft and inlaid with pearl."+
	"\n   You gain a +2 bonus to attack and damage rolls made with this weapon, and attacks with this weapon deal necrotic damage instead of piercing damage."+
	"\n   When you attack a creature with this weapon and roll a 20 on the attack roll, you gain 10 temporary hit points. Any creature that hits you with a melee attack while you have 1 or more of these temporary hit points takes 10 necrotic damage."+
	"\n   " + toUni("Invoking the Rune") + ". As a bonus action, you can invoke the weapon's rune, unleashing the screams of every creature slain by the weapon in one cacophonous burst. Each creature of your choice within 60 feet of you must succeed on a DC 15 Wisdom saving throw or have the stunned condition until the start of your next turn."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "This +2 morningstar deals necrotic damage. When I roll a 20 to hit vs. a creature, I gain 10 " + (typePF ? "temp" : "temporary") + " hp. Melee attackers that hit me take 10 necrotic " + (typePF ? "dmg" : "damage") + " while these last. As a bonus action once per dawn, I can invoke its death rune to have chosen " + (typePF ? "" : "creatures ") + "within 60 ft make a Wis save DC 15 or be stunned until my next turn starts.",
	weight : 4,
	weaponOptions : [{
		baseWeapon : "morningstar",
		regExpSearch : /^(?=.*reaper)(?=.*scream).*$/i,
		name : "Reaper's Scream",
		source : [["GotG", 115]],
		description : "On 20 to hit: 10 temp hp (see magic item)",
		modifiers : [2, 2],
		selectNow : true
	}],
	action : [["bonus action", " (invoke rune)"]],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune"
};
MagicItemsList["ring of amity"] = {
	name : "Ring of Amity",
	source : [["GotG", 115]],
	type : "ring",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "This ring is carved from hematite and bears an engraving of the friend rune."+
	"\n   When you first attune to this ring, you can touch one willing creature and form a magical bond between the two of you. While this bond lasts, whenever you are subjected to a spell or magical effect that restores hit points, the bonded creature also receives the benefits of the spell or effect."+
	"\n   You can bond with a different creature whenever you finish a long rest, provided that you can touch the creature and the creature is willing."+
	"\n   A creature can benefit from only one ring of amity's bond at a time. The bond ends if either you or the creature travels to a different plane of existence, if you bond with a different creature at the end of a long rest, or if you sever the bond as a bonus action."+
	"\n   " + toUni("Invoking the Rune") + ". When the bonded creature hits a target with an attack roll, you can use your reaction to invoke the ring's rune if you are within 60 feet of the bonded creature. The bonded creature's attack is then turned into a critical hit."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "This hematite ring allows me to bond to one willing creature I touch, which I can change every long rest. When a magical effect restores my hp, my bond also benefits from this effect. As a reaction once per dawn when my bond is within 60 ft and hits an attack, I can invoke the ring's friend rune to make it a critical hit.",
	descriptionLong : "This hematite ring allows me to bond to one willing creature I touch, which I can change every long rest. A creature can only benefit from one such bond at the same time. The bond ends if we are no longer on the same plane, if I bond with another, or if I sever it as a bonus action. While this bond lasts, whenever I'm subjected to a spell or magical effect that restores hp, the bonded creature also receives the benefits of the spell or effect. As a reaction once per dawn when my bond is within 60 ft and hits with an attack roll, I can invoke the ring's friend rune to turn the hit into a critical hit.",
	action : [["reaction", " (invoke rune)"]],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune"
};
MagicItemsList["sanctum amulet"] = {
	name : "Sanctum Amulet",
	source : [["GotG", 116]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "A black opal pendant hangs at the base of this pearlescent chain. The sacred rune is inscribed on the back of the pendant."+
	"\n   While wearing this item, you have resistance to necrotic damage. Additionally, you can cast the spare the dying cantrip using either an action or a bonus action."+
	"\n   " + toUni("Invoking the Rune") + ". When a creature you can see within 60 feet of you is reduced to 0 hit points as a result of taking damage, you can use your reaction to invoke the item's rune, causing the pendant to flash with pale light. The creature then instead drops to 1 hit point."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "While wearing this black opal pendant on a pearlescent chain, I have resistance to necrotic damage and can cast Spare the Dying as an action or bonus action. As a reaction once per dawn when I see a creature within 60 ft drop to 0 hp by damage, I can invoke the pendant's sacred rune to restore it to 1 hp.",
	dmgres : ["Necrotic"],
	spellcastingBonus : [{
		name : "Spare the Dying",
		spells : ["spare the dying"],
		selection : ["spare the dying"],
		firstCol : 'atwill'
	}],
	spellChanges : {
		"spare the dying" : {
			time : "1 a/bns",
			changes : "I can cast Spare the Dying either as an action or as a bonus action."
		}
	},
	action : [["reaction", " (invoke rune)"]],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune"
};
MagicItemsList["shield of the blazing dreadnought"] = {
	name : "Shield of the Blazing Dreadnought",
	source : [["GotG", 116]],
	type : "shield",
	rarity : "legendary",
	attunement : true,
	descriptionFull : "Modeled after the formidable spiked tower shields wielded by some fire giants, this iron shield emanates a constant warmth."+
	"\n   You can use a bonus action to activate the shield, causing glowing lava to flow through the shield's grooves for 1 minute. While the shield is active, you gain the following benefits:"+
	"\n   " + toUni("Blazing Soul") + ". You have immunity to fire damage."+
	"\n   " + toUni("Cleansing Fire") + ". As an action, you can cause the shield to flare with the cleansing fire of the god Surtur. Choose one creature you can see within 30 feet of yourself (you can choose yourself). One disease or condition of your choice affecting this creature ends immediately; the condition can be blinded, charmed, deafened, or poisoned."+
	"\n   " + toUni("Shield Bash") + ". When you take the Attack action on your turn, you can replace one of your attacks with a shield bash, targeting one creature you can see within 5 feet of yourself. The target must make a Strength saving throw (DC equals 8 + your proficiency bonus + your Strength modifier). On a failed save, the target takes 3d6 bludgeoning damage plus 3d6 fire damage and is knocked prone. On a successful save, the target takes half as much damage only. You can use Shield Bash only once per turn."+
	"\n   Once the shield has been activated, it can't be activated again until the next dawn.",
	description : "As a bonus action once per dawn, I can activate this iron shield to grant me the following for 1 minute: \u2022 Immune to fire. \u2022 As an action, I can remove disease, blinded, charmed, deafened, or poisoned from myself a creature I can see within 30 ft (Cleansing Fire). \u2022 I can make a shield bash attack once per turn (see attack).",
	descriptionLong : "As a bonus action once per dawn, I can activate this iron shield to grant me the following benefits for 1 minute: \u2022 Blazing Soul: Immunity to fire damage."+
	"\n\u2022 Cleansing Fire: As an action, I can remove a disease from myself or a creature I can see within 30 ft or the blinded, charmed, deafened, or poisoned condition."+
	"\n\u2022 Shield Bash: When I take the Attack action on my turn, I can replace one attack with a shield bash to deal 3d6 bludgeoning and 3d6 fire damage and knock prone one creature within 5 ft. It can make a Str save (DC 8 + Prof B. + Str mod) to take half the damage only.",
	weight : 6,
	shieldAdd : "Shield of the Blazing Dreadnought",
	savetxt : { immune : ["fire (while Blazing Dreadnought active)"] },
	action : [
		["bonus action", " (activate)"],
		["action", "Cleansing Fire (while Blazing Dreadnought active)"],
	],
	usages : 1,
	recovery : "dawn",
	additional : "activate",
	weaponOptions : [{
		regExpSearch : /^(?=.*blazing)(?=.*dreadnought)(?=.*shield).*$/i,
		name : "Blazing Dreadnought Shield Bash",
		source : [["GotG", 116]],
		ability : 1,
		type : 'AlwaysProf',
		damage : ['3d8 Fire + 3d8', '', 'bludgeoning'],
		range : "Melee",
		description : "Str save for half damage; If failed, also knocked prone; Once per Attack action while shield is active",
		abilitytodamage : false,
		dc : true,
		isNotWeapon : true,
		selectNow : true
	}]
};
MagicItemsList["staff of the rooted hills"] = {
	name : "Staff of the Rooted Hills",
	source : [["GotG", 116]],
	type : "staff",
	rarity : "rare",
	attunement : true,
	descriptionFull : "The hill rune is carved into this gnarled wooden staff. The staff magically resizes to match the height of any creature that attunes to it."+
	"\n   The staff can be wielded as a magic quarterstaff that grants a +1 bonus to attack and damage rolls made with it. The first time you hit any creature with the staff on your turn, the creature must succeed on a DC 12 Strength saving throw or be restrained by spectral vines until the start of your next turn."+
	"\n   " + toUni("Invoking the Rune") + ". As an action, you can invoke the staff's rune to cast either hold person (save DC 12) or speak with plants with the staff. When you cast hold person using the staff, the target is wreathed in spectral vines."+
	"\n   Once the rune has been invoked to cast either spell, it can't be invoked again until the next dawn.",
	description : "A creature hit with this +1 quarterstaff must make a DC 12 Str save or be restrained by spectral vines until my next turn starts. As an action once per dawn, I can invoke its hill rune to cast either Hold Person (DC 12) or Speak with Plants with it. The target of this Hold Person is wreathed in spectral vines.",
	weight : 4,
	weaponOptions : [{
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*staff)(?=.*rooted)(?=.*hills).*$/i,
		name : "Staff of the Rooted Hills",
		source : [["GotG", 116]],
		description : "Versatile (1d8); On hit, DC 12 Str save or restrained until my next turn starts",
		modifiers : [1, 1],
		selectNow : true
	}],
	usages : 1,
	recovery : "dawn",
	additional : "Hold Person or Speak with Plants",
	fixedDC : 12,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "Hold Person",
		spells : ["hold person"],
		selection : ["hold person"],
		firstCol : 1
	}, {
		name : "Speak with Plants",
		spells : ["speak with plants"],
		selection : ["speak with plants"],
		firstCol : 1
	}]
};
MagicItemsList["stonebreaker's breastplate"] = {
	name : "Stonebreaker's Breastplate",
	source : [["GotG", 116]],
	type : "armor (breastplate)",
	rarity : "legendary",
	attunement : true,
	descriptionFull : "This breastplate is made from marbled granite, though it feels no heavier than a typical metal breastplate. Its chest is emblazoned with the stone rune."+
	"\n   While wearing this breastplate, you have resistance to bludgeoning, piercing, and slashing damage and are immune to being knocked prone."+
	"\n   " + toUni("Invoking the Rune") + ". As an action, you can invoke the breastplate's rune to cast the wall of stone spell (save DC 14) with it. When you cast the spell in this way, you have advantage on saving throws made to maintain concentration on the spell."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "While wearing this marbled granite breastplate, I have resistance to bludgeoning, piercing, and slashing damage and can't be knocked prone. As an action once per dawn, I can invoke its stone rune to cast Wall of Stone (DC 14) with it. It also grants me advantage on concentration saves for the spell cast in this way.",
	armorAdd : { select : "Stonebreaker's Breastplate", options : ["Stonebreaker's Breastplate"] },
	weight : 20,
	dmgres : ["Bludgeoning", "Slashing", "Piercing"],
	savetxt : { immune : ["knocked prone"] },
	action : [["action", ""]],
	fixedDC : 14,
	spellcastingBonus : [{
		name : "Wall of Stone",
		spells : ["wall of stone"],
		selection : ["wall of stone"],
		firstCol : "oncelr"
	}],
	usages : 1,
	recovery : "dawn",
	additional : "Wall of Stone"
};
MagicItemsList["thunderbuss"] = {
	name : "Thunderbuss",
	source : [["GotG", 116]],
	type : "weapon (pistol)",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "This magic ranged weapon is a flared pistol with the storm rune engraved along the barrel. You gain a +1 bonus to attack and damage rolls made with it. It requires no ammunition, its damage is thunder instead of piercing, and it doesn't have the loading property."+
	"\n   " + toUni("Invoking the Rune") + ". As a bonus action, you can invoke the weapon's rune to launch a ball of energy to a point you can see within 30 feet of yourself. The energy then detonates into a 10-foot-radius sphere of turbulent wind and thunder centered on that point, and each creature in that sphere must make a DC 14 Constitution saving throw. On a failed save, a creature takes 3d6 thunder damage, and it can't take reactions until the end of your next turn. On a successful save, a creature takes half as much damage only."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn."+
	"\n\nIt's up to the DM to decide whether a character has proficiency with a firearm. Characters in most D\u0026D worlds wouldn't have such proficiency. During their downtime, characters can use the training rules in the Player's Handbook to acquire proficiency, assuming that they have enough ammunition to keep the weapons working while mastering their use.",
	description : "This +1 pistol deals thunder damage and requires loading nor ammunition. As a bonus action once per dawn, I can invoke its storm rune on a point within 30 ft. All creatures in a 10-ft radius must make a DC 14 Con save or take 3d6 thunder damage and no reactions until my next turn ends. Only half damage if saved.",
	weight : 3,
	weaponOptions : [{
		baseWeapon : "pistol",
		regExpSearch : /thunderbuss/i,
		name : "Thunderbuss",
		source : [["GotG", 116]],
		damage : [1, 10, "thunder"],
		description : "",
		modifiers : [1, 1],
		ammo : "",
		selectNow : true
	}],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune",
	action : [["bonus action", " (invoke rune)"]]
};
MagicItemsList["war horn of valor"] = {
	name : "War Horn of Valor",
	source : [["GotG", 117]],
	type : "wondrous item",
	rarity : "rare",
	descriptionFull : "This brass war horn is engraved with the war rune, which glows purple when the horn is blown."+
	"\n   You can blow the horn as a bonus action. When you do, if you have the frightened condition, you immediately end that condition on yourself. You also have advantage on saving throws against being frightened until the start of your next turn."+
	"\n   " + toUni("Invoking the Rune") + ". When you blow the horn, you can also invoke the rune, imbuing the horn's deep call with protective magic that affects creatures of your choice within 30 feet of yourself. You and all affected creatures gain a +1 bonus to AC until the start of your next turn."+
	"\n   Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "As a bonus action, I can blow this brass war horn with the war rune to stop being frightened and gain adv. on saves against being frightened until my next turn starts. Once per dawn when I blow it, I can also invoke its rune, imbuing all chosen creatures within 30 ft with a +1 bonus to AC until my next turn starts.",
	action : [["bonus action", ""]],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune"
};
MagicItemsList["wayfarer's boots"] = {
	name : "Wayfarer's Boots",
	source : [["GotG", 117]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	descriptionFull : "This pair of boots is made of durable cloth, with the journey rune stitched in golden thread above each heel. While you are wearing this item, your walking speed increases by 10 feet, and you have advantage on Wisdom (Survival) checks."+
	"\n   " + toUni("Invoking the Runes") + ". As a bonus action, you can invoke the boots' runes to cast the expeditious retreat spell with them. Once the runes have been invoked, they can't be invoked again until the next dawn.",
	description : "While I'm wearing this pair of durable cloth boots with the journey rune stitched in golden thread above each heel, I have +10 ft walking speed and advantage on Wisdom (Survival) checks. As a bonus action once per dawn, I can invoke the boots' runes to cast Expeditious Retreat with them.",
	speed : { walk : { spd : "+10", enc : "+10" } },
	advantages : [["Survival", true]],
	spellcastingBonus : [{
		name : "Expeditious Retreat",
		spells : ["expeditious retreat"],
		selection : ["expeditious retreat"],
		firstCol : "oncelr"
	}],
	usages : 1,
	recovery : "dawn",
	additional : "Expeditious Retreat"
};
MagicItemsList["wyrmreaver gauntlets"] = {
	name : "Wyrmreaver Gauntlets",
	source : [["GotG", 117]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	descriptionFull : "Originally crafted for ground-bound giant brawlers to fight against dragons and other enormous predators of the sky, these studded gauntlets are engraved with the dragon rune."+
	"\n   While you are wearing these gauntlets, your unarmed strike deals an additional 1d6 force damage on a hit. Additionally, whenever you finish a long rest, choose one of the following damage types: acid, cold, fire, lightning, or poison. You have resistance to the chosen damage type until you finish another long rest."+
	"\n   " + toUni("Invoking the Runes") + ". As a bonus action, you can invoke the gauntlets' runes and summon two enormous spectral fists that envelop the gauntlets and mimic your hand motions. The fists can also launch themselves to strike distant opponents, returning immediately to your space after they hit or miss."+
	"\n   The fists last for 1 minute or until you are incapacitated. While the spectral fists are active, unarmed strikes you make on your turn have a reach of 30 feet, and when you hit a creature with an opportunity attack made with your unarmed strike, the creature must succeed on a Strength saving throw (DC equals 8 + your proficiency bonus + your Strength modifier) or have the prone condition."+
	"\n   Once the runes have been invoked, they can't be invoked again until the next dawn.",
	description : "+1d6 force damage to unarmed strikes. Each long rest, choose a resistance it grants me: acid, cold, fire, lightning, or poison. As a bonus action once per dawn, invoke the rune for 1 min: 30 ft range unarmed strikes, target hit with opportunity attacks with it must make Str save DC 8+Prof B.+Str mod or be knocked prone.",
	calculate : "event.value = (typePF ? '' : 'These gauntlets add ') + '+1d6 force damage to unarmed strikes. Each long rest, choose a resistance it grants me: acid, cold, fire, lightning, or poison. As a bonus action once per dawn, invoke the rune for 1 min: 30 ft range unarmed strikes, target hit with opportunity attacks with it must make Str save DC ' + (8 + Number(How('Proficiency Bonus')) + Number(What('Str Mod'))) + ' (8+Prof+Str) or be knocked prone.';",
	dmgres : ["acid,cold,fire,lightn.,or poison"],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == "unarmed strike") {
					fields.Description += (fields.Description ? '; ' : '') + '+1d6 force damage; Opportunity attack: Str save or prone';
				};
			},
			"My unarmed strike deals an additional 1d6 force damage on a hit."
		]
	},
	action : [["bonus action", " (invoke rune)"]],
	usages : 1,
	recovery : "dawn",
	additional : "invoke rune"
};
MagicItemsList["zephyr armor"] = {
	name : "Zephyr Armor",
	source : [["GotG", 117]],
	type : "armor (light)",
	rarity : "rare",
	attunement : true,
	descriptionFull : "This fine set of white-and-silver armor bears the wind rune upon its chest."+
	"\n   While wearing this armor, you have advantage on Dexterity (Acrobatics) checks and Dexterity saving throws as your movements are bolstered by gentle currents of wind."+
	"\n   " + toUni("Invoking the Rune") + ". As an action, you can invoke the armor's rune to cast the wind wall spell (save DC 15) with it. Once the rune has been invoked, it can't be invoked again until the next dawn.",
	description : "While wearing this white-and-silver armor with the wind rune on its chest, I have advantage on Dex (Acrobatics) checks and Dexterity saves as my movements are bolstered by gentle currents of wind. As an action once per dawn, I can invoke the armor's rune to cast Wind Wall (DC 15) with it.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["between", "Zephyr", "Armor"],
		excludeCheck : function (inObjKey, inObj) {
			return !/light/i.test(inObj.type);
		}
	},
	advantages : [["Acrobatics", true], ["Dexterity", true]],
	savetxt : { text : ["Adv. on Dex saves"] },
	fixedDC : 13,
	spellcastingBonus : [{
		name : "Wind Wall",
		spells : ["wind wall"],
		selection : ["wind wall"],
		firstCol : "oncelr"
	}],
	usages : 1,
	recovery : "dawn",
	additional : "Wind Wall"
};

// pub_20230919_PaBTSO.js
// This file adds the magic items from the Phandelver and Below: The Shattered Obelisk adventure from the D&D 5e starter set to MPMB's Character Record Sheet

// Define the source
SourceList["PaBTSO"] = {
	name : "Phandelver and Below: The Shattered Obelisk [items]",
	abbreviation : "PaBTSO",
	group : "Adventure Books",
	campaignSetting : "Forgotten Realms",
	url : "https://dndstore.wizards.com/us/product/820931/phandelver-and-below-the-shattered-obelisk-digital-plus-physical-bundle",
	date : "2023/09/19"
};

// Magic Items
MagicItemsList["netherese ring of protection"] = {
	name : "Netherese Ring of Protection",
	source : [["PaBTSO", 50]],
	type : "ring",
	rarity : "rare",
	description : "This ring is made from a single piece of mystical green glass that's stronger than steel. It grants me a +1 bonus to AC and saving throws. It also gives me a +4 bonus to saves and checks made to avoid dropping or being disarmed of any item held in the hand this ring is on.",
	descriptionFull : "You gain a +1 bonus to AC and saving throws while wearing this ring."+
	"\n   The ring is made from a single piece of mystical green glass that's stronger than steel. It has the added property of making the wearer less likely to drop or lose anything held in the hand the ring is on. The wearer receives a +4 bonus to saving throws or checks made to avoid dropping or being disarmed of any item held in that hand.",
	attunement : true,
	extraAC : [{name : "Netherese Ring of Protection", mod : 1, magic : true, text : "I gain a +1 bonus to AC while attuned."}],
	addMod : [{ type : "save", field : "all", mod : 1, text : "While I wear the Netherese Ring of Protection, I gain a +1 bonus to all my saving throws." }],
	savetxt : { text : ["+4 to avoid disarm/drop held"] }
}
MagicItemsList["statuette of augury"] = {
	name : "Statuette of Augury",
	source : [["PaBTSO", 62]],
	type : "wondrous item",
	rarity : "unknown",
	description : "This gold statuette of an elf is imbued with divination magic. A non-evil creature grasping the statue can ask it a question and receive a telepathic response, as though the creature had cast Augury. Once a creature has asked its question and received a response, it can never activate the statuette again.",
	descriptionFull : "This gold statuette of an elf is worth 100 gp, and is imbued with divination magic. A non-evil creature grasping the statue can ask it a question and receive a telepathic response, as though the creature had cast augury. Once a creature has asked its question and received a response, it can never activate the statuette again.",
	spellcastingBonus : [{
		name : "Statuette of Augury",
		spells : ["augury"],
		selection : ["augury"],
		firstCol : "1\xD7"
	}]
}
MagicItemsList["bracers of celerity"] = {
	name : "Bracers of Celerity",
	source : [["PaBTSO", 217]],
	type : "wondrous item",
	rarity : "rare",
	description : "This pair of lightweight bronze bracers is lined with soft, purple velvet and engraved with swirling designs. While I'm wearing these bracers, all my speeds increase by 10 ft, and I have advantage on saving throws I make to avoid or end the paralyzed or restrained condition on myself.",
	descriptionFull : "This pair of lightweight bronze bracers is lined with soft, purple velvet and engraved with swirling designs."+
	"\n   While you're wearing these bracers, all your speeds increase by 10 feet, and you have advantage on saving throws you make to avoid or end the paralyzed or restrained condition on yourself.",
	attunement : true,
	speed : { allModes : "+10" },
	savetxt : { adv_vs : ["paralyzed", "restrained"] }
}
MagicItemsList["cape of enlargement"] = {
	name : "Cape of Enlargement",
	source : [["PaBTSO", 217]],
	type : "wondrous item",
	rarity : "very rare",
	description : "This cape has 3 charges, regaining 1d3 daily at dawn. As a bonus action, I can use 1 charge to enlarge myself for 10 min or end this effect. While enlarged, my size increases by one category as space allows, I have adv. on Strength checks and saves, and I add my Prof Bonus to my weapon and unarmed strike damage.",
	descriptionFull : "Ancient runes are stitched in silver thread along the hem of this grayish-purple cape."+
	"\n   The cape has 3 charges. As a bonus action while wearing the cape, you can expend 1 of its charges to enlarge yourself, granting yourself the following benefits:"+
	"\n   \u2022 Your size increases by one category\u2014from Medium to Large, for example. If there isn't enough room for your size to increase by one category, you instead become the maximum possible size in the space available."+
	"\n   \u2022 You have advantage on Strength checks and Strength saving throws."+
	"\n   \u2022 When you hit with an attack roll using a weapon or an unarmed strike, you can add your proficiency bonus to the attack's damage."+
	"\n   These benefits last for 10 minutes or until you use another bonus action to dismiss them. The cape regains 1d3 expended charges daily at dawn.",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	action : [["bonus action", " (enlarge/stop)"]],
}
MagicItemsList["flayer slayer"] = {
	name : "Flayer Slayer",
	source : [["PaBTSO", 217]],
	type : "weapon (greataxe)",
	rarity : "rare",
	description : "I gain a +1 bonus to attack and damage rolls made with this greataxe adorned with carvings of decapitated mind flayers. An aberration hit with this greataxe takes +1d12 slashing damage and if it is currently grappling a creature, it must succeed on a DC 15 Strength save or release each creature it is grappling.",
	descriptionFull : "Carvings of decapitated mind flayers adorn this greataxe's metal blade. You gain a +1 bonus to attack and damage rolls made with this greataxe."+
	"\n   An Aberration hit with this greataxe takes an extra 1d12 slashing damage. If the Aberration is currently grappling a creature, the Aberration must succeed on a DC 15 Strength saving throw or release each creature it is grappling.",
	attunement : true,
	weight : 7,
	weaponOptions : [{
		baseWeapon : "greataxe",
		regExpSearch : /flayer slayer/i,
		name : "Flayer Slayer",
		source : [["PaBTSO", 217]],
		description : "Heavy, two-handed; Aberrations: +1d12 damage \u0026 DC 15 Str save or release all grappled",
		modifiers : [1, 1],
		selectNow : true
	}]
}
MagicItemsList["luminous war pick"] = {
	name : "Luminous War Pick",
	source : [["PaBTSO", 217]],
	type : "weapon (war pick)",
	rarity : "rare",
	description : "I gain a +1 bonus to attack and damage rolls made with this war pick inlaid with crushed pearlescent stones that imbue it with a faint luminescence. As a bonus action once per dawn, I can use it to cast the daylight spell, choosing a point on the war pick as a target for the spell.",
	descriptionFull : "The haft of this war pick is inlaid with crushed pearlescent stones that imbue the weapon with a faint luminescence. You gain a +1 bonus to attack and damage rolls made with this war pick."+
	"\n   While wielding the war pick, you can use a bonus action to cast the daylight spell, choosing a point on the war pick. Once you use this bonus action, it can't be used again until the next dawn.",
	attunement : true,
	weight : 2,
	weaponOptions : [{
		baseWeapon : "war pick",
		regExpSearch : /^(?=.*\bluminous\b)((?=.*\bkuwas?\b)|((?=.*pick)(?=.*war))|((?!.*(heavy|great|light))(?=.*\bpicks?\b))).*$/i,
		name : "Luminous War Pick",
		source : [["PaBTSO", 217]],
		description : "",
		modifiers : [1, 1],
		selectNow : true
	}],
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["daylight"],
		selection : ["daylight"],
		firstCol : "oncelr"
	}],
	usages : 1,
	recovery : "dawn",
	additional : "Daylight",
	action : [["bonus action", " (Daylight)"]],
	spellChanges : {
		"daylight" : {
			time : "1 bns",
			description : "60-ft rad bright light + 60-ft dim light from point on pick; only magical darkness of SL 4+ works in it",
			changes : "While wielding the Luminous War Pick, I can use a bonus action to cast the daylight spell, choosing a point on the war pick."
		}
	}
}
MagicItemsList["mind crystal"] = {
	name : "Mind Crystal",
	source : [["PaBTSO", 218]],
	type : "wondrous item",
	rarity : "rare",
	description : "When you cast a spell that has a casting time of 1 action while holding a mind crystal, I can modify it in a specific way determined by the type of mind crystal. I can't use a mind crystal and a Metamagic option on the same spell. Once a mind crystal is used, it becomes a nonmagical gem worth 50 gp.",
	descriptionFull : "These gemstones contain a crystallized bit of spellcasting magic. Different types of mind crystals exist, each with a different single-use effect."+
	"\n   When you cast a spell that has a casting time of 1 action while holding a mind crystal, you can modify the spell in a specific way. You can use only a single mind crystal to modify the spell, and you can't use a mind crystal and a Metamagic option on the same spell. Once you use a mind crystal, it becomes a nonmagical gem worth 50 gp."+
	toUni("\n   Careful") + ". (Uncommon) Choose up to three creatures affected by the spell. The chosen creatures automatically succeed on their saving throws against the spell."+
	toUni("\n   Distant") + ". (Uncommon) If the spell has a range of 5 feet or more and doesn't have a range of self, the spell's range increases by 100 feet. If the spell has a range of touch, its range becomes 30 feet."+
	toUni("\n   Empowered") + ". (Uncommon) When you roll damage for the spell, you can reroll up to three damage dice. You must use the new rolls."+
	toUni("\n   Extended") + ". (Uncommon) If the spell has a duration of 1 minute or longer, double the spell's duration, to a maximum duration of 24 hours."+
	toUni("\n   Heightened") + ". (Rare) Choose one creature affected by the spell. That creature has disadvantage on the first saving throw it makes against the spell."+
	toUni("\n   Quickened") + ". (Rare) You change the spell's casting time to 1 bonus action for this casting."+
	toUni("\n   Subtle") + ". (Common) You cast the spell without any somatic or verbal components for this casting.",
	allowDuplicates : true,
	choices : ['Careful', 'Distant', 'Empowered', 'Extended', 'Heightened', 'Quickened', 'Subtle'],
	"careful" : {
		rarity : "uncommon",
		description : "I can use this crystal once while holding it and casting a spell with a casting time of 1 action. Choose up to three creatures affected by the spell. The chosen creatures automatically succeed on their saving throws against the spell. A spell can be modified only by a single mind crystal or metamagic, not both."
	},
	"distant" : {
		rarity : "uncommon",
		description : "I can use this crystal once while holding it and casting a spell with a casting time of 1 action and a range other then self. If the spell has a range of touch, its range becomes 30 ft. If the spell has a range of 5 ft or more, it increases by 100 ft. A spell can be modified only by a single mind crystal or metamagic, not both."
	},
	"empowered" : {
		rarity : "uncommon",
		description : "I can use this crystal once while holding it and casting a spell with a casting time of 1 action. When you roll damage for the spell, you can reroll up to three damage dice. You must use the new rolls. A spell can be modified only by a single mind crystal or metamagic, not both."
	},
	"extended" : {
		rarity : "uncommon",
		description : "I can use this crystal once while holding it and casting a spell with a casting time of 1 action. If the spell has a duration of 1 minute or longer, double the spell's duration, to a maximum duration of 24 hours. A spell can be modified only by a single mind crystal or metamagic, not both."
	},
	"heightened" : {
		rarity : "rare",
		description : "I can use this crystal once while holding it and casting a spell with a casting time of 1 action. Choose one creature affected by the spell. That creature has disadvantage on the first saving throw it makes against the spell. A spell can be modified only by a single mind crystal or metamagic, not both."
	},
	"quickened" : {
		rarity : "rare",
		description : "I can use this crystal once while holding it and casting a spell with a casting time of 1 action. The spell's casting time is changed to 1 bonus action for this casting. A spell can be modified only by a single mind crystal or metamagic, not both."
	},
	"subtle" : {
		rarity : "common",
		description : "I can use this crystal once while holding it and casting a spell with a casting time of 1 action. The spell doesn't require any somatic or verbal components for this casting. A spell can be modified only by a single mind crystal or metamagic, not both."
	}
}
MagicItemsList["mindblasting cap"] = {
	name : "Mindblasting Cap",
	source : [["PaBTSO", 218]],
	type : "wondrous item",
	rarity : "very rare",
	description : "As a bonus action once per dawn, I can use this cap to project psychic energy in a 60-ft cone. All in the area must make a DC 15 Int save or take 5d8 psychic damage and be stunned for 1 min. If saved, deals half damage and not stunned. Stunned creatures can repeat the save at the end of each of their turns.",
	descriptionFull : "This soft, violet cap bears stitching in the pattern of folds on a brain."+
	"\n   As a bonus action while wearing the cap, you can project psychic energy in a 60-foot cone. Each creature in that area must make a DC 15 Intelligence saving throw. On a failed save, a creature takes 5d8 psychic damage and has the stunned condition for 1 minute. On a successful save, the creature takes half as much damage only. At the end of each of its turns, a stunned creature can repeat the saving throw, ending the stunned condition on itself on a success."+
	"\n   Once this bonus action is used, it can't be used again until the next dawn.",
	attunement : true,
	action : [["bonus action", ""]],
	usages : 1,
	recovery : "dawn",
	weaponOptions : [{
		regExpSearch : /^(?=.*mindblasting)(?=.*cap).*$/i,
		name : "Mindblasting Cap",
		source : [["PaBTSO", 218]],
		ability : 0,
		type : "Magic Item",
		damage : [5, 8, "psychic"],
		range : "60-ft cone",
		description : "Int save or stunned for 1 min, re-save end of turn; Success - half damage, not stunned",
		abilitytodamage : false,
		modifiers : [7, 0],
		dc : true,
		selectNow : true
	}]
}
MagicItemsList["mindguard crown"] = {
	name : "Mindguard Crown",
	source : [["PaBTSO", 218]],
	type : "wondrous item",
	rarity : "very rare",
	description : "While I wear this adamantine crown, I have advantage on Intelligence, Wisdom, and Charisma saving throws, and I have resistance to psychic damage.",
	descriptionFull : "While you wear this adamantine crown, you have advantage on Intelligence, Wisdom, and Charisma saving throws, and you have resistance to psychic damage.",
	attunement : true,
	dmgres : ["Psychic"],
	savetxt : { text : ["Adv. on Int/Wis/Cha saves"] },
	advantages : [["Intelligence", true], ["Wisdom", true], ["Charisma", true]]
}
var PaBTSO_mudslickTowerFullDescription = [
	'You can use an action to place this 1-inch-diameter granite sphere on the ground and speak its command word, which is "petrification" in Terran. The sphere rapidly grows into a stout tower that remains until you use an action to touch the tower and speak the command word again, whereupon the tower shrinks back to a 1-inch-diameter granite sphere. The tower must be empty to shrink in this way. The tower bristles with muddy knobs that constantly extrude and retract across its surface, as though the tower were breathing through a coating of thick mud.',
	"Each creature in the area where the tower appears must make a DC 15 Dexterity saving throw, taking 10d10 bludgeoning damage on a failed save, or half as much damage on a successful one. In either case, the creature is pushed to an unoccupied space outside but next to the tower. Objects in the area that aren't being worn or carried take this damage and are pushed automatically."+
	"Whenever it expands, the mudslick tower merges with any natural stone it touches, awkwardly tipping and wedging itself to touch as much natural stone as it can.",
	"The tower is 20 feet on a side and 30 feet high, with arrow slits on all sides and a battlement atop it. Its interior is divided into two floors, with a ladder running along one wall to connect them. The ladder ends at a trapdoor leading to the roof. When activated, the tower has a small door on the side facing you. The door opens only at your command, which you can speak as a bonus action. It is immune to the knock spell and similar magic, such as that of a chime of opening.",
	"Although it looks like stone, the tower is made of adamantine, and its magic prevents creatures from tipping it over. The roof, the door, and the walls each have 100 hit points, immunity to damage from nonmagical weapons excluding siege weapons, and resistance to all other damage. While merged with natural stone, the mudslick tower has immunity to all damage. Only a wish spell can repair the tower (this use of the spell counts as replicating a spell of 8th level or lower). Each casting of wish causes the roof, the door, or one wall to regain 50 hit points."
];
MagicItemsList["mudslick tower"] = {
	name : "Mudslick Tower",
	source : [["PaBTSO", 218]],
	type : "wondrous item",
	rarity : "very rare",
	description : "As an action, I can command this granite sphere to expand to a 20-ft square, 30-ft high tower of adamantine. If it is empty, I can command it to shrink back down as an action. It has two floors  and a roof with battlements, connected by ladders. The front door only opens on my command, as a bonus action.",
	descriptionFull : PaBTSO_mudslickTowerFullDescription.join("\n   "),
	toNotesPage : [{
		name : "Features",
		note : desc(PaBTSO_mudslickTowerFullDescription).replace(/feet/ig, "ft").replace(/your/g, "my").replace(/(facing) you/ig, "$1 me").replace(/you /ig, "I ")
	}],
	action : [["action", " (expand/shrink)"]]
}
MagicItemsList["potion of psionic fortitude"] = {
	name : "Potion of Psionic Fortitude",
	source : [["PaBTSO", 219]],
	type : "potion",
	rarity : "uncommon",
	description : "Once as an action, I can drink this potion or administer it to another to grant, for 1 hour, advantage on saving throws to avoid or end the charmed or stunned condition. This black potion swirls with shimmering flecks of pink and purple.",
	descriptionFull : "When you drink this potion, you have advantage for 1 hour on saving throws you make to avoid or end the charmed or stunned condition on yourself."+
	"\n   This black potion swirls with shimmering flecks of pink and purple.",
	weight : 0.5
}
MagicItemsList["ring of the orator"] = {
	name : "Ring of the Orator",
	source : [["PaBTSO", 219]],
	type : "ring",
	rarity : "uncommon",
	description : "This ring has 6 charges, regaining 1d6 daily at dawn. I can use 1 charge to project my voice to be heard clearly by all within 1 mile, for 1 min. Magical silence, 1 ft stone, 1 inch metal, lead, or 3 ft wood blocks this. During this, I can have creatures I can see understand me even if they don't know the language I speak.",
	descriptionFull : "This ring has 6 charges. While you wear it, you can expend 1 of its charges to project your voice to be heard clearly by all creatures within 1 mile of yourself, regardless of intervening noise, for 1 minute. Magical silence, 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood blocks this projection. If you project your voice while speaking a language the listening creatures don't understand, you can make the creatures understand what you're saying. You must be able to see the creatures to make them understand. The ring regains 1d6 expended charges daily at dawn.",
	attunement : true,
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6"
}

// pub_20231017_Planescape.js
// This file adds the Character Options content from the "Planescape: Adventures in the Multiverse" set (the "Sigil and the Outlands" book) to MPMB's Character Record Sheet

// Define the source
SourceList["P:AitM"] = {
	name : "Planescape: Adventures in the Multiverse",
	abbreviation : "P:AitM",
	abbreviationSpellsheet : "PS",
	group : "Campaign Sourcebooks",
	campaignSetting : "Planescape",
	url : "https://dndstore.wizards.com/us/product/820944/planescape-adventures-in-the-multiverse-digital-plus-physical-bundle",
	date : "2023/10/17"
};

// Backgrounds from Sigil and the Outlands
BackgroundList["gate warden"] = {
	regExpSearch : /^(?=.*gate)(?=.*warden).*$/i,
	name : "Gate Warden",
	source : [["P:AitM", 7], ["UA:WotM", 3]],
	skills : ["Persuasion", "Survival"],
	gold : 10,
	languageProfs : [["Any (Abyssal, Celestial, or Infernal recommended)", 2]],
	equipleft : [
		["Blank book", "", 5],
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen or quill", "", ""],
		["Ring of keys to unknown locks", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Pouch (with coins)", "", 1]
	],
	feature : "Planar Infusion",
	trait : [
		"Strange events and otherworldly creatures don't phase me.",
		"I think in terms of exchange; something for something, nothing for nothing.",
		"I speak with an unusual cadence.",
		"I pepper my speech with borrowed words or curses from planar languages.",
		"I've seen enough to know that you can't take anyone at face value, so I scrutinize everyone.",
		"I have a superstitious habit I picked up from my gate-town, such as touching iron when I'm nervous or arranging objects in a specific order."
	],
	extra : [
		"Select a Trinket",
		"Vial pendant with glowing honey",
		"Whispering lead ingot thumbprint",
		"Two chiming lodestone spheres",
		"Skin-safe smoldering pebble of coal",
		"Light up white feather",
		"Hard to remove chain-link ring"
	]
};
BackgroundFeatureList["planar infusion"] = {
	description : "I spent a good amount of time somewhere influenced by planar forces. I'm accustomed to experiences that would leave others reeling in terror or captivated by beauty, and I'm comfortable dealing with fiends and celestials. I know where to find free, modest lodging and food in the community I grew up in. Also, I gain the Scion of the Outer Planes feat.",
	source : [["P:AitM", 7], ["UA:WotM", 3]],
	eval : function() { AddFeat("Scion of the Outer Planes"); },
	removeeval : function() { RemoveFeat("Scion of the Outer Planes"); }
};

BackgroundList["planar philosopher"] = {
	regExpSearch : /^(?=.*planar)(?=.*philosopher).*$/i,
	name : "Planar Philosopher",
	source : [["P:AitM", 8]],
	skills : ["Arcana"],
	skillstxt : "Arcana, and one skill determined by your faction or one skill of your choice.",
	gold : 10,
	languageProfs : [2],
	equipleft : [
		["Portal key (e.g. bag of golden tea leaves)", "", 3],
		["Manifesto of my guiding philosophy", "", 1]
	],
	equipright : [
		["Common clothes in faction's style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	],
	feature : "Conviction",
	trait : [
		"I don't venerate any gods. With time, we can be as powerful as them or greater.",
		"Experience is everything, I live in the moment.",
		"When things crumble, I find meaning in the dust.",
		"Life thrives through order, and I seek to maintain that order.",
		"When others make plans, the multiverse laughs and so do I.",
		"I know what's right, and none will stand in my way."
	],
	extra : [
		"Select a Trinket",
		"Inscribed locket with image of mentor",
		"Cranium rat skull with glass eyes",
		"Torn parchment with half a puzzle",
		"Bracelet of twisted razorvine stems",
		"Fragment of verdigris bronze blade",
		"Broken symbol of forgotten god"
	]
};
AddBackgroundVariant("planar philosopher", "planar philosopher of athar", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*athar).*$/i,
	name : "Planar Philosopher of Athar",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Religion"],
	equipright : [
		["Common clothes in Athar style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of bleak cabal", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*bleak cabal).*$/i,
	name : "Planar Philosopher of Bleak Cabal",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Insight"],
	equipright : [
		["Common clothes in Bleak Cabal style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of doomguard", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*doomguard).*$/i,
	name : "Planar Philosopher of Doomguard",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Nature"],
	equipright : [
		["Common clothes in Doomguard style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of fated", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*fated).*$/i,
	name : "Planar Philosopher of Fated",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Intimidation"],
	equipright : [
		["Common clothes in Fated style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of fraternity of order", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*fraternity of order).*$/i,
	name : "Planar Philosopher of Fraternity of Order",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "History"],
	equipright : [
		["Common clothes in Fraternity of Order style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of hands of havoc", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*hands of havoc).*$/i,
	name : "Planar Philosopher of Hands of Havoc",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Stealth"],
	equipright : [
		["Common clothes in Hands of Havoc style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of harmonium", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*harmonium).*$/i,
	name : "Planar Philosopher of Harmonium",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Perception"],
	equipright : [
		["Common clothes in Harmonium style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of heralds of dust", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*heralds of dust).*$/i,
	name : "Planar Philosopher of Heralds of Dust",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Medicine"],
	equipright : [
		["Common clothes in Heralds of Dust style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of mercykillers", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*mercykillers).*$/i,
	name : "Planar Philosopher of Mercykillers",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Survival"],
	equipright : [
		["Common clothes in Mercykillers style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of mind's eye", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*mind's eye).*$/i,
	name : "Planar Philosopher of Mind's Eye",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Persuasion"],
	equipright : [
		["Common clothes in Mind's Eye style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of society of sensation", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*society of sensation).*$/i,
	name : "Planar Philosopher of Society of Sensation",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Performance"],
	equipright : [
		["Common clothes in Society of Sensation style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
AddBackgroundVariant("planar philosopher", "planar philosopher of transcendent order", {
	regExpSearch : /^(?=.*planar)(?=.*philosopher)(?=.*transcendent order).*$/i,
	name : "Planar Philosopher of Transcendent Order",
	source : [["P:AitM", 8]],
	skills : ["Arcana", "Athletics"],
	equipright : [
		["Common clothes in Transcendent Order style", "", 3],
		["Pouch (with coins from different planes)", "", 1]
	]
});
BackgroundFeatureList["conviction"] = {
	description : "I subscribe to a distinct philosophy that seeks to understand the nature of the planes or a hidden truth of the multiverse and spread my philosophy. I am part of a network of like-minded believers who provide me free, modest lodging and food at any of their holding or the homes of other faction members. Also, I gain the Scion of the Outer Planes feat.",
	source : [["P:AitM", 8], ["UA:WotM", 4]],
	eval : function() { AddFeat("Scion of the Outer Planes"); },
	removeeval : function() { RemoveFeat("Scion of the Outer Planes"); }
};

// Feats from Sigil and the Outlands
FeatsList["scion of the outer planes"] = {
	name : "Scion of the Outer Planes",
	source : [["P:AitM", 12]],
	description : "I am adept at navigating planar pathways and the strange realities of the outer planes. I can select a plane and gain resistance to a damage type and learn a cantrip associated with that plane. I can cast the cantrip without material components. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
	descriptionFull : "Your connection to an Outer Plane infuses you with the energy there. Choose a type of plane listed in the Planar Infusion table. Your choice gives you resistance to a damage type and the ability to cast a cantrip, as specified in the table. You can cast this cantrip without material components, and your spellcasting ability for it is Intelligence, Wisdom, or Charisma (choose when you select this feat)."+
	toUni("\n\nPlane\t\tResistance\tCantrip")+
	"\nChaotic Outer\tPoison\t\tMinor Illusion"+
	"\nEvil Outer  \tNecrotic\t\tChill Touch"+
	"\nGood Outer  \tRadiant\t\tSacred Flame"+
	"\nLawful Outer\tForce\t\tGuidance"+
	"\nThe Outlands\tPsychic\t\tMage Hand",
	prerequisite : "Planescape Campaign",
	spellcastingAbility : [4,5,6],
	choices : ['Chaotic Outer Plane (Poison, Minor Illusion)', 'Evil Outer Plane (Necrotic, Chill Touch)', 'Good Outer Plane (Radiant, Sacred Flame)', 'Lawful Outer Plane (Force, Guidance)', 'The Outlands (Psychic, Mage Hand)'],
	'chaotic outer plane (poison, minor illusion)' : {
		name : "Scion of the Outer Planes (Chaotic Outer Plane)",
		description : "I am adept at navigating planar pathways and the strange realities of the outer planes. My connection to a chaotic outer plane gives me resistance to poison damage and I know the Minor Illusion cantrip, which requires no material components. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : {
			name : "Chaotic Outer Plane",
			spells : ["minor illusion"],
			selection : ["minor illusion"],
			firstCol : "atwill"
		},
		dmgres : ["Poison"],
		spellChanges : {
			"minor illusion" : {
				components : "S",
				compMaterial : "",
				changes : "Using Scion of the Outer Planes, I can cast Minor Illusion without material components."
			}
		}
	},
	'evil outer plane (necrotic, chill touch)' : {
		name : "Scion of the Outer Planes (Evil Outer Plane)",
		description : "I am adept at navigating planar pathways and the strange realities of the outer planes. I'm infused with or have ancestry from an evil outer plane. This connection gives me resistance to necrotic damage and I know the Chill Touch cantrip. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : {
			name : "Evil Outer Plane",
			spells : ["chill touch"],
			selection : ["chill touch"],
			firstCol : "atwill"
		},
		dmgres : ["Necrotic"]
	},
	'good outer plane (radiant, sacred flame)' : {
		name : "Scion of the Outer Planes (Good Outer Plane)",
		description : "I am adept at navigating planar pathways and the strange realities of the outer planes. I'm infused with or have ancestry from an good outer plane. This connection gives me resistance to radiant damage and I know the Sacred Flame cantrip. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : {
			name : "Good Outer Plane",
			spells : ["sacred flame"],
			selection : ["sacred flame"],
			firstCol : "atwill"
		},
		dmgres : ["Radiant"]
	},
	'lawful outer plane (force, guidance)' : {
		name : "Scion of the Outer Planes (Lawful Outer Plane)",
		description : "I am adept at navigating planar pathways and the strange realities of the outer planes. I'm infused with or have ancestry from an lawful outer plane. This connection gives me resistance to force damage and I know the Guidance cantrip. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : {
			name : "Lawful Outer Plane",
			spells : ["guidance"],
			selection : ["guidance"],
			firstCol : "atwill"
		},
		dmgres : ["Force"]
	},
	'the outlands (psychic, mage hand)' : {
		name : "Scion of the Outer Planes (the Outlands)",
		description : "I am adept at navigating planar pathways and the strange realities of the outer planes. I'm infused with or have ancestry from a plane of the outlands. This gives me resistance to psychic damage and I know the Mage Hand cantrip. I can choose Int, Wis, or Cha as my spellcasting ability for this.",
		spellcastingAbility : [4,5,6],
		allowUpCasting : true,
		spellcastingBonus : {
			name : "The Outlands",
			spells : ["mage hand"],
			selection : ["mage hand"],
			firstCol : "atwill"
		},
		dmgres : ["Psychic"]
	}
};
FeatsList["agent of order"] = {
	name : "Agent of Order",
	source : [["P:AitM", 10]],
	description : "Once per turn when I damage a creature I see within 60 ft, I can deal +1d8 force damage to it, and it must succeed on a Wis save (DC 8 + Prof Bonus + spellcasting ability mod of Scion of the Outer Planes) or be restrained until my next turn starts. I can do this a number of times equal to my Prof Bonus per long rest.",
	calculate : "try { var a = Object.keys(CurrentSpells); var b = a.find(/scion of the outer planes/i); var c = CurrentSpells[a[b]]; var dc = c && c.calcSpellScores ? c.calcSpellScores.dc : '[Error: generate spell sheet first]'; } catch(e) { var dc = '[Error: select Scion of the Outer Planes feat]'; }; event.value = 'Once per turn when I damage a creature I see within 60 ft, I can deal +1d8 force damage to it, and it must succeed on a Wis save DC ' + dc + ' (= Scion of the Outer Planes spell DC) or be restrained until my next turn starts. I can do this a number of times equal to my Prof Bonus per long rest. [+1 to any one ability score].';",
	descriptionFull : "You can channel cosmic forces of order to gain these benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase one ability score of your choice by 1, to a maximum of 20."+
	"\n   " + toUni("Stasis Strike") + ". Once per turn, when you damage a creature you can see within 60 feet of yourself, you can deal an extra 1d8 force damage to the target, and it must make a Wisdom saving throw (DC equal to 8 + your proficiency bonus + the modifier of the spellcasting ability you chose for the Scion of the Outer Planes feat) as spectral bindings try to ensnare it. On a successful save, the target escapes. On a failed save, the target has the restrained condition until the start of your next turn. These bindings manifest as chains or some other symbol of stasis. You can use this benefit a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	prerequisite : "4th-level, Scion of the Outer Planes (Lawful Outer Plane) feat",
	prereqeval : function(v) {
		var iParentFeat = CurrentFeats.known.indexOf("scion of the outer planes");
		return v.characterLevel >= 4 && iParentFeat !== -1 && CurrentFeats.choices[iParentFeat] === 'lawful outer plane (force, guidance)';
	},
	scorestxt : "+1 to one ability score of your choice",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest"
};
FeatsList["baleful scion"] = {
	name : "Baleful Scion",
	source : [["P:AitM", 10]],
	description : "Once per turn, when I damage a creature I can see within 60 ft, I can also deal 1d6 + my Proficiency Bonus necrotic damage to it. I then regain a number of hit points equal to this necrotic damage dealt. I can do this a number of times equal to my Proficiency Bonus per long rest. [+1 to any one ability score]",
	descriptionFull : "You can channel cosmic forces of evil to gain these benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase one ability score of your choice by 1, to a maximum of 20."+
	"\n   " + toUni("Life-Draining Grasp") + ". Once per turn, when you damage a creature you can see within 60 feet of yourself, you can also deal necrotic damage to it. The necrotic damage equals 1d6 + your proficiency bonus, and you regain a number of hit points equal to this necrotic damage dealt. You can use this benefit a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	prerequisite : "4th-level, Scion of the Outer Planes (Evil Outer Plane) feat",
	prereqeval : function(v) {
		var iParentFeat = CurrentFeats.known.indexOf("scion of the outer planes");
		return v.characterLevel >= 4 && iParentFeat !== -1 && CurrentFeats.choices[iParentFeat] === 'evil outer plane (necrotic, chill touch)';
	},
	scorestxt : "+1 to one ability score of your choice",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest"
};
FeatsList["cohort of chaos"] = {
	name : "Cohort of Chaos",
	source : [["P:AitM", 10]],
	description : "When I roll a 1 or a 20 on an attack roll or save, a the magic of chaos flares up and I roll on the Chaotic Flare table to determine what happens (see notes for table). As a bonus action, my Proficiency Bonus per long rest, I can force a flare to happen. [+1 to any one ability score]",
	descriptionFull : "You can channel cosmic forces of chaos to gain these benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase one ability score of your choice by 1, to a maximum of 20."+
	"\n   " + toUni("Chaotic Flare") + ". When you roll a 1 or a 20 on an attack roll or a saving throw, the magic of chaos flows through you. Roll a d4 and consult the table below to determine what happens. A flare lasts until the end of your next turn, and a new flare can't occur until after the first flare ends."+
	toUni("\n\nd4\tFlare")+
	"\n  1\tBattle Fury: A creature of your choice that you can see is filled with reckless fury. It has advantage on attack rolls and disadvantage on ability checks."+
	"\n  2\tDisruption Field: Waves of energy ripple around you. Every creature that starts its turn within 5 feet of you, or that moves into that area for the first time on a turn, takes 1d8 force damage."+
	"\n  3\tUnbound: When you move, you can use some or all of your walking speed to teleport yourself once, along with any equipment you're wearing or carrying, up to the distance used to an unoccupied space that you can see."+
	"\n  4\tWailing Winds: Winds swirl in a 15-foot-radius sphere centered on you. You and any other creatures in that area have disadvantage on Wisdom saving throws."+
	"\n\n   You can also forcibly release a chaotic flare as a bonus action, rolling on the table as normal to determine the effects. You can use this bonus action a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	prerequisite : "4th-level, Scion of the Outer Planes (Chaotic Outer Plane) feat",
	prereqeval : function(v) {
		var iParentFeat = CurrentFeats.known.indexOf("scion of the outer planes");
		return v.characterLevel >= 4 && iParentFeat !== -1 && CurrentFeats.choices[iParentFeat] === 'chaotic outer plane (poison, minor illusion)';
	},
	scorestxt : "+1 to one ability score of your choice",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest",
	additional : "force flare",
	action : [["bonus action", " (force flare)"]],
	toNotesPage : [{
		name : "Chaotic Flare Table",
		note : [
			"When I roll a 1 or a 20 on an attack roll or a saving throw, the magic of chaos flows through Me. I roll a d4 on the table below to determine what happens. A flare lasts until the end of my next turn, and a new flare can't occur until after the first flare ends.",
			"As a bonus action, I can forcibly release a chaotic flare, rolling on the table as normal to determine the effects. I can use this bonus action a number of times equal to my proficiency bonus, and I regain all expended uses when you finish a long rest.",
			"\n d4  Flare",
			"1  Battle Fury: A creature of my choice that I can see is filled with reckless fury. It has advantage on attack rolls and disadvantage on ability checks.",
			"2  Disruption Field: Waves of energy ripple around me. Every creature that starts its turn within 5 ft of me, or that moves into that area for the first time on a turn, takes 1d8 force damage.",
			"3  Unbound: When I move, I can use some or all of my walking speed to teleport once, along with any equipment I'm wearing or carrying, up to the distance used to an unoccupied space that I can see.",
			"4  Wailing Winds: Winds swirl in a 15-ft radius sphere centered on me. Creatures in that area, myself included, have disadvantage on Wisdom saving throws."
		]
	}]
};
FeatsList["outlands envoy"] = {
	name : "Outlands Envoy",
	source : [["P:AitM", 10]],
	description : "I can cast Misty Step and Tongues each once per long rest without requiring a spell slot or material components. I can also cast them using a spell slot as normal. My spellcasting ability for these spells is the same as the one for the Scion of the Outer Planes feat. [+1 to any one ability score]",
	descriptionFull : "You have spent significant time in Sigil or the Outlands, the crossroads of the multiverse. Being steeped in converging planar energies grants you these benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase one ability score of your choice by 1, to a maximum of 20."+
	"\n   " + toUni("Crossroads Emissary") + ". You learn the misty step and tongues spells. You can cast each spell once using this feat without a spell slot, and you must finish a long rest before you can cast that spell in this way again. When you cast tongues using this feat, you require no material components. You can also cast these spells using spell slots you have of the appropriate level. The spells' spellcasting ability is the one chosen when you gained the Scion of the Outer Planes feat.",
	prerequisite : "4th-level, Scion of the Outer Planes (the Outlands) feat",
	prereqeval : function(v) {
		var iParentFeat = CurrentFeats.known.indexOf("scion of the outer planes");
		return v.characterLevel >= 4 && iParentFeat !== -1 && CurrentFeats.choices[iParentFeat] === 'the outlands (psychic, mage hand)';
	},
	scorestxt : "+1 to one ability score of your choice",
	spellcastingAbility : "scion of the outer planes",
	spellcastingBonus : {
		name : "Crossroads Emissary",
		spells : ["misty step", "tongues"],
		selection : ["misty step", "tongues"],
		firstCol : "oncelr",
		times : 2
	},
	spellChanges : {
		"tongues" : {
			components : SpellsList.tongues.components.replace("M", "M*"),
			compMaterial : "When using a spell slot: "+SpellsList.tongues.compMaterial,
			changes : "Using Outlands Envoy, I can cast Tongues once per long rest without expending a spell slot or requiring material components."
		}
	}
};
FeatsList["planar wanderer"] = {
	name : "Planar Wanderer",
	source : [["P:AitM", 11]],
	description : "After each long rest, I can gain acid, cold, or fire resistance, that lasts until my next long rest ends. I know the direction to the last portal I used while on the same plane as it. As an action, I can try to open or close a portal (portal cracker). As an action once per long rest, I can detect portals (portal sense). See notes.",
	descriptionFull : "You can draw on the forces of the multiverse to survive cosmic extremes and to traverse its infinite realms, granting you these benefits:"+
	"\n   " + toUni("Planar Adaptation") + ". When you finish a long rest, you gain resistance to either acid, cold, or fire damage (your choice) until you finish your next long rest."+
	"\n   " + toUni("Portal Cracker") + ". Your experience with portals allows you to open them without a portal key. As an action, you can concentrate on a portal you're aware of that is within 5 feet of yourself and make a DC 20 Intelligence (Arcana) check. On a failed check, you take 3d8 psychic damage and can't use this benefit on that portal again until you finish a long rest. On a successful check, you can force the portal open or closed for 1 hour. For that duration, the portal doesn't respond to its portal key unless a creature employing the key succeeds on a DC 20 Intelligence (Arcana) check as an action."+
	"\n   " + toUni("Portal Sense") + ". You know the direction to the last planar portal you used while you and the portal are on the same plane of existence. Moreover, as an action, you can detect the location of any portals within 30 feet of you that aren't behind total cover. Once you detect a portal with this action, you can't use the action again until you finish a long rest.",
	prerequisite : "4th-level, Scion of the Outer Planes feat",
	prereqeval : function(v) {
		return v.characterLevel >= 4 && CurrentFeats.known.indexOf("scion of the outer planes") !== -1;
	},
	dmgres : ["Acid/Cold/Fire"],
	action : [["action", " (Portal Cracker)"], ["action", " (Portal Sense)"]],
	usages : 1,
	recovery : "long rest",
	additional : "Portal Sense",
	toNotesPage : [{
		name : "Portal Cracker",
		note : [
			"My experience with portals allows me to open them without a portal key.",
			"As an action, I can concentrate on a portal I'm aware of that is within 5 ft of me and make a DC 20 Intelligence (Arcana) check.",
			"On a failed check, I take 3d8 psychic damage and can't do this on that portal again until I finish a long rest.",
			"On a successful check, I can force the portal open or closed for 1 hour. For that duration, the portal doesn't respond to its portal key unless a creature employing the key succeeds on a DC 20 Intelligence (Arcana) check as an action."
		]
	}, {
		name : "Portal Sense",
		additional : "1\xD7 per long rest",
		note : [
			"I know the direction to the last planar portal I used while I and the portal are on the same plane of existence.",
			"As an action, I can detect the location of any portals within 30 ft of me that aren't behind total cover.",
			"Once I detect a portal with this action, I can't use the action again until I finish a long rest."
		],
		amendTo : "Portal Cracker"
	}]
};
FeatsList["righteous heritor"] = {
	name : "Righteous Heritor",
	source : [["P:AitM", 11]],
	description : "As a reaction when I or a creature I can see within 30 ft takes damage, I can reduce the damage taken by 1d10 + my Proficiency Bonus. I can do this a number of times equal to my Proficiency Bonus per long rest. [+1 to any one ability score]",
	descriptionFull : "You can channel cosmic forces of good to gain these benefits:"+
	"\n   " + toUni("Ability Score Increase") + ". Increase one ability score of your choice by 1, to a maximum of 20."+
	"\n   " + toUni("Soothe Pain") + ". When you or a creature within 30 feet of you takes damage, you can use your reaction to reduce that damage by 1d10 + your proficiency bonus. You can use this benefit a number of times equal to your proficiency bonus, and you regain all expended uses when you finish a long rest.",
	prerequisite : "4th-level, Scion of the Outer Planes (Good Outer Plane) feat",
	prereqeval : function(v) {
		var iParentFeat = CurrentFeats.known.indexOf("scion of the outer planes");
		return v.characterLevel >= 4 && iParentFeat !== -1 && CurrentFeats.choices[iParentFeat] === 'good outer plane (radiant, sacred flame)';
	},
	scorestxt : "+1 to one ability score of your choice",
	usages : "Proficiency bonus per ",
	usagescalc : "event.value = How('Proficiency Bonus');",
	recovery : "long rest",
	action : [["reaction", ""]]
};


// Magic Items from Sigil and the Outlands
MagicItemsList["mimir"] = {
	name : "Mimir",
	source : [["P:AitM", 13]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "As a bonus action, I can stow or toss this skull-shaped device in the air to activate it, making it float 1d3 ft near me. Once per dawn as an action while active, I can use it to cast Legend Lore. It speaks the revieled lore aloud. While active, it answers questions about the planes of existence I or someone I designate ask it.",
	descriptionLong : "As a bonus action, I can toss this skull-shaped device covered with planar sigils into the air to activate it, causing it to float 1d3 ft near me but considered worn by me. I can use another bonus action to seize and stow it. It has AC 22, 25 HP, immunity to poison and psychic damage, and resistance to all other damage. Another can use an action to grab it with a successful unarmed strike or DC 22 Acrobatics check. Once per dawn as an action while active, I can use it to cast Legend Lore. It speaks the revealed lore aloud. While active, it answers questions about the planes of existence I or someone I designate ask it.",
	descriptionFull : "This skull-shaped device is filled with knowledge. The device weighs 5 pounds and is covered with subtle etchings of planar sigils."+
	"As a bonus action, you can toss the device into the air, whereupon it floats at a distance of 1d3 feet from you and you can access its properties. While the mimir is floating, a creature other than you can use an action to grasp or net the device, either by making a successful unarmed strike against AC 22 or a successful DC 22 Dexterity (Acrobatics) check. You can use a bonus action to seize and stow the device."+
	"The device has AC 22, 25 hit points, immunity to poison and psychic damage, and resistance to all other damage. It is considered to be an object that is being worn while it is floating near you."+
	toUni("\n   Esoteric Knowledge") + ". While the device is floating, you can use an action to cast legend lore from the device. The device speaks the revealed lore aloud. Once this property has been used, it can't be used again until the next dawn."+
	toUni("\n   Planar Knowledge") + ". The device knows basic, useful information about the planes of existence. While the device is floating, it verbally answers questions you or anyone you designate poses to it about that topic. It knows the information about the planes in the Dungeon Master's Guide, as well as basic information about the gate-towns of the Outlands (presented in chapter 3 of Sigil and the Outlands).",
	action : [["bonus action", " (activate/stow)"]],
	weight : 5,
	usages : 1,
	recovery : "dawn",
	additional : "Legend Lore",
	spellcastingBonus : [{
		name : "once per dawn",
		spells : ["legend lore"],
		selection : ["legend lore"],
		firstCol : "oncelr"
	}]
};
MagicItemsList["portal compass"] = {
	name : "Portal Compass",
	source : [["P:AitM", 13]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "This portable arcane instrument points in the direction of the last portal it passed through while it and the portal are on the same plane of existence. If that portal no longer exists, the needle becomes static until the compass passes through a new portal.",
	descriptionFull : "This portable arcane instrument points in the direction of the last portal it passed through while it and the portal are on the same plane of existence. If that portal no longer exists, the needle becomes static until the compass passes through a new portal."
};
MagicItemsList["sensory stone"] = {
	name : "Sensory Stone",
	source : [["P:AitM", 13]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "This stone stores a single experience. As an action, one touching the stone can experience it harmlessly. As a reaction, I can replace the experience within with a new, six-second sensation experienced by a creature within 30 ft. As a bonus action, I can destroy it to end the charmed or frightened effect on myself.",
	descriptionFull : "This small, smooth stone contains the essence of a single experience."+
	"As an action, you or a willing creature you designate can touch the stone and experience the sensation as if it happened to the designated creature. The illusory experience is fleeting and harmless, however real it might feel in the moment."+
	toUni("\n   Record Sensation") + ". You can use your reaction to record a short sensation lasting no longer than 6 seconds experienced by a creature of your choice within 30 feet of yourself, infusing the essence of that experience into the stone. This replaces any sensation already stored within the stone."+
	toUni("\n   Siphon Sensation") + ". As a bonus action, you can draw on the stone's magic to end the charmed or frightened condition on yourself, destroying the stone in the process.",
	action : [
		["action", " (experience)"],
		["reaction", " (record)"],
		["bonus action", " (destroy to end charmed/frightened)"]
	]
};


// Spells from Sigil and the Outlands
SpellsList["gate seal"] = {
	name : "Gate Seal",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["P:AitM", 12]],
	level : 4,
	school : "Abjur",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M\u2020",
	compMaterial : "A broken portal key, which the spell consumes",
	duration : "24 h",
	description : "30-ft cube wherein all portals close and can't be opened, and no planar travel; SL6: until dispelled",
	descriptionFull : "You fortify the fabric of the planes in a 30-foot cube you can see within range. Within that area, portals close and can't be opened for the duration. Spells and other effects that allow planar travel or open portals, such as gate or plane shift, fail if used to enter or leave the area. The cube is stationary."+
		AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, the spell lasts until dispelled."
};
SpellsList["warp sense"] = {
	name : "Warp Sense",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["P:AitM", 12]],
	level : 2,
	school : "Div",
	time : "1 a",
	range : "Self",
	components : "V,S,M",
	compMaterial : "A razorvine leaf",
	duration : "Conc, 1 min",
	description : "Know presence of portals in 30 ft; 1 a DC 15 spell ability chk to see destination \u0026 portal key, ends spell",
	descriptionFull : "For the duration, you sense the presence of portals, even inactive ones, within 30 feet of yourself."+
	"\n   If you detect a portal in this way, you can use your action to study it. Make a DC 15 ability check using your spellcasting ability. On a successful check, you learn the destination plane of the portal and what portal key it requires, then the spell ends. On a failed check, you learn nothing and can't study that portal again using this spell until you cast it again."+
	"\n   The spell can penetrate most barriers but is blocked by 1 foot of stone, 1 inch of common metal, a thin sheet of lead, or 3 feet of wood or dirt."
};

// Beast from Turn of Fortune's Wheel
// Whirlwyrm is just a giant crocodile under a different name, it has been added to the SRD code as a `nameAlt`

// pub_20231030_CoA.js
// This file adds the magic items from the Chains of Asmodeus adventure from Extra Life to MPMB's Character Record Sheet

SourceList["CoA"] = {
	name : "Chains of Asmodeus",
	abbreviation : "CoA",
	group : "Extra Life",
	campaignSetting : "Forgotten Realms",
	url : "https://www.dmsguild.com/product/457996/Chains-of-Asmodeus",
	date : "2023/10/30",
	defaultExcluded : true
};

CoA_Corruption = {
	process : function(bAddRemove, sItem) {
		// Make a variable to remember the settings for this
		if (!CurrentVars.CoA_Corruption) {
			CurrentVars.CoA_Corruption = {
				items : [],
				present : false,
				savedAlert : false
			};
		}
		var bProcessIt = false;
		var bItemPresent = CurrentVars.CoA_Corruption.items.indexOf(sItem) !== -1;
		// If removing, test if present and the triggering item is in the list
		if (!bAddRemove && bItemPresent) {
			CurrentVars.CoA_Corruption.items.eject(sItem);
			if (CurrentVars.CoA_Corruption.items.length !== 0) {
				// Still items present, so don't change anything
				return;
			} else {
				// Removing note in final step if present 
				bProcessIt = CurrentVars.CoA_Corruption.present ? true : false;
				// Make pop-up appear at next corrupting item addition
				CurrentVars.CoA_Corruption.savedAlert = false;
			}
		} else if (bAddRemove) { // Adding
			// Add the item to the list of items processed
			if (!bItemPresent) CurrentVars.CoA_Corruption.items.push(sItem);
			if (CurrentVars.CoA_Corruption.savedAlert) {
				// The state of the alert was saved, so don't prompt and do nothing
				return;
			} else if (!CurrentVars.CoA_Corruption.present) {
				// If not present and dialog state was not saved, ask the user if the rules should be added to a notes page
				var oMsg = {
					cTitle : "Show Infernal Item Corruption (DM-only) Rules?",
					cMsg : 'The cursed infernal item "' + MagicItemsList[sItem].name + '" can cause corruption.\nDo you want to add the Infernal Item Corruption rules intended for the DM to a Notes page on your character sheet for reference?\n\nIMPORTANT: these rules are not intended to be read by players, only by the DM.\n\nThese notes will be automatically removed when you remove all corrupting items.',
					nIcon : 2, // Question
					nType : 2, // Yes,No
					oCheckbox : {
						cMsg : "Don't ask me again next time I add a corrupting item (unless I have removed all corrupting items)",
						bInitialValue : true,
						bAfterValue : false
					}
				};
				// Add the note if "Yes" was clicked
				bProcessIt = app.alert(oMsg) === 4;
				// Save the checkbox state
				CurrentVars.CoA_Corruption.savedAlert = oMsg.oCheckbox.bAfterValue;
			}
		}
		if (bProcessIt) {
			CurrentVars.CoA_Corruption.present = bAddRemove;
			processToNotesPage(bAddRemove, CoA_Corruption.toNotesPage, "items", {}, false, ["Chains of Asmodeus, page 271"]);
		}
		SetStringifieds("vars"); // Save the global variable to a field
	},
	toNotesPage : [{ // intentionally doesn't include a source
		name : "INFERNAL ITEM CORRUPTION",
		popupName : 'The "Infernal Item Corruption" rules from Chains of Asmodeus (page 271)',
		note : [
			"",
			"Cursed infernal items can be used by mortals, but they always require attunement. Once attuned, the mortal risks an increasing chance of being corrupted by the item., eventually transforming into a devil.",
			"   Mortals that receive express permission from Asmodeus, or that make an infernal contract to acquire a magic item, don't suffer these corrupting effects.",
			"",
			"1. STAGE ONE CORRUPTION: BEGINNINGS",
			"Once a character has attuned to a cursed infernal magic item or artifact, it begins the infernal corruption process. Each time that character finishes a long rest, they must make a DC 10 Wisdom save (tieflings have advantage on this save). On a success, the character suffers no effects, but the DC increases by 1 the next time they must make this save. On a failure, the character progresses to Stage Two unless Dispel Evil and Good is cast on them before their next long rest.",
			"   While in Stage One, the infernal corruption can be prevented by breaking attunement to the corrupting item. This prevents further Wisdom saves and resets the DC of the save, if the character were to attune to the item again.",
			"",
			"2. STAGE TWO CORRUPTION: SUFFERINGS",
			"While in Stage Two, the character becomes delusional, seeing plots against them where there are none. Additionally, each time they rest, they experience terrifying visions and infernal whispers. Whenever they finish a long rest, they take 1d12 necrotic damage, which ignores resistances and immunities and can't be healed until a Dispel Evil and Good or Remove Curse spell is cast on them. Once the character has taken this damage six times, they progress to Stage Three.",
			"   While in Stage Two, the infernal corruption can be removed with one of the following spells: Divine Word, Heal, Mass Heal, True Polymorph, True Resurrection, or Wish.",
			"\n3. STAGE THREE CORRUPTION: DEPARTINGS",
			"While in Stage Three, the character begins to suffer physical transformation, and slowly embraces evil. After they finish their first long rest upon entering Stage Three they must roll on the table below to determine how the infernal curse starts shaping them into a devil. In addition, a part-devil character is rendered infertile and detects as a Fiend to Detect Evil and Good spells and similar magic.",
			"",
			"   d10\tTransformation",
			"     1\tTheir fingertips elongate into claws",
			"     2\tNon-functional leathery wings sprout from their back",
			"     3\tDevilish horns grow upon their head",
			"     4\tEach night more and more of their skin burns, leaving charred patches",
			"     5\tOne eye turns milky white, the other turns yellow",
			"     6\tTheir spine painfully elongates into a skeletal tail",
			"     7\tTheir skin starts to calcify, turning portions into bone",
			"     8\tTheir feet painfully twist to resemble cloven hooves",
			"     9\tAll their hair falls out, replaced by tiny spikes",
			"   10\tAll their teeth fall out, with new jagged teeth tearing through the gums each morning",
			"",
			"The character begins to experience waking whispers pushing them towards evil and they suffer terrifying visions whenever they rest, breaking their spirit and pushing them further to evil. Each time they finish a short or long rest, they must make a DC 10 Wisdom save. If they performed at least one evil act, such as making a decision that increased the suffering of others, they make the save with disadvantage. When they fail the save, they progress to Stage Four.",
			"   While in Stage Three, the infernal corruption can be ended with one of the following spells: True Polymorph, True Resurrection or Wish.",
			"",
			"4. STAGE FOUR CORRUPTION: FINALITIES",
			"When the character finishes their first long rest after reaching Stage Four, the character's alignment shifts to lawful evil. They're now bound by the devil's code, requiring them to honor any pact made and acquire souls in service of Asmodeus. Lastly, their physical form changes, morphing to resemble a devil (DM's choice).",
			"   Once the character reaches Stage Four, the only two cures are the Wish spell, which counts as beyond the scope of the spell, or by signing an infernal contract with Asmodeus to reclaim their soul."
		].join("\n")
	}],
	description : "\n   " + toUni("Corrupting") + '. This item corrupts. See the "Infernal Item Corruption" rules (CoA 271).'
}

MagicItemsList["amulet of appearance"] = {
	name : "Amulet of Appearance",
	source : [["CoA", 267]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "My equipment always shines as if just polished and my wounds do not appear to others. I'm immune to being frightened and poisoned. However, whenever I would otherwise be affected by these conditions, a random non-evil humanoid on the material plane whom I have met is affected instead. I know this.",
	descriptionFull : "Your armor, weapons, and other equipment always shine as if just polished. Even if you're wounded, your wounds do not appear to others. You're immune to the frightened and poisoned conditions, as these would otherwise ruin your elegant appearance. However, whenever you would otherwise have been affected by one of these conditions, a random non-evil Humanoid on the Material Plane whom you have previously met gets the condition instead. You know this.",
	savetxt : { immune : ["frightened", "poisoned"] }
}
MagicItemsList["amulet of betrayal"] = {
	name : "Amulet of Betrayal",
	source : [["CoA", 267]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "As a bonus action, I can move one of the following conditions from myself to an ally within 60 ft: blinded, deafened, frightened, poisoned, stunned, exhaustion. When transferring exhaustion, all my exhaustion levels are moved. If the chosen ally is immune to a transferred condition, the transfer fails.",
	descriptionFull : "You can use a bonus action to move one of the following conditions from yourself to an ally within 60 feet of you: blinded, deafened, frightened, poisoned, stunned, exhaustion. When transferring exhaustion, move all your exhaustion levels. If the chosen ally is immune to a transferred condition, the transfer fails.",
	action : [["bonus action", ""]]
}
MagicItemsList["amulet of duplicity"] = {
	name : "Amulet of Duplicity",
	source : [["CoA", 267]],
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	cursed: true,
	description : "When I die, a copy of my naked corpse is left in my place while I'm brought to an extradimensional space. After 24 hours, I heal 1 hp and am brought back to the place I left, but with a different face. I have disadv. on Persuasion checks to reveal who I am. I can't relay this information and forget it when unattuning.",
	descriptionLong : "When I die, the amulet leaves a copy of my naked corpse in my place while I'm transported to an extradimensional space, stable at 0 hp. After 24 hours, I regain 1 hp and am returned to the place I left with different facial features. Only a Wish spell can restore my true identity. I have disadvantage on Charisma (Persuasion) checks to reveal myself. The amulet is cursed. Identifying it only shows it prevents death and one can't explain its power once attuned. When unattuned, one immediately forgets what the amulet does. A Remove Curse spell reveals the details of the curse but doesn't lift it from the amulet.",
	descriptionFull : "When you die, you're transported to an extradimensional space where you're stabilized at 0 hit points and kept in that state. The amulet creates a perfect copy of your corpse and places it where you were just before you died, but without any of your worn or carried items. After 24 hours, you regain 1 hit point and are returned to the location of your near-death. Everything about you is the same, except that your facial features are entirely different from before. Only a Wish spell can restore your true identity."+
	"\n   Until then, you have disadvantage on any Charisma (Persuasion) checks to attempt to reveal who you really are."+
	"\n   " + toUni("Curse") + ". An Identify spell or similar reveals only that the amulet can prevent death. Once you attune to the amulet, you can't describe its ability to any other creature, and if unattuned, you immediately forget what the amulet does. A Remove Curse spell reveals the details of the curse but does not remove it from the amulet."
}
MagicItemsList["bracers of asmodeus"] = {
	name : "Bracers of Asmodeus",
	source : [["CoA", 267]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	cursed: true,
	description : "These are cursed, corrupting, and give +2 AC while not wearing armor or using a shield. I can't unattune to them. They make me obsessed with scheming, manipulation, and always bartering for better deals, often using blackmail. If I decline an opportunity to make money at another's expense, I take 3d10 necrotic damage.",
	descriptionFull : "You have a +2 bonus to AC while wearing these bracers, if you do not wear armor or use a shield at the same time."+
	"\n   " + toUni("Curse") + ". While attuned to the bracers, you become obsessed with plotting, scheming, and manipulation. You always barter for better deals, often using secrets or leveraging other offers in the process. If you ever decline an opportunity to better yourself financially at another's expense, you immediately take 3d10 necrotic damage. Only the Remove Curse spell allows you to end attunement to this item."+
	CoA_Corruption.description,
	eval :       function() { CoA_Corruption.process(true,  "bracers of asmodeus") },
	removeeval : function() { CoA_Corruption.process(false, "bracers of asmodeus") },
	extraAC : [{
		mod : 2,
		magic : true,
		text : "I gain a +2 bonus to AC while I'm not wearing armor or using a shield.",
		stopeval : function (v) { return v.wearingArmor || v.usingShield; }
	}]
}
MagicItemsList["canian fork"] = {
	name : "Canian Fork",
	source : [["CoA", 267]],
	type : "weapon (trident)",
	rarity : "rare",
	attunement : true,
	cursed: true,
	description : "This magic, cursed, corrupting trident gives me +3 bonus to attack and damage rolls made with. I can't willing to part with it and can't unattune to it without Remove Curse. I'm vulnerable to radiant damage. When I receive magical healing I have to succeed on a DC 15 Con save or the healing has no effect.",
	descriptionFull : "You have a +3 bonus to attack and damage rolls made with this magic weapon. In addition, you can make one additional attack with it as a bonus action on each of your turns."+
	"\n   " + toUni("Curse") + ". You're unwilling to part with this weapon while attuned to it. You're also vulnerable to radiant damage and each time you receive magical healing, you must make a DC 15 Constitution saving throw."+
	"\n   On a failed save, the healing has no effect. Only the Remove Curse spell allows you to end attunement to this item."+
	CoA_Corruption.description,
	eval :       function() { CoA_Corruption.process(true,  "canian fork") },
	removeeval : function() { CoA_Corruption.process(false, "canian fork") },
	weight : 4,
	savetxt : { text : ["Vulnerable to radiant damage"] },
	action : [["bonus action", " attack"]],
	weaponOptions : [{
		baseWeapon : "trident",
		regExpSearch : /^(?=.*canian)(?=.*fork).*$/i,
		name : "Canian Fork",
		source : [["CoA", 267]],
		description : "Thrown, versatile (1d8); Bonus action: 1 attack",
		modifiers : [3, 3],
		selectNow : true
	}]
}
MagicItemsList["condensed order"] = {
	name : "Condensed Order",
	source : [["CoA", 267]],
	type : "wondrous item",
	rarity : "uncommon",
	description : "Once as an action, I can snuff this silvery powder extracted from those of a lawful persuasion, or administer it to another. The consumer is immune to the flesh warping feature of demonic ichor and gains advantage on saves against effects from a demonic source. These benefits last for 8 hours.",
	descriptionFull : "Condensed Order is a silvery powder that can be extracted from those of a lawful persuasion. Devils bound for the warfronts of Avernus take flasks and snuff boxes of the stuff to fortify themselves against exposure to the raw chaos of demons. Taking the substance requires an action and makes you immune to the flesh warping feature of demonic ichor. It also gives you advantage on saving throws against any effect from a demonic source. These benefits last for 8 hours."
}
MagicItemsList["demonbone polearm"] = {
	name : "Demonbone Polearm",
	nameTest : "Demonbone",
	source : [["CoA", 268]],
	type : "weapon (polearm)",
	rarity : "very rare",
	attunement : true,
	cursed: true,
	description : "As a reaction when damaged by a creature in reach, I can attack it once with this +2 polearm. It is cursed, I can't unattune to it and have disadv. with other weapons. If I take damage, I must make a DC 15 Wis save or go berserk: I attack those near to me until none remain in 60 ft or I'm calmed with a DC 15 Persuasion" + (typePF ? "." : "check."),
	descriptionLong : "I have a +2 bonus on attack and damage rolls made with this magic quarterstaff. As a reaction when I'm damaged by a creature in this weapon's reach, I can make one melee attack against it. This weapon is cursed, I'm unwilling to part with it, can't unattune to it without Remove Curse, and have disadvantage with other weapons. When I take damage, I must make a DC 15 Wisdom save or go berserk: I attack the nearest creature using this weapon with all my attacks, moving to the next nearest until none remain that I can sea or hear within 60 ft of me. I can also be calmed with a DC 15 Charisma (Persuasion) check.",
	descriptionFull : "You have a +2 bonus to attack and damage rolls made with this magic weapon. In addition, when you're damaged by a creature in reach, you may use your reaction to make one melee attack against it with this weapon."+
	"\n   " + toUni("Curse") + ". You're unwilling to part with this weapon while attuned to it. While attuned, you have disadvantage on attack rolls with weapons other than this one."+
	"\n   Whenever a hostile creature damages you, you must succeed on a DC 15 Wisdom saving throw or go berserk. While berserk, you must use your action on each of your turns to attack the creature nearest to you with the weapon. If you can make extra attacks as part of the Attack action, you use those extra attacks, moving to attack the next nearest creature after you fell your current target. If you have multiple possible targets, you attack one at random."+
	"\n   You're berserk until you start your turn with no creatures within 60 feet of you that you can see or hear. Alternatively, an ally can use an action to make a DC 15 Charisma (Persuasion) check and if successful, you're no longer berserk. Only the Remove Curse spell allows you to end attunement to this item."+
	CoA_Corruption.description,
	eval :       function() { CoA_Corruption.process(true,  "demonbone polearm") },
	removeeval : function() { CoA_Corruption.process(false, "demonbone polearm") },
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "polearm"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /\b(polearm|glaive|halberd|lance|pike|quarterstaff|spear)\b/i;
			return !testRegex.test(inObjKey) && (!inObj.baseWeapon || !testRegex.test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				var testRegex = /\b(polearm|glaive|halberd|lance|pike|quarterstaff|spear)\b/i;
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/demonbone/i).test(v.WeaponTextName) && (testRegex.test(v.thisWeapon[0]) || ( v.theWea.baseWeapon && testRegex.test(v.theWea.baseWeapon) ))) {
					output.magic = v.thisWeapon[1] + 2;
				}
			},
			'If I include the word "Demonbone" in a the name of a polearm, it will be treated as the magic weapon Demonbone Polearm. It adds +2 to hit and damage, can be used as a reaction when I\'m damaged by a creature within reach to attack them, an is cursed causing me to go beserk when I\'m damaged.'
		]
	},
	action : [["reaction", " (when damaged)"]]
}
MagicItemsList["gauntlets of rage"] = {
	name : "Gauntlets of Rage",
	source : [["CoA", 268]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a bard, sorcerer, warlock, or wizard",
	prereqeval : function(v) { return classes.known.bard || classes.known.sorcerer || classes.known.warlock || classes.known.wizard ? true : false; },
	description : "The first melee weapon attack I make after a short rest sends me into a fury for 1 minute. I can't cast spells or speak, am immune to charmed and frightened, and when I deal damage, I heal 2d8 hp and end this fury or one condition. Also, I can use a spell slot before a melee attack for +1d6 necrotic damage per spell level.",
	descriptionLong : "I gain the power of never-ending fury. The first melee weapon attack I make after I finish a short or long rest automatically send me into a special fury for 1 minute. While furious, I can't cast spells, can't verbally communicate, and am immune to the charmed and frightened conditions. Each time I deal damage, I regain 2d8 hit points and may immediately remove a condition I currently suffer from or end this fury. Also, while in this fury, I may spend a spell slot before I make a melee attack. Doing so causes the attack to deal an extra 1d6 necrotic damage per level of spell slot expended, if it hits.",
	descriptionFull : "You gain the power of never-ending fury. After you make a melee weapon attack, you automatically enter a special fury for 1 minute. While furious, you can't cast spells, can't verbally communicate, and are immune to the charmed and frightened conditions. Each time you deal damage, you regain 2d8 hit points and may immediately remove a condition you currently suffer from or end this fury. Additionally, while in this fury, you may spend a spell slot before you make a melee attack. Doing so causes the attack to deal an extra 3 (1d6) necrotic damage per level of spell slot expended, if the attack hits. Once used you may not use this fury again until you finish a short or long rest.",
	usages : 1,
	recovery : "short rest",
	savetxt : { text : ["Immune to charmed and frightened in fury"] }
}
MagicItemsList["infernal amulet"] = {
	name : "Infernal Amulet",
	source : [["CoA", 268]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	cursed: true,
	description : "While wearing this amulet, I can use it as a spellcasting focus for my spells, and it grants a +2 bonus to my spell save DC and spell attack bonus. It is cursed and corrupting. I'm unwilling to part with it and require Remove Curse to unattune to it. It gives me disadvantage on Strength saving throws and Strenght checks.",
	descriptionFull : "While wearing this amulet, you can use it as a spellcasting focus for your spells, and it grants a +2 bonus to your spell save DC and spell attack bonus."+
	"\n   " + toUni("Curse") + ". You're unwilling to part with this amulet while attuned to it and you wear it always. While wearing the amulet you have disadvantage on Strength saving throws and Strength checks. Only the Remove Curse spell allows you to remove the item and end attunement."+
	CoA_Corruption.description,
	eval :       function() { CoA_Corruption.process(true,  "infernal amulet") },
	removeeval : function() { CoA_Corruption.process(false, "infernal amulet") },
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type != "prepare") return 2;
			},
			"While wearing the Infernal Amulet my spell save DC and spell attack bonus each increase by 2."
		]
	},
	advantages : [["Athletics", false], ["Strength", false]]
}
if (typePF) MagicItemsList["infernal amulet"].savetxt = { text : ["Disadv. on Str saves/checks"] }
MagicItemsList["infernal plate armor"] = {
	name : "Infernal Plate Armor",
	source : [["CoA", 268]],
	type : "armor (plate)",
	rarity : "very rare",
	attunement : true,
	cursed: true,
	description : "While wearing this armor, I gain a +2 bonus to AC. This armor is cursed and corrupting. I can't take it off or unattune to it without Remove Curse. It makes me vulnerable to the following damage types: force, lightning, psychic, radiant, and thunder.",
	descriptionFull : "While wearing this armor, you gain a +2 bonus to AC."+
	"\n   " + toUni("Curse") + ". Once you wear this armor, and are attuned to it, you can't remove it. Only the Remove Curse spell allows you to end the attunement and finally doff it. While wearing the armor, you're vulnerable to the following damage types: force, lightning, psychic, radiant, and thunder."+
	CoA_Corruption.description,
	eval :       function() { CoA_Corruption.process(true,  "infernal plate armor") },
	removeeval : function() { CoA_Corruption.process(false, "infernal plate armor") },
	weight : 65,
	armorOptions : [{
		regExpSearch : /^(?=.*infernal)(?=.*plate).*$/i,
		name : "Infernal Plate Armor",
		source : [["CoA", 268]],
		type : "heavy",
		ac : "18+2",
		stealthdis : true,
		weight : 65,
		strReq : 15,
		selectNow : true
	}],
	savetxt : { text : ["Vulnerable to force, lightning, psychic, radiant, and thunder damage"] },
}
MagicItemsList["knife of stolen resistance"] = {
	name : "Knife of Stolen Resistance",
	source : [["CoA", 268]],
	type : "weapon (dagger)",
	rarity : "rare",
	description : "As an action once per long rest, I can use this knife to carve a single infernal rune into the flesh of an unconscious Beast, Celestial, Dragon, Fey, or Giant. Over the next 10 minutes the creature dies in agony, only Wish can stop this. If the creature has any resistances or immunities, I gain those while its dying.",
	descriptionFull : "Using an action, you carve a single infernal rune into the flesh of an unconscious Beast, Celestial, Dragon, Fey, or Giant with this knife. Over the next 10 minutes the creature dies an agonizing death that can't be prevented short of the Wish spell. If the creature has any resistances or immunities, you gain those resistances and immunities until the creature dies or a Wish spell is used to save the creature. The knife's power can't be used again until you finish a long rest.",
	weight : 1,
	action : [["action", ""]],
	usages : 1,
	recovery : "long rest",
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*knife)(?=.*stolen)(?=.*resistance).*$/i,
		name : "Knife of Stolen Resistance",
		source : [["CoA", 268]],
		selectNow : true
	}]
}
MagicItemsList["ring of collecting"] = {
	name : "Ring of Collecting",
	source : [["CoA", 268]],
	type : "ring",
	rarity : "very rare",
	attunement : true,
	description : "As an action once per dawn, I can use this ring to cast Tiny Hut. As a bonus action, I can disintegrate an up to Medium sized, nonmagical piece of art within 60 ft. That art now appears inside the tiny hut, vanishing forever if removed from it. For every 1000 gp of art added, the tiny hut get +1 ft radius and lasts +1 hour.",
	descriptionLong : "As an action once per dawn, I can use this ring to cast Leomund's Tiny Hut. As a bonus action, I can use this ring to disintegrate an up to Medium sized, nonmagical piece of art (drawing, painting, or sculpture) within 60 ft. That art now appears inside the tiny hut, for me to appreciate whenever I desire. If I try to remove this art from the tiny hut, it vanishes forever. I can steadily improve this space, but only by denying such beauty from the rest of the world. For every 1000 gp of art acquired, the tiny hut increases in size by adding +1 ft to its radius and lasts +1 hour.",
	descriptionFull : "While wearing this ring you can use it to cast the Leomund's Tiny Hut spell as an action. Once this property is used, it can't be used again until the next dawn. Additionally, as a bonus action, you can use the ring to disintegrate any nonmagical piece of art (drawing, painting, or sculpture) within 60 feet that is no larger than Medium-sized. That art now appears inside the tiny hut, for you to appreciate whenever you desire. If you try to remove this art from the tiny hut, it vanishes forever. You can steadily improve this space, but only by denying such beauty to the rest of the world. For every 1,000 gp of art acquired, the tiny hut increases in size by adding another foot to its radius and lasts one additional hour.",
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["leomund's tiny hut"],
		selection : ["leomund's tiny hut"],
		firstCol : "oncelr"
	}],
	spellChanges : {
		"leomund's tiny hut" : {
			time : "1 a",
			duration : "8h+1h/1k gp",
			description : "10ft+1ft/1000 gp rad immobile dome of force; 9 Medium crea; blocks magic; ends if I leave; see book",
			changes : "Using the Ring of Collecting, I can cast Leomund's Tiny Hut as an action instead of taking 1 minute. Once this property is used, it can't be used again until the next dawn. For every 1000 gp of art acquired, the tiny hut increases in size by adding +1 ft to its radius and lasts +1 hour."
		}
	},
	usages : 1,
	recovery : "dawn",
	additional : "Leomund's Tiny Hut",
	action : [["bonus action", " (steal art)"]]
}
MagicItemsList["ring of the copycat"] = {
	name : "Ring of the Copycat",
	source : [["CoA", 268]],
	type : "ring",
	rarity : "legendary",
	attunement : true,
	description : "As a reaction when an ally within 60 ft casts a spell, I can cast it as well as long as I can't normally cast it and it requires 10 gp or less material components. The cloned spell uses the original caster's abilities, originates from me and I choose its targets, but my ally can't cast this spell again until they finish a long rest.",
	descriptionFull : "You gain the ability to channel energy from allies to cast spells, even if you normally can't. When an ally within 60 feet of you casts a spell that you normally can't cast and that requires 10 gp or fewer in material components, you may use a reaction to cast that spell. When cast in this way, the spell is cast using your ally's spellcasting ability, spell save DC, and spell attack bonus, as needed. You decide this cloned spell's target, as specified in the spell's description, and the spell originates from you. After you use this ability, your ally can't cast this spell again until they finish a long rest.",
	action : [["reaction", ""]]
}
MagicItemsList["ring of treachery"] = {
	name : "Ring of Treachery",
	source : [["CoA", 269]],
	type : "ring",
	rarity : "very rare",
	attunement : true,
	description : "This ring has 3 charges, which are restored whenever I finish a long rest. As a reaction when I am damaged, I can expend one charge to transfer that damage to a random creature (allies included) within 60 ft of me.",
	descriptionFull : "This ring has 3 charges. While wearing this ring, when you're damaged, you may use a reaction to expend a charge and transfer that damage to a random creature (which could include an ally) within 60 feet. All charges are restored when you finish a long rest.",
	action : [["reaction", " (when damaged)"]],
	usages : 3
}
MagicItemsList["sage's mirror"] = {
	name : "Sage's Mirror",
	source : [["CoA", 269]],
	type : "wondrous item",
	rarity : "rare",
	description : "This mirror has 3 charges, regaining all at dusk. As an action, I can expend 1 charge to cast either Find the Path or Legend Lore. With each use, it is apparent that the information gleaned from the mirror comes from a chamber in the Nine Hells where sages and scholars are tortured for the answers to each question.",
	descriptionFull : "This item has 3 charges and regains all charges at dusk. You can use an action and expend 1 of the mirror's charges to cast one of the following spells:"+
	"\n \u2022 Find the Path"+
	"\n \u2022 Legend Lore"+
	"\n   With each use, it is apparent that the information gleaned from the mirror comes from a chamber in the Nine Hells where sages and scholars are tortured for the answers to each question.",
	usages : 3,
	recovery : "Dusk",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["find the path", "legend lore"],
		selection : ["find the path", "legend lore"],
		firstCol : 1,
		times : 2
	}],
	spellChanges : {
		"find the path" : {
			time : "1 a",
			changes : "Using the Sage's Mirror, I can cast Find the Path as an action when I expend one of its charges."
		},
		"legend lore" : {
			time : "1 a",
			changes : "Using the Sage's Mirror, I can cast Legend Lore as an action when I expend one of its charges."
		}
	}
}
MagicItemsList["skull of selfish knowledge"] = {
	name : "Skull of Selfish Knowledge",
	source : [["CoA", 269]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "As an action, I can make this magical skull devour a nonmagical book, map, or scroll. Once devoured, the learning is forever available to me, but I can never write the information down or communicate it to others. It is for me alone.",
	descriptionFull : "You may use an action to make the magical skull devour a nonmagical book, map, or scroll. Once devoured the learning is forever available to you, but you can never write the information down or communicate it to others. It is for you alone.",
	action : [["action", ""]]
}
MagicItemsList["stygian spear"] = {
	name : "Stygian Spear",
	source : [["CoA", 270]],
	type : "weapon (spear or javelin)",
	rarity : "very rare",
	attunement : true,
	cursed: true,
	description : "This +2 weapon deals +1d6 damage when thrown. It returns to my hand immediately after it hits or misses. It is cursed and corrupting. I'm unwilling to part with it, require Remove Curse to unattune, and have disadv. with other weapons. On a 1 to hit, I attack the closest ally with adv. and deal +2d6 poison damage.",
	descriptionFull : "You have a +2 bonus to attack and damage rolls made with this magic weapon. When you throw it, it deals one extra die of damage on a hit. After you throw it and it hits or misses, it flies back to your hand immediately."+
	"\n   " + toUni("Curse") + ". You're unwilling to part with this weapon while attuned to it. In addition, you have disadvantage on attack rolls made with weapons other than this one."+
	"\n   Whenever you roll a 1 on an attack roll using this weapon, your target changes to your closest ally."+
	"\n   If there are multiple allies, randomly determine which is the target. Make a new attack roll with advantage against your ally. If the attack hits, in addition to the standard damage you deal an extra 2d6 poison damage. Only the Remove Curse spell allows you to end attunement to this item."+
	CoA_Corruption.description,
	eval :       function() { CoA_Corruption.process(true,  "stygian spear") },
	removeeval : function() { CoA_Corruption.process(false, "stygian spear") },
	choices : ["Javelin", "Spear"],
	"javelin" : {
		name : "Stygian Javelin",
		description : "This +2 javelin deals +1d6 damage when thrown. It returns to my hand immediately after it hits or misses. It is cursed and corrupting. I'm unwilling to part with it, require Remove Curse to unattune, and have disadv. with other weapons. On a 1 to hit, I attack the closest ally with adv. and deal +2d6 poison damage.",
		descriptionLong : "I have a +2 bonus to attack and damage rolls made with this magic javelin. When I throw it, it deals one extra die of damage on a hit and it flies back to my hand immediately after it hits or misses. It is cursed and corrupting. I'm unwilling to part with it, require Remove Curse to unattune to it, and gives me disadvantage on attacks with other weapons. Whenever I roll a 1 on an attack roll using this weapon, I instead attack my closest ally. I make a new attack roll with advantage against my ally and if it hits, this weapon deals an extra +2d6 poison damage. If there are multiple allies, randomly determine the target.",
		weaponOptions : [{
			baseWeapon : "javelin",
			regExpSearch : /^(?=.*stygian)(?=.*javelin).*$/i,
			name : "Stygian Javelin",
			source : [["CoA", 270]],
			description : "Returning, thrown; Thrown: +1d6 damage; On 1: adv. attack ally \u0026 +2d6 poison damage",
			modifiers : [2, 2],
			selectNow : true
		}],
		weight : 2
	},
	"spear" : {
		name : "Stygian\u200A Spear",
		description : "This +2 spear deals +1d6 damage when thrown. It returns to my hand immediately after it hits or misses. It is cursed and corrupting. I'm unwilling to part with it, require Remove Curse to unattune, and have disadv. with other weapons. On a 1 to hit, I attack the closest ally with adv. and deal +2d6 poison damage.",
		descriptionLong : "I have a +2 bonus to attack and damage rolls made with this magic spear. When I throw it, it deals one extra die of damage on a hit and it flies back to my hand immediately after it hits or misses. It is cursed and corrupting. I'm unwilling to part with it, require Remove Curse to unattune to it, and gives me disadvantage on attacks with other weapons. Whenever I roll a 1 on an attack roll using this weapon, I instead attack my closest ally. I make a new attack roll with advantage against my ally and if it hits, this weapon deals an extra +2d6 poison damage. If there are multiple allies, randomly determine the target.",
		weaponOptions : [{
			baseWeapon : "spear",
			regExpSearch : /^(?=.*stygian)(?=.*spear).*$/i,
			name : "Stygian Spear",
			source : [["CoA", 270]],
			description : "Returning, thrown, versatile (1d8); Thrown: +1d6 damage; On 1: adv. attack ally \u0026 +2d6 poison damage",
			modifiers : [2, 2],
			selectNow : true
		}],
		weight : 3
	}
}
MagicItemsList["sword of retribution"] = {
	name : "Sword of Retribution",
	nameTest : "of Retribution",
	source : [["CoA", 270]],
	type : "weapon (any sword)",
	rarity : "very rare",
	attunement : true,
	cursed: true,
	description : "Damage from this +3 sword can be regained only through resting. It is cursed and corrupting. I'm unwilling to part with it, require Remove Curse to unattune, and have disadv. with other weapons. After a long rest, I must make a DC 11 Con save or only get the benefits of a short rest due to nightmares.",
	descriptionLong : "I gain a +3 bonus to attack and damage rolls made with this sword. Hit points lost to this weapon's damage can be regained only through a short or long rest, rather than by regeneration, magic, or any other means. It is cursed and corrupting. I'm unwilling to part with it, require Remove Curse to unattune to it, and gives me disadvantage on attacks with other weapons. When I sleep, I experience nightmares of the past of the vengeful spirit possessing the sword, culminating in its death. After a long rest, I must make a DC 11 Constitution saving throw or only gain the benefits of a short rest.",
	descriptionFull : "You gain a +3 bonus to attack and damage rolls made with this sword. Hit points lost to this weapon's damage can be regained only through a short or long rest, rather than by regeneration, magic, or any other means."+
	"\n   " + toUni("Curse") + ". You're unwilling to part with this weapon while attuned to it. While attuned to this weapon, you also have disadvantage on attack rolls made with weapons other than this one."+
	"\n   The vengeful spirit possessing the sword shares its history and lust for vengeance with the wielder. After each successful long rest, you experience nightmares of the spirit's past, culminating in its death. When you wake, you must make a DC 11 Constitution saving throw. On a failed save, you only gain the benefits of a short rest. Only the Remove Curse spell allows you to end attunement to this item."+
	CoA_Corruption.description,
	eval :       function() { CoA_Corruption.process(true,  "sword of retribution") },
	removeeval : function() { CoA_Corruption.process(false, "sword of retribution") },
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/of retribution/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Only rest heals this damage; Cursed';
				}
			},
			'If I include the words "of Retribution" in the name of a sword, it will be treated as the magic weapon Sword of Retribution. It gives a +3 bonus to attack and damage. Damage it deals can\'t be healed except by resting, and it also bears a curse.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/of retribution/i).test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					output.magic = v.thisWeapon[1] + 3;
				}
			}, ''
		]
	}
}
var CoA_VialOfGreed = [
	"This small glass vial can stockpile resources for use in the future. Once stored, resources last for 1 century before vanishing. As an action you make the vial store any number of the following resources, which are magically consumed and converted into a violet-colored liquid:",
	"\u2022 Up to 31 days of food and/or drink. The flavors are lost, instead becoming tasteless.",
	"\u2022 Up to 7 days of alcohol. The flavors are lost, instead becoming tasteless.",
	"\u2022 Up to 5 magic scrolls that affect a single creature. The target of the spell is you, and if the spell requires concentration, you can concentrate.",
	"\u2022 Up to 5 magic potions. No more than 2 duplicate potions can be stored at a time.",
	"You may have more than one kind of resource in the vial, up to the limits expressed above. You can use a bonus action to consume one day of food (or alcohol) or activate one scroll or magic potion. If activating a magic scroll, the effects of that scroll must end before you can activate another scroll from the Vial of Greed."
];
MagicItemsList["vial of greed"] = {
	name : "Vial of Greed",
	source : [["CoA", 270]],
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "As an action, I can have this small glass vial magically store: food and drink (up to 31 days), alcohol (up to 7 days), magic scrolls that affect 1 creature (up to 5), and magic potions (up to 5, no 3 can be the same). As a bonus action, I can use or consume one of those stored, but the food, drink and alcohol is tasteless.",
	descriptionFull : CoA_VialOfGreed.join("\n   "),
	toNotesPage : [{
		name : "Vial of Greed Features",
		note : desc(CoA_VialOfGreed).replace(/is you/ig, "is me").replace(/you /ig, "I ")
	}],
	action : [
		["action", "Store in Vial of Greed"],
		["bonus action", "Use from Vial of Greed"]
	]
}
MagicItemsList["weapon of agonizing paralysis"] = {
	name : "Weapon of Agonizing Paralysis",
	nameTest : "of Agonizing Paralysis",
	source : [["CoA", 271]],
	type : "weapon (any melee)",
	rarity : "very rare",
	attunement : true,
	description : "This magic weapon has a +3 bonus to hit and damage. When it reduces a creature to 0 hp, they don't die but are instead healed to 1 hp and paralyzed. While paralyzed, infernal runes appear as if carved into their flesh and at the start of each of their turns they suffer immense pain and gain a level of exhaustion.",
	descriptionFull : "You have a +3 bonus to attack and damage rolls made with this magic weapon. When this weapon reduces a creature to 0 hit points, the creature doesn't die. Instead, infernal runes appear as if carved into their flesh and they're healed to 1 hit point. They now have the paralyzed condition until the condition is removed by a Lesser Restoration spell or similar magic. When the condition is removed, the runes disappear. At the start of each of their turns while they're paralyzed, the creature suffers immense pain and gains a level of exhaustion.",
	allowDuplicates : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		excludeCheck : function (inObjKey, inObj) {
			return /melee/i.test(inObj.range);
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && /^(?=.*agonizing)(?=.*paralysis).*$/i.test(v.baseWeaponName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'At 0 hp: paralyzed not dead';
				}
			},
			'If I include the words "of Agonizing Paralysis" in a the name of a melee weapon, it will be treated as the magic weapon Weapon of Agonizing Paralysis. It has +3 to hit and damage and when it brings a target to 0 hp, they are healed to 1 hp and paralyzed.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && /^(?=.*agonizing)(?=.*paralysis).*$/i.test(v.baseWeaponName)) {
					v.theWea.isMagicWeapon = true;
					output.magic = v.thisWeapon[1] + 3;
				}
			}, ''
		]
	}
}

// pub_20231114_BoMT.js
// This file adds the Character Options content from the "The Book of Many Things" book (from the "The Deck of Many Things" set) to MPMB's Character Record Sheet

// Define the source
SourceList["BoMT"] = {
	name : "The Book of Many Things",
	abbreviation : "BoMT",
	abbreviationSpellsheet : "MT",
	group : "Primary Sources",
	url : "https://dndstore.wizards.com/us/en/product/865604/the-deck-of-many-things-digital-plus-physical-bundle",
	date : "2023/11/14"
};


BackgroundList["rewarded"] = {
	regExpSearch : /rewarded/i,
	name : "Rewarded",
	source : [["BoMT", 57]],
	skills : ["Insight", "Persuasion"],
	gold : 18,
	languageProfs : [1],
	toolProfs : [["Gaming set", 1]],
	equipleft : [
		["Paper, sheets of", "", 5],
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen", "", ""],
		["Gaming set matching my proficiency", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Pouch (with coins)", "", 1]
	],
	feature : "Fortune's Favor",
	trait : [
		"A safe home is a foundation on which anything else can be built. (Key, Throne)",
		"I was elevated to heights I could never otherwise attain, and I won't waste my fortune. (Star, Sun)",
		"I try to be a source of inspiration and joy to others. Life is never as bad as you think! (Euryale, Jester)",
		"Courage and boldness can carry the day when all else fails. (Comet, Knight)",
		"My good fortune means I can lift others up as well. (Gem, Moon)",
		"Having the right answers is the first step to solving any problem, no matter how dire. (Fates, Sage)"
	],
	extra : [
		"Select a Trinket",
		"Perfumed scarf from admirer",
		"Crystal glows as candle",
		"Letter from far-off influential",
		"Symbol with unknown meaning",
		"Ever-crisp playing card",
		"Half a medallion"
	]
};
BackgroundFeatureList["fortune's favor"] = {
	description : "I have unexpected good fortune in life, caused by something like a genie who granted me wishes, extraordinary luck during a game, me honing my skills to endure a supernatural trial, or some other force that transformed my life. This boon is reflected in my choice of one free feat: Lucky, Magic Initiate, or Skilled.",
	source : [["BoMT", 57]],
	eval : function() {
		if (!IsNotImport) return;
		var featOptions = ['lucky', 'magic initiate', 'skilled'].filter(feat => CurrentFeats.known.indexOf(feat) === -1);
		if (!featOptions.length) {
			return;
		} else if (featOptions.length === 1) {
			var selectedFeat = featOptions[0];
		} else {
			var featNames = featOptions.map(feat => FeatsList[feat].name);
			var selectedFeat = featOptions[AskUserOptions("Fortune's Favor bonus feat", "The Fortune's Favor background feature offers a choice of a bonus feat.", featNames, 'radio', true, 'You can change what you select here by changing the feat selection in the corresponding section of the sheet.\nBe aware that if you change the selected feat and remove this background feature, the changed feat will not automatically be removed.', true)];
		}
		AddFeat(FeatsList[selectedFeat].name);
		SetFeatureChoice("background feature", "fortune's favor", false, selectedFeat);
	},
	removeeval : function() {
		var selectedFeat = GetFeatureChoice("background feature", "fortune's favor");
		if (selectedFeat) RemoveFeat(selectedFeat);
	}
};

BackgroundList["ruined"] = {
	regExpSearch : /ruined/i,
	name : "Ruined",
	source : [["BoMT", 58]],
	skills : ["Stealth", "Survival"],
	gold : 13,
	languageProfs : [1],
	toolProfs : [["Gaming set", 1]],
	equipleft : [
		["Cracked hourglass", "", 1],
		["Rusty manacles", "", 6],
		["Bottle, glass (half-empty)", "", 2],
		["Hunting trap", "", 25],
		["Gaming set matching my proficiency", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Pouch (with coins)", "", 1]
	],
	feature : "Still Standing",
	trait : [
		"I've changed from my past, and I work to live up to my new path. (Balance, Throne)",
		"Every moment is a gift I refuse to squander. (Euryale, Skull)",
		"Now that I've overcome having nothing, I can survive anything. (Fool, Ruin, Talons)",
		"I know enemies are set against me, and I always prepare for the worst. (Flames, Rogue)",
		"I interpret every event as part of a larger pattern I just haven't worked out yet. (Puzzle, Star)",
		"I must make up for so much time I've already lost. (Donjon, Void)"
	],
	extra : [
		"Select a Trinket",
		"Rusted scrap of family heirloom",
		"Ancient land deed, lost in obscurity",
		"Bauble once imbued with powerful magic",
		"Battered, pierced playing card",
		"Yellowed whispering humanoid tooth",
		"Keepsake from friend turned enemy"
	]
};
BackgroundFeatureList["still standing"] = {
	description : "I have weathered ruinous misfortune in my life and I possess hidden reserves because of this. Possibly I've had to keep my senses sharp, had to redouble my efforts to reclaim what is mine, had to stoically persevered through it, or experienced something else transformative. How I've dealt with this is reflected in my choice of one free feat: Alert, Skilled, or Tough.",
	source : [["BoMT", 58]],
	eval : function() {
		if (!IsNotImport) return;
		var featOptions = ['alert', 'skilled', 'tough'].filter(feat => CurrentFeats.known.indexOf(feat) === -1);
		if (!featOptions.length) {
			return;
		} else if (featOptions.length === 1) {
			var selectedFeat = featOptions[0];
		} else {
			var featNames = featOptions.map(feat => FeatsList[feat].name);
			var selectedFeat = featOptions[AskUserOptions("Still Standing bonus feat", "The Still Standing background feature offers a choice of a bonus feat.", featNames, 'radio', true, 'You can change what you select here by changing the feat selection in the corresponding section of the sheet.\nBe aware that if you change the selected feat and remove this background feature, the changed feat will not automatically be removed.', true)];
		}
		AddFeat(FeatsList[selectedFeat].name);
		SetFeatureChoice("background feature", "still standing", false, selectedFeat);
	},
	removeeval : function() {
		var selectedFeat = GetFeatureChoice("background feature", "still standing");
		if (selectedFeat) RemoveFeat(selectedFeat);
	}
};


FeatsList["cartomancer"] = {
	name : "Cartomancer",
	source : [["BoMT", 49]],
	description : 'I can use a card deck as a spellcasting focus. I learn and can do stage magic with Prestidigitation. I conceal its components as card tricks when doing so. When I finish a long rest, I can store a spell from my class\' spell list into a card, see "Hidden Ace" notes.',
	descriptionFull : "You have learned to channel your magic through a deck of cards. You can use a card deck as your spellcasting focus, and you gain the following benefits:"+
	"\n   " + toUni("Card Tricks") + ". You learn the Prestidigitation cantrip and can use it to create illusions that duplicate the effects of stage magic. When you use Prestidigitation in this way, you can conceal the verbal and somatic components of the spell as ordinary conversation and card handling."+
	"\n   " + toUni("Hidden Ace") + ". When you finish a long rest, you can choose one spell from your class's spell list and imbue that spell into a card. The chosen spell must have a casting time of 1 action, and it must be a level for which you have spell slots. The card remains imbued with this spell for 8 hours. While the card is imbued with the spell, you can use a bonus action to flourish the card and cast the spell within. The card then immediately loses its magic.",
	prerequisite : "4th-level, Spellcasting feature",
	prereqeval : function(v) { return v.characterLevel >= 4 && v.isSpellcastingClass; },
	spellcastingBonus : [{
		name : "Cartomancer",
		spells : ["prestidigitation"],
		selection : ["prestidigitation"],
		firstCol : "atwill"
	}],
	spellChanges : {
		"prestidigitation" : {
			components : "V,S*",
			compMaterial : "When I duplicate the effects of stage magic, I can conceal the verbal and somatic components of the spell as ordinary conversation and card handling.",
			description : "Harmless sensation, illusory image, snuff light, clean/soil/chill/warm/flavor, stage magic (hide comp)",
			changes : "When I duplicate the effects of stage magic, I can conceal the verbal and somatic components of the spell as ordinary conversation and card handling."
		}
	},
	action : [["bonus action", "Hidden Ace (use imbued card)"]],
	toNotesPage : [{
		name : "Hidden Ace",
		page3notes : true,
		note : [
			"When I finish a long rest, I can imbue a spell from my class' spell list into a card for 8 hours",
			"The spell must have a casting time of 1 action and be a level for which I have spell slots",
			"As a bonus action, I can flourish the card and cast the spell within; It then loses its magic"
		]
	}]
};


var BoMT = {
	toDescrFull : function (sDescr) {
		if (typeof sDescr !== "string") sDescr = sDescr.join("\n   ");
		return sDescr.replace(/\[\[.*?\]\]/g, "$1")
			.replace(/>>(.*?)<</g, function(a, match) { return toUni(match); });
	},
	to1stPerson : function (sDescr, joinStr) {
		if (typeof sDescr === "string") sDescr = [sDescr];
		return desc(sDescr, joinStr).replace(/\bf(oo|ee)t\b/ig, "ft")
			.replace(/you aren't/ig, "I'm not").replace(/you were/ig, "I was")
			.replace(/you are|you're/ig, "I am").replace(/\byou\b/ig, "I")
			.replace(/(aid|freeing|around|resurrected|beneath|between|\w\ws|by|of|to|for|on) I\b/ig, "$1 me")
			.replace(/(toward) I\b/ig, "$1s me")
			.replace(/(cards|items) me\b/ig, "$1 I")
			.replace(/\bI (to|a|an)\b/ig, "me $1")
			.replace(/your/g, "my").replace(/Your/g, "My")
			.replace(/\[\[.*?\]\]/g, "")
			.replace(/(\n *|\u2022 |\u25C6 )>>(.*?)( \(.*?\))?<<\. /g, function(a, p1, p2, p3, p4) {
				if (/\n   /.test(p1)) {
					return "\n\n   " + p2.toUpperCase() + p3.toLowerCase() + "\n   ";
				} else {
					return p1 + p2 + p3 + ": ";
				}
			});
	},
	"voidwalker armor" : "This armor is cursed, and attuning to it extends the curse to you. As long as you remain cursed, you're unwilling to part with the armor. Taking it off fails to end the curse. While cursed in this way, you feel disconnected from your body, continuously hearing whispers that call for you to join them. Whenever you finish a long rest while cursed, you must make a DC 11 Charisma saving throw. On a failed save, your soul is drawn from your body and trapped in an object on a different plane of existence. The object and location of this object are chosen by the DM[[ (but might be the House of Cards; see chapter 18)]]. While your soul is trapped in this way, your body is inert and doesn't age or require sustenance. Destroying the object frees your soul; otherwise, only a Wish spell can restore your soul to your body.",
	"telescopic transporter" : "This enormous telescope allows you to view distant celestial objects, including stars, Wildspace systems, and Astral Sea phenomena like the cities of deities or the petrified husks of dead gods."+
		"\n   After spending 1 hour calibrating the telescope, you can attempt to travel to the planet or celestial body at which the telescope is currently pointed. At the end of the hour, you make a DC 17 Intelligence (Arcana) check. On a successful check, you and eight other willing creatures touching the telescope, along with everything all travelers are wearing and carrying, safely teleport to unoccupied spaces at the intended destination. On a failed check, a mishap occurs instead. The DM rolls on the table below to determine the mishap or chooses a mishap that's good for the campaign."+
		"\n\nd6\tMishap"+
		"\n 1\tThe travelers appear adrift in the Astral Sea."+
		"\n 2\tThe travelers appear on a different plane of existence, determined randomly or chosen by the DM."+
		"\n 3\tExcess cosmic energy overloads the telescope, causing it to explode. Each creature within 60 feet of the telescope takes 8d6 necrotic damage. Any Humanoid who survives this damage is transformed into a different kind of creature, as if it had been subject to the Reincarnate spell."+
		"\n 4\tA creature from the Astral Sea (such as a githyanki knight) appears within 60 feet of the telescope. The DM decides its attitude."+
		"\n 5\tThe travelers appear on a different planet or celestial body in the Wildspace system nearest to their target destination."+
		"\n 6\tThe travelers arrive at their intended destination, but they each appear coated in harmless slime.",
	"sage's signet" : {
		"augury" : {
			time : "1 a",
			changes : "Using the Sage's Signet I can cast Augury once per dawn as an action."
		}
	},
	"shrieking greaves" : "The greaves are cursed, and becoming attuned to them extends the curse to you. You can't remove the greaves or end your attunement to them until you are targeted by a Remove Curse spell or similar magic."+
	"\n   You have disadvantage on saving throws against the frightened condition. Whenever you start your turn frightened, the greaves release an ear-piercing scream. You and each creature within 10 feet of you must make a DC 15 Constitution saving throw, taking 2d8 thunder damage on a failed save, or half as much damage on a successful one.",
	"spindle of fate" : [
		">>Battle Foreknowledge<<. When you roll initiative, you can expend 1 charge to add or subtract your proficiency bonus from the total roll.",
		">>Doom Foretold<<. As an action, you can expend 2 charges to target a creature within 30 feet of yourself and invoke that creature's doom. While the target is on the same plane of existence as you are, you can sense the direction to its location, and you know the direction of its movement if it's in motion. Additionally, once per turn when you deal damage to the doomed creature, you can roll 1d6 and add the number rolled to the damage roll. These benefits persist for 1 hour or until you target another creature with this effect.",
		">>Twist of Fate<<. When a creature within 60 feet of you makes a saving throw or an attack roll, you can use your reaction to expend 3 charges and alter the outcome, turning a failed saving throw into a successful one, a missed attack roll into a hit, or vice versa."
	],
	"starshot crossbow" : [
		"This crossbow is crafted from blackened wood, and its limbs bear pearl inlays depicting constellations. You ignore the loading property with this crossbow. If you load no ammunition in the weapon, it produces its own, automatically creating one piece of magic ammunition when you make a ranged attack with it. The ammunition created by the weapon vanishes the instant after it hits or misses a target. The crossbow has 3 charges and regains 1d3 expended charges daily at dawn.",
		">>Constellations<<. The crossbow is decorated with three constellations. As a bonus action, you can tap one of the constellations to invoke it, expending 1 charge and producing one of the following effects:",
		" \u2022 >>Balance<<. The next time you hit a creature with a ranged attack roll using this crossbow before the end of your next turn, you or another creature of your choice within 30 feet of you can regain hit points equal to 1d8 plus your proficiency bonus.",
		" \u2022 >>Flames<<. Until the end of your next turn, when you hit a creature with a ranged attack roll using this crossbow, the attack deals an additional 2d8 fire damage.",
		" \u2022 >>Rogue<<. Until the end of your next turn, you have the invisible condition, and anything you are wearing or carrying is also invisible."
	],
	"deck of miscellany" : [
		"Playing Card\t\tItem(s)",
		"  [3\u2666] Three of diamonds  \tWooden abacus",
		"  [4\u2666] Four of diamonds  \tFour vials of perfume",
		"  [5\u2666] Five of diamonds  \t5 days' worth of rations",
		"  [6\u2666] Six of diamonds\t\tIron pot",
		"  [7\u2666] Seven of diamonds  \tDisguise kit",
		"  [8\u2666] Eight of diamonds  \tWindow (up to 5 feet wide and 5 feet high), which you can place on a vertical surface up to 5 feet thick and which allows you to look through the surface",
		"  [9\u2666] Nine of diamonds  \tManacles",
		"[10\u2666] Ten of diamonds  \tTen sheets of parchment",
		"  [3\u2665] Three of hearts\t\tThree dagger",
		"  [4\u2665] Four of hearts\t\tFour flasks of oil",
		"  [5\u2665] Five of hearts\t\tFive silk robes",
		"  [6\u2665] Six of hearts\t\tForgery kit",
		"  [7\u2665] Seven of hearts\t\tQuarterstaff",
		"  [8\u2665] Eight of hearts\t\tFishing tackle",
		"  [9\u2665] Nine of hearts\t\tLeather pouch containing 18 gp",
		"[10\u2665] Ten of hearts\t\t10 crossbow bolt",
		"  [3\u2663] Three of clubs\t\tThree books, written in Common, about random historical events",
		"  [4\u2663] Four of clubs\t\tCanvas tent",
		"  [5\u2663] Five of clubs\t\t50 feet of coiled silk rope",
		"  [6\u2663] Six of clubs\t\tTwo crowbars",
		"  [7\u2663] Seven of clubs\t\tHealer's kit",
		"  [8\u2663] Eight of clubs\t\tEight gems worth 5 gp each",
		"  [9\u2663] Nine of clubs\t\tLamp",
		"[10\u2663] Ten of clubs\t\t10 feet of iron chain",
		"  [3\u2660] Three of spades\t\tThree spears",
		"  [4\u2660] Four of spades\t\tSteel mirror",
		"  [5\u2660] Five of spades\t\t15-foot wooden pole",
		"  [6\u2660] Six of spades\t\tBurlap sack",
		"  [7\u2660] Seven of spades\t\tTwo sets of fine clothes",
		"  [8\u2660] Eight of spades\t\tShovel",
		"  [9\u2660] Nine of spades\t\tLight hammer",
		"[10\u2660] Ten of spades\t\tTen arrows"
	],
	"deck of many more things" : {
		features : [
			"Like the Deck of Many Things, the Deck of Many More Things manifests differently on various worlds. While it can include fewer or different cards, it frequently appears with a Deck of Many Things as part of a combined deck of sixty-six illuminated cards. The combined deck is usually protected by a box or pouch. The forty-four cards of the Deck of Many More Things bear similar imagery to those in the Deck of Many Things and have potent magical effects, which are detailed later in this description. Notably, cards from the Deck of Many More Things are more likely to be beneficial, though about a third of them are still dangerous.",
			"Before you draw a card, you must declare how many cards you intend to draw and then draw them randomly. Unless a card allows you to draw additional cards, any cards drawn exceeding this number have no effect.",
			"As soon as you draw a card, its magic takes effect. You must draw each card you declared no more than 1 hour after the previous draw. Unless a card states otherwise, if you fail to draw the chosen number, the remaining number of cards fly from the deck and take effect simultaneously.",
			"Unless it is the Fool or the Jester card, a drawn card immediately takes effect, fades from existence, and reappears in the deck, making it possible to draw the same card multiple times.",
			"The DM can use the physical cards provided in The Deck of Many Things card set to build a combined Deck of Many Things and Deck of Many More Things, including whichever cards they desire. Alternatively, roll on the Deck of Many More Things table below to randomly determine what cards are drawn.",
			"\n1d100\tCard"+	"\t\t1d100\tCard",
			"01\tAberration"+	"\t\t   34\tMine",
			"02\tBalance*"+		"\t\t   35\tMonstrosity",
			"03\tBeast"+		"\t\t   36\tMoon*",
			"04\tBook"+			"\t\t   37\tOoze",
			"05\tBridge"+		"\t\t   38\tPath",
			"06\tCampfire"+		"\t\t   39\tPit",
			"07\tCavern"+		"\t\t   40\tPlant",
			"08\tCelestial"+	"\t\t   41\tPriest",
			"09\tComet*"+		"\t\t   42\tPrisoner",
			"10\tConstruct"+	"\t\t   43\tPuzzle*",
			"11\tCorpse"+		"\t\t   44\tRing",
			"12\tCrossroads"+	"\t\t   45\tRogue*",
			"13\tDonjon*"+		"\t\t   46\tRuin*",
			"14\tDoor"+			"\t\t   47\tSage*",
			"15\tDragon"+		"\t\t   48\tShield",
			"16\tElemental"+	"\t\t   49\tShip",
			"17\tEuryale*"+		"\t\t   50\tSkull*",
			"18\tExpert"+		"\t\t   51\tStaff",
			"19\tFates*"+		"\t\t   52\tStairway",
			"20\tFey"+			"\t\t   53\tStar*",
			"21\tFiend"+		"\t\t   54\tStatue",
			"22\tFlames*"+		"\t\t   55\tSun*",
			"23\tFool*"+		"\t\t   56\tTalons*",
			"24\tGem*"+			"\t\t   57\tTavern",
			"25\tGiant"+		"\t\t   58\tTemple",
			"26\tHumanoid"+		"\t\t   59\tThrone*",
			"27\tJester*"+		"\t\t   60\tTomb",
			"28\tKey*"+			"\t\t   61\tTower",
			"29\tKnight*"+		"\t\t   62\tTree",
			"30\tLance"+		"\t\t   63\tUndead",
			"31\tMage"+			"\t\t   64\tVoid*",
			"32\tMap"+			"\t\t   65\tWarrior",
			"33\tMaze"+			"\t\t   66\tWell",
			"67-00\tRoll again\n",
			"* Found in the Deck of Many Things as depicted in the Dungeon Master's Guide"
		],
		cards : [
			">>Aberration<<. You gain telepathy within a range of 90 feet.",
			">>Beast<<. You immediately transform into a random Beast with a CR of 5 or lower. Your game statistics—including your ability scores, hit points, and possible actions—are replaced by the Beast's game statistics, and any nonmagical equipment you're wearing or carrying melds into your new form and can't be used. Any magic items you're carrying drop in an unoccupied space within 5 feet of your new form."+
			"\n   You remain transformed in this way for 2d12 days; nothing can alter your form while you're under the effects of this card, but the Wish spell can end the transformation early. When you revert to your normal form, you return to the same state you were in when you initially transformed.",
			">>Book<<. You gain the ability to speak, read, and write 1d6 + 2 languages of your choice.",
			">>Bridge<<. You gain the ability to cast the Time Stop spell 1d3 times. Use your Intelligence, Wisdom, or Charisma as the spellcasting ability (your choice).",
			">>Campfire<<. You immediately gain the benefits of finishing a long rest.",
			">>Cavern<<. You gain a climbing speed equal to your walking speed. You also gain the ability to move up, down, across vertical surfaces, and along ceilings, while leaving your hands free.",
			">>Celestial<<. You sprout a pair of softly luminescent, feathered wings from your back and gain a flying speed of 30 feet.",
			">>Construct<<. A homunculus appears in an unoccupied space within 5 feet of you. The appearance of the homunculus is determined by the DM, and the homunculus treats you as its creator.",
			">>Corpse<<. You immediately drop to 0 hit points, have the unconscious condition, and must begin making death saving throws. Spells and other magical effects that restore hit points have no effect on you until you are stabilized. If you fail three death saving throws, you die and can be resurrected only by the Wish spell.",
			">>Crossroads<<. Roll a d20. If the roll is even, you age 1d10 years. If the roll is odd, you become younger by 1d10 years, to a minimum of 1 year. This effect can be undone only by the Wish spell, divine intervention, or similar magic.",
			">>Door<<. You gain the ability to cast the Gate spell 1d4 times, requiring no material components. Use your Intelligence, Wisdom, or Charisma as the spellcasting ability (your choice).",
			">>Dragon<<. A dragon egg appears at your feet and immediately hatches into a dragon wyrmling. The type of dragon is chosen by the DM. The wyrmling views you as its parent and is staunchly loyal to you and your allies.",
			">>Elemental<<. You become immune to one of the following damage types (choose immediately upon drawing this card): acid, cold, fire, lightning, or thunder.",
			">>Expert<<. Your Dexterity score increases by 2, to a maximum of 22.",
			">>Fey<<. A fey crossing opens into the Feywild, and you're immediately pulled through it, disappearing in a flash of rainbow-colored light. You draw no more cards."+
			"\n   The fey crossing appears as a shimmering fractal of light above the deck, and it remains open for 1 minute after the card is drawn. The precise location in the Feywild to which the fey crossing leads is determined by the DM.",
			">>Fiend<<. A powerful Fiend appears in a nearby unoccupied space and offers you a deal.[[ The precise nature of this deal is up to the DM, but usually the Fiend offers some material reward in exchange for you and your allies completing a task for the Fiend.]] The Fiend is indifferent to you and can be bargained with; it keeps its side of any bargain it makes, though it might twist the wording of any agreement to suit its purposes. If attacked, or if negotiations fail and you refuse the Fiend's offer, it returns to its home plane.",
			">>Giant<<. You immediately grow 2d10 inches in height, and your hit point maximum and current hit points both increase by 20.",
			">>Humanoid<<. You can immediately choose to stop drawing from the deck, regardless of how many cards you initially declared.",
			">>Lance<<. All your ability scores increase by 1, to a maximum of 20.",
			">>Mage<<. Your Intelligence score increases by 2, to a maximum of 22.",
			">>Map<<. At any time you choose within 1 year of drawing this card, you can mentally name or describe an object or individual that is familiar to you. You immediately know the location of the object or individual, as well as the distance between you and the object or individual, even if the object or individual is on a different plane of existence. If you named an individual, you know if they are alive and any conditions they have. If you named an object, you know if it is broken or not. If you named a magic item that has charges, you know how many charges it has remaining.",
			">>Maze<<. You gain 1d3 levels of exhaustion.",
			">>Mine<<. A pile of 2d6 gems (each worth 5,000 gp) and 1d10 chunks of precious ore (each worth 2,500 gp) appears at your feet."
		],
		cards2 : [
			">>Monstrosity<<. A Large or larger Monstrosity with a challenge rating of 10 or less (chosen by the DM) appears in an unoccupied space within 15 feet of you. The creature is hostile toward you and attacks immediately. The creature disappears when it is killed or when you are reduced to 0 hit points. If there isn't enough space for a Large or larger creature to appear, this card has no effect.",
			">>Ooze<<. A gelatinous cube immediately appears in your space and engulfs you. The gelatinous cube is hostile and remains until it is destroyed. If there isn't enough space for the gelatinous cube to appear, this card has no effect.",
			">>Path<<. Your walking speed increases by 10 feet.",
			">>Pit<<. A pit opens beneath you. You plummet 3d6 \xD7 10 feet, take damage from the fall, and have the prone condition.",
			">>Plant<<. You gain the ability to cast Speak with Plants without using a spell slot; you must finish a long rest before you can cast it this way again. If you have spell slots of 3rd level or higher, you can cast this spell using them. Use your Intelligence, Wisdom, or Charisma as the spellcasting ability (your choice).",
			">>Priest<<. Your Wisdom score increases by 2, to a maximum of 22.",
			">>Prisoner<<. Glowing chains made of magical force appear and wrap around you. You have the restrained condition until the chains are destroyed or you are freed. While you have this condition, you can't cast spells, and any magic items you're wearing or carrying have their properties suppressed. You draw no more cards. The chains are immune to damage and can't be dispelled using the Dispel Magic spell or similar magic. However, a Disintegrate spell destroys the chains instantly, freeing you. Another creature can also free you by succeeding on a DC 30 Dexterity check using thieves' tools.",
			">>Ring<<. A rare or rarer magic ring appears on your finger. If you have the attunement slots available, you're automatically attuned to the ring when it appears. The DM chooses the ring.",
			">>Shield<<. A rare or rarer suit of magic armor that you are proficient with appears in your hands. The DM chooses the armor. If you lack proficiency with any armor, your base AC instead now equals 12 + your Dexterity modifier while you aren't wearing armor.",
			">>Ship<<. You gain proficiency in three skills chosen by the DM.",
			">>Staff<<. A rare or rarer magic rod, staff, or wand appears in your hands. The DM chooses the item.",
			">>Stairway<<. You can choose to either decrease your number of declared draws by two or receive a rare or rarer wondrous item, which appears in your hands. The DM chooses the item.",
			">>Statue<<. You immediately have the petrified condition as your body is transformed into marble. The petrification lasts until you are freed with the Greater Restoration spell or similar magic.",
			">>Tavern<<. Your Charisma score increases by 2 to a maximum of 22.",
			">>Temple<<. A deity or entity of similar power becomes bound to aid you. At any point in time between drawing the card and when you die, you can use your action to call on this entity for divine intervention, and the entity is bound to answer. The parameters and nature of this intervention are chosen by the DM. If you die without having used this intervention, the deity fulfills its obligation by casting the Resurrection spell on you. Once the entity has answered your call for divine intervention or resurrected you, the entity is no longer bound to aid you.",
			">>Tomb<<. At any time you choose within 1 year of drawing this card, you can cast the True Resurrection spell once without expending a spell slot or requiring material components. Use your Intelligence, Wisdom, or Charisma as the spellcasting ability (your choice).",
			">>Tower<<. Draw two additional cards beyond your declared number of draws. The magic of these cards doesn't immediately take effect; instead, choose one of the two additional cards to keep, returning the other to the deck. The magic of the card you keep takes effect immediately thereafter.",
			">>Tree<<. Your skin immediately becomes rough, like tree bark. Your base AC now equals 15 + your Dexterity modifier while you aren't wearing armor, but you have vulnerability to fire damage. This transformation can be undone only by the Wish spell, divine intervention, or similar magic.",
			">>Undead<<. Somewhere on the Material Plane, a revenant rises. This revenant blames you for its existence and relentlessly hunts you to exact its revenge. The revenant exists until either 1 year passes, the revenant kills you, or you use a Wish spell to banish it permanently to the afterlife.",
			">>Warrior<<. Your Strength score increases by 2 to a maximum of 22.",
			">>Well<<. You learn three cantrips of your choice from any spell list."
		]
	},
	"deck of wild cards" : [
		"This deck of heavy vellum cards hums with the magic of the Elemental Chaos.",
		"The magic of the deck functions only if cards are drawn at random (a deck of real-world playing cards can simulate the deck). As an action, you can draw a random card from this deck and throw it to make a ranged spell attack, using Dexterity for the attack roll. The card has a range of 30 feet. On a hit, it deals 1d4 slashing damage and imposes a magical effect determined by its suit, as detailed in the table below. The card immediately returns to the deck after it hits or misses a target.\n",
		"d4\tSuit\tEffect",
		" 1\t\u2663 (Rods)\tThe card explodes in a burst of fire. The target and each creature within 5 feet of it must succeed on a DC 15 Dexterity saving throw or take 2d8 fire damage.",
		" 2\t\u2666 (Coins)\tThe card shoots streaks of lightning. The target must make a DC 15 Dexterity saving throw. On a failed save, the target has the blinded condition until the end of your next turn, and each creature within 10 feet of the target takes 1d6 lightning damage.",
		" 3\t\u2665 (Cups)\tThe card covers the target in a thick layer of ice. The target takes 1d10 cold damage and must succeed on a DC 15 Constitution saving throw or have the restrained condition until the end of your next turn.",
		" 4\t\u2660 (Swords)\tThe card unleashes a sharp, concussive blast. The target and each creature within 5 feet of it take 1d6 force damage and must succeed on a DC 15 Strength saving throw or have the prone condition."
	],
	"deck of wonder" : {
		features : [
			"Created in the image of the Deck of Many Things, this deck of ivory or vellum cards bestows an assortment of minor benefits and penalties on those who draw from it. Most (75 percent) of these decks have only thirteen cards, but the rest have twenty-two.",
			"Before you draw a card, you must declare how many cards you intend to draw, then draw them randomly. Any additional cards drawn have no effect. Unless a card states otherwise, as soon as you draw a card from the deck, its magic takes effect. You must draw each card you declared no more than 1 hour after the previous draw. If you fail to draw the chosen number, the remaining number of cards fly from the deck and take effect simultaneously.",
			"Unless it is the Mystery card, a drawn card immediately takes effect, fades from existence, and reappears in the deck, making it possible to draw the same card multiple times.",
			"You can use an altered deck of playing cards to simulate the deck, as shown in the table below.",
			"\n1d13\t1d22\tPlaying Card\t\tCard",
			"\t   1\t[A\u2666] Ace of diamonds\t\tChancellor*",
			"1\t   2\t[K\u2666] King of diamonds\t\tDay",
			"2\t   3\t[Q\u2666] Queen of diamonds \tNight",
			"3\t   4\t[J\u2666] Jack of diamonds\t\tDawn",
			"\t   5\t[2\u2666] Two of diamonds\t\tDusk*",
			"\t   6\t[A\u2665] Ace of hearts\t\tDestiny*",
			"4\t   7\t[K\u2665] King of hearts\t\tCrown",
			"5\t   8\t[Q\u2665] Queen of hearts\t\tLock",
			"6\t   9\t[J\u2665] Jack of hearts\t\tChampion",
			"\t   10\t[2\u2665] Two of hearts\t\tCoin*",
			"\t   11\t[A\u2663] Ace of clubs\t\tVulture*",
			"7\t   12\t[K\u2663] King of clubs\t\tChaos",
			"8\t   13\t[Q\u2663] Queen of clubs\t\tOrder",
			"9\t   14\t[J\u2663] Jack of clubs\t\tBeginning",
			"\t   15\t[2\u2663] Two of clubs\t\tMystery*",
			"\t   16\t[A\u2660] Ace of spades\t\tIsolation*",
			"10\t   17\t[K\u2660] King of spades\t\tEnd",
			"11\t   18\t[Q\u2660] Queen of spades\t\tMonster",
			"12\t   19\t[J\u2660] Jack of spades\t\tKnife",
			"\t   20\t[2\u2660] Two of spades\t\tJustice*",
			"\t   21\tJoker (with TM)\t\tStudent*",
			"13\t   22\tJoker (no TM)\t\tMischief\n",
			"* Found only in a deck with twenty-two cards"
		],
		cards : [
			">>Beginning<<. Your hit point maximum and current hit points increase by 2d10. Your hit point maximum remains increased in this way for the next 8 hours.",
			">>Champion<<. You gain a +1 bonus to weapon attack and damage rolls. This bonus lasts for 8 hours.",
			">>Chancellor<<. Within 8 hours of drawing this card, you can cast Augury once as an action, requiring no material components. Use your Intelligence, Wisdom, or Charisma as the spellcasting ability (your choice).",
			">>Chaos<<. You gain resistance to one of the following damage types (chosen by the DM): acid, cold, fire, lightning, or thunder. This resistance lasts for 1d12 days.",
			">>Coin<<. Five pieces of jewelry, each worth 100 gp, or ten gemstones, each worth 50 gp, appear at your feet.",
			">>Crown<<. You learn the Friends cantrip. Use your Intelligence, Wisdom, or Charisma as the spellcasting ability (your choice). If you already know this cantrip, the card has no effect.",
			">>Dawn<<. This card invigorates you. For the next 8 hours, you can add your proficiency bonus to your initiative rolls.",
			">>Day<<. You gain a +1 bonus to saving throws. This benefit lasts until you finish a long rest.",
			">>Destiny<<. This card protects you against an untimely demise. The first time after drawing this card that you would drop to 0 hit points from taking damage, you instead drop to 1 hit point.",
			">>Dusk<<. This card supernaturally saps your energy. You have disadvantage on initiative rolls. This effect lasts until you finish a long rest, but it can be ended early by a Remove Curse spell or similar magic.",
			">>End<<. This card is an omen of death. You take 2d10 necrotic damage, and your hit point maximum is reduced by an amount equal to the damage taken. This effect can't reduce your hit point maximum below 10 hit points. This reduction lasts until you finish a long rest, but it can be ended early by a Remove Curse spell or similar magic.",
			">>Isolation<<. You disappear, along with anything you are wearing or carrying, and become trapped in a harmless extradimensional space for 1d4 minutes. You draw no more cards. You then reappear in the space you left or the nearest unoccupied space. When you reappear, you must succeed on a DC 11 Constitution saving throw or have the poisoned condition for 1 hour as your body reels from the extradimensional travel.",
			">>Justice<<. You momentarily gain the ability to balance the scales of fate. For the next 8 hours, whenever you or a creature within 60 feet of you is about to roll a d20 with advantage or disadvantage, you can use your reaction to prevent the roll from being affected by advantage or disadvantage.",
			">>Knife<<. An uncommon magic weapon you're proficient with appears in your hands. The DM chooses the weapon.",
			">>Lock<<. You gain the ability to cast Knock 1d3 times. Use your Intelligence, Wisdom, or Charisma as the spellcasting ability (your choice).",
			">>Mischief<<. You receive an uncommon wondrous item (chosen by the DM), or you can draw two additional cards beyond your declared draws.",
			">>Monster<<. This card's monstrous visage curses you. While cursed in this way, whenever you make a saving throw, you must roll 1d4 and subtract the number rolled from the total. The curse lasts until you finish a long rest, but it can be ended early with a Remove Curse spell or similar magic.",
			">>Mystery<<. You have disadvantage on Intelligence saving throws for 1 hour. Discard this card and draw from the deck again; together, the two draws count as one of your declared draws.",
			">>Night<<. You gain darkvision within a range of 300 feet. This darkvision lasts for 8 hours.",
			">>Order<<. You gain resistance to one of the following damage types (chosen by the DM): force, necrotic, poison, psychic, or radiant. This resistance lasts for 1d12 days.",
			">>Student<<. You gain proficiency in Wisdom saving throws. If you already have this proficiency, you instead gain proficiency in Intelligence or Charisma saving throws (your choice).",
			">>Vulture<<. One nonmagical item or piece of equipment in your possession (chosen by the DM) disappears. The item remains nearby but concealed for a short time, so it can be found with a successful DC 15 Wisdom (Perception) check. If the item isn't recovered within 1 hour, it disappears forever."
		]
	}
}

MagicItemsList["antimagic armor"] = {
	name : "Antimagic Armor",
	source : [["BoMT", 65]], // Chapter 9: Knight
	type : "armor (light, medium, or heavy)",
	rarity : "very rare",
	attunement : true,
	description : "While wearing this armor, once per dawn I can cast Antimagic Field, requiring no spell components. In addition, as a reaction once per dawn, I can give myself advantage on a saving throw I make against a spell.",
	descriptionFull : "While wearing this armor, you can use your reaction to give yourself advantage on a saving throw you make against a spell. Once this property is used, it can't be used again until the next dawn."+
	"\n   In addition, while you wear this armor, you can use it to cast Antimagic Field, requiring no spell components. Once this property is used, it can't be used again until the next dawn.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["suffix", "Antimagic"]
	},
	action : [["reaction", "Adv. save vs. spell (1\xD7 per dawn)"]],
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["antimagic field"],
		selection : ["antimagic field"],
		firstCol : "oncelr"
	}],
	extraLimitedFeatures : [{
		name : "Adv. save vs. spell (Antimagic Armor)",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Antimagic Field (Antimagic Armor)",
		usages : 1,
		recovery : "dawn"
	}],
	spellChanges : {
		"antimagic field" : {
			components : "",
			compMaterial : "",
			changes : "While wearing the armor, it requires no components to cast Antimagic Field."
		}
	}
};
MagicItemsList["armor of fungal spores"] = {
	name : "Armor of Fungal Spores",
	nameTest : "of Fungal Spores",
	source : [["BoMT", 65]], // Chapter 9: Knight
	type : "armor (medium)",
	rarity : "uncommon",
	description : "As a bonus action once per dawn while wearing this armor, I can make it emit poisonous spores. These spores fill a 10-ft radius sphere centered on myself. Each creature in that area must make a DC 15 Constitution save or be poisoned until the end of my next turn.",
	descriptionFull : "While wearing this armor, you can take a bonus action to make the armor emit poisonous spores, which fill a 10-foot-radius sphere centered on yourself. Each creature in that area must succeed on a DC 15 Constitution saving throw or have the poisoned condition until the end of your next turn. Once this property is used, it can't be used again until the next dawn.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "prefix",
		descriptionChange : ["prefix", "armor"],
		excludeCheck : function (inObjKey, inObj) {
			return !/medium/i.test(inObj.type);
		}
	},
	action : [["bonus action", ""]],
	usages : 1,
	recovery : "dawn"
};
MagicItemsList["armor of the fallen"] = {
	name : "Armor of the Fallen",
	nameTest : "of the Fallen",
	source : [["BoMT", 65]], // Chapter 9: Knight
	type : "armor (medium or heavy)",
	rarity : "uncommon",
	attunement : true,
	description : "While wearing this armor, I can use it to cast either Animate Dead or Speak with Dead. Once the armor has cast a spell in this way, it can't cast either spell until the next dawn. My soul keeps this armor together. If I die while attuned to the armor, the armor is destroyed.",
	descriptionFull : "While wearing this armor, you can use it to cast either Speak with Dead or Animate Dead. Once the armor has cast a spell in this way, it can't cast either spell until the next dawn."+
	"\n   Your soul keeps this armor together. If you die while you are attuned to the armor, the armor is destroyed.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "prefix",
		descriptionChange : ["prefix", "armor"],
		excludeCheck : function (inObjKey, inObj) {
			return !/heavy|medium/i.test(inObj.type);
		}
	},
	spellcastingBonus : [{
		name : "either or",
		spells : ["animate dead", "speak with dead"],
		selection : ["animate dead", "speak with dead"],
		firstCol : "SP",
		times : 2
	}],
	usages : 1,
	recovery : "dawn"
};
MagicItemsList["armor of weightlessness"] = {
	name : "Armor of Weightlessness",
	nameTest : "of Weightlessness",
	source : [["BoMT", 65]], // Chapter 9: Knight
	type : "armor (light, medium, or heavy)",
	rarity : "uncommon",
	attunement : true,
	description : "This armor has 5 charges, regaining 1d4+1 expended charges daily at dawn. As a bonus action while wearing it, I can expend 1 or more charges to cast Jump (1 charge) or Levitate (2 charges) on myself.",
	descriptionFull : "This armor has 5 charges. While you wear it, you can use a bonus action to expend 1 or more charges to cast one of the following spells from the armor, targeting yourself: Jump (1 charge) or Levitate (2 charges)."+
	"\n   This armor regains 1d4 + 1 expended charges daily at dawn.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "prefix",
		descriptionChange : ["prefix", "armor"]
	},
	usages : 5,
	recovery : "dawn",
	additional : "regains 1d4+1",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge (self only)",
		spells : ["jump"],
		selection : ["jump"],
		firstCol : 1
	}, {
		name : "2 charges (self only)",
		spells : ["levitate"],
		selection : ["levitate"],
		firstCol : 2
	}],
	spellChanges : {
		"jump" : {
			name : "Jump (self only)",
			time : "1 bns",
			range : "Self",
			description : "My jump distance is tripled for the duration",
			changes : "Using the Armor of Weightlessness, I can cast Jump as a bonus action, but only on myself."
		},
		"levitate" : {
			name : "Levitate (self only)",
			time : "1 bns",
			range : "Self",
			save : "",
			description : "I float and move up vertically up to 20 ft; As part of my move each round, I can move up/down 20 ft",
			changes : "Using the Armor of Weightlessness, I can cast Levitate as a bonus action, but only on myself."
		}
	}
};
MagicItemsList["baleful talon"] = {
	name : "Baleful Talon",
	source : [["BoMT", 34]], // Chapter 5: Gem
	type : "weapon (dagger)",
	rarity : "very rare",
	description : "I gain a +1 bonus to attack and damage rolls made with this hooked, obsidian dagger. When I hit a creature with it and roll a 19 or 20 to hit, the dagger flares with sickly light and deals +6d6 necrotic damage. The creature can make a DC 15 Con save to halve the damage. It turns to dust if this reduces its HP to 0.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this hooked, obsidian dagger."+
	"\n   When you hit a creature with this magic weapon and roll a 19 or 20 on the attack roll, the creature must make a DC 15 Constitution saving throw as the dagger flares with sickly light. The creature takes 6d6 necrotic damage on a failed save, or half as much on a successful one. If this damage reduces the creature to 0 hit points, the creature disintegrates into dust.",
	weight : 1,
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*baleful)(?=.*talon).*$/i,
		name : "Baleful Talon",
		source : [["BoMT", 34]],
		description : "Finesse, light, thrown; Roll of 19-20: +6d6 necrotic damage, DC 15 Con save halves",
		modifiers : [1, 1],
		selectNow : true
	}]
};
MagicItemsList["blasted goggles"] = {
	name : "Blasted Goggles",
	source : [["BoMT", 174]], // Chapter 20: Flames
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	description : "These tinker's goggles have 3 charges, regaining 1d3 daily at dawn. As an action, I can use 1 charge to shoot a beam of light: a creature I can see within 120 ft must make a DC 15 Dexterity save or take 3d6 fire damage. If this is a natural 20, I'm blinded for 24 hours. Cursed: I can't remove these or end attunement.",
	descriptionFull : "These tinker's goggles have 3 charges. As an action, you can expend 1 charge to shoot a beam of fiery light from the goggles at a creature you can see within 120 feet of yourself. The target must succeed on a DC 15 Dexterity saving throw or take 3d6 fire damage. The goggles regain 1d3 expended charges daily at dawn."+
	"\n   " + toUni("Cursed") + ". The goggles are cursed, and becoming attuned to them extends the curse to you. You can't remove the goggles or end your attunement to them until you are targeted by a Remove Curse spell or similar magic."+
	"\n   Whenever you use the goggles' fiery beam and the target rolls a 20 on the d20 for the saving throw, the goggles expose you to a flash of violent bright light. As a result, you have the blinded condition for 24 hours.",
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3"
};
MagicItemsList["bloodrage greataxe"] = {
	name : "Bloodrage Greataxe",
	source : [["BoMT", 66]], // Chapter 9: Knight
	type : "weapon (greataxe)",
	rarity : "uncommon",
	description : "I gain a +2 bonus to attack and damage rolls made with this magic greataxe while I have half my hit points or fewer.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic greataxe while you have half your hit points or fewer.",
	weight : 7,
	weaponOptions : [{
		baseWeapon : "greataxe",
		regExpSearch : /^(?=.*bloodrage)(?=.*(great|heavy|weida))(?=.*(axe|\bono|\bfu|masakari)s?\b).*$/i,
		name : "Bloodrage Greataxe",
		source : [["BoMT", 66]],
		description : "Heavy, two-handed; If I'm \u2264 \u00BD HP: +2 to hit \u0026 damage",
		selectNow : true
	}]
};
MagicItemsList["bloodseeker ammunition"] = {
	name : "Bloodseeker Ammunition",
	nameTest : "Bloodseeker",
	source : [["BoMT", 66]], // Chapter 9: Knight
	type : "weapon (any ammunition)",
	rarity : "very rare",
	description : "Ranged attack rolls made with this magic ammunition have advantage against any creature doesn't have all its hit points.",
	descriptionFull : "Ranged attack rolls made with this ammunition have advantage against any creature doesn't have all its hit points.",
	allowDuplicates : true,
	chooseGear : {
		type : "ammo",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "ammunition"],
		excludeCheck : function (inObjKey, inObj) {
			return /vials|flasks/i.test(inObj.icon);
		}
	}
};
MagicItemsList["boomerang shield"] = {
	name : "Boomerang Shield",
	source : [["BoMT", 66]], // Chapter 9: Knight
	type : "shield",
	rarity : "uncommon",
	attunement : true,
	description : "I can make a ranged weapon attack with this magic shield. It reappears in my hand the instant after it hits or misses a target. It has a range of 20 ft and a long range of 60 ft, uses Strength or Dexterity (my choice), I add my proficiency bonus if I'm proficient with shields, and it deals 1d6 slashing damage.",
	descriptionFull : "You can make a ranged weapon attack with this magic shield. It has a normal range of 20 feet and a long range of 60 feet, and it uses your Strength or Dexterity for the attack roll (your choice). If you're proficient with shields, you are proficient with attacks made using this shield. On a hit, it deals 1d6 slashing damage. If you throw the shield, it reappears in your hand the instant after it hits or misses a target.",
	weight : 6,
	shieldAdd : "Boomerang Shield",
	weaponOptions : [{
		regExpSearch : /^(?=.*boomerang)(?=.*shield).*$/i,
		name : "Boomerang Shield",
		source : [["BoMT", 66]],
		ability : 1,
		type : "Shield",
		damage : [1, 6, "slashing"],
		range : "20/60 ft",
		weight : 6,
		description : "Finesse, thrown; Reappears instantly", // Not actually finesse, but easier to code this way and shouldn't cause any issues
		abilitytodamage : true,
		selectNow : true
	}],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea && v.theWea.name === "Boomerang Shield" && tDoc.getField("Proficiency Shields").isBoxChecked(0)) {
					fields.Proficiency = true;
				}
			}
		]
	}
};
MagicItemsList["bow of conflagration"] = {
	name : "Bow of Conflagration",
	nameTest : "of Conflagration",
	source : [["BoMT", 66]], // Chapter 9: Knight
	type : "weapon (any bow)",
	rarity : "rare",
	attunement : true,
	description : "Ammunition fired from this bow blazes brightly. When I hit with an attack roll using this bow, the target takes an extra 1d6 fire damage. If the target is a flammable, nonmagical object, it catches fire, taking 1d6 fire damage at the start of each of my turns until a creature uses an action to extinguish the flames.",
	descriptionFull : "Ammunition fired from this bow blazes brightly. When you hit with an attack roll using this bow, the target takes an extra 1d6 fire damage. If the target is a flammable, nonmagical object, it catches fire, taking 1d6 fire damage at the start of each of your turns until a creature uses an action to extinguish the flames.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "bow"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /bow/i;
			return !testRegex.test(inObjKey) && (!inObj.baseWeapon || !testRegex.test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isRangedWeapon && /bow/i.test(v.baseWeaponName) && /conflagration/i.test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + '+1d6 fire damage; ignites target object';
				}
			},
			'If I include the word "Conflagration" in the name of a bow, it will be treated as the magic weapon Bow of Conflagration. The bow deals an extra 1d6 fire damage. If I target and hit a flammable, nonmagical object, it catches fire, taking 1d6 fire damage at the start of each of my turns until a creature uses an action to extinguish the flames.'
		]
	}
};
MagicItemsList["bow of melodies"] = {
	name : "Bow of Melodies",
	nameTest : "of Melodies",
	source : [["BoMT", 66]], // Chapter 9: Knight
	type : "weapon (any bow)",
	rarity : "very rare",
	attunement : true,
	description : "This bow has multiple strings. I can use these to play one of two melodies on each attack, imbuing it with magic. Melody of Precision: If I'm proficient with Performance, I add +1 (+2 if expertise) to the attack roll. Melody of Reverberation: the attack deals my Charisma modifier in extra thunder damage.",
	descriptionFull : "This bow has multiple strings and resembles a lyre or small harp. By strumming the strings while setting an arrow to the bow, you imbue the arrow with magic."+
	"\n   You can play one of the following melodies when you use the bow to make a ranged weapon attack. You must choose to do so before you make the attack roll, and you can play only one melody per attack."+
	"\n   " + toUni("Melody of Precision") + ". If you're proficient in Performance, you gain a +1 bonus to the attack roll. If you have expertise in Performance, you gain a +2 bonus instead."+
	"\n   " + toUni("Melody of Reverberation") + ". The melody you strum echoes loudly. On a hit, the target takes extra thunder damage equal to your Charisma modifier.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "bow"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /bow/i;
			return !testRegex.test(inObjKey) && (!inObj.baseWeapon || !testRegex.test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				var chaMod = Number(What('Cha Mod'));
				// Only add a description if positive Cha Mod and Melody of Precision is not an option or Reverberation is part of the name
				if (!v.theWea.isMagicWeapon && chaMod > 0 && v.isRangedWeapon && /bow/i.test(v.baseWeaponName) && /^(?=.*melod(ies|y))(?!.*precision).*$/i.test(v.WeaponTextName) && (/reverberation/i.test(v.WeaponTextName) || !hasSkillProf("Performance")[0])) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + '+' + chaMod + ' (Cha mod) thunder damage';
				}
			},
			'If I include the word "Melody" or "Melodies" in the name of a bow, it will be treated as the magic weapon Bow of Melodies. If I also include either "Precision" or "Reverberation" in the name, the respective bonus will be added. if I include neither of those in the name, the bonus will be determined automatically, the Melody of Precision if proficient with Performance (+1 or +2 bonus to hit) or Melody of Reverberation otherwise (+Cha mod thunder damage).'
		],
		atkCalc : [
			function (fields, v, output) {
				// Add to hit bonus if name doesn't include Reverberation. Will be zero if not proficient in Performance
				if (!v.theWea.isMagicWeapon && v.isRangedWeapon && /bow/i.test(v.baseWeaponName) && /^(?=.*melod(ies|y))(?!.*reverberation).*$/i.test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					var perfProf = hasSkillProf("Performance");
					output.extraHit += perfProf[1] ? 2 : perfProf[0] ? 1 : 0;
				}
			}, ''
		]
	}
};
MagicItemsList["breastplate of balance"] = {
	name : "Breastplate of Balance",
	source : [["BoMT", 34]], // Chapter 5: Gem
	type : "armor (breastplate)",
	rarity : "rare",
	attunement : true,
	description : "This burnished copper breastplate with merchant's scales on the chest has 4 charges, regaining 1d4 at dawn. As a reaction when I or another I can see within 60 ft is about to roll a d20 with (dis)advantage, I can use 1 charge to prevent this (dis)advantage. As a bonus action, I can use 2 charges to cast Lesser Restoration.",
	descriptionFull : "This burnished copper breastplate looks as if it were made of interlocking gears. Merchant's scales are emblazoned across the chest."+
	"\n   The armor has 4 charges. You can use the charges in the following ways while wearing the armor:"+
	"\n   " + toUni("Equalize") + ". When you or a creature you can see within 60 feet of yourself is about to roll a d20 with advantage or disadvantage, you can expend 1 charge and take a reaction to prevent the roll from being affected by advantage or disadvantage."+
	"\n   " + toUni("Expunge Imbalance") + ". As a bonus action, you can expend 2 charges to cast the Lesser Restoration spell from the armor."+
	"\n   The armor regains 1d4 expended charges daily at dawn.",
	weight : 20,
	action : [["reaction", " (if dis./adv.)"]],
	usages : 4,
	recovery : "dawn",
	additional : "regains 1d4",
	armorAdd : {
		select : "Breastplate of Balance",
		options : ["Breastplate of Balance"]
	},
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["lesser restoration"],
		selection : ["lesser restoration"],
		firstCol : 2
	}],
	spellChanges : {
		"lesser restoration" : {
			time : "1 bns",
			changes : "While wearing the armor, I can use 2 of its charges to cast Lesser Restoration as a bonus action."
		}
	}
};
MagicItemsList["card sharp's deck"] = {
	name : "Card Sharp's Deck",
	source : [["BoMT", 40]], // Chapter 6: Rogue
	type : "wondrous item",
	rarity : "uncommon",
	description : 'The cards of this deck shimmer around the edges. As an action, I can throw a card as ranged spell attack using Dexterity. This "Deadly Deal" attack has 120 ft range and deals 1d8 force damage. As an action once per dawn, I can shuffle the deck to cast Spray of Cards at 3rd level with it (save DC 15).',
	descriptionFull : "The cards of this deck shimmer around the edges. While holding this deck, you can use the following properties:"+
	"\n   " + toUni("Deadly Deal") + ". As an action, you can use this deck to make a ranged spell attack by throwing a spectral card and using Dexterity for the attack roll. The card has a range of 120 feet and deals 1d8 force damage on a hit."+
	"\n   " + toUni("Spray of Cards") + ". As an action, you can shuffle the deck and cast the Spray of Cards spell at 3rd level from the deck (spell save DC 15). Once the deck has cast the spell, it can't cast the spell again until the next dawn.",
	action : [["action", ""]],
	weaponOptions : [{
		regExpSearch : /^(?=.*deadly)(?=.*deal).*$/i,
		name : "Deadly Deal",
		source : [["BoMT", 40]],
		ability : 2,
		type : "Spell",
		damage : [1, 8, "force"],
		range : "120 ft",
		description : "",
		abilitytodamage : false,
		selectNow : true
	}],
	usages : 1,
	recovery : "dawn",
	additional : "Spray of Cards",
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["spray of cards"],
		selection : ["spray of cards"],
		firstCol : "oncelr"
	}],
	spellChanges : {
		"spray of cards" : {
			description : "All in area 3d10 Force dmg and blinded until their next turn ends; save halves \u0026 not blinded",
			descriptionShorter : false,
			changes : "Using Card Sharp's Deck I can cast Spray of Cards at 3rd level once per dawn."
		}
	}
};
MagicItemsList["clockwork armor"] = {
	name : "Clockwork Armor",
	source : [["BoMT", 67]], // Chapter 9: Knight
	type : "armor (heavy)",
	rarity : "very rare",
	attunement : true,
	description : "The outside surface and internal joints of this armor whir with interlocking gears, drawing on the magic of the plane of Mechanus. The armor has 4 charges and regains 1d4 used charges daily at dawn. If I make a d20 roll while wearing it, I can expend 1 charge to change the number rolled to a 10.",
	descriptionFull : "The outside surface and internal joints of this armor whir with interlocking gears, drawing on the orderly magic of the plane of Mechanus."+
	"\n   The armor has 4 charges. If you make a d20 roll while wearing this armor, you can expend 1 charge to change the number rolled to a 10. The armor regains 1d4 expended charges daily at dawn.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["suffix", "Clockwork"],
		excludeCheck : function (inObjKey, inObj) {
			return !/heavy/i.test(inObj.type);
		}
	},
	usages : 4,
	recovery : "dawn",
	additional : "regains 1d4"
};
MagicItemsList["crown of whirling comets"] = {
	name : "Crown of Whirling Comets",
	source : [["BoMT", 35]], // Chapter 5: Gem
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "This crown has 6 charges, regaining 1d6 at dawn. As a bonus action, I can use 1 charge to fly my walking speed and hover, for 10 min. I can use 3 charges to cast Ice Storm (DC 16). As an action, I can launch one frigid starlight bolt per charge used, that each deal 2d4 cold damage to a creature I can see within 120 ft.",
	descriptionLong : "This delicate silver tiara decorated with stellar iconography has gems on the tiara's points that detach and closely orbit my head. It has 6 charges, regaining 1d6 used charges daily at dawn. As a bonus action, I can use 1 charge to gain a flying speed equal to my walking speed and I can hover, for 10 minutes. As an action, I can expend any number of charges to launch one frigid starlight bolt per charge used to a creature I can see within 120 ft. Each bolt automatically hits and deals 2d4 cold damage. Bolts can be used to hit the same or different targets. As an action, I can use 3 charges to cast Ice Storm (save DC 16).",
	descriptionFull : "This delicate silver tiara is decorated with stellar iconography. While you wear the crown, the gems on the tiara's points detach and closely orbit your head."+
	"\n   The crown has 6 charges for the following properties, which you can use while wearing the crown:"+
	"\n   " + toUni("Star Flight") + ". As a bonus action, you can spend 1 charge to gain the power of flight for 10 minutes. For the duration, you gain a flying speed equal to your walking speed, and you can hover. While flying, you glow faintly with starlight."+
	"\n   " + toUni("Starlight Strike") + ". As an action, you can spend any number of charges to launch bolts of frigid starlight. You launch a number of bolts equal to the number of charges spent, and you can direct the bolts to target one creature or several, so long as all creatures are within 120 feet of you and you can see them. The bolts automatically strike their targets, and each bolt deals 2d4 cold damage."+
	"\n   " + toUni("Whirling Hail") + ". As an action, you can spend 3 charges and cast the Ice Storm spell (save DC 16)."+
	"\n   The crown regains 1d6 expended charges daily at dawn.",
	action : [["bonus action", " (fly)"], ["action", " (bolts)"]],
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6",
	fixedDC : 16,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "3 charges",
		spells : ["ice storm"],
		selection : ["ice storm"],
		firstCol : 3
	}]
};
MagicItemsList["deck of dimensions"] = {
	name : "Deck of Dimensions",
	source : [["BoMT", 40]], // Chapter 6: Rogue
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "This deck has 6 charges, regaining 1d6 used at dawn. As a bonus action, I can use 1 charge to throw a card to an empty spot either within 60 ft and teleport to it, or within 5 ft and teleport to it once in the next 8 hours as an action. I can use 3 charges to cast Arcane Gate, but can't use the deck while the gate is active.",
	descriptionLong : "These cards are decorated with intricate designs of different planes of existence. The deck has 6 charges, regaining 1d6 used charges daily at dawn. As a bonus action, I can use 1 charge to throw a card to an empty space either within 60 ft and teleport to it now, or within 5 ft and leave it there to use an action within the next 24 hours to speak the card's name and teleport to it. Once I teleport to a card, or 8 hours passed, the card vanishes and returns to the deck. As an action, I can use 3 charges to cast Arcane Gate, but the fluttering cards of the deck make up the gate, rendering the deck useless while it's active.",
	descriptionFull : "The backs of the cards in this deck are decorated with intricate designs representing different planes of existence. The deck has 6 charges. While holding it, you can expend 1 or more of its charges to use the following properties:"+
	"\n   " + toUni("Marked Card") + ". As a bonus action, you can expend 1 charge to draw a card from the deck and place it in an unoccupied space within 5 feet of you. The card then becomes marked with an invisible sigil. Once within the next 24 hours, as an action, you can speak the marked card's name and teleport to the card's location, along with any equipment you are wearing or carrying, appearing in the closest unoccupied space to the card. After you teleport in this way, or after 8 hours, the card returns to the deck, and the mark on it fades."+
	"\n   " + toUni("Riffling Portal") + ". As an action, you can expend 3 charges to cast the Arcane Gate spell from the deck. The deck vanishes, and fluttering cards create the spell's portal rings. When the spell ends, the deck reappears in your possession."+
	"\n   " + toUni("Shuffling Stride") + ". As a bonus action, you can expend 1 charge to throw a card from the deck to an unoccupied space within 60 feet of yourself and teleport, along with any equipment you're wearing or carrying, to that space. The card then vanishes and returns to the deck."+
	"\n   The deck regains 1d6 expended charges daily at dawn.",
	action : [["bonus action", " (throw card)"], ["action", " (teleport back)"]],
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "3 charges",
		spells : ["arcane gate"],
		selection : ["arcane gate"],
		firstCol : 3
	}]
};
MagicItemsList["deck of many more things"] = {
	name : "Deck of Many More Things",
	source : [["BoMT", 51]], // Chapter 7: Sage
	type : "wondrous item",
	rarity : "legendary",
	description : "Before drawing cards from this deck, I must declare how many I wish to draw and then draw that number randomly. Any cards drawn in excess have no effect. When a card is drawn, its magic takes effect, it fades from existence, and, unless the card is the Fool or the Jester, reappears in the deck. See Notes page.",
	descriptionFull : "Over the centuries since the first Deck of Many Things was created, many have sought and failed to replicate it. But some have created new cards. These forty-four additional cards are known collectively as the Deck of Many More Things. (More information on creating new cards for this deck appears in chapter 2.)"+
	"\n   " + BoMT.toDescrFull(BoMT["deck of many more things"].features) +
	"\n\n   " + BoMT.toDescrFull(BoMT["deck of many more things"].cards) +
	"\n   " + BoMT.toDescrFull(BoMT["deck of many more things"].cards2),
	toNotesPage : [{
		name : "Features and Table",
		note : BoMT.to1stPerson(BoMT["deck of many more things"].features)
	}, {
		name : "Cards and Their Effects, part 1",
		note : BoMT.to1stPerson(BoMT["deck of many more things"].cards, "\n\u2022 ").replace(/Use my Int/g, "I use my Int").replace(/at my ft/ig, "my feet")
	}, {
		name : "Cards and Their Effects, part 2",
		note : BoMT.to1stPerson(BoMT["deck of many more things"].cards2, "\n\u2022 ").replace(/Use my Int/g, "I use my Int").replace(/I'm not/g, "not")
	}, {
		name : "Deck of Many Things' Cards and Effects",
		source : MagicItemsList["deck of many things"].source,
		note : MagicItemsList["deck of many things"].toNotesPage[1].note
	}]
};
MagicItemsList["deck of miscellany"] = {
	name : "Deck of Miscellany",
	source : [["BoMT", 41]], // Chapter 6: Rogue
	type : "wondrous item",
	rarity : "uncommon",
	description : "Each card of the 32 cards in this wooden box has an illustration of a different item or set of items. As an action, I can pick a card and throw it in an empty space within 5 ft. There it transforms into the item(s) depicted. See the table on the Notes page for the items and the associated real-world playing cards.",
	descriptionFull : "This wooden box contains a set of thirty-two parchment cards."+
	"\n   The face of each card bears an illustration of a different item or set of items. As an action, you can draw a card of your choice from the deck and throw it to the ground in an unoccupied space within 5 feet of yourself. When the card hits the ground, the card permanently transforms into the item or set of items depicted on its face. An altered deck of real-world playing cards can simulate the deck, as shown in the table below.\n\n" + BoMT["deck of miscellany"].join("\n"),
	action : [["action", ""]],
	toNotesPage : [{
		name : "Cards and Their Items",
		note : "\n   This wooden box contains a set of thirty-two parchment cards. The face of each card bears an illustration of a different item or set of items. As an action, I can pick a remaining card and throw it to the ground in an unoccupied space within 5 ft. When the card hits the ground, the card permanently transforms into the item or set of items depicted on its face."+
		BoMT.to1stPerson("\nUsed\t" + BoMT["deck of miscellany"].join("\n  \u2610\t")) // empty ballet box
	}]
};
MagicItemsList["deck of oracles"] = {
	name : "Deck of Oracles",
	source : [["BoMT", 61]], // Chapter 8: Fates
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "If I spend 10 minutes consulting this deck of oracle cards when I finish a long rest, I can roll a d20 and record result. Once in the next 8 hours after a creature within 60 ft makes a check, attack roll, or save, I can use my reaction to have it use the number I rolled instead. Once per dawn, I can use these to cast Divination.",
	descriptionFull : "The illustrations on this deck of oracle cards move or change subtly when viewed indirectly. When you finish a long rest, you can spend 10 minutes consulting the cards for an omen of the coming day. Roll a d20 and record the number rolled. Once in the next 8 hours, immediately after a creature within 60 feet of you makes an ability check, an attack roll, or a saving throw, you can use your reaction to discard the d20 roll; the creature must use the number you rolled in place of its roll."+
	"\n   Additionally, while holding the cards, you can cast Divination from them. Once this property is used, it can't be used again until the next dawn.",
	action : [["reaction", ""]],
	usages : 1,
	recovery : "dawn",
	additional : "Divination",
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["divination"],
		selection : ["divination"],
		firstCol : "oncelr"
	}]
};
MagicItemsList["deck of wild cards"] = {
	name : "Deck of Wild Cards",
	source : [["BoMT", 41]], // Chapter 6: Rogue
	type : "wondrous item",
	rarity : "very rare",
	description : "As an action, I can draw a random card from this deck of heavy vellum cards and throw it. I make a ranged spell attack using Dex with a range of 30 ft, dealing 1d4 slashing damage on a hit and one of four magical effects depending on the card drawn, see Notes page. The thrown card returns to the deck after the attack.",
	descriptionFull : BoMT.toDescrFull(BoMT["deck of wild cards"]),
	weaponOptions : [{
		regExpSearch : /^(?=.*deck)(?=.*wild)(?=.*cards?).*$/i,
		name : "Deck of Wild Cards",
		source : [["BoMT", 41]],
		ability : 2,
		type : "Spell",
		damage : [1, 4, "slashing"],
		range : "30 ft",
		description : "Also random effect on hit, see Notes page",
		abilitytodamage : false,
		selectNow : true
	}],
	toNotesPage : [{
		name : "Random Card Effects",
		note : BoMT.to1stPerson(BoMT["deck of wild cards"])
	}]
};
MagicItemsList["deck of wonder"] = {
	name : "Deck of Wonder",
	source : [["BoMT", 55]], // Chapter 7: Sage
	type : "wondrous item",
	rarity : "uncommon",
	description : "Before drawing cards from this deck, I must declare how many I wish to draw and then draw that number randomly. Any cards drawn in excess have no effect. When a card is drawn, its magic takes effect and then it fades from existence and reappears in the deck. See Notes page.",
	descriptionFull : BoMT.toDescrFull(BoMT["deck of wonder"].features) + "\n\n   " + BoMT.toDescrFull(BoMT["deck of wonder"].cards),
	toNotesPage : [{
		name : "Features and Table",
		note : BoMT.to1stPerson(BoMT["deck of wonder"].features)
	}, {
		name : "Cards and Their Effects",
		note : BoMT.to1stPerson(BoMT["deck of wonder"].cards, "\n\u2022 ")
	}]
};
MagicItemsList["donjon's sundering sphere"] = {
	name : "Donjon's Sundering Sphere",
	source : [["BoMT", 35]], // Chapter 5: Gem
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "Attuning to this marble-size crystal sphere includes attaching it to a nonmagical melee weapon, that then becomes magical +1. It grants me adv. on saves vs. being send to another dimension. Once per dawn when I hit a creature, I can have it make a DC 16 Cha save or be stuck in a demiplane until its next turn ends.",
	descriptionLong : "Attuning to this marble-size crystal sphere includes attaching it to the hilt of a nonmagical melee weapon weapon, that then becomes a magic weapon with a +1 bonus to attack and damage rolls. While wielding it, I have advantage on save against being send to an extradimensional space or another plane of existence. Once per dawn when I hit a creature with this weapon, I can have it make a DC 16 Charisma save or be banished to a harmless demiplane until its next turn ends. It returns to the space it left, or the nearest empty space. When I end my attunement to the sphere, it detaches from the weapon.",
	descriptionFull : "This marble-size crystal sphere glows with extraplanar energy."+
	"\n   As part of attuning to this item, you press the crystal sphere to the hilt of a nonmagical melee weapon of your choice, magically attaching the sphere to the weapon. The weapon becomes a magic weapon with a +1 bonus to attack and damage rolls. While wielding this weapon, you gain the following benefits:"+
	"\n   " + toUni("Dimensional Anchor") + ". You have advantage on saving throws against spells or effects that would send you to an extradimensional space, a demiplane, or another plane of existence against your will."+
	"\n   " + toUni("Isolating Smite") + ". When you hit a creature with this weapon, you can force the creature to make a DC 16 Charisma saving throw. On a failed save, the creature is banished to a harmless demiplane until the end of its next turn. When the banished creature returns, it reappears in the space it left or the nearest unoccupied space if that space is occupied. Once this property is used, it can't be used again until the next dawn."+
	"\n   When you end your attunement to the sphere, the sphere harmlessly detaches from the weapon, and the weapon reverts to a nonmagical piece of equipment.",
	savetxt : {
		adv_vs : ["being send to other plane/dimension"]
	},
	usages : 1,
	recovery : "dawn",
	additional : "Banish",
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && /\bdonjon'?s\b/i.test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					output.magic = v.thisWeapon[1] + 1;
				}
			},
			'If I include the word "Donjon\'s" in the name of a melee weapon, it will be treated as a melee weapon with the Donjon\'s Sundering Sphere attached. It adds a +1 bonus to attack and damage rolls made with it.'
		]
	}
};
MagicItemsList["dried leech"] = {
	name : "Dried Leech",
	source : [["BoMT", 67]], // Chapter 9: Knight
	type : "weapon (any ammunition)",
	rarity : "uncommon",
	description : "If a creature is hit by this magic ammunition, the leech animates and attaches to the target, dealing 1d4 piercing damage at the start of each of their turns. The leech detaches if it deals at least 10 damage or the target dies. Anyone can use their action to detach a leech. A detached leech dies and turns nonmagical.",
	descriptionFull : "This leech has been dried and imbued with a mote of animating magic. If you hit a creature with a ranged attack roll using this ammunition, the leech springs to life and sinks its teeth into the target, dealing 1d4 piercing damage at the start of each of the target's turns. If the leech deals at least 10 damage or the target dies, the leech falls off. A creature, including the target, can use its action to detach the leech. Once a leech is no longer attached to its target, the leech dies and is no longer magical.",
	allowDuplicates : true,
	chooseGear : {
		type : "ammo",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "ammunition"],
		excludeCheck : function (inObjKey, inObj) {
			return /vials|flasks/i.test(inObj.icon);
		}
	}
};
MagicItemsList["euryale's aegis"] = {
	name : "Euryale's Aegis",
	source : [["BoMT", 35]], // Chapter 5: Gem
	type : "shield",
	rarity : "legendary",
	attunement : true,
	description : "This brass shield grants me poison resistance and petrification immunity. I can use it to cast 3 spells, each once per dawn. As a bonus action once per dawn, a target I can see within 30 ft must make a DC 20 Con save or be restrained until its next turn starts, at which point it must save again or be petrified for 24 hours.",
	descriptionLong : "This gleaming brass shield bears a relief of the legendary medusa druid Euryale. It grants me poison resistance and immunity to being petrified. I can use it to cast 3 spells, each once per dawn: Lesser Restoration, Locate Creature, and Transport via Plants.\nAs a bonus action once per dawn, I can try to petrify a creature I can see within 30 ft. It must make a DC 20 Constitution save or be restrained while its body turns to stone. When its next turn starts, it must then make a DC 20 Constitution save again or be petrified for 24 hours. On a successful save, the restrained condition ends.",
	descriptionFull : "This gleaming brass shield bears a relief of the legendary medusa druid Euryale."+
	"\n   While wielding this shield, you gain the following benefits:"+
	"\n   " + toUni("Blessing of Euryale") + ". You have resistance to poison damage and are immune to the petrified condition."+
	"\n   " + toUni("Petrifying Heraldry") + ". As a bonus action, you can make the front of the shield flare with a medusa's petrifying magic, causing the relief's eyes to glow brightly. Choose one creature you can see within 30 feet of you. The creature must succeed on a DC 20 Constitution saving throw, or it has the restrained condition as its body turns to stone. The restrained creature must make another DC 20 Constitution saving throw at the start of its next turn. On a failed save, the creature has the petrified condition for 24 hours. On a successful save, the restrained condition ends. Once this bonus action is used, it can't be used again until the next dawn."+
	"\n   " + toUni("Spellcasting") + ". While wielding the shield, you can use an action to cast one of the following spells from it: Lesser Restoration, Locate Creature, Transport via Plants. Once you use the shield to cast a spell, the shield can't cast that spell again until the next dawn.",
	weight : 6,
	action : [["bonus action", " - Petrify"]],
	shieldAdd : "Euryale's Aegis",
	dmgres : ["Poison"],
	savetxt : {
		immune : ["petrified"]
	},
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["lesser restoration", "locate creature", "transport via plants"],
		selection : ["lesser restoration", "locate creature", "transport via plants"],
		firstCol : "oncelr",
		times : 3
	}],
	extraLimitedFeatures : [{
		name : "Euryale's Aegis - Petrify",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Euryale's Aegis (each spell once)",
		usages : 3,
		recovery : "dawn"
	}]
};
MagicItemsList["fabulist gem"] = {
	name : "Fabulist Gem",
	source : [["BoMT", 36]], // Chapter 5: Gem
	type : "wondrous item",
	rarity : "uncommon",
	attunement : true,
	description : "As a bonus action, I can use this glittering red gem to change the appearance of what I'm wearing, the color, pattern, or to something different entirely. This doesn't pass physical inspection. As an action once per dawn, I can create a pile of coins up to 100 gp on a surface within 10 ft. They last for 1 hour.",
	descriptionFull : "This glittering red gem is commonly found embedded in a ring or brooch."+
	"\n   While wearing the gem, you gain the following benefits."+
	"\n   " + toUni("Counterfeit Coins") + ". You can use your action to magically create a pile of coins, worth no more than 100 gp total, in an unoccupied space within 10 feet of yourself. The pile must appear on a surface that can support it. After 1 hour, the coins vanish, regardless of where they are. Once this action is used, it can't be used again until the next dawn."+
	"\n   " + toUni("Illusory Fashion") + ". As a bonus action, you can magically change the appearance of your clothing and armor. You can change the style, color, and apparent quality of what you're wearing, or you can make it appear as if you were wearing different garments entirely. In either case, the changes wrought by this magic fail to pass physical inspection.",
	action : [["action", " - Counterfeit Coins"], ["bonus action", " - Illusory Fashion"]],
	extraLimitedFeatures : [{
		name : "Fabulist Gem - Counterfeit Coins",
		usages : 1,
		recovery : "dawn"
	}],
	choices : ["Brooch", "Ring"],
	"brooch" : {
		name : "Fabulist Gem Brooch",
		description : "As a bonus action, I can use this brooch's glittering red gem to change the appearance of what I'm wearing, the color, pattern, or to something different entirely. This doesn't pass physical inspection. As an action once per dawn, I can create a pile of coins up to 100 gp on a surface within 10 ft. They last for 1 hour."
	},
	"ring" : {
		name : "Fabulist Gem Ring",
		type : "ring",
		description : "As a bonus action, I can use this ring's glittering red gem to change the appearance of what I'm wearing, the color, pattern, or to something different entirely. This doesn't pass physical inspection. As an action once per dawn, I can create a pile of coins up to 100 gp on a surface within 10 ft. They last for 1 hour."
	}
};
MagicItemsList["fate cutter shears"] = {
	name : "Fate Cutter Shears",
	source : [["BoMT", 61]], // Chapter 8: Fates
	type : "weapon (dagger)",
	rarity : "very rare",
	attunement : true,
	description : "The blades of these pruning shears bear many nicks and dents but still cut cleanly. They function as a magic dagger that deal +1d6 force damage. Once per dawn when I hit a creature with them, I can cut their fate. Until that target finishes a long rest, attack rolls against them score a critical hit on a roll of 19 or 20.",
	descriptionFull : "The blades of these pruning shears bear many nicks and dents but still cut cleanly. The shears function as a magic dagger. The weapon has the following properties:"+
	"\n   " + toUni("Ever Sharp") + ". When you hit with an attack using the shears, the target takes an extra 1d6 force damage."+
	"\n   " + toUni("Sever Threads") + ". When you hit a creature with the shears, you can cut that creature's fate. Until the target finishes a long rest, attack rolls against it score a critical hit on a roll of 19 or 20 on the d20. Once this property is used, it can't be used again until the next dawn.",
	weight : 1,
	usages : 1,
	recovery : "dawn",
	additional : "Sever Threads",
	weaponOptions : [{
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*fate)(?=.*cutt(er|ing))(?=.*(shears?|dagger)).*$/i,
		name : "Fate Cutter Shears",
		source : [["BoMT", 61]],
		description : "Finesse, light, thrown; +1d6 force damage",
		selectNow : true
	}]
};
MagicItemsList["fate dealer's deck"] = {
	name : "Fate Dealer's Deck",
	source : [["BoMT", 61]], // Chapter 8: Fates
	type : "wondrous item",
	attunement : true,
	prerequisite : "Requires attunement by a cleric or paladin",
	prereqeval : function (v) { return classes.known.paladin || classes.known.cleric ? true : false; },
	description : "While holding this deck, I can use it as a spellcasting focus and I gain a bonus to my spell attack rolls and spell save DC determined by its rarity: rare (+1), very rare (+2), or legendary (+3). As an action, I can draw a card and expend and roll one HD to heal or deal radiant damage to a creature within 30 ft I can see, equal to the roll and the deck's bonus.",
	descriptionFull : "The backs of these cards are inscribed with glyphs representing the Inner Planes, the Outer Planes, or the holy symbols of various deities. While holding this deck, you can use it as a spellcasting focus, and you gain a bonus to spell attack rolls and to your spell save DC. The bonus is determined by the deck's rarity: rare (+1), very rare (+2), or legendary (+3)."+
	"\n   In addition, while you're holding the deck, you can draw a card as an action to expend and roll one of your Hit Dice and add the deck's bonus to the number rolled. One creature you can see within 30 feet of you either takes radiant damage or regains hit points (your choice) equal to the total.",
	choices : ["+1 Fate Dealer's Deck (rare)", "+2 Fate Dealer's Deck (very rare)", "+3 Fate Dealer's Deck (legendary)"],
	"+1 fate dealer's deck (rare)" : {
		name : "Fate Dealer's Deck +1",
		nameTest : "+1 Fate Dealer's Deck",
		rarity : "rare",
		description : "While holding this deck, I can use it as a spellcasting focus and it gives me a +1 bonus to my spell attacks and spell save DC. As an action, I can draw a card from it and expend and roll one of my HD. I then choose a creature within 30 ft that I can see and either heal it or deal it radiant damage equal to the roll +1.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare") return 1;
				},
				"While holding the Fate Dealer's Deck, I gain a +1 bonus to spell attack rolls and to the saving throw DCs of my spells."
			]
		}
	},
	"+2 fate dealer's deck (very rare)" : {
		name : "Fate Dealer's Deck +2",
		nameTest : "+2 Fate Dealer's Deck",
		rarity : "very rare",
		description : "While holding this deck, I can use it as a spellcasting focus and it gives me a +2 bonus to my spell attacks and spell save DC. As an action, I can draw a card from it and expend and roll one of my HD. I then choose a creature within 30 ft that I can see and either heal it or deal it radiant damage equal to the roll +2.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare") return 2;
				},
				"While holding the Fate Dealer's Deck, I gain a +2 bonus to spell attack rolls and to the saving throw DCs of my spells."
			]
		}
	},
	"+3 fate dealer's deck (legendary)" : {
		name : "Fate Dealer's Deck +3",
		nameTest : "+3 Fate Dealer's Deck",
		rarity : "legendary",
		description : "While holding this deck, I can use it as a spellcasting focus and it gives me a +3 bonus to my spell attacks and spell save DC. As an action, I can draw a card from it and expend and roll one of my HD. I then choose a creature within 30 ft that I can see and either heal it or deal it radiant damage equal to the roll +3.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type !== "prepare") return 3;
				},
				"While holding the Fate Dealer's Deck, I gain a +3 bonus to spell attack rolls and to the saving throw DCs of my spells."
			]
		}
	}
};
MagicItemsList["feywrought armor"] = {
	name : "Feywrought Armor",
	source : [["BoMT", 67]], // Chapter 9: Knight
	type : "armor (light, medium, or heavy)",
	rarity : "rare",
	attunement : true,
	description : "While wearing this colorful, flowery armor that was forged in the Feywild, I have advantage on saves to avoid or end the charmed condition on myself. The armor has 3 charges and regains 1d3 used charges daily at dawn. As an action, I can use 1 charge to cast Compulsion (save DC 15) from it.",
	descriptionFull : "This colorful, flowery armor was forged in the Feywild and is infused with that plane's captivating magic."+
	"\n   While wearing this armor, you have advantage on saving throws you make to avoid or end the charmed condition on yourself."+
	"\n   This armor has 3 charges. You can use an action to expend a charge to cast the Compulsion spell (save DC 15) from this armor. The armor regains 1d3 expended charges daily at dawn.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["suffix", "Feywrought"]
	},
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	savetxt : { adv_vs : ["charmed"] },
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["compulsion"],
		selection : ["compulsion"],
		firstCol : 1
	}]
};
MagicItemsList["fool's blade"] = {
	name : "Fool's Blade",
	source : [["BoMT", 36]], // Chapter 5: Gem
	type : "weapon (any sword)",
	rarity : "very rare",
	attunement : true,
	description : "As a bonus action once per dawn, I can use this weapon +2 to feint a target within 5 ft, giving me adv. on attacks vs. it until my next turn starts. As a reaction once per dawn when a creature within 60 ft attacks me, I can have it make a DC 15 Int save or have it target another of my choice within its reach.",
	descriptionLong : "This magic weapon appears ordinary, but bears strong illusion magic that allows me to deceive opponents. I have a +2 bonus to attack and damage rolls with it.\nFool's Feint: As a bonus action once per dawn, I can feint a creature within 5 ft, giving me advantage on attack rolls against it until the start of my next turn.\nMisdirect: As a reaction once per dawn when a creature within 60 ft targets me with an attack roll, I can have it make a DC 15 Intelligence save. On a failed save, the attack instead targets another creature of my choice that is within the attacker's reach.",
	descriptionFull : "This weapon appears ordinary, but it bears strong illusion magic that allows its wielder to skillfully deceive opponents."+
	"\n   You have a +2 bonus to attack and damage rolls made with this magic weapon. While wielding it, you also gain the following benefits:"+
	"\n   " + toUni("Fool's Feint") + ". As a bonus action, you can feint, choosing a creature within 5 feet of you as your target. Until the start of your next turn, you have advantage on attack rolls against the target. Once this bonus action is used, it can't be used again until the next dawn."+
	"\n   " + toUni("Misdirect") + ". When a creature within 60 feet of you targets you with an attack roll, you can use your reaction to require that creature to make a DC 15 Intelligence saving throw. On a failed save, the attack instead targets another creature of your choice that is within the attacker's reach. Once this reaction has been used, it can't be used again until the next dawn.",
	action : [["bonus action", " - Feint"], ["reaction", " - Misdirect"]],
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "brackets",
		descriptionChange : ["replace", "sword"],
		itemName1stPage : ["suffix", "Fool's"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !testRegex.test(inObjKey) && (!inObj.baseWeapon || !testRegex.test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && /sword|scimitar|rapier/i.test(v.baseWeaponName) && /\bfool'?s\b/i.test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					output.magic = v.thisWeapon[1] + 2;
				}
			},
			'If I include the word "Fool\'s" in the name of a sword, it will be treated as the magic weapon Fool\'s Blade. It adds a +2 bonus to attack and damage rolls made with it.'
		]
	}
};
MagicItemsList["forcebreaker weapon"] = {
	name : "Forcebreaker Weapon",
	nameTest : "Forcebreaker",
	source : [["BoMT", 67]], // Chapter 9: Knight
	type : "weapon (any that deals bludgeoning damage)",
	rarity : "very rare",
	description : "This magic weapon gives +2 to hit and damage. It was crafted to destroy structures made of magical force, such as a Wall of Force. With one strike with this weapon, I can shatter a Large or smaller structure of magical force, or shatter a 20-ft cube portion of a Huge or larger structure.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic weapon."+
	"\n   This weapon was crafted to destroy structures made of force, such as those created by Forcecage or Wall of Force. Striking a Large or smaller structure of magical force with this weapon automatically shatters that structure. If the target is a Huge or larger structure of force, this weapon shatters a 20-foot-cube portion of it.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "weapon"],
		excludeCheck : function (inObjKey, inObj) {
			var damageArr = inObj.baseWeapon && !inObj.damage ? WeaponsList[inObj.baseWeapon].damage : inObj.damage;
			return !/bludg(\.|eoning)/i.test(damageArr.toString());
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && /forcebreaker/i.test(v.WeaponTextName) && /bludg(\.|eoning)/i.test(fields.Damage_Type)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Shatters magical force';
				}
			},
			'If I include the word "Forcebreaker" in the name of a bludgeoning weapon, it will be treated as the magic weapon Forcebreaker Weapon. It adds a +2 bonus to attack and damage rolls made with it.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (!v.theWea.isMagicWeapon && /forcebreaker/i.test(v.WeaponTextName) && /bludg(\.|eoning)/i.test(fields.Damage_Type)) {
					v.theWea.isMagicWeapon = true;
					output.magic = v.thisWeapon[1] + 2;
				}
			}, ''
		]
	}
};
MagicItemsList["glimmering moonbow"] = {
	name : "Glimmering Moonbow",
	nameTest : "Glimmering Moon",
	source : [["BoMT", 36]], // Chapter 5: Gem
	type : "weapon (any bow)",
	rarity : "rare",
	attunement : true,
	description : "This silver-and-black bow adds +1 to its to hit and damage rolls, creates its own ammo that lasts until it hits or misses a target, and deals +1d6 radiant damage. As a bonus action once per dawn, I can use it to gain resistance to piercing, bludgeoning, and slashing damage until my next turn starts, ",
	descriptionFull : "This silver-and-black bow is engraved with the phases of the moon. You gain a +1 bonus to attack and damage rolls made with this magic weapon."+
	"\n   When you hit with a ranged attack roll using this magic bow, the target takes an extra 1d6 radiant damage. If you load no ammunition in the weapon, it produces its own, automatically creating one piece of magic ammunition when you make a ranged attack with it. The ammunition created by the bow vanishes the instant after it hits or misses a target."+
	"\n   While wielding this magic bow, you can use a bonus action to enter a semi-incorporeal state until the start of your next turn. While semi-incorporeal, you have resistance to bludgeoning, piercing, and slashing damage. Once this bonus action is used, it can't be used again until the next dawn.",
	usages : 1,
	recovery : "dawn",
	additional : "resistances",
	action : [["bonus action", " (resistances)"]],
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "bow"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /bow/i;
			return !testRegex.test(inObjKey) && (!inObj.baseWeapon || !testRegex.test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isRangedWeapon && /bow/i.test(v.baseWeaponName) && /^(?=.*glimmering)(?=.*moon).*$/i.test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(;|,)? ?(loading|Counts as magical)/ig, '');
					fields.Description += (fields.Description ? '; ' : '') + '+1d6 radiant damage';
				}
			},
			'If I include the words "Glimmering" and "Moon" in the name of a bow, it will be treated as the magic weapon Glimmering Moonbow. It has +1 to hit and damage, deals +1d6 radiant damage, and produces its own ammunition, thus its loading property is removed if it has it.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (!v.theWea.isMagicWeapon && v.isRangedWeapon && /bow/i.test(v.baseWeaponName) && /^(?=.*glimmering)(?=.*moon).*$/i.test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					output.magic = v.thisWeapon[1] + 1;
				}
			}, ''
		]
	}
};
MagicItemsList["gloomwrought armor"] = {
	name : "Gloomwrought Armor",
	source : [["BoMT", 67]], // Chapter 9: Knight
	type : "armor (light, medium, or heavy)",
	rarity : "rare",
	attunement : true,
	description : "While wearing this intricate grayscale armor forged in the Shadowfell, I have advantage on saves to avoid or end the frightened condition on myself. The armor has 3 charges and regains 1d3 used charges daily at dawn. As an action, I can use 1 charge to cast Calm Emotions (save DC 15) from it.",
	descriptionFull : "This intricate grayscale armor was forged in the Shadowfell and is infused with that plane's gloom."+
	"\n   While you're wearing this armor, you have advantage on saving throws you make to avoid or end the frightened condition on yourself."+
	"\n   This armor has 3 charges. You can expend a charge to cast the Calm Emotions spell (save DC 15) from the armor. This armor regains 1d3 expended charges daily at dawn.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["suffix", "Gloomwrought"]
	},
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	savetxt : { adv_vs : ["frightened"] },
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["calm emotions"],
		selection : ["calm emotions"],
		firstCol : 1
	}]
};
MagicItemsList["grasping whip"] = {
	name : "Grasping Whip",
	source : [["BoMT", 67]], // Chapter 9: Knight
	type : "weapon (whip)",
	rarity : "rare",
	description : "I gain a +1 bonus to attack and damage rolls made with this magic whip. When I hit a creature or object that is Large or smaller with this whip, I can pull that creature or object 5 ft toward me instead of dealing damage.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic whip. When you hit a creature or object that is Large or smaller with this whip, you can pull that creature or object 5 feet toward you instead of dealing damage.",
	weight : 3,
	weaponOptions : [{
		baseWeapon : "whip",
		regExpSearch : /^(?=.*grasping)(?=.*whip).*$/i,
		name : "Grasping Whip",
		source : [["BoMT", 67]],
		description : "Finesse, reach; Forgo damage to pull \u2264 Large 5 ft to me",
		selectNow : true
	}]
};
MagicItemsList["hammer of runic focus"] = {
	name : "Hammer of Runic Focus",
	source : [["BoMT", 67]], // Chapter 9: Knight
	type : "weapon (warhammer)",
	rarity : "very rare",
	attunement : true,
	description : "As a bonus action three times per dawn, I can slam this hammer on the ground, creating a 15-ft radius glowing circle of runes wherein it's a +3 warhammer glowing with matching runes. The rune circle disappears after 1 minute, when I create another, or when I dismiss it as a bonus action.",
	descriptionFull : "This magic hammer has 3 charges. As a bonus action, you can expend 1 charge and slam this hammer on the ground, creating a 15-foot-radius circle of glowing runes centered on the point of impact. While you're inside that area, your hammer glows with matching runes, and you gain a +3 bonus to attack and damage rolls made with this hammer. The rune circle disappears after 1 minute, when you create another rune circle, or when you dismiss the rune circle as a bonus action. This hammer regains 1d3 expended charges daily at dawn.",
	weight : 2,
	action : [["bonus action", " (start/end)"]],
	usages : 3,
	recovery : "dawn",
	weaponOptions : [{
		baseWeapon : "warhammer",
		regExpSearch : /^(?=.*hammer)(?=.*runic)(?=.*focus).*$/i,
		name : "Hammer of Runic Focus",
		source : [["BoMT", 67]],
		description : "Versatile (1d10); +2 to hit/damage while inside its circle",
		selectNow : true
	}]
};
MagicItemsList["house of cards"] = {
	name : "House of Cards",
	source : [["BoMT", 61]], // Chapter 8: Fates
	type : "wondrous item",
	rarity : "uncommon",
	description : "As an action once per dawn, I can have this deck of cards deal themselves into a shelter centered on a point within 30 ft. It can be any shape that fits in a 40-ft cube, with 1 door and up to 4 windows, that only I can open or close. It has 15 AC, 50 HP, and lasts for 24 hours, I dismiss it as an action, or it reaches 0 HP.",
	descriptionLong : "This deck of cards is decorated with geometric shapes that have a protective motif. As an action once per dawn, I can cause the cards to transform into a shelter made of cards centered on a point within 30 ft. It can be any shaped I want that fits in a 40-ft cube. It has a floor, a roof, one door and up to four windows, and only I can open or close them. It has a comfortable temperature inside, AC 15, 50 HP, and immunity to poison and psychic damage. It lasts for 24 hours, until I dismiss it as an action, or until it is reduced to 0 HP. When the shelter's duration ends, it transforms back into a deck of cards in my hand.",
	descriptionFull : "This deck of cards is decorated with geometric shapes that have a protective motif. While you're holding the deck, you can use an action to shuffle it and cause the cards to deal themselves out and transform into a shelter made of cards. The shelter can be shaped however you desire, but it must fit in a 40-foot cube centered on a point within 30 feet of you. The shelter has one door and up to four windows, and only you can open or close them. It has a floor and a roof, and it maintains a comfortable temperature inside."+
	"\n   The shelter has AC 15, 50 hit points, and immunity to poison and psychic damage. The shelter lasts for 24 hours, until you dismiss it as an action, or until it is reduced to 0 hit points. When the shelter's duration ends, it transforms back into a deck of cards and appears in your hand. Once the deck has transformed into a shelter, it can't be used again until the next dawn.",
	action : [["action", ""]],
	usages : 1,
	recovery : "dawn"
};
MagicItemsList["jester's mask"] = {
	name : "Jester's Mask",
	source : [["BoMT", 36]], // Chapter 5: Gem
	type : "wondrous item",
	rarity : "legendary",
	attunement : true,
	prerequisite : "Requires attunement by a bard, sorcerer, or warlock",
	prereqeval : function (v) { return classes.known.bard || classes.known.sorcerer || classes.known.warlock ? true : false; },
	description : "I can use this harlequin mask as a spellcasting focus. It adds a +3 bonus to my spell attacks and spell save DCs that use Charisma. Once per dawn when I roll a 1 on a d20, I can change it to a 20. As a reaction once per dawn when I'm hit by an attack roll, I can teleport 30 ft to an empty space I can see, taking no damage.",
	descriptionLong : "While I'm wearing this colorful, harlequin domino mask edged with pearls, it grants me:"+
	"\u2022 Charismatic Focus: I can use it as a spellcasting focus and it grants me a +3 bonus to spell attack rolls and spell saving throw DCs that use Charisma as the spellcasting ability."+
	"\u2022 Marvelous Escape: As a reaction once per dawn when a creature hits me with an attack roll, I can teleport in a puff of smoke and sparkles instead of taking damage. I teleport to an empty space I can see within 30 ft, along with anything I'm wearing or carrying."+
	"\u2022 Topsy-Turvy: Once per dawn when I roll a 1 on a d20, I can treat it as a 20 instead.",
	descriptionFull : "This colorful, harlequin domino mask is edged with pearls. While wearing this mask, you gain the following benefits:"+
	"\n   " + toUni("Charismatic Focus") + ". You can use the mask as a spellcasting focus. You gain a +3 bonus to any spell attack rolls and spell saving throw DCs that use Charisma as the spellcasting ability."+
	"\n   " + toUni("Marvelous Escape") + ". When a creature hits you with an attack roll, you can use your reaction to disappear in a puff of smoke and colorful sparkles. You take no damage and instead teleport, along with anything you are wearing or carrying, to an unoccupied space you can see within 30 feet of yourself. Once this reaction is used, it can't be used again until the next dawn."+
	"\n   " + toUni("Topsy-Turvy") + ". When you roll a 1 on a d20, you can treat the roll as if you rolled a 20 instead. Once this property is used, it can't be used again until the next dawn.",
	action : [["reaction", " (escape)"]],
	extraLimitedFeatures : [{
		name : "Jester's Mask - Marvelous Escape",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Jester's Mask - Topsy-Turvy",
		usages : 1,
		recovery : "dawn"
	}],
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type !== "prepare" && ability === 6) return 3;
			},
			"While wearing the Jester's Mask, I gain a +3 bonus to any spell attack rolls and spell saving throw DCs that use Charisma as the spellcasting ability."
		]
	}
};
MagicItemsList["plate of knight's fellowship"] = {
	name : "Plate of Knight's Fellowship",
	source : [["BoMT", 37]], // Chapter 5: Gem
	type : "armor (plate)",
	rarity : "uncommon",
	attunement : true,
	description : "This gleaming set of silver-and-gold plate armor never tarnishes. As a bonus action once per dawn, I can use it to summon a warrior spirit (knight) to an empty spot within 30 ft. It lasts for 1 minute or until reduced to 0 HP. It is an ally to me, shares my initiative and obeys my commands. See the Companion page.",
	descriptionFull : "This gleaming set of silver-and-gold plate armor never tarnishes."+
	"\n   While wearing this armor, you can use a bonus action to summon the spirit of a warrior to your aid. The spirit's corporeal form manifests in an unoccupied space of your choice within 30 feet of you, and it uses the knight stat block. The spirit disappears when it drops to 0 hit points or after 1 minute, whichever comes first."+
	"\n   The spirit is an ally to you and your companions. In combat, the spirit shares your initiative count but takes its turn immediately after yours. The spirit obeys your commands (no action required by you); if you don't issue any commands, the spirit takes the Dodge action and uses its movement to avoid danger."+
	"\n   Once this bonus action is used, it can't be used again until the next dawn.",
	weight : 65,
	usages : 1,
	recovery : "dawn",
	action : [["bonus action", ""]],
	armorAdd : {
		select : "Plate of Knight's Fellowship",
		options : ["Plate of Knight's Fellowship"]
	},
	creaturesAdd : [["Knight"]],
	creatureOptions : [{
		name : "Knight",
		source : [["SRD", 400], ["M", 347]],
		eval : function(prefix) {
			Value(prefix + "Comp.Desc.Name", "Warrior Spirit");
		},
		size : 3,
		type : "Humanoid",
		alignment : "any alignment",
		ac : 18,
		hp : 52,
		hd : [8, 8],
		speed : "30 ft",
		scores : [16, 11, 14, 11, 11, 15],
		saves : ["", "", 4, "", 2, ""],
		senses : "",
		passivePerception : 10,
		languages : "any one language (usually Common)",
		challengeRating : "3",
		proficiencyBonus : 2,
		attacksAction : 2,
		attacks : [{
			name : "Greatsword",
			ability : 1,
			damage : [2, 6, "slashing"],
			range : "Melee (5 ft)",
			description : "Heavy, two-handed; Two greatsword attacks as an Attack action"
		}, {
			name : "Heavy Crossbow",
			ability : 2,
			damage : [1, 10, "piercing"],
			range : "100/400 ft",
			description : "Ammunition, heavy, loading, two-handed"
		}],
		actions : [{
			name : "Leadership (Recharges after a Short or Long Rest)",
			description : "As an action, the knight can activate this ability. Then, for 1 minute, the knight can utter a special command or warning whenever a nonhostile creature that it can see within 30 ft of it makes an attack roll or save. The creature can add +1d4 to its roll provided it can hear and understand the knight. A creature can benefit from only one Leadership die at a time. This effect ends if the knight is incapacitated."
		}, {
			name : "Parry",
			description : "As a reaction, the knight can add +2 AC against one melee attack that would hit it. To do so, the knight must see the attacker and be wielding a melee weapon."
		}],
		traits : [{
			name : "Multiattack",
			description : "The knight makes two melee attacks."
		}],
		features : [{
			name : "Brave",
			description : "The knight has advantage on saving throws against being frightened."
		}, {
			name : "Summoned",
			description : "The warrior spirit is an ally to you and your companions. It shares your initiative count but takes its turn immediately after yours. The spirit obeys your commands (no action), or takes the Dodge action and uses its movement to avoid danger if issued no commands. The spirit disappears when it drops to 0 hit points or after 1 minute, whichever comes first."
		}]
	}]
};
MagicItemsList["ring of puzzler's wit"] = {
	name : "Ring of Puzzler's Wit",
	source : [["BoMT", 37]], // Chapter 5: Gem
	type : "ring",
	rarity : "uncommon",
	description : "This gold ring bears a fluorite stone and is enchanted to sharpen the wearer's mind. The ring has 3 charges and regains 1d4-1 expended charges daily at dawn. When I make an Intelligence check, I can expend 1 charge to grant myself advantage on the check.",
	descriptionFull : "This gold ring bears a fluorite stone and is enchanted to sharpen the wearer's mind."+
	"\n   The ring has 3 charges and regains 1d4 - 1 expended charges daily at dawn. When you make an Intelligence check, you can expend 1 charge to grant yourself advantage on the check.",
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d4-1"
};
MagicItemsList["rod of hellish flames"] = {
	name : "Rod of Hellish Flames",
	source : [["BoMT", 37]], // Chapter 5: Gem
	type : "rod",
	rarity : "very rare",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "I can use this black iron rod as an arcane focus and it grants me resistance to fire and necrotic damage. Once per dawn I can use it to cast Hellish Rebuke as a 4th-level spell (save DC 16). When I cast a spell that deals fire or necrotic damage, I can once per dawn use it to maximize the damage instead of rolling.",
	descriptionFull : "Glowing cinders orbit the flanged head of this black iron rod."+
	"\n   This rod can be used as an arcane focus. While holding this rod, you gain the following benefits:"+
	"\n   " + toUni("Hellish Resistance") + ". You have resistance to fire and necrotic damage."+
	"\n   " + toUni("Searing Rebuke") + ". You can cast the Hellish Rebuke spell as a 4th-level spell (save DC 16) from the rod. Once you use the rod to cast the spell, the rod can't cast the spell again until the next dawn."+
	"\n   " + toUni("Surge of Brimstone") + ". Whenever you cast a spell that deals fire or necrotic damage, you can use the rod to deal the maximum damage instead of rolling. Once this property is used, it can't be used again until the next dawn.",
	weight : 2,
	extraLimitedFeatures : [{
		name : "Rod of Hellish Flames (Hellish Rebuke)",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Rod of Hellish Flames (maximize)",
		usages : 1,
		recovery : "dawn"
	}],
	dmgres : ["Fire", "Necrotic"],
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["hellish rebuke"],
		selection : ["hellish rebuke"],
		firstCol : "oncelr"
	}],
	spellChanges : {
		"hellish rebuke" : {
			description : "Cast when taking damage, creature that dealt damage takes 5d10 Fire damage; save halves",
			changes : "Using the Rod of Hellish Flames, I cast Hellish Rebuke as if I'm using a 4th-level spell slot, doing 5d10 damage, once per dawn."
		}
	}
};
MagicItemsList["rogue's mantle"] = {
	name : "Rogue's Mantle",
	source : [["BoMT", 37]], // Chapter 5: Gem
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "This dark, hooded mantle of thick cloth gives me +60 ft darkvision. As a bonus action, I can use it to teleport 30 ft from and into dim light or darkness, to an empty space I can see. I then have advantage on my first attack before my turn ends. Also, I can use it to cast Antagonize once per dawn (save DC 15).",
	descriptionFull : "This dark, hooded mantle of thick cloth is infused with secretive and deceptive magic. While wearing it, you gain the following benefits:"+
	"\n   " + toUni("Darkvision") + ". You gain darkvision within a range of 60 feet. If you already have darkvision, the mantle increases your darkvision's range by 60 feet instead."+
	"\n   " + toUni("Move in Shadows") + ". While you are in dim light or darkness, you can use a bonus action to teleport, along with anything you are wearing or carrying, up to 30 feet to an unoccupied space you can see that is also in dim light or darkness. You then have advantage on the first melee attack you make before the end of the turn."+
	"\n   " + toUni("Willful Enmity") + ". You can cast the Antagonize spell (save DC 15) from the mantle. Once the mantle has cast the spell, it can't cast the spell again until the next dawn.",
	usages : 1,
	recovery : "dawn",
	additional : "Antagonize",
	vision : [["Darkvision", "fixed 60"], ["Darkvision", "+60"]],
	action : [["bonus action", " (teleport)"]],
	fixedDC : 15,
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["antagonize"],
		selection : ["antagonize"],
		firstCol : "oncelr"
	}]
};
MagicItemsList["ruinous flail"] = {
	name : "Ruinous Flail",
	source : [["BoMT", 37]], // Chapter 5: Gem
	type : "weapon (flail)",
	rarity : "rare",
	attunement : true,
	description : "This ash-gray, cold to the touch flail +1 deals double damage to objects and structures. Once per dawn, I can have a creature hit by it make a DC 15 Con save or be poisoned for 1 minute and take 2d4 necrotic damage at the start of each of its turns. It can repeat the save at the end of each of its turns to end the effects.",
	descriptionFull : "This ash-gray flail is cold to the touch. You gain a +1 bonus to attack and damage rolls made with this magic weapon, and it deals double damage to objects and structures."+
	"\n   Additionally, when you hit a creature with this weapon, you can force the creature to make a DC 15 Constitution saving throw. On a failed save, the creature has the poisoned condition for 1 minute. The poisoned creature takes 2d4 necrotic damage at the start of each of its turns. The creature can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success. Once this property is used in this way, it can't be used again until the next dawn.",
	weight : 2,
	usages : 1,
	recovery : "dawn",
	weaponOptions : [{
		baseWeapon : "flail",
		regExpSearch : /^(?=.*ruinous)(?=.*flail).*$/i,
		name : "Ruinous Flail",
		source : [["BoMT", 37]],
		description : "Double damage to objects; Once per dawn: target DC 15 Con save or poisoned, see item",
		modifiers : [1, 1],
		selectNow : true
	}]
};
MagicItemsList["sage's signet"] = {
	name : "Sage's Signet",
	source : [["BoMT", 37]], // Chapter 5: Gem
	type : "ring",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	description : "This gilded ring with a beautiful engraving is imbued with powers of keen wisdom and foresight. While wearing this ring, I can cast Augury and two more spells depending on the signet each once per dawn using my Intelligence as the spellcasting ability. Casting Augury using this ring only takes one action.",
	descriptionFull : "This gilded ring bears a beautiful engraving and is imbued with powers of keen wisdom and foresight. While wearing this ring, you can use an action to cast the Augury spell from the ring. Once you use the ring to cast the spell, the ring can't cast the spell again until the next dawn."+
	"\n   Six varieties of Sage's Signet rings exist, each with a different signet (see the table below). A ring's signet determines its rarity as well as the additional spells it can cast. While wearing a Sage's Signet, you can cast each of its additional spells once from the ring using your Intelligence as the spellcasting ability. Once you cast each of the additional spells from the ring, it can't cast the spell again until the next dawn."+
	"\n\nSignet\tRarity\tSpells"+
	"\nBear\tVery rare\tEnlarge/Reduce, Polymorph"+
	"\nHart\tVery rare\tAura of Vitality, Mass Cure Wounds"+
	"\nLion\tVery rare\tDestructive Wave, Fireball"+
	"\nSerpent\tRare\tFear, Hex"+
	"\nSongbird\tRare\tCharm Person, Hypnotic Pattern"+
	"\nWolf\tVery rare\tFreedom of Movement, Pass without Trace",
	usages : 3,
	recovery : "dawn",
	additional : "each spell once",
	choices : ["Bear (very rare)", "Hart (very rare)", "Lion (very rare)", "Serpent (rare)", "Songbird (rare)", "Wolf (very rare)"],
	"bear (very rare)" :  {
		name : "Sage's Signet (Bear)",
		rarity : "very rare",
		description : "This gilded ring with a beautiful bear engraving is imbued with powers of keen wisdom and foresight. While wearing this ring, I can cast Augury, Enlarge/Reduce, and Polymorph each once per dawn using my Intelligence as the spellcasting ability. Casting Augury using this ring only takes one action.",
		spellcastingAbility : 4,
		spellcastingBonus : [{
			name : "Once per dawn",
			spells : ["augury", "enlarge/reduce", "polymorph"],
			selection : ["augury", "enlarge/reduce", "polymorph"],
			firstCol : "oncelr",
			times : 3
		}],
		spellChanges : BoMT["sage's signet"]
	},
	"hart (very rare)" :  {
		name : "Sage's Signet (Hart)",
		rarity : "very rare",
		description : "This gilded ring with a beautiful hart engraving is imbued with powers of keen wisdom and foresight. While wearing this ring, I can cast Augury, Aura of Vitality, and Mass Cure Wounds each once per dawn using my Intelligence as the spellcasting ability. Casting Augury using this ring only takes one action.",
		spellcastingAbility : 4,
		spellcastingBonus : [{
			name : "Once per dawn",
			spells : ["augury", "aura of vitality", "mass cure wounds"],
			selection : ["augury", "aura of vitality", "mass cure wounds"],
			firstCol : "oncelr",
			times : 3
		}],
		spellChanges : BoMT["sage's signet"]
	},
	"lion (very rare)" :  {
		name : "Sage's Signet (Lion)",
		rarity : "very rare",
		description : "This gilded ring with a beautiful lion engraving is imbued with powers of keen wisdom and foresight. While wearing this ring, I can cast Augury, Destructive Wave, and Fireball each once per dawn using my Intelligence as the spellcasting ability. Casting Augury using this ring only takes one action.",
		spellcastingAbility : 4,
		spellcastingBonus : [{
			name : "Once per dawn",
			spells : ["augury", "destructive wave", "fireball"],
			selection : ["augury", "destructive wave", "fireball"],
			firstCol : "oncelr",
			times : 3
		}],
		spellChanges : BoMT["sage's signet"]
	},
	"serpent (rare)" :  {
		name : "Sage's Signet (Serpent)",
		rarity : "rare",
		description : "This gilded ring with a beautiful serpent engraving is imbued with powers of keen wisdom and foresight. While wearing this ring, I can cast Augury, Fear, and Hex each once per dawn using my Intelligence as the spellcasting ability. Casting Augury using this ring only takes one action.",
		spellcastingAbility : 4,
		spellcastingBonus : [{
			name : "Once per dawn",
			spells : ["augury", "fear", "hex"],
			selection : ["augury", "fear", "hex"],
			firstCol : "oncelr",
			times : 3
		}],
		spellChanges : BoMT["sage's signet"]
	},
	"songbird (rare)" :  {
		name : "Sage's Signet (Songbird)",
		rarity : "rare",
		description : "This gilded ring with a beautiful songbird engraving is imbued with powers of keen wisdom and foresight. While wearing this ring, I can cast Augury, Charm Person, and Hypnotic Pattern each once per dawn using my Intelligence as the spellcasting ability. Casting Augury using this ring only takes one action.",
		spellcastingAbility : 4,
		spellcastingBonus : [{
			name : "Once per dawn",
			spells : ["augury", "charm person", "hypnotic pattern"],
			selection : ["augury", "charm person", "hypnotic pattern"],
			firstCol : "oncelr",
			times : 3
		}],
		spellChanges : BoMT["sage's signet"]
	},
	"wolf (very rare)" :  {
		name : "Sage's Signet (Wolf)",
		rarity : "very rare",
		description : "This gilded ring with a beautiful wolf engraving is imbued with powers of keen wisdom and foresight. While wearing this ring, I can cast Augury, Freedom of Movement, and Pass without Trace each once per dawn using my Intelligence as the spellcasting ability. Casting Augury using this ring only takes one action.",
		spellcastingAbility : 4,
		spellcastingBonus : [{
			name : "Once per dawn",
			spells : ["augury", "freedom of movement", "pass without trace"],
			selection : ["augury", "freedom of movement", "pass without trace"],
			firstCol : "oncelr",
			times : 3
		}],
		spellChanges : BoMT["sage's signet"]
	}
};
MagicItemsList["shield of the tortoise"] = {
	name : "Shield of the Tortoise",
	source : [["BoMT", 67]], // Chapter 9: Knight
	type : "shield",
	rarity : "uncommon",
	attunement : true,
	description : "This +1 shield curses me as soon as I attune to it. While I'm cursed by it, I can't discard it, I can't break my attunement to it, and I am sluggish. Sluggish means that my speed is halved and when I roll initiative, I always treat the roll on the d20 as a 1. I can't change my initiative by any means.",
	descriptionFull : "While you are wielding this shield, you gain a +1 bonus to AC. This bonus is in addition to the shield's normal bonus to AC."+
	"\n   " + toUni("Curse") + ". This item is cursed. Attuning to it extends the curse to you until you are targeted by a Remove Curse spell or similar magic. You cannot discard the shield, and remain attuned to it, as long as you are cursed. As long as you are cursed, you are sluggish. Your speed is halved. When you roll initiative, treat the roll on your d20 as a 1. You can't change your initiative by any means.",
	weight : 6,
	shieldAdd : ["Shield of the Tortoise", 3, 6],
	speed : { allModes : "/2" }
};
MagicItemsList["shrieking greaves"] = {
	name : "Shrieking Greaves",
	source : [["BoMT", 174]], // Chapter 20: Flames
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "These black leg guards have 3 charges, regaining 1d3 used charges daily at dawn. As a bonus action, I can use 1 charge to gain +30 ft walking speed and adv. on Dex saves for 1 minute. They are cursed, see Notes page. I have disadv. on saves vs. being frightened and they scream if I start my turn frightened.",
	descriptionLong : "These black leg guards are decorated with monstrous skulls screaming in terror. They have 3 charges, regaining 1d3 used charges daily at dawn. As a bonus action, I can use 1 charge to increase my walking speed by 30 ft, and gain advantage on Dexterity saves. These effects last for 1 minute. The greaves are cursed, and I can't remove or end my attunement to them. They give me disadvantage on saves against being frightened. When I start my turn frightened, they release an ear-piercing scream. I and all within 10 ft of me take 2d8 thunder damage and can make a DC 15 Constitution save to halve this damage.",
	descriptionFull : "Each of these black leg guards is decorated with a motif of monstrous skulls screaming in terror."+
	"\n   The greaves have 3 charges. While wearing these greaves, you can use a bonus action to expend 1 charge to increase your walking speed by 30 feet, and you have advantage on Dexterity saving throws. These effects last for 1 minute. The greaves regain 1d3 expended charges daily at dawn."+
	"\n   " + toUni("Curse") + ". " + BoMT.toDescrFull(BoMT["shrieking greaves"]),
	action : [["bonus action", ""]],
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	toNotesPage : [{
		name : "Shrieking Greaves Curse",
		note : BoMT.to1stPerson([BoMT["shrieking greaves"]])
	}]
};
MagicItemsList["skull helm"] = {
	name : "Skull Helm",
	source : [["BoMT", 38]], // Chapter 5: Gem
	type : "wondrous item",
	rarity : "very rare",
	attunement : true,
	description : "While wearing this skull-shaped helm, I have resistance to cold, poison, and necrotic damage. Additionally, I can cast Spirit of Death from it without requiring material components. Once I use the helm to cast the spell, it can't cast this spell again until the next dawn.",
	descriptionFull : "While wearing this skull-shaped helm, you have resistance to cold, poison, and necrotic damage."+
	"\n   Additionally, while wearing the helm, you can cast Spirit of Death from it without requiring material components. Once you use the helm to cast the spell, the helm can't cast this spell again until the next dawn.",
	dmgres : ["Cold", "Poison", "Necrotic"],
	usages : 1,
	recovery : "dawn",
	additional : "Spirit of Death",
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["spirit of death"],
		selection : ["spirit of death"],
		firstCol : "oncelr"
	}],
	spellChanges : {
		"spirit of death" : {
			components : "",
			compMaterial : "",
			description : "Summon a Reaper Spirit; obeys commands; takes turn after mine; disappears at 0 hp",
			changes : "While wearing the helmet, it requires no material components to cast Spirit of Death."
		}
	}
};
MagicItemsList["sling of giant felling"] = {
	name : "Sling of Giant Felling",
	source : [["BoMT", 68]], // Chapter 9: Knight
	type : "weapon (sling)",
	rarity : "uncommon",
	description : "When I hit a creature with the Giant type with a ranged attack roll using this magic sling, the creature must succeed on a DC 18 Constitution saving throw or be knocked prone.",
	descriptionFull : "When you hit a Giant creature with a ranged attack roll using this magic sling, the creature must succeed on a DC 18 Constitution saving throw or have the prone condition.",
	weaponOptions : [{
		baseWeapon : "sling",
		regExpSearch : /^(?=.*sling)(?=.*giant)(?=.*felling).*$/i,
		name : "Sling of Giant Felling",
		source : [["BoMT", 68]],
		description : "Ammunition; Giants: DC 18 Con save or prone",
		selectNow : true
	}]
};
MagicItemsList["spindle of fate"] = {
	name : "Spindle of Fate",
	source : [["BoMT", 38]], // Chapter 5: Gem
	type : "wand",
	rarity : "legendary",
	attunement : true,
	description : "This wand has 6 charges, regains 1d6 at dawn. I can use 1 charge to add my Prof Bonus to my initiative after the roll. As an action, I can use 2 charges to invoke a creature's doom. As a reaction when a creature within 60 ft makes an attack or save, I can use 3 charges to change the outcome. See Notes page.",
	descriptionFull : "This wand is shaped like a drop spindle wrapped in red thread. The wand has 6 charges that can be used for the following properties:"+
	"\n   " + BoMT.toDescrFull(BoMT["spindle of fate"])+
	"\n   The wand regains 1d6 expended charges daily at dawn.",
	descriptionFull : BoMT.toDescrFull(BoMT["spindle of fate"]),
	action : [["action", " - Doom Foretold"], ["reaction", " - Twist of Fate"]],
	weight : 1,
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6",
	toNotesPage : [{
		name : "Features",
		note : [
			"This wand is shaped like a drop spindle wrapped in red thread. The wand has 6 charges, regaining 1d6 expended charges daily at dawn. The charges can be used for the following properties:"+
			BoMT.to1stPerson(BoMT["spindle of fate"])
		]
	}]
};
MagicItemsList["starshot crossbow"] = {
	name : "Starshot Crossbow",
	nameTest : "Starshot",
	source : [["BoMT", 38]], // Chapter 5: Gem
	type : "weapon (any crossbow)",
	rarity : "rare",
	attunement : true,
	description : "This black wooden crossbow has pearl inlays depicting three constellations. It has 3 charges, regaining 1d3 at dawn. It produces its own ammo that lasts until it hits or misses a target. As a bonus action, I can use 1 charge to tap and invoke one of its constellation, see Notes page for the options.",
	descriptionLong : "This crossbow of blackened wood has pearl inlays depicting three different constellations. It has 3 charges and regains 1d3 used charged daily at dawn. It produces its own ammo that lasts until it hits or misses a target. As a bonus action, I can use 1 charge to tap and invoke one of its constellation, see Notes for full text. Balance: next hit with the crossbow before my next turn ends heals me or another within 30 ft of me for 1d8+my Prof Bonus. Flames: until my next turn ends, the crossbow deals +2d8 fire damage. Rogue: until my next turn ends, I become invisible as well as anything I'm wearing or carrying.",
	descriptionFull : BoMT.toDescrFull(BoMT["starshot crossbow"]),
	action : [["bonus action", ""]],
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /crossbow/i;
			return !testRegex.test(inObjKey) && (!inObj.baseWeapon || !testRegex.test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isRangedWeapon && /crossbow/i.test(v.baseWeaponName) && /Starshot/i.test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(;|,)? ?(loading|Counts as magical)/ig, '');
				}
			},
			'If I include the word "Starshot" in the name of a crossbow, it will be treated as the magic weapon Starshot Crossbow. It produces its own ammunition, thus its loading property is removed.'
		]
	},
	toNotesPage : [{
		name : "Features and Constellations",
		note : BoMT.to1stPerson(BoMT["starshot crossbow"])
	}]
};
MagicItemsList["stonemaker war pick"] = {
	name : "Stonemaker War Pick",
	source : [["BoMT", 68]], // Chapter 9: Knight
	type : "weapon (war pick)",
	rarity : "very rare",
	attunement : true,
	description : "This war pick adds +1 to attack and damage rolls. I can use it to cast Meld into Stone once per dawn. If I score a critical hit with it against a creature that has 100 HP or fewer, I can use 1 charge to have the target make a DC 15 Con save or be petrified for 8 hours. It has 1d6+1 charges that can't be replenished.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic war pick. It has the following special properties:"+
	"\n   " + toUni("Meld into Stone") + ". You can cast the Meld into Stone spell from this war pick. Once this property is used, it can't be used again until the next dawn."+
	"\n   " + toUni("Petrification") + ". The war pick has 1d6 + 1 charges. If you score a critical hit against a creature that has fewer than 100 hit points, you can expend 1 charge from the war pick to have that creature make a DC 15 Constitution saving throw. On a failed save, the creature has the petrified condition for 8 hours. When the war pick has no charges remaining, it loses this property.",
	weight : 2,
	extraLimitedFeatures : [{
		name : "Stonemaker War Pick - Meld into Stone",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Stonemaker War Pick - Petrification",
		usages : "1d6+1",
		recovery : "Never"
	}],
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["meld into stone"],
		selection : ["meld into stone"],
		firstCol : "oncelr"
	}],
	weaponOptions : [{
		baseWeapon : "war pick",
		regExpSearch : /^(?=.*stonemaker)(((?=.*pick)(?=.*war))|((?!.*(heavy|great|light))(?=.*\bpicks?\b))).*$|\bkuwas?\b/i,
		name : "Stonemaker War Pick",
		source : [["BoMT", 68]],
		description : "Can petrify on critical hit, see item",
		modifiers : [1, 1],
		selectNow : true
	}]
};
MagicItemsList["sun staff"] = {
	name : "Sun Staff",
	source : [["BoMT", 39]], // Chapter 5: Gem
	type : "staff",
	rarity : "rare",
	attunement : true,
	prerequisite : "Requires attunement by a cleric, druid, or wizard",
	prereqeval : function (v) { return classes.known.cleric || classes.known.druid || classes.known.wizard ? true : false; },
	description : "This +1 quarterstaff deals +1d8 fire damage on an attack. I can use it as a spellcasting focus. Once per dawn when I cast a spell using a spell slot, I can reroll my Prof Bonus of fire or radiant damage dice. As a bonus action, I can toggle it glowing with sunlight: 15-ft radius bright light and dim light for another 15 ft.",
	descriptionFull : "Veins of sunstone run through this wooden staff. This staff can be wielded as a magic quarterstaff that grants a +1 bonus to attack and damage rolls made with it. When you hit with an attack roll using this staff, the target takes an extra 1d8 fire damage."+
	"\n   " + toUni("Solar Focus") + ". You can use the staff as a spellcasting focus. While holding the staff, you can reroll a number of damage dice up to your proficiency bonus when you use a spell slot to cast a spell that deals fire or radiant damage. You must use the new rolls. Once this property is used, it can't be used again until the next dawn."+
	"\n   " + toUni("Sunny Glow") + ". As a bonus action, you can cause the staff to glow with sunlight. While glowing, the staff sheds bright light in a 15-foot radius and dim light for an additional 15 feet. The light lasts until you use another bonus action to extinguish it.",
	weight : 4,
	action : [["bonus action", " (glow on/off)"]],
	usages : 1,
	recovery : "dawn",
	additional : "reroll damage",
	weaponOptions : [{
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*sun)(?=.*staff).*$/i,
		name : "Sun Staff",
		source : [["BoMT", 39]],
		description : "Versatile (1d8); +1d8 fire damage",
		modifiers : [1, 1],
		selectNow : true
	}]
};
MagicItemsList["sword of the planes"] = {
	name : "Sword of the Planes",
	nameTest : "of the Planes",
	source : [["BoMT", 68]], // Chapter 9: Knight
	type : "weapon (any sword)",
	rarity : "legendary",
	attunement : true,
	description : "This +3 weapon can tear the fabric of reality. As an action once per dawn, I can slice a rift to a location on another plane in an empty space within 5 ft of me. The rift can be up to 10 ft high and wide. Anything entering the rift is instantly transported. The DM determines where it goes exactly.",
	descriptionFull : "You gain a +3 bonus to attack and damage rolls made with this magic sword."+
	"\n   This sword can tear the fabric of reality, creating a temporary rift between planes. You can use your action to choose a different plane of existence from the one you're on and slice through an unoccupied space within 5 feet of yourself, creating a rift to that other plane. The rift can be up to 10 feet high and 10 feet wide, and it lasts for 1 minute. Once this property is used, it can't be used again until the next dawn."+
	"\n   You can specify a target destination, such as the City of Brass on the Elemental Plane of Fire or the palace of Dispater on the second layer of the Nine Hells, and the rift opens in or near that destination (DM's discretion). If you are trying to reach the City of Brass, for example, the rift might appear on the Street of Steel, before the Gate of Ashes, or facing the city from across the Sea of Fire, at the DM's discretion."+
	"\n   Anything that enters the rift is instantly transported to the other plane, appearing in the unoccupied space nearest to the rift.",
	usages : 1,
	recovery : "dawn",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !testRegex.test(inObjKey) && (!inObj.baseWeapon || !testRegex.test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && /sword|scimitar|rapier/i.test(v.baseWeaponName) && /of the Planes/i.test(v.WeaponTextName)) {
					v.theWea.isMagicWeapon = true;
					output.magic = v.thisWeapon[1] + 3;
				}
			},
			'If I include the words "of the Planes" in a the name of a sword, it will be treated as the magic weapon Sword of the Planes. It has +3 to hit and damage.'
		]
	}
};
MagicItemsList["telescopic transporter"] = {
	name : "Telescopic Transporter",
	source : [["BoMT", 105]], // Chapter 13: Star
	type : "wondrous item",
	rarity : "legendary",
	description : "This enormous telescope allows me to view distant celestial objects, including stars, Wildspace systems, and Astral Sea phenomena. With 1 hour of calibrating, I can use it to attempt to travel to whatever it is pointed at. With a DC 17 Arcana check me and 8 others teleport, otherwise a mishap, see Notes.",
	descriptionFull : BoMT.toDescrFull(BoMT["telescopic transporter"]),
	toNotesPage : [{
		name : "Features",
		note : BoMT.to1stPerson([BoMT["telescopic transporter"]])
	}]
};
MagicItemsList["tidecaller trident"] = {
	name : "Tidecaller Trident",
	source : [["BoMT", 69]], // Chapter 9: Knight
	type : "weapon (trident)",
	rarity : "very rare",
	attunement : true,
	description : "This magic trident gives a +2 bonus to attack and damage made with it and advantage on attack rolls when used underwater. The trident has 3 charges, regaining 1d3 expended charges daily at dawn. I can expend these charges to cast spells (save DC 15): Control Water (1 charge) or Tsunami (3 charges).",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic trident. You also have advantage on attack rolls made with this weapon while underwater."+
	"\n   This trident has 3 charges. You can expend 1 charge to cast Control Water (save DC 15) from the trident or 3 charges to cast Tsunami (save DC 15) from it instead. The trident regains 1d3 expended charges daily at dawn.",
	weight : 4,
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	weaponOptions : [{
		baseWeapon : "trident",
		regExpSearch : /^(?=.*tidecaller)(?=.*trident).*$/i,
		name : "Tidecaller Trident",
		source : [["BoMT", 69]],
		description : "Thrown, versatile (1d8); Adv. when underwater",
		modifiers : [2, 2],
		selectNow : true
	}],
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["control water"],
		selection : ["control water"],
		firstCol : 1
	}, {
		name : "3 charges",
		spells : ["tsunami"],
		selection : ["tsunami"],
		firstCol : 3
	}]
};
MagicItemsList["voidwalker armor"] = {
	name : "Voidwalker Armor",
	source : [["BoMT", 39]], // Chapter 5: Gem
	type : "armor (studded leather)",
	rarity : "rare",
	attunement : true,
	description : "This black studded leather armor bears a red sheen. As a bonus action once per dawn, I can summon a projection of myself in an empty space within 30 ft. It's a translucent copy of me, immune to all damage and conditions, that I can make attacks and cast spells from. The projection disappears at the end of my turn.",
	descriptionFull : "This black studded leather armor bears a red sheen. While wearing this armor, you can use a bonus action to summon a projection of yourself in an unoccupied space within 30 feet of yourself. The projection is a translucent copy of you that has immunity to all damage and conditions, and you can make attacks and cast spells with a range other than self as if standing in the projection's space. The projection disappears at the end of your turn. Once you use this bonus action, it can't be used again until the next dawn."+
	"\n   " + toUni("Curse") + ". " + BoMT.toDescrFull(BoMT["voidwalker armor"]),
	weight : 13,
	usages : 1,
	recovery : "dawn",
	action : [["bonus action", ""]],
	armorOptions : [{
		regExpSearch : /^(?=.*voidwalker)(?=.*armou?r).*$/i,
		name : "Voidwalker Armor",
		source : [["BoMT", 39]],
		type : "light",
		ac : 12,
		weight : 13,
		selectNow : true
	}],
	toNotesPage : [{
		name : "Voidwalker Curse",
		note : BoMT.to1stPerson([BoMT["voidwalker armor"]])
	}]
};
MagicItemsList["warrior's passkey"] = {
	name : "Warrior's Passkey",
	source : [["BoMT", 39]], // Chapter 5: Gem
	type : "wondrous item",
	rarity : "rare",
	attunement : true,
	description : "This silver skeleton key is warm to the touch. I can use it to cast Knock while in its key form. As a bonus action, I can transform it into a magic +1 longsword that deals 1d10 force damage and I'm proficient with. The sword reverts back to a key if it leaves my grasp, I use a bonus action to do so, or my attunement ends.",
	descriptionFull : "This silver skeleton key is warm to the touch. While holding the key in its key form, you can use an action to cast the Knock spell from the key."+
	"\n   " + toUni("Transforming the Key") + ". While holding the key, you can use a bonus action to transform it into a magic longsword. You are considered proficient with the sword, and you have a +1 bonus to attack and damage rolls made with it. On a hit, the sword deals 1d10 force damage. The item remains in its sword form until it leaves your grasp or you use another bonus action to revert it to its key form."+
	"\n   If you end your attunement to the item while it's in its sword form, it automatically reverts to its key form.",
	action : [["bonus action", " (transform)"]],
	weaponOptions : [{
		baseWeapon : "longsword",
		regExpSearch : /^(?=.*warrior)(?=.*passkey).*$/i,
		name : "Warrior's Passkey",
		source : [["BoMT", 39]],
		damage : [1, 10, "force"],
		modifiers : [1, 1],
		isAlwaysProf : true,
		description : "",
		weight : 0,
		selectNow : true
	}],
	spellcastingBonus : [{
		name : "At will",
		spells : ["knock"],
		selection : ["knock"],
		firstCol : "atwill"
	}]
};
MagicItemsList["weapon of throne's command"] = {
	name : "Weapon of Throne's Command",
	nameTest : "of Throne's Command",
	source : [["BoMT", 39]], // Chapter 5: Gem
	type : "weapon (any)",
	rarity : "very rare",
	attunement : true,
	description : "This +1 weapon grants me proficiency with Intimidation and Persuasion. It has 5 charges, regaining 1d4 at dawn. As a bonus action, I can expend charges to cast a spell from it with save DC 16: Command (1 charge), Zone of Truth (2), Compulsion (4), Banishment (4), or Dominate Person (5).",
	descriptionLong : "This weapon is bedecked in ornate gold filigree and deep-blue and maroon jewels. I gain a +1 bonus to attack and damage rolls made with this weapon. Additionally, I gain proficiency in the Intimidation and Persuasion skills if I don't already have it. The weapon has 5 charges, regaining 1d4 expended charges daily at dawn. As a bonus action, I can expend 1 or more of its charges to cast one of the following spells (save DC 16): Command (1 charge), Zone of Truth (2 charges), Compulsion (4 charges), Banishment (4 charges), or Dominate Person (5 charges).",
	descriptionFull : "This weapon is bedecked in ornate gold filigree and deep-blue and maroon jewels. You gain a +1 bonus to attack and damage rolls made with this weapon. Additionally, you gain proficiency in the Intimidation and Persuasion skills if you don't already have it."+
	"\n   " + toUni("Spellcasting") + ". The weapon has 5 charges. You can use a bonus action and expend 1 or more of its charges to cast one of the following spells (save DC 16): Command (1 charge), Zone of Truth (2 charges), Compulsion (4 charges), Banishment (4 charges), or Dominate Person (5 charges)."+
	"\n   The weapon regains 1d4 expended charges daily at dawn.",
	skills : ["Intimidation", "Persuasion"],
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "weapon"]
	},
	usages : 5,
	recovery : "dawn",
	additional : "regains 1d4",
	fixedDC : 16,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["command"],
		selection : ["command"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["zone of truth"],
		selection : ["zone of truth"],
		firstCol : 2
	}, {
		name : "4 charges",
		spells : ["banishment", "compulsion"],
		selection : ["banishment", "compulsion"],
		firstCol : 4,
		times : 2
	}, {
		name : "5 charges",
		spells : ["dominate person"],
		selection : ["dominate person"],
		firstCol : 5
	}],
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if (/of throne'?s? command/.test(v.WeaponTextName)) {
					output.magic = v.thisWeapon[1] + 1;
				}
			},
			'If I include the words "of Throne\'s Command" in a the name of a weapon, it will be treated as the magic weapon Weapon of Throne\'s Command. It adds a +1 bonus to attack and damage rolls.'
		]
	},
	spellChanges : {
		"command" : {
			time : "1 bns",
			changes : "Using the Weapon of Throne's Command, I can cast Command as a bonus action."
		},
		"zone of truth" : {
			time : "1 bns",
			changes : "Using the Weapon of Throne's Command, I can cast Zone of Truth as a bonus action."
		},
		"banishment" : {
			time : "1 bns",
			changes : "Using the Weapon of Throne's Command, I can cast Banishment as a bonus action."
		},
		"compulsion" : {
			time : "1 bns",
			changes : "Using the Weapon of Throne's Command, I can cast Compulsion as a bonus action."
		},
		"dominate person" : {
			time : "1 bns",
			changes : "Using the Weapon of Throne's Command, I can cast Dominate Person as a bonus action."
		}
	}
};
MagicItemsList["winged ammunition"] = {
	name : "Winged Ammunition",
	nameTest : "Winged",
	source : [["BoMT", 69]], // Chapter 9: Knight
	type : "weapon (any ammunition)",
	rarity : "uncommon",
	description : "Ranged weapon attack rolls made with this magic ammunition ignore half and three-quarters cover. In addition, attacking at long range doesn't impose disadvantage on ranged weapon attack rolls made with this ammunition.",
	descriptionFull : "Ranged weapon attack rolls made with this ammunition ignore half and three-quarters cover. In addition, attacking at long range doesn't impose disadvantage on ranged weapon attack rolls made with this ammunition.",
	allowDuplicates : true,
	chooseGear : {
		type : "ammo",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "ammunition"],
		excludeCheck : function (inObjKey, inObj) {
			return /vials|flasks/i.test(inObj.icon);
		}
	}
};
MagicItemsList["wraps of unarmed prowess"] = {
	name : "Wraps of Unarmed Prowess, +1, +2, or +3",
	nameTest : "Wraps of Unarmed Prowess",
	source : [["BoMT", 69]], // Chapter 9: Knight
	type : "wondrous item",
	description : "While wearing these cloth wraps, my unarmed strikes are considered magical for the purpose of overcoming immunity and resistance to nonmagical attacks, and I gain a bonus to their attack and damage rolls. The bonus is determined by rarity: uncommon (+1), rare (+2), or very rare (+3).",
	descriptionFull : "While you're wearing these cloth wraps, your unarmed strikes are considered magical for the purpose of overcoming immunity and resistance to nonmagical attacks and damage, and you gain a bonus to the attack and damage rolls of your unarmed strikes. The bonus is determined by the wraps' rarity: uncommon (+1), rare (+2), or very rare (+3).",
	choices : ["+1 Wraps of Unarmed Prowess (uncommon)", "+2 Wraps of Unarmed Prowess (rare)", "+3 Wraps of Unarmed Prowess (very rare)"],
	"+1 wraps of unarmed prowess (uncommon)" : {
		name : "Wraps of Unarmed Prowess +1",
		nameTest : "+1 Wraps of Unarmed Prowess",
		rarity : "uncommon",
		description : "While I'm wearing these cloth wraps, I gain a +1 bonus to the attack and damage rolls of my unarmed strikes. My unarmed strikes are considered magical for the purpose of overcoming immunity and resistance to nonmagical attacks and damage.",
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (v.baseWeaponName == "unarmed strike" && !/counts as( a)? magical/i.test(fields.Description)) {
						fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
					};
				},
				"My unarmed strikes get a +1 bonus to To Hit and Damage and count as magical for overcoming resistances and immunities.",
				700
			],
			atkCalc : [
				function (fields, v, output) {
					if (v.baseWeaponName == "unarmed strike") {
						output.magic += 1;
					}
				}, ''
			]
		}
	},
	"+2 wraps of unarmed prowess (rare)" : {
		name : "Wraps of Unarmed Prowess +2",
		nameTest : "+2 Wraps of Unarmed Prowess",
		rarity : "rare",
		description : "While I'm wearing these cloth wraps, I gain a +2 bonus to the attack and damage rolls of my unarmed strikes. My unarmed strikes are considered magical for the purpose of overcoming immunity and resistance to nonmagical attacks and damage.",
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (v.baseWeaponName == "unarmed strike" && !/counts as( a)? magical/i.test(fields.Description)) {
						fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
					};
				},
				"My unarmed strikes get a +2 bonus to To Hit and Damage and count as magical for overcoming resistances and immunities.",
				700
			],
			atkCalc : [
				function (fields, v, output) {
					if (v.baseWeaponName == "unarmed strike") {
						output.magic += 2;
					}
				}, ''
			]
		}
	},
	"+3 wraps of unarmed prowess (very rare)" : {
		name : "Wraps of Unarmed Prowess +3",
		nameTest : "+3 Wraps of Unarmed Prowess",
		rarity : "very rare",
		description : "While I'm wearing these cloth wraps, I gain a +3 bonus to the attack and damage rolls of my unarmed strikes. My unarmed strikes are considered magical for the purpose of overcoming immunity and resistance to nonmagical attacks and damage.",
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (v.baseWeaponName == "unarmed strike" && !/counts as( a)? magical/i.test(fields.Description)) {
						fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
					};
				},
				"My unarmed strikes get a +3 bonus to To Hit and Damage and count as magical for overcoming resistances and immunities.",
				700
			],
			atkCalc : [
				function (fields, v, output) {
					if (v.baseWeaponName == "unarmed strike") {
						output.magic += 3;
					}
				}, ''
			]
		}
	}
};


SpellsList["antagonize"] = {
	name : "Antagonize",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["BoMT", 50]],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "A playing card depicting a rogue",
	duration : "Instantaneous",
	save : "Wis",
	description : "1 crea 4d4+1d4/SL Psychic dmg, use rea to melee atk vs. crea I see (or dis. atk 1 rnd); save half, no rea",
	descriptionShorter : "1 crea 4d4+1d4/SL Psychic dmg, rea melee atk vs. crea I see (or dis. atk 1 rnd); save half, no rea",
	descriptionFull : "You whisper magical words that antagonize one creature of your choice within range. The target must make a Wisdom saving throw. On a failed save, the target takes 4d4 psychic damage and must immediately use its reaction to make a melee attack against another creature of your choice that you can see. If the target can't make this attack (for example, because there is no one within its reach or because its reaction is unavailable), the target instead has disadvantage on the next attack roll it makes before the start of your next turn. On a successful save, the target takes half as much damage only."+
		AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d4 for each slot level above 3rd."
};
SpellsList["spirit of death"] = {
	name : "Spirit of Death",
	classes : ["sorcerer", "warlock", "wizard"],
	source : [["BoMT", 50]],
	level : 4,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M\u0192",
	compMaterial : "A gilded playing card worth at least 400 gp and depicting an avatar of death",
	duration : "Conc, 1 h",
	description : "Summon a Reaper Spirit; obeys commands; takes turn after mine; disappears at 0 hp (400gp)",
	descriptionFull : "You call forth a spirit that embodies death. The spirit manifests in an unoccupied space you can see within range and uses the reaper spirit stat block. The spirit disappears when it is reduced to 0 hit points or when the spell ends."+
	"\n   The spirit is an ally to you and your companions. In combat, the spirit shares your initiative count and takes its turn immediately after yours. It obeys your verbal commands (no action required by you). If you don't issue the spirit any commands, it takes the Dodge action and uses its movement to avoid danger."+
		AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, use the higher level wherever the spell's level appears in the reaper spirit stat block."
};
SpellsList["spray of cards"] = {
	name : "Spray of Cards",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : [["BoMT", 50]],
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "S:15" + (typePF ? "-" : "") + "ft cone",
	components : "V,S,M",
	compMaterial : "A deck of cards",
	duration : "Instantaneous",
	save : "Dex",
	description : "All in area 2d10+1d10/SL Force dmg and blinded until their next turn ends; save halves \u0026 not blinded",
	descriptionShorter : "All in area 2d10+1d10/SL Force dmg, blinded till their next turn ends; save half \u0026 not blinded",
	descriptionFull : "You spray a 15-foot cone of spectral cards. Each creature in that area must make a Dexterity saving throw. On a failed save, a creature takes 2d10 force damage and has the blinded condition until the end of its next turn. On a successful save, a creature takes half as much damage only."+
		AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d10 for each slot level above 2nd."
};

// pub_20231114_BoMT.js
// This file adds the magic item from the Vecna: Eve of Ruin adventure to MPMB's Character Record Sheet

// Define the source
SourceList["VEoR"] = {
	name : "Vecna: Eve of Ruin",
	abbreviation : "VEoR",
	group : "Adventure Books",
	url : "https://dndstore.wizards.com/us/en/product/924703/vecna-eve-of-ruin-digital-plus-physical-bundle",
	date : "2024/05/21"
};

MagicItemsList["chime of exile"] = {
	name : "Chime of Exile",
	source : [["VEoR", 46]],
	type : "wondrous item",
	rarity : "very rare",
	description : "This silver chime is engraved with delicate magic sigils. As an action once per dawn, I can hold the chime and cast the Banishment spell (save DC 20). If the target of the spell has 50 hit points or fewer, it automatically fails its saving throw.",
	descriptionFull : "This silver chime is engraved with delicate magic sigils. While holding the chime, you can use an action to cast the Banishment spell (spell save DC 20). If the target of the spell has 50 hit points or fewer, it automatically fails its saving throw. Once the chime has been used to cast the spell, it can't be used this way again until the next dawn.",
	usages : 1,
	recovery : "dawn",
	additional : "Banishment",
	fixedDC : 20,
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["banishment"],
		selection : ["banishment"],
		firstCol : "oncelr"
	}]
};

// pub_al_20190917_ALPG-v9.1.js
// This file adds the winged aasimar/tiefling from the Adventurers League Player's Guide v9.1: Inglorious Redemption to MPMB's Character Record Sheet

// Define the source
SourceList["ALPGs9"] = {
	name : "AL Player's Guide v9.1: Inglorious Redemption",
	abbreviation : "ALPGs9",
	group : "Adventurers League",
	url : "https://www.dropbox.com/s/8r1cwjrk6n2rzyo/AL-Players-Guide-v9.1-Forgotten-Realms.pdf?dl=1", // used to be https://www.dmsguild.com/product/208178
	date : "2019/09/17",
	defaultExcluded : true
};

/*
	Add this source to the Aasimar from VGtM and the Winged Tiefling variant from SCAG
	Also, add a winged variant to the three Aasimar subraces from VGtM
*/
[
	["fallen aasimar", false],
	["protector aasimar", false],
	["scourge aasimar", false],
	["tiefling-winged", true],
	["feral tiefling-winged", true]
].forEach(function (rac) {
	var rObj = rac[1] ? RaceSubList[rac[0]] : RaceList[rac[0]];
	if (!rObj) return;
	rObj.source = (isArray(rObj.source[0]) ? rObj.source : [rObj.source]).concat([["ALPGs9", 6]]);
	if (rac[0].indexOf("aasimar") !== -1) {
		AddRacialVariant(rac[0], "winged", {
			regExpSearch : /wing/i,
			name : "Winged " + rObj.name,
			source : [["ALPGs9", 6]],
			plural : "Winged " + rObj.plural,
			speed : {
				walk : { spd : 30, enc : 20 },
				fly : { spd : 30, enc : 0 }
			},
			trait : "Winged " + rObj.trait.replace(/\)(\r|\n|.)+/, ")\n\nHealing Hands:\n   As an action, once per long rest, I can touch to heal for my level in HP.\nWings:\n   Once I'm 5th level, I sprout feathered wings from my shoulder blades that give me a flying speed of 30 feet when I'm not wearing heavy armor."),
			features : {
				"healing hands" : {
					name : "Healing Hands",
					usages : 1,
					minlevel : 1,
					recovery : "long rest",
					additional : levels.map(function (n) { return n + " HP"; }),
					action : ["action", ""]
				}
			},
			abilitySave : "",
			spellcastingAbility : "",
			spellcastingBonus : ""
		});
	}
});
